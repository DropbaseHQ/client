import{_ as w,h as d,af as _t,l4 as Tt,l3 as he,l5 as A,l6 as Wr,l7 as ut,l8 as Wt,hL as et,l9 as u,l2 as J,la as He,lb as tt,lc as vt,aA as Nr,ay as Nn,B as si,ld as je,aE as Ct,bt as lc,a5 as Br,kO as Or,iC as Bn,ji as hc,f7 as On,n as ri,P as Fi,a1 as Wi,le as Ni,ft as jo,lf as Vr,k8 as te,y as ue,eN as Bi,k3 as Ge,$ as Xo,M as Oi,I as Hr,hK as Gr,ks as dc,lg as Vi,lh as rt,li as uc,lj as un,lk as Fe,ll as mc,lm as gc,ln as pc,lo as uo,hU as gi,lp as $r,lq as fc,lr as _c,ls as Yo,k2 as vc,lt as mo,lu as bc,lv as wc,lw as Sc,lx as Qo,ly as Jo,lz as Ss,lA as Cs,lB as Zo,lC as ea,N as Vn,bu as Hn,lD as Cc,lE as yc,lF as xc,lG as it,lH as ta,ak as ia,lI as Ic,lJ as kc,lK as Tc,lL as Dc,lM as Pc,lN as Ac,lO as Ec,lP as Lc,lQ as Rc,lR as Mc,lS as Fc,jP as ce,aQ as na,lT as sa,lU as go,c7 as zr,x as Hi,v as Gn,lV as Ie,lW as K,q as Wc,lX as Nc,lY as Bc,lZ as ra,l_ as Oc,l$ as Ae,m0 as Vc,m1 as pi,m2 as Hc,m3 as Gc,m4 as $c,aD as Kr,m5 as oa,m6 as zc,m7 as Kc,m8 as Uc,m9 as qc,dE as jc,dF as Xc,ma as Yc,aw as Qc,ax as Jc,mb as po,ds as Zc,mc as fo,md as zi,me as el,aM as tl,mf as mn,e3 as il,mg as nl,eo as sl,dr as rl,bq as ol,dP as al,E as aa,G as cl,mh as ll,k6 as hl,jm as dl,fs as ul,mi as ml,fd as Ne,mj as gl,mk as pl,ml as fl}from"./index-5b71d1bd.js";import{bw as Le,av as c,bx as k,iC as pe,cT as de,aY as B,ki as _l,jo as vl,by as E,kn as is,af as L,b8 as X,dq as bt,aM as H,e9 as bl,be as wt,db as re,gZ as It,a8 as $,bl as ys,bm as wl,b5 as Sl,ej as Gi,hX as j,e$ as ca,f0 as la,al as lt,bH as g,tu as Te,eL as $n,ak as Qt,cQ as _o,cK as se,ek as le,cm as $i,bn as _e,js as zn,iq as Cl,ld as Ut,di as Kn,fJ as ne,ca as Un,cb as yl,bJ as xl,jj as Il,ji as kl,bd as oi,bY as ha,c5 as Qe,eg as Tl,a6 as Ur,aZ as Dl,d_ as ai,ia as Nt,c6 as me,da as qn,eV as Pl,jg as Al,ex as jn,f3 as Bt,ln as gn,lo as pn,tv as fn,tw as Ki,ic as El,ht as Ll,ho as Rl,hl as Ml,bS as Fl,bu as Jt,bV as vo,o_ as da,tx as qr,ah as V,rx as Dt,ty as ua,jx as ma,jL as ga,qn as Wl,jJ as kt,at as Nl,br as Q,fN as Xn,d9 as Bl,d3 as Ol,d4 as Vl,aD as b,tz as Ui,tA as qi,hJ as Yn,f1 as I,oM as pa,hN as Qn,p2 as ji,cB as Zt,b1 as Oe,qc as Hl,cY as Jn,ct as Gl,aR as ee,bh as Pt,fe as $e,bi as Ye,b0 as Ce,eh as $l,ea as O,eb as De,lG as jr,lH as Xr,tB as xs,tC as zl,tD as Kl,tE as Ul,tF as ql,b6 as mt,hx as ke,hw as Se,jh as jl,kA as Xl,oI as ot,aP as Yl,pK as Ql,tG as Jl,e7 as ht,dK as Zl,tH as eh,qP as th,oJ as St,fq as ih,sg as nh,pn as ns,tk as sh,tI as rh,hm as oh,pk as ah,ce as yt,aJ as li,aW as fe,gb as Is,dg as ch,ai as lh,dj as Ee,q3 as hh,c$ as en,tJ as dh,tK as uh,tL as mh,qm as gh,pD as ph,cL as fh,hV as At,cc as fa,fj as _h,g8 as vh,tM as ks,bq as bo,aU as bh,a7 as Ts,hb as wh,hy as wo,qH as Sh,im as Ch,hB as yh,h$ as xh,tN as Ds,kD as fi,ij as _n,hC as qt,tO as Ih,tP as kh,aX as _a,aS as Z,e4 as va,hu as ba,ee as wa,cZ as Th,tQ as Dh,ef as Ph,hE as Sa,hF as vn,gU as Ah,dm as Yr,gQ as Ca,ag as Ps,bM as So,tR as Xi,co as Eh,as as Lh,eS as ya,kW as Rh,jF as Mh,jD as bn,jE as xa,kB as Fh,hQ as Wh,hR as Co,kF as Nh,kX as yo,gL as Bh,dB as Oh,ir as Vh,oY as Ia,hL as ve,lv as Hh,lw as Gh,sn as $h,ib as xo,qb as zh,kp as ka,qU as Kh,fu as be,ih as Uh,qx as Yi,eM as qh,eP as jh,eQ as Xh,e5 as Yh}from"./vendor-332432be.js";import{m as Qh,s as Jh,a as Zh,e as jt,w as we,i as Be,p as Ta,t as hi,b as ed}from"./quickPickPin-32344b17.js";import{s as td}from"./logConstants-d978bbc0.js";import{g as id}from"./viewsService-285340a8.js";import{g as Da}from"./quickaccess-f6b93953.js";import{D as Pa}from"./dropdownWithPrimaryActionViewItem-7c22356c.js";import{A as nd}from"./accessibilityContribution-303aed9a.js";function Xt(r,e={}){let t="";return e.excludeLeadingNewLine||(t+=`\r
`),t+="\x1B[0m\x1B[7m * ",e.loudFormatting?t+="\x1B[0;104m":t+="\x1B[0m",t+=` ${r} \x1B[0m
\r`,t}const Aa=Le("terminal-view-icon",k.terminal,c("terminalViewIcon","View icon of the terminal view.")),sd=Le("terminal-rename",k.gear,c("renameTerminalIcon","Icon for rename in the terminal quick menu.")),Ea=Le("terminal-kill",k.trash,c("killTerminalIcon","Icon for killing a terminal instance.")),rd=Le("terminal-new",k.add,c("newTerminalIcon","Icon for creating a new terminal instance.")),od=Le("terminal-configure-profile",k.gear,c("configureTerminalProfileIcon","Icon for creating a new terminal profile.")),ad=Le("terminal-decoration-mark",k.circleSmallFilled,c("terminalDecorationMark","Icon for a terminal decoration mark.")),cd=Le("terminal-decoration-incomplete",k.circle,c("terminalDecorationIncomplete","Icon for a terminal decoration of a command that was incomplete.")),ld=Le("terminal-decoration-error",k.errorSmall,c("terminalDecorationError","Icon for a terminal decoration of a command that errored.")),hd=Le("terminal-decoration-success",k.circleFilled,c("terminalDecorationSuccess","Icon for a terminal decoration of a command that was successful.")),dd=Le("terminal-command-history-remove",k.close,c("terminalCommandHistoryRemove","Icon for removing a terminal command from command history.")),ud=Le("terminal-command-history-output",k.output,c("terminalCommandHistoryOutput","Icon for viewing output of a terminal command.")),md=Le("terminal-command-history-fuzzy-search",k.searchFuzzy,c("terminalCommandHistoryFuzzySearch","Icon for toggling fuzzy search of command history.")),x={terminal:c("terminal","Terminal"),new:c("terminal.new","New Terminal"),doNotShowAgain:c("doNotShowAgain","Do Not Show Again"),currentSessionCategory:c("currentSessionCategory","current session"),previousSessionCategory:c("previousSessionCategory","previous session"),actionCategory:{value:c("terminalCategory","Terminal"),original:"Terminal"},focus:{value:c("workbench.action.terminal.focus","Focus Terminal"),original:"Focus Terminal"},kill:{value:c("killTerminal","Kill Terminal"),original:"Kill Terminal",short:c("killTerminal.short","Kill")},moveToEditor:{value:c("moveToEditor","Move Terminal into Editor Area"),original:"Move Terminal into Editor Area"},moveToTerminalPanel:{value:c("workbench.action.terminal.moveToTerminalPanel","Move Terminal into Panel"),original:"Move Terminal into Panel"},changeIcon:{value:c("workbench.action.terminal.changeIcon","Change Icon..."),original:"Change Icon..."},changeColor:{value:c("workbench.action.terminal.changeColor","Change Color..."),original:"Change Color..."},split:{value:c("splitTerminal","Split Terminal"),original:"Split Terminal",short:c("splitTerminal.short","Split")},unsplit:{value:c("unsplitTerminal","Unsplit Terminal"),original:"Unsplit Terminal"},rename:{value:c("workbench.action.terminal.rename","Rename..."),original:"Rename..."},toggleSizeToContentWidth:{value:c("workbench.action.terminal.sizeToContentWidthInstance","Toggle Size to Content Width"),original:"Toggle Size to Content Width"},focusHover:{value:c("workbench.action.terminal.focusHover","Focus Hover"),original:"Focus Hover"},sendSequence:{value:c("workbench.action.terminal.sendSequence","Send Custom Sequence To Terminal"),original:"Send Custom Sequence To Terminal"},newWithCwd:{value:c("workbench.action.terminal.newWithCwd","Create New Terminal Starting in a Custom Working Directory"),original:"Create New Terminal Starting in a Custom Working Directory"},renameWithArgs:{value:c("workbench.action.terminal.renameWithArg","Rename the Currently Active Terminal"),original:"Rename the Currently Active Terminal"}};let Me=[],ei=class La extends _l{constructor(e,t,i,n,s,o,a){super(La.PREFIX,{canAcceptInBackground:!0}),this._editorService=e,this._terminalService=t,this._terminalEditorService=i,this._terminalGroupService=n,this._commandService=s,this._themeService=o,this._instantiationService=a}_getPicks(e){Me=[],Me.push({type:"separator",label:"panel"});const t=this._terminalGroupService.groups;for(let o=0;o<t.length;o++){const a=t[o];for(let l=0;l<a.terminalInstances.length;l++){const h=a.terminalInstances[l],m=this._createPick(h,l,e,{groupIndex:o,groupSize:a.terminalInstances.length});m&&Me.push(m)}}Me.length>0&&Me.push({type:"separator",label:"editor"});const i=this._terminalEditorService.instances;for(let o=0;o<i.length;o++){const a=i[o];a.target=A.Editor;const l=this._createPick(a,o,e);l&&Me.push(l)}Me.length>0&&Me.push({type:"separator"});const n=c("workbench.action.terminal.newplus","Create New Terminal");Me.push({label:`$(plus) ${n}`,ariaLabel:n,accept:()=>this._commandService.executeCommand("workbench.action.terminal.new")});const s=c("workbench.action.terminal.newWithProfilePlus","Create New Terminal With Profile");return Me.push({label:`$(plus) ${s}`,ariaLabel:s,accept:()=>this._commandService.executeCommand("workbench.action.terminal.newWithProfile")}),Me}_createPick(e,t,i,n){const s=this._instantiationService.invokeFunction(Wr,e),o=n?n.groupSize>1?`${n.groupIndex+1}.${t+1}`:`${n.groupIndex+1}`:`${t+1}`,a=`$(${s}) ${o}: ${e.title}`,l=[],h=ut(e);h&&l.push(h);const m=Wt(e,this._themeService.getColorTheme().type);m&&l.push(...m);const p=vl(i,a,!0);if(p)return{label:a,description:e.description,highlights:{label:p},buttons:[{iconClass:E.asClassName(sd),tooltip:c("renameTerminal","Rename Terminal")},{iconClass:E.asClassName(Ea),tooltip:x.kill.value}],iconClasses:l,trigger:v=>{switch(v){case 0:return this._commandService.executeCommand("workbench.action.terminal.rename",e),is.NO_ACTION;case 1:return this._terminalService.safeDisposeTerminal(e),is.REMOVE_ITEM}return is.NO_ACTION},accept:(v,f)=>{if(e.target===A.Editor){const _=this._editorService.findEditors(e.resource);this._terminalEditorService.openEditor(e,{viewColumn:_==null?void 0:_[0].groupId}),this._terminalEditorService.setActiveInstance(e)}else this._terminalGroupService.showPanel(!f.inBackground),this._terminalGroupService.setActiveInstance(e)}}}};ei.PREFIX="term ";ei=w([d(0,_t),d(1,Tt),d(2,Tt),d(3,he),d(4,pe),d(5,de),d(6,B)],ei);function Ra(r,e){const t=[{name:null,description:c("terminalAutomaticProfile","Automatically detect the default")}];return t.push(...r.map(i=>({name:i.profileName,description:gd(i)}))),e&&t.push(...e.map(i=>({name:i.title,description:pd(i)}))),{values:t.map(i=>i.name),markdownDescriptions:t.map(i=>i.description)}}function gd(r){let e=`$(${E.isThemeIcon(r.icon)?r.icon.id:r.icon?r.icon:k.terminal.id}) ${r.profileName}
- path: ${r.path}`;return r.args&&(typeof r.args=="string"?e+=`
- args: "${r.args}"`:e+=`
- args: [${r.args.length===0?"":`'${r.args.join("','")}'`}]`),r.overrideName!==void 0&&(e+=`
- overrideName: ${r.overrideName}`),r.color&&(e+=`
- color: ${r.color}`),r.env&&(e+=`
- env: ${JSON.stringify(r.env)}`),e}function pd(r){return`$(${E.isThemeIcon(r.icon)?r.icon.id:r.icon?r.icon:k.terminal.id}) ${r.title}
- extensionIdentifier: ${r.extensionIdentifier}`}function Ma(r,e){if(!r&&!e)return!0;if(typeof r=="string"&&typeof e=="string")return r===e;if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}return!1}function fd(r,e){if(!r&&!e)return!0;if(!r||!e)return!1;if(E.isThemeIcon(r)&&E.isThemeIcon(e))return r.id===e.id&&r.color===e.color;if(typeof r=="object"&&"light"in r&&"dark"in r&&typeof e=="object"&&"light"in e&&"dark"in e){const t=r,i=e;if((L.isUri(t.light)||qe(t.light))&&(L.isUri(t.dark)||qe(t.dark))&&(L.isUri(i.light)||qe(i.light))&&(L.isUri(i.dark)||qe(i.dark)))return t.light.path===i.light.path&&t.dark.path===i.dark.path}if(L.isUri(r)&&L.isUri(e)||qe(r)||qe(e)){const t=r,i=e;return t.path===i.path&&t.scheme===i.scheme}return!1}function qe(r){return r?typeof r.path=="string"&&typeof r.scheme=="string":!1}let ss;function wn(r){return ss||(ss=r.get(B).createInstance(Sn,"commands")),ss}let rs;function As(r){return rs||(rs=r.get(B).createInstance(Sn,"dirs")),rs}const tn=new Map;async function _d(r,e){const t=tn.get(e);if(t===null)return[];if(t!==void 0)return t;let i;switch(e){case"bash":i=await bd(r);break;case"pwsh":i=await Sd(r);break;case"zsh":i=await wd(r);break;case"fish":i=await Cd(r);break;default:return[]}if(i===void 0)return tn.set(e,null),[];const n=Array.from(i);return tn.set(e,n),n}function vd(){tn.clear()}let Sn=class extends H{get entries(){return this._ensureUpToDate(),this._entries.entries()}constructor(e,t,i){super(),this._storageDataKey=e,this._configurationService=t,this._storageService=i,this._timestamp=0,this._isReady=!1,this._isStale=!0,this._entries=new bl(this._getHistoryLimit()),this._configurationService.onDidChangeConfiguration(n=>{n.affectsConfiguration("terminal.integrated.shellIntegration.history")&&(this._entries.limit=this._getHistoryLimit())}),this._storageService.onDidChangeValue(n=>{n.key===this._getTimestampStorageKey()&&!this._isStale&&(this._isStale=this._storageService.getNumber(this._getTimestampStorageKey(),-1,0)!==this._timestamp)})}add(e,t){this._ensureUpToDate(),this._entries.set(e,t),this._saveState()}remove(e){this._ensureUpToDate(),this._entries.delete(e),this._saveState()}clear(){this._ensureUpToDate(),this._entries.clear(),this._saveState()}_ensureUpToDate(){this._isReady||(this._loadState(),this._isReady=!0),this._isStale&&(this._entries.clear(),this._loadState(),this._isStale=!1)}_loadState(){this._timestamp=this._storageService.getNumber(this._getTimestampStorageKey(),-1,0);const e=this._loadPersistedState();if(e)for(const t of e.entries)this._entries.set(t.key,t.value)}_loadPersistedState(){const e=this._storageService.get(this._getEntriesStorageKey(),-1);if(e===void 0||e.length===0)return;let t;try{t=JSON.parse(e)}catch{return}return t}_saveState(){const e={entries:[]};this._entries.forEach((t,i)=>e.entries.push({key:i,value:t})),this._storageService.store(this._getEntriesStorageKey(),JSON.stringify(e),-1,1),this._timestamp=Date.now(),this._storageService.store(this._getTimestampStorageKey(),this._timestamp,-1,1)}_getHistoryLimit(){const e=this._configurationService.getValue("terminal.integrated.shellIntegration.history");return typeof e=="number"?e:100}_getTimestampStorageKey(){return`terminal.history.timestamp.${this._storageDataKey}`}_getEntriesStorageKey(){return`terminal.history.entries.${this._storageDataKey}`}};Sn=w([d(1,X),d(2,bt)],Sn);async function bd(r){const e=r.get(wt),t=r.get(et),i=await t.getEnvironment();if((i==null?void 0:i.os)===1||!i&&re)return;const n=await wi(It.HOME,".bash_history",!1,e,t);if(n===void 0)return;const s=n.split(`
`),o=new Set;let a,l,h;for(let m=0;m<s.length;m++){a=s[m],l===void 0?l=a:l+=`
${a}`;for(let p=0;p<a.length;p++)h?a[p]===h&&(h=void 0):a[p].match(/['"]/)&&(h=a[p]);h===void 0&&(l.length>0&&o.add(l.trim()),l=void 0)}return o.values()}async function wd(r){const e=r.get(wt),t=r.get(et),i=await t.getEnvironment();if((i==null?void 0:i.os)===1||!i&&re)return;const n=await wi(It.HOME,".zsh_history",!1,e,t);if(n===void 0)return;const s=n.split(/\:\s\d+\:\d+;/),o=new Set;for(let a=0;a<s.length;a++){const l=s[a].replace(/\\\n/g,`
`).trim();l.length>0&&o.add(l)}return o.values()}async function Sd(r){const e=r.get(wt),t=r.get(et);let i,n;const s=await t.getEnvironment(),o=(s==null?void 0:s.os)===1||!s&&re;o?(i=It.APPDATA,n="\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt"):(i=It.HOME,n=".local/share/powershell/PSReadline/ConsoleHost_history.txt");const a=await wi(i,n,o,e,t);if(a===void 0)return;const l=a.split(`
`),h=new Set;let m,p,v;for(let f=0;f<l.length;f++){if(m=l[f],p===void 0?p=m:p+=`
${m}`,!m.endsWith("`")){const _=p.trim();_.length>0&&h.add(_),p=void 0;continue}for(let _=0;_<m.length;_++)v?m[_]===v&&(v=void 0):m[_].match(/`/)&&(v=m[_]);if(v)p=p.replace(/`$/,""),v=void 0;else{const _=p.trim();_.length>0&&h.add(_),p=void 0}}return h.values()}async function Cd(r){const e=r.get(wt),t=r.get(et),i=await t.getEnvironment();if((i==null?void 0:i.os)===1||!i&&re)return;const s=await(It.XDG_DATA_HOME?wi(It.XDG_DATA_HOME,"fish/fish_history",!1,e,t):wi(It.HOME,".local/share/fish/fish_history",!1,e,t));if(s===void 0)return;const o=new Set,a=s.split(`
`).filter(l=>l.startsWith("- cmd:")).map(l=>l.substring(6).trimStart());for(let l=0;l<a.length;l++){const h=yd(a[l]).trim();h.length>0&&o.add(h)}return o.values()}function yd(r){return xd(/(^|[^\\])((?:\\\\)*)(\\n)/g,r,`$1$2
`)}function xd(r,e,t){let i,n=e;for(;;)if(i=n,n=n.replace(r,t),n===i)return n}async function wi(r,e,t,i,n){var l;if(!r)return;const s=!!((l=n.getConnection())!=null&&l.remoteAuthority),o=L.from({scheme:s?$.vscodeRemote:$.file,path:(t?ys.join:wl.join)(r,e)});let a;try{a=await i.readFile(o)}catch(h){if(h instanceof Sl&&h.fileOperationResult===1)return;throw h}if(a!==void 0)return a.value.toString()}const Fa="─────────",Wa=c("showTerminalTabs","Show Tabs"),Cn=x.actionCategory;async function Na(r,e,t,i){switch(r.config.splitCwd){case"workspaceRoot":if(t!==void 0&&i!==void 0){if(t.length===1)return t[0].uri;if(t.length>1){const n={placeHolder:c("workbench.action.terminal.newWorkspacePlaceholder","Select current working directory for new terminal")},s=await i.executeCommand(Or,[n]);return s?Promise.resolve(s.uri):void 0}}return"";case"initial":return e.getInitialCwd();case"inherited":return e.getCwd()}}const Ba=async(r,e)=>{const t=r.get(J).activeInstance;if(t){const i=lt(e)&&"text"in e?nn(e.text):void 0;if(!i)return;const n=r.get(Bn),s=r.get(_e),a=r.get(On).getLastActiveWorkspaceRoot(t.isRemote?$.vscodeRemote:$.file),l=a?Qe(s.getWorkspaceFolder(a)):void 0,h=await n.resolveAsync(l,i);t.sendText(h,!1)}};let Es=class extends j{constructor(e){super("workbench.action.terminal.launchHelp",c("terminalLaunchHelp","Open Help")),this._openerService=e}async run(){this._openerService.open("https://aka.ms/vscode-troubleshoot-terminal-launch")}};Es=w([d(0,Gi)],Es);function P(r){r.f1=r.f1??!0,r.category=r.category??Cn,r.precondition=r.precondition??u.processSupported;const e=r.run,t=r;return delete t.run,ca(class extends la{constructor(){super(t)}run(i,n){return e(Oa(i),i,n)}})}function q(r){const e=r.run;return P({...r,run:(t,i,n)=>{const s=t.service.activeInstance;if(s)return e(s,t,i,n)}})}function xe(r){const e=r.run;return P({...r,run:(t,i,n)=>{const s=Tl.find(t.service.detachedXterms,a=>a.isFocused);if(s)return e(s,i,void 0,n);const o=t.service.activeInstance;if(o!=null&&o.xterm)return e(o.xterm,i,o,n)}})}function Oa(r){return{service:r.get(J),groupService:r.get(he),instanceService:r.get(He),editorService:r.get(Tt),profileService:r.get(tt),profileResolverService:r.get(vt)}}function Id(){P({id:"workbench.action.terminal.newInActiveWorkspace",title:{value:c("workbench.action.terminal.newInActiveWorkspace","Create New Terminal (In Active Workspace)"),original:"Create New Terminal (In Active Workspace)"},run:async r=>{if(r.service.isProcessSupportRegistered){const e=await r.service.createTerminal({location:r.service.defaultLocation});if(!e)return;r.service.setActiveInstance(e)}await r.groupService.showPanel(!0)}}),Ha([]),P({id:"workbench.action.createTerminalEditor",title:{value:c("workbench.action.terminal.createTerminalEditor","Create New Terminal in Editor Area"),original:"Create New Terminal in Editor Area"},run:async(r,e,t)=>{const i=lt(t)&&"location"in t?t:{location:A.Editor};(await r.service.createTerminal(i)).focusWhenReady()}}),P({id:"workbench.action.createTerminalEditorSameGroup",title:{value:c("workbench.action.terminal.createTerminalEditor","Create New Terminal in Editor Area"),original:"Create New Terminal in Editor Area"},f1:!1,run:async(r,e,t)=>{const i=e.get(Nr);(await r.service.createTerminal({location:{viewColumn:i.activeGroup.index}})).focusWhenReady()}}),P({id:"workbench.action.createTerminalEditorSide",title:{value:c("workbench.action.terminal.createTerminalEditorSide","Create New Terminal in Editor Area to the Side"),original:"Create New Terminal in Editor Area to the Side"},run:async r=>{(await r.service.createTerminal({location:{viewColumn:Nn}})).focusWhenReady()}}),q({id:"workbench.action.terminal.moveToEditor",title:x.moveToEditor,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.terminalEditorActive.toNegated(),u.viewShowing),run:(r,e)=>e.service.moveToEditor(r)}),P({id:"workbench.action.terminal.moveToEditorInstance",title:x.moveToEditor,f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),run:async(r,e)=>{const t=Ke(e);if(!(!t||t.length===0)){for(const i of t)r.service.moveToEditor(i);t[t.length-1].focus()}}}),P({id:"workbench.action.terminal.moveToTerminalPanel",title:x.moveToTerminalPanel,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.terminalEditorActive),run:(r,e,t)=>{const i=Ga(t)??r.editorService.activeInstance;i&&r.service.moveToTerminalView(i)}}),P({id:"workbench.action.terminal.showTabs",title:{value:c("workbench.action.terminal.showTabs","Show Tabs"),original:"Show Tabs"},f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.groupService.showTabs()}),P({id:"workbench.action.terminal.focusPreviousPane",title:{value:c("workbench.action.terminal.focusPreviousPane","Focus Previous Terminal in Terminal Group"),original:"Focus Previous Terminal in Terminal Group"},keybinding:{primary:527,secondary:[528],mac:{primary:2575,secondary:[2576]},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async r=>{var e;(e=r.groupService.activeGroup)==null||e.focusPreviousPane(),await r.groupService.showPanel(!0)}}),P({id:"workbench.action.terminal.focusNextPane",title:{value:c("workbench.action.terminal.focusNextPane","Focus Next Terminal in Terminal Group"),original:"Focus Next Terminal in Terminal Group"},keybinding:{primary:529,secondary:[530],mac:{primary:2577,secondary:[2578]},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async r=>{var e;(e=r.groupService.activeGroup)==null||e.focusNextPane(),await r.groupService.showPanel(!0)}}),q({id:"workbench.action.terminal.runRecentCommand",title:{value:c("workbench.action.terminal.runRecentCommand","Run Recent Command..."),original:"Run Recent Command..."},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:2096,mac:{primary:304},when:g.and(u.focus,Te),weight:200},{primary:2608,mac:{primary:816},when:g.and(u.focus,Te.negate()),weight:200}],run:async(r,e)=>{await r.runRecent("command"),(r==null?void 0:r.target)===A.Editor?await e.editorService.revealActiveEditor():await e.groupService.showPanel(!1)}}),q({id:"workbench.action.terminal.copyLastCommandOutput",title:{value:c("workbench.action.terminal.copyLastCommand","Copy Last Command Output"),original:"Copy Last Command Output"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e,t)=>{var a;const i=t.get($n),n=(a=r.capabilities.get(2))==null?void 0:a.commands;if(!n||n.length===0)return;const s=n[n.length-1];if(!(s!=null&&s.hasOutput()))return;const o=s.getOutput();Qt(o)&&await i.writeText(o)}}),q({id:"workbench.action.terminal.goToRecentDirectory",title:{value:c("workbench.action.terminal.goToRecentDirectory","Go to Recent Directory..."),original:"Go to Recent Directory..."},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:{primary:2085,when:u.focus,weight:200},run:async(r,e)=>{await r.runRecent("cwd"),(r==null?void 0:r.target)===A.Editor?await e.editorService.revealActiveEditor():await e.groupService.showPanel(!1)}}),P({id:"workbench.action.terminal.resizePaneLeft",title:{value:c("workbench.action.terminal.resizePaneLeft","Resize Terminal Left"),original:"Resize Terminal Left"},keybinding:{linux:{primary:3087},mac:{primary:2319},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeGroup)==null?void 0:e.resizePane(0)}}),P({id:"workbench.action.terminal.resizePaneRight",title:{value:c("workbench.action.terminal.resizePaneRight","Resize Terminal Right"),original:"Resize Terminal Right"},keybinding:{linux:{primary:3089},mac:{primary:2321},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeGroup)==null?void 0:e.resizePane(1)}}),P({id:"workbench.action.terminal.resizePaneUp",title:{value:c("workbench.action.terminal.resizePaneUp","Resize Terminal Up"),original:"Resize Terminal Up"},keybinding:{mac:{primary:2320},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeGroup)==null?void 0:e.resizePane(2)}}),P({id:"workbench.action.terminal.resizePaneDown",title:{value:c("workbench.action.terminal.resizePaneDown","Resize Terminal Down"),original:"Resize Terminal Down"},keybinding:{mac:{primary:2322},when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeGroup)==null?void 0:e.resizePane(3)}}),P({id:"workbench.action.terminal.focus",title:x.focus,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async r=>{const e=r.service.activeInstance||await r.service.createTerminal({location:A.Panel});if(e)return r.service.setActiveInstance(e),r.groupService.showPanel(!0)}}),P({id:"workbench.action.terminal.focusTabs",title:{value:c("workbench.action.terminal.focus.tabsView","Focus Terminal Tabs View"),original:"Focus Terminal Tabs View"},keybinding:{primary:3165,weight:200,when:g.or(u.tabsFocus,u.focus)},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.groupService.focusTabs()}),P({id:"workbench.action.terminal.focusNext",title:{value:c("workbench.action.terminal.focusNext","Focus Next Terminal Group"),original:"Focus Next Terminal Group"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:{primary:2060,mac:{primary:3166},when:g.and(u.focus,u.editorFocus.negate()),weight:200},run:async r=>{r.groupService.setActiveGroupToNext(),await r.groupService.showPanel(!0)}}),P({id:"workbench.action.terminal.focusPrevious",title:{value:c("workbench.action.terminal.focusPrevious","Focus Previous Terminal Group"),original:"Focus Previous Terminal Group"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:{primary:2059,mac:{primary:3164},when:g.and(u.focus,u.editorFocus.negate()),weight:200},run:async r=>{r.groupService.setActiveGroupToPrevious(),await r.groupService.showPanel(!0)}}),P({id:"workbench.action.terminal.runSelectedText",title:{value:c("workbench.action.terminal.runSelectedText","Run Selected Text In Active Terminal"),original:"Run Selected Text In Active Terminal"},run:async(r,e)=>{const i=e.get(_o).getActiveCodeEditor();if(!i||!i.hasModel())return;const n=await r.service.getActiveOrCreateInstance({acceptsInput:!0}),s=i.getSelection();let o;if(s.isEmpty())o=i.getModel().getLineContent(s.selectionStartLineNumber).trim();else{const a=re?1:2;o=i.getModel().getValueInRange(s,a)}n.sendText(o,!0,!0),await r.service.revealActiveTerminal()}}),P({id:"workbench.action.terminal.runActiveFile",title:{value:c("workbench.action.terminal.runActiveFile","Run Active File In Active Terminal"),original:"Run Active File In Active Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e)=>{const t=e.get(_o),i=e.get(se),n=e.get(si),s=t.getActiveCodeEditor();if(!s||!s.hasModel())return;const o=await r.service.getActiveOrCreateInstance({acceptsInput:!0}),a=o?o.isRemote:!!n.remoteAuthority,l=s.getModel().uri;if(!a&&l.scheme!==$.file&&l.scheme!==$.vscodeUserData||a&&l.scheme!==$.vscodeRemote){i.warn(c("workbench.action.terminal.runActiveFile.noFile","Only files on disk can be run in the terminal"));return}return await o.sendPath(l,!0),r.groupService.showPanel()}}),xe({id:"workbench.action.terminal.scrollDown",title:{value:c("workbench.action.terminal.scrollDown","Scroll Down (Line)"),original:"Scroll Down (Line)"},keybinding:{primary:2572,linux:{primary:3090},when:g.and(u.focusInAny,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollDownLine()}),xe({id:"workbench.action.terminal.scrollDownPage",title:{value:c("workbench.action.terminal.scrollDownPage","Scroll Down (Page)"),original:"Scroll Down (Page)"},keybinding:{primary:1036,mac:{primary:12},when:g.and(u.focusInAny,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollDownPage()}),xe({id:"workbench.action.terminal.scrollToBottom",title:{value:c("workbench.action.terminal.scrollToBottom","Scroll to Bottom"),original:"Scroll to Bottom"},keybinding:{primary:2061,linux:{primary:1037},when:g.and(u.focusInAny,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollToBottom()}),xe({id:"workbench.action.terminal.scrollUp",title:{value:c("workbench.action.terminal.scrollUp","Scroll Up (Line)"),original:"Scroll Up (Line)"},keybinding:{primary:2571,linux:{primary:3088},when:g.and(u.focusInAny,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollUpLine()}),xe({id:"workbench.action.terminal.scrollUpPage",title:{value:c("workbench.action.terminal.scrollUpPage","Scroll Up (Page)"),original:"Scroll Up (Page)"},f1:!0,category:Cn,keybinding:{primary:1035,mac:{primary:11},when:g.and(u.focusInAny,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollUpPage()}),xe({id:"workbench.action.terminal.scrollToTop",title:{value:c("workbench.action.terminal.scrollToTop","Scroll to Top"),original:"Scroll to Top"},keybinding:{primary:2062,linux:{primary:1038},when:g.and(u.focusInAny,u.altBufferActive.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>r.scrollToTop()}),xe({id:"workbench.action.terminal.clearSelection",title:{value:c("workbench.action.terminal.clearSelection","Clear Selection"),original:"Clear Selection"},keybinding:{primary:9,when:g.and(u.focusInAny,u.textSelected,u.notFindVisible),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{r.hasSelection()&&r.clearSelection()}}),P({id:"workbench.action.terminal.changeIcon",title:x.changeIcon,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e,t)=>{var i;return(i=Ls(r,t))==null?void 0:i.changeIcon()}}),P({id:"workbench.action.terminal.changeIconPanel",title:x.changeIcon,f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeInstance)==null?void 0:e.changeIcon()}}),P({id:"workbench.action.terminal.changeIconInstance",title:x.changeIcon,f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.tabsSingularSelection),run:(r,e)=>{var t;return(t=Ke(e))==null?void 0:t[0].changeIcon()}}),P({id:"workbench.action.terminal.changeColor",title:x.changeColor,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e,t)=>{var i;return(i=Ls(r,t))==null?void 0:i.changeColor()}}),P({id:"workbench.action.terminal.changeColorPanel",title:x.changeColor,f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.groupService.activeInstance)==null?void 0:e.changeColor()}}),P({id:"workbench.action.terminal.changeColorInstance",title:x.changeColor,f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.tabsSingularSelection),run:(r,e)=>{var t;return(t=Ke(e))==null?void 0:t[0].changeColor()}}),P({id:"workbench.action.terminal.rename",title:x.rename,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e,t)=>Io(r,e,t)}),P({id:"workbench.action.terminal.renamePanel",title:x.rename,f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e)=>Io(r,e)}),P({id:"workbench.action.terminal.renameInstance",title:x.rename,f1:!1,keybinding:{primary:60,mac:{primary:3},when:g.and(u.tabsFocus),weight:200},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.tabsSingularSelection),run:async(r,e)=>{var n;const t=e.get(se),i=(n=Ke(e))==null?void 0:n[0];i&&(r.service.setEditingTerminal(i),r.service.setEditable(i,{validationMessage:s=>kd(s),onFinish:async(s,o)=>{if(r.service.setEditable(i,null),r.service.setEditingTerminal(void 0),o)try{await i.rename(s)}catch(a){t.error(a)}}}))}}),q({id:"workbench.action.terminal.detachSession",title:{value:c("workbench.action.terminal.detachSession","Detach Session"),original:"Detach Session"},run:r=>r.detachProcessAndDispose(je.User)}),P({id:"workbench.action.terminal.attachToSession",title:{value:c("workbench.action.terminal.attachToSession","Attach to Session"),original:"Attach to Session"},run:async(r,e)=>{var v;const t=e.get(le),i=e.get($i),n=e.get(et),s=e.get(se),o=((v=n.getConnection())==null?void 0:v.remoteAuthority)??void 0,a=await e.get(He).getBackend(o);if(!a)throw new Error(`No backend registered for remote authority '${o}'`);const l=await a.listProcesses();a.reduceConnectionGraceTime();const m=l.filter(f=>!r.service.isAttachedToTerminal(f)).map(f=>{const _=i.getUriLabel(L.file(f.cwd));return{label:f.title,detail:f.workspaceName?`${f.workspaceName} ⸱ ${_}`:_,description:f.pid?String(f.pid):"",term:f}});if(m.length===0){s.info(c("noUnattachedTerminals","There are no unattached terminals to attach to"));return}const p=await t.pick(m,{canPickMany:!1});if(p){const f=await r.service.createTerminal({config:{attachPersistentProcess:p.term}});r.service.setActiveInstance(f),await ui(f,r)}}}),P({id:"workbench.action.quickOpenTerm",title:{value:c("quickAccessTerminal","Switch Active Terminal"),original:"Switch Active Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e)=>e.get(le).quickAccess.show(ei.PREFIX)}),q({id:"workbench.action.terminal.scrollToPreviousCommand",title:{value:c("workbench.action.terminal.scrollToPreviousCommand","Scroll To Previous Command"),original:"Scroll To Previous Command"},keybinding:{primary:2064,when:g.and(u.focus,Te.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;return(e=r.xterm)==null?void 0:e.markTracker.scrollToPreviousMark(void 0,void 0,r.capabilities.has(2))}}),q({id:"workbench.action.terminal.scrollToNextCommand",title:{value:c("workbench.action.terminal.scrollToNextCommand","Scroll To Next Command"),original:"Scroll To Next Command"},keybinding:{primary:2066,when:g.and(u.focus,Te.negate()),weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;(e=r.xterm)==null||e.markTracker.scrollToNextMark(),r.focus()}}),q({id:"workbench.action.terminal.selectToPreviousCommand",title:{value:c("workbench.action.terminal.selectToPreviousCommand","Select To Previous Command"),original:"Select To Previous Command"},keybinding:{primary:3088,when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;(e=r.xterm)==null||e.markTracker.selectToPreviousMark(),r.focus()}}),q({id:"workbench.action.terminal.selectToNextCommand",title:{value:c("workbench.action.terminal.selectToNextCommand","Select To Next Command"),original:"Select To Next Command"},keybinding:{primary:3090,when:u.focus,weight:200},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:r=>{var e;(e=r.xterm)==null||e.markTracker.selectToNextMark(),r.focus()}}),xe({id:"workbench.action.terminal.selectToPreviousLine",title:{value:c("workbench.action.terminal.selectToPreviousLine","Select To Previous Line"),original:"Select To Previous Line"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e,t)=>{r.markTracker.selectToPreviousLine(),(t||r).focus()}}),xe({id:"workbench.action.terminal.selectToNextLine",title:{value:c("workbench.action.terminal.selectToNextLine","Select To Next Line"),original:"Select To Next Line"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e,t)=>{r.markTracker.selectToNextLine(),(t||r).focus()}}),P({id:"workbench.action.terminal.sendSequence",title:x.sendSequence,f1:!1,description:{description:x.sendSequence.value,args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{description:c("sendSequence","The sequence of text to send to the terminal"),type:"string"}}}}]},run:(r,e,t)=>Ba(e,t)}),P({id:"workbench.action.terminal.newWithCwd",title:x.newWithCwd,description:{description:x.newWithCwd.value,args:[{name:"args",schema:{type:"object",required:["cwd"],properties:{cwd:{description:c("workbench.action.terminal.newWithCwd.cwd","The directory to start the terminal at"),type:"string"}}}}]},run:async(r,e,t)=>{const i=lt(t)&&"cwd"in t?nn(t.cwd):void 0,n=await r.service.createTerminal({cwd:i});n&&(r.service.setActiveInstance(n),await ui(n,r))}}),q({id:"workbench.action.terminal.renameWithArg",title:x.renameWithArgs,description:{description:x.renameWithArgs.value,args:[{name:"args",schema:{type:"object",required:["name"],properties:{name:{description:c("workbench.action.terminal.renameWithArg.name","The new name for the terminal"),type:"string",minLength:1}}}}]},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e,t,i)=>{const n=t.get(se),s=lt(i)&&"name"in i?nn(i.name):void 0;if(!s){n.warn(c("workbench.action.terminal.renameWithArg.noName","No name argument provided"));return}r.rename(s)}}),q({id:"workbench.action.terminal.relaunch",title:{value:c("workbench.action.terminal.relaunch","Relaunch Active Terminal"),original:"Relaunch Active Terminal"},run:r=>r.relaunch()}),P({id:"workbench.action.terminal.split",title:x.split,precondition:g.or(u.processSupported,u.webExtensionContributedProfile),keybinding:{primary:3098,weight:200,mac:{primary:2141,secondary:[1306]},when:u.focus},icon:k.splitHorizontal,run:async(r,e,t)=>{const i=lt(t)?t:void 0,n=e.get(pe),s=e.get(_e),o=Va(i),a=(await r.service.getInstanceHost(o==null?void 0:o.location)).activeInstance;if(!a)return;const l=await Na(r.service.configHelper,a,s.getWorkspace().folders,n);if(l===void 0)return;const h=await r.service.createTerminal({location:{parentTerminal:a},config:o==null?void 0:o.config,cwd:l});await ui(h,r)}}),P({id:"workbench.action.terminal.splitInstance",title:x.split,f1:!1,keybinding:{primary:3098,mac:{primary:2141,secondary:[1306]},weight:200,when:u.tabsFocus},run:async(r,e)=>{const t=Ke(e);if(t){const i=[];for(const n of t)i.push((async()=>{await r.service.createTerminal({location:{parentTerminal:n}}),await r.groupService.showPanel(!0)})());await Promise.all(i)}}}),q({id:"workbench.action.terminal.unsplit",title:x.unsplit,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e)=>e.groupService.unsplitInstance(r)}),P({id:"workbench.action.terminal.unsplitInstance",title:x.unsplit,f1:!1,precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e)=>{const t=Ke(e);if((t==null?void 0:t.length)===1){const i=r.groupService.getGroupForInstance(t[0]);i&&(i==null?void 0:i.terminalInstances.length)>1&&r.groupService.unsplitInstance(t[0])}}}),P({id:"workbench.action.terminal.joinInstance",title:{value:c("workbench.action.terminal.joinInstance","Join Terminals"),original:"Join Terminals"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.tabsSingularSelection.toNegated()),run:async(r,e)=>{const t=Ke(e);t&&t.length>1&&r.groupService.joinInstances(t)}}),P({id:"workbench.action.terminal.join",title:{value:c("workbench.action.terminal.join","Join Terminals"),original:"Join Terminals"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated)),run:async(r,e)=>{const t=e.get(de),i=e.get(se),n=e.get(le),s=[];if(r.groupService.instances.length<=1){i.warn(c("workbench.action.terminal.join.insufficientTerminals","Insufficient terminals for the join action"));return}const o=r.groupService.instances.filter(l=>{var h;return l.instanceId!==((h=r.groupService.activeInstance)==null?void 0:h.instanceId)});for(const l of o){const h=r.groupService.getGroupForInstance(l);if((h==null?void 0:h.terminalInstances.length)===1){const p=`$(${Wr(e,l)}): ${l.title}`,v=[],f=ut(l);f&&v.push(f);const _=Wt(l,t.getColorTheme().type);_&&v.push(..._),s.push({terminal:l,label:p,iconClasses:v})}}if(s.length===0){i.warn(c("workbench.action.terminal.join.onlySplits","All terminals are joined already"));return}const a=await n.pick(s,{});a&&r.groupService.joinInstances([a.terminal,r.groupService.activeInstance])}}),q({id:"workbench.action.terminal.splitInActiveWorkspace",title:{value:c("workbench.action.terminal.splitInActiveWorkspace","Split Terminal (In Active Workspace)"),original:"Split Terminal (In Active Workspace)"},run:async(r,e)=>{const t=await e.service.createTerminal({location:{parentTerminal:r}});(t==null?void 0:t.target)!==A.Editor&&await e.groupService.showPanel(!0)}}),xe({id:"workbench.action.terminal.selectAll",title:{value:c("workbench.action.terminal.selectAll","Select All"),original:"Select All"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:0,mac:{primary:2079},weight:200,when:u.focusInAny}],run:r=>r.selectAll()}),P({id:"workbench.action.terminal.new",title:{value:c("workbench.action.terminal.new","Create New Terminal"),original:"Create New Terminal"},precondition:g.or(u.processSupported,u.webExtensionContributedProfile),icon:rd,keybinding:{primary:3163,mac:{primary:1371},weight:200},run:async(r,e,t)=>{var a;let i=lt(t)?t:void 0;const n=e.get(_e),s=e.get(pe),o=n.getWorkspace().folders;if(i&&i instanceof MouseEvent&&(i.altKey||i.ctrlKey)){await r.service.createTerminal({location:{splitActiveTerminal:!0}});return}if(r.service.isProcessSupportRegistered){i=!i||i instanceof MouseEvent?{}:i;let l;if(o.length<=1)l=await r.service.createTerminal(i);else{const h=(a=await Td(e))==null?void 0:a.cwd;if(!h)return;i.cwd=h,l=await r.service.createTerminal(i)}r.service.setActiveInstance(l),await ui(l,r)}else r.profileService.contributedProfiles.length>0?s.executeCommand("workbench.action.terminal.newWithProfile"):s.executeCommand("workbench.action.terminal.toggleTerminal")}}),P({id:"workbench.action.terminal.kill",title:{value:c("workbench.action.terminal.kill","Kill the Active Terminal Instance"),original:"Kill the Active Terminal Instance"},precondition:g.or(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),icon:Ea,run:async r=>{const e=r.groupService.activeInstance;e&&(await r.service.safeDisposeTerminal(e),r.groupService.instances.length>0&&await r.groupService.showPanel(!0))}}),P({id:"workbench.action.terminal.killAll",title:{value:c("workbench.action.terminal.killAll","Kill All Terminals"),original:"Kill All Terminals"},precondition:g.or(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),icon:k.trash,run:async r=>{const e=[];for(const t of r.service.instances)e.push(r.service.safeDisposeTerminal(t));await Promise.all(e)}}),P({id:"workbench.action.terminal.killEditor",title:{value:c("workbench.action.terminal.killEditor","Kill the Active Terminal in Editor Area"),original:"Kill the Active Terminal in Editor Area"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:{primary:2101,win:{primary:2110,secondary:[2101]},weight:200,when:g.and(u.focus,Ct.Scheme.isEqualTo($.vscodeTerminal),u.editorFocus)},run:(r,e)=>e.get(pe).executeCommand(lc)}),P({id:"workbench.action.terminal.killInstance",title:x.kill,f1:!1,precondition:g.or(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),keybinding:{primary:20,mac:{primary:2049,secondary:[20]},weight:200,when:u.tabsFocus},run:async(r,e)=>{var s;const t=Ke(e);if(!t)return;const i=e.get(zn),n=[];for(const o of t)n.push(r.service.safeDisposeTerminal(o));await Promise.all(n),r.service.instances.length>0&&(r.groupService.focusTabs(),(s=i.lastFocusedList)==null||s.focusNext())}}),P({id:"workbench.action.terminal.focusHover",title:x.focusHover,precondition:g.or(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),keybinding:{primary:Cl(2089,2087),weight:200,when:g.or(u.tabsFocus,u.focus)},run:r=>r.groupService.focusHover()}),q({id:"workbench.action.terminal.clear",title:{value:c("workbench.action.terminal.clear","Clear"),original:"Clear"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:0,mac:{primary:2089},weight:200+1,when:g.and(u.focus,Te.negate())}],run:r=>r.clearBuffer()}),P({id:"workbench.action.terminal.selectDefaultShell",title:{value:c("workbench.action.terminal.selectDefaultShell","Select Default Profile"),original:"Select Default Profile"},run:r=>r.service.showProfileQuickPick("setDefault")}),P({id:"workbench.action.terminal.openSettings",title:{value:c("workbench.action.terminal.openSettings","Configure Terminal Settings"),original:"Configure Terminal Settings"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:(r,e)=>e.get(Br).openSettings({jsonEditor:!1,query:"@feature:terminal"})}),q({id:"workbench.action.terminal.setDimensions",title:{value:c("workbench.action.terminal.setFixedDimensions","Set Fixed Dimensions"),original:"Set Fixed Dimensions"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),run:r=>r.setFixedDimensions()}),q({id:"workbench.action.terminal.sizeToContentWidth",title:{value:c("workbench.action.terminal.sizeToContentWidth","Toggle Size to Content Width"),original:"Toggle Size to Content Width"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.isOpen),keybinding:{primary:568,weight:200,when:u.focus},run:r=>r.toggleSizeToContentWidth()}),P({id:"workbench.action.terminal.sizeToContentWidthInstance",title:x.toggleSizeToContentWidth,f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus),run:(r,e)=>{var t;return(t=Ke(e))==null?void 0:t[0].toggleSizeToContentWidth()}}),P({id:"workbench.action.terminal.clearPreviousSessionHistory",title:{value:c("workbench.action.terminal.clearPreviousSessionHistory","Clear Previous Session History"),original:"Clear Previous Session History"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e)=>{wn(e).clear(),vd()}}),q({id:"workbench.action.terminal.selectPrevSuggestion",title:{value:c("workbench.action.terminal.selectPrevSuggestion","Select the Previous Suggestion"),original:"Select the Previous Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:16,weight:200+1},run:r=>r.selectPreviousSuggestion()}),q({id:"workbench.action.terminal.selectPrevPageSuggestion",title:{value:c("workbench.action.terminal.selectPrevPageSuggestion","Select the Previous Page Suggestion"),original:"Select the Previous Page Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:11,weight:200+1},run:r=>r.selectPreviousPageSuggestion()}),q({id:"workbench.action.terminal.selectNextSuggestion",title:{value:c("workbench.action.terminal.selectNextSuggestion","Select the Next Suggestion"),original:"Select the Next Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:18,weight:200+1},run:r=>r.selectNextSuggestion()}),q({id:"workbench.action.terminal.selectNextPageSuggestion",title:{value:c("workbench.action.terminal.selectNextPageSuggestion","Select the Next Page Suggestion"),original:"Select the Next Page Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:12,weight:200+1},run:r=>r.selectNextPageSuggestion()}),q({id:"workbench.action.terminal.acceptSelectedSuggestion",title:{value:c("workbench.action.terminal.acceptSelectedSuggestion","Accept Selected Suggestion"),original:"Accept Selected Suggestion"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:3,secondary:[2],weight:200+1},run:r=>r.acceptSelectedSuggestion()}),q({id:"workbench.action.terminal.hideSuggestWidget",title:{value:c("workbench.action.terminal.hideSuggestWidget","Hide Suggest Widget"),original:"Hide Suggest Widget"},f1:!1,precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.focus,u.isOpen,u.suggestWidgetVisible),keybinding:{primary:9,weight:200+1},run:r=>r.hideSuggestWidget()}),Ut.clipboard.writeText&&(xe({id:"workbench.action.terminal.copySelection",title:{value:c("workbench.action.terminal.copySelection","Copy Selection"),original:"Copy Selection"},precondition:g.or(u.textSelectedInFocused,g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.textSelected)),keybinding:[{primary:3105,mac:{primary:2081},weight:200,when:g.or(g.and(u.textSelected,u.focus),u.textSelectedInFocused)}],run:r=>r.copySelection()}),xe({id:"workbench.action.terminal.copyAndClearSelection",title:{value:c("workbench.action.terminal.copyAndClearSelection","Copy and Clear Selection"),original:"Copy and Clear Selection"},precondition:g.or(u.textSelectedInFocused,g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.textSelected)),keybinding:[{win:{primary:2081},weight:200,when:g.or(g.and(u.textSelected,u.focus),u.textSelectedInFocused)}],run:async r=>{await r.copySelection(),r.clearSelection()}}),xe({id:"workbench.action.terminal.copySelectionAsHtml",title:{value:c("workbench.action.terminal.copySelectionAsHtml","Copy Selection as HTML"),original:"Copy Selection as HTML"},f1:!0,category:Cn,precondition:g.or(u.textSelectedInFocused,g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.textSelected)),run:r=>r.copySelection(!0)})),Ut.clipboard.readText&&q({id:"workbench.action.terminal.paste",title:{value:c("workbench.action.terminal.paste","Paste into Active Terminal"),original:"Paste into Active Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:2100,win:{primary:2100,secondary:[3124]},linux:{primary:3124},weight:200,when:u.focus}],run:r=>r.paste()}),Ut.clipboard.readText&&Kn&&q({id:"workbench.action.terminal.pasteSelection",title:{value:c("workbench.action.terminal.pasteSelection","Paste Selection into Active Terminal"),original:"Paste Selection into Active Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{linux:{primary:1043},weight:200,when:u.focus}],run:r=>r.pasteSelection()}),P({id:"workbench.action.terminal.switchTerminal",title:{value:c("workbench.action.terminal.switchTerminal","Switch Terminal"),original:"Switch Terminal"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),run:async(r,e,t)=>{const i=nn(t);if(!i)return;if(i===Fa){r.service.refreshActiveGroup();return}if(i===Wa){e.get(X).updateValue("terminal.integrated.tabs.enabled",!0);return}const s=/^([0-9]+): /.exec(i);if(s)return r.groupService.setActiveGroupByIndex(Number(s[1])-1),r.groupService.showPanel(!0);const o=r.profileService.availableProfiles,a=i.substring(4);if(o){const l=o.find(h=>h.profileName===a);if(l){const h=await r.service.createTerminal({config:l});r.service.setActiveInstance(h)}else console.warn(`No profile with name "${a}"`)}else console.warn(`Unmatched terminal item: "${i}"`)}})}function Ke(r){var o;const e=r.get(zn),t=r.get(J);if(!((o=e.lastFocusedList)!=null&&o.getSelection()))return;const i=e.lastFocusedList.getSelection(),n=e.lastFocusedList.getFocus(),s=[];if(n.length===1&&!i.includes(n[0]))return s.push(t.getInstanceFromIndex(n[0])),s;for(const a of i)s.push(t.getInstanceFromIndex(a));return s}function kd(r){return!r||r.trim().length===0?{content:c("emptyTerminalNameInfo","Providing no name will reset it to the default value"),severity:ne.Info}:null}function Va(r){return lt(r)&&"profileName"in r?{config:r,location:r.location}:r}let Qi;function Ha(r){const e=Ra(r);Qi==null||Qi.dispose(),Qi=ca(class extends la{constructor(){super({id:"workbench.action.terminal.newWithProfile",title:{value:c("workbench.action.terminal.newWithProfile","Create New Terminal (With Profile)"),original:"Create New Terminal (With Profile)"},f1:!0,category:Cn,precondition:g.or(u.processSupported,u.webExtensionContributedProfile),description:{description:"workbench.action.terminal.newWithProfile",args:[{name:"args",schema:{type:"object",required:["profileName"],properties:{profileName:{description:c("workbench.action.terminal.newWithProfile.profileName","The name of the profile to create"),type:"string",enum:e.values,markdownEnumDescriptions:e.markdownDescriptions}}}}]}})}async run(t,i,n){const s=Oa(t),o=t.get(_e),a=t.get(pe);let l,h,m,p;if(lt(i)&&i&&"profileName"in i){const f=s.profileService.availableProfiles.find(_=>_.profileName===i.profileName);if(!f)throw new Error(`Could not find terminal profile "${i.profileName}"`);h={config:f}}else i instanceof MouseEvent||i instanceof PointerEvent||i instanceof KeyboardEvent?(l=i,h=n?{config:n}:void 0):h=Va(i);if(l&&(l.altKey||l.ctrlKey)){const f=s.service.activeInstance;if(f){await s.service.createTerminal({location:{parentTerminal:f},config:h==null?void 0:h.config});return}}if(o.getWorkspace().folders.length>1){const f={placeHolder:c("workbench.action.terminal.newWorkspacePlaceholder","Select current working directory for new terminal")},_=await a.executeCommand(Or,[f]);if(!_)return;p=_.uri}h?(h.cwd=p,m=await s.service.createTerminal(h)):m=await s.service.showProfileQuickPick("createInstance",p),m&&(s.service.setActiveInstance(m),await ui(m,s))}})}function Ls(r,e){return r.service.getInstanceFromResource(Ga(e))||r.service.activeInstance}async function Td(r,e){const t=r.get(le),i=r.get($i),n=r.get(_e),s=r.get(Un),o=r.get(yl),a=r.get(X),l=r.get(Bn),h=n.getWorkspace().folders;if(!h.length)return;const m=await Promise.all(h.map(y=>Dd(y,a,l))),p=Pd(m);if(p.length===1)return p[0];const v=p.map(y=>{const M=y.folder.name,D=y.isOverridden?c("workbench.action.terminal.overriddenCwdDescription","(Overriden) {0}",i.getUriLabel(y.cwd,{relative:!y.isAbsolute})):i.getUriLabel(xl(y.cwd),{relative:!0});return{label:M,description:D!==M?D:void 0,pair:y,iconClasses:Il(s,o,y.cwd,kl.ROOT_FOLDER)}}),f={placeHolder:c("workbench.action.terminal.newWorkspacePlaceholder","Select current working directory for new terminal"),matchOnDescription:!0,canPickMany:!1},_=e||oi.None,S=await t.pick(v,f,_);return S==null?void 0:S.pair}async function Dd(r,e,t){const i=e.getValue("terminal.integrated.cwd",{resource:r.uri});if(!Qt(i)||i.length===0)return{folder:r,cwd:r.uri,isAbsolute:!1,isOverridden:!1};const n=await t.resolveAsync(r,i);return ha(n)||n.startsWith(hc.VARIABLE_LHS)?{folder:r,isAbsolute:!0,isOverridden:!0,cwd:L.from({scheme:r.uri.scheme,path:n})}:{folder:r,isAbsolute:!1,isOverridden:!0,cwd:L.joinPath(r.uri,n)}}function Pd(r){const e=new Map;for(const n of r){const s=n.cwd.toString();(!e.get(s)||s===n.folder.uri.toString())&&e.set(s,n)}const t=new Set(e.values());return r.filter(n=>t.has(n))}async function ui(r,e){r.target===A.Editor?(await e.editorService.revealActiveEditor(),await r.focusWhenReady(!0)):await e.groupService.showPanel(!0)}async function Io(r,e,t){const i=Ls(r,t);if(i){const n=await e.get(le).input({value:i.title,prompt:c("workbench.action.terminal.rename.prompt","Enter terminal name")});i.rename(n)}}function Ga(r){return L.isUri(r)?r:void 0}function nn(r){return Qt(r)?r:void 0}var Ad='.monaco-action-bar .action-item .action-label.extension-action{line-height:normal;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.monaco-action-bar .action-dropdown-item>.action-label.extension-action.label,.monaco-action-bar .action-item>.action-label.extension-action.label{padding:0 5px}.monaco-action-bar .action-dropdown-item>.monaco-dropdown .action-label{padding:0}.monaco-action-bar .action-item .action-label.extension-action.label{outline-offset:1px}.monaco-action-bar .action-dropdown-item .action-label.extension-action.label,.monaco-action-bar .action-item .action-label.extension-action.label,.monaco-action-bar .action-item .action-label.extension-action.text{height:auto;line-height:14px;width:auto}.monaco-action-bar .action-item .action-label.extension-action.built-in-status{border-color:var(--vscode-foreground)}.monaco-action-bar .action-item .action-label.extension-action.label,.monaco-action-bar .action-item.action-dropdown-item>.action-dropdown-item-separator{background-color:var(--vscode-extensionButton-background)!important}.monaco-action-bar .action-item .action-label.extension-action.label{color:var(--vscode-extensionButton-foreground)!important}.monaco-action-bar .action-item .action-label.extension-action.label:hover{background-color:var(--vscode-extensionButton-hoverBackground)!important}.monaco-action-bar .action-item.action-dropdown-item>.action-dropdown-item-separator>div{background-color:var(--vscode-extensionButton-separator)}.monaco-action-bar .action-item .action-label.extension-action.label.prominent,.monaco-action-bar .action-item.action-dropdown-item>.action-dropdown-item-separator.prominent{background-color:var(--vscode-extensionButton-prominentBackground)}.monaco-action-bar .action-item .action-label.extension-action.label.prominent{color:var(--vscode-extensionButton-prominentForeground)!important}.monaco-action-bar .action-item .action-label.extension-action.label.prominent:hover{background-color:var(--vscode-extensionButton-prominentHoverBackground)}.monaco-action-bar .action-item .action-label.extension-action:not(.disabled){border:1px solid var(--vscode-contrastBorder)}.monaco-action-bar .action-item.action-dropdown-item>.action-dropdown-item-separator{border-bottom:1px solid var(--vscode-contrastBorder);border-top:1px solid var(--vscode-contrastBorder)}.monaco-action-bar .action-item .action-label.extension-action.extension-status-error{color:var(--vscode-editorError-foreground)}.monaco-action-bar .action-item .action-label.extension-action.extension-status-warning{color:var(--vscode-editorWarning-foreground)}.monaco-action-bar .action-item .action-label.extension-action.extension-status-info{color:var(--vscode-editorInfo-foreground)}.monaco-action-bar .action-dropdown-item .action-label.extension-action.label,.monaco-action-bar .action-item .action-label.extension-action.icon,.monaco-action-bar .action-item:not(.disabled) .action-label.extension-action.label,.monaco-action-bar .action-item:not(.disabled) .action-label.extension-action.text{margin-top:2px}.monaco-action-bar .action-item .action-label.extension-action.manage.hide,.monaco-action-bar .action-item.action-dropdown-item .action-label.extension-action.hide,.monaco-action-bar .action-item.action-dropdown-item.disabled,.monaco-action-bar .action-item.disabled .action-label.disable-status.hide,.monaco-action-bar .action-item.disabled .action-label.extension-action.extension-sync,.monaco-action-bar .action-item.disabled .action-label.extension-action.hide,.monaco-action-bar .action-item.disabled .action-label.extension-action.hide-when-disabled,.monaco-action-bar .action-item.disabled .action-label.extension-action.ignore,.monaco-action-bar .action-item.disabled .action-label.extension-action.install:not(.installing),.monaco-action-bar .action-item.disabled .action-label.extension-action.language,.monaco-action-bar .action-item.disabled .action-label.extension-action.migrate,.monaco-action-bar .action-item.disabled .action-label.extension-action.reload,.monaco-action-bar .action-item.disabled .action-label.extension-action.theme,.monaco-action-bar .action-item.disabled .action-label.extension-action.undo-ignore,.monaco-action-bar .action-item.disabled .action-label.extension-action.uninstall:not(.uninstalling),.monaco-action-bar .action-item.disabled .action-label.extension-action.update,.monaco-action-bar .action-item.disabled .action-label.extension-status-label.hide,.monaco-action-bar .action-item.disabled .action-label.extension-status.hide{display:none}.monaco-action-bar .extension-action.label{display:inherit}.monaco-action-bar .action-item.disabled .action-label.extension-status:before{opacity:1}.monaco-action-bar .action-item.disabled .action-label.extension-status-label:before{content:"\\2713";padding-right:4px}.monaco-action-bar .action-item.disabled .action-label.extension-action{opacity:1}.monaco-action-bar .action-item.disabled .action-label.extension-action.text{font-style:italic;opacity:.9}';ri(Ad,{});const ko=["{","	// See https://go.microsoft.com/fwlink/?LinkId=827846 to learn about workspace recommendations.","	// Extension identifier format: ${publisher}.${name}. Example: vscode.csharp","","	// List of extensions which should be recommended for users of this workspace.",'	"recommendations": [',"		","	],","	// List of extensions recommended by VS Code that should not be recommended for users of this workspace.",'	"unwantedRecommendations": [',"		","	]","}"].join(`
`),Ed=Ur("extensionRecommendationsService"),Qr=Ur("IExtensionIgnoredRecommendationsService"),$a=".vscode/extensions.json",Ld=Ur("localizationService");let ti=class extends j{constructor(e,t,i,n,s,o,a,l,h,m,p,v,f,_,S){super("extension.promptExtensionInstallFailure"),this.extension=e,this.version=t,this.installOperation=i,this.installOptions=n,this.error=s,this.productService=o,this.openerService=a,this.notificationService=l,this.dialogService=h,this.commandService=m,this.logService=p,this.extensionManagementServerService=v,this.instantiationService=f,this.galleryService=_,this.extensionManifestPropertiesService=S}async run(){if(Fl(this.error))return;if(this.logService.error(this.error),this.error.name===rt.Unsupported){const s=Jt?c("VS Code for Web","{0} for the Web",this.productService.nameLong):this.productService.nameLong,o=c("cannot be installed","The '{0}' extension is not available in {1}. Click 'More Information' to learn more.",this.extension.displayName||this.extension.identifier.id,s),{confirmed:a}=await this.dialogService.confirm({type:ne.Info,message:o,primaryButton:c({key:"more information",comment:["&& denotes a mnemonic"]},"&&More Information"),cancelButton:c("close","Close")});a&&this.openerService.open(Jt?L.parse("https://aka.ms/vscode-web-extensions-guide"):L.parse("https://aka.ms/vscode-remote"));return}if([rt.Incompatible,rt.IncompatibleTargetPlatform,rt.Malicious,rt.ReleaseVersionNotFound,rt.Deprecated].includes(this.error.name)){await this.dialogService.info(vo(this.error));return}if(rt.Signature===this.error.name){await this.dialogService.prompt({type:"error",message:c("signature verification failed","{0} cannot verify the '{1}' extension. Are you sure you want to install it?",this.productService.nameLong,this.extension.displayName||this.extension.identifier.id),buttons:[{label:c("install anyway","Install Anyway"),run:()=>{const s=this.instantiationService.createInstance(Si,{donotVerifySignature:!0});return s.extension=this.extension,s.run()}}],cancelButton:c("cancel","Cancel")});return}let e=this.installOperation===3?c("update operation","Error while updating '{0}' extension.",this.extension.displayName||this.extension.identifier.id):c("install operation","Error while installing '{0}' extension.",this.extension.displayName||this.extension.identifier.id),t;const i=[];if(rt.IncompatiblePreRelease===this.error.name)e=vo(this.error),t=c("install release version message","Would you like to install the release version?"),i.push({label:c("install release version","Install Release Version"),run:()=>{var o;const s=this.instantiationService.createInstance(Si,{installPreReleaseVersion:!!((o=this.installOptions)!=null&&o.installPreReleaseVersion)});return s.extension=this.extension,s.run()}});else{const s=await this.getDownloadUrl();s&&(t=c("check logs","Please check the [log]({0}) for more details.",`command:${td}`),i.push({label:c("download","Try Downloading Manually..."),run:()=>this.openerService.open(s).then(()=>{this.notificationService.prompt(ne.Info,c("install vsix","Once downloaded, please manually install the downloaded VSIX of '{0}'.",this.extension.identifier.id),[{label:c("installVSIX","Install from VSIX..."),run:()=>this.commandService.executeCommand(uc)}])})}))}const n=`${e}${t?` ${t}`:""}`;this.notificationService.prompt(ne.Error,n,i)}async getDownloadUrl(){if(da||!this.extension.gallery||!this.productService.extensionsGallery||!this.extensionManagementServerService.localExtensionManagementServer&&!this.extensionManagementServerService.remoteExtensionManagementServer)return;let e=this.extension.gallery.properties.targetPlatform;if(e!=="universal"&&e!=="undefined"&&this.extensionManagementServerService.remoteExtensionManagementServer)try{const t=await this.galleryService.getManifest(this.extension.gallery,oi.None);t&&this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(t)&&(e=await this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.getTargetPlatform())}catch(t){this.logService.error(t);return}if(e!=="unknown")return L.parse(`${this.productService.extensionsGallery.serviceUrl}/publishers/${this.extension.publisher}/vsextensions/${this.extension.name}/${this.version}/vspackage${e!=="undefined"?`?targetPlatform=${e}`:""}`)}};ti=w([d(5,Fi),d(6,Gi),d(7,se),d(8,Wi),d(9,pe),d(10,Dl),d(11,Ni),d(12,B),d(13,jo),d(14,Vr)],ti);class T extends j{constructor(){super(...arguments),this._extension=null}get extension(){return this._extension}set extension(e){this._extension=e,this.update()}}T.EXTENSION_ACTION_CLASS="extension-action";T.TEXT_ACTION_CLASS=`${T.EXTENSION_ACTION_CLASS} text`;T.LABEL_ACTION_CLASS=`${T.EXTENSION_ACTION_CLASS} label`;T.ICON_ACTION_CLASS=`${T.EXTENSION_ACTION_CLASS} icon`;let Si=class za extends T{set manifest(e){this._manifest=e,this.updateLabel()}constructor(e,t,i,n,s,o,a,l,h){super("extensions.install",c("install","Install"),za.Class,!1),this.extensionsWorkbenchService=t,this.instantiationService=i,this.runtimeExtensionService=n,this.workbenchThemeService=s,this.labelService=o,this.dialogService=a,this.preferencesService=l,this.telemetryService=h,this._manifest=null,this.updateThrottler=new qr,this.options={...e,isMachineScoped:!1},this.update(),this._register(this.labelService.onDidChangeFormatters(()=>this.updateLabel(),this))}update(){this.updateThrottler.queue(()=>this.computeAndUpdateEnablement())}async computeAndUpdateEnablement(){this.enabled=!1,this.extension&&(this.extension.isBuiltin||this.extensionsWorkbenchService.canSetLanguage(this.extension)||this.extension.state===3&&await this.extensionsWorkbenchService.canInstall(this.extension)&&(this.enabled=this.options.installPreReleaseVersion?this.extension.hasPreReleaseVersion:this.extension.hasReleaseVersion,this.updateLabel()))}async run(){if(!this.extension)return;if(this.extension.deprecationInfo){let t=c("deprecated message","This extension is deprecated as it is no longer being maintained."),i;(function(o){o[o.InstallAnyway=0]="InstallAnyway",o[o.ShowAlternateExtension=1]="ShowAlternateExtension",o[o.ConfigureSettings=2]="ConfigureSettings",o[o.Cancel=3]="Cancel"})(i||(i={}));const n=[{label:c("install anyway","Install Anyway"),run:()=>i.InstallAnyway}];if(this.extension.deprecationInfo.extension){t=c("deprecated with alternate extension message","This extension is deprecated. Use the {0} extension instead.",this.extension.deprecationInfo.extension.displayName);const o=this.extension.deprecationInfo.extension;n.push({label:c({key:"Show alternate extension",comment:["&& denotes a mnemonic"]},"&&Open {0}",this.extension.deprecationInfo.extension.displayName),run:async()=>{const[a]=await this.extensionsWorkbenchService.getExtensions([{id:o.id,preRelease:o.preRelease}],oi.None);return await this.extensionsWorkbenchService.open(a),i.ShowAlternateExtension}})}else if(this.extension.deprecationInfo.settings){t=c("deprecated with alternate settings message","This extension is deprecated as this functionality is now built-in to VS Code.");const o=this.extension.deprecationInfo.settings;n.push({label:c({key:"configure in settings",comment:["&& denotes a mnemonic"]},"&&Configure Settings"),run:async()=>(await this.preferencesService.openSettings({query:o.map(a=>`@id:${a}`).join(" ")}),i.ConfigureSettings)})}else this.extension.deprecationInfo.additionalInfo&&(t=new V(`${t} ${this.extension.deprecationInfo.additionalInfo}`));const{result:s}=await this.dialogService.prompt({type:ne.Warning,message:c("install confirmation","Are you sure you want to install '{0}'?",this.extension.displayName),detail:Qt(t)?t:void 0,custom:Qt(t)?void 0:{markdownDetails:[{markdown:t}]},buttons:n,cancelButton:{run:()=>i.Cancel}});if(s!==i.InstallAnyway)return}this.extensionsWorkbenchService.open(this.extension,{showPreReleaseVersion:this.options.installPreReleaseVersion}),Dt(c("installExtensionStart","Installing extension {0} started. An editor is now open with more details on this extension",this.extension.displayName)),this.telemetryService.publicLog("extensions:action:install",{...this.extension.telemetryData,actionId:this.id});const e=await this.install(this.extension);if(e!=null&&e.local){Dt(c("installExtensionComplete","Installing extension {0} is completed.",this.extension.displayName));const t=await this.getRunningExtension(e.local);if(t&&!(t.activationEvents&&t.activationEvents.some(i=>i.startsWith("onLanguage")))){const i=await this.getThemeAction(e);if(i){i.extension=e;try{return i.run({showCurrentTheme:!0,ignoreFocusLost:!0})}finally{i.dispose()}}}}}async getThemeAction(e){if((await this.workbenchThemeService.getColorThemes()).some(s=>Ve(s,e)))return this.instantiationService.createInstance(gt);if((await this.workbenchThemeService.getFileIconThemes()).some(s=>Ve(s,e)))return this.instantiationService.createInstance(pt);if((await this.workbenchThemeService.getProductIconThemes()).some(s=>Ve(s,e)))return this.instantiationService.createInstance(ft)}async install(e){try{return await this.extensionsWorkbenchService.install(e,this.options)}catch(t){await this.instantiationService.createInstance(ti,e,e.latestVersion,2,this.options,t).run();return}}async getRunningExtension(e){const t=await this.runtimeExtensionService.getExtension(e.identifier.id);return t||(this.runtimeExtensionService.canAddExtension(un(e))?new Promise((i,n)=>{const s=this.runtimeExtensionService.onDidChangeExtensions(async()=>{const o=await this.runtimeExtensionService.getExtension(e.identifier.id);o&&(s.dispose(),i(o))})}):null)}updateLabel(){this.label=this.getLabel()}getLabel(e){var t,i;return this.options.installPreReleaseVersion&&((t=this.extension)!=null&&t.hasPreReleaseVersion)?e?c("install pre-release","Install Pre-Release"):c("install pre-release version","Install Pre-Release Version"):(i=this.extension)!=null&&i.hasPreReleaseVersion?e?c("install","Install"):c("install release version","Install Release Version"):c("install","Install")}};Si.Class=`${T.LABEL_ACTION_CLASS} prominent install`;Si=w([d(1,te),d(2,B),d(3,ue),d(4,Bi),d(5,$i),d(6,Wi),d(7,Br),d(8,ai)],Si);class Yt extends T{constructor(){super("extension.installing",Yt.LABEL,Yt.CLASS,!1)}update(){this.class=`${Yt.CLASS}${this.extension&&this.extension.state===0?"":" hide"}`}}Yt.LABEL=c("installing","Installing");Yt.CLASS=`${T.LABEL_ACTION_CLASS} install installing`;let ii=class Ot extends T{constructor(e,t,i,n,s,o){super(e,Ot.INSTALL_LABEL,Ot.Class,!1),this.server=t,this.canInstallAnyWhere=i,this.extensionsWorkbenchService=n,this.extensionManagementServerService=s,this.extensionManifestPropertiesService=o,this.updateWhenCounterExtensionChanges=!0,this.update()}update(){if(this.enabled=!1,this.class=Ot.Class,this.canInstall()){const e=this.extensionsWorkbenchService.installed.filter(t=>Fe(t.identifier,this.extension.identifier)&&t.server===this.server)[0];e?e.state===0&&!e.local&&(this.enabled=!0,this.label=Ot.INSTALLING_LABEL,this.class=Ot.InstallingClass):(this.enabled=!0,this.label=this.getInstallLabel())}}canInstall(){return!this.extension||!this.server||!this.extension.local||this.extension.state!==1||this.extension.type!==1||this.extension.enablementState===2||this.extension.enablementState===0||this.extension.enablementState===4?!1:!!(ua(this.extension.local.manifest)||this.server===this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)||this.server===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)||this.server===this.extensionManagementServerService.webExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnWeb(this.extension.local.manifest)||this.canInstallAnyWhere&&(this.server===this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManifestPropertiesService.canExecuteOnUI(this.extension.local.manifest)||this.server===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManifestPropertiesService.canExecuteOnWorkspace(this.extension.local.manifest)))}async run(){var e,t;if((e=this.extension)!=null&&e.local&&(t=this.extension)!=null&&t.server&&this.server)return this.extensionsWorkbenchService.open(this.extension),Dt(c("installExtensionStart","Installing extension {0} started. An editor is now open with more details on this extension",this.extension.displayName)),this.extensionsWorkbenchService.installInServer(this.extension,this.server)}};ii.INSTALL_LABEL=c("install","Install");ii.INSTALLING_LABEL=c("installing","Installing");ii.Class=`${T.LABEL_ACTION_CLASS} prominent install`;ii.InstallingClass=`${T.LABEL_ACTION_CLASS} install installing`;ii=w([d(3,te),d(4,Ni),d(5,Vr)],ii);let Et=class at extends T{constructor(e){super("extensions.uninstall",at.UninstallLabel,at.UninstallClass,!1),this.extensionsWorkbenchService=e,this.update()}update(){if(!this.extension){this.enabled=!1;return}const e=this.extension.state;if(e===2){this.label=at.UninstallingLabel,this.class=at.UnInstallingClass,this.enabled=!1;return}if(this.label=at.UninstallLabel,this.class=at.UninstallClass,this.tooltip=at.UninstallLabel,e!==1){this.enabled=!1;return}if(this.extension.isBuiltin){this.enabled=!1;return}this.enabled=!0}async run(){if(this.extension)return Dt(c("uninstallExtensionStart","Uninstalling extension {0} started.",this.extension.displayName)),this.extensionsWorkbenchService.uninstall(this.extension).then(()=>{Dt(c("uninstallExtensionComplete","Please reload Visual Studio Code to complete the uninstallation of the extension {0}.",this.extension.displayName))})}};Et.UninstallLabel=c("uninstallAction","Uninstall");Et.UninstallingLabel=c("Uninstalling","Uninstalling");Et.UninstallClass=`${T.LABEL_ACTION_CLASS} uninstall`;Et.UnInstallingClass=`${T.LABEL_ACTION_CLASS} uninstall uninstalling`;Et=w([d(0,te)],Et);class dt extends T{constructor(e,t,i){super(e,t,dt.DisabledClass,!1),this.extensionsWorkbenchService=i,this.updateThrottler=new qr,this.update()}update(){this.updateThrottler.queue(()=>this.computeAndUpdateEnablement())}async computeAndUpdateEnablement(){if(this.enabled=!1,this.class=Rs.DisabledClass,!this.extension||this.extension.deprecationInfo)return;const e=await this.extensionsWorkbenchService.canInstall(this.extension),t=this.extension.state===1;this.enabled=e&&t&&this.extension.outdated,this.class=this.enabled?dt.EnabledClass:dt.DisabledClass}}dt.EnabledClass=`${T.LABEL_ACTION_CLASS} prominent update`;dt.DisabledClass=`${dt.EnabledClass} disabled`;let Rs=class extends dt{constructor(e,t,i){super("extensions.update",c("update","Update"),t),this.verbose=e,this.instantiationService=i}update(){super.update(),this.extension&&(this.label=this.verbose?c("update to","Update to v{0}",this.extension.latestVersion):c("update","Update"))}async run(){if(this.extension)return Dt(c("updateExtensionStart","Updating extension {0} to version {1} started.",this.extension.displayName,this.extension.latestVersion)),this.install(this.extension)}async install(e){var t;try{await this.extensionsWorkbenchService.install(e,(t=e.local)!=null&&t.preRelease?{installPreReleaseVersion:!0}:void 0),Dt(c("updateExtensionComplete","Updating extension {0} to version {1} completed.",e.displayName,e.latestVersion))}catch(i){this.instantiationService.createInstance(ti,e,e.latestVersion,3,void 0,i).run()}}};Rs=w([d(1,te),d(2,B)],Rs);let Ci=class sn extends T{constructor(e,t){super("extensionsAction.migrateDeprecatedExtension",c("migrateExtension","Migrate"),sn.DisabledClass,!1),this.small=e,this.extensionsWorkbenchService=t,this.update()}update(){var t,i;if(this.enabled=!1,this.class=sn.DisabledClass,!((t=this.extension)!=null&&t.local)||this.extension.state!==1||!((i=this.extension.deprecationInfo)!=null&&i.extension))return;const e=this.extension.deprecationInfo.extension.id;this.extensionsWorkbenchService.local.some(n=>Fe(n.identifier,{id:e}))||(this.enabled=!0,this.class=sn.EnabledClass,this.tooltip=c("migrate to","Migrate to {0}",this.extension.deprecationInfo.extension.displayName),this.label=this.small?c("migrate","Migrate"):this.tooltip)}async run(){var i,n,s,o;if(!((n=(i=this.extension)==null?void 0:i.deprecationInfo)!=null&&n.extension))return;const e=this.extension.local;await this.extensionsWorkbenchService.uninstall(this.extension);const[t]=await this.extensionsWorkbenchService.getExtensions([{id:this.extension.deprecationInfo.extension.id,preRelease:(o=(s=this.extension.deprecationInfo)==null?void 0:s.extension)==null?void 0:o.preRelease}],oi.None);await this.extensionsWorkbenchService.install(t,{isMachineScoped:e==null?void 0:e.isMachineScoped})}};Ci.EnabledClass=`${T.LABEL_ACTION_CLASS} migrate`;Ci.DisabledClass=`${Ci.EnabledClass} disabled`;Ci=w([d(1,te)],Ci);let yn=class extends T{constructor(e,t,i,n,s){super(e,t,i,n),this.instantiationService=s,this._actionViewItem=null}createActionViewItem(){return this._actionViewItem=this.instantiationService.createInstance(Ms,this),this._actionViewItem}run({actionGroups:e,disposeActionsOnHide:t}){var i;return(i=this._actionViewItem)==null||i.showMenu(e,t),Promise.resolve()}};yn=w([d(4,B)],yn);let Ms=class extends ma{constructor(e,t){super(null,e,{icon:!0,label:!0}),this.contextMenuService=t}showMenu(e,t){if(this.element){const i=this.getActions(e),n=ga(this.element),s={x:n.left,y:n.top+n.height+10};this.contextMenuService.showContextMenu({getAnchor:()=>s,getActions:()=>i,actionRunner:this.actionRunner,onHide:()=>{t&&Wl(i)}})}}getActions(e){let t=[];for(const i of e)t=[...t,...i,new kt];return t.length?t.slice(0,t.length-1):t}};Ms=w([d(1,Nt)],Ms);async function Rd(r,e,t){return t.invokeFunction(async i=>{var v,f,_,S;const n=i.get(te),s=i.get(Yn),o=i.get(Ed),a=i.get(Qr),l=i.get(Bi),h=[];if(r){h.push(["extension",r.identifier.id]),h.push(["isBuiltinExtension",r.isBuiltin]),h.push(["extensionHasConfiguration",r.local&&!!r.local.manifest.contributes&&!!r.local.manifest.contributes.configuration]),h.push(["extensionHasKeybindings",r.local&&!!r.local.manifest.contributes&&!!r.local.manifest.contributes.keybindings]),h.push(["extensionHasCommands",r.local&&!!r.local.manifest.contributes&&!!((v=r.local.manifest.contributes)!=null&&v.commands)]),h.push(["isExtensionRecommended",!!o.getAllRecommendationsWithReason()[r.identifier.id.toLowerCase()]]),h.push(["isExtensionWorkspaceRecommended",((f=o.getAllRecommendationsWithReason()[r.identifier.id.toLowerCase()])==null?void 0:f.reasonId)===0]),h.push(["isUserIgnoredRecommendation",a.globalIgnoredRecommendations.some(R=>R===r.identifier.id.toLowerCase())]),r.state===1&&h.push(["extensionStatus","installed"]),h.push(["installedExtensionIsPreReleaseVersion",!!((_=r.local)!=null&&_.isPreReleaseVersion)]),h.push(["galleryExtensionIsPreReleaseVersion",!!((S=r.gallery)!=null&&S.properties.isPreReleaseVersion)]),h.push(["extensionHasPreReleaseVersion",r.hasPreReleaseVersion]),h.push(["extensionHasReleaseVersion",r.hasReleaseVersion]);const[y,M,D]=await Promise.all([l.getColorThemes(),l.getFileIconThemes(),l.getProductIconThemes()]);h.push(["extensionHasColorThemes",y.some(R=>Ve(R,r))]),h.push(["extensionHasFileIconThemes",M.some(R=>Ve(R,r))]),h.push(["extensionHasProductIconThemes",D.some(R=>Ve(R,r))]),h.push(["canSetLanguage",n.canSetLanguage(r)]),h.push(["isActiveLanguagePackExtension",r.gallery&&Xn===$r(r.gallery)])}const m=s.createMenu(I.ExtensionContext,e.createOverlay(h)),p=m.getActions({shouldForwardArgs:!0});return m.dispose(),p})}function os(r,e){const t=[];for(const[,i]of r)t.push(i.map(n=>n instanceof pa?n:e.createInstance(Fs,n)));return t}let ni=class mi extends yn{constructor(e,t,i){super(mi.ID,"","",!0,e),this.extensionService=t,this.contextKeyService=i,this.tooltip=c("manage","Manage"),this.update()}async getActionGroups(){const e=[],t=await Rd(this.extension,this.contextKeyService,this.instantiationService),i=[],n=[],s=[];for(const[o,a]of t)o===mc?n.push(...os([[o,a]],this.instantiationService)[0]):o===gc?i.push(...os([[o,a]],this.instantiationService)[0]):s.push(...os([[o,a]],this.instantiationService));return i.length&&e.push(i),e.push([this.instantiationService.createInstance(xi),this.instantiationService.createInstance(yi)]),e.push([this.instantiationService.createInstance(ki),this.instantiationService.createInstance(Ii)]),e.push([...n.length?n:[],this.instantiationService.createInstance(Lt),this.instantiationService.createInstance(Et)]),s.forEach(o=>e.push(o)),e.forEach(o=>o.forEach(a=>{a instanceof T&&(a.extension=this.extension)})),e}async run(){return await this.extensionService.whenInstalledExtensionsRegistered(),super.run({actionGroups:await this.getActionGroups(),disposeActionsOnHide:!0})}update(){if(this.class=mi.HideManageExtensionClass,this.enabled=!1,this.extension){const e=this.extension.state;this.enabled=e===1,this.class=this.enabled||e===2?mi.Class:mi.HideManageExtensionClass,this.tooltip=e===2?c("ManageExtensionAction.uninstallingTooltip","Uninstalling"):""}}};ni.ID="extensions.manage";ni.Class=`${T.ICON_ACTION_CLASS} manage `+E.asClassName(Qh);ni.HideManageExtensionClass=`${ni.Class} hide`;ni=w([d(0,B),d(1,ue),d(2,me)],ni);let Fs=class extends T{constructor(e,t){super(e.id,e.label),this.action=e,this.extensionsWorkbenchService=t}update(){this.extension&&this.action.id===pc&&(this.checked=!this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension))}async run(){this.extension&&await this.action.run(this.extension.local?uo(this.extension.local.manifest.publisher,this.extension.local.manifest.name):this.extension.gallery?uo(this.extension.gallery.publisher,this.extension.gallery.name):this.extension.identifier.id)}};Fs=w([d(1,te)],Fs);let xn=class rn extends T{constructor(e,t){super(rn.ID,e?"":rn.TITLE.value,`${e?T.ICON_ACTION_CLASS+" "+E.asClassName(Ta):T.LABEL_ACTION_CLASS} hide-when-disabled switch-to-prerelease`,!0),this.commandService=t,this.tooltip=c("switch to pre-release version tooltip","Switch to Pre-Release version of this extension"),this.update()}update(){var e;this.enabled=!!this.extension&&!this.extension.isBuiltin&&!((e=this.extension.local)!=null&&e.isPreReleaseVersion)&&this.extension.hasPreReleaseVersion&&this.extension.state===1}async run(){var e;if(this.enabled)return this.commandService.executeCommand(rn.ID,(e=this.extension)==null?void 0:e.identifier.id)}};xn.ID="workbench.extensions.action.switchToPreReleaseVersion";xn.TITLE={value:c("switch to pre-release version","Switch to Pre-Release Version"),original:"Switch to  Pre-Release Version"};xn=w([d(1,pe)],xn);let In=class on extends T{constructor(e,t){super(on.ID,e?"":on.TITLE.value,`${e?T.ICON_ACTION_CLASS+" "+E.asClassName(Ta):T.LABEL_ACTION_CLASS} hide-when-disabled switch-to-released`),this.commandService=t,this.tooltip=c("switch to release version tooltip","Switch to Release version of this extension"),this.update()}update(){var e;this.enabled=!!this.extension&&!this.extension.isBuiltin&&this.extension.state===1&&!!((e=this.extension.local)!=null&&e.isPreReleaseVersion)&&!!this.extension.hasReleaseVersion}async run(){var e;if(this.enabled)return this.commandService.executeCommand(on.ID,(e=this.extension)==null?void 0:e.identifier.id)}};In.ID="workbench.extensions.action.switchToReleaseVersion";In.TITLE={value:c("switch to release version","Switch to Release Version"),original:"Switch to Release Version"};In=w([d(1,pe)],In);let Lt=class Ws extends T{constructor(e,t,i,n,s){super(Ws.ID,Ws.LABEL,T.LABEL_ACTION_CLASS),this.extensionsWorkbenchService=e,this.extensionGalleryService=t,this.quickInputService=i,this.instantiationService=n,this.dialogService=s,this.update()}update(){this.enabled=!!this.extension&&!this.extension.isBuiltin&&!!this.extension.gallery&&!!this.extension.local&&!!this.extension.server&&this.extension.state===1&&!this.extension.deprecationInfo}async run(){if(!this.enabled)return;const e=await this.extension.server.extensionManagementService.getTargetPlatform(),t=await this.extensionGalleryService.getAllCompatibleVersions(this.extension.gallery,this.extension.local.preRelease,e);if(!t.length){await this.dialogService.info(c("no versions","This extension has no other versions."));return}const i=t.map((s,o)=>({id:s.version,label:s.version,description:`${gi(new Date(Date.parse(s.date)),!0)}${s.isPreReleaseVersion?` (${c("pre-release","pre-release")})`:""}${s.version===this.extension.version?` (${c("current","current")})`:""}`,latest:o===0,ariaLabel:`${s.isPreReleaseVersion?"Pre-Release version":"Release version"} ${s.version}`,isPreReleaseVersion:s.isPreReleaseVersion})),n=await this.quickInputService.pick(i,{placeHolder:c("selectVersion","Select Version to Install"),matchOnDetail:!0});if(n){if(this.extension.version===n.id)return;try{n.latest?await this.extensionsWorkbenchService.install(this.extension,{installPreReleaseVersion:n.isPreReleaseVersion}):await this.extensionsWorkbenchService.installVersion(this.extension,n.id,{installPreReleaseVersion:n.isPreReleaseVersion})}catch(s){this.instantiationService.createInstance(ti,this.extension,n.latest?this.extension.latestVersion:n.id,2,void 0,s).run()}}return null}};Lt.ID="workbench.extensions.action.install.anotherVersion";Lt.LABEL=c("install another version","Install Another Version...");Lt=w([d(0,te),d(1,jo),d(2,le),d(3,B),d(4,Wi)],Lt);let yi=class Ns extends T{constructor(e,t){super(Ns.ID,Ns.LABEL,T.LABEL_ACTION_CLASS),this.extensionsWorkbenchService=e,this.extensionEnablementService=t,this.tooltip=c("enableForWorkspaceActionToolTip","Enable this extension only in this workspace"),this.update()}update(){this.enabled=!1,this.extension&&this.extension.local&&(this.enabled=this.extension.state===1&&!this.extensionEnablementService.isEnabled(this.extension.local)&&this.extensionEnablementService.canChangeWorkspaceEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,9)}};yi.ID="extensions.enableForWorkspace";yi.LABEL=c("enableForWorkspaceAction","Enable (Workspace)");yi=w([d(0,te),d(1,Ge)],yi);let xi=class Bs extends T{constructor(e,t){super(Bs.ID,Bs.LABEL,T.LABEL_ACTION_CLASS),this.extensionsWorkbenchService=e,this.extensionEnablementService=t,this.tooltip=c("enableGloballyActionToolTip","Enable this extension"),this.update()}update(){this.enabled=!1,this.extension&&this.extension.local&&(this.enabled=this.extension.state===1&&this.extensionEnablementService.isDisabledGlobally(this.extension.local)&&this.extensionEnablementService.canChangeEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,8)}};xi.ID="extensions.enableGlobally";xi.LABEL=c("enableGloballyAction","Enable");xi=w([d(0,te),d(1,Ge)],xi);let Ii=class Os extends T{constructor(e,t,i,n){super(Os.ID,Os.LABEL,T.LABEL_ACTION_CLASS),this.workspaceContextService=e,this.extensionsWorkbenchService=t,this.extensionEnablementService=i,this.extensionService=n,this.tooltip=c("disableForWorkspaceActionToolTip","Disable this extension only in this workspace"),this.update(),this._register(this.extensionService.onDidChangeExtensions(()=>this.update()))}update(){this.enabled=!1,this.extension&&this.extension.local&&this.extensionService.extensions.some(e=>Fe({id:e.identifier.value,uuid:e.uuid},this.extension.identifier)&&this.workspaceContextService.getWorkbenchState()!==1)&&(this.enabled=this.extension.state===1&&(this.extension.enablementState===8||this.extension.enablementState===9)&&this.extensionEnablementService.canChangeWorkspaceEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,7)}};Ii.ID="extensions.disableForWorkspace";Ii.LABEL=c("disableForWorkspaceAction","Disable (Workspace)");Ii=w([d(0,_e),d(1,te),d(2,Ge),d(3,ue)],Ii);let ki=class Vs extends T{constructor(e,t,i){super(Vs.ID,Vs.LABEL,T.LABEL_ACTION_CLASS),this.extensionsWorkbenchService=e,this.extensionEnablementService=t,this.extensionService=i,this.tooltip=c("disableGloballyActionToolTip","Disable this extension"),this.update(),this._register(this.extensionService.onDidChangeExtensions(()=>this.update()))}update(){this.enabled=!1,this.extension&&this.extension.local&&this.extensionService.extensions.some(e=>Fe({id:e.identifier.value,uuid:e.uuid},this.extension.identifier))&&(this.enabled=this.extension.state===1&&(this.extension.enablementState===8||this.extension.enablementState===9)&&this.extensionEnablementService.canChangeEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,6)}};ki.ID="extensions.disableGlobally";ki.LABEL=c("disableGloballyAction","Disable");ki=w([d(0,te),d(1,Ge),d(2,ue)],ki);let Ti=class an extends T{constructor(e,t){super("extensions.reload",c("reloadAction","Reload"),an.DisabledClass,!1),this.hostService=e,this.extensionService=t,this.updateWhenCounterExtensionChanges=!0,this._register(this.extensionService.onDidChangeExtensions(()=>this.update())),this.update()}update(){if(this.enabled=!1,this.tooltip="",!this.extension)return;const e=this.extension.state;if(e===0||e===2||this.extension.local&&this.extension.local.manifest&&this.extension.local.manifest.contributes&&this.extension.local.manifest.contributes.localizations&&this.extension.local.manifest.contributes.localizations.length>0)return;const t=this.extension.reloadRequiredStatus;this.enabled=t!==void 0,this.label=t!==void 0?c("reload required","Reload Required"):"",this.tooltip=t!==void 0?t:"",this.class=this.enabled?an.EnabledClass:an.DisabledClass}run(){return Promise.resolve(this.hostService.reload())}};Ti.EnabledClass=`${T.LABEL_ACTION_CLASS} reload`;Ti.DisabledClass=`${Ti.EnabledClass} disabled`;Ti=w([d(0,Xo),d(1,ue)],Ti);function Ve(r,e){return!!(e&&r.extensionData&&Nl.equals(r.extensionData.extensionId,e.identifier.id))}function Jr(r,e,t,i){const n=[];for(const s of r)Ve(s,t)&&!(i&&s===e)&&n.push({label:s.label,id:s.id});return i&&(n.push({type:"separator",label:c("current","current")}),n.push({label:e.label,id:e.id})),n}let gt=class Vt extends T{constructor(e,t,i,n){super(Vt.ID,Vt.TITLE.value,Vt.DisabledClass,!1),this.workbenchThemeService=t,this.quickInputService=i,this.extensionEnablementService=n,this._register(Q.any(e.onDidChangeExtensions,t.onDidColorThemeChange)(()=>this.update(),this)),this.update()}update(){this.workbenchThemeService.getColorThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?Vt.EnabledClass:Vt.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===1&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>Ve(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const i=await this.workbenchThemeService.getColorThemes();if(!this.computeEnablement(i))return;const n=this.workbenchThemeService.getColorTheme(),s=new Qn(100),o=Jr(i,n,this.extension,e),a=await this.quickInputService.pick(o,{placeHolder:c("select color theme","Select Color Theme"),onDidFocus:l=>s.trigger(()=>this.workbenchThemeService.setColorTheme(l.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setColorTheme(a?a.id:n.id,"auto")}};gt.ID="workbench.extensions.action.setColorTheme";gt.TITLE={value:c("workbench.extensions.action.setColorTheme","Set Color Theme"),original:"Set Color Theme"};gt.EnabledClass=`${T.LABEL_ACTION_CLASS} theme`;gt.DisabledClass=`${gt.EnabledClass} disabled`;gt=w([d(0,ue),d(1,Bi),d(2,le),d(3,Ge)],gt);let pt=class Ht extends T{constructor(e,t,i,n){super(Ht.ID,Ht.TITLE.value,Ht.DisabledClass,!1),this.workbenchThemeService=t,this.quickInputService=i,this.extensionEnablementService=n,this._register(Q.any(e.onDidChangeExtensions,t.onDidFileIconThemeChange)(()=>this.update(),this)),this.update()}update(){this.workbenchThemeService.getFileIconThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?Ht.EnabledClass:Ht.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===1&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>Ve(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const i=await this.workbenchThemeService.getFileIconThemes();if(!this.computeEnablement(i))return;const n=this.workbenchThemeService.getFileIconTheme(),s=new Qn(100),o=Jr(i,n,this.extension,e),a=await this.quickInputService.pick(o,{placeHolder:c("select file icon theme","Select File Icon Theme"),onDidFocus:l=>s.trigger(()=>this.workbenchThemeService.setFileIconTheme(l.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setFileIconTheme(a?a.id:n.id,"auto")}};pt.ID="workbench.extensions.action.setFileIconTheme";pt.TITLE={value:c("workbench.extensions.action.setFileIconTheme","Set File Icon Theme"),original:"Set File Icon Theme"};pt.EnabledClass=`${T.LABEL_ACTION_CLASS} theme`;pt.DisabledClass=`${pt.EnabledClass} disabled`;pt=w([d(0,ue),d(1,Bi),d(2,le),d(3,Ge)],pt);let ft=class Gt extends T{constructor(e,t,i,n){super(Gt.ID,Gt.TITLE.value,Gt.DisabledClass,!1),this.workbenchThemeService=t,this.quickInputService=i,this.extensionEnablementService=n,this._register(Q.any(e.onDidChangeExtensions,t.onDidProductIconThemeChange)(()=>this.update(),this)),this.update()}update(){this.workbenchThemeService.getProductIconThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?Gt.EnabledClass:Gt.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===1&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>Ve(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const i=await this.workbenchThemeService.getProductIconThemes();if(!this.computeEnablement(i))return;const n=this.workbenchThemeService.getProductIconTheme(),s=new Qn(100),o=Jr(i,n,this.extension,e),a=await this.quickInputService.pick(o,{placeHolder:c("select product icon theme","Select Product Icon Theme"),onDidFocus:l=>s.trigger(()=>this.workbenchThemeService.setProductIconTheme(l.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setProductIconTheme(a?a.id:n.id,"auto")}};ft.ID="workbench.extensions.action.setProductIconTheme";ft.TITLE={value:c("workbench.extensions.action.setProductIconTheme","Set Product Icon Theme"),original:"Set Product Icon Theme"};ft.EnabledClass=`${T.LABEL_ACTION_CLASS} theme`;ft.DisabledClass=`${ft.EnabledClass} disabled`;ft=w([d(0,ue),d(1,Bi),d(2,le),d(3,Ge)],ft);let Rt=class $t extends T{constructor(e){super($t.ID,$t.TITLE.value,$t.DisabledClass,!1),this.extensionsWorkbenchService=e,this.update()}update(){this.enabled=!1,this.class=$t.DisabledClass,this.extension&&this.extensionsWorkbenchService.canSetLanguage(this.extension)&&(this.extension.gallery&&Xn===$r(this.extension.gallery)||(this.enabled=!0,this.class=$t.EnabledClass))}async run(){return this.extension&&this.extensionsWorkbenchService.setLanguage(this.extension)}};Rt.ID="workbench.extensions.action.setDisplayLanguage";Rt.TITLE={value:c("workbench.extensions.action.setDisplayLanguage","Set Display Language"),original:"Set Display Language"};Rt.EnabledClass=`${T.LABEL_ACTION_CLASS} language`;Rt.DisabledClass=`${Rt.EnabledClass} disabled`;Rt=w([d(0,te)],Rt);let Mt=class zt extends T{constructor(e,t){super(zt.ID,zt.TITLE.value,zt.DisabledClass,!1),this.extensionsWorkbenchService=e,this.localeService=t,this.update()}update(){this.enabled=!1,this.class=zt.DisabledClass,this.extension&&this.extensionsWorkbenchService.canSetLanguage(this.extension)&&(this.extension.gallery&&Xn!==$r(this.extension.gallery)||(this.enabled=!0,this.class=zt.EnabledClass))}async run(){return this.extension&&this.localeService.clearLocalePreference()}};Mt.ID="workbench.extensions.action.clearLanguage";Mt.TITLE={value:c("workbench.extensions.action.clearLanguage","Clear Display Language"),original:"Clear Display Language"};Mt.EnabledClass=`${T.LABEL_ACTION_CLASS} language`;Mt.DisabledClass=`${Mt.EnabledClass} disabled`;Mt=w([d(0,te),d(1,Ld)],Mt);let kn=class Hs extends j{constructor(e,t,i){super(Hs.ID,Hs.LABEL,void 0,!1),this.paneCompositeService=t,this.extensionWorkbenchService=i,this.extensionId=e}async run(){const e=await this.paneCompositeService.openPaneComposite(Vi,0,!0),t=e==null?void 0:e.getViewPaneContainer();t.search(`@id:${this.extensionId}`),t.focus();const[i]=await this.extensionWorkbenchService.getExtensions([{id:this.extensionId}],{source:"install-recommendation"},oi.None);return i?this.extensionWorkbenchService.open(i):null}};kn.ID="workbench.extensions.action.showRecommendedExtension";kn.LABEL=c("showRecommendedExtension","Show Recommended Extension");kn=w([d(1,Oi),d(2,te)],kn);let Di=class Gs extends j{constructor(e,t,i,n){super(Gs.ID,Gs.LABEL,void 0,!1),this.paneCompositeService=t,this.instantiationService=i,this.extensionWorkbenchService=n,this.extensionId=e}async run(){const e=await this.paneCompositeService.openPaneComposite(Vi,0,!0),t=e==null?void 0:e.getViewPaneContainer();t.search(`@id:${this.extensionId}`),t.focus();const[i]=await this.extensionWorkbenchService.getExtensions([{id:this.extensionId}],{source:"install-recommendation"},oi.None);if(i){await this.extensionWorkbenchService.open(i);try{await this.extensionWorkbenchService.install(i)}catch(n){this.instantiationService.createInstance(ti,i,i.latestVersion,2,void 0,n).run()}}}};Di.ID="workbench.extensions.action.installRecommendedExtension";Di.LABEL=c("installRecommendedExtension","Install Recommended Extension");Di=w([d(1,Oi),d(2,B),d(3,te)],Di);let Tn=class $s extends j{constructor(e,t){super($s.ID,"Ignore Recommendation"),this.extension=e,this.extensionRecommendationsManagementService=t,this.class=$s.Class,this.tooltip=c("ignoreExtensionRecommendation","Do not recommend this extension again"),this.enabled=!0}run(){return this.extensionRecommendationsManagementService.toggleGlobalIgnoredRecommendation(this.extension.identifier.id,!0),Promise.resolve()}};Tn.ID="extensions.ignore";Tn.Class=`${T.LABEL_ACTION_CLASS} ignore`;Tn=w([d(1,Qr)],Tn);let Dn=class zs extends j{constructor(e,t){super(zs.ID,"Undo"),this.extension=e,this.extensionRecommendationsManagementService=t,this.class=zs.Class,this.tooltip=c("undo","Undo"),this.enabled=!0}run(){return this.extensionRecommendationsManagementService.toggleGlobalIgnoredRecommendation(this.extension.identifier.id,!1),Promise.resolve()}};Dn.ID="extensions.ignore";Dn.Class=`${T.LABEL_ACTION_CLASS} undo-ignore`;Dn=w([d(1,Qr)],Dn);let Pn=class extends j{constructor(e,t){super("extensions.searchExtensions",c("search recommendations","Search Extensions"),void 0,!0),this.searchValue=e,this.paneCompositeService=t}async run(){var t;const e=(t=await this.paneCompositeService.openPaneComposite(Vi,0,!0))==null?void 0:t.getViewPaneContainer();e.search(this.searchValue),e.focus()}};Pn=w([d(1,Oi)],Pn);let An=class extends j{constructor(e,t,i,n,s,o,a,l){super(e,t),this.contextService=i,this.fileService=n,this.textFileService=s,this.editorService=o,this.jsonEditingService=a,this.textModelResolverService=l}openExtensionsFile(e){return this.getOrCreateExtensionsFile(e).then(({created:t,content:i})=>this.getSelectionPosition(i,e,["recommendations"]).then(n=>this.editorService.openEditor({resource:e,options:{pinned:t,selection:n}})),t=>Promise.reject(new Error(c("OpenExtensionsFile.failed","Unable to create 'extensions.json' file inside the '.vscode' folder ({0}).",t))))}openWorkspaceConfigurationFile(e){return this.getOrUpdateWorkspaceConfigurationFile(e).then(t=>this.getSelectionPosition(t.value.toString(),t.resource,["extensions","recommendations"])).then(t=>this.editorService.openEditor({resource:e,options:{selection:t,forceReload:!0}}))}getOrUpdateWorkspaceConfigurationFile(e){return Promise.resolve(this.fileService.readFile(e)).then(t=>{const i=Bl(t.value.toString()).extensions;return!i||!i.recommendations?this.jsonEditingService.write(e,[{path:["extensions"],value:{recommendations:[]}}],!0).then(()=>this.fileService.readFile(e)):t})}getSelectionPosition(e,t,i){const n=Ol(e),s=Vl(n,i);if(s&&s.parent&&s.parent.children){const o=s.parent.children[1],a=o.children&&o.children.length?o.children[o.children.length-1]:null,l=a?a.offset+a.length:o.offset+1;return Promise.resolve(this.textModelResolverService.createModelReference(t)).then(h=>{const m=h.object.textEditorModel.getPositionAt(l);return h.dispose(),{startLineNumber:m.lineNumber,startColumn:m.column,endLineNumber:m.lineNumber,endColumn:m.column}})}return Promise.resolve(void 0)}getOrCreateExtensionsFile(e){return Promise.resolve(this.fileService.readFile(e)).then(t=>({created:!1,extensionsFileResource:e,content:t.value.toString()}),t=>this.textFileService.write(e,ko).then(()=>({created:!0,extensionsFileResource:e,content:ko})))}};An=w([d(2,_e),d(3,wt),d(4,Hr),d(5,_t),d(6,Gr),d(7,qn)],An);let En=class extends An{constructor(e,t,i,n,s,o,a,l){super(e,t,s,i,n,o,a,l),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.update(),this)),this.update()}update(){this.enabled=this.contextService.getWorkbenchState()!==1}run(){switch(this.contextService.getWorkbenchState()){case 2:return this.openExtensionsFile(this.contextService.getWorkspace().folders[0].toResource($a));case 3:return this.openWorkspaceConfigurationFile(this.contextService.getWorkspace().configuration)}return Promise.resolve()}};En.ID="workbench.extensions.action.configureWorkspaceRecommendedExtensions";En.LABEL=c("configureWorkspaceRecommendedExtensions","Configure Recommended Extensions (Workspace)");En=w([d(2,wt),d(3,Hr),d(4,_e),d(5,_t),d(6,Gr),d(7,qn)],En);let Ln=class extends An{constructor(e,t,i,n,s,o,a,l,h){super(e,t,s,i,n,o,a,l),this.commandService=h}run(){const t=this.contextService.getWorkspace().folders.length===1?Promise.resolve(this.contextService.getWorkspace().folders[0]):this.commandService.executeCommand(Or);return Promise.resolve(t).then(i=>i?this.openExtensionsFile(i.toResource($a)):null)}};Ln.ID="workbench.extensions.action.configureWorkspaceFolderRecommendedExtensions";Ln.LABEL=c("configureWorkspaceFolderRecommendedExtensions","Configure Recommended Extensions (Workspace Folder)");Ln=w([d(2,wt),d(3,Hr),d(4,_e),d(5,_t),d(6,Gr),d(7,qn),d(8,pe)],Ln);let Pi=class cn extends j{get extension(){return this._extension}set extension(e){this._extension&&e&&Fe(this._extension.identifier,e.identifier)||(this.initialStatus=null,this.status=null,this.enablementState=null),this._extension=e,this.update()}constructor(e,t,i){super("extensions.action.statusLabel","",cn.DISABLED_CLASS,!1),this.extensionService=e,this.extensionManagementServerService=t,this.extensionEnablementService=i,this.initialStatus=null,this.status=null,this.version=null,this.enablementState=null,this._extension=null}update(){const e=this.computeLabel();this.label=e||"",this.class=e?cn.ENABLED_CLASS:cn.DISABLED_CLASS}computeLabel(){if(!this.extension)return null;const e=this.status,t=this.version,i=this.enablementState;this.status=this.extension.state,this.version=this.extension.version,this.initialStatus===null&&(this.initialStatus=this.status),this.enablementState=this.extension.enablementState;const n=()=>{const o=this.extensionService.extensions.filter(a=>Fe({id:a.identifier.value,uuid:a.uuid},this.extension.identifier))[0];return this.extension.local?o&&this.extension.version===o.version?!0:this.extensionService.canAddExtension(un(this.extension.local)):!1},s=()=>this.extension.local?this.extensionService.extensions.every(o=>!(Fe({id:o.identifier.value,uuid:o.uuid},this.extension.identifier)&&this.extension.server===this.extensionManagementServerService.getExtensionManagementServer(Yo(o))))?!0:this.extensionService.canRemoveExtension(un(this.extension.local)):!1;if(e!==null){if(e===0&&this.status===1)return n()?this.initialStatus===1&&this.version!==t?c("updated","Updated"):c("installed","Installed"):null;if(e===2&&this.status===3)return this.initialStatus=this.status,s()?c("uninstalled","Uninstalled"):null}if(i!==null){const o=this.extensionEnablementService.isEnabledEnablementState(i),a=this.extensionEnablementService.isEnabledEnablementState(this.enablementState);if(!o&&a)return n()?c("enabled","Enabled"):null;if(o&&!a)return s()?c("disabled","Disabled"):null}return null}run(){return Promise.resolve()}};Pi.ENABLED_CLASS=`${T.TEXT_ACTION_CLASS} extension-status-label`;Pi.DISABLED_CLASS=`${Pi.ENABLED_CLASS} hide`;Pi=w([d(0,ue),d(1,Ni),d(2,Ge)],Pi);let Ai=class ln extends yn{constructor(e,t,i,n){super("extensions.sync","",ln.SYNC_CLASS,!1,n),this.configurationService=e,this.extensionsWorkbenchService=t,this.userDataSyncEnablementService=i,this._register(Q.filter(this.configurationService.onDidChangeConfiguration,s=>s.affectsConfiguration("settingsSync.ignoredExtensions"))(()=>this.update())),this._register(i.onDidChangeEnablement(()=>this.update())),this.update()}update(){if(this.enabled=!!this.extension&&this.userDataSyncEnablementService.isEnabled()&&this.extension.state===1,this.extension){const e=this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension);this.class=e?ln.IGNORED_SYNC_CLASS:ln.SYNC_CLASS,this.tooltip=e?c("ignored","This extension is ignored during sync"):c("synced","This extension is synced")}}async run(){return super.run({actionGroups:[[new j("extensions.syncignore",this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension)?c("sync","Sync this extension"):c("do not sync","Do not sync this extension"),void 0,!0,()=>this.extensionsWorkbenchService.toggleExtensionIgnoredToSync(this.extension))]],disposeActionsOnHide:!0})}};Ai.IGNORED_SYNC_CLASS=`${T.ICON_ACTION_CLASS} extension-sync ${E.asClassName(Jh)}`;Ai.SYNC_CLASS=`${Ai.ICON_ACTION_CLASS} extension-sync ${E.asClassName(Zh)}`;Ai=w([d(0,X),d(1,te),d(2,dc),d(3,B)],Ai);let Ks=class xt extends T{get status(){return this._status}constructor(e,t,i,n,s,o,a,l,h,m,p){super("extensions.status","",`${xt.CLASS} hide`,!1),this.extensionManagementServerService=e,this.labelService=t,this.commandService=i,this.workspaceTrustEnablementService=n,this.workspaceTrustService=s,this.extensionsWorkbenchService=o,this.extensionService=a,this.extensionManifestPropertiesService=l,this.contextService=h,this.productService=m,this.workbenchExtensionEnablementService=p,this.updateWhenCounterExtensionChanges=!0,this._onDidChangeStatus=this._register(new b),this.onDidChangeStatus=this._onDidChangeStatus.event,this.updateThrottler=new qr,this._register(this.labelService.onDidChangeFormatters(()=>this.update(),this)),this._register(this.extensionService.onDidChangeExtensions(()=>this.update())),this.update()}update(){this.updateThrottler.queue(()=>this.computeAndUpdateStatus())}async computeAndUpdateStatus(){var i,n,s,o;if(this.updateStatus(void 0,!0),this.enabled=!1,!this.extension)return;if(this.extension.isMalicious){this.updateStatus({icon:we,message:new V(c("malicious tooltip","This extension was reported to be problematic."))},!0);return}if(this.extension.deprecationInfo){if(this.extension.deprecationInfo.extension){const a=`[${this.extension.deprecationInfo.extension.displayName}](${L.parse(`command:extension.open?${encodeURIComponent(JSON.stringify([this.extension.deprecationInfo.extension.id]))}`)})`;this.updateStatus({icon:we,message:new V(c("deprecated with alternate extension tooltip","This extension is deprecated. Use the {0} extension instead.",a))},!0)}else if(this.extension.deprecationInfo.settings){const a=`[${c("settings","settings")}](${L.parse(`command:workbench.action.openSettings?${encodeURIComponent(JSON.stringify([this.extension.deprecationInfo.settings.map(l=>`@id:${l}`).join(" ")]))}`)})`;this.updateStatus({icon:we,message:new V(c("deprecated with alternate settings tooltip","This extension is deprecated as this functionality is now built-in to VS Code. Configure these {0} to use this functionality.",a))},!0)}else{const a=new V(c("deprecated tooltip","This extension is deprecated as it is no longer being maintained."));this.extension.deprecationInfo.additionalInfo&&a.appendMarkdown(` ${this.extension.deprecationInfo.additionalInfo}`),this.updateStatus({icon:we,message:a},!0)}return}if(this.extensionsWorkbenchService.canSetLanguage(this.extension))return;if(this.extension.gallery&&this.extension.state===3&&!await this.extensionsWorkbenchService.canInstall(this.extension)){if(this.extensionManagementServerService.localExtensionManagementServer||this.extensionManagementServerService.remoteExtensionManagementServer){const a=await(this.extensionManagementServerService.localExtensionManagementServer?this.extensionManagementServerService.localExtensionManagementServer.extensionManagementService.getTargetPlatform():this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.getTargetPlatform()),l=new V(`${c("incompatible platform","The '{0}' extension is not available in {1} for {2}.",this.extension.displayName||this.extension.identifier.id,this.productService.nameLong,fc(a))} [${c("learn more","Learn More")}](https://aka.ms/vscode-platform-specific-extensions)`);this.updateStatus({icon:we,message:l},!0);return}if(this.extensionManagementServerService.webExtensionManagementServer){const a=c("VS Code for Web","{0} for the Web",this.productService.nameLong),l=new V(`${c("not web tooltip","The '{0}' extension is not available in {1}.",this.extension.displayName||this.extension.identifier.id,a)} [${c("learn why","Learn Why")}](https://aka.ms/vscode-web-extensions-guide)`);this.updateStatus({icon:we,message:l},!0);return}}if(!this.extension.local||!this.extension.server||this.extension.state!==1)return;if(this.extension.enablementState===2){this.updateStatus({message:new V(c("disabled by environment","This extension is disabled by the environment."))},!0);return}if(this.extension.enablementState===3){this.updateStatus({message:new V(c("enabled by environment","This extension is enabled because it is required in the current environment."))},!0);return}if(this.extension.enablementState===4){const a=Ui((i=this.extension.local.manifest.capabilities)==null?void 0:i.virtualWorkspaces);this.updateStatus({icon:Be,message:new V(a?qi(a):c("disabled because of virtual workspace","This extension has been disabled because it does not support virtual workspaces."))},!0);return}if(_c(this.contextService.getWorkspace())){const a=this.extensionManifestPropertiesService.getExtensionVirtualWorkspaceSupportType(this.extension.local.manifest),l=Ui((n=this.extension.local.manifest.capabilities)==null?void 0:n.virtualWorkspaces);if(a==="limited"||l){this.updateStatus({icon:we,message:new V(l?qi(l):c("extension limited because of virtual workspace","This extension has limited features because the current workspace is virtual."))},!0);return}}if(this.extension.enablementState===0||this.extension.enablementState===5&&this.workbenchExtensionEnablementService.getDependenciesEnablementStates(this.extension.local).every(([,a])=>this.workbenchExtensionEnablementService.isEnabledEnablementState(a)||a===0)){this.enabled=!0;const a=Ui((s=this.extension.local.manifest.capabilities)==null?void 0:s.untrustedWorkspaces);this.updateStatus({icon:hi,message:new V(a?qi(a):c("extension disabled because of trust requirement","This extension has been disabled because the current workspace is not trusted."))},!0);return}if(this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()&&!this.workspaceTrustService.isWorkspaceTrusted()){const a=this.extensionManifestPropertiesService.getExtensionUntrustedWorkspaceSupportType(this.extension.local.manifest),l=Ui((o=this.extension.local.manifest.capabilities)==null?void 0:o.untrustedWorkspaces);if(a==="limited"||l){this.enabled=!0,this.updateStatus({icon:hi,message:new V(l?qi(l):c("extension limited because of trust requirement","This extension has limited features because the current workspace is not trusted."))},!0);return}}if(this.extension.enablementState===1&&!this.extensionsWorkbenchService.installed.some(a=>Fe(a.identifier,this.extension.identifier)&&a.server!==this.extension.server)){let a;this.extensionManagementServerService.localExtensionManagementServer===this.extension.server?this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)&&this.extensionManagementServerService.remoteExtensionManagementServer&&(a=new V(`${c("Install in remote server to enable","This extension is disabled in this workspace because it is defined to run in the Remote Extension Host. Please install the extension in '{0}' to enable.",this.extensionManagementServerService.remoteExtensionManagementServer.label)} [${c("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)):this.extensionManagementServerService.remoteExtensionManagementServer===this.extension.server?this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)&&(this.extensionManagementServerService.localExtensionManagementServer?a=new V(`${c("Install in local server to enable","This extension is disabled in this workspace because it is defined to run in the Local Extension Host. Please install the extension locally to enable.",this.extensionManagementServerService.remoteExtensionManagementServer.label)} [${c("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`):Jt&&(a=new V(`${c("Defined to run in desktop","This extension is disabled because it is defined to run only in {0} for the Desktop.",this.productService.nameLong)} [${c("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`))):this.extensionManagementServerService.webExtensionManagementServer===this.extension.server&&(a=new V(`${c("Cannot be enabled","This extension is disabled because it is not supported in {0} for the Web.",this.productService.nameLong)} [${c("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)),a&&this.updateStatus({icon:we,message:a},!0);return}if(this.extensionManagementServerService.remoteExtensionManagementServer){if(ua(this.extension.local.manifest)){if(!this.extensionsWorkbenchService.installed.some(h=>Fe(h.identifier,this.extension.identifier)&&h.server!==this.extension.server)){const h=this.extension.server===this.extensionManagementServerService.localExtensionManagementServer?new V(c("Install language pack also in remote server","Install the language pack extension on '{0}' to enable it there also.",this.extensionManagementServerService.remoteExtensionManagementServer.label)):new V(c("Install language pack also locally","Install the language pack extension locally to enable it there also."));this.updateStatus({icon:Be,message:h},!0)}return}const a=this.extensionService.extensions.filter(h=>Fe({id:h.identifier.value,uuid:h.uuid},this.extension.identifier))[0],l=a?this.extensionManagementServerService.getExtensionManagementServer(Yo(a)):null;if(this.extension.server===this.extensionManagementServerService.localExtensionManagementServer&&l===this.extensionManagementServerService.remoteExtensionManagementServer){this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)&&this.updateStatus({icon:Be,message:new V(`${c("enabled remotely","This extension is enabled in the Remote Extension Host because it prefers to run there.")} [${c("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)},!0);return}if(this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer&&l===this.extensionManagementServerService.localExtensionManagementServer){this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)&&this.updateStatus({icon:Be,message:new V(`${c("enabled locally","This extension is enabled in the Local Extension Host because it prefers to run there.")} [${c("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)},!0);return}if(this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer&&l===this.extensionManagementServerService.webExtensionManagementServer){this.extensionManifestPropertiesService.canExecuteOnWeb(this.extension.local.manifest)&&this.updateStatus({icon:Be,message:new V(`${c("enabled in web worker","This extension is enabled in the Web Worker Extension Host because it prefers to run there.")} [${c("learn more","Learn More")}](https://aka.ms/vscode-remote/developing-extensions/architecture)`)},!0);return}}if(this.extension.enablementState===5){this.updateStatus({icon:we,message:new V(c("extension disabled because of dependency","This extension has been disabled because it depends on an extension that is disabled."))},!0);return}const e=this.workbenchExtensionEnablementService.isEnabled(this.extension.local),t=this.extensionService.extensions.some(a=>Fe({id:a.identifier.value,uuid:a.uuid},this.extension.identifier));if(e&&t){if(this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManagementServerService.remoteExtensionManagementServer&&this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer){this.updateStatus({message:new V(c("extension enabled on remote","Extension is enabled on '{0}'",this.extension.server.label))},!0);return}if(this.extension.enablementState===8){this.updateStatus({message:new V(c("globally enabled","This extension is enabled globally."))},!0);return}if(this.extension.enablementState===9){this.updateStatus({message:new V(c("workspace enabled","This extension is enabled for this workspace by the user."))},!0);return}}if(!e&&!t){if(this.extension.enablementState===6){this.updateStatus({message:new V(c("globally disabled","This extension is disabled globally by the user."))},!0);return}if(this.extension.enablementState===7){this.updateStatus({message:new V(c("workspace disabled","This extension is disabled for this workspace by the user."))},!0);return}}if(e&&!t&&!this.extension.local.isValid){const a=this.extension.local.validations.filter(([l])=>l===ne.Error).map(([,l])=>l);this.updateStatus({icon:jt,message:new V(a.join(" ").trim())},!0)}}updateStatus(e,t){var i,n,s,o,a,l;this._status!==e&&(this._status&&e&&this._status.message===e.message&&((i=this._status.icon)==null?void 0:i.id)===((n=e.icon)==null?void 0:n.id)||(this._status=e,t&&(((s=this._status)==null?void 0:s.icon)===jt?this.class=`${xt.CLASS} extension-status-error ${E.asClassName(jt)}`:((o=this._status)==null?void 0:o.icon)===we?this.class=`${xt.CLASS} extension-status-warning ${E.asClassName(we)}`:((a=this._status)==null?void 0:a.icon)===Be?this.class=`${xt.CLASS} extension-status-info ${E.asClassName(Be)}`:((l=this._status)==null?void 0:l.icon)===hi?this.class=`${xt.CLASS} ${E.asClassName(hi)}`:this.class=`${xt.CLASS} hide`),this._onDidChangeStatus.fire()))}async run(){var e;if(((e=this._status)==null?void 0:e.icon)===hi)return this.commandService.executeCommand("workbench.trust.manage")}};Ks.CLASS=`${T.ICON_ACTION_CLASS} extension-status`;Ks=w([d(0,Ni),d(1,$i),d(2,pe),d(3,Pl),d(4,Al),d(5,te),d(6,ue),d(7,Vr),d(8,_e),d(9,Fi),d(10,Ge)],Ks);let Rn=class Us extends j{constructor(e=Us.ID,t=Us.LABEL,i,n,s,o,a,l,h){super(e,t),this.extensionsWorkbenchService=i,this.extensionManagementServerService=n,this.quickInputService=s,this.notificationService=o,this.hostService=a,this.instantiationService=l,this.extensionService=h}get enabled(){return this.extensionsWorkbenchService.local.filter(e=>!e.isBuiltin&&e.local).length>0}run(){return this.quickInputService.pick(this.getEntries(),{placeHolder:c("selectExtensionToReinstall","Select Extension to Reinstall")}).then(e=>e&&this.reinstallExtension(e.extension))}getEntries(){return this.extensionsWorkbenchService.queryLocal().then(e=>e.filter(i=>!i.isBuiltin&&i.server!==this.extensionManagementServerService.webExtensionManagementServer).map(i=>({id:i.identifier.id,label:i.displayName,description:i.identifier.id,extension:i})))}reinstallExtension(e){return this.instantiationService.createInstance(Pn,"@installed ").run().then(()=>this.extensionsWorkbenchService.reinstall(e).then(t=>{const i=!(t.local&&this.extensionService.canAddExtension(un(t.local))),n=i?c("ReinstallAction.successReload","Please reload Visual Studio Code to complete reinstalling the extension {0}.",t.identifier.id):c("ReinstallAction.success","Reinstalling the extension {0} is completed.",t.identifier.id),s=i?[{label:c("InstallVSIXAction.reloadNow","Reload Now"),run:()=>this.hostService.reload()}]:[];this.notificationService.prompt(ne.Info,n,s,{sticky:!0})},t=>this.notificationService.error(t)))}};Rn.ID="workbench.extensions.action.reinstall";Rn.LABEL=c("reinstall","Reinstall Extension...");Rn=w([d(2,te),d(3,Ni),d(4,le),d(5,se),d(6,Xo),d(7,B),d(8,ue)],Rn);let Mn=class qs extends j{constructor(e=qs.ID,t=qs.LABEL,i,n,s,o){super(e,t),this.extensionsWorkbenchService=i,this.quickInputService=n,this.instantiationService=s,this.extensionEnablementService=o}get enabled(){return this.extensionsWorkbenchService.local.some(e=>this.isEnabled(e))}async run(){const e=await this.quickInputService.pick(this.getExtensionEntries(),{placeHolder:c("selectExtension","Select Extension"),matchOnDetail:!0});if(e&&e.extension){const t=this.instantiationService.createInstance(Lt);t.extension=e.extension,await t.run(),await this.instantiationService.createInstance(Pn,e.extension.identifier.id).run()}}isEnabled(e){const t=this.instantiationService.createInstance(Lt);return t.extension=e,t.enabled&&!!e.local&&this.extensionEnablementService.isEnabled(e.local)}async getExtensionEntries(){const e=await this.extensionsWorkbenchService.queryLocal(),t=[];for(const i of e)this.isEnabled(i)&&t.push({id:i.identifier.id,label:i.displayName||i.identifier.id,description:i.identifier.id,extension:i});return t.sort((i,n)=>i.extension.displayName.localeCompare(n.extension.displayName))}};Mn.ID="workbench.extensions.action.install.specificVersion";Mn.LABEL=c("install previous version","Install Specific Version of Extension...");Mn=w([d(2,te),d(3,le),d(4,B),d(5,Ge)],Mn);jn.registerCommand("workbench.extensions.action.showExtensionsForLanguage",function(r,e){return r.get(Oi).openPaneComposite(Vi,0,!0).then(i=>i==null?void 0:i.getViewPaneContainer()).then(i=>{i.search(`ext:${e.replace(/^\./,"")}`),i.focus()})});jn.registerCommand("workbench.extensions.action.showExtensionsWithIds",function(r,e){return r.get(Oi).openPaneComposite(Vi,0,!0).then(i=>i==null?void 0:i.getViewPaneContainer()).then(i=>{const n=e.map(s=>`@id:${s}`).join(" ");i.search(n),i.focus()})});Bt("extensionButton.background",{dark:gn,light:gn,hcDark:null,hcLight:null},c("extensionButtonBackground","Button background color for extension actions."));Bt("extensionButton.foreground",{dark:pn,light:pn,hcDark:null,hcLight:null},c("extensionButtonForeground","Button foreground color for extension actions."));Bt("extensionButton.hoverBackground",{dark:fn,light:fn,hcDark:null,hcLight:null},c("extensionButtonHoverBackground","Button background hover color for extension actions."));Bt("extensionButton.separator",{dark:Ki,light:Ki,hcDark:Ki,hcLight:Ki},c("extensionButtonSeparator","Button separator color for extension actions"));Bt("extensionButton.prominentBackground",{dark:gn,light:gn,hcDark:null,hcLight:null},c("extensionButtonProminentBackground","Button background color for extension actions that stand out (e.g. install button)."));Bt("extensionButton.prominentForeground",{dark:pn,light:pn,hcDark:null,hcLight:null},c("extensionButtonProminentForeground","Button foreground color for extension actions that stand out (e.g. install button)."));Bt("extensionButton.prominentHoverBackground",{dark:fn,light:fn,hcDark:null,hcLight:null},c("extensionButtonProminentHoverBackground","Button background hover color for extension actions that stand out (e.g. install button)."));El((r,e)=>{const t=r.getColor(Ll);t&&(e.addRule(`.extension-editor .header .actions-status-container > .status ${E.asCSSSelector(jt)} { color: ${t}; }`),e.addRule(`.extension-editor .body .subcontent .runtime-status ${E.asCSSSelector(jt)} { color: ${t}; }`),e.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${E.asCSSSelector(jt)} { color: ${t}; }`));const i=r.getColor(Rl);i&&(e.addRule(`.extension-editor .header .actions-status-container > .status ${E.asCSSSelector(we)} { color: ${i}; }`),e.addRule(`.extension-editor .body .subcontent .runtime-status ${E.asCSSSelector(we)} { color: ${i}; }`),e.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${E.asCSSSelector(we)} { color: ${i}; }`));const n=r.getColor(Ml);n&&(e.addRule(`.extension-editor .header .actions-status-container > .status ${E.asCSSSelector(Be)} { color: ${n}; }`),e.addRule(`.extension-editor .body .subcontent .runtime-status ${E.asCSSSelector(Be)} { color: ${n}; }`),e.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${E.asCSSSelector(Be)} { color: ${n}; }`))});let Fn=class{get onConfigChanged(){return this._onConfigChanged.event}constructor(e,t,i,n,s){this._configurationService=e,this._extensionManagementService=t,this._notificationService=i,this._instantiationService=n,this._productService=s,this._linuxDistro=1,this._onConfigChanged=new b,this._recommendationsShown=!1,this._updateConfig(),this._configurationService.onDidChangeConfiguration(o=>{o.affectsConfiguration(mo)&&this._updateConfig()}),Kn&&(navigator.userAgent.includes("Ubuntu")?this._linuxDistro=3:navigator.userAgent.includes("Fedora")&&(this._linuxDistro=2))}_updateConfig(){const e=this._configurationService.getValue(mo);e.fontWeight=this._normalizeFontWeight(e.fontWeight,bc),e.fontWeightBold=this._normalizeFontWeight(e.fontWeightBold,wc),this.config=e,this._onConfigChanged.fire()}configFontIsMonospace(){const t=this.config.fontFamily||this._configurationService.getValue("editor").fontFamily||ji.fontFamily,i=this._getBoundingRectFor("i",t,15),n=this._getBoundingRectFor("w",t,15);return!i||!n||!i.width||!n.width?!0:i.width===n.width}_createCharMeasureElementIfNecessary(){if(!this.panelContainer)throw new Error("Cannot measure element when terminal is not attached");return(!this._charMeasureElement||!this._charMeasureElement.parentElement)&&(this._charMeasureElement=document.createElement("div"),this.panelContainer.appendChild(this._charMeasureElement)),this._charMeasureElement}_getBoundingRectFor(e,t,i){let n;try{n=this._createCharMeasureElementIfNecessary()}catch{return}const s=n.style;s.display="inline-block",s.fontFamily=t,s.fontSize=i+"px",s.lineHeight="normal",n.innerText=e;const o=n.getBoundingClientRect();return s.display="none",o}_measureFont(e,t,i,n){const s=this._getBoundingRectFor("X",e,t);if(this._lastFontMeasurement&&(!s||!s.width||!s.height))return this._lastFontMeasurement;if(this._lastFontMeasurement={fontFamily:e,fontSize:t,letterSpacing:i,lineHeight:n,charWidth:0,charHeight:0},s&&s.width&&s.height)if(this._lastFontMeasurement.charHeight=Math.ceil(s.height),this.config.gpuAcceleration==="off")this._lastFontMeasurement.charWidth=s.width;else{const l=(Math.floor(s.width*window.devicePixelRatio)+Math.round(i))/window.devicePixelRatio;this._lastFontMeasurement.charWidth=l-Math.round(i)/window.devicePixelRatio}return this._lastFontMeasurement}getFont(e,t){var l,h;const i=this._configurationService.getValue("editor");let n=this.config.fontFamily||i.fontFamily||ji.fontFamily,s=this._clampInt(this.config.fontSize,6,100,ji.fontSize);this.config.fontFamily||(this._linuxDistro===2&&(n="'DejaVu Sans Mono'"),this._linuxDistro===3&&(n="'Ubuntu Mono'",s=this._clampInt(s+2,6,100,ji.fontSize))),n+=", monospace";const o=this.config.letterSpacing?Math.max(Math.floor(this.config.letterSpacing),Sc):Qo,a=this.config.lineHeight?Math.max(this.config.lineHeight,1):Jo;return t?{fontFamily:n,fontSize:s,letterSpacing:o,lineHeight:a}:e&&e._renderService&&(l=e._renderService.dimensions)!=null&&l.css.cell.width&&(h=e._renderService.dimensions)!=null&&h.css.cell.height?{fontFamily:n,fontSize:s,letterSpacing:o,lineHeight:a,charHeight:e._renderService.dimensions.css.cell.height/a,charWidth:e._renderService.dimensions.css.cell.width-Math.round(o)/window.devicePixelRatio}:this._measureFont(n,s,o,a)}_clampInt(e,t,i,n){let s=parseInt(e,10);return isNaN(s)?n:(typeof t=="number"&&(s=Math.max(t,s)),typeof i=="number"&&(s=Math.min(i,s)),s)}async showRecommendations(e){if(!this._recommendationsShown&&(this._recommendationsShown=!0,re&&e.executable&&Zt(e.executable).toLowerCase()==="wsl.exe")){const t=this._productService.exeBasedExtensionTips;if(!t||!t.wsl)return;const i=Object.keys(t.wsl.recommendations).find(n=>t.wsl.recommendations[n].important);i&&!await this._isExtensionInstalled(i)&&this._notificationService.prompt(Oe.Info,c("useWslExtension.title","The '{0}' extension is recommended for opening a terminal in WSL.",t.wsl.friendlyName),[{label:c("install","Install"),run:()=>{this._instantiationService.createInstance(Di,i).run()}}],{sticky:!0,neverShowAgain:{id:"terminalConfigHelper/launchRecommendationsIgnore",scope:Hl.APPLICATION},onCancel:()=>{}})}}async _isExtensionInstalled(e){return(await this._extensionManagementService.getInstalled()).some(i=>i.identifier.id===e)}_normalizeFontWeight(e,t){return e==="normal"||e==="bold"?e:this._clampInt(e,Ss,Cs,t)}};Fn=w([d(0,X),d(1,vc),d(2,se),d(3,B),d(4,Fi)],Fn);let js=class{constructor(e,t,i,n,s,o){this._terminalProfileService=e,this._terminalProfileResolverService=t,this._configurationService=i,this._quickInputService=n,this._themeService=s,this._notificationService=o}async showAndGetResult(e){const t=await this._terminalProfileService.getPlatformKey(),i="terminal.integrated.profiles."+t,n=await this._createAndShow(e),s=`terminal.integrated.defaultProfile.${t}`;if(n){if(e==="setDefault"){if("command"in n.profile)return;if("id"in n.profile)return await this._configurationService.updateValue(s,n.profile.title,2),{config:{extensionIdentifier:n.profile.extensionIdentifier,id:n.profile.id,title:n.profile.title,options:{color:n.profile.color,icon:n.profile.icon}},keyMods:n.keyMods};if("isAutoDetected"in n.profile){const o=await this._configurationService.getValue(i);if(typeof o=="object"){const a={path:n.profile.path};n.profile.args&&(a.args=n.profile.args),o[n.profile.profileName]=a}await this._configurationService.updateValue(i,o,2)}await this._configurationService.updateValue(s,n.profileName,2)}else if(e==="createInstance")return"id"in n.profile?{config:{extensionIdentifier:n.profile.extensionIdentifier,id:n.profile.id,title:n.profile.title,options:{icon:n.profile.icon,color:n.profile.color}},keyMods:n.keyMods}:{config:n.profile,keyMods:n.keyMods};return"profileName"in n.profile?n.profile.profileName:n.profile.title}}async _createAndShow(e){const t=await this._terminalProfileService.getPlatformKey(),i=this._terminalProfileService.availableProfiles,n="terminal.integrated.profiles."+t,s=this._terminalProfileService.getDefaultProfileName();let o;const a={placeHolder:e==="createInstance"?c("terminal.integrated.selectProfileToCreate","Select the terminal profile to create"):c("terminal.integrated.chooseDefaultProfile","Select your default terminal profile"),onDidTriggerItemButton:async _=>{if(!await this._isProfileSafe(_.item.profile)||"command"in _.item.profile||"id"in _.item.profile)return;const S=this._configurationService.getValue("terminal.integrated.profiles."+t),y=S?Object.keys(S):[],M=await this._quickInputService.input({prompt:c("enterTerminalProfileName","Enter terminal profile name"),value:_.item.profile.profileName,validateInput:async R=>{if(y.includes(R))return c("terminalProfileAlreadyExists","A terminal profile already exists with that name")}});if(!M)return;const D={...S};D[M]={path:_.item.profile.path,args:_.item.profile.args},await this._configurationService.updateValue(n,D,2)},onKeyMods:_=>o=_},l=[],h=i.filter(_=>!_.isAutoDetected),m=i.filter(_=>_.isAutoDetected);h.length>0&&(l.push({type:"separator",label:c("terminalProfiles","profiles")}),l.push(...this._sortProfileQuickPickItems(h.map(_=>this._createProfileQuickPickItem(_)),s))),l.push({type:"separator",label:c("ICreateContributedTerminalProfileOptions","contributed")});const p=[];for(const _ of this._terminalProfileService.contributedProfiles){let S;typeof _.icon=="string"&&(_.icon.startsWith("$(")?S=E.fromString(_.icon):S=E.fromId(_.icon)),(!S||!Jn().getIcon(S.id))&&(S=this._terminalProfileResolverService.getDefaultIcon());const y=Wt(_,this._themeService.getColorTheme().type,!0),M=ut(_),D=[];y&&D.push(...y),M&&D.push(M),p.push({label:`$(${S.id}) ${_.title}`,profile:{extensionIdentifier:_.extensionIdentifier,title:_.title,icon:_.icon,id:_.id,color:_.color},profileName:_.title,iconClasses:D})}p.length>0&&l.push(...this._sortProfileQuickPickItems(p,s)),m.length>0&&(l.push({type:"separator",label:c("terminalProfiles.detected","detected")}),l.push(...this._sortProfileQuickPickItems(m.map(_=>this._createProfileQuickPickItem(_)),s)));const v=Zo(this._themeService.getColorTheme());document.body.appendChild(v);const f=await this._quickInputService.pick(l,a);if(document.body.removeChild(v),!!f&&await this._isProfileSafe(f.profile))return o&&(f.keyMods=o),f}async _isProfileSafe(e){const t="isUnsafePath"in e&&e.isUnsafePath,i="requiresUnsafePath"in e&&e.requiresUnsafePath;return!t&&!i?!0:await new Promise(n=>{const s=[];t&&s.push(e.path),i&&s.push(i),this._notificationService.prompt(ne.Warning,c("unsafePathWarning","This terminal profile uses a potentially unsafe path that can be modified by another user: {0}. Are you sure you want to use it?",`"${s.join(",")}"`),[{label:c("yes","Yes"),run:()=>n(!0)},{label:c("cancel","Cancel"),run:()=>n(!1)}]).onDidClose(()=>n(!1))})}_createProfileQuickPickItem(e){const t=[{iconClass:E.asClassName(od),tooltip:c("createQuickLaunchProfile","Configure Terminal Profile")}],n=`$(${(e.icon&&E.isThemeIcon(e.icon)?e.icon:k.terminal).id}) ${e.profileName}`,s=e.isFromPath?Zt(e.path):e.path,o=ut(e),a=[];if(o&&a.push(o),e.args){if(typeof e.args=="string")return{label:n,description:`${e.path} ${e.args}`,profile:e,profileName:e.profileName,buttons:t,iconClasses:a};const l=e.args.map(h=>h.includes(" ")?`"${h.replace(/"/g,'\\"')}"`:h).join(" ");return{label:n,description:`${s} ${l}`,profile:e,profileName:e.profileName,buttons:t,iconClasses:a}}return{label:n,description:s,profile:e,profileName:e.profileName,buttons:t,iconClasses:a}}_sortProfileQuickPickItems(e,t){return e.sort((i,n)=>n.profileName===t?1:i.profileName===t?-1:i.profileName.localeCompare(n.profileName))}};js=w([d(0,tt),d(1,vt),d(2,X),d(3,le),d(4,de),d(5,se)],js);function Zr(r){const[,e,t]=r.path.split("/");if(!e||!Number.parseInt(t))throw new Error(`Could not parse terminal uri for resource ${r}`);return{workspaceId:e,instanceId:Number.parseInt(t)}}function Ka(r,e,t){return L.from({scheme:$.vscodeTerminal,path:`/${r}/${e}`,fragment:t||void 0})}function Ua(r){var t;const e=(t=r.dataTransfer)==null?void 0:t.getData("Terminals");if(e){const i=JSON.parse(e),n=[];for(const s of i)n.push(L.parse(s));return n.length===0?void 0:n}}function eo(r,e){if(e){for(const t of r)if(t.resource.path===e.path)return t}}var U;(function(r){r[r.Top=0]="Top",r[r.Bottom=1]="Bottom"})(U||(U={}));let Xs=class extends H{activate(e){this._terminal=e,this._register(this._terminal.onData(()=>{this._currentMarker=U.Bottom}))}constructor(e,t){super(),this._capabilities=e,this._themeService=t,this._currentMarker=U.Bottom,this._selectionStart=null,this._isDisposable=!1}_getMarkers(e){var o,a;const t=this._capabilities.get(2),i=this._capabilities.get(3),n=this._capabilities.get(4);let s=[];if(t?s=Gl(t.commands.map(l=>l.marker)):i&&s.push(...i.commands),n&&!e){let l=(o=n.markers().next())==null?void 0:o.value;const h=[];for(;l;)h.push(l),l=(a=n.markers().next())==null?void 0:a.value;s=h}return s}clearMarker(){this._currentMarker=U.Bottom,this._resetNavigationDecorations(),this._selectionStart=null}_resetNavigationDecorations(){this._navigationDecorations&&ee(this._navigationDecorations),this._navigationDecorations=[]}_isEmptyCommand(e){return e===U.Bottom?!0:e===U.Top?!this._getMarkers(!0).map(t=>t.line).includes(0):!this._getMarkers(!0).includes(e)}scrollToPreviousMark(e=1,t=!1,i=!1){if(!this._terminal)return;t||(this._selectionStart=null);let n;const s=typeof this._currentMarker=="object"?this._getTargetScrollLine(this._terminal,this._currentMarker,e):Math.min(_i(this._terminal,this._currentMarker),this._terminal.buffer.active.baseY),o=this._terminal.buffer.active.viewportY;if(typeof this._currentMarker=="object"?!this._isMarkerInViewport(this._terminal,this._currentMarker):s!==o){const a=this._getMarkers(i).filter(l=>l.line>=o).length;n=this._getMarkers(i).length-a-1}else this._currentMarker===U.Bottom?n=this._getMarkers(i).length-1:this._currentMarker===U.Top?n=-1:this._isDisposable?(n=this._findPreviousMarker(this._terminal,i),this._currentMarker.dispose(),this._isDisposable=!1):i&&this._isEmptyCommand(this._currentMarker)?n=this._findPreviousMarker(this._terminal,!0):n=this._getMarkers(i).indexOf(this._currentMarker)-1;if(n<0){this._currentMarker=U.Top,this._terminal.scrollToTop(),this._resetNavigationDecorations();return}this._currentMarker=this._getMarkers(i)[n],this._scrollToMarker(this._currentMarker,e)}scrollToNextMark(e=1,t=!1,i=!0){if(!this._terminal)return;t||(this._selectionStart=null);let n;const s=typeof this._currentMarker=="object"?this._getTargetScrollLine(this._terminal,this._currentMarker,e):Math.min(_i(this._terminal,this._currentMarker),this._terminal.buffer.active.baseY),o=this._terminal.buffer.active.viewportY;if((typeof this._currentMarker=="object"?!this._isMarkerInViewport(this._terminal,this._currentMarker):s!==o)?n=this._getMarkers(i).filter(l=>l.line<=o).length:this._currentMarker===U.Bottom?n=this._getMarkers(i).length:this._currentMarker===U.Top?n=0:this._isDisposable?(n=this._findNextMarker(this._terminal,i),this._currentMarker.dispose(),this._isDisposable=!1):i&&this._isEmptyCommand(this._currentMarker)?n=this._findNextMarker(this._terminal,!0):n=this._getMarkers(i).indexOf(this._currentMarker)+1,n>=this._getMarkers(i).length){this._currentMarker=U.Bottom,this._terminal.scrollToBottom(),this._resetNavigationDecorations();return}this._currentMarker=this._getMarkers(i)[n],this._scrollToMarker(this._currentMarker,e)}_scrollToMarker(e,t,i,n){if(this._terminal){if(!this._isMarkerInViewport(this._terminal,e)){const s=this._getTargetScrollLine(this._terminal,e,t);this._terminal.scrollToLine(s)}n||this._registerTemporaryDecoration(e,i)}}_createMarkerForOffset(e,t){var i;if(t===0)return e;{const n=(i=this._terminal)==null?void 0:i.registerMarker(-this._terminal.buffer.active.cursorY+e.line-this._terminal.buffer.active.baseY+t);if(n)return n;throw new Error(`Could not register marker with offset ${e.line}, ${t}`)}}_registerTemporaryDecoration(e,t){var o;if(!this._terminal)return;this._resetNavigationDecorations();const i=this._themeService.getColorTheme().getColor(ea),n=e.line,s=t?t.line-n+1:1;for(let a=0;a<s;a++){const l=this._terminal.registerDecoration({marker:this._createMarkerForOffset(e,a),width:this._terminal.cols,overviewRulerOptions:{color:(i==null?void 0:i.toString())||"#a0a0a0cc"}});if(l){(o=this._navigationDecorations)==null||o.push(l);let h;l.onRender(m=>{var p;h||(h=m,s>1?m.classList.add("terminal-scroll-highlight"):m.classList.add("terminal-scroll-highlight","terminal-scroll-highlight-outline"),(p=this._terminal)!=null&&p.element&&(m.style.marginLeft=`-${getComputedStyle(this._terminal.element).paddingLeft}`))}),l.onDispose(()=>{var m;this._navigationDecorations=(m=this._navigationDecorations)==null?void 0:m.filter(p=>p!==l)}),Pt(350).then(()=>{h&&h.classList.remove("terminal-scroll-highlight-outline")})}}}_getTargetScrollLine(e,t,i){return i===1?Math.max(t.line-Math.floor(e.rows/4),0):t.line}_isMarkerInViewport(e,t){const i=e.buffer.active.viewportY;return t.line>=i&&t.line<i+e.rows}scrollToClosestMarker(e,t,i){const n=this._capabilities.get(4);if(!n)return;const s=n.getMark(e);if(!s)return;const o=t?n.getMark(t):s;this._scrollToMarker(s,0,o,!i)}selectToPreviousMark(){this._terminal&&(this._selectionStart===null&&(this._selectionStart=this._currentMarker),this._capabilities.has(2)?this.scrollToPreviousMark(1,!0,!0):this.scrollToPreviousMark(1,!0,!1),Ji(this._terminal,this._currentMarker,this._selectionStart))}selectToNextMark(){this._terminal&&(this._selectionStart===null&&(this._selectionStart=this._currentMarker),this._capabilities.has(2)?this.scrollToNextMark(1,!0,!0):this.scrollToNextMark(1,!0,!1),Ji(this._terminal,this._currentMarker,this._selectionStart))}selectToPreviousLine(){this._terminal&&(this._selectionStart===null&&(this._selectionStart=this._currentMarker),this.scrollToPreviousLine(this._terminal,1,!0),Ji(this._terminal,this._currentMarker,this._selectionStart))}selectToNextLine(){this._terminal&&(this._selectionStart===null&&(this._selectionStart=this._currentMarker),this.scrollToNextLine(this._terminal,1,!0),Ji(this._terminal,this._currentMarker,this._selectionStart))}scrollToPreviousLine(e,t=1,i=!1){if(i||(this._selectionStart=null),this._currentMarker===U.Top){e.scrollToTop();return}if(this._currentMarker===U.Bottom)this._currentMarker=this._registerMarkerOrThrow(e,this._getOffset(e)-1);else{const n=this._getOffset(e);this._isDisposable&&this._currentMarker.dispose(),this._currentMarker=this._registerMarkerOrThrow(e,n-1)}this._isDisposable=!0,this._scrollToMarker(this._currentMarker,t)}scrollToNextLine(e,t=1,i=!1){if(i||(this._selectionStart=null),this._currentMarker===U.Bottom){e.scrollToBottom();return}if(this._currentMarker===U.Top)this._currentMarker=this._registerMarkerOrThrow(e,this._getOffset(e)+1);else{const n=this._getOffset(e);this._isDisposable&&this._currentMarker.dispose(),this._currentMarker=this._registerMarkerOrThrow(e,n+1)}this._isDisposable=!0,this._scrollToMarker(this._currentMarker,t)}_registerMarkerOrThrow(e,t){const i=e.registerMarker(t);if(!i)throw new Error(`Could not create marker for ${t}`);return i}_getOffset(e){if(this._currentMarker===U.Bottom)return 0;if(this._currentMarker===U.Top)return 0-(e.buffer.active.baseY+e.buffer.active.cursorY);{let t=_i(e,this._currentMarker);return t-=e.buffer.active.baseY+e.buffer.active.cursorY,t}}_findPreviousMarker(e,t=!1){if(this._currentMarker===U.Top)return 0;if(this._currentMarker===U.Bottom)return this._getMarkers(t).length-1;let i;for(i=this._getMarkers(t).length-1;i>=0;i--)if(this._getMarkers(t)[i].line<this._currentMarker.line)return i;return-1}_findNextMarker(e,t=!1){if(this._currentMarker===U.Top)return 0;if(this._currentMarker===U.Bottom)return this._getMarkers(t).length-1;let i;for(i=0;i<this._getMarkers(t).length;i++)if(this._getMarkers(t)[i].line>this._currentMarker.line)return i;return this._getMarkers(t).length}};Xs=w([d(1,de)],Xs);function _i(r,e){return e===U.Bottom?r.buffer.active.baseY+r.rows-1:e===U.Top?0:e.line}function Ji(r,e,t){t===null&&(t=U.Bottom);let i=_i(r,e),n=_i(r,t);if(i>n){const s=i;i=n,n=s}n-=1,r.selectLines(i,n)}class to extends H{constructor(){super(...arguments),this._map=new Map,this._onDidRemoveCapability=this._register(new b),this.onDidRemoveCapability=this._onDidRemoveCapability.event,this._onDidAddCapability=this._register(new b),this.onDidAddCapability=this._onDidAddCapability.event}get items(){return this._map.keys()}add(e,t){this._map.set(e,t),this._onDidAddCapability.fire(e)}get(e){return this._map.get(e)}remove(e){this._map.has(e)&&(this._map.delete(e),this._onDidRemoveCapability.fire(e))}has(e){return this._map.has(e)}}class Md extends H{constructor(){super(...arguments),this._stores=[],this._onDidRemoveCapability=this._register(new b),this.onDidRemoveCapability=this._onDidRemoveCapability.event,this._onDidAddCapability=this._register(new b),this.onDidAddCapability=this._onDidAddCapability.event}get items(){return this._items()}*_items(){for(const e of this._stores)for(const t of e.items)yield t}has(e){for(const t of this._stores)for(const i of t.items)if(i===e)return!0;return!1}get(e){for(const t of this._stores){const i=t.get(e);if(i)return i}}add(e){this._stores.push(e);for(const t of e.items)this._onDidAddCapability.fire(t);e.onDidAddCapability(t=>this._onDidAddCapability.fire(t)),e.onDidRemoveCapability(t=>this._onDidRemoveCapability.fire(t))}}class Ys{get commands(){return this._commands}get executingCommand(){return this._currentCommand.command}get executingCommandObject(){if(this._currentCommand.commandStartMarker)return{marker:this._currentCommand.commandStartMarker}}get cwd(){return this._cwd}get _isInputting(){return!!(this._currentCommand.commandStartMarker&&!this._currentCommand.commandExecutedMarker)}get hasInput(){var e,t,i;if(!(!this._isInputting||!((e=this._currentCommand)!=null&&e.commandStartMarker))){if(this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY===((t=this._currentCommand.commandStartMarker)==null?void 0:t.line)){const n=(i=this._terminal.buffer.active.getLine(this._terminal.buffer.active.cursorY))==null?void 0:i.translateToString(!0,this._currentCommand.commandStartX);return n===void 0?void 0:n.length>0}return!0}}constructor(e,t){this._terminal=e,this._logService=t,this.type=2,this._commands=[],this._currentCommand={},this._isWindowsPty=!1,this._commandMarkers=[],this.__isCommandStorageDisabled=!1,this._onCommandStarted=new b,this.onCommandStarted=this._onCommandStarted.event,this._onBeforeCommandFinished=new b,this.onBeforeCommandFinished=this._onBeforeCommandFinished.event,this._onCommandFinished=new b,this.onCommandFinished=this._onCommandFinished.event,this._onCommandExecuted=new b,this.onCommandExecuted=this._onCommandExecuted.event,this._onCommandInvalidated=new b,this.onCommandInvalidated=this._onCommandInvalidated.event,this._onCurrentCommandInvalidated=new b,this.onCurrentCommandInvalidated=this._onCurrentCommandInvalidated.event,this._dimensions={cols:this._terminal.cols,rows:this._terminal.rows},this._terminal.onResize(i=>this._handleResize(i)),this._terminal.onCursorMove(()=>this._handleCursorMove()),this._setupClearListeners()}_handleResize(e){this._isWindowsPty&&this._preHandleResizeWindows(e),this._dimensions.cols=e.cols,this._dimensions.rows=e.rows}_handleCursorMove(){this._terminal.buffer.active===this._terminal.buffer.normal&&this._currentCommand.commandStartMarker&&this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY<this._currentCommand.commandStartMarker.line&&(this._clearCommandsInViewport(),this._currentCommand.isInvalid=!0,this._onCurrentCommandInvalidated.fire({reason:"windows"}))}_setupClearListeners(){this.onBeforeCommandFinished(e=>{this._isWindowsPty&&(e.command.trim().toLowerCase()==="clear"||e.command.trim().toLowerCase()==="cls")&&(this._clearCommandsInViewport(),this._currentCommand.isInvalid=!0,this._onCurrentCommandInvalidated.fire({reason:"windows"}))}),this._terminal.parser.registerCsiHandler({final:"J"},e=>(this._isWindowsPty||e.length>=1&&(e[0]===2||e[0]===3)&&this._clearCommandsInViewport(),!1))}_preHandleResizeWindows(e){const t=this._terminal.buffer.active.baseY,i=e.rows-this._dimensions.rows;i>0&&this._waitForCursorMove().then(()=>{const n=Math.min(i,t);for(let s=this.commands.length-1;s>=0;s--){const o=this.commands[s];if(!o.marker||o.marker.line<t||o.commandStartLineContent===void 0)break;const a=this._terminal.buffer.active.getLine(o.marker.line);if(!a||a.translateToString(!0)===o.commandStartLineContent)continue;const l=o.marker.line-n,h=this._terminal.buffer.active.getLine(l);(h==null?void 0:h.translateToString(!0))===o.commandStartLineContent&&this._terminal._core._bufferService.buffer.lines.onDeleteEmitter.fire({index:this._terminal.buffer.active.baseY,amount:n})}})}_clearCommandsInViewport(){var t;let e=0;for(let i=this._commands.length-1;i>=0;i--){const n=(t=this._commands[i].marker)==null?void 0:t.line;if(n&&n<this._terminal.buffer.active.baseY)break;e++}e>0&&this._onCommandInvalidated.fire(this._commands.splice(this._commands.length-e,e))}_waitForCursorMove(){const e=this._terminal.buffer.active.cursorX,t=this._terminal.buffer.active.cursorY;let i=0;return new Promise((n,s)=>{const o=setInterval(()=>{if(e!==this._terminal.buffer.active.cursorX||t!==this._terminal.buffer.active.cursorY){n(),clearInterval(o);return}i+=10,i>1e3&&(clearInterval(o),n())},10)})}setCwd(e){this._cwd=e}setIsWindowsPty(e){this._isWindowsPty=e}setIsCommandStorageDisabled(){this.__isCommandStorageDisabled=!0}getCwdForLine(e){var i,n;return this._currentCommand.promptStartMarker&&e>=((i=this._currentCommand.promptStartMarker)==null?void 0:i.line)?this._cwd:(n=[...this._commands].reverse().find(s=>s.marker.line<=e-1))==null?void 0:n.cwd}handlePromptStart(e){var t;this._currentCommand.promptStartMarker=(e==null?void 0:e.marker)||this._terminal.registerMarker(0),this._logService.debug("CommandDetectionCapability#handlePromptStart",this._terminal.buffer.active.cursorX,(t=this._currentCommand.promptStartMarker)==null?void 0:t.line)}handleContinuationStart(){this._currentCommand.currentContinuationMarker=this._terminal.registerMarker(0),this._logService.debug("CommandDetectionCapability#handleContinuationStart",this._currentCommand.currentContinuationMarker)}handleContinuationEnd(){if(!this._currentCommand.currentContinuationMarker){this._logService.warn("CommandDetectionCapability#handleContinuationEnd Received continuation end without start");return}this._currentCommand.continuations||(this._currentCommand.continuations=[]),this._currentCommand.continuations.push({marker:this._currentCommand.currentContinuationMarker,end:this._terminal.buffer.active.cursorX}),this._currentCommand.currentContinuationMarker=void 0,this._logService.debug("CommandDetectionCapability#handleContinuationEnd",this._currentCommand.continuations[this._currentCommand.continuations.length-1])}handleRightPromptStart(){this._currentCommand.commandRightPromptStartX=this._terminal.buffer.active.cursorX,this._logService.debug("CommandDetectionCapability#handleRightPromptStart",this._currentCommand.commandRightPromptStartX)}handleRightPromptEnd(){this._currentCommand.commandRightPromptEndX=this._terminal.buffer.active.cursorX,this._logService.debug("CommandDetectionCapability#handleRightPromptEnd",this._currentCommand.commandRightPromptEndX)}handleCommandStart(e){var t,i,n,s;if(this._handleCommandStartOptions=e,this._currentCommand.commandStartMarker=(e==null?void 0:e.marker)||this._currentCommand.commandStartMarker,((t=this._currentCommand.commandStartMarker)==null?void 0:t.line)===this._terminal.buffer.active.cursorY){this._currentCommand.commandStartX=this._terminal.buffer.active.cursorX,this._logService.debug("CommandDetectionCapability#handleCommandStart",this._currentCommand.commandStartX,(i=this._currentCommand.commandStartMarker)==null?void 0:i.line);return}if(this._isWindowsPty){this._handleCommandStartWindows();return}this._currentCommand.commandStartX=this._terminal.buffer.active.cursorX,this._currentCommand.commandStartMarker=(e==null?void 0:e.marker)||this._terminal.registerMarker(0),(n=this._currentCommand.commandExecutedMarker)==null||n.dispose(),this._currentCommand.commandExecutedMarker=void 0,this._currentCommand.commandExecutedX=void 0;for(const o of this._commandMarkers)o.dispose();this._commandMarkers.length=0,this._onCommandStarted.fire({marker:(e==null?void 0:e.marker)||this._currentCommand.commandStartMarker,markProperties:e==null?void 0:e.markProperties}),this._logService.debug("CommandDetectionCapability#handleCommandStart",this._currentCommand.commandStartX,(s=this._currentCommand.commandStartMarker)==null?void 0:s.line)}_handleCommandStartWindows(){this._currentCommand.commandStartX=this._terminal.buffer.active.cursorX,this._commandMarkers.length=0,Pt(0).then(()=>{var e;if(this._currentCommand.commandExecutedMarker||(this._onCursorMoveListener=this._terminal.onCursorMove(()=>{if(this._commandMarkers.length===0||this._commandMarkers[this._commandMarkers.length-1].line!==this._terminal.buffer.active.cursorY){const t=this._terminal.registerMarker(0);t&&this._commandMarkers.push(t)}})),this._currentCommand.commandStartMarker=this._terminal.registerMarker(0),this._currentCommand.commandStartMarker){const t=this._terminal.buffer.active.getLine(this._currentCommand.commandStartMarker.line);t&&(this._currentCommand.commandStartLineContent=t.translateToString(!0))}this._onCommandStarted.fire({marker:this._currentCommand.commandStartMarker}),this._logService.debug("CommandDetectionCapability#_handleCommandStartWindows",this._currentCommand.commandStartX,(e=this._currentCommand.commandStartMarker)==null?void 0:e.line)})}handleGenericCommand(e){var t;(t=e==null?void 0:e.markProperties)!=null&&t.disableCommandStorage&&this.setIsCommandStorageDisabled(),this.handlePromptStart(e),this.handleCommandStart(e),this.handleCommandExecuted(e),this.handleCommandFinished(void 0,e)}handleCommandExecuted(e){var n,s,o,a;if(this._isWindowsPty){this._handleCommandExecutedWindows();return}if(this._currentCommand.commandExecutedMarker=(e==null?void 0:e.marker)||this._terminal.registerMarker(0),this._currentCommand.commandExecutedX=this._terminal.buffer.active.cursorX,this._logService.debug("CommandDetectionCapability#handleCommandExecuted",this._currentCommand.commandExecutedX,(n=this._currentCommand.commandExecutedMarker)==null?void 0:n.line),!this._currentCommand.commandStartMarker||!this._currentCommand.commandExecutedMarker||this._currentCommand.commandStartX===void 0)return;this._currentCommand.command=this.__isCommandStorageDisabled?"":(s=this._terminal.buffer.active.getLine(this._currentCommand.commandStartMarker.line))==null?void 0:s.translateToString(!0,this._currentCommand.commandStartX,this._currentCommand.commandRightPromptStartX).trim();let t=this._currentCommand.commandStartMarker.line+1;const i=this._currentCommand.commandExecutedMarker.line;for(;t<i;t++){const l=this._terminal.buffer.active.getLine(t);if(l){const h=(o=this._currentCommand.continuations)==null?void 0:o.find(p=>p.marker.line===t);h&&(this._currentCommand.command+=`
`);const m=(h==null?void 0:h.end)??0;this._currentCommand.command+=l.translateToString(!0,m)}}t===i&&(this._currentCommand.command+=((a=this._terminal.buffer.active.getLine(i))==null?void 0:a.translateToString(!0,void 0,this._currentCommand.commandExecutedX))||""),this._onCommandExecuted.fire()}_handleCommandExecutedWindows(){var e,t;(e=this._onCursorMoveListener)==null||e.dispose(),this._onCursorMoveListener=void 0,this._evaluateCommandMarkersWindows(),this._currentCommand.commandExecutedX=this._terminal.buffer.active.cursorX,this._onCommandExecuted.fire(),this._logService.debug("CommandDetectionCapability#handleCommandExecuted",this._currentCommand.commandExecutedX,(t=this._currentCommand.commandExecutedMarker)==null?void 0:t.line)}invalidateCurrentCommand(e){this._currentCommand.isInvalid=!0,this._onCurrentCommandInvalidated.fire(e)}handleCommandFinished(e,t){var n,s,o;this._isWindowsPty&&this._preHandleCommandFinishedWindows(),this._currentCommand.commandFinishedMarker=(t==null?void 0:t.marker)||this._terminal.registerMarker(0);let i=this._currentCommand.command;if(this._logService.debug("CommandDetectionCapability#handleCommandFinished",this._terminal.buffer.active.cursorX,(n=this._currentCommand.commandFinishedMarker)==null?void 0:n.line,this._currentCommand.command,this._currentCommand),this._exitCode=e,this._exitCode===void 0){const a=this.commands.length>0?this.commands[this.commands.length-1]:void 0;i&&i.length>0&&(a==null?void 0:a.command)===i&&(this._exitCode=a.exitCode)}if(!(this._currentCommand.commandStartMarker===void 0||!this._terminal.buffer.active)){if(this._exitCode===void 0&&i===void 0&&(i=""),i!==void 0&&!i.startsWith("\\")||(s=this._handleCommandStartOptions)!=null&&s.ignoreCommandLine){const a=this._terminal.buffer.active,l=Date.now(),h=this._currentCommand.commandExecutedMarker,m=this._currentCommand.commandFinishedMarker,p={command:(o=this._handleCommandStartOptions)!=null&&o.ignoreCommandLine?"":i||"",isTrusted:!!this._currentCommand.isTrusted,marker:this._currentCommand.commandStartMarker,endMarker:m,executedMarker:h,timestamp:l,cwd:this._cwd,exitCode:this._exitCode,commandStartLineContent:this._currentCommand.commandStartLineContent,hasOutput:()=>!(h!=null&&h.isDisposed)&&!(m!=null&&m.isDisposed)&&!!(h&&m&&(h==null?void 0:h.line)<m.line),getOutput:()=>To(h,m,a),getOutputMatch:v=>Do(this._isWindowsPty&&(h==null?void 0:h.line)===(m==null?void 0:m.line)?this._currentCommand.commandStartMarker:h,m,a,this._terminal.cols,v),markProperties:t==null?void 0:t.markProperties};this._commands.push(p),this._logService.debug("CommandDetectionCapability#onCommandFinished",p),this._onBeforeCommandFinished.fire(p),this._currentCommand.isInvalid||this._onCommandFinished.fire(p)}this._currentCommand.previousCommandMarker=this._currentCommand.commandStartMarker,this._currentCommand={},this._handleCommandStartOptions=void 0}}_preHandleCommandFinishedWindows(){this._currentCommand.commandExecutedMarker||(this._commandMarkers.length===0&&(this._currentCommand.commandStartMarker||(this._currentCommand.commandStartMarker=this._terminal.registerMarker(0)),this._currentCommand.commandStartMarker&&this._commandMarkers.push(this._currentCommand.commandStartMarker)),this._evaluateCommandMarkersWindows())}_evaluateCommandMarkersWindows(){if(this._commandMarkers.length!==0){if(this._commandMarkers=this._commandMarkers.sort((e,t)=>e.line-t.line),this._currentCommand.commandStartMarker=this._commandMarkers[0],this._currentCommand.commandStartMarker){const e=this._terminal.buffer.active.getLine(this._currentCommand.commandStartMarker.line);e&&(this._currentCommand.commandStartLineContent=e.translateToString(!0))}this._currentCommand.commandExecutedMarker=this._commandMarkers[this._commandMarkers.length-1]}}setCommandLine(e,t){this._logService.debug("CommandDetectionCapability#setCommandLine",e,t),this._currentCommand.command=e,this._currentCommand.isTrusted=t}serialize(){const e=this.commands.map(t=>{var i,n,s;return{startLine:(i=t.marker)==null?void 0:i.line,startX:void 0,endLine:(n=t.endMarker)==null?void 0:n.line,executedLine:(s=t.executedMarker)==null?void 0:s.line,command:this.__isCommandStorageDisabled?"":t.command,isTrusted:t.isTrusted,cwd:t.cwd,exitCode:t.exitCode,commandStartLineContent:t.commandStartLineContent,timestamp:t.timestamp,markProperties:t.markProperties,aliases:t.aliases}});return this._currentCommand.commandStartMarker&&e.push({startLine:this._currentCommand.commandStartMarker.line,startX:this._currentCommand.commandStartX,endLine:void 0,executedLine:void 0,command:"",isTrusted:!0,cwd:this._cwd,exitCode:void 0,commandStartLineContent:void 0,timestamp:0,markProperties:void 0}),{isWindowsPty:this._isWindowsPty,commands:e}}deserialize(e){e.isWindowsPty&&this.setIsWindowsPty(e.isWindowsPty);const t=this._terminal.buffer.normal;for(const i of e.commands){const n=i.startLine!==void 0?this._terminal.registerMarker(i.startLine-(t.baseY+t.cursorY)):void 0;if(!n)continue;if(!i.endLine){this._currentCommand.commandStartMarker=n,this._currentCommand.commandStartX=i.startX,this._cwd=i.cwd,this._onCommandStarted.fire({marker:n});continue}const s=i.endLine!==void 0?this._terminal.registerMarker(i.endLine-(t.baseY+t.cursorY)):void 0,o=i.executedLine!==void 0?this._terminal.registerMarker(i.executedLine-(t.baseY+t.cursorY)):void 0,a={command:this.__isCommandStorageDisabled?"":i.command,isTrusted:i.isTrusted,marker:n,endMarker:s,executedMarker:o,timestamp:i.timestamp,cwd:i.cwd,commandStartLineContent:i.commandStartLineContent,exitCode:i.exitCode,hasOutput:()=>!(o!=null&&o.isDisposed)&&!(s!=null&&s.isDisposed)&&!!(o&&s&&o.line<s.line),getOutput:()=>To(o,s,t),getOutputMatch:l=>Do(this._isWindowsPty&&(o==null?void 0:o.line)===(s==null?void 0:s.line)?n:o,s,t,this._terminal.cols,l),markProperties:i.markProperties,wasReplayed:!0};this._commands.push(a),this._logService.debug("CommandDetectionCapability#onCommandFinished",a),this._onCommandFinished.fire(a)}}}Ys.__decorator=w([$e(500)],Ys.prototype,"_handleCursorMove",null);function To(r,e,t){if(!r||!e)return;const i=r.line,n=e.line;if(i===n)return;let s="",o;for(let a=i;a<n;a++)o=t.getLine(a),o&&(s+=o.translateToString(!o.isWrapped)+(o.isWrapped?"":`
`));return s===""?void 0:s}function Do(r,e,t,i,n){var p,v;if(!r||!e)return;const s=e.line;if(s===-1)return;const o=Math.max(r.line,0),a=n.lineMatcher,l=typeof a=="string"?1:n.length||Fd(a),h=[];let m;if(n.anchor==="bottom")for(let f=s-(n.offset||0);f>=o;f--){let _=f;const S=f;for(;_>=o&&((p=t.getLine(_))!=null&&p.isWrapped);)_--;if(f=_,h.unshift(Po(t,_,S,i)),m||(m=h[0].match(a)),h.length>=l)break}else for(let f=o+(n.offset||0);f<s;f++){const _=f;let S=f;for(;S+1<s&&((v=t.getLine(S+1))!=null&&v.isWrapped);)S++;if(f=S,h.push(Po(t,_,S,i)),m||(m=h[h.length-1].match(a)),h.length>=l)break}return m?{regexMatch:m,outputLines:h}:void 0}function Po(r,e,t,i){const n=Math.max(2048/i*2);t=Math.min(t,e+n);let s="";for(let o=e;o<=t;o++){const a=r.getLine(o);a&&(s+=a.translateToString(!0,0,i))}return s}function Fd(r){if(!r.multiline)return 1;const e=r.source;let t=1,i=e.indexOf("\\n");for(;i!==-1;)t++,i=e.indexOf("\\n",i+1);return t}class Wd{constructor(){this.type=0,this._cwd="",this._cwds=new Map,this._onDidChangeCwd=new b,this.onDidChangeCwd=this._onDidChangeCwd.event}get cwds(){return Array.from(this._cwds.keys())}getCwd(){return this._cwd}updateCwd(e){const t=this._cwd!==e;this._cwd=e;const i=this._cwds.get(this._cwd)||0;this._cwds.delete(this._cwd),this._cwds.set(this._cwd,i+1),t&&this._onDidChangeCwd.fire(e)}}class Nd{get commands(){return this._commands}constructor(e){this._terminal=e,this.type=3,this._commands=[],this._onCommandFinished=new b,this.onCommandFinished=this._onCommandFinished.event,this._terminal.onData(t=>this._onData(t)),this._terminal.parser.registerCsiHandler({final:"J"},t=>(t.length>=1&&(t[0]===2||t[0]===3)&&this._clearCommandsInViewport(),!1))}_onData(e){e==="\r"&&this._onEnter()}_onEnter(){if(this._terminal&&this._terminal.buffer.active.cursorX>=2){const e=this._terminal.registerMarker(0);e&&(this._commands.push(e),this._onCommandFinished.fire(e))}}_clearCommandsInViewport(){let e=0;for(let t=this._commands.length-1;t>=0&&!(this._commands[t].line<this._terminal.buffer.active.baseY);t--)e++;this._commands.splice(this._commands.length-e,e)}}class Bd{constructor(e){this._terminal=e,this.type=4,this._idToMarkerMap=new Map,this._anonymousMarkers=new Map,this._onMarkAdded=new b,this.onMarkAdded=this._onMarkAdded.event}*markers(){for(const e of this._idToMarkerMap.values())yield e;for(const e of this._anonymousMarkers.values())yield e}addMark(e){const t=(e==null?void 0:e.marker)||this._terminal.registerMarker(),i=e==null?void 0:e.id;t&&(i?(this._idToMarkerMap.set(i,t),t.onDispose(()=>this._idToMarkerMap.delete(i))):(this._anonymousMarkers.set(t.id,t),t.onDispose(()=>this._anonymousMarkers.delete(t.id))),this._onMarkAdded.fire({marker:t,id:i,hidden:e==null?void 0:e.hidden,hoverMessage:e==null?void 0:e.hoverMessage}))}getMark(e){return this._idToMarkerMap.get(e)}}function Ao(r){let e=r;e.includes("\\")&&(e=e.replace(/\\/g,"\\\\"));const t=/[\`\$\|\&\>\~\#\!\^\*\;\<\"\']/g;return e=e.replace(t,""),`'${e}'`}function Od(r,e,t){if(!r)return"";if(!e)return r;e.match(/[\/\\]$/)&&(e=e.slice(0,e.length-1));const i=r.replace(/\\/g,"/").toLowerCase(),n=e.replace(/\\/g,"/").toLowerCase();return i.includes(n)?`~${t}${r.slice(e.length+1)}`:r}function Qs(r){return r.match(/^['"].*['"]$/)&&(r=r.substring(1,r.length-1)),Ye===1&&r&&r[1]===":"?r[0].toUpperCase()+r.substring(1):r}class Vd extends H{get status(){return this._status}constructor(e,t,i,n){super(),this._nonce=e,this._disableTelemetry=t,this._telemetryService=i,this._logService=n,this.capabilities=new to,this._hasUpdatedTelemetry=!1,this._commonProtocolDisposables=[],this._status=0,this._onDidChangeStatus=new b,this.onDidChangeStatus=this._onDidChangeStatus.event,this._register(Ce(()=>{this._clearActivationTimeout(),this._disposeCommonProtocol()}))}_disposeCommonProtocol(){ee(this._commonProtocolDisposables),this._commonProtocolDisposables.length=0}activate(e){this._terminal=e,this.capabilities.add(3,new Nd(this._terminal)),this._register(e.parser.registerOscHandler(633,t=>this._handleVSCodeSequence(t))),this._register(e.parser.registerOscHandler(1337,t=>this._doHandleITermSequence(t))),this._commonProtocolDisposables.push(e.parser.registerOscHandler(133,t=>this._handleFinalTermSequence(t))),this._register(e.parser.registerOscHandler(7,t=>this._doHandleSetCwd(t))),this._register(e.parser.registerOscHandler(9,t=>this._doHandleSetWindowsFriendlyCwd(t))),this._ensureCapabilitiesOrAddFailureTelemetry()}_handleFinalTermSequence(e){const t=this._doHandleFinalTermSequence(e);return this._status===0&&(this._status=1,this._onDidChangeStatus.fire(this._status)),t}_doHandleFinalTermSequence(e){if(!this._terminal)return!1;const[t,...i]=e.split(";");switch(t){case"A":return this._createOrGetCommandDetection(this._terminal).handlePromptStart(),!0;case"B":return this._createOrGetCommandDetection(this._terminal).handleCommandStart({ignoreCommandLine:!0}),!0;case"C":return this._createOrGetCommandDetection(this._terminal).handleCommandExecuted(),!0;case"D":{const n=i.length===1?parseInt(i[0]):void 0;return this._createOrGetCommandDetection(this._terminal).handleCommandFinished(n),!0}}return!1}_handleVSCodeSequence(e){var i;const t=this._doHandleVSCodeSequence(e);return!this._hasUpdatedTelemetry&&t&&((i=this._telemetryService)==null||i.publicLog2("terminal/shellIntegrationActivationSucceeded"),this._hasUpdatedTelemetry=!0,this._clearActivationTimeout()),this._status!==2&&(this._status=2,this._onDidChangeStatus.fire(this._status)),t}async _ensureCapabilitiesOrAddFailureTelemetry(){!this._telemetryService||this._disableTelemetry||(this._activationTimeout=setTimeout(()=>{var e;!this.capabilities.get(2)&&!this.capabilities.get(0)&&((e=this._telemetryService)==null||e.publicLog2("terminal/shellIntegrationActivationTimeout"),this._logService.warn("Shell integration failed to add capabilities within 10 seconds")),this._hasUpdatedTelemetry=!0},1e4))}_clearActivationTimeout(){this._activationTimeout!==void 0&&(clearTimeout(this._activationTimeout),this._activationTimeout=void 0)}_doHandleVSCodeSequence(e){var s;if(!this._terminal)return!1;const t=e.indexOf(";"),i=t===-1?e:e.substring(0,t),n=t===-1?[]:e.substring(t+1).split(";");switch(i){case"A":return this._createOrGetCommandDetection(this._terminal).handlePromptStart(),!0;case"B":return this._createOrGetCommandDetection(this._terminal).handleCommandStart(),!0;case"C":return this._createOrGetCommandDetection(this._terminal).handleCommandExecuted(),!0;case"D":{const o=n[0],a=o!==void 0?parseInt(o):void 0;return this._createOrGetCommandDetection(this._terminal).handleCommandFinished(a),!0}case"E":{const o=n[0],a=n[1];let l;return o!==void 0?l=Eo(o):l="",this._createOrGetCommandDetection(this._terminal).setCommandLine(l,a===this._nonce),!0}case"F":return this._createOrGetCommandDetection(this._terminal).handleContinuationStart(),!0;case"G":return this._createOrGetCommandDetection(this._terminal).handleContinuationEnd(),!0;case"H":return this._createOrGetCommandDetection(this._terminal).handleRightPromptStart(),!0;case"I":return this._createOrGetCommandDetection(this._terminal).handleRightPromptEnd(),!0;case"P":{const o=n[0],a=o!==void 0?Eo(o):"",{key:l,value:h}=Lo(a);if(h===void 0)return!0;switch(l){case"Cwd":return this._updateCwd(h),!0;case"IsWindows":return this._createOrGetCommandDetection(this._terminal).setIsWindowsPty(h==="True"),!0;case"Task":return this._createOrGetBufferMarkDetection(this._terminal),(s=this.capabilities.get(2))==null||s.setIsCommandStorageDisabled(),!0}}case"SetMark":return this._createOrGetBufferMarkDetection(this._terminal).addMark(Hd(n)),!0}return!1}_updateCwd(e){e=Qs(e),this._createOrGetCwdDetection().updateCwd(e);const t=this.capabilities.get(2);t==null||t.setCwd(e)}_doHandleITermSequence(e){if(!this._terminal)return!1;const[t]=e.split(";");switch(t){case"SetMark":this._createOrGetBufferMarkDetection(this._terminal).addMark();default:{const{key:i,value:n}=Lo(t);if(n===void 0)return!0;switch(i){case"CurrentDir":return this._updateCwd(n),!0}}}return!1}_doHandleSetWindowsFriendlyCwd(e){if(!this._terminal)return!1;const[t,...i]=e.split(";");switch(t){case"9":return i.length&&this._updateCwd(i[0]),!0}return!1}_doHandleSetCwd(e){if(!this._terminal)return!1;const[t]=e.split(";");if(t.match(/^file:\/\/.*\//)){const i=L.parse(t);if(i.path&&i.path.length>0)return this._updateCwd(i.path),!0}return!1}serialize(){return!this._terminal||!this.capabilities.has(2)?{isWindowsPty:!1,commands:[]}:this._createOrGetCommandDetection(this._terminal).serialize()}deserialize(e){if(!this._terminal)throw new Error("Cannot restore commands before addon is activated");this._createOrGetCommandDetection(this._terminal).deserialize(e)}_createOrGetCwdDetection(){let e=this.capabilities.get(0);return e||(e=new Wd,this.capabilities.add(0,e)),e}_createOrGetCommandDetection(e){let t=this.capabilities.get(2);return t||(t=new Ys(e,this._logService),this.capabilities.add(2,t)),t}_createOrGetBufferMarkDetection(e){let t=this.capabilities.get(4);return t||(t=new Bd(e),this.capabilities.add(4,t)),t}}function Eo(r){return r.replaceAll(/\\(\\|x([0-9a-f]{2}))/gi,(e,t,i)=>i?String.fromCharCode(parseInt(i,16)):t)}function Lo(r){const e=r.indexOf("=");return e===-1?{key:r,value:void 0}:{key:r.substring(0,e),value:r.substring(1+e)}}function Hd(r){let e,t=!1;for(const i of r)i!==void 0&&(i==="Hidden"&&(t=!0),i.startsWith("Id=")&&(e=i.substring(3)));return{id:e,hidden:t}}let Js=class extends H{constructor(e,t,i){super(),this._hoverService=e,this._contextMenuVisible=!1,this._register(i.onDidShowContextMenu(()=>this._contextMenuVisible=!0)),this._register(i.onDidHideContextMenu(()=>this._contextMenuVisible=!1)),this._hoverDelayer=this._register(new Qn(t.getValue("workbench.hover.delay")))}hideHover(){this._hoverDelayer.cancel(),this._hoverService.hideHover()}createHover(e,t,i){return $l(O(e,De.MOUSE_ENTER,()=>{this._contextMenuVisible||this._hoverDelayer.trigger(()=>{var s,o;let n=`${c("terminalPromptContextMenu","Show Command Actions")}`;if(n+=`

---

`,t)if(t.markProperties||i)if((s=t.markProperties)!=null&&s.hoverMessage||i)n=((o=t.markProperties)==null?void 0:o.hoverMessage)||i||"";else return;else t.exitCode?t.exitCode===-1?n+=c("terminalPromptCommandFailed","Command executed {0} and failed",gi(t.timestamp,!0)):n+=c("terminalPromptCommandFailedWithExitCode","Command executed {0} and failed (Exit Code {1})",gi(t.timestamp,!0),t.exitCode):n+=c("terminalPromptCommandSuccess","Command executed {0}",gi(t.timestamp,!0));else if(i)n=i;else return;this._hoverService.showHover({content:new V(n),target:e})})}),O(e,De.MOUSE_LEAVE,()=>this.hideHover()),O(e,De.MOUSE_OUT,()=>this.hideHover()))}};Js=w([d(0,Vn),d(1,X),d(2,Nt)],Js);function as(r,e){if(!e)return;const t=r.inspect("terminal.integrated.fontSize").value,i=r.inspect("terminal.integrated.fontSize").defaultValue,n=r.inspect("terminal.integrated.lineHeight").value;if(typeof t=="number"&&typeof i=="number"&&typeof n=="number"){const s=t/i<=1?t/i:1;e.style.width=`${s*16}px`,e.style.height=`${s*16*n}px`,e.style.fontSize=`${s*16}px`,e.style.marginLeft=`${s*-17}px`}}let Zs=class extends H{constructor(e,t,i,n,s,o,a,l,h,m,p,v){super(),this._capabilities=e,this._clipboardService=t,this._contextMenuService=i,this._configurationService=n,this._themeService=s,this._openerService=o,this._quickInputService=a,this._commandService=h,this._audioCueService=p,this._notificationService=v,this._capabilityDisposables=new Map,this._decorations=new Map,this._onDidRequestRunCommand=this._register(new b),this.onDidRequestRunCommand=this._onDidRequestRunCommand.event,this._register(Ce(()=>this._dispose())),this._register(this._configurationService.onDidChangeConfiguration(f=>{f.affectsConfiguration("terminal.integrated.fontSize")||f.affectsConfiguration("terminal.integrated.lineHeight")?this.refreshLayouts():f.affectsConfiguration("workbench.colorCustomizations")?this._refreshStyles(!0):f.affectsConfiguration("terminal.integrated.shellIntegration.decorationsEnabled")&&(this._removeCapabilityDisposables(2),this._updateDecorationVisibility())})),this._register(this._themeService.onDidColorThemeChange(()=>this._refreshStyles(!0))),this._updateDecorationVisibility(),this._register(this._capabilities.onDidAddCapability(f=>this._createCapabilityDisposables(f))),this._register(this._capabilities.onDidRemoveCapability(f=>this._removeCapabilityDisposables(f))),this._register(l.onWillShutdown(()=>this._disposeAllDecorations())),this._terminalDecorationHoverService=m.createInstance(Js)}_removeCapabilityDisposables(e){const t=this._capabilityDisposables.get(e);t&&ee(t),this._capabilityDisposables.delete(e)}_createCapabilityDisposables(e){let t=[];const i=this._capabilities.get(e);if(!(!i||this._capabilityDisposables.has(e))){switch(i.type){case 4:t=[i.onMarkAdded(n=>this.registerMarkDecoration(n))];break;case 2:t=this._getCommandDetectionListeners(i);break}this._capabilityDisposables.set(e,t)}}registerMarkDecoration(e){if(!(!this._terminal||!this._showGutterDecorations&&!this._showOverviewRulerDecorations)&&!e.hidden)return this.registerCommandDecoration(void 0,void 0,e)}_updateDecorationVisibility(){var i;const e=this._configurationService.getValue("terminal.integrated.shellIntegration.decorationsEnabled");this._showGutterDecorations=e==="both"||e==="gutter",this._showOverviewRulerDecorations=e==="both"||e==="overviewRuler",this._disposeAllDecorations(),(this._showGutterDecorations||this._showOverviewRulerDecorations)&&(this._attachToCommandCapability(),this._updateGutterDecorationVisibility());const t=(i=this._capabilities.get(2))==null?void 0:i.executingCommandObject;t&&this.registerCommandDecoration(t,!0)}_disposeAllDecorations(){var e;(e=this._placeholderDecoration)==null||e.dispose();for(const t of this._decorations.values())t.decoration.dispose(),ee(t.disposables)}_updateGutterDecorationVisibility(){const e=document.querySelectorAll("terminal-command-decoration");for(const t of e)this._updateCommandDecorationVisibility(t)}_updateCommandDecorationVisibility(e){this._showGutterDecorations?e.classList.remove("hide"):e.classList.add("hide")}refreshLayouts(){var e;as(this._configurationService,(e=this._placeholderDecoration)==null?void 0:e.element);for(const t of this._decorations)as(this._configurationService,t[1].decoration.element)}_refreshStyles(e){var t,i,n;if(e)for(const s of this._decorations.values()){const o=((t=this._getDecorationCssColor(s))==null?void 0:t.toString())??"";(i=s.decoration.options)!=null&&i.overviewRulerOptions?s.decoration.options.overviewRulerOptions.color=o:s.decoration.options&&(s.decoration.options.overviewRulerOptions={color:o})}this._updateClasses((n=this._placeholderDecoration)==null?void 0:n.element);for(const s of this._decorations.values())this._updateClasses(s.decoration.element,s.exitCode,s.markProperties)}_dispose(){this._terminalDecorationHoverService.dispose();for(const e of this._capabilityDisposables.values())ee(e);this.clearDecorations()}_clearPlaceholder(){var e;(e=this._placeholderDecoration)==null||e.dispose(),this._placeholderDecoration=void 0}clearDecorations(){var e;(e=this._placeholderDecoration)==null||e.marker.dispose(),this._clearPlaceholder(),this._disposeAllDecorations(),this._decorations.clear()}_attachToCommandCapability(){this._capabilities.has(2)&&this._getCommandDetectionListeners(this._capabilities.get(2))}_getCommandDetectionListeners(e){var i;if(this._capabilityDisposables.has(2)){const n=this._capabilityDisposables.get(2);ee(n),this._capabilityDisposables.delete(e.type)}const t=[];(i=e.executingCommandObject)!=null&&i.marker&&this.registerCommandDecoration(e.executingCommandObject,!0),t.push(e.onCommandStarted(n=>this.registerCommandDecoration(n,!0)));for(const n of e.commands)this.registerCommandDecoration(n);return t.push(e.onCommandFinished(n=>{this.registerCommandDecoration(n),n.exitCode&&this._audioCueService.playAudioCue(Xr.terminalCommandFailed)})),t.push(e.onCommandInvalidated(n=>{var s;for(const o of n){const a=(s=o.marker)==null?void 0:s.id;if(a){const l=this._decorations.get(a);l&&(l.decoration.dispose(),ee(l.disposables))}}})),t.push(e.onCurrentCommandInvalidated(n=>{if(n.reason==="noProblemsReported"){const s=Array.from(this._decorations.entries())[this._decorations.size-1];s==null||s[1].decoration.dispose()}else n.reason==="windows"&&this._clearPlaceholder()})),t}activate(e){this._terminal=e,this._attachToCommandCapability()}registerCommandDecoration(e,t,i){var a;if(!this._terminal||t&&!e||!this._showGutterDecorations&&!this._showOverviewRulerDecorations)return;const n=(e==null?void 0:e.marker)||(i==null?void 0:i.marker);if(!n)throw new Error(`cannot add a decoration for a command ${JSON.stringify(e)} with no marker`);this._clearPlaceholder();const s=((a=this._getDecorationCssColor(e))==null?void 0:a.toString())??"",o=this._terminal.registerDecoration({marker:n,overviewRulerOptions:this._showOverviewRulerDecorations?t?{color:s,position:"left"}:{color:s,position:e!=null&&e.exitCode?"right":"left"}:void 0});if(o)return t&&(this._placeholderDecoration=o),o.onRender(l=>{var h;l.classList.contains(".xterm-decoration-overview-ruler")||(this._decorations.get(o.marker.id)||(o.onDispose(()=>this._decorations.delete(o.marker.id)),this._decorations.set(o.marker.id,{decoration:o,disposables:this._createDisposables(l,e,i),exitCode:e==null?void 0:e.exitCode,markProperties:e==null?void 0:e.markProperties})),(!l.classList.contains("codicon")||((h=e==null?void 0:e.marker)==null?void 0:h.line)===0)&&(as(this._configurationService,l),this._updateClasses(l,e==null?void 0:e.exitCode,(e==null?void 0:e.markProperties)||i)))}),o}_createDisposables(e,t,i){return(t==null?void 0:t.exitCode)===void 0&&!(t!=null&&t.markProperties)?[]:t!=null&&t.markProperties||i?[this._terminalDecorationHoverService.createHover(e,t||i,i==null?void 0:i.hoverMessage)]:[this._createContextMenu(e,t),this._terminalDecorationHoverService.createHover(e,t)]}_updateClasses(e,t,i){if(e){for(const n of e.classList)e.classList.remove(n);e.classList.add("terminal-command-decoration","codicon","xterm-decoration"),i?(e.classList.add("default-color",...E.asClassNameArray(ad)),i.hoverMessage||e.classList.add("default")):(this._updateCommandDecorationVisibility(e),t===void 0?(e.classList.add("default-color","default"),e.classList.add(...E.asClassNameArray(cd))):t?(e.classList.add("error"),e.classList.add(...E.asClassNameArray(ld))):e.classList.add(...E.asClassNameArray(hd)))}}_createContextMenu(e,t){return O(e,De.CLICK,async()=>{this._terminalDecorationHoverService.hideHover();const i=await this._getCommandActions(t);this._contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>i})})}async _getCommandActions(e){const t=[];if(e.command!==""){const a=c("terminal.rerunCommand","Rerun Command");t.push({class:void 0,tooltip:a,id:"terminal.rerunCommand",label:a,enabled:!0,run:async()=>{e.command!==""&&(!e.isTrusted&&!await new Promise(m=>{this._notificationService.prompt(ne.Info,c("rerun","Do you want to run the command: {0}",e.command),[{label:c("yes","Yes"),run:()=>m(!0)},{label:c("no","No"),run:()=>m(!1)}])})||this._onDidRequestRunCommand.fire({command:e}))}});const l=c("terminal.copyCommand","Copy Command");t.push({class:void 0,tooltip:l,id:"terminal.copyCommand",label:l,enabled:!0,run:()=>this._clipboardService.writeText(e.command)})}if(e.hasOutput()){t.length>0&&t.push(new kt);const a=c("terminal.copyOutput","Copy Output");t.push({class:void 0,tooltip:a,id:"terminal.copyOutput",label:a,enabled:!0,run:()=>{const h=e.getOutput();typeof h=="string"&&this._clipboardService.writeText(h)}});const l=c("terminal.copyOutputAsHtml","Copy Output as HTML");t.push({class:void 0,tooltip:l,id:"terminal.copyOutputAsHtml",label:l,enabled:!0,run:()=>this._onDidRequestRunCommand.fire({command:e,copyAsHtml:!0})})}t.length>0&&t.push(new kt);const i=c("workbench.action.terminal.runRecentCommand","Run Recent Command");t.push({class:void 0,tooltip:i,id:"workbench.action.terminal.runRecentCommand",label:i,enabled:!0,run:()=>this._commandService.executeCommand("workbench.action.terminal.runRecentCommand")});const n=c("workbench.action.terminal.goToRecentDirectory","Go To Recent Directory");t.push({class:void 0,tooltip:i,id:"workbench.action.terminal.goToRecentDirectory",label:n,enabled:!0,run:()=>this._commandService.executeCommand("workbench.action.terminal.goToRecentDirectory")}),t.push(new kt);const s=c("terminal.configureCommandDecorations","Configure Command Decorations");t.push({class:void 0,tooltip:s,id:"terminal.configureCommandDecorations",label:s,enabled:!0,run:()=>this._showConfigureCommandDecorationsQuickPick()});const o=c("terminal.learnShellIntegration","Learn About Shell Integration");return t.push({class:void 0,tooltip:o,id:"terminal.learnShellIntegration",label:o,enabled:!0,run:()=>this._openerService.open("https://code.visualstudio.com/docs/terminal/shell-integration")}),t}async _showConfigureCommandDecorationsQuickPick(){const e=this._quickInputService.createQuickPick();e.items=[{id:"a",label:c("toggleVisibility","Toggle visibility")}],e.canSelectMany=!1,e.onDidAccept(async t=>{switch(e.hide(),e.activeItems[0].id){case"a":this._showToggleVisibilityQuickPick();break}}),e.show()}_showToggleVisibilityQuickPick(){const e=this._quickInputService.createQuickPick();e.hideInput=!0,e.hideCheckAll=!0,e.canSelectMany=!0,e.title=c("toggleVisibility","Toggle visibility");const t=this._configurationService.getValue("terminal.integrated.shellIntegration.decorationsEnabled"),i={label:c("gutter","Gutter command decorations"),picked:t!=="never"&&t!=="overviewRuler"},n={label:c("overviewRuler","Overview ruler command decorations"),picked:t!=="never"&&t!=="gutter"};e.items=[i,n];const s=[];t!=="never"&&(t!=="gutter"&&s.push(i),t!=="overviewRuler"&&s.push(n)),e.selectedItems=s,e.onDidChangeSelection(async o=>{let a="never";o.includes(i)?o.includes(n)?a="both":a="gutter":o.includes(n)&&(a="overviewRuler"),await this._configurationService.updateValue("terminal.integrated.shellIntegration.decorationsEnabled",a)}),e.ok=!1,e.show()}_getDecorationCssColor(e){var i;let t;return(e==null?void 0:e.exitCode)===void 0?t=xc:t=e.exitCode?Cc:yc,(i=this._themeService.getColorTheme().getColor(t))==null?void 0:i.toString()}};Zs=w([d(1,$n),d(2,Nt),d(3,X),d(4,de),d(5,Gi),d(6,le),d(7,Hn),d(8,pe),d(9,B),d(10,jr),d(11,se)],Zs);class cs{constructor(e){this.completion=e,this.score=xs.Default,this.distance=0,this.labelLow=this.completion.label.toLowerCase()}}class ls{constructor(e,t){this.leadingLineContent=e,this.characterCountDelta=t}}class Ro{constructor(e,t,i,n){this._items=e,this._lineContext=t,this.replacementIndex=i,this.replacementLength=n,this._refilterKind=1,this._fuzzyScoreOptions=zl.default,this._options={}}get items(){return this._ensureCachedState(),this._filteredItems}get stats(){return this._ensureCachedState(),this._stats}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?2:1,this._lineContext=e)}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){const e=[],{leadingLineContent:t,characterCountDelta:i}=this._lineContext;let n="",s="";const o=this._refilterKind===1?this._items:this._filteredItems,a=[],l=!this._options.filterGraceful||o.length>2e3?Kl:Ul;for(let h=0;h<o.length;h++){const m=o[h],p=this.replacementLength,v=p+i;if(n.length!==v&&(n=v===0?"":t.slice(-v),s=n.toLowerCase()),m.word=n,v===0)m.score=xs.Default;else{let f=0;for(;f<p;){const _=n.charCodeAt(f);if(_===32||_===9)f+=1;else break}if(f>=v)m.score=xs.Default;else{const _=l(n,s,f,m.completion.label,m.labelLow,0,this._fuzzyScoreOptions);if(!_)continue;m.score=_}}m.idx=h,m.distance=1,a.push(m),e.push(m.completion.label.length)}this._filteredItems=a,this._refilterKind=0,this._stats={pLabelLen:e.length?ql(e.length-.85,e,(h,m)=>h-m):0}}}var Gd='.workbench-suggest-widget{display:flex;flex-direction:column;left:0;position:absolute;top:0;width:430px;z-index:40}.workbench-suggest-widget.message{align-items:center;flex-direction:row}.monaco-workbench .workbench-suggest-details,.workbench-suggest-widget{background-color:var(--vscode-editorSuggestWidget-background);border-color:var(--vscode-editorSuggestWidget-border);border-style:solid;border-width:1px;flex:0 1 auto;width:100%}.monaco-workbench.hc-black .workbench-suggest-details,.monaco-workbench.hc-black .workbench-suggest-widget,.monaco-workbench.hc-light .workbench-suggest-details,.monaco-workbench.hc-light .workbench-suggest-widget{border-width:2px}.monaco-workbench .workbench-suggest-widget.with-status-bar .suggest-status-bar{display:flex}.monaco-workbench .workbench-suggest-widget .suggest-status-bar .left{padding-right:8px}.monaco-workbench .workbench-suggest-widget.with-status-bar .suggest-status-bar .action-label{color:var(--vscode-editorSuggestWidgetStatus-foreground)}.monaco-workbench .workbench-suggest-widget.with-status-bar .suggest-status-bar .action-item:not(:last-of-type) .action-label{margin-right:0}.monaco-workbench .workbench-suggest-widget.with-status-bar .suggest-status-bar .action-item:not(:last-of-type) .action-label:after{content:", ";margin-right:.3em}.monaco-workbench .workbench-suggest-widget.with-status-bar .monaco-list .monaco-list-row.focused.string-label>.contents>.main>.right>.readMore,.monaco-workbench .workbench-suggest-widget.with-status-bar .monaco-list .monaco-list-row>.contents>.main>.right>.readMore{display:none}.workbench-suggest-widget .monaco-list .monaco-list-row{background-position:2px 2px;background-repeat:no-repeat;-mox-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:flex;padding-right:10px;touch-action:none;white-space:nowrap}.workbench-suggest-widget .monaco-list .monaco-list-row.focused{color:var(--vscode-editorSuggestWidget-selectedForeground)}.workbench-suggest-widget .monaco-list .monaco-list-row.focused .codicon{color:var(--vscode-editorSuggestWidget-selectedIconForeground)}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents{flex:1;height:100%;overflow:hidden;padding-left:2px}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main{display:flex;justify-content:space-between;overflow:hidden;text-overflow:ellipsis;white-space:pre}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left,.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right{display:flex}.workbench-suggest-widget .monaco-list .monaco-list-row:not(.focused)>.contents>.main .monaco-icon-label{color:var(--vscode-editorSuggestWidget-foreground)}.workbench-suggest-widget:not(.frozen) .monaco-highlighted-label .highlight{font-weight:700}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main .monaco-highlighted-label .highlight{color:var(--vscode-editorSuggestWidget-highlightForeground)}.workbench-suggest-widget .monaco-list .monaco-list-row.focused>.contents>.main .monaco-highlighted-label .highlight{color:var(--vscode-editorSuggestWidget-focusHighlightForeground)}.workbench-suggest-widget .monaco-list .monaco-list-row .monaco-icon-label.deprecated{opacity:.66;text-decoration:unset}.workbench-suggest-widget .monaco-list .monaco-list-row .monaco-icon-label.deprecated>.monaco-icon-label-container>.monaco-icon-name-container{text-decoration:line-through}.workbench-suggest-widget .monaco-list .monaco-list-row .monaco-icon-label:before{height:100%}.workbench-suggest-widget .monaco-list .monaco-list-row .icon{background-position:50%;background-repeat:no-repeat;background-size:80%;display:block;height:16px;margin-left:2px;width:16px}.workbench-suggest-widget .monaco-list .monaco-list-row .icon.hide{display:none}.workbench-suggest-widget .monaco-list .monaco-list-row .suggest-icon{align-items:center;display:flex;margin-right:4px}.workbench-suggest-widget.no-icons .monaco-list .monaco-list-row .icon,.workbench-suggest-widget.no-icons .monaco-list .monaco-list-row .suggest-icon:before{display:none}.workbench-suggest-widget .monaco-list .monaco-list-row .icon.customcolor .colorspan{border:.1em solid #000;display:inline-block;height:.7em;margin:0 0 0 .3em;width:.7em}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.details-label{opacity:.7}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left>.signature-label{opacity:.6;overflow:hidden;text-overflow:ellipsis}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left>.qualifier-label{align-self:center;font-size:85%;line-height:normal;margin-left:12px;opacity:.4;overflow:hidden;text-overflow:ellipsis}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.details-label{font-size:85%;margin-left:1.1em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.details-label>.monaco-tokenized-source{display:inline}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.details-label{display:none}.workbench-suggest-widget .monaco-list .monaco-list-row:not(.string-label)>.contents>.main>.right>.details-label,.workbench-suggest-widget.docs-side .monaco-list .monaco-list-row.focused:not(.string-label)>.contents>.main>.right>.details-label,.workbench-suggest-widget:not(.shows-details) .monaco-list .monaco-list-row.focused>.contents>.main>.right>.details-label{display:inline}.workbench-suggest-widget:not(.docs-side) .monaco-list .monaco-list-row.focused:hover>.contents>.main>.right.can-expand-details>.details-label{width:calc(100% - 26px)}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left{flex-grow:1;flex-shrink:1;overflow:hidden}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.left>.monaco-icon-label{flex-shrink:0}.workbench-suggest-widget .monaco-list .monaco-list-row:not(.string-label)>.contents>.main>.left>.monaco-icon-label{max-width:100%}.workbench-suggest-widget .monaco-list .monaco-list-row.string-label>.contents>.main>.left>.monaco-icon-label{flex-shrink:1}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right{flex-shrink:4;max-width:70%;overflow:hidden}.workbench-suggest-widget .monaco-list .monaco-list-row>.contents>.main>.right>.readMore{display:inline-block;height:18px;position:absolute;right:10px;visibility:hidden;width:18px}';ri(Gd,{});function $d(r){return`simple-suggest-aria-id:${r}`}class zd{constructor(){this._onDidToggleDetails=new b,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId="suggestion"}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){const t=new mt,i=e;i.classList.add("show-file-icons");const n=ke(e,Se(".icon")),s=ke(n,Se("span.colorspan")),o=ke(e,Se(".contents")),a=ke(o,Se(".main")),l=ke(a,Se(".icon-label.codicon")),h=ke(a,Se("span.left")),m=ke(a,Se("span.right")),p=new jl(h,{supportHighlights:!0,supportIcons:!0});t.add(p);const v=ke(h,Se("span.signature-label")),f=ke(h,Se("span.qualifier-label")),_=ke(m,Se("span.details-label"));return(()=>{const y="Hack",M="",D="12",R="20",N="normal",C="0",W=`${D}px`,z=`${R}px`,G=`${C}px`;i.style.fontSize=W,i.style.fontWeight=N,i.style.letterSpacing=G,a.style.fontFamily=y,a.style.fontFeatureSettings=M,a.style.lineHeight=z,n.style.height=z,n.style.width=z})(),{root:i,left:h,right:m,icon:n,colorspan:s,iconLabel:p,iconContainer:l,parametersLabel:v,qualifierLabel:f,detailsLabel:_,disposables:t}}renderElement(e,t,i){const{completion:n}=e;i.root.id=$d(t),i.colorspan.style.backgroundColor="";const s={labelEscapeNewLines:!0,matches:Xl(e.score)};i.icon.className="icon hide",i.iconContainer.className="",i.iconContainer.classList.add("suggest-icon",...E.asClassNameArray(n.icon||k.symbolText)),i.iconLabel.setLabel(n.label,void 0,s),i.parametersLabel.textContent="",i.detailsLabel.textContent=Kd(n.detail||""),i.root.classList.add("string-label"),ot(i.detailsLabel),i.right.classList.remove("can-expand-details")}disposeTemplate(e){e.disposables.dispose()}}function Kd(r){return r.replace(/\r\n|\r|\n/g,"")}const Ud=Se;let er=class{get list(){return this._list}constructor(e,t,i,n){this._container=e,this._persistedSize=t,this._state=0,this._forceRenderingAbove=!1,this._pendingLayout=new Yl,this._showTimeout=new Ql,this._disposables=new mt,this._onDidSelect=new b,this.onDidSelect=this._onDidSelect.event,this._onDidHide=new b,this.onDidHide=this._onDidHide.event,this._onDidShow=new b,this.onDidShow=this._onDidShow.event,this.element=new Jl,this.element.domNode.classList.add("workbench-suggest-widget"),this._container.appendChild(this.element.domNode);class s{constructor(h,m,p=!1,v=!1){this.persistedSize=h,this.currentSize=m,this.persistHeight=p,this.persistWidth=v}}let o;this._disposables.add(this.element.onDidWillResize(()=>{o=new s(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(l=>{var h,m;if(this._resize(l.dimension.width,l.dimension.height),o&&(o.persistHeight=o.persistHeight||!!l.north||!!l.south,o.persistWidth=o.persistWidth||!!l.east||!!l.west),!!l.done){if(o){const{itemHeight:p,defaultSize:v}=this._getLayoutInfo(),f=Math.round(p/2);let{width:_,height:S}=this.element.size;(!o.persistHeight||Math.abs(o.currentSize.height-S)<=f)&&(S=((h=o.persistedSize)==null?void 0:h.height)??v.height),(!o.persistWidth||Math.abs(o.currentSize.width-_)<=f)&&(_=((m=o.persistedSize)==null?void 0:m.width)??v.width),this._persistedSize.store(new ht(_,S))}o=void 0}}));const a=new zd;this._disposables.add(a),this._listElement=ke(this.element.domNode,Ud(".tree")),this._list=new Zl("SuggestWidget",this._listElement,{getHeight:l=>this._getLayoutInfo().itemHeight,getTemplateId:l=>"suggestion"},[a],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>"option",getWidgetAriaLabel:()=>c("suggest","Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:l=>{let h=l.completion.label;if(typeof l.completion.label!="string"){const{detail:p,description:v}=l.completion.label;p&&v?h=c("label.full","{0}{1}, {2}",h,p,v):p?h=c("label.detail","{0}{1}",h,p):v&&(h=c("label.desc","{0}, {1}",h,v))}const{detail:m}=l.completion;return c("ariaCurrenttSuggestionReadDetails","{0}, docs: {1}",h,m)}}}),i.statusBarMenuId&&(this._status=n.createInstance(eh,this.element.domNode,i.statusBarMenuId),this.element.domNode.classList.toggle("with-status-bar",!0)),this._disposables.add(this._list.onMouseDown(l=>this._onListMouseDownOrTap(l))),this._disposables.add(this._list.onTap(l=>this._onListMouseDownOrTap(l))),this._disposables.add(this._list.onDidChangeSelection(l=>this._onListSelection(l)))}dispose(){var e;this._disposables.dispose(),(e=this._status)==null||e.dispose(),this.element.dispose()}showSuggestions(e,t,i,n,s){if(this._cursorPosition=s,this._completionModel!==e&&(this._completionModel=e),i&&this._state!==2&&this._state!==0){this._setState(4);return}if(this._completionModel.items.length===0){this._setState(n?0:2),this._completionModel=void 0;return}try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(i?4:3),this._list.reveal(t,0),this._list.setFocus([t])}finally{}this._pendingLayout.value=th(()=>{this._pendingLayout.clear(),this._layout(this.element.size)})}setLineContext(e){this._completionModel&&(this._completionModel.lineContext=e)}_setState(e){var t,i,n,s,o,a,l;if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle("frozen",e===4),this.element.domNode.classList.remove("message"),e){case 0:St(this._listElement),this._status&&St((t=this._status)==null?void 0:t.element),(i=this._status)==null||i.hide(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._cappedHeight=void 0;break;case 1:this.element.domNode.classList.add("message"),St(this._listElement),this._status&&St((n=this._status)==null?void 0:n.element),this._show();break;case 2:this.element.domNode.classList.add("message"),St(this._listElement),this._status&&St((s=this._status)==null?void 0:s.element),this._show();break;case 3:ot(this._listElement),this._status&&ot((o=this._status)==null?void 0:o.element),this._show();break;case 4:ot(this._listElement),this._status&&ot((a=this._status)==null?void 0:a.element),this._show();break;case 5:ot(this._listElement),this._status&&ot((l=this._status)==null?void 0:l.element),this._show();break}}_show(){var e;(e=this._status)==null||e.show(),ot(this.element.domNode),this._layout(this._persistedSize.restore()),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)},100)}hide(){this._pendingLayout.clear(),this._setState(0),this._onDidHide.fire(this),St(this.element.domNode),this.element.clearSashHoverState();const e=this._persistedSize.restore(),t=Math.ceil(this._getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}_layout(e){var D,R;if(!this._cursorPosition)return;const t=ih(document.body),i=this._getLayoutInfo();e||(e=i.defaultSize);let n=e.height,s=e.width;this._status&&(this._status.element.style.lineHeight=`${i.itemHeight}px`);const o=t.width-i.borderHeight-2*i.horizontalPadding;s>o&&(s=o);const a=this._completionModel?this._completionModel.stats.pLabelLen*i.typicalHalfwidthCharacterWidth:s,l=i.statusBarHeight+this._list.contentHeight+i.borderHeight,h=i.itemHeight+i.statusBarHeight,m=ga(this._container),p=this._cursorPosition,v=m.top+p.top+p.height,f=Math.min(t.height-v-i.verticalPadding,l),_=m.top+p.top-i.verticalPadding,S=Math.min(_,l);let y=Math.min(Math.max(S,f)+i.borderHeight,l);n===((D=this._cappedHeight)==null?void 0:D.capped)&&(n=this._cappedHeight.wanted),n<h&&(n=h),n>y&&(n=y);const M=150;n>f||this._forceRenderingAbove&&_>M?(this._preference=0,this.element.enableSashes(!0,!0,!1,!1),y=S):(this._preference=1,this.element.enableSashes(!1,!0,!0,!1),y=f),this.element.preferredSize=new ht(a,i.defaultSize.height),this.element.maxSize=new ht(o,y),this.element.minSize=new ht(220,h),this._cappedHeight=n===l?{wanted:((R=this._cappedHeight)==null?void 0:R.wanted)??e.height,capped:n}:void 0,this.element.domNode.style.left=`${this._cursorPosition.left}px`,this._preference===0?this.element.domNode.style.top=`${this._cursorPosition.top-n-i.borderHeight}px`:this.element.domNode.style.top=`${this._cursorPosition.top+this._cursorPosition.height}px`,this._resize(s,n)}_resize(e,t){const{width:i,height:n}=this.element.maxSize;e=Math.min(i,e),n&&(t=Math.min(n,t));const{statusBarHeight:s}=this._getLayoutInfo();this._list.layout(t-s,e),this._listElement.style.height=`${t-s}px`,this._listElement.style.width=`${e}px`,this._listElement.style.height=`${t}px`,this.element.layout(t,e)}_getLayoutInfo(){const e={lineHeight:20,typicalHalfwidthCharacterWidth:10},t=nh(e.lineHeight,8,1e3),i=0,n=1,s=2*n;return{itemHeight:t,statusBarHeight:i,borderWidth:n,borderHeight:s,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new ht(430,i+12*t+s)}}_onListMouseDownOrTap(e){typeof e.element>"u"||typeof e.index>"u"||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){const i=this._completionModel;i&&this._onDidSelect.fire({item:e,index:t,model:i})}selectNext(){this._list.focusNext(1,!0);const e=this._list.getFocus();return e.length>0&&this._list.reveal(e[0]),!0}selectNextPage(){this._list.focusNextPage();const e=this._list.getFocus();return e.length>0&&this._list.reveal(e[0]),!0}selectPrevious(){this._list.focusPrevious(1,!0);const e=this._list.getFocus();return e.length>0&&this._list.reveal(e[0]),!0}selectPreviousPage(){this._list.focusPreviousPage();const e=this._list.getFocus();return e.length>0&&this._list.reveal(e[0]),!0}getFocusedItem(){if(this._completionModel)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};er=w([d(3,B)],er);const qd={0:k.symbolText,1:k.history,2:k.symbolMethod,3:k.symbolFile,4:k.folder,5:k.symbolProperty,6:k.symbolMethod,7:k.symbolVariable,8:k.symbolValue,9:k.symbolVariable,10:k.symbolNamespace,11:k.symbolInterface,12:k.symbolKeyword,13:k.symbolKeyword};let tr=class extends H{constructor(e,t){super(),this._terminalSuggestWidgetVisibleContextKey=e,this._instantiationService=t,this._enableWidget=!0,this._cursorIndexStart=0,this._cursorIndexDelta=0,this._onBell=new b,this.onBell=this._onBell.event,this._onAcceptedCompletion=new b,this.onAcceptedCompletion=this._onAcceptedCompletion.event,this._cachedBashAliases=new Set,this._cachedBashBuiltins=new Set,this._cachedBashCommands=new Set,this._cachedBashKeywords=new Set}activate(e){this._terminal=e,this._register(e.parser.registerOscHandler(633,t=>this._handleVSCodeSequence(t))),this._register(e.onData(t=>{this._handleTerminalInput(t)}))}setContainer(e){this._container=e}_handleVSCodeSequence(e){if(!this._terminal)return!1;const[t,...i]=e.split(";");switch(t){case"Completions":return this._handleCompletionsSequence(this._terminal,e,t,i),!0;case"CompletionsBash":return this._handleCompletionsBashSequence(this._terminal,e,t,i),!0;case"CompletionsBashFirstWord":return this._handleCompletionsBashFirstWordSequence(this._terminal,e,t,i)}return!1}_handleCompletionsSequence(e,t,i,n){if(!e.element||!this._enableWidget)return;const s=parseInt(n[0]),o=parseInt(n[1]);if(this._cursorIndexStart=parseInt(n[2]),!n[3]){this._onBell.fire();return}let a=JSON.parse(t.slice(i.length+n[0].length+n[1].length+n[2].length+4));Array.isArray(a)||(a=[a]);const l=a.map(m=>new cs({label:m.CompletionText,icon:qd[m.ResultType],detail:m.ToolTip}));this._leadingLineContent=l[0].completion.label.slice(0,o),this._cursorIndexDelta=0;const h=new Ro(l,new ls(this._leadingLineContent,s),s,o);if(l.length===1&&l[0].completion.label.substring(o).length===0){this._onBell.fire();return}this._handleCompletionModel(h)}_handleCompletionsBashFirstWordSequence(e,t,i,n){const s=n[0],o=t.slice(i.length+s.length+2).split(";");let a;switch(s){case"alias":a=this._cachedBashAliases;break;case"builtin":a=this._cachedBashBuiltins;break;case"command":a=this._cachedBashCommands;break;case"keyword":a=this._cachedBashKeywords;break;default:return!1}a.clear();const l=new Set;for(const h of o)l.add(h);for(const h of l)a.add(new cs({label:h,icon:k.symbolString,detail:s}));return this._cachedFirstWord=void 0,!0}_handleCompletionsBashSequence(e,t,i,n){if(!e.element)return;let s=parseInt(n[0]);const o=parseInt(n[1]);if(!n[2]){this._onBell.fire();return}const a=t.slice(i.length+n[0].length+n[1].length+n[2].length+4).split(";");let l;if(s!==100&&a.length>0?l=a.map(m=>new cs({label:m,icon:k.symbolProperty})):(s=0,this._cachedFirstWord||(this._cachedFirstWord=[...this._cachedBashAliases,...this._cachedBashBuiltins,...this._cachedBashCommands,...this._cachedBashKeywords],this._cachedFirstWord.sort((m,p)=>{const v=m.completion.label.charCodeAt(0),f=p.completion.label.charCodeAt(0),_=v<65||v>90&&v<97||v>122?1:0,S=f<65||f>90&&f<97||f>122?1:0;return _!==S?_-S:m.completion.label.localeCompare(p.completion.label)})),l=this._cachedFirstWord),l.length===0)return;this._leadingLineContent=l[0].completion.label.slice(0,o);const h=new Ro(l,new ls(this._leadingLineContent,s),s,o);if(l.length===1&&l[0].completion.label.substring(o).length===0){this._onBell.fire();return}this._handleCompletionModel(h)}_handleCompletionModel(e){var a;if(e.items.length===0||!((a=this._terminal)!=null&&a.element))return;if(e.items.length===1){this.acceptSelectedSuggestion({item:e.items[0],model:e});return}const t=this._ensureSuggestWidget(this._terminal);this._additionalInput=void 0;const i={width:this._terminal._core._renderService.dimensions.device.cell.width,height:this._terminal._core._renderService.dimensions.device.cell.height};if(!i.width||!i.height)return;const n=this._terminal.element.getBoundingClientRect(),o=ns(this._container,"panel").offsetParent.getBoundingClientRect();if(t.showSuggestions(e,0,!1,!1,{left:n.left-o.left+this._terminal.buffer.active.cursorX*i.width,top:n.top-o.top+this._terminal.buffer.active.cursorY*i.height,height:i.height}),this._inputQueue){const l=this._inputQueue;this._inputQueue=void 0;for(const h of l)this._handleTerminalInput(h)}}_ensureSuggestWidget(e){return this._terminalSuggestWidgetVisibleContextKey.set(!0),this._suggestWidget||(this._suggestWidget=this._register(this._instantiationService.createInstance(er,ns(this._container,"panel"),this._instantiationService.createInstance(ir),{})),this._suggestWidget.list.style(sh({listInactiveFocusBackground:rh,listInactiveFocusOutline:oh})),this._suggestWidget.onDidSelect(async t=>this.acceptSelectedSuggestion(t)),this._suggestWidget.onDidHide(()=>this._terminalSuggestWidgetVisibleContextKey.set(!1)),this._suggestWidget.onDidShow(()=>this._terminalSuggestWidgetVisibleContextKey.set(!0))),this._suggestWidget}selectPreviousSuggestion(){var e;(e=this._suggestWidget)==null||e.selectPrevious()}selectPreviousPageSuggestion(){var e;(e=this._suggestWidget)==null||e.selectPreviousPage()}selectNextSuggestion(){var e;(e=this._suggestWidget)==null||e.selectNext()}selectNextPageSuggestion(){var e;(e=this._suggestWidget)==null||e.selectNextPage()}acceptSelectedSuggestion(e){var t,i,n;e||(e=(t=this._suggestWidget)==null?void 0:t.getFocusedItem()),e&&this._leadingLineContent&&((i=this._suggestWidget)==null||i.hide(),this._onAcceptedCompletion.fire(["\x1B[D".repeat(Math.max(e.model.replacementLength-this._cursorIndexStart+this._cursorIndexDelta,0)),"\x1B[3~".repeat(((n=this._additionalInput)==null?void 0:n.length)??0),"".repeat(e.model.replacementLength),e.item.completion.label].join("")),this._enableWidget=!1,Pt(100).then(s=>this._enableWidget=!0))}hideSuggestWidget(){var e;(e=this._suggestWidget)==null||e.hide()}handleNonXtermData(e){this._handleTerminalInput(e)}_handleTerminalInput(e){var i,n,s,o,a;if(!this._terminal||!this._enableWidget||!this._terminalSuggestWidgetVisibleContextKey.get()){e==="-"?this._inputQueue=[]:(i=this._inputQueue)==null||i.push(e);return}let t=!1;if(e===""&&this._additionalInput&&this._additionalInput.length>0&&this._cursorIndexDelta>0&&(t=!0,this._additionalInput=this._additionalInput.substring(0,this._cursorIndexDelta---1)+this._additionalInput.substring(this._cursorIndexDelta)),e==="\x1B[3~"&&this._additionalInput&&this._additionalInput.length>0&&this._cursorIndexDelta<this._additionalInput.length-1&&(t=!0,this._additionalInput=this._additionalInput.substring(0,this._cursorIndexDelta)+this._additionalInput.substring(this._cursorIndexDelta+1)),e==="\x1B[D"&&this._cursorIndexDelta>0&&(t=!0,this._cursorIndexDelta--),e==="\x1B[C"&&(t=!0,this._cursorIndexDelta+=1),e.match(/^[a-z0-9]$/i)&&(t=!0,this._additionalInput===void 0&&(this._additionalInput=""),this._additionalInput+=e,this._cursorIndexDelta++),t){if(this._terminalSuggestWidgetVisibleContextKey.get()&&((s=this._suggestWidget)==null||s.setLineContext(new ls(this._leadingLineContent+(this._additionalInput??""),((n=this._additionalInput)==null?void 0:n.length)??0))),((o=this._suggestWidget._completionModel)==null?void 0:o.items.length)===0){this._additionalInput=void 0,this.hideSuggestWidget();return}const l={width:this._terminal._core._renderService.dimensions.device.cell.width,height:this._terminal._core._renderService.dimensions.device.cell.height};if(!l.width||!l.height)return;const h=this._terminal.element.getBoundingClientRect(),p=ns(this._container,"panel").offsetParent.getBoundingClientRect();(a=this._suggestWidget)==null||a.showSuggestions(this._suggestWidget._completionModel,0,!1,!1,{left:h.left-p.left+this._terminal.buffer.active.cursorX*l.width,top:h.top-p.top+this._terminal.buffer.active.cursorY*l.height,height:l.height})}else this._additionalInput=void 0,this.hideSuggestWidget()}};tr=w([d(1,B)],tr);let ir=class{constructor(e){this._storageService=e,this._key="terminal.integrated.suggestSize"}restore(){const e=this._storageService.get(this._key,0)??"";try{const t=JSON.parse(e);if(ht.is(t))return ht.lift(t)}catch{}}store(e){this._storageService.store(this._key,JSON.stringify(e),0,1)}reset(){this._storageService.remove(this._key,0)}};ir=w([d(0,bt)],ir);let hs,ds,us,ms,gs,ps;function jd(r,e){let t=e.getLine(r);if(!t)return{lineData:void 0,lineIndex:r};let i=t.translateToString(!0);for(;r>0&&t.isWrapped&&(t=e.getLine(--r),!!t);)i=t.translateToString(!1)+i;return{lineData:i,lineIndex:r}}let Ei=class ct extends mt{get findResult(){return this._lastFindResult}get isStdinDisabled(){return!!this.raw.options.disableStdin}get markTracker(){return this._markNavigationAddon}get shellIntegration(){return this._shellIntegrationAddon}get suggestController(){return this._suggestAddon}get textureAtlas(){var t,i;const e=((t=this._webglAddon)==null?void 0:t.textureAtlas)||((i=this._canvasAddon)==null?void 0:i.textureAtlas);if(e)return createImageBitmap(e)}get isFocused(){var e;return!!((e=this.raw.element)!=null&&e.contains(document.activeElement))}constructor(e,t,i,n,s,o,a,l,h,m,p,v,f,_,S,y,M,D){super(),this._configHelper=t,this._backgroundColorProvider=s,this._capabilities=o,this._terminalSuggestWidgetVisibleContextKey=l,this._configurationService=m,this._instantiationService=p,this._logService=v,this._notificationService=f,this._storageService=_,this._themeService=S,this._telemetryService=y,this._clipboardService=M,this._attachedDisposables=this.add(new mt),this._onDidRequestRunCommand=new b,this.onDidRequestRunCommand=this._onDidRequestRunCommand.event,this._onDidRequestFocus=new b,this.onDidRequestFocus=this._onDidRequestFocus.event,this._onDidRequestSendText=new b,this.onDidRequestSendText=this._onDidRequestSendText.event,this._onDidRequestFreePort=new b,this.onDidRequestFreePort=this._onDidRequestFreePort.event,this._onDidChangeFindResults=new b,this.onDidChangeFindResults=this._onDidChangeFindResults.event,this._onDidChangeSelection=new b,this.onDidChangeSelection=this._onDidChangeSelection.event,this._onDidChangeFocus=new b,this.onDidChangeFocus=this._onDidChangeFocus.event,this._onDidDispose=new b,this.onDidDispose=this._onDidDispose.event;const R=this._configHelper.getFont(void 0,!0),N=this._configHelper.config,C=this._configurationService.getValue("editor");this.raw=this.add(new e({allowProposedApi:!0,cols:i,rows:n,altClickMovesCursor:N.altClickMovesCursor&&C.multiCursorModifier==="alt",scrollback:N.scrollback,theme:this._getXtermTheme(),drawBoldTextInBrightColors:N.drawBoldTextInBrightColors,fontFamily:R.fontFamily,fontWeight:N.fontWeight,fontWeightBold:N.fontWeightBold,fontSize:R.fontSize,letterSpacing:R.letterSpacing,lineHeight:R.lineHeight,logLevel:Mo(this._logService.getLevel()),logger:this._logService,minimumContrastRatio:N.minimumContrastRatio,tabStopWidth:N.tabStopWidth,cursorBlink:N.cursorBlinking,cursorStyle:N.cursorStyle==="line"?"bar":N.cursorStyle,cursorWidth:N.cursorWidth,macOptionIsMeta:N.macOptionIsMeta,macOptionClickForcesSelection:N.macOptionClickForcesSelection,rightClickSelectsWord:N.rightClickBehavior==="selectWord",fastScrollModifier:"alt",fastScrollSensitivity:N.fastScrollSensitivity,scrollSensitivity:N.mouseWheelScrollSensitivity,wordSeparator:N.wordSeparators,overviewRulerWidth:10,smoothScrollDuration:N.smoothScrolling?125:0})),this._core=this.raw._core,this.add(this._configurationService.onDidChangeConfiguration(async W=>{W.affectsConfiguration("terminal.integrated.gpuAcceleration")&&(ct._suggestedRendererType=void 0),(W.affectsConfiguration("terminal.integrated")||W.affectsConfiguration("editor.fastScrollSensitivity")||W.affectsConfiguration("editor.mouseWheelScrollSensitivity")||W.affectsConfiguration("editor.multiCursorModifier"))&&this.updateConfig(),W.affectsConfiguration("terminal.integrated.unicodeVersion")&&this._updateUnicodeVersion()})),this.add(this._themeService.onDidColorThemeChange(W=>this._updateTheme(W))),this.add(this._logService.onDidChangeLogLevel(W=>this.raw.options.logLevel=Mo(W))),this.add(this.raw.onSelectionChange(()=>{this._onDidChangeSelection.fire(),this.isFocused&&this._anyFocusedTerminalHasSelection.set(this.raw.hasSelection())})),this._updateUnicodeVersion(),this._refreshImageAddon(),this._markNavigationAddon=this._instantiationService.createInstance(Xs,o),this.raw.loadAddon(this._markNavigationAddon),this._decorationAddon=this._instantiationService.createInstance(Zs,this._capabilities),this._decorationAddon.onDidRequestRunCommand(W=>this._onDidRequestRunCommand.fire(W)),this.raw.loadAddon(this._decorationAddon),this._shellIntegrationAddon=new Vd(a,h,this._telemetryService,this._logService),this.raw.loadAddon(this._shellIntegrationAddon),this._anyTerminalFocusContextKey=u.focusInAny.bindTo(D),this._anyFocusedTerminalHasSelection=u.textSelectedInFocused.bindTo(D),this._terminalSuggestWidgetVisibleContextKey&&(this._suggestAddon=this._instantiationService.createInstance(tr,this._terminalSuggestWidgetVisibleContextKey),this.raw.loadAddon(this._suggestAddon),this._suggestAddon.onAcceptedCompletion(async W=>{this._onDidRequestFocus.fire(),this._onDidRequestSendText.fire(W)}))}*getBufferReverseIterator(){for(let e=this.raw.buffer.active.length;e>=0;e--){const{lineData:t,lineIndex:i}=jd(e,this.raw.buffer.active);t&&(e=i,yield t)}}async getContentsAsHtml(){if(!this._serializeAddon){const e=await this._getSerializeAddonConstructor();this._serializeAddon=new e,this.raw.loadAddon(this._serializeAddon)}return this._serializeAddon.serializeAsHTML()}async getSelectionAsHtml(e){var i,n;if(!this._serializeAddon){const s=await this._getSerializeAddonConstructor();this._serializeAddon=new s,this.raw.loadAddon(this._serializeAddon)}if(e){const s=(i=e.getOutput())==null?void 0:i.length,o=(n=e.marker)==null?void 0:n.line;if(!s||!o)throw new Error(`No row ${o} or output length ${s} for command ${e}`);this.raw.select(0,o+1,s-Math.floor(s/this.raw.cols))}const t=this._serializeAddon.serializeAsHTML({onlySelection:!0});return e&&this.raw.clearSelection(),t}attachToElement(e,t){var s,o;const i={enableGpu:!0,...t};if(this._attached||this.raw.open(e),i.enableGpu&&(this._shouldLoadWebgl()?this._enableWebglRenderer():this._shouldLoadCanvas()&&this._enableCanvasRenderer()),!this.raw.element||!this.raw.textarea)throw new Error("xterm elements not set after open");const n=this._attachedDisposables;return n.clear(),n.add(O(this.raw.textarea,"focus",()=>this._setFocused(!0))),n.add(O(this.raw.textarea,"blur",()=>this._setFocused(!1))),n.add(O(this.raw.textarea,"focusout",()=>this._setFocused(!1))),(s=this._suggestAddon)==null||s.setContainer(e),this._attached={container:e,options:i},(o=this._attached)==null?void 0:o.container.querySelector(".xterm-screen")}_setFocused(e){this._onDidChangeFocus.fire(e),this._anyTerminalFocusContextKey.set(e),this._anyFocusedTerminalHasSelection.set(e&&this.raw.hasSelection())}write(e){this.raw.write(e)}resize(e,t){this.raw.resize(e,t)}updateConfig(){var i;const e=this._configHelper.config;this.raw.options.altClickMovesCursor=e.altClickMovesCursor,this._setCursorBlink(e.cursorBlinking),this._setCursorStyle(e.cursorStyle),this._setCursorWidth(e.cursorWidth),this.raw.options.scrollback=e.scrollback,this.raw.options.drawBoldTextInBrightColors=e.drawBoldTextInBrightColors,this.raw.options.minimumContrastRatio=e.minimumContrastRatio,this.raw.options.tabStopWidth=e.tabStopWidth,this.raw.options.fastScrollSensitivity=e.fastScrollSensitivity,this.raw.options.scrollSensitivity=e.mouseWheelScrollSensitivity,this.raw.options.macOptionIsMeta=e.macOptionIsMeta;const t=this._configurationService.getValue("editor");this.raw.options.altClickMovesCursor=e.altClickMovesCursor&&t.multiCursorModifier==="alt",this.raw.options.macOptionClickForcesSelection=e.macOptionClickForcesSelection,this.raw.options.rightClickSelectsWord=e.rightClickBehavior==="selectWord",this.raw.options.wordSeparator=e.wordSeparators,this.raw.options.customGlyphs=e.customGlyphs,this.raw.options.smoothScrollDuration=e.smoothScrolling?125:0,(i=this._attached)!=null&&i.options.enableGpu&&(this._shouldLoadWebgl()?this._enableWebglRenderer():(this._disposeOfWebglRenderer(),this._shouldLoadCanvas()?this._enableCanvasRenderer():this._disposeOfCanvasRenderer())),this._refreshImageAddon()}_shouldLoadWebgl(){return!ah&&this._configHelper.config.gpuAcceleration==="auto"&&ct._suggestedRendererType===void 0||this._configHelper.config.gpuAcceleration==="on"}_shouldLoadCanvas(){return this._configHelper.config.gpuAcceleration==="auto"&&(ct._suggestedRendererType===void 0||ct._suggestedRendererType==="canvas")||this._configHelper.config.gpuAcceleration==="canvas"}forceRedraw(){this.raw.clearTextureAtlas()}clearDecorations(){var e;(e=this._decorationAddon)==null||e.clearDecorations()}forceRefresh(){var e;(e=this._core.viewport)==null||e._innerRefresh()}forceUnpause(){var e;this._canvasAddon&&((e=this._core._renderService)==null||e._handleIntersectionChange({intersectionRatio:1}),this.raw.refresh(0,this.raw.rows-1))}async findNext(e,t){return this._updateFindColors(t),(await this._getSearchAddon()).findNext(e,t)}async findPrevious(e,t){return this._updateFindColors(t),(await this._getSearchAddon()).findPrevious(e,t)}_updateFindColors(e){const t=this._themeService.getColorTheme(),i=t.getColor(ta)||t.getColor(ia),n=t.getColor(Ic),s=t.getColor(kc),o=t.getColor(ea),a=t.getColor(Tc),l=t.getColor(Dc),h=t.getColor(Pc);e.decorations={activeMatchBackground:n==null?void 0:n.toString(),activeMatchBorder:(s==null?void 0:s.toString())||"transparent",activeMatchColorOverviewRuler:(o==null?void 0:o.toString())||"transparent",matchBackground:i?a==null?void 0:a.blend(i).toString():void 0,matchBorder:(l==null?void 0:l.toString())||"transparent",matchOverviewRuler:(h==null?void 0:h.toString())||"transparent"}}_getSearchAddon(){return this._searchAddonPromise||(this._searchAddonPromise=this._getSearchAddonConstructor().then(e=>(this._searchAddon=new e({highlightLimit:1e3}),this.raw.loadAddon(this._searchAddon),this._searchAddon.onDidChangeResults(t=>{this._lastFindResult=t,this._onDidChangeFindResults.fire(t)}),this._searchAddon))),this._searchAddonPromise}clearSearchDecorations(){var e;(e=this._searchAddon)==null||e.clearDecorations()}clearActiveSearchDecoration(){var e;(e=this._searchAddon)==null||e.clearActiveDecoration()}getFont(){return this._configHelper.getFont(this._core)}getLongestViewportWrappedLineLength(){let e=0;for(let t=this.raw.buffer.active.length-1;t>=this.raw.buffer.active.viewportY;t--){const i=this._getWrappedLineCount(t,this.raw.buffer.active);e=Math.max(e,i.lineCount*this.raw.cols-i.endSpaces||0),t=i.currentIndex}return e}_getWrappedLineCount(e,t){var o;let i=t.getLine(e);if(!i)throw new Error("Could not get line");let n=e,s=0;for(let a=Math.min(i.length,this.raw.cols)-1;a>=0&&!((o=i==null?void 0:i.getCell(a))!=null&&o.getChars());a--)s++;for(;i!=null&&i.isWrapped&&n>0;)n--,i=t.getLine(n);return{lineCount:e-n+1,currentIndex:n,endSpaces:s}}scrollDownLine(){this.raw.scrollLines(1)}scrollDownPage(){this.raw.scrollPages(1)}scrollToBottom(){this.raw.scrollToBottom()}scrollUpLine(){this.raw.scrollLines(-1)}scrollUpPage(){this.raw.scrollPages(-1)}scrollToTop(){this.raw.scrollToTop()}clearBuffer(){var e,t;this.raw.clear(),(e=this._capabilities.get(2))==null||e.handlePromptStart(),(t=this._capabilities.get(2))==null||t.handleCommandStart()}hasSelection(){return this.raw.hasSelection()}clearSelection(){this.raw.clearSelection()}selectAll(){this.raw.focus(),this.raw.selectAll()}focus(){this.raw.focus()}async copySelection(e,t){if(this.hasSelection()||e&&t)if(e){let n=function(s){s.clipboardData.types.includes("text/plain")||s.clipboardData.setData("text/plain",(t==null?void 0:t.getOutput())??""),s.clipboardData.setData("text/html",i),s.preventDefault()};const i=await this.getSelectionAsHtml(t);document.addEventListener("copy",n),document.execCommand("copy"),document.removeEventListener("copy",n)}else await this._clipboardService.writeText(this.raw.getSelection());else this._notificationService.warn(c("terminal.integrated.copySelection.noSelection","The terminal has no selection to copy"))}_setCursorBlink(e){this.raw.options.cursorBlink!==e&&(this.raw.options.cursorBlink=e,this.raw.refresh(0,this.raw.rows-1))}_setCursorStyle(e){this.raw.options.cursorStyle!==e&&(this.raw.options.cursorStyle=e==="line"?"bar":e)}_setCursorWidth(e){this.raw.options.cursorWidth!==e&&(this.raw.options.cursorWidth=e)}async _enableWebglRenderer(){if(!this.raw.element||this._webglAddon)return;const e=await this._getWebglAddonConstructor();this._webglAddon=new e,this._disposeOfCanvasRenderer();try{this.raw.loadAddon(this._webglAddon),this._logService.trace("Webgl was loaded"),this._webglAddon.onContextLoss(()=>{this._logService.info("Webgl lost context, disposing of webgl renderer"),this._disposeOfWebglRenderer()})}catch(t){this._logService.warn("Webgl could not be loaded. Falling back to the canvas renderer type.",t),!this._storageService.getBoolean("terminal.integrated.neverMeasureRenderTime",-1,!1)&&this._configHelper.config.gpuAcceleration!=="off"&&this._measureRenderTime(),ct._suggestedRendererType="canvas",this._disposeOfWebglRenderer(),this._enableCanvasRenderer()}}async _enableCanvasRenderer(){if(!this.raw.element||this._canvasAddon)return;const e=await this._getCanvasAddonConstructor();this._canvasAddon=new e,this._disposeOfWebglRenderer();try{this.raw.loadAddon(this._canvasAddon),this._logService.trace("Canvas renderer was loaded")}catch(t){this._logService.warn("Canvas renderer could not be loaded, falling back to dom renderer",t),!this._storageService.getBoolean("terminal.integrated.neverMeasureRenderTime",-1,!1)&&this._configHelper.config.gpuAcceleration!=="off"&&this._measureRenderTime(),ct._suggestedRendererType="dom",this._disposeOfCanvasRenderer()}}async _getCanvasAddonConstructor(){return hs||(hs=(await yt(()=>import("./xterm-addon-canvas-0681e5a4.js").then(e=>e.x),["assets/xterm-addon-canvas-0681e5a4.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"]).then(e=>e.default??e)).CanvasAddon),hs}async _refreshImageAddon(){var e;if(this._configHelper.config.enableImages){if(!this._imageAddon){const t=await this._getImageAddonConstructor();this._imageAddon=new t,this.raw.loadAddon(this._imageAddon)}}else{try{(e=this._imageAddon)==null||e.dispose()}catch{}this._imageAddon=void 0}}async _getImageAddonConstructor(){return ds||(ds=(await yt(()=>import("./xterm-addon-image-3e4a5825.js").then(e=>e.x),["assets/xterm-addon-image-3e4a5825.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"]).then(e=>e.default??e)).ImageAddon),ds}async _getSearchAddonConstructor(){return us||(us=(await yt(()=>import("./xterm-addon-search-331a2ced.js").then(e=>e.x),["assets/xterm-addon-search-331a2ced.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"]).then(e=>e.default??e)).SearchAddon),us}async _getUnicode11Constructor(){return gs||(gs=(await yt(()=>import("./xterm-addon-unicode11-333b880b.js").then(e=>e.x),["assets/xterm-addon-unicode11-333b880b.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"]).then(e=>e.default??e)).Unicode11Addon),gs}async _getWebglAddonConstructor(){return ps||(ps=(await yt(()=>import("./xterm-addon-webgl-541adec6.js").then(e=>e.x),["assets/xterm-addon-webgl-541adec6.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"]).then(e=>e.default??e)).WebglAddon),ps}async _getSerializeAddonConstructor(){return ms||(ms=(await yt(()=>import("./xterm-addon-serialize-c7cebd59.js").then(e=>e.x),["assets/xterm-addon-serialize-c7cebd59.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"]).then(e=>e.default??e)).SerializeAddon),ms}_disposeOfCanvasRenderer(){var e;try{(e=this._canvasAddon)==null||e.dispose()}catch{}this._canvasAddon=void 0}_disposeOfWebglRenderer(){var e;try{(e=this._webglAddon)==null||e.dispose()}catch{}this._webglAddon=void 0}async _measureRenderTime(){var s;const e=[];if(!((s=this._core._renderService)!=null&&s._renderer._renderLayers))return;const t=this._core._renderService._renderer._renderLayers[0],i=t==null?void 0:t.onGridChanged,n=()=>{if(e.shift(),e.sort((a,l)=>a-l)[Math.floor(e.length/2)]>50)if(this._configHelper.config.gpuAcceleration==="auto")ct._suggestedRendererType="dom",this.updateConfig();else{const a=[{label:c("yes","Yes"),run:()=>this._configurationService.updateValue("terminal.integrated.gpuAcceleration","off",2)},{label:c("no","No"),run:()=>{}},{label:c("dontShowAgain","Don't Show Again"),isSecondary:!0,run:()=>this._storageService.store("terminal.integrated.neverMeasureRenderTime",!0,-1,1)}];this._notificationService.prompt(ne.Warning,c("terminal.slowRendering","Terminal GPU acceleration appears to be slow on your computer. Would you like to switch to disable it which may improve performance? [Read more about terminal settings](https://code.visualstudio.com/docs/editor/integrated-terminal#_changing-how-the-terminal-is-rendered)."),a)}};t.onGridChanged=(o,a,l)=>{const h=performance.now();i.call(t,o,a,l),e.push(performance.now()-h),e.length===20&&(n(),t.onGridChanged=i)}}_getXtermTheme(e){var h,m,p,v,f,_,S,y,M,D,R,N,C,W,z,G;e||(e=this._themeService.getColorTheme());const t=e.getColor(Ac),i=this._backgroundColorProvider.getBackgroundColor(e),n=e.getColor(Ec)||t,s=e.getColor(Lc)||i,o=e.getColor(Rc),a=e.getColor(Mc),l=e.getColor(Fc)||void 0;return{background:i==null?void 0:i.toString(),foreground:t==null?void 0:t.toString(),cursor:n==null?void 0:n.toString(),cursorAccent:s==null?void 0:s.toString(),selectionBackground:o==null?void 0:o.toString(),selectionInactiveBackground:a==null?void 0:a.toString(),selectionForeground:l==null?void 0:l.toString(),black:(h=e.getColor(ce[0]))==null?void 0:h.toString(),red:(m=e.getColor(ce[1]))==null?void 0:m.toString(),green:(p=e.getColor(ce[2]))==null?void 0:p.toString(),yellow:(v=e.getColor(ce[3]))==null?void 0:v.toString(),blue:(f=e.getColor(ce[4]))==null?void 0:f.toString(),magenta:(_=e.getColor(ce[5]))==null?void 0:_.toString(),cyan:(S=e.getColor(ce[6]))==null?void 0:S.toString(),white:(y=e.getColor(ce[7]))==null?void 0:y.toString(),brightBlack:(M=e.getColor(ce[8]))==null?void 0:M.toString(),brightRed:(D=e.getColor(ce[9]))==null?void 0:D.toString(),brightGreen:(R=e.getColor(ce[10]))==null?void 0:R.toString(),brightYellow:(N=e.getColor(ce[11]))==null?void 0:N.toString(),brightBlue:(C=e.getColor(ce[12]))==null?void 0:C.toString(),brightMagenta:(W=e.getColor(ce[13]))==null?void 0:W.toString(),brightCyan:(z=e.getColor(ce[14]))==null?void 0:z.toString(),brightWhite:(G=e.getColor(ce[15]))==null?void 0:G.toString()}}_updateTheme(e){this.raw.options.theme=this._getXtermTheme(e)}refresh(){this._updateTheme(),this._decorationAddon.refreshLayouts()}async _updateUnicodeVersion(){if(!this._unicode11Addon&&this._configHelper.config.unicodeVersion==="11"){const e=await this._getUnicode11Constructor();this._unicode11Addon=new e,this.raw.loadAddon(this._unicode11Addon)}this.raw.unicode.activeVersion!==this._configHelper.config.unicodeVersion&&(this.raw.unicode.activeVersion=this._configHelper.config.unicodeVersion)}_writeText(e){this.raw.write(e)}dispose(){this._anyTerminalFocusContextKey.reset(),this._anyFocusedTerminalHasSelection.reset(),this._onDidDispose.fire(),super.dispose()}};Ei._suggestedRendererType=void 0;Ei=w([d(9,X),d(10,B),d(11,it),d(12,se),d(13,bt),d(14,de),d(15,ai),d(16,$n),d(17,me)],Ei);function Xd(r,e,t){if(!r.charWidth||!r.charHeight)return null;const i=e*window.devicePixelRatio,n=r.charWidth*window.devicePixelRatio+r.letterSpacing,s=Math.max(Math.floor(i/n),1),o=t*window.devicePixelRatio,a=Math.ceil(r.charHeight*window.devicePixelRatio),l=Math.floor(a*r.lineHeight);return{rows:Math.max(Math.floor(o/l),1),cols:s}}function Mo(r){switch(r){case li.Trace:case li.Debug:return"debug";case li.Info:return"info";case li.Warning:return"warn";case li.Error:return"error";default:return"off"}}function qa(r,e){Li.INSTANCE.registerTerminalContribution(r,e)}var nr;(function(r){function e(){return Li.INSTANCE.getTerminalContributions()}r.getTerminalContributions=e})(nr||(nr={}));class Li{constructor(){this._terminalContributions=[]}registerTerminalContribution(e,t){this._terminalContributions.push({id:e,ctor:t})}getTerminalContributions(){return this._terminalContributions.slice(0)}}Li.INSTANCE=new Li;fe.add("terminal.contributions",Li.INSTANCE);class Yd{constructor(e){this._process=e,this.type=1,this._cwd="",this._onDidChangeCwd=new b,this.onDidChangeCwd=this._onDidChangeCwd.event}async getCwd(){if(!this._process)return Promise.resolve("");const e=await this._process.getCwd();return e!==this._cwd&&this._onDidChangeCwd.fire(e),this._cwd=e,this._cwd}}class Qd{constructor(e,t){this._totalDataLength=0,this._entries=[{cols:e,rows:t,data:[]}]}handleResize(e,t){if(this._entries.length>0&&this._entries[this._entries.length-1].data.length===0&&this._entries.pop(),this._entries.length>0){const i=this._entries[this._entries.length-1];if(i.cols===e&&i.rows===t)return;if(i.cols===0&&i.rows===0){i.cols=e,i.rows=t;return}}this._entries.push({cols:e,rows:t,data:[]})}handleData(e){for(this._entries[this._entries.length-1].data.push(e),this._totalDataLength+=e.length;this._totalDataLength>1048576;){const i=this._entries[0],n=this._totalDataLength-1048576;n>=i.data[0].length?(this._totalDataLength-=i.data[0].length,i.data.shift(),i.data.length===0&&this._entries.shift()):(i.data[0]=i.data[0].substr(n),this._totalDataLength-=n)}}generateReplayEventSync(){return this._entries.forEach(e=>{e.data.length>0&&(e.data=[e.data.join("")])}),{events:this._entries.map(e=>({cols:e.cols,rows:e.rows,data:e.data[0]??""})),commands:{isWindowsPty:!1,commands:[]}}}async generateReplayEvent(){return this.generateReplayEventSync()}}let Wn=class{constructor(e,t,i,n,s){this._diff=e,this._terminalId=t,this._collection=i,this._terminalService=n,this._extensionService=s,this.requiresAction=!0}_getInfo(e){const t=new Set;hn(t,this._diff.added.values()),hn(t,this._diff.removed.values()),hn(t,this._diff.changed.values());let i=c("extensionEnvironmentContributionInfoStale","The following extensions want to relaunch the terminal to contribute to its environment:");return i+=ja(this._collection,e,this._extensionService,t),i}_getActions(){return[{label:c("relaunchTerminalLabel","Relaunch terminal"),run:()=>{var e;return(e=this._terminalService.getInstanceFromId(this._terminalId))==null?void 0:e.relaunch()},commandId:"workbench.action.terminal.relaunch"}]}getStatus(e){return{id:"relaunch-needed",severity:Oe.Warning,icon:k.warning,tooltip:this._getInfo(e),hoverActions:this._getActions()}}};Wn=w([d(3,J),d(4,ue)],Wn);let vi=class{constructor(e,t,i){this._collection=e,this._commandService=t,this._extensionService=i,this.requiresAction=!1}_getInfo(e){const t=new Set;hn(t,this._collection.getVariableMap(e).values());let i=c("extensionEnvironmentContributionInfoActive","The following extensions have contributed to this terminal's environment:");return i+=ja(this._collection,e,this._extensionService,t),i}_getActions(e){return[{label:c("showEnvironmentContributions","Show environment contributions"),run:()=>this._commandService.executeCommand("workbench.action.terminal.showEnvironmentContributions",e),commandId:"workbench.action.terminal.showEnvironmentContributions"}]}getStatus(e){return{id:"env-var-info-changes-active",severity:Oe.Info,tooltip:this._getInfo(e),hoverActions:this._getActions(e)}}};vi=w([d(1,pe),d(2,ue)],vi);function ja(r,e,t,i){const n=[`
`],s=r.getDescriptionMap(void 0),o=r.getDescriptionMap(e);for(const a of i){const l=s.get(a);l&&(n.push(`
- \`${fs(a,t)}\``),n.push(`: ${l}`));const h=o.get(a);if(h){const m=l?` (${c("ScopedEnvironmentContributionInfo","workspace")})`:"";n.push(`
- \`${fs(a,t)}${m}\``),n.push(`: ${h}`)}!l&&!h&&n.push(`
- \`${fs(a,t)}\``)}return n.join("")}function hn(r,e){for(const t of e)for(const i of t)r.add(i.extensionIdentifier)}function fs(r,e){var t;return((t=e.extensions.find(i=>i.id===r))==null?void 0:t.displayName)||r}var Xe;(function(r){r[r.Replace=1]="Replace",r[r.Append=2]="Append",r[r.Prepend=3]="Prepend"})(Xe||(Xe={}));const Jd=new Map([[Xe.Append,"APPEND"],[Xe.Prepend,"PREPEND"],[Xe.Replace,"REPLACE"]]);class Xa{constructor(e){this.collections=e,this.map=new Map,this.descriptionMap=new Map,e.forEach((t,i)=>{this.populateDescriptionMap(t,i);const n=t.map.entries();let s=n.next();for(;!s.done;){const o=s.value[1],a=s.value[0];let l=this.map.get(a);if(l||(l=[],this.map.set(a,l)),l.length>0&&l[0].type===Xe.Replace){s=n.next();continue}const h={extensionIdentifier:i,value:o.value,type:o.type,scope:o.scope,variable:o.variable,options:o.options};h.scope||delete h.scope,l.unshift(h),s=n.next()}})}async applyToProcessEnvironment(e,t,i){var s,o;let n;re&&(n={},Object.keys(e).forEach(a=>n[a.toLowerCase()]=a));for(const[a,l]of this.getVariableMap(t)){const h=re&&n[a.toLowerCase()]||a;for(const m of l){const p=i?await i(m.value):m.value;if(((s=m.options)==null?void 0:s.applyAtProcessCreation)??!0)switch(m.type){case Xe.Append:e[h]=(e[h]||"")+p;break;case Xe.Prepend:e[h]=p+(e[h]||"");break;case Xe.Replace:e[h]=p;break}if(((o=m.options)==null?void 0:o.applyAtShellIntegration)??!1){const v=`VSCODE_ENV_${Jd.get(m.type)}`;e[v]=(e[v]?e[v]+":":"")+a+"="+this._encodeColons(p)}}}}_encodeColons(e){return e.replaceAll(":","\\x3a")}diff(e,t){const i=new Map,n=new Map,s=new Map;if(e.getVariableMap(t).forEach((o,a)=>{const l=this.getVariableMap(t).get(a),h=Wo(o,l);h&&i.set(a,h)}),this.getVariableMap(t).forEach((o,a)=>{const l=e.getVariableMap(t).get(a),h=Wo(o,l);h&&s.set(a,h)}),this.getVariableMap(t).forEach((o,a)=>{const l=e.getVariableMap(t).get(a),h=Zd(o,l);h&&n.set(a,h)}),!(i.size===0&&n.size===0&&s.size===0))return{added:i,changed:n,removed:s}}getVariableMap(e){const t=new Map;return this.map.forEach((i,n)=>{const s=i.filter(o=>Fo(o,e));s.length>0&&t.set(s[0].variable,s)}),t}getDescriptionMap(e){const t=new Map;return this.descriptionMap.forEach((i,n)=>{const s=i.filter(o=>Fo(o,e,!0));s.length>0&&t.set(s[0].extensionIdentifier,s[0].description)}),t}populateDescriptionMap(e,t){if(!e.descriptionMap)return;const i=e.descriptionMap.entries();let n=i.next();for(;!n.done;){const s=n.value[1],o=n.value[0];let a=this.descriptionMap.get(o);a||(a=[],this.descriptionMap.set(o,a));const l={extensionIdentifier:t,scope:s.scope,description:s.description};l.scope||delete l.scope,a.push(l),n=i.next()}}}function Fo(r,e,t=!1){return r.scope?!!(r.scope.workspaceFolder&&(e!=null&&e.workspaceFolder)&&r.scope.workspaceFolder.index===e.workspaceFolder.index):t?e===r.scope:!0}function Wo(r,e){if(!e)return r;const t=new Set;e.forEach(n=>t.add(n.extensionIdentifier));const i=[];return r.forEach(n=>{t.has(n.extensionIdentifier)||i.push(n)}),i.length===0?void 0:i}function Zd(r,e){if(!e)return;const t=new Map;e.forEach(n=>t.set(n.extensionIdentifier,n));const i=[];return r.forEach(n=>{var o,a,l,h;const s=t.get(n.extensionIdentifier);s&&(n.type!==s.type||n.value!==s.value||((a=(o=n.scope)==null?void 0:o.workspaceFolder)==null?void 0:a.index)!==((h=(l=s.scope)==null?void 0:l.workspaceFolder)==null?void 0:h.index))&&i.push(s)}),i.length===0?void 0:i}function eu(r,...e){const t=e.reduce((s,o)=>(s[o]=!0,s),{}),i=[/^ELECTRON_.+$/,/^VSCODE_(?!(PORTABLE|SHELL_LOGIN|ENV_REPLACE|ENV_APPEND|ENV_PREPEND)).+$/,/^SNAP(|_.*)$/,/^GDK_PIXBUF_.+$/];Object.keys(r).filter(s=>!t[s]).forEach(s=>{for(let o=0;o<i.length;o++)if(s.search(i[o])!==-1){delete r[s];break}})}function No(r,e){if(e)if(re)for(const t in e){let i=t;for(const s in r)if(t.toLowerCase()===s.toLowerCase()){i=s;break}const n=e[t];n!==void 0&&Bo(r,i,n)}else Object.keys(e).forEach(t=>{const i=e[t];i!==void 0&&Bo(r,t,i)})}function Bo(r,e,t){typeof t=="string"?r[e]=t:delete r[e]}function tu(r,e,t,i){r.TERM_PROGRAM="vscode",e&&(r.TERM_PROGRAM_VERSION=e),iu(r,i)&&(r.LANG=nu(t)),r.COLORTERM="truecolor"}function Oo(r,e){if(e)for(const t of Object.keys(e)){const i=e[t];i!=null&&(r[t]=i)}}async function Vo(r,e){return await Promise.all(Object.entries(e).map(async([t,i])=>{if(typeof i=="string")try{e[t]=await r(i)}catch{e[t]=i}})),e}function iu(r,e){if(e==="on")return!0;if(e==="auto"){const t=r.LANG;return!t||t.search(/\.UTF\-8$/)===-1&&t.search(/\.utf8$/)===-1&&t.search(/\.euc.+/)===-1}return!1}function nu(r){const e=r?r.split("-"):[],t=e.length;if(t===0)return"en_US.UTF-8";if(t===1){const i={af:"ZA",am:"ET",be:"BY",bg:"BG",ca:"ES",cs:"CZ",da:"DK",de:"DE",el:"GR",en:"US",es:"ES",et:"EE",eu:"ES",fi:"FI",fr:"FR",he:"IL",hr:"HR",hu:"HU",hy:"AM",is:"IS",it:"IT",ja:"JP",kk:"KZ",ko:"KR",lt:"LT",nl:"NL",no:"NO",pl:"PL",pt:"BR",ro:"RO",ru:"RU",sk:"SK",sl:"SI",sr:"YU",sv:"SE",tr:"TR",uk:"UA",zh:"CN"};e[0]in i&&e.push(i[e[0]])}else e[1]=e[1].toUpperCase();return e.join("_")+".UTF-8"}async function su(r,e,t,i,n,s){if(r.cwd){const a=typeof r.cwd=="object"?r.cwd.fsPath:r.cwd,l=await Ho(a,t);return Qs(l||a)}let o;return!r.ignoreConfigurationCwd&&n&&(t&&(n=await Ho(n,t,s)),n&&(ha(n)?o=n:i&&(o=Is(i.fsPath,n)))),o||(o=i?i.fsPath:e||""),Qs(o)}async function Ho(r,e,t){if(e)try{return await e(r)}catch(i){t==null||t.error("Could not resolve terminal cwd",i);return}return r}function ru(r,e,t){if(t)return i=>t.resolveWithEnvironment(e,r,i)}async function ou(r,e,t,i,n,s){const o={};if(r.strictEnv)Oo(o,r.env);else{Oo(o,s);const a={...e};t&&(a&&await Vo(t,a),r.env&&await Vo(t,r.env)),eu(o,"VSCODE_IPC_HOOK_CLI"),No(o,a),No(o,r.env),tu(o,i,Xn,n)}return o}async function au(r,e,t,i,n,s,o=re){let a;if(Qt(r)?a=r:(a=r.fsPath,o&&s!==1?a=a.replace(/\\/g,"/"):!o&&s===1&&(a=a.replace(/\//g,"\\"))),!e)return a;const l=a.includes(" "),h=a.includes("(")||a.includes(")"),m=Zt(e,".exe"),p=m==="pwsh"||t==="pwsh"||m==="powershell"||t==="powershell";if(p&&(l||a.includes("'")))return`& '${a.replace(/'/g,"''")}'`;if(h&&p)return`& '${a}'`;if(s===1){if(i!==void 0)return i==="gitbash"?Ao(a.replace(/\\/g,"/")):i==="wsl"?(n==null?void 0:n.getWslPath(a,"win-to-unix"))||a:l?`"${a}"`:a;const v=e.toLowerCase();return v.includes("wsl")||v.includes("bash.exe")&&!v.toLowerCase().includes("git")?(n==null?void 0:n.getWslPath(a,"win-to-unix"))||a:l?`"${a}"`:a}return Ao(a)}function sr(r,e,t){const i=typeof r=="string"?L.parse(r):r;let n=i?Qe(e.getWorkspaceFolder(i)):void 0;if(!n){const s=t.getLastActiveWorkspaceRoot();n=s?Qe(e.getWorkspaceFolder(s)):void 0}return n}let rr=class extends H{get persistentProcessId(){var e;return(e=this._process)==null?void 0:e.id}get shouldPersist(){return!!this.reconnectionProperties||(this._process?this._process.shouldPersist:!1)}get hasWrittenData(){return this._hasWrittenData}get hasChildProcesses(){return this._hasChildProcesses}get reconnectionProperties(){var e,t,i;return((t=(e=this._shellLaunchConfig)==null?void 0:e.attachPersistentProcess)==null?void 0:t.reconnectionProperties)||((i=this._shellLaunchConfig)==null?void 0:i.reconnectionProperties)||void 0}get extEnvironmentVariableCollection(){return this._extEnvironmentVariableCollection}constructor(e,t,i,n,s,o,a,l,h,m,p,v,f,_,S,y,M,D,R,N){super(),this._instanceId=e,this._configHelper=t,this._historyService=o,this._instantiationService=a,this._logService=l,this._workspaceContextService=h,this._configurationResolverService=m,this._workbenchEnvironmentService=p,this._productService=v,this._remoteAgentService=f,this._pathService=_,this._environmentVariableService=S,this._terminalProfileResolverService=y,this._configurationService=M,this._terminalInstanceService=D,this._telemetryService=R,this._notificationService=N,this.processState=1,this.capabilities=new to,this._isDisposed=!1,this._process=null,this._processType=0,this._preLaunchInputQueue=[],this._latency=-1,this._latencyLastMeasured=0,this._hasWrittenData=!1,this._hasChildProcesses=!1,this._ptyListenersAttached=!1,this._isDisconnected=!1,this._dimensions={cols:0,rows:0},this._onPtyDisconnect=this._register(new b),this.onPtyDisconnect=this._onPtyDisconnect.event,this._onPtyReconnect=this._register(new b),this.onPtyReconnect=this._onPtyReconnect.event,this._onProcessReady=this._register(new b),this.onProcessReady=this._onProcessReady.event,this._onProcessStateChange=this._register(new b),this.onProcessStateChange=this._onProcessStateChange.event,this._onBeforeProcessData=this._register(new b),this.onBeforeProcessData=this._onBeforeProcessData.event,this._onProcessData=this._register(new b),this.onProcessData=this._onProcessData.event,this._onProcessReplayComplete=this._register(new b),this.onProcessReplayComplete=this._onProcessReplayComplete.event,this._onDidChangeProperty=this._register(new b),this.onDidChangeProperty=this._onDidChangeProperty.event,this._onEnvironmentVariableInfoChange=this._register(new b),this.onEnvironmentVariableInfoChanged=this._onEnvironmentVariableInfoChange.event,this._onProcessExit=this._register(new b),this.onProcessExit=this._onProcessExit.event,this._onRestoreCommands=this._register(new b),this.onRestoreCommands=this._onRestoreCommands.event,this._cwdWorkspaceFolder=sr(i,this._workspaceContextService,this._historyService),this.ptyProcessReady=this._createPtyProcessReadyPromise(),this.getLatency(),this._ackDataBufferer=new cu(C=>{var W;return(W=this._process)==null?void 0:W.acknowledgeDataEvent(C)}),this._dataFilter=this._instantiationService.createInstance(or),this._dataFilter.onProcessData(C=>{const z={data:typeof C=="string"?C:C.data};this._onBeforeProcessData.fire(z),z.data&&z.data.length>0&&(typeof C!="string"&&(C.data=z.data),this._onProcessData.fire(typeof C!="string"?C:{data:z.data,trackCommit:!1}))}),i&&typeof i=="object"?this.remoteAuthority=ch(i):this.remoteAuthority=this._workbenchEnvironmentService.remoteAuthority,n&&(this._extEnvironmentVariableCollection=new Xa(n),this._register(this._environmentVariableService.onDidChangeCollections(C=>this._onEnvironmentVariableCollectionChange(C))),this.environmentVariableInfo=this._instantiationService.createInstance(vi,this._extEnvironmentVariableCollection),this._onEnvironmentVariableInfoChange.fire(this.environmentVariableInfo)),this.shellIntegrationNonce=s??lh()}async freePortKillProcess(e){var t,i;try{(t=this._process)!=null&&t.freePortKillProcess&&await((i=this._process)==null?void 0:i.freePortKillProcess(e))}catch(n){this._notificationService.notify({message:c("killportfailure","Could not kill process listening on port {0}, command exited with error {1}",e,n),severity:Oe.Warning})}}dispose(e=!1){this._isDisposed=!0,this._process&&(this._setProcessState(5),this._process.shutdown(e),this._process=null),super.dispose()}_createPtyProcessReadyPromise(){return new Promise(e=>{const t=this.onProcessReady(()=>{this._logService.debug(`Terminal process ready (shellProcessId: ${this.shellProcessId})`),t.dispose(),e(void 0)})})}async detachFromProcess(e){var t,i;await((i=(t=this._process)==null?void 0:t.detach)==null?void 0:i.call(t,e)),this._process=null}async createProcess(e,t,i,n=!0){var a,l;this._shellLaunchConfig=e,this._dimensions.cols=t,this._dimensions.rows=i;let s;if(e.customPtyImplementation)this._processType=1,s=e.customPtyImplementation(this._instanceId,t,i);else{const h=await this._terminalInstanceService.getBackend(this.remoteAuthority);if(!h)throw new Error(`No terminal backend registered for remote authority '${this.remoteAuthority}'`);this.backend=h;const m=ru(this._cwdWorkspaceFolder,await this._terminalProfileResolverService.getEnvironment(this.remoteAuthority),this._configurationResolverService);if(this.userHome=(a=this._pathService.resolvedUserHome)==null?void 0:a.fsPath,this.os=Ye,this.remoteAuthority){const p=await this._pathService.userHome();this.userHome=p.path;const v=await this._remoteAgentService.getEnvironment();if(!v)throw new Error(`Failed to get remote environment for remote authority "${this.remoteAuthority}"`);this.userHome=v.userHome.path,this.os=v.os;const f=await this._resolveEnvironment(h,m,e),_=(this._configurationService.getValue("task.reconnection")&&e.reconnectionProperties||!e.isFeatureTerminal)&&this._configHelper.config.enablePersistentSessions&&!e.isTransient;if(e.attachPersistentProcess){const S=await h.attachToProcess(e.attachPersistentProcess.id);S?s=S:(this._logService.warn("Attach to process failed for terminal",e.attachPersistentProcess),e.attachPersistentProcess=void 0)}if(!s){await this._terminalProfileResolverService.resolveShellLaunchConfig(e,{remoteAuthority:this.remoteAuthority,os:this.os});const S={shellIntegration:{enabled:this._configurationService.getValue("terminal.integrated.shellIntegration.enabled"),suggestEnabled:this._configurationService.getValue("terminal.integrated.shellIntegration.suggestEnabled"),nonce:this.shellIntegrationNonce},windowsEnableConpty:this._configHelper.config.windowsEnableConpty,environmentVariableCollections:(l=this._extEnvironmentVariableCollection)!=null&&l.collections?go(this._extEnvironmentVariableCollection.collections):void 0,workspaceFolder:this._cwdWorkspaceFolder};try{s=await h.createProcess(e,"",t,i,this._configHelper.config.unicodeVersion,f,S,_)}catch(y){if((y==null?void 0:y.message)==="Could not fetch remote environment"){this._logService.trace("Could not fetch remote environment, silently failing");return}throw y}}this._isDisposed||this._setupPtyHostListeners(h)}else{if(e.attachPersistentProcess){const p=e.attachPersistentProcess.findRevivedId?await h.attachToRevivedProcess(e.attachPersistentProcess.id):await h.attachToProcess(e.attachPersistentProcess.id);p?s=p:(this._logService.warn("Attach to process failed for terminal",e.attachPersistentProcess),e.attachPersistentProcess=void 0)}s||(s=await this._launchLocalProcess(h,e,t,i,this.userHome,m)),this._isDisposed||this._setupPtyHostListeners(h)}}if(this._isDisposed){s.shutdown(!1);return}this._process=s,this._setProcessState(2),(this.os===3||this.os===2)&&this.capabilities.add(1,new Yd(this._process)),this._dataFilter.newProcess(this._process,n),this._processListeners&&ee(this._processListeners),this._processListeners=[s.onProcessReady(h=>{this.shellProcessId=h.pid,this._initialCwd=h.cwd,this._onDidChangeProperty.fire({type:"initialCwd",value:this._initialCwd}),this._onProcessReady.fire(h),this._preLaunchInputQueue.length>0&&this._process&&(s.input(this._preLaunchInputQueue.join("")),this._preLaunchInputQueue.length=0)}),s.onProcessExit(h=>this._onExit(h)),s.onDidChangeProperty(({type:h,value:m})=>{var p;switch(h){case"hasChildProcesses":this._hasChildProcesses=m;break;case"failedShellIntegrationActivation":(p=this._telemetryService)==null||p.publicLog2("terminal/shellIntegrationActivationFailureCustomArgs");break}this._onDidChangeProperty.fire({type:h,value:m})})],s.onProcessReplayComplete&&this._processListeners.push(s.onProcessReplayComplete(()=>this._onProcessReplayComplete.fire())),s.onRestoreCommands&&this._processListeners.push(s.onRestoreCommands(h=>this._onRestoreCommands.fire(h))),setTimeout(()=>{this.processState===2&&this._setProcessState(3)},500);const o=await s.start();if(o)return o}async relaunch(e,t,i,n){return this.ptyProcessReady=this._createPtyProcessReadyPromise(),this._logService.trace(`Relaunching terminal instance ${this._instanceId}`),this._isDisconnected&&(this._isDisconnected=!1,this._onPtyReconnect.fire()),this._hasWrittenData=!1,this.createProcess(e,t,i,n)}async _resolveEnvironment(e,t,i){const n=sr(i.cwd,this._workspaceContextService,this._historyService),s=re?"windows":Ee?"osx":"linux",o=this._configurationService.getValue(`terminal.integrated.env.${s}`);this._configHelper.showRecommendations(i);let a;i.useShellEnvironment?a=await e.getShellEnvironment():a=await this._terminalProfileResolverService.getEnvironment(this.remoteAuthority);const l=await ou(i,o,t,this._productService.version,this._configHelper.config.detectLocale,a);return!this._isDisposed&&!i.strictEnv&&!i.hideFromUser&&(this._extEnvironmentVariableCollection=this._environmentVariableService.mergedCollection,this._register(this._environmentVariableService.onDidChangeCollections(h=>this._onEnvironmentVariableCollectionChange(h))),await this._extEnvironmentVariableCollection.applyToProcessEnvironment(l,{workspaceFolder:n},t),this._extEnvironmentVariableCollection.getVariableMap({workspaceFolder:n}).size&&(this.environmentVariableInfo=this._instantiationService.createInstance(vi,this._extEnvironmentVariableCollection),this._onEnvironmentVariableInfoChange.fire(this.environmentVariableInfo))),l}async _launchLocalProcess(e,t,i,n,s,o){await this._terminalProfileResolverService.resolveShellLaunchConfig(t,{remoteAuthority:void 0,os:Ye});const a=this._historyService.getLastActiveWorkspaceRoot($.file),l=await su(t,s,o,a,this._configHelper.config.cwd,this._logService),h=await this._resolveEnvironment(e,o,t),m={shellIntegration:{enabled:this._configurationService.getValue("terminal.integrated.shellIntegration.enabled"),suggestEnabled:this._configurationService.getValue("terminal.integrated.shellIntegration.suggestEnabled"),nonce:this.shellIntegrationNonce},windowsEnableConpty:this._configHelper.config.windowsEnableConpty,environmentVariableCollections:this._extEnvironmentVariableCollection?go(this._extEnvironmentVariableCollection.collections):void 0,workspaceFolder:this._cwdWorkspaceFolder},p=(this._configurationService.getValue("task.reconnection")&&t.reconnectionProperties||!t.isFeatureTerminal)&&this._configHelper.config.enablePersistentSessions&&!t.isTransient;return await e.createProcess(t,l,i,n,this._configHelper.config.unicodeVersion,h,m,p)}_setupPtyHostListeners(e){this._ptyListenersAttached||(this._ptyListenersAttached=!0,this._register(e.onPtyHostUnresponsive(()=>{this._isDisconnected=!0,this._onPtyDisconnect.fire()})),this._ptyResponsiveListener=e.onPtyHostResponsive(()=>{this._isDisconnected=!1,this._onPtyReconnect.fire()}),this._register(Ce(()=>{var t;return(t=this._ptyResponsiveListener)==null?void 0:t.dispose()})),this._register(e.onPtyHostRestart(async()=>{var t;if(this._isDisconnected||(this._isDisconnected=!0,this._onPtyDisconnect.fire()),(t=this._ptyResponsiveListener)==null||t.dispose(),this._ptyResponsiveListener=void 0,this._shellLaunchConfig)if(this._shellLaunchConfig.isFeatureTerminal&&!this.reconnectionProperties)this._onExit(-1);else{const i=c("ptyHostRelaunch","Restarting the terminal because the connection to the shell process was lost...");this._onProcessData.fire({data:Xt(i,{loudFormatting:!0}),trackCommit:!1}),await this.relaunch(this._shellLaunchConfig,this._dimensions.cols,this._dimensions.rows,!1)}})))}async getBackendOS(){let e=Ye;if(this.remoteAuthority){const t=await this._remoteAgentService.getEnvironment();if(!t)throw new Error(`Failed to get remote environment for remote authority "${this.remoteAuthority}"`);e=t.os}return e}setDimensions(e,t,i){if(i){this._resize(e,t);return}return this.ptyProcessReady.then(()=>this._resize(e,t))}async setUnicodeVersion(e){var t;return(t=this._process)==null?void 0:t.setUnicodeVersion(e)}_resize(e,t){if(this._process){try{this._process.resize(e,t)}catch(i){if(i.code!=="EPIPE"&&i.code!=="ERR_IPC_CHANNEL_CLOSED")throw i}this._dimensions.cols=e,this._dimensions.rows=t}}async write(e){await this.ptyProcessReady,this._dataFilter.disableSeamlessRelaunch(),this._hasWrittenData=!0,this.shellProcessId||this._processType===1?this._process&&this._process.input(e):this._preLaunchInputQueue.push(e)}async processBinary(e){var t;await this.ptyProcessReady,this._dataFilter.disableSeamlessRelaunch(),this._hasWrittenData=!0,(t=this._process)==null||t.processBinary(e)}get initialCwd(){return this._initialCwd??""}async getLatency(){if(await this.ptyProcessReady,!this._process)return Promise.resolve(0);if(this._latencyLastMeasured===0||this._latencyLastMeasured+1e3<Date.now()){const e=this._process.getLatency();this._latency=await e,this._latencyLastMeasured=Date.now()}return Promise.resolve(this._latency)}async refreshProperty(e){if(!this._process)throw new Error("Cannot refresh property when process is not set");return this._process.refreshProperty(e)}async updateProperty(e,t){var i;return(i=this._process)==null?void 0:i.updateProperty(e,t)}acknowledgeDataEvent(e){this._ackDataBufferer.ack(e)}_onExit(e){this._process=null,this.processState===2&&this._setProcessState(4),this.processState===3&&this._setProcessState(6),this._onProcessExit.fire(e)}_setProcessState(e){this.processState=e,this._onProcessStateChange.fire()}_onEnvironmentVariableCollectionChange(e){const t=this._extEnvironmentVariableCollection.diff(e,{workspaceFolder:this._cwdWorkspaceFolder});if(t===void 0){this.environmentVariableInfo instanceof Wn&&(this.environmentVariableInfo=this._instantiationService.createInstance(vi,this._extEnvironmentVariableCollection),this._onEnvironmentVariableInfoChange.fire(this.environmentVariableInfo));return}this.environmentVariableInfo=this._instantiationService.createInstance(Wn,t,this._instanceId,e),this._onEnvironmentVariableInfoChange.fire(this.environmentVariableInfo)}async clearBuffer(){var e,t;(t=(e=this._process)==null?void 0:e.clearBuffer)==null||t.call(e)}};rr=w([d(5,On),d(6,B),d(7,it),d(8,_e),d(9,Bn),d(10,si),d(11,Fi),d(12,et),d(13,na),d(14,sa),d(15,vt),d(16,X),d(17,He),d(18,ai),d(19,se)],rr);class cu{constructor(e){this._callback=e,this._unsentCharCount=0}ack(e){for(this._unsentCharCount+=e;this._unsentCharCount>5e3;)this._unsentCharCount-=5e3,this._callback(5e3)}}let or=class extends H{get onProcessData(){return this._onProcessData.event}constructor(e){super(),this._logService=e,this._disableSeamlessRelaunch=!1,this._onProcessData=this._register(new b)}newProcess(e,t){var n,s,o,a,l;if((n=this._dataListener)==null||n.dispose(),(s=this._activeProcess)==null||s.shutdown(!1),this._activeProcess=e,!this._firstRecorder||!t||this._disableSeamlessRelaunch){(o=this._firstDisposable)==null||o.dispose(),[this._firstRecorder,this._firstDisposable]=this._createRecorder(e),this._disableSeamlessRelaunch&&t&&this._onProcessData.fire("\x1Bc"),this._dataListener=e.onProcessData(h=>this._onProcessData.fire(h)),this._disableSeamlessRelaunch=!1;return}this._secondRecorder&&this.triggerSwap(),this._swapTimeout=window.setTimeout(()=>this.triggerSwap(),3e3),(a=this._dataListener)==null||a.dispose(),(l=this._firstDisposable)==null||l.dispose();const i=this._createRecorder(e);[this._secondRecorder,this._secondDisposable]=i}disableSeamlessRelaunch(){this._disableSeamlessRelaunch=!0,this._stopRecording(),this.triggerSwap()}triggerSwap(){var i,n,s;if(this._swapTimeout&&(window.clearTimeout(this._swapTimeout),this._swapTimeout=void 0),!this._firstRecorder)return;if(!this._secondRecorder){this._firstRecorder=void 0,(i=this._firstDisposable)==null||i.dispose();return}const e=this._getDataFromRecorder(this._firstRecorder),t=this._getDataFromRecorder(this._secondRecorder);e===t?this._logService.trace("Seamless terminal relaunch - identical content"):(this._logService.trace("Seamless terminal relaunch - resetting content"),this._onProcessData.fire({data:`\x1Bc${t}`,trackCommit:!1})),(n=this._dataListener)==null||n.dispose(),this._dataListener=this._activeProcess.onProcessData(o=>this._onProcessData.fire(o)),this._firstRecorder=this._secondRecorder,(s=this._firstDisposable)==null||s.dispose(),this._firstDisposable=this._secondDisposable,this._secondRecorder=void 0}_stopRecording(){var e,t;this._swapTimeout||(this._firstRecorder=void 0,(e=this._firstDisposable)==null||e.dispose(),this._secondRecorder=void 0,(t=this._secondDisposable)==null||t.dispose())}_createRecorder(e){const t=new Qd(0,0),i=e.onProcessData(n=>t.handleData(typeof n=="string"?n:n.data));return[t,i]}_getDataFromRecorder(e){return e.generateReplayEventSync().events.filter(t=>!!t.data).map(t=>t.data).join("")}};or=w([d(0,it)],or);async function dn(r,e,t,i,n,s){var N;if(!e.xterm)return;const o=r.get(_t),a=r.get(B),l=r.get(le),h=r.get(bt),m=`terminal.pinnedRecentCommands.${e.shellType}`;let p,v=[];const f=new Set,_={iconClass:E.asClassName(dd),tooltip:c("removeCommand","Remove from Command History")},S={iconClass:E.asClassName(ud),tooltip:c("viewCommandOutput","View Command Output"),alwaysVisible:!1};if(i==="command"){let G=function(Y){return Y.replace(/\r?\n/g,"⏎").replace(/\s\s\s+/g,"⋯")};p=Ee?c("selectRecentCommandMac","Select a command to run (hold Option-key to edit the command)"):c("selectRecentCommand","Select a command to run (hold Alt-key to edit the command)");const C=e.capabilities.get(2),W=C==null?void 0:C.commands,z=C==null?void 0:C.executingCommand;if(z&&f.add(z),W&&W.length>0){for(const Y of W){const We=Y.command.trim();if(We.length===0||f.has(We))continue;let st=Od(Y.cwd,e.userHome,e.os===1?"\\":"/");Y.exitCode&&(Y.exitCode===-1?st+=" failed":st+=` exitCode: ${Y.exitCode}`),st=st.trim();const es=[S],ge=v.length>0?v[v.length-1]:void 0;if((ge==null?void 0:ge.type)!=="separator"&&(ge==null?void 0:ge.label)===We){ge.id=Y.timestamp.toString(),ge.description=st;continue}v.push({label:G(We),rawLabel:We,description:st,id:Y.timestamp.toString(),command:Y,buttons:Y.hasOutput()?es:void 0}),f.add(We)}v=v.reverse()}z&&v.unshift({label:G(z),rawLabel:z,description:C.cwd}),v.length>0&&v.unshift({type:"separator",label:x.currentSessionCategory});const ze=a.invokeFunction(wn),nt=[];for(const[Y,We]of ze.entries)!f.has(Y)&&We.shellType===e.shellType&&(nt.unshift({label:G(Y),rawLabel:Y,buttons:[_]}),f.add(Y));nt.length>0&&v.push({type:"separator",label:x.previousSessionCategory},...nt);const Zn=await a.invokeFunction(_d,e.shellType),ci=[];for(const Y of Zn)f.has(Y)||ci.unshift({label:G(Y),rawLabel:Y});ci.length>0&&v.push({type:"separator",label:c("shellFileHistoryCategory","{0} history",e.shellType)},...ci)}else{p=Ee?c("selectRecentDirectoryMac","Select a directory to go to (hold Option-key to edit the command)"):c("selectRecentDirectory","Select a directory to go to (hold Alt-key to edit the command)");const C=((N=e.capabilities.get(0))==null?void 0:N.cwds)||[];if(C&&C.length>0){for(const G of C)v.push({label:G,rawLabel:G});v=v.reverse(),v.unshift({type:"separator",label:x.currentSessionCategory})}const W=a.invokeFunction(As),z=[];for(const[G,ze]of W.entries)(ze===null||ze.remoteAuthority===e.remoteAuthority)&&!C.includes(G)&&z.unshift({label:G,rawLabel:G,buttons:[_]});z.length>0&&v.push({type:"separator",label:x.previousSessionCategory},...z)}if(v.length===0)return;const y=new hh({title:"Fuzzy search",icon:md,isChecked:n==="fuzzy",inputActiveOptionBorder:en(dh),inputActiveOptionForeground:en(uh),inputActiveOptionBackground:en(mh)});y.onChange(()=>{a.invokeFunction(dn,e,t,i,y.checked?"fuzzy":"contiguous",D.value)});const M=a.createInstance(Ri),D=l.createQuickPick(),R=v;return D.items=[...R],D.sortByLabel=!1,D.placeholder=p,D.matchOnLabelMode=n||"contiguous",D.toggles=[y],D.onDidTriggerItemButton(async C=>{var W,z;if(C.button===_)i==="command"?(W=a.invokeFunction(wn))==null||W.remove(C.item.label):(z=a.invokeFunction(As))==null||z.remove(C.item.label);else if(C.button===S){const G=C.item.command,ze=G==null?void 0:G.getOutput();if(ze&&(G!=null&&G.command)){const nt=await M.provideTextContent(L.from({scheme:Ri.scheme,path:`${G.command}... ${gi(G.timestamp,!0)}`,fragment:ze,query:`terminal-output-${G.timestamp}-${e.instanceId}`}));nt&&await o.openEditor({resource:nt.uri})}}await a.invokeFunction(dn,e,t,i,n,s)}),D.onDidChangeValue(async C=>{C||await a.invokeFunction(dn,e,t,i,n,C)}),D.onDidAccept(async()=>{const C=D.activeItems[0];let W;i==="cwd"?W=`cd ${await e.preparePathForShell(C.rawLabel)}`:W=C.rawLabel,D.hide(),e.runCommand(W,!D.keyMods.alt),D.keyMods.alt&&e.focus()}),s&&(D.value=s),new Promise(C=>{t.set(!0),ed(h,m,D,!0),D.onDidHide(()=>{t.set(!1),C()})})}let Ri=class Ya{constructor(e,t){this._modelService=t,e.registerTextModelContentProvider(Ya.scheme,this)}async provideTextContent(e){const t=this._modelService.getModel(e);return t&&!t.isDisposed()?t:this._modelService.createModel(e.fragment,null,e,!1)}};Ri.scheme="TERMINAL_OUTPUT";Ri=w([d(0,qn),d(1,Un)],Ri);let ar=class extends H{get onDidAddStatus(){return this._onDidAddStatus.event}get onDidRemoveStatus(){return this._onDidRemoveStatus.event}get onDidChangePrimaryStatus(){return this._onDidChangePrimaryStatus.event}constructor(e){super(),this._configurationService=e,this._statuses=new Map,this._statusTimeouts=new Map,this._onDidAddStatus=this._register(new b),this._onDidRemoveStatus=this._register(new b),this._onDidChangePrimaryStatus=this._register(new b)}get primary(){let e;for(const t of this._statuses.values())(!e||t.severity>=e.severity)&&(e=t);return e}get statuses(){return Array.from(this._statuses.values())}add(e,t){e=this._applyAnimationSetting(e);const i=this._statusTimeouts.get(e.id);if(i&&(window.clearTimeout(i),this._statusTimeouts.delete(e.id)),t&&t>0){const s=window.setTimeout(()=>this.remove(e),t);this._statusTimeouts.set(e.id,s)}const n=this._statuses.get(e.id);if(n&&n!==e&&(this._onDidRemoveStatus.fire(n),this._statuses.delete(n.id)),!this._statuses.has(e.id)){const s=this.primary;this._statuses.set(e.id,e),this._onDidAddStatus.fire(e);const o=this.primary;s!==o&&this._onDidChangePrimaryStatus.fire(o)}}remove(e){var i;const t=typeof e=="string"?this._statuses.get(e):e;if(t&&this._statuses.get(t.id)){const n=((i=this.primary)==null?void 0:i.id)===t.id;this._statuses.delete(t.id),this._onDidRemoveStatus.fire(t),n&&this._onDidChangePrimaryStatus.fire(this.primary)}}toggle(e,t){t?this.add(e):this.remove(e)}_applyAnimationSetting(e){if(!e.icon||E.getModifier(e.icon)!=="spin"||this._configurationService.getValue("terminal.integrated.tabs.enableAnimation"))return e;let t;return e.icon.id===gh.id?t=k.play:t=E.modify(e.icon,void 0),{...e,icon:t}}};ar=w([d(0,X)],ar);function Qa(r){switch(r){case Oe.Error:return fh;case Oe.Warning:return ph;default:return""}}class lu{constructor(){this._attached=new Map}attachToElement(e){this._container||(this._container=document.createElement("div"),this._container.classList.add("terminal-widget-container"),e.appendChild(this._container))}dispose(){this._container&&this._container.parentElement&&(this._container.parentElement.removeChild(this._container),this._container=void 0)}attachWidget(e){var t;if(this._container)return(t=this._attached.get(e.id))==null||t.dispose(),e.attach(this._container),this._attached.set(e.id,e),{dispose:()=>{this._attached.get(e.id)===e&&(this._attached.delete(e.id),e.dispose())}}}}class hu extends H{constructor(e){super(),this._initializationPromise=e,this._isOsSet=!1,this._onLineData=this._register(new b),this.onLineData=this._onLineData.event}async activate(e){this._xterm=e,await this._initializationPromise,this._register(e.onLineFeed(()=>{const t=e.buffer,i=t.active.getLine(t.active.baseY+t.active.cursorY);i&&!i.isWrapped&&this._sendLineData(t.active,t.active.baseY+t.active.cursorY-1)})),this._register(Ce(()=>{const t=e.buffer;this._sendLineData(t.active,t.active.baseY+t.active.cursorY)}))}setOperatingSystem(e){if(!(this._isOsSet||!this._xterm)&&(this._isOsSet=!0,e===1)){const t=this._xterm;this._register(t.parser.registerCsiHandler({final:"H"},()=>{const i=t.buffer;return this._sendLineData(i.active,i.active.baseY+i.active.cursorY),!1}))}}_sendLineData(e,t){let i=e.getLine(t);if(!i)return;let n=i.translateToString(!0);for(;t>0&&i.isWrapped&&(i=e.getLine(--t),!!i);)n=i.translateToString(!1)+n;this._onLineData.fire(n)}}let Zi;const du=["bash","zsh","pwsh","pwsh"];let Pe=class Ue extends H{get domElement(){return this._wrapperElement}get usedShellIntegrationInjection(){return this._usedShellIntegrationInjection}get extEnvironmentVariableCollection(){return this._processManager.extEnvironmentVariableCollection}get waitOnExit(){var e;return((e=this._shellLaunchConfig.attachPersistentProcess)==null?void 0:e.waitOnExit)||this._shellLaunchConfig.waitOnExit}set waitOnExit(e){this._shellLaunchConfig.waitOnExit=e}get target(){return this._target}set target(e){this._target=e}get instanceId(){return this._instanceId}get resource(){return this._resource}get cols(){return this._fixedCols!==void 0?this._fixedCols:this._dimensionsOverride&&this._dimensionsOverride.cols?this._dimensionsOverride.forceExactSize?this._dimensionsOverride.cols:Math.min(Math.max(this._dimensionsOverride.cols,2),this._cols):this._cols}get rows(){return this._fixedRows!==void 0?this._fixedRows:this._dimensionsOverride&&this._dimensionsOverride.rows?this._dimensionsOverride.forceExactSize?this._dimensionsOverride.rows:Math.min(Math.max(this._dimensionsOverride.rows,2),this._rows):this._rows}get isDisposed(){return this._isDisposed}get fixedCols(){return this._fixedCols}get fixedRows(){return this._fixedRows}get maxCols(){return this._cols}get maxRows(){return this._rows}get processId(){return this._processManager.shellProcessId}get processReady(){return this._processManager.ptyProcessReady}get hasChildProcesses(){var e;return((e=this.shellLaunchConfig.attachPersistentProcess)==null?void 0:e.hasChildProcesses)||this._processManager.hasChildProcesses}get reconnectionProperties(){var e;return((e=this.shellLaunchConfig.attachPersistentProcess)==null?void 0:e.reconnectionProperties)||this.shellLaunchConfig.reconnectionProperties}get areLinksReady(){return this._areLinksReady}get initialDataEvents(){return this._initialDataEvents}get exitCode(){return this._exitCode}get exitReason(){return this._exitReason}get hadFocusOnExit(){return this._hadFocusOnExit}get isTitleSetByProcess(){return!!this._messageTitleDisposable}get shellLaunchConfig(){return this._shellLaunchConfig}get shellType(){return this._shellType}get os(){return this._processManager.os}get isRemote(){return this._processManager.remoteAuthority!==void 0}get remoteAuthority(){return this._processManager.remoteAuthority}get hasFocus(){return this._wrapperElement.contains(document.activeElement)??!1}get title(){return this._title}get titleSource(){return this._titleSource}get icon(){return this._getIcon()}get color(){return this._getColor()}get processName(){return this._processName}get sequence(){return this._sequence}get staticTitle(){return this._staticTitle}get workspaceFolder(){return this._workspaceFolder}get cwd(){return this._cwd}get initialCwd(){return this._initialCwd}get description(){var t;if(this._description)return this._description;const e=((t=this.shellLaunchConfig.attachPersistentProcess)==null?void 0:t.type)||this.shellLaunchConfig.type;if(e)return e==="Task"?c("terminalTypeTask","Task"):c("terminalTypeLocal","Local")}get userHome(){return this._userHome}get shellIntegrationNonce(){return this._processManager.shellIntegrationNonce}get injectedArgs(){return this._injectedArgs}constructor(e,t,i,n,s,o,a,l,h,m,p,v,f,_,S,y,M,D,R,N,C,W,z,G,ze,nt,Zn,ci,Y,We,st,es){var no,so,ro,oo,ao,co,lo,ho;if(super(),this._terminalShellTypeContextKey=e,this._terminalInRunCommandPicker=t,this._terminalSuggestWidgetVisibleContextKey=i,this._configHelper=n,this._shellLaunchConfig=s,this._contextKeyService=o,this._terminalProfileResolverService=l,this._pathService=h,this._keybindingService=m,this._notificationService=p,this._preferencesService=v,this._viewsService=f,this._clipboardService=_,this._themeService=S,this._configurationService=y,this._logService=M,this._dialogService=D,this._storageService=R,this._accessibilityService=N,this._productService=C,this._quickInputService=W,this._workspaceContextService=G,this._editorService=ze,this._workspaceTrustRequestService=nt,this._historyService=Zn,this._telemetryService=ci,this._openerService=Y,this._commandService=We,this._audioCueService=st,this._viewDescriptorService=es,this._contributions=new Map,this._latestXtermWriteData=0,this._latestXtermParseData=0,this._title="",this._titleSource=Ie.Process,this._cols=0,this._rows=0,this._cwd=void 0,this._initialCwd=void 0,this._injectedArgs=void 0,this._layoutSettingsChanged=!0,this._areLinksReady=!1,this._initialDataEvents=[],this._widgetManager=new lu,this._processName="",this._usedShellIntegrationInjection=!1,this.capabilities=new Md,this.disableLayout=!1,this._onExit=new b,this.onExit=this._onExit.event,this._onDisposed=this._register(new b),this.onDisposed=this._onDisposed.event,this._onProcessIdReady=this._register(new b),this.onProcessIdReady=this._onProcessIdReady.event,this._onProcessReplayComplete=this._register(new b),this.onProcessReplayComplete=this._onProcessReplayComplete.event,this._onTitleChanged=this._register(new b),this.onTitleChanged=this._onTitleChanged.event,this._onIconChanged=this._register(new b),this.onIconChanged=this._onIconChanged.event,this._onData=this._register(new b),this.onData=this._onData.event,this._onBinary=this._register(new b),this.onBinary=this._onBinary.event,this._onLineData=this._register(new b({onDidAddFirstListener:()=>this._onLineDataSetup()})),this.onLineData=this._onLineData.event,this._onRequestExtHostProcess=this._register(new b),this.onRequestExtHostProcess=this._onRequestExtHostProcess.event,this._onDimensionsChanged=this._register(new b),this.onDimensionsChanged=this._onDimensionsChanged.event,this._onMaximumDimensionsChanged=this._register(new b),this.onMaximumDimensionsChanged=this._onMaximumDimensionsChanged.event,this._onDidFocus=this._register(new b),this.onDidFocus=this._onDidFocus.event,this._onDidRequestFocus=this._register(new b),this.onDidRequestFocus=this._onDidRequestFocus.event,this._onDidBlur=this._register(new b),this.onDidBlur=this._onDidBlur.event,this._onDidInputData=this._register(new b),this.onDidInputData=this._onDidInputData.event,this._onRequestAddInstanceToGroup=this._register(new b),this.onRequestAddInstanceToGroup=this._onRequestAddInstanceToGroup.event,this._onDidChangeHasChildProcesses=this._register(new b),this.onDidChangeHasChildProcesses=this._onDidChangeHasChildProcesses.event,this._wrapperElement=document.createElement("div"),this._wrapperElement.classList.add("terminal-wrapper"),this._skipTerminalCommands=[],this._isExiting=!1,this._hadFocusOnExit=!1,this._isVisible=!1,this._isDisposed=!1,this._instanceId=Ue._instanceIdCounter++,this._hasHadInput=!1,this._fixedRows=(so=(no=s.attachPersistentProcess)==null?void 0:no.fixedDimensions)==null?void 0:so.rows,this._fixedCols=(oo=(ro=s.attachPersistentProcess)==null?void 0:ro.fixedDimensions)==null?void 0:oo.cols,this._resource=Ka(this._workspaceContextService.getWorkspace().id,this.instanceId,this.title),(ao=this._shellLaunchConfig.attachPersistentProcess)!=null&&ao.hideFromUser&&(this._shellLaunchConfig.hideFromUser=this._shellLaunchConfig.attachPersistentProcess.hideFromUser),(co=this._shellLaunchConfig.attachPersistentProcess)!=null&&co.isFeatureTerminal&&(this._shellLaunchConfig.isFeatureTerminal=this._shellLaunchConfig.attachPersistentProcess.isFeatureTerminal),(lo=this._shellLaunchConfig.attachPersistentProcess)!=null&&lo.type&&(this._shellLaunchConfig.type=this._shellLaunchConfig.attachPersistentProcess.type),this.shellLaunchConfig.cwd){const F=typeof this._shellLaunchConfig.cwd=="string"?L.from({scheme:$.file,path:this._shellLaunchConfig.cwd}):this._shellLaunchConfig.cwd;F&&(this._workspaceFolder=Qe(this._workspaceContextService.getWorkspaceFolder(F)))}if(!this._workspaceFolder){const F=this._historyService.getLastActiveWorkspaceRoot();this._workspaceFolder=F?Qe(this._workspaceContextService.getWorkspaceFolder(F)):void 0}const ge=this._register(o.createScoped(this._wrapperElement));this._scopedInstantiationService=a.createChild(new vh([me,ge])),this._terminalFocusContextKey=u.focus.bindTo(ge),this._terminalHasFixedWidth=u.terminalHasFixedWidth.bindTo(ge),this._terminalHasTextContextKey=u.textSelected.bindTo(ge),this._terminalAltBufferActiveContextKey=u.altBufferActive.bindTo(ge),this._terminalShellIntegrationEnabledContextKey=u.terminalShellIntegrationEnabled.bindTo(ge),this._logService.trace(`terminalInstance#ctor (instanceId: ${this.instanceId})`,this._shellLaunchConfig),this._register(this.capabilities.onDidAddCapability(F=>{var oe;if(this._logService.debug("terminalInstance added capability",F),F===0)(oe=this.capabilities.get(0))==null||oe.onDidChangeCwd(ae=>{var ye;this._cwd=ae,this._setTitle(this.title,Ie.Config),(ye=this._scopedInstantiationService.invokeFunction(As))==null||ye.add(ae,{remoteAuthority:this.remoteAuthority})});else if(F===2){const ae=this.capabilities.get(2);ae==null||ae.onCommandFinished(ye=>{var Re;ye.command.trim().length>0&&((Re=this._scopedInstantiationService.invokeFunction(wn))==null||Re.add(ye.command,{shellType:this._shellType}))})}})),this._register(this.capabilities.onDidRemoveCapability(F=>this._logService.debug("terminalInstance removed capability",F))),!this.shellLaunchConfig.executable&&!z.remoteAuthority&&this._terminalProfileResolverService.resolveIcon(this._shellLaunchConfig,Ye),this._icon=((ho=s.attachPersistentProcess)==null?void 0:ho.icon)||s.icon,this.shellLaunchConfig.customPtyImplementation&&this._setTitle(this._shellLaunchConfig.name,Ie.Api),this.statusList=this._scopedInstantiationService.createInstance(ar),this._initDimensions(),this._processManager=this._createProcessManager(),this._register(Ce(()=>{var F;return(F=this._dndObserver)==null?void 0:F.dispose()})),this._containerReadyBarrier=new ks(100),this._attachBarrier=new ks(1e3),this._xtermReadyPromise=this._createXterm(),this._xtermReadyPromise.then(async()=>{var F,oe,ae;if(await this._containerReadyBarrier.wait(),!this.shellLaunchConfig.customPtyImplementation&&((F=this._configHelper.config.shellIntegration)!=null&&F.enabled)&&!this.shellLaunchConfig.executable){const ye=await this._processManager.getBackendOS(),Re=await this._terminalProfileResolverService.getDefaultProfile({remoteAuthority:this.remoteAuthority,os:ye});this.shellLaunchConfig.executable=Re.path,this.shellLaunchConfig.args=Re.args,this.shellLaunchConfig.isExtensionOwnedTerminal?((oe=this.shellLaunchConfig).icon??(oe.icon=Re.icon),(ae=this.shellLaunchConfig).color??(ae.color=Re.color)):(this.shellLaunchConfig.icon=Re.icon,this.shellLaunchConfig.color=Re.color)}await this._createProcess(),this.shellLaunchConfig.attachPersistentProcess&&(this._cwd=this.shellLaunchConfig.attachPersistentProcess.cwd,this._setTitle(this.shellLaunchConfig.attachPersistentProcess.title,this.shellLaunchConfig.attachPersistentProcess.titleSource),this.setShellType(this.shellType)),this._fixedCols&&await this._addScrollbar()}).catch(F=>{if(!this._isDisposed)throw F}),this._register(this._configurationService.onDidChangeConfiguration(async F=>{var ae,ye;F.affectsConfiguration("accessibility.verbosity.terminal")&&this._setAriaLabel((ae=this.xterm)==null?void 0:ae.raw,this._instanceId,this.title),F.affectsConfiguration("terminal.integrated")&&(this.updateConfig(),this.setVisible(this._isVisible)),["terminal.integrated.fontSize","terminal.integrated.fontFamily","terminal.integrated.fontWeight","terminal.integrated.fontWeightBold","terminal.integrated.letterSpacing","terminal.integrated.lineHeight","editor.fontFamily"].some(Re=>F.affectsConfiguration(Re))&&(this._layoutSettingsChanged=!0,await this._resize()),F.affectsConfiguration("terminal.integrated.unicodeVersion")&&this._updateUnicodeVersion(),F.affectsConfiguration("editor.accessibilitySupport")&&this.updateAccessibilitySupport(),(F.affectsConfiguration("terminal.integrated.tabs.title")||F.affectsConfiguration("terminal.integrated.tabs.separator")||F.affectsConfiguration("terminal.integrated.tabs.description"))&&((ye=this._labelComputer)==null||ye.refreshLabel())})),this._register(this._workspaceContextService.onDidChangeWorkspaceFolders(()=>{var F;return(F=this._labelComputer)==null?void 0:F.refreshLabel()})),this._register(this.onDidBlur(()=>{var F,oe;return(oe=(F=this.xterm)==null?void 0:F.suggestController)==null?void 0:oe.hideSuggestWidget()}));let ts=window.setTimeout(()=>{ts=void 0,this._initialDataEvents=void 0},1e4);this._register(Ce(()=>{ts&&window.clearTimeout(ts)}));const cc=nr.getTerminalContributions();for(const F of cc){if(this._contributions.has(F.id)){bo(new Error(`Cannot have two terminal contributions with the same id ${F.id}`));continue}let oe;try{oe=this._scopedInstantiationService.createInstance(F.ctor,this,this._processManager,this._widgetManager),this._contributions.set(F.id,oe)}catch(ae){bo(ae)}this._xtermReadyPromise.then(ae=>{var ye;(ye=oe.xtermReady)==null||ye.call(oe,ae)}),this.onDisposed(()=>{oe.dispose()})}}getContribution(e){return this._contributions.get(e)}_getIcon(){return this._icon||(this._icon=this._processManager.processState>=2?Jn().getIcon(this._configurationService.getValue("terminal.integrated.tabs.defaultIcon")):void 0),this._icon}_getColor(){var e,t;if(this.shellLaunchConfig.color)return this.shellLaunchConfig.color;if((t=(e=this.shellLaunchConfig)==null?void 0:e.attachPersistentProcess)!=null&&t.color)return this.shellLaunchConfig.attachPersistentProcess.color;this._processManager.processState>=2}_initDimensions(){if(!this._container){this._cols=80,this._rows=30;return}const e=window.getComputedStyle(this._container),t=parseInt(e.width),i=parseInt(e.height);this._evaluateColsAndRows(t,i)}_evaluateColsAndRows(e,t){if(!e||!t)return this._setLastKnownColsAndRows(),null;const i=this._getDimension(e,t);if(!i)return this._setLastKnownColsAndRows(),null;const n=this.xterm?this.xterm.getFont():this._configHelper.getFont(),s=Xd(n,i.width,i.height);return s?((this._cols!==s.cols||this._rows!==s.rows)&&(this._cols=s.cols,this._rows=s.rows,this._fireMaximumDimensionsChanged()),i.width):(this._setLastKnownColsAndRows(),null)}_setLastKnownColsAndRows(){Ue._lastKnownGridDimensions&&(this._cols=Ue._lastKnownGridDimensions.cols,this._rows=Ue._lastKnownGridDimensions.rows)}_fireMaximumDimensionsChanged(){this._onMaximumDimensionsChanged.fire()}_getDimension(e,t){var a;const i=this.xterm?this.xterm.getFont():this._configHelper.getFont();if(!i||!i.charWidth||!i.charHeight||!((a=this.xterm)!=null&&a.raw.element))return;const n=window.getComputedStyle(this.xterm.raw.element),s=parseInt(n.paddingLeft)+parseInt(n.paddingRight),o=parseInt(n.paddingTop)+parseInt(n.paddingBottom);return Ue._lastKnownCanvasDimensions=new ht(Math.min(8e3,e-s),t+(this._hasScrollBar&&!this._horizontalScrollbar?-5:0)-2-o),Ue._lastKnownCanvasDimensions}get persistentProcessId(){return this._processManager.persistentProcessId}get shouldPersist(){return this._processManager.shouldPersist&&!this.shellLaunchConfig.isTransient&&(!this.reconnectionProperties||this._configurationService.getValue("task.reconnection")===!0)}static getXtermConstructor(e,t){const i=e.lookupKeybinding("workbench.action.terminal.focusAccessibleBuffer",t);return Zi||(Zi=bh.withAsyncBody(async n=>{const s=(await yt(()=>import("./xterm-83482a70.js").then(o=>o.x),["assets/xterm-83482a70.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"]).then(o=>o.default??o)).Terminal;s.strings.promptLabel=c("terminal.integrated.a11yPromptLabel","Terminal input"),s.strings.tooMuchOutput=i?c("terminal.integrated.useAccessibleBuffer","Use the accessible buffer {0} to manually review output",i.getLabel()):c("terminal.integrated.useAccessibleBufferNoKb","Use the Terminal: Focus Accessible Buffer command to manually review output"),n(s)}),Zi)}async _createXterm(){const e=await Ue.getXtermConstructor(this._keybindingService,this._contextKeyService);if(this._isDisposed)throw new Ts("Terminal disposed of during xterm.js creation");const t=this.shellLaunchConfig.hideFromUser||this.shellLaunchConfig.executable===void 0||this.shellType===void 0||!du.includes(this.shellType),i=this._scopedInstantiationService.createInstance(Ei,e,this._configHelper,this._cols,this._rows,{getBackgroundColor:o=>{const a=o.getColor(ta);return a||(this.target===A.Editor?o.getColor(wh):this._viewDescriptorService.getViewLocationById(K)===1?o.getColor(ia):o.getColor(Wc))}},this.capabilities,this._processManager.shellIntegrationNonce,this._terminalSuggestWidgetVisibleContextKey,t);this.xterm=i,this.updateAccessibilitySupport(),this.xterm.onDidRequestRunCommand(o=>{o.copyAsHtml?this.copySelection(!0,o.command):this.sendText(o.command.command,!o.noNewLine)}),this.xterm.onDidRequestFocus(()=>this.focus()),this.xterm.onDidRequestSendText(o=>this.sendText(o,!1));const n=this._shellLaunchConfig.initialText?new Promise(o=>this._writeInitialText(i,o)):void 0,s=new hu(n);if(s.onLineData(o=>this._onLineData.fire(o)),this._lineDataEventAddon=s,setTimeout(()=>{i.raw.onBell(()=>{this._configHelper.config.enableBell&&(this.statusList.add({id:"bell",severity:ne.Warning,icon:k.bell,tooltip:c("bellStatus","Bell")},this._configHelper.config.bellDuration),this._audioCueService.playSound(Xr.terminalBell.sound))})},1e3),i.raw.onSelectionChange(async()=>this._onSelectionChange()),i.raw.buffer.onBufferChange(()=>this._refreshAltBufferContextKey()),this._processManager.onProcessData(o=>this._onProcessData(o)),i.raw.onData(async o=>{await this._processManager.write(o),this._onDidInputData.fire(this)}),i.raw.onBinary(o=>this._processManager.processBinary(o)),this._processManager.onProcessReady(async o=>{this._processManager.os&&s.setOperatingSystem(this._processManager.os),i.raw.options.windowsPty=o.windowsPty}),this._processManager.onRestoreCommands(o=>{var a;return(a=this.xterm)==null?void 0:a.shellIntegration.deserialize(o)}),this._register(this._viewDescriptorService.onDidChangeLocation(({views:o})=>{o.some(a=>a.id===K)&&i.refresh()})),!this.capabilities.has(0)){let o=i.raw.onKey(a=>{new wo(a.domEvent).equals(3)&&this._updateProcessCwd()});this._register(this.capabilities.onDidAddCapability(a=>{a===0&&(o==null||o.dispose(),o=void 0)}))}return this._pathService.userHome().then(o=>{this._userHome=o.fsPath}),this._isVisible&&this._open(),i}async _onLineDataSetup(){(this.xterm||await this._xtermReadyPromise).raw.loadAddon(this._lineDataEventAddon)}async runCommand(e,t){var i;((i=this.capabilities.get(2))==null?void 0:i.hasInput)!==!1&&(await this.sendText("",!1),await Pt(100)),await this.sendText(e,t,!t)}async runRecent(e,t,i){return this._scopedInstantiationService.invokeFunction(dn,this,this._terminalInRunCommandPicker,e,t,i)}detachFromElement(){this._wrapperElement.remove(),this._container=void 0}attachToElement(e){var t;this._container!==e&&(this._attachBarrier.open(),this._container=e,this._container.appendChild(this._wrapperElement),(t=this.xterm)==null||t.refresh(),setTimeout(()=>this._initDragAndDrop(e)))}_open(){if(!this.xterm||this.xterm.raw.element)return;if(!this._container||!this._container.isConnected)throw new Error("A container element needs to be set with `attachToElement` and be part of the DOM before calling `_open`");const e=document.createElement("div");this._wrapperElement.appendChild(e),this._container.appendChild(this._wrapperElement);const t=this.xterm;this._wrapperElement.xterm=t.raw;const i=t.attachToElement(e);if(this._register(t.shellIntegration.onDidChangeStatus(()=>{this.hasFocus?this._setShellIntegrationContextKey():this._terminalShellIntegrationEnabledContextKey.reset()})),!t.raw.element||!t.raw.textarea)throw new Error("xterm elements not set after open");this._setAriaLabel(t.raw,this._instanceId,this._title),t.raw.attachCustomKeyEventHandler(n=>{if(this._isExiting)return!1;const s=new wo(n),o=this._keybindingService.softDispatch(s,s.target),a=o.kind===1&&this._configHelper.config.allowChords&&n.key!=="Escape";if(this._keybindingService.inChordMode||a)return n.preventDefault(),!1;const l="terminal.integrated.showTerminalConfigPrompt",h=["RightArrow","LeftArrow","UpArrow","DownArrow","Space","Meta","Control","Shift","Alt","","Delete","Backspace","Tab"];return this._storageService.getBoolean(l,-1,!0)&&!h.includes(n.key)&&!n.ctrlKey&&!n.shiftKey&&!n.altKey&&(this._hasHadInput=!0),o.kind===2&&o.commandId&&this._skipTerminalCommands.some(m=>m===o.commandId)&&!this._configHelper.config.sendKeybindingsToShell?(this._storageService.getBoolean(l,-1,!0)&&this._hasHadInput&&!Nc.includes(o.commandId)&&(this._notificationService.prompt(ne.Info,c("keybindingHandling","Some keybindings don't go to the terminal by default and are handled by {0} instead.",this._productService.nameLong),[{label:c("configureTerminalSettings","Configure Terminal Settings"),run:()=>{this._preferencesService.openSettings({jsonEditor:!1,query:"@id:terminal.integrated.commandsToSkipShell,terminal.integrated.sendKeybindingsToShell,terminal.integrated.allowChords"})}}]),this._storageService.store(l,!1,-1,0)),n.preventDefault(),!1):!(this._configHelper.config.allowMnemonics&&!Ee&&n.altKey||Sh.getTabFocusMode("terminalFocus")&&n.key==="Tab"||re&&n.altKey&&n.key==="F4"&&!n.ctrlKey||!Ut.clipboard.readText&&n.key==="v"&&n.ctrlKey)}),this._register(O(t.raw.element,"mousedown",()=>{const n=O(document,"mouseup",()=>{setTimeout(()=>this._refreshSelectionContextKey(),0),n.dispose()})})),this._register(O(t.raw.element,"touchstart",()=>{t.raw.focus()})),this._register(O(t.raw.element,"keyup",()=>{setTimeout(()=>this._refreshSelectionContextKey(),0)})),this._register(O(t.raw.textarea,"focus",()=>this._setFocus(!0))),this._register(O(t.raw.textarea,"blur",()=>this._setFocus(!1))),this._register(O(t.raw.textarea,"focusout",()=>this._setFocus(!1))),this._initDragAndDrop(this._container),this._widgetManager.attachToElement(i),this._lastLayoutDimensions&&this.layout(this._lastLayoutDimensions),this.updateConfig(),t.raw.options.disableStdin&&this._attachPressAnyKeyToCloseListener(t.raw)}_setFocus(e){e?(this._terminalFocusContextKey.set(!0),this._setShellIntegrationContextKey(),this._onDidFocus.fire(this)):(this.resetFocusContextKey(),this._onDidBlur.fire(this),this._refreshSelectionContextKey())}_setShellIntegrationContextKey(){this.xterm&&this._terminalShellIntegrationEnabledContextKey.set(this.xterm.shellIntegration.status===2)}resetFocusContextKey(){this._terminalFocusContextKey.reset(),this._terminalShellIntegrationEnabledContextKey.reset()}_initDragAndDrop(e){var i;(i=this._dndObserver)==null||i.dispose();const t=this._scopedInstantiationService.createInstance(cr,e);t.onDropTerminal(n=>this._onRequestAddInstanceToGroup.fire(n)),t.onDropFile(async n=>{this.focus(),await this.sendPath(n,!1)}),this._dndObserver=new Ch(e,t)}hasSelection(){return this.xterm?this.xterm.raw.hasSelection():!1}async copySelection(e,t){await(await this._xtermReadyPromise).copySelection(e,t)}get selection(){return this.xterm&&this.hasSelection()?this.xterm.raw.getSelection():void 0}clearSelection(){var e;(e=this.xterm)==null||e.raw.clearSelection()}_refreshAltBufferContextKey(){this._terminalAltBufferActiveContextKey.set(!!(this.xterm&&this.xterm.raw.buffer.active===this.xterm.raw.buffer.alternate))}async _shouldPasteText(e){var l;if((l=this.xterm)!=null&&l.raw.modes.bracketedPasteMode)return!0;const t=e.split(/\r?\n/);if(t.length===2&&t[1].trim().length===0||t.length===1||!this._configurationService.getValue("terminal.integrated.enableMultiLinePasteWarning"))return!0;const i=3,n=30;let s=c("preview","Preview:");for(let h=0;h<Math.min(t.length,i);h++){const m=t[h],p=m.length>n?`${m.slice(0,n)}…`:m;s+=`
${p}`}t.length>i&&(s+=`
…`);const{confirmed:o,checkboxChecked:a}=await this._dialogService.confirm({message:c("confirmMoveTrashMessageFilesAndDirectories","Are you sure you want to paste {0} lines of text into the terminal?",t.length),detail:s,primaryButton:c({key:"multiLinePasteButton",comment:["&& denotes a mnemonic"]},"&&Paste"),checkbox:{label:c("doNotAskAgain","Do not ask me again")}});return o&&a&&await this._configurationService.updateValue("terminal.integrated.enableMultiLinePasteWarning",!1),o}dispose(e){var t,i;if(!this._isDisposed){this._isDisposed=!0,this._logService.trace(`terminalInstance#dispose (instanceId: ${this.instanceId})`),ee(this._widgetManager),(t=this.xterm)!=null&&t.raw.element&&(this._hadFocusOnExit=this.hasFocus),this._wrapperElement.xterm&&(this._wrapperElement.xterm=void 0),this._horizontalScrollbar&&(this._horizontalScrollbar.dispose(),this._horizontalScrollbar=void 0);try{(i=this.xterm)==null||i.dispose()}catch(n){this._logService.error("Exception occurred during xterm disposal",n)}yh&&(this.resetFocusContextKey(),this._terminalHasTextContextKey.reset(),this._onDidBlur.fire(this)),this._pressAnyKeyToCloseListener&&(this._pressAnyKeyToCloseListener.dispose(),this._pressAnyKeyToCloseListener=void 0),this._exitReason===void 0&&(this._exitReason=e??je.Unknown),this._processManager.dispose(),this._onProcessExit(void 0),this._onDisposed.fire(this),super.dispose()}}async detachProcessAndDispose(e){await this._processManager.detachFromProcess(e===je.User),this.dispose(e)}focus(e){var t;this._refreshAltBufferContextKey(),this.xterm&&(e||!((t=window.getSelection())!=null&&t.toString()))&&(this.xterm.raw.focus(),this._onDidRequestFocus.fire())}async focusWhenReady(e){await this._xtermReadyPromise,await this._attachBarrier.wait(),this.focus(e)}async paste(){if(!this.xterm)return;const e=await this._clipboardService.readText();await this._shouldPasteText(e)&&(this.focus(),this.xterm.raw.paste(e))}async pasteSelection(){if(!this.xterm)return;const e=await this._clipboardService.readText("selection");await this._shouldPasteText(e)&&(this.focus(),this.xterm.raw.paste(e))}async sendText(e,t,i){var n,s,o,a;i&&((n=this.xterm)!=null&&n.raw.modes.bracketedPasteMode)&&(e=`\x1B[200~${e}\x1B[201~`),e=e.replace(/\r?\n/g,"\r"),t&&!e.endsWith("\r")&&(e+="\r"),await this._processManager.write(e),this._onDidInputData.fire(this),(o=(s=this.xterm)==null?void 0:s.suggestController)==null||o.handleNonXtermData(e),(a=this.xterm)==null||a.scrollToBottom()}async sendPath(e,t){return this.sendText(await this.preparePathForShell(e),t)}async preparePathForShell(e){return await this.processReady,au(e,this.shellLaunchConfig.executable,this.title,this.shellType,this._processManager.backend,this._processManager.os)}setVisible(e){this._isVisible=e,this._wrapperElement.classList.toggle("active",e),e&&this.xterm&&(this._open(),this._resize(),setTimeout(()=>this.xterm.forceRefresh(),0))}scrollDownLine(){var e;(e=this.xterm)==null||e.scrollDownLine()}scrollDownPage(){var e;(e=this.xterm)==null||e.scrollDownPage()}scrollToBottom(){var e;(e=this.xterm)==null||e.scrollToBottom()}scrollUpLine(){var e;(e=this.xterm)==null||e.scrollUpLine()}scrollUpPage(){var e;(e=this.xterm)==null||e.scrollUpPage()}scrollToTop(){var e;(e=this.xterm)==null||e.scrollToTop()}clearBuffer(){var e;this._processManager.clearBuffer(),(e=this.xterm)==null||e.clearBuffer()}_refreshSelectionContextKey(){const e=!!this._viewsService.getActiveViewWithId(K);let t=!1;const i=this._editorService.activeEditor;i&&(t=i instanceof Ae),this._terminalHasTextContextKey.set((e||t)&&this.hasSelection())}_createProcessManager(){var i,n,s;let e;(i=this.shellLaunchConfig.attachPersistentProcess)!=null&&i.environmentVariableCollections&&(e=Bc(this.shellLaunchConfig.attachPersistentProcess.environmentVariableCollections));const t=this._scopedInstantiationService.createInstance(rr,this._instanceId,this._configHelper,(n=this.shellLaunchConfig)==null?void 0:n.cwd,e,(s=this.shellLaunchConfig.attachPersistentProcess)==null?void 0:s.shellIntegrationNonce);return this.capabilities.add(t.capabilities),t.onProcessReady(async o=>{this._onProcessIdReady.fire(this),this._initialCwd=await this.getInitialCwd(),this._labelComputer||(this._labelComputer=this._register(this._scopedInstantiationService.createInstance(lr,this._configHelper,this)),this._labelComputer.onDidChangeLabel(a=>{this._title=a.title,this._description=a.description,this._onTitleChanged.fire(this)})),this._shellLaunchConfig.name?this._setTitle(this._shellLaunchConfig.name,Ie.Api):(setTimeout(()=>{this._xtermReadyPromise.then(a=>{this._messageTitleDisposable=a.raw.onTitleChange(l=>this._onTitleChange(l))})}),this._setTitle(this._shellLaunchConfig.executable,Ie.Process))}),t.onProcessExit(o=>this._onProcessExit(o)),t.onDidChangeProperty(({type:o,value:a})=>{var l,h;switch(o){case"cwd":this._cwd=a,(l=this._labelComputer)==null||l.refreshLabel();break;case"initialCwd":this._initialCwd=a,this._cwd=this._initialCwd,this._setTitle(this.title,Ie.Config),this._icon=((h=this._shellLaunchConfig.attachPersistentProcess)==null?void 0:h.icon)||this._shellLaunchConfig.icon,this._onIconChanged.fire({instance:this,userInitiated:!1});break;case"title":this._setTitle(a??"",Ie.Process);break;case"overrideDimensions":this.setOverrideDimensions(a,!0);break;case"resolvedShellLaunchConfig":this._setResolvedShellLaunchConfig(a);break;case"shellType":this.setShellType(a);break;case"hasChildProcesses":this._onDidChangeHasChildProcesses.fire(a);break;case"usedShellIntegrationInjection":this._usedShellIntegrationInjection=!0;break}}),t.onProcessData(o=>{var a;(a=this._initialDataEvents)==null||a.push(o.data),this._onData.fire(o.data)}),t.onProcessReplayComplete(()=>this._onProcessReplayComplete.fire()),t.onEnvironmentVariableInfoChanged(o=>this._onEnvironmentVariableInfoChanged(o)),t.onPtyDisconnect(()=>{this.xterm&&(this.xterm.raw.options.disableStdin=!0),this.statusList.add({id:"disconnected",severity:ne.Error,icon:k.debugDisconnect,tooltip:c("disconnectStatus","Lost connection to process")})}),t.onPtyReconnect(()=>{this.xterm&&(this.xterm.raw.options.disableStdin=!1),this.statusList.remove("disconnected")}),t}async _createProcess(){var i,n,s;if(this._isDisposed)return;this._historyService.getLastActiveWorkspaceRoot($.file)?await this._trust()||this._onProcessExit({message:c("workspaceNotTrustedCreateTerminal","Cannot launch a terminal process in an untrusted workspace")}):this._cwd&&this._userHome&&this._cwd!==this._userHome&&this._onProcessExit({message:c("workspaceNotTrustedCreateTerminalCwd","Cannot launch a terminal process in an untrusted workspace with cwd {0} and userHome {1}",this._cwd,this._userHome)}),this._container&&this._cols===0&&this._rows===0&&(this._initDimensions(),(i=this.xterm)==null||i.raw.resize(this._cols||80,this._rows||30));const t=this.shellLaunchConfig.icon;await this._processManager.createProcess(this._shellLaunchConfig,this._cols||80,this._rows||30).then(o=>{o&&("message"in o?this._onProcessExit(o):"injectedArgs"in o&&(this._injectedArgs=o.injectedArgs))}),(n=this.xterm)!=null&&n.shellIntegration&&this.capabilities.add(this.xterm.shellIntegration.capabilities),(t!==this.shellLaunchConfig.icon||this.shellLaunchConfig.color)&&(this._icon=((s=this._shellLaunchConfig.attachPersistentProcess)==null?void 0:s.icon)||this._shellLaunchConfig.icon,this._onIconChanged.fire({instance:this,userInitiated:!1}))}registerMarker(){var e;return(e=this.xterm)==null?void 0:e.raw.registerMarker()}addBufferMarker(e){var t;(t=this.capabilities.get(4))==null||t.addMark(e)}scrollToMark(e,t,i){var n;(n=this.xterm)==null||n.markTracker.scrollToClosestMarker(e,t,i)}async freePortKillProcess(e,t){var i;await((i=this._processManager)==null?void 0:i.freePortKillProcess(e)),this.runCommand(t,!1)}_onProcessData(e){var i;const t=++this._latestXtermWriteData;e.trackCommit?e.writePromise=new Promise(n=>{var s;(s=this.xterm)==null||s.raw.write(e.data,()=>{this._latestXtermParseData=t,this._processManager.acknowledgeDataEvent(e.data.length),n()})}):(i=this.xterm)==null||i.raw.write(e.data,()=>{this._latestXtermParseData=t,this._processManager.acknowledgeDataEvent(e.data.length)})}async _onProcessExit(e){if(this._isExiting)return;const t=uu(e,this.shellLaunchConfig,this._processManager.processState,this._initialCwd);if(this._usedShellIntegrationInjection&&this._processManager.processState===4&&(t==null?void 0:t.code)!==0){this._relaunchWithShellIntegrationDisabled(t==null?void 0:t.message),this._onExit.fire(e);return}this._isExiting=!0,await this._flushXtermData(),this._exitCode=t==null?void 0:t.code;const i=t==null?void 0:t.message;this._logService.debug("Terminal process exit","instanceId",this.instanceId,"code",this._exitCode,"processState",this._processManager.processState);const n=this.waitOnExit;n&&this._processManager.processState!==5?this._xtermReadyPromise.then(s=>{switch(i&&s.raw.write(Xt(i)),typeof n){case"string":s.raw.write(Xt(n,{excludeLeadingNewLine:!0}));break;case"function":this.exitCode!==void 0&&s.raw.write(Xt(n(this.exitCode),{excludeLeadingNewLine:!0}));break}s.raw.options.disableStdin=!0,s.raw.textarea&&this._attachPressAnyKeyToCloseListener(s.raw)}):(this.dispose(je.Process),i&&(this._processManager.processState===4||this._configHelper.config.showExitAlert?this._notificationService.notify({message:i,severity:ne.Error,actions:{primary:[this._scopedInstantiationService.createInstance(Es)]}}):this._logService.warn(i))),this._onExit.fire(e),this._isDisposed&&this._onExit.dispose()}_relaunchWithShellIntegrationDisabled(e){this._shellLaunchConfig.ignoreShellIntegration=!0,this.relaunch(),this.statusList.add({id:"shell-integration-attention-needed",severity:ne.Warning,icon:k.warning,tooltip:(`${e} `??"")+c("launchFailed.exitCodeOnlyShellIntegration","Disabling shell integration in user settings might help."),hoverActions:[{commandId:"workbench.action.terminal.learnMore",label:c("shellIntegration.learnMore","Learn more about shell integration"),run:()=>{this._openerService.open("https://code.visualstudio.com/docs/editor/integrated-terminal#_shell-integration")}},{commandId:"workbench.action.openSettings",label:c("shellIntegration.openSettings","Open user settings"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings","terminal.integrated.shellIntegration.enabled")}}]}),this._telemetryService.publicLog2("terminal/shellIntegrationFailureProcessExit")}_flushXtermData(){if(this._latestXtermWriteData===this._latestXtermParseData)return Promise.resolve();let e=0;return new Promise(t=>{const i=setInterval(()=>{(this._latestXtermWriteData===this._latestXtermParseData||++e===5)&&(clearInterval(i),t())},20)})}_attachPressAnyKeyToCloseListener(e){e.textarea&&!this._pressAnyKeyToCloseListener&&(this._pressAnyKeyToCloseListener=O(e.textarea,"keypress",t=>{this._pressAnyKeyToCloseListener&&(this._pressAnyKeyToCloseListener.dispose(),this._pressAnyKeyToCloseListener=void 0,this.dispose(je.Process),t.preventDefault())}))}_writeInitialText(e,t){var n;if(!this._shellLaunchConfig.initialText){t==null||t();return}const i=typeof this._shellLaunchConfig.initialText=="string"?this._shellLaunchConfig.initialText:(n=this._shellLaunchConfig.initialText)==null?void 0:n.text;typeof this._shellLaunchConfig.initialText=="string"||this._shellLaunchConfig.initialText.trailingNewLine?e.raw.writeln(i,t):e.raw.write(i,t)}async reuseTerminal(e,t=!1){var n;(n=this._pressAnyKeyToCloseListener)==null||n.dispose(),this._pressAnyKeyToCloseListener=void 0;const i=this.xterm;i&&(t||await new Promise(s=>i.raw.write(`
\x1B[G`,s)),e.initialText&&(this._shellLaunchConfig.initialText=e.initialText,await new Promise(s=>this._writeInitialText(i,s))),this._isExiting&&this._shellLaunchConfig.waitOnExit&&(i.raw.options.disableStdin=!1,this._isExiting=!1),t&&i.clearDecorations()),this.statusList.remove("relaunch-needed"),t||(e.initialText=" "),this._shellLaunchConfig=e,await this._processManager.relaunch(this._shellLaunchConfig,this._cols||80,this._rows||30,t).then(s=>{s&&("message"in s?this._onProcessExit(s):"injectedArgs"in s&&(this._injectedArgs=s.injectedArgs))})}relaunch(){this.reuseTerminal(this._shellLaunchConfig,!0)}_onTitleChange(e){this.isTitleSetByProcess&&this._setTitle(e,Ie.Sequence)}async _trust(){return await this._workspaceTrustRequestService.requestWorkspaceTrust({message:c("terminal.requestTrust","Creating a terminal process requires executing code")})===!0}async _onSelectionChange(){this._configurationService.getValue("terminal.integrated.copyOnSelection")&&this.hasSelection()&&await this.copySelection()}async _updateProcessCwd(){if(!(this._isDisposed||this.shellLaunchConfig.customPtyImplementation))try{const e=await this._refreshProperty("cwd");if(typeof e!="string")throw new Error(`cwd is not a string ${e}`)}catch(e){if(e instanceof Error&&e.message==="Cannot refresh property when process is not set")return;throw e}}updateConfig(){this._setCommandsToSkipShell(this._configHelper.config.commandsToSkipShell),this._refreshEnvironmentVariableInfoWidgetState(this._processManager.environmentVariableInfo)}async _updateUnicodeVersion(){this._processManager.setUnicodeVersion(this._configHelper.config.unicodeVersion)}updateAccessibilitySupport(){this.xterm.raw.options.screenReaderMode=this._accessibilityService.isScreenReaderOptimized()}_setCommandsToSkipShell(e){const t=e.filter(i=>i[0]==="-").map(i=>i.slice(1));this._skipTerminalCommands=ra.filter(i=>!t.includes(i)).concat(e)}layout(e){var i;if(this._lastLayoutDimensions=e,!(this.disableLayout||e.width<=0||e.height<=0||!this._evaluateColsAndRows(e.width,e.height))){this._resize(),this._containerReadyBarrier.open();for(const n of this._contributions.values())this.xterm?(i=n.layout)==null||i.call(n,this.xterm,e):this._xtermReadyPromise.then(s=>{var o;return(o=n.layout)==null?void 0:o.call(n,s,e)})}}async _resize(){this._resizeNow(!1)}async _resizeNow(e){let t=this.cols,i=this.rows;if(this.xterm){if(this._isVisible&&this._layoutSettingsChanged){const n=this.xterm.getFont(),s=this._configHelper.config;this.xterm.raw.options.letterSpacing=n.letterSpacing,this.xterm.raw.options.lineHeight=n.lineHeight,this.xterm.raw.options.fontSize=n.fontSize,this.xterm.raw.options.fontFamily=n.fontFamily,this.xterm.raw.options.fontWeight=s.fontWeight,this.xterm.raw.options.fontWeightBold=s.fontWeightBold,this._initDimensions(),t=this.cols,i=this.rows,this._layoutSettingsChanged=!1}if(isNaN(t)||isNaN(i))return;(t!==this.xterm.raw.cols||i!==this.xterm.raw.rows)&&((this._fixedRows||this._fixedCols)&&await this._updateProperty("fixedDimensions",{cols:this._fixedCols,rows:this._fixedRows}),this._onDimensionsChanged.fire()),this.xterm.raw.resize(t,i),Ue._lastKnownGridDimensions={cols:t,rows:i},this._isVisible&&this.xterm.forceUnpause()}e?this._processManager.setDimensions(t,i,!0):await this._processManager.setDimensions(t,i)}setShellType(e){this._shellType=e,e&&this._terminalShellTypeContextKey.set(e==null?void 0:e.toString())}_setAriaLabel(e,t,i){var s;const n=[];if(e&&e.textarea){i&&i.length>0?n.push(c("terminalTextBoxAriaLabelNumberAndTitle","Terminal {0}, {1}",t,i)):n.push(c("terminalTextBoxAriaLabel","Terminal {0}",t)),this._accessibilityService.isScreenReaderOptimized()||n.push(c("terminalScreenReaderMode","Run the command: Toggle Screen Reader Accessibility Mode for an optimized screen reader experience"));const a=(s=this._keybindingService.lookupKeybinding("editor.action.accessibilityHelp"))==null?void 0:s.getLabel();this._configurationService.getValue("accessibility.verbosity.terminal")&&a&&n.push(c("terminalHelpAriaLabel","Use {0} for terminal accessibility help",a)),e.textarea.setAttribute("aria-label",n.join(`
`))}}_updateTitleProperties(e,t){if(!e)return this._processName;switch(t){case Ie.Process:if(this._processManager.os===1)e=ys.parse(e).name;else{const i=e.indexOf(" ");e.startsWith("/")?e=Zt(e):i>-1&&(e=e.substring(0,i))}this._processName=e;break;case Ie.Api:this._staticTitle=e,ee(this._messageTitleDisposable),this._messageTitleDisposable=void 0;break;case Ie.Sequence:this._sequence=e,this._processManager.os===1&&(e.match(/^[a-zA-Z]:\\.+\.[a-zA-Z]{1,3}/)?(e=ys.parse(e).name,this._sequence=e):this._sequence=void 0);break}return this._titleSource=t,e}setOverrideDimensions(e,t=!1){this._dimensionsOverride&&this._dimensionsOverride.forceExactSize&&!e&&this._rows===0&&this._cols===0&&(this._cols=this._dimensionsOverride.cols,this._rows=this._dimensionsOverride.rows),this._dimensionsOverride=e,t?this._resizeNow(!0):this._resize()}async setFixedDimensions(){var i,n;const e=await this._quickInputService.input({title:c("setTerminalDimensionsColumn","Set Fixed Dimensions: Column"),placeHolder:"Enter a number of columns or leave empty for automatic width",validateInput:async s=>s.length>0&&!s.match(/^\d+$/)?{content:"Enter a number or leave empty size automatically",severity:ne.Error}:void 0});if(e===void 0)return;this._fixedCols=this._parseFixedDimension(e),(i=this._labelComputer)==null||i.refreshLabel(),this._terminalHasFixedWidth.set(!!this._fixedCols);const t=await this._quickInputService.input({title:c("setTerminalDimensionsRow","Set Fixed Dimensions: Row"),placeHolder:"Enter a number of rows or leave empty for automatic height",validateInput:async s=>s.length>0&&!s.match(/^\d+$/)?{content:"Enter a number or leave empty size automatically",severity:ne.Error}:void 0});t!==void 0&&(this._fixedRows=this._parseFixedDimension(t),(n=this._labelComputer)==null||n.refreshLabel(),await this._refreshScrollbar(),this._resize(),this.focus())}_parseFixedDimension(e){if(e==="")return;const t=parseInt(e);if(t<=0)throw new Error(`Could not parse dimension "${e}"`);return t}async toggleSizeToContentWidth(){var e,t;if((e=this.xterm)!=null&&e.raw.buffer.active){if(this._hasScrollBar)this._terminalHasFixedWidth.set(!1),this._fixedCols=void 0,this._fixedRows=void 0,this._hasScrollBar=!1,this._initDimensions(),await this._resize();else{const i=Math.max(this.maxCols,Math.min(this.xterm.getLongestViewportWrappedLineLength(),5e3));i>this.xterm.raw.cols&&(this._fixedCols=i)}await this._refreshScrollbar(),(t=this._labelComputer)==null||t.refreshLabel(),this.focus()}}_refreshScrollbar(){return this._fixedCols||this._fixedRows?this._addScrollbar():this._removeScrollbar()}async _addScrollbar(){var t;const e=(this.xterm?this.xterm.getFont():this._configHelper.getFont()).charWidth;if(!(!((t=this.xterm)!=null&&t.raw.element)||!this._container||!e||!this._fixedCols)&&(this._wrapperElement.classList.add("fixed-dims"),this._hasScrollBar=!0,this._initDimensions(),this._fixedRows=this._rows-1,await this._resize(),this._terminalHasFixedWidth.set(!0),this._horizontalScrollbar||(this._horizontalScrollbar=this._register(new xh(this._wrapperElement,{vertical:2,horizontal:1,useShadows:!1,scrollYToX:!1,consumeMouseWheelIfScrollbarIsNeeded:!1})),this._container.appendChild(this._horizontalScrollbar.getDomNode())),this._horizontalScrollbar.setScrollDimensions({width:this.xterm.raw.element.clientWidth,scrollWidth:this._fixedCols*e+40}),this._horizontalScrollbar.getDomNode().style.paddingBottom="16px",re))for(let i=this.xterm.raw.buffer.active.viewportY;i<this.xterm.raw.buffer.active.length;i++){const n=this.xterm.raw.buffer.active.getLine(i);n._line.isWrapped=!1}}async _removeScrollbar(){!this._container||!this._horizontalScrollbar||(this._horizontalScrollbar.getDomNode().remove(),this._horizontalScrollbar.dispose(),this._horizontalScrollbar=void 0,this._wrapperElement.remove(),this._wrapperElement.classList.remove("fixed-dims"),this._container.appendChild(this._wrapperElement))}_setResolvedShellLaunchConfig(e){this._shellLaunchConfig.args=e.args,this._shellLaunchConfig.cwd=e.cwd,this._shellLaunchConfig.executable=e.executable,this._shellLaunchConfig.env=e.env}_onEnvironmentVariableInfoChanged(e){var t,i;e.requiresAction&&((i=(t=this.xterm)==null?void 0:t.raw.textarea)==null||i.setAttribute("aria-label",c("terminalStaleTextBoxAriaLabel","Terminal {0} environment is stale, run the 'Show Environment Information' command for more information",this._instanceId))),this._refreshEnvironmentVariableInfoWidgetState(e)}_refreshEnvironmentVariableInfoWidgetState(e){if(!e){this.statusList.remove("relaunch-needed"),this.statusList.remove("env-var-info-changes-active");return}if(e.requiresAction&&this._configHelper.config.environmentChangesRelaunch&&!this._processManager.hasWrittenData&&(!this._shellLaunchConfig.isFeatureTerminal||this.reconnectionProperties&&this._configurationService.getValue("task.reconnection")===!0)&&!this._shellLaunchConfig.customPtyImplementation&&!this._shellLaunchConfig.isExtensionOwnedTerminal&&!this._shellLaunchConfig.attachPersistentProcess){this.relaunch();return}const t=sr(this.shellLaunchConfig.cwd,this._workspaceContextService,this._historyService);this.statusList.add(e.getStatus({workspaceFolder:t}))}async getInitialCwd(){return this._initialCwd||(this._initialCwd=this._processManager.initialCwd),this._initialCwd}async getCwd(){return this.capabilities.has(0)?this.capabilities.get(0).getCwd():this.capabilities.has(1)?this.capabilities.get(1).getCwd():this._processManager.initialCwd}async _refreshProperty(e){return await this.processReady,this._processManager.refreshProperty(e)}async _updateProperty(e,t){return this._processManager.updateProperty(e,t)}async rename(e){this._setTitle(e,Ie.Api)}_setTitle(e,t){var s,o;const i=!e;e=this._updateTitleProperties(e,t);const n=e!==this._title;this._title=e,(s=this._labelComputer)==null||s.refreshLabel(i),this._setAriaLabel((o=this.xterm)==null?void 0:o.raw,this._instanceId,this._title),n&&this._onTitleChanged.fire(this)}async changeIcon(){const e=[];for(const i of Ds())e.push({label:`$(${i.id})`,description:`${i.id}`,icon:i});const t=await this._quickInputService.pick(e,{matchOnDescription:!0});t&&(this._icon=t.icon,this._onIconChanged.fire({instance:this,userInitiated:!0}))}async changeColor(){if(!this._getIcon())return;const t=this._themeService.getColorTheme(),i=Oc(t),n=Zo(t),s=[];for(const m of i){const p=ut(m);s.push({label:`$(${k.circleFilled.id}) ${m.replace("terminal.ansi","")}`,id:m,description:m,iconClasses:[p]})}s.push({type:"separator"});const o={label:"Reset to default"};s.push(o),document.body.appendChild(n);const a=this._quickInputService.createQuickPick();a.items=s,a.matchOnDescription=!0,a.show();const l=[],h=await new Promise(m=>{l.push(a.onDidHide(()=>m(void 0))),l.push(a.onDidAccept(()=>m(a.selectedItems[0])))});ee(l),h&&(this.shellLaunchConfig.color=h.id,this._onIconChanged.fire({instance:this,userInitiated:!0})),a.hide(),document.body.removeChild(n)}selectPreviousSuggestion(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.selectPreviousSuggestion()}selectPreviousPageSuggestion(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.selectPreviousPageSuggestion()}selectNextSuggestion(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.selectNextSuggestion()}selectNextPageSuggestion(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.selectNextPageSuggestion()}async acceptSelectedSuggestion(e){var t,i;(i=(t=this.xterm)==null?void 0:t.suggestController)==null||i.acceptSelectedSuggestion(e)}hideSuggestWidget(){var e,t;(t=(e=this.xterm)==null?void 0:e.suggestController)==null||t.hideSuggestWidget()}forceScrollbarVisibility(){this._wrapperElement.classList.add("force-scrollbar")}resetScrollbarVisibility(){this._wrapperElement.classList.remove("force-scrollbar")}};Pe._instanceIdCounter=1;Pe.__decorator=w([$e(50)],Pe.prototype,"_fireMaximumDimensionsChanged",null);Pe.__decorator=w([$e(1e3)],Pe.prototype,"relaunch",null);Pe.__decorator=w([$e(2e3)],Pe.prototype,"_updateProcessCwd",null);Pe.__decorator=w([$e(50)],Pe.prototype,"_resize",null);Pe=w([d(5,me),d(6,B),d(7,vt),d(8,na),d(9,At),d(10,se),d(11,Br),d(12,zr),d(13,$n),d(14,de),d(15,X),d(16,it),d(17,Wi),d(18,bt),d(19,fa),d(20,Fi),d(21,le),d(22,si),d(23,_e),d(24,_t),d(25,_h),d(26,On),d(27,ai),d(28,Gi),d(29,pe),d(30,jr),d(31,Hi)],Pe);let cr=class extends H{get onDropFile(){return this._onDropFile.event}get onDropTerminal(){return this._onDropTerminal.event}constructor(e,t,i){super(),this._container=e,this._layoutService=t,this._viewDescriptorService=i,this._onDropFile=new b,this._onDropTerminal=new b,this._register(Ce(()=>this._clearDropOverlay()))}_clearDropOverlay(){this._dropOverlay&&this._dropOverlay.parentElement&&this._dropOverlay.parentElement.removeChild(this._dropOverlay),this._dropOverlay=void 0}onDragEnter(e){if(fi(e,qt.FILES,qt.RESOURCES,"Terminals",_n.FILES)){if(this._dropOverlay||(this._dropOverlay=document.createElement("div"),this._dropOverlay.classList.add("terminal-drop-overlay")),fi(e,"Terminals")){const t=this._getDropSide(e);this._dropOverlay.classList.toggle("drop-before",t==="before"),this._dropOverlay.classList.toggle("drop-after",t==="after")}this._dropOverlay.parentElement||this._container.appendChild(this._dropOverlay)}}onDragLeave(e){this._clearDropOverlay()}onDragEnd(e){this._clearDropOverlay()}onDragOver(e){if(!(!e.dataTransfer||!this._dropOverlay)){if(fi(e,"Terminals")){const t=this._getDropSide(e);this._dropOverlay.classList.toggle("drop-before",t==="before"),this._dropOverlay.classList.toggle("drop-after",t==="after")}this._dropOverlay.style.opacity="1"}}async onDrop(e){if(this._clearDropOverlay(),!e.dataTransfer)return;const t=Ua(e);if(t){for(const o of t){const a=this._getDropSide(e);this._onDropTerminal.fire({uri:o,side:a})}return}let i;const n=e.dataTransfer.getData(qt.RESOURCES);n&&(i=L.parse(JSON.parse(n)[0]));const s=e.dataTransfer.getData(_n.FILES);!i&&s&&(i=L.file(JSON.parse(s)[0])),!i&&e.dataTransfer.files.length>0&&e.dataTransfer.files[0].path&&(i=L.file(e.dataTransfer.files[0].path)),i&&this._onDropFile.fire(i)}_getDropSide(e){const t=this._container;if(!t)return"after";const i=t.getBoundingClientRect();return this._getViewOrientation()===1?e.clientX-i.left<i.width/2?"before":"after":e.clientY-i.top<i.height/2?"before":"after"}_getViewOrientation(){const e=this._layoutService.getPanelPosition();return this._viewDescriptorService.getViewLocationById(K)===1&&e===2?1:0}};cr=w([d(1,Gn),d(2,Hi)],cr);let lr=class extends H{get title(){return this._title}get description(){return this._description}constructor(e,t,i,n){super(),this._configHelper=e,this._instance=t,this._fileService=i,this._workspaceContextService=n,this._title="",this._description="",this._onDidChangeLabel=this._register(new b),this.onDidChangeLabel=this._onDidChangeLabel.event}refreshLabel(e){this._title=this.computeLabel(this._configHelper.config.tabs.title,"title",e),this._description=this.computeLabel(this._configHelper.config.tabs.description,"description"),(this._title!==this._instance.title||this._description!==this._instance.description||e)&&this._onDidChangeLabel.fire({title:this._title,description:this._description})}computeLabel(e,t,i){var m,p,v,f;const n=((m=this._instance.shellLaunchConfig.attachPersistentProcess)==null?void 0:m.type)||this._instance.shellLaunchConfig.type,s={cwd:this._instance.cwd||this._instance.initialCwd||"",cwdFolder:"",workspaceFolder:this._instance.workspaceFolder?Zt(this._instance.workspaceFolder.uri.fsPath):void 0,local:n==="Local"?n:void 0,process:this._instance.processName,sequence:this._instance.sequence,task:n==="Task"?n:void 0,fixedDimensions:this._instance.fixedCols?this._instance.fixedRows?`↔${this._instance.fixedCols} ↕${this._instance.fixedRows}`:`↔${this._instance.fixedCols}`:this._instance.fixedRows?`↕${this._instance.fixedRows}`:"",separator:{label:this._configHelper.config.tabs.separator}};if(e=e.trim(),!e)return t==="title"&&this._instance.processName||"";if(!i&&this._instance.staticTitle&&t==="title")return this._instance.staticTitle.replace(/[\n\r\t]/g,"")||((p=s.process)==null?void 0:p.replace(/[\n\r\t]/g,""))||"";const o=this._instance.capabilities.has(0)||this._instance.capabilities.has(1),l=this._workspaceContextService.getWorkspace().folders.length>1;if(s.cwd&&o&&(!this._instance.shellLaunchConfig.isFeatureTerminal||t==="title")){const _=L.from({scheme:((v=this._instance.workspaceFolder)==null?void 0:v.uri.scheme)||$.file,path:this._instance.cwd?Ih(this._instance.cwd):void 0});let S=!1;if(l)S=!0;else if((f=this._instance.workspaceFolder)!=null&&f.uri){const y=this._fileService.hasCapability(this._instance.workspaceFolder.uri,1024);S=_.fsPath.localeCompare(this._instance.workspaceFolder.uri.fsPath,void 0,{sensitivity:y?"case":"base"})!==0}S&&(s.cwdFolder=Zt(s.cwd))}const h=kh(e,s).replace(/[\n\r\t]/g,"").trim();return h===""&&t==="title"?this._instance.processName||"":h}};lr=w([d(2,wt),d(3,_e)],lr);function uu(r,e,t,i){if(r===void 0||r===0)return{code:r,message:void 0};const n=typeof r=="number"?r:r.code;let s;switch(typeof r){case"number":{let o;e.executable&&(o=e.executable,typeof e.args=="string"?o+=` ${e.args}`:e.args&&e.args.length&&(o+=e.args.map(a=>` '${a}'`).join())),t===4?o?s=c("launchFailed.exitCodeAndCommandLine",'The terminal process "{0}" failed to launch (exit code: {1}).',o,n):s=c("launchFailed.exitCodeOnly","The terminal process failed to launch (exit code: {0}).",n):o?s=c("terminated.exitCodeAndCommandLine",'The terminal process "{0}" terminated with exit code: {1}.',o,n):s=c("terminated.exitCodeOnly","The terminal process terminated with exit code: {0}.",n);break}case"object":{if(r.message.toString().includes("Could not find pty with id"))break;let o=r.message;const a=r.message.match(/.*error code:\s*(\d+).*$/);if(a)switch(a.length>1?parseInt(a[1]):void 0){case 5:o=`Access was denied to the path containing your executable "${e.executable}". Manage and change your permissions to get this to work`;break;case 267:o=`Invalid starting directory "${i}", review your terminal.integrated.cwd setting`;break;case 1260:o="Windows cannot open this program because it has been prevented by a software restriction policy. For more information, open Event Viewer or contact your system Administrator";break}s=c("launchFailed.errorMessage","The terminal process failed to launch: {0}.",o);break}}return{code:n,message:s}}let Je=class{get isProcessSupportRegistered(){return!!this._processSupportContextKey.get()}get connectionState(){return this._connectionState}get whenConnected(){return this._whenConnected.p}get restoredGroupCount(){return this._restoredGroupCount}get configHelper(){return this._configHelper}get instances(){return this._terminalGroupService.instances.concat(this._terminalEditorService.instances)}get detachedXterms(){return this._detachedXterms}getReconnectedTerminals(e){return this._reconnectedTerminals.get(e)}get defaultLocation(){return this.configHelper.config.defaultLocation==="editor"?A.Editor:A.Panel}get activeInstance(){for(const e of this._hostActiveTerminals.values())if(e!=null&&e.hasFocus)return e;return this._activeInstance}get onDidChangeActiveGroup(){return this._onDidChangeActiveGroup.event}get onDidCreateInstance(){return this._onDidCreateInstance.event}get onDidDisposeInstance(){return this._onDidDisposeInstance.event}get onDidFocusInstance(){return this._onDidFocusInstance.event}get onDidReceiveProcessId(){return this._onDidReceiveProcessId.event}get onDidRequestStartExtensionTerminal(){return this._onDidRequestStartExtensionTerminal.event}get onDidChangeInstanceDimensions(){return this._onDidChangeInstanceDimensions.event}get onDidMaximumDimensionsChange(){return this._onDidMaxiumumDimensionsChange.event}get onDidChangeInstanceCapability(){return this._onDidChangeInstanceCapability.event}get onDidChangeInstances(){return this._onDidChangeInstances.event}get onDidChangeInstanceTitle(){return this._onDidChangeInstanceTitle.event}get onDidChangeInstanceIcon(){return this._onDidChangeInstanceIcon.event}get onDidChangeInstanceColor(){return this._onDidChangeInstanceColor.event}get onDidChangeActiveInstance(){return this._onDidChangeActiveInstance.event}get onDidChangeInstancePrimaryStatus(){return this._onDidChangeInstancePrimaryStatus.event}get onDidInputInstanceData(){return this._onDidInputInstanceData.event}get onDidDisposeGroup(){return this._onDidDisposeGroup.event}get onDidChangeGroups(){return this._onDidChangeGroups.event}get onDidRegisterProcessSupport(){return this._onDidRegisterProcessSupport.event}get onDidChangeConnectionState(){return this._onDidChangeConnectionState.event}constructor(e,t,i,n,s,o,a,l,h,m,p,v,f,_,S,y,M,D,R,N){this._contextKeyService=e,this._lifecycleService=t,this._logService=i,this._dialogService=n,this._instantiationService=s,this._remoteAgentService=o,this._viewsService=a,this._configurationService=l,this._environmentService=h,this._terminalEditorService=m,this._terminalGroupService=p,this._terminalInstanceService=v,this._editorGroupsService=f,this._terminalProfileService=_,this._extensionService=S,this._notificationService=y,this._workspaceContextService=M,this._commandService=D,this._keybindingService=R,this._timerService=N,this._hostActiveTerminals=new Map,this._detachedXterms=new Set,this._isShuttingDown=!1,this._backgroundedTerminalInstances=[],this._backgroundedTerminalDisposables=new Map,this._connectionState=0,this._whenConnected=new _a,this._restoredGroupCount=0,this._reconnectedTerminals=new Map,this._onDidChangeActiveGroup=new b,this._onDidCreateInstance=new b,this._onDidDisposeInstance=new b,this._onDidFocusInstance=new b,this._onDidReceiveProcessId=new b,this._onDidRequestStartExtensionTerminal=new b,this._onDidChangeInstanceDimensions=new b,this._onDidMaxiumumDimensionsChange=new b,this._onDidChangeInstanceCapability=new b,this._onDidChangeInstances=new b,this._onDidChangeInstanceTitle=new b,this._onDidChangeInstanceIcon=new b,this._onDidChangeInstanceColor=new b,this._onDidChangeActiveInstance=new b,this._onDidChangeInstancePrimaryStatus=new b,this._onDidInputInstanceData=new b,this._onDidDisposeGroup=new b,this._onDidChangeGroups=new b,this._onDidRegisterProcessSupport=new b,this._onDidChangeConnectionState=new b,this._configHelper=this._instantiationService.createInstance(Fn),this.onDidCreateInstance(()=>this._terminalProfileService.refreshAvailableProfiles()),this._forwardInstanceHostEvents(this._terminalGroupService),this._forwardInstanceHostEvents(this._terminalEditorService),this._terminalGroupService.onDidChangeActiveGroup(this._onDidChangeActiveGroup.fire,this._onDidChangeActiveGroup),this._terminalInstanceService.onDidCreateInstance(C=>{this._initInstanceListeners(C),this._onDidCreateInstance.fire(C)}),this._terminalGroupService.onDidChangeActiveInstance(C=>{!C&&!this._isShuttingDown&&this._terminalGroupService.hidePanel(),C!=null&&C.shellType?this._terminalShellTypeContextKey.set(C.shellType.toString()):C||this._terminalShellTypeContextKey.reset()}),this._handleInstanceContextKeys(),this._terminalShellTypeContextKey=u.shellType.bindTo(this._contextKeyService),this._processSupportContextKey=u.processSupported.bindTo(this._contextKeyService),this._processSupportContextKey.set(!Jt||this._remoteAgentService.getConnection()!==null||fe.as(pi.Backend).getTerminalBackend()!==void 0),this._terminalHasBeenCreated=u.terminalHasBeenCreated.bindTo(this._contextKeyService),this._terminalCountContextKey=u.count.bindTo(this._contextKeyService),this._terminalEditorActive=u.terminalEditorActive.bindTo(this._contextKeyService),this.onDidChangeActiveInstance(C=>{this._terminalEditorActive.set(!!(C!=null&&C.target)&&C.target===A.Editor)}),t.onBeforeShutdown(async C=>C.veto(this._onBeforeShutdown(C.reason),"veto.terminal")),t.onWillShutdown(C=>this._onWillShutdown(C)),this.initializePrimaryBackend(),Pt(0).then(()=>this._instantiationService.createInstance(hr,document.head))}async showProfileQuickPick(e,t){var o,a;const n=await this._instantiationService.createInstance(js).showAndGetResult(e);if(!n||typeof n=="string")return;const s=n.keyMods;if(e==="createInstance"){const l=this.getDefaultInstanceHost().activeInstance;let h;if(n.config&&"id"in(n==null?void 0:n.config)){await this.createContributedTerminalProfile(n.config.extensionIdentifier,n.config.id,{icon:(o=n.config.options)==null?void 0:o.icon,color:(a=n.config.options)==null?void 0:a.color,location:s!=null&&s.alt&&l?{splitActiveTerminal:!0}:this.defaultLocation});return}else n.config&&"profileName"in n.config&&(s!=null&&s.alt&&l?h=await this.createTerminal({location:{parentTerminal:l},config:n.config,cwd:t}):h=await this.createTerminal({location:this.defaultLocation,config:n.config,cwd:t}));if(h&&this.defaultLocation!==A.Editor)return this._terminalGroupService.showPanel(!0),this.setActiveInstance(h),h}}async initializePrimaryBackend(){var n;Z("code/terminal/willGetTerminalBackend"),this._primaryBackend=await this._terminalInstanceService.getBackend(this._environmentService.remoteAuthority),Z("code/terminal/didGetTerminalBackend");const e=this.configHelper.config.enablePersistentSessions;this._connectionState=0;const t=!!this._environmentService.remoteAuthority&&e;Z("code/terminal/willReconnect");let i;t?i=this._reconnectToRemoteTerminals():e?i=this._reconnectToLocalTerminals():i=Promise.resolve(),i.then(async()=>{var o;this._setConnected(),Z("code/terminal/didReconnect"),Z("code/terminal/willReplay");const s=await((o=this._reconnectedTerminalGroups)==null?void 0:o.then(a=>a.map(l=>l.terminalInstances).flat()))??[];await Promise.all(s.map(a=>new Promise(l=>Q.once(a.onProcessReplayComplete)(l)))),Z("code/terminal/didReplay");for(const a of this._terminalInstanceService.getRegisteredBackends())Z("code/terminal/willGetPerformanceMarks"),this._timerService.setPerformanceMarks(a.remoteAuthority===void 0?"localPtyHost":"remotePtyHost",await a.getPerformanceMarks()),Z("code/terminal/didGetPerformanceMarks"),a.setConnected();this._whenConnected.complete()}),(n=this._primaryBackend)==null||n.onDidRequestDetach(async s=>{var a,l,h;const o=this.getInstanceFromResource(Ka(s.workspaceId,s.instanceId));if(o){const m=o==null?void 0:o.persistentProcessId;m&&!o.shellLaunchConfig.isFeatureTerminal&&!o.shellLaunchConfig.customPtyImplementation?(o.target===A.Editor?this._terminalEditorService.detachInstance(o):(a=this._terminalGroupService.getGroupForInstance(o))==null||a.removeInstance(o),await o.detachProcessAndDispose(je.User),await((l=this._primaryBackend)==null?void 0:l.acceptDetachInstanceReply(s.requestId,m))):await((h=this._primaryBackend)==null?void 0:h.acceptDetachInstanceReply(s.requestId,void 0))}})}getPrimaryBackend(){return this._primaryBackend}_forwardInstanceHostEvents(e){e.onDidChangeInstances(this._onDidChangeInstances.fire,this._onDidChangeInstances),e.onDidDisposeInstance(this._onDidDisposeInstance.fire,this._onDidDisposeInstance),e.onDidChangeActiveInstance(t=>this._evaluateActiveInstance(e,t)),e.onDidFocusInstance(t=>{this._onDidFocusInstance.fire(t),this._evaluateActiveInstance(e,t)}),e.onDidChangeInstanceCapability(t=>{this._onDidChangeInstanceCapability.fire(t)}),this._hostActiveTerminals.set(e,void 0)}_evaluateActiveInstance(e,t){if(this._hostActiveTerminals.set(e,t),t===void 0)for(const i of this._hostActiveTerminals.values())i&&(t=i);this._activeInstance=t,this._onDidChangeActiveInstance.fire(t)}setActiveInstance(e){e.shellLaunchConfig.hideFromUser&&this._showBackgroundTerminal(e),e.target===A.Editor?this._terminalEditorService.setActiveInstance(e):this._terminalGroupService.setActiveInstance(e)}async focusActiveInstance(){if(this._activeInstance)return this._activeInstance.target===A.Editor?this._terminalEditorService.focusActiveInstance():this._terminalGroupService.focusActiveInstance()}async createContributedTerminalProfile(e,t,i){var s;await this._extensionService.activateByEvent(`onTerminalProfile:${t}`);const n=this._terminalProfileService.getContributedProfileProvider(e,t);if(!n){this._notificationService.error(`No terminal profile provider registered for id "${t}"`);return}try{await n.createContributedTerminalProfile(i),this._terminalGroupService.setActiveInstanceByIndex(this._terminalGroupService.instances.length-1),await((s=this._terminalGroupService.activeInstance)==null?void 0:s.focusWhenReady())}catch(o){this._notificationService.error(o.message)}}async safeDisposeTerminal(e){if(!(e.target!==A.Editor&&e.hasChildProcesses&&(this.configHelper.config.confirmOnKill==="panel"||this.configHelper.config.confirmOnKill==="always")&&await this._showTerminalCloseConfirmation(!0)))return new Promise(t=>{e.onExit(()=>t()),e.dispose(je.User)})}_setConnected(){this._connectionState=1,this._onDidChangeConnectionState.fire(),this._logService.trace("Reconnected to terminals")}async _reconnectToRemoteTerminals(){const e=this._environmentService.remoteAuthority;if(!e)return;const t=await this._terminalInstanceService.getBackend(e);if(!t)return;Z("code/terminal/willGetTerminalLayoutInfo");const i=await t.getTerminalLayoutInfo();Z("code/terminal/didGetTerminalLayoutInfo"),t.reduceConnectionGraceTime(),Z("code/terminal/willRecreateTerminalGroups"),await this._recreateTerminalGroups(i),Z("code/terminal/didRecreateTerminalGroups"),this._attachProcessLayoutListeners()}async _reconnectToLocalTerminals(){const e=await this._terminalInstanceService.getBackend();if(!e)return;Z("code/terminal/willGetTerminalLayoutInfo");const t=await e.getTerminalLayoutInfo();Z("code/terminal/didGetTerminalLayoutInfo"),t&&t.tabs.length>0&&(Z("code/terminal/willRecreateTerminalGroups"),this._reconnectedTerminalGroups=this._recreateTerminalGroups(t),Z("code/terminal/didRecreateTerminalGroups")),this._attachProcessLayoutListeners()}_recreateTerminalGroups(e){const t=[];let i;if(e){for(const n of e.tabs){const s=n.terminals.filter(o=>o.terminal&&o.terminal.isOrphan);if(s.length){this._restoredGroupCount+=s.length;const o=this._recreateTerminalGroup(n,s);t.push(o),n.isActive&&(i=o);const a=this.instances.find(l=>{var h;return((h=l.shellLaunchConfig.attachPersistentProcess)==null?void 0:h.id)===n.activePersistentProcessId});a&&this.setActiveInstance(a)}}e.tabs.length&&(i==null||i.then(n=>this._terminalGroupService.activeGroup=n))}return Promise.all(t).then(n=>n.filter(s=>!!s))}async _recreateTerminalGroup(e,t){let i,n;for(const s of t){const o=s.terminal;this._lifecycleService.startupKind!==3&&o.type==="Task"||(Z(`code/terminal/willRecreateTerminal/${o.id}-${o.pid}`),i?i=this.createTerminal({config:{attachPersistentProcess:o},location:{parentTerminal:i}}):(i=this.createTerminal({config:{attachPersistentProcess:o},location:A.Panel}),n=i.then(a=>this._terminalGroupService.getGroupForInstance(a))),Z(`code/terminal/didRecreateTerminal/${o.id}-${o.pid}`))}return n==null||n.then(s=>s==null?void 0:s.resizePanes(e.terminals.map(o=>o.relativeSize))),n}_attachProcessLayoutListeners(){this.onDidChangeActiveGroup(()=>this._saveState()),this.onDidChangeActiveInstance(()=>this._saveState()),this.onDidChangeInstances(()=>this._saveState()),this.onDidReceiveProcessId(()=>this._saveState()),this.onDidChangeInstanceTitle(e=>this._updateTitle(e)),this.onDidChangeInstanceIcon(e=>this._updateIcon(e.instance,e.userInitiated))}_handleInstanceContextKeys(){const e=u.isOpen.bindTo(this._contextKeyService),t=()=>{e.set(this.instances.length>0),this._terminalCountContextKey.set(this.instances.length)};this.onDidChangeInstances(()=>t())}async getActiveOrCreateInstance(e){var n;const t=this.activeInstance;if(!t)return this.createTerminal();if(!(e!=null&&e.acceptsInput)||((n=t.xterm)==null?void 0:n.isStdinDisabled)!==!0)return t;const i=await this.createTerminal();return this.setActiveInstance(i),await this.revealActiveTerminal(),i}async revealActiveTerminal(){const e=this.activeInstance;e&&(e.target===A.Editor?await this._terminalEditorService.revealActiveEditor():await this._terminalGroupService.showPanel())}setEditable(e,t){var s;t?this._editable={instance:e,data:t}:this._editable=void 0;const i=this._viewsService.getActiveViewWithId(K),n=this.isEditable(e);(s=i==null?void 0:i.terminalTabbedView)==null||s.setEditable(n)}isEditable(e){return!!this._editable&&(this._editable.instance===e||!e)}getEditableData(e){return this._editable&&this._editable.instance===e?this._editable.data:void 0}requestStartExtensionTerminal(e,t,i){return new Promise(n=>{this._onDidRequestStartExtensionTerminal.fire({proxy:e,cols:t,rows:i,callback:n})})}_onBeforeShutdown(e){return Jt?(this._isShuttingDown=!0,!1):this._onBeforeShutdownAsync(e)}async _onBeforeShutdownAsync(e){var t,i;if(this.instances.length===0)return!1;try{if(this._shutdownWindowCount=await((t=this._nativeDelegate)==null?void 0:t.getWindowCount()),this._shouldReviveProcesses(e)&&await Promise.race([(i=this._primaryBackend)==null?void 0:i.persistTerminalState(),Pt(2e3)]),!(this._configHelper.config.enablePersistentSessions&&e===3)&&(this.configHelper.config.confirmOnExit==="always"&&this.instances.length>0||this.configHelper.config.confirmOnExit==="hasChildProcesses"&&this.instances.some(a=>a.hasChildProcesses)))return this._onBeforeShutdownConfirmation(e)}catch(n){this._logService.warn("Exception occurred during terminal shutdown",n)}return this._isShuttingDown=!0,!1}setNativeDelegate(e){this._nativeDelegate=e}_shouldReviveProcesses(e){if(!this._configHelper.config.enablePersistentSessions)return!1;switch(this.configHelper.config.persistentSessionReviveProcess){case"onExit":return e===1&&this._shutdownWindowCount===1&&!Ee?!0:e===4||e===2;case"onExitAndWindowClose":return e!==3;default:return!1}}async _onBeforeShutdownConfirmation(e){const t=await this._showTerminalCloseConfirmation();return t||(this._isShuttingDown=!0),t}_onWillShutdown(e){var i;const t=this._configHelper.config.enablePersistentSessions&&e.reason===3;for(const n of[...this._terminalGroupService.instances,...this._backgroundedTerminalInstances])t&&n.shouldPersist?n.detachProcessAndDispose(je.Shutdown):n.dispose(je.Shutdown);!t&&!this._shouldReviveProcesses(e.reason)&&((i=this._primaryBackend)==null||i.setTerminalLayoutInfo(void 0))}_saveState(){var i;if(this._isShuttingDown||!this.configHelper.config.enablePersistentSessions)return;const t={tabs:this._terminalGroupService.groups.map(n=>n.getLayoutInfo(n===this._terminalGroupService.activeGroup))};(i=this._primaryBackend)==null||i.setTerminalLayoutInfo(t)}_updateTitle(e){var t,i;!this.configHelper.config.enablePersistentSessions||!e||!e.persistentProcessId||!e.title||e.isDisposed||(e.staticTitle?(t=this._primaryBackend)==null||t.updateTitle(e.persistentProcessId,e.staticTitle,Ie.Api):(i=this._primaryBackend)==null||i.updateTitle(e.persistentProcessId,e.title,e.titleSource))}_updateIcon(e,t){var i;!this.configHelper.config.enablePersistentSessions||!e||!e.persistentProcessId||!e.icon||e.isDisposed||(i=this._primaryBackend)==null||i.updateIcon(e.persistentProcessId,t,e.icon,e.color)}refreshActiveGroup(){this._onDidChangeActiveGroup.fire(this._terminalGroupService.activeGroup)}getInstanceFromId(e){let t=-1;if(this._backgroundedTerminalInstances.forEach((i,n)=>{i.instanceId===e&&(t=n)}),t!==-1)return this._backgroundedTerminalInstances[t];try{return this.instances[this._getIndexFromId(e)]}catch{return}}getInstanceFromIndex(e){return this.instances[e]}getInstanceFromResource(e){return eo(this.instances,e)}isAttachedToTerminal(e){return this.instances.some(t=>t.processId===e.pid)}moveToEditor(e){if(e.target===A.Editor)return;const t=this._terminalGroupService.getGroupForInstance(e);t&&(t.removeInstance(e),this._terminalEditorService.openEditor(e))}async moveToTerminalView(e,t,i){if(L.isUri(e)&&(e=this.getInstanceFromResource(e)),!e)return;if(this._terminalEditorService.detachInstance(e),e.target!==A.Editor){await this._terminalGroupService.showPanel(!0);return}e.target=A.Panel;let n;if(t&&(n=this._terminalGroupService.getGroupForInstance(t)),n||(n=this._terminalGroupService.createGroup()),n.addInstance(e),this.setActiveInstance(e),await this._terminalGroupService.showPanel(!0),t&&i){const s=n.terminalInstances.indexOf(t)+(i==="after"?1:0);n.moveInstance(e,s)}this._onDidChangeInstances.fire(),this._onDidChangeActiveGroup.fire(this._terminalGroupService.activeGroup)}_initInstanceListeners(e){const t=[e.onTitleChanged(this._onDidChangeInstanceTitle.fire,this._onDidChangeInstanceTitle),e.onIconChanged(this._onDidChangeInstanceIcon.fire,this._onDidChangeInstanceIcon),e.onIconChanged(this._onDidChangeInstanceColor.fire,this._onDidChangeInstanceColor),e.onProcessIdReady(this._onDidReceiveProcessId.fire,this._onDidReceiveProcessId),e.statusList.onDidChangePrimaryStatus(()=>this._onDidChangeInstancePrimaryStatus.fire(e)),e.onDimensionsChanged(()=>{this._onDidChangeInstanceDimensions.fire(e),this.configHelper.config.enablePersistentSessions&&this.isProcessSupportRegistered&&this._saveState()}),e.onMaximumDimensionsChanged(()=>this._onDidMaxiumumDimensionsChange.fire(e)),e.onDidInputData(this._onDidInputInstanceData.fire,this._onDidInputInstanceData),e.onDidFocus(this._onDidChangeActiveInstance.fire,this._onDidChangeActiveInstance),e.onRequestAddInstanceToGroup(async i=>await this._addInstanceToGroup(e,i))];e.onDisposed(()=>ee(t))}async _addInstanceToGroup(e,t){var s;const i=Zr(t.uri);if(i.instanceId===void 0)return;let n=this.getInstanceFromResource(t.uri);if(!n){const o=await((s=this._primaryBackend)==null?void 0:s.requestDetachInstance(i.workspaceId,i.instanceId));if(o){n=await this.createTerminal({config:{attachPersistentProcess:o},resource:t.uri}),this._terminalGroupService.moveInstance(n,e,t.side);return}}if(n=this._terminalGroupService.getInstanceFromResource(t.uri),n){this._terminalGroupService.moveInstance(n,e,t.side);return}if(n=this._terminalEditorService.getInstanceFromResource(t.uri),n){this.moveToTerminalView(n,e,t.side);return}}registerProcessSupport(e){e&&(this._processSupportContextKey.set(e),this._onDidRegisterProcessSupport.fire())}_getIndexFromId(e){let t=-1;if(this.instances.forEach((i,n)=>{i.instanceId===e&&(t=n)}),t===-1)throw new Error(`Terminal with ID ${e} does not exist (has it already been disposed?)`);return t}async _showTerminalCloseConfirmation(e){let t;this.instances.length===1||e?t=c("terminalService.terminalCloseConfirmationSingular","Do you want to terminate the active terminal session?"):t=c("terminalService.terminalCloseConfirmationPlural","Do you want to terminate the {0} active terminal sessions?",this.instances.length);const{confirmed:i}=await this._dialogService.confirm({type:"warning",message:t,primaryButton:c({key:"terminate",comment:["&& denotes a mnemonic"]},"&&Terminate")});return!i}getDefaultInstanceHost(){return this.defaultLocation===A.Editor?this._terminalEditorService:this._terminalGroupService}async getInstanceHost(e){if(e){if(e===A.Editor)return this._terminalEditorService;if(typeof e=="object"){if("viewColumn"in e)return this._terminalEditorService;if("parentTerminal"in e)return(await e.parentTerminal).target===A.Editor?this._terminalEditorService:this._terminalGroupService}else return this._terminalGroupService}return this}async createTerminal(e){if(this._terminalProfileService.availableProfiles.length===0){const l=(e==null?void 0:e.config)&&"customPtyImplementation"in e.config,h=this._remoteAgentService.getConnection()&&L.isUri(e==null?void 0:e.cwd)&&(e==null?void 0:e.cwd.scheme)===$.vscodeFileResource;!l&&!h&&(this._connectionState===0&&Z("code/terminal/willGetProfiles"),await this._terminalProfileService.profilesReady,this._connectionState===0&&Z("code/terminal/didGetProfiles"))}const t=(e==null?void 0:e.config)||this._terminalProfileService.getDefaultProfile(),i=t&&"extensionIdentifier"in t?{}:this._terminalInstanceService.convertProfileToShellLaunchConfig(t||{});let n=t&&"extensionIdentifier"in t?t:void 0;!n&&(!e||!e.config)&&(n=await this._terminalProfileService.getContributedDefaultProfile(i));const s=typeof(e==null?void 0:e.location)=="object"&&"splitActiveTerminal"in e.location?e.location.splitActiveTerminal:typeof(e==null?void 0:e.location)=="object"?"parentTerminal"in e.location:!1;if(await this._resolveCwd(i,s,e),n){const l=await this.resolveLocation(e==null?void 0:e.location);let h;s?h=l===A.Editor?{viewColumn:Nn}:{splitActiveTerminal:!0}:h=typeof(e==null?void 0:e.location)=="object"&&"viewColumn"in e.location?e.location:l,await this.createContributedTerminalProfile(n.extensionIdentifier,n.id,{icon:n.icon,color:n.color,location:h});const m=l===A.Editor?this._terminalEditorService:this._terminalGroupService,p=m.instances[m.instances.length-1];return await p.focusWhenReady(),this._terminalHasBeenCreated.set(!0),p}if(!i.customPtyImplementation&&!this.isProcessSupportRegistered)throw new Error("Could not create terminal when process support is not registered");if(i.hideFromUser){const l=this._terminalInstanceService.createInstance(i,A.Panel);return this._backgroundedTerminalInstances.push(l),this._backgroundedTerminalDisposables.set(l.instanceId,[l.onDisposed(this._onDidDisposeInstance.fire,this._onDidDisposeInstance)]),this._terminalHasBeenCreated.set(!0),l}this._evaluateLocalCwd(i);const o=await this.resolveLocation(e==null?void 0:e.location)||this.defaultLocation,a=await this._getSplitParent(e==null?void 0:e.location);return this._terminalHasBeenCreated.set(!0),a?this._splitTerminal(i,o,a):this._createTerminal(i,o,e)}async createDetachedXterm(e){const t=await Pe.getXtermConstructor(this._keybindingService,this._contextKeyService),i=this._instantiationService.createInstance(Ei,t,this._configHelper,e.cols,e.rows,e.colorProvider,e.capabilities||new to,"",void 0,!1);return e.readonly&&i.raw.attachCustomKeyEventHandler(()=>!1),this._detachedXterms.add(i),i.onDidDispose(()=>this._detachedXterms.delete(i)),i}async _resolveCwd(e,t,i){if(!e.cwd){if(i!=null&&i.cwd)e.cwd=i.cwd;else if(t&&(i!=null&&i.location)){let s=this.activeInstance;if(typeof i.location=="object"&&"parentTerminal"in i.location&&(s=await i.location.parentTerminal),!s)throw new Error("Cannot split without an active instance");e.cwd=await Na(this.configHelper,s,this._workspaceContextService.getWorkspace().folders,this._commandService)}}}_splitTerminal(e,t,i){let n;if(typeof e.cwd!="object"&&typeof i.shellLaunchConfig.cwd=="object"&&(e.cwd=L.from({scheme:i.shellLaunchConfig.cwd.scheme,authority:i.shellLaunchConfig.cwd.authority,path:e.cwd||i.shellLaunchConfig.cwd.path})),t===A.Editor||i.target===A.Editor)n=this._terminalEditorService.splitInstance(i,e);else{const s=this._terminalGroupService.getGroupForInstance(i);if(!s)throw new Error(`Cannot split a terminal without a group ${i}`);e.parentTerminalId=i.instanceId,n=s.split(e)}return this._addToReconnected(n),n}_addToReconnected(e){var i;if(!((i=e.reconnectionProperties)!=null&&i.ownerId))return;const t=this._reconnectedTerminals.get(e.reconnectionProperties.ownerId);t?t.push(e):this._reconnectedTerminals.set(e.reconnectionProperties.ownerId,[e])}_createTerminal(e,t,i){let n;const s=this._getEditorOptions(i==null?void 0:i.location);return t===A.Editor?(n=this._terminalInstanceService.createInstance(e,A.Editor),this._terminalEditorService.openEditor(n,s)):n=this._terminalGroupService.createGroup(e).terminalInstances[0],this._addToReconnected(n),n}async resolveLocation(e){var t,i;if(e&&typeof e=="object")if("parentTerminal"in e){const n=await e.parentTerminal;return n.target?n.target:A.Panel}else{if("viewColumn"in e)return A.Editor;if("splitActiveTerminal"in e)return(t=this._activeInstance)!=null&&t.target?(i=this._activeInstance)==null?void 0:i.target:A.Panel}return e}async _getSplitParent(e){if(e&&typeof e=="object"&&"parentTerminal"in e)return e.parentTerminal;if(e&&typeof e=="object"&&"splitActiveTerminal"in e)return this.activeInstance}_getEditorOptions(e){if(e&&typeof e=="object"&&"viewColumn"in e)return e.viewColumn=Hc(this._editorGroupsService,this._configurationService,e.viewColumn),e}_evaluateLocalCwd(e){var t;typeof e.cwd!="string"&&((t=e.cwd)==null?void 0:t.scheme)===$.file&&(Gc.getValue(this._contextKeyService)?(e.initialText=Xt(c("localTerminalVirtualWorkspace","This shell is open to a {0}local{1} folder, NOT to the virtual folder","\x1B[3m","\x1B[23m"),{excludeLeadingNewLine:!0,loudFormatting:!0}),e.type="Local"):this._remoteAgentService.getConnection()&&(e.initialText=Xt(c("localTerminalRemote","This shell is running on your {0}local{1} machine, NOT on the connected remote machine","\x1B[3m","\x1B[23m"),{excludeLeadingNewLine:!0,loudFormatting:!0}),e.type="Local"))}_showBackgroundTerminal(e){this._backgroundedTerminalInstances.splice(this._backgroundedTerminalInstances.indexOf(e),1);const t=this._backgroundedTerminalDisposables.get(e.instanceId);t&&ee(t),this._backgroundedTerminalDisposables.delete(e.instanceId),e.shellLaunchConfig.hideFromUser=!1,this._terminalGroupService.createGroup(e),this.instances.length===1&&this._terminalGroupService.setActiveInstanceByIndex(0),this._onDidChangeInstances.fire(),this._onDidChangeGroups.fire()}async setContainers(e,t){this._configHelper.panelContainer=e,this._terminalGroupService.setContainer(t)}getEditingTerminal(){return this._editingTerminal}setEditingTerminal(e){this._editingTerminal=e}};Je.__decorator=w([$e(500)],Je.prototype,"_saveState",null);Je.__decorator=w([$e(500)],Je.prototype,"_updateTitle",null);Je.__decorator=w([$e(500)],Je.prototype,"_updateIcon",null);Je=w([d(0,me),d(1,Hn),d(2,it),d(3,Wi),d(4,B),d(5,et),d(6,zr),d(7,X),d(8,si),d(9,Tt),d(10,he),d(11,He),d(12,Nr),d(13,tt),d(14,ue),d(15,se),d(16,_e),d(17,pe),d(18,At),d(19,Vc)],Je);let hr=class extends va{constructor(e,t,i,n,s){super(i),this._terminalService=t,this._themeService=i,this._terminalProfileService=n,this._editorService=s,this._registerListeners(),this._styleElement=document.createElement("style"),e.appendChild(this._styleElement),this._register(Ce(()=>e.removeChild(this._styleElement))),this.updateStyles()}_registerListeners(){this._register(this._terminalService.onDidChangeInstanceIcon(()=>this.updateStyles())),this._register(this._terminalService.onDidChangeInstanceColor(()=>this.updateStyles())),this._register(this._terminalService.onDidCreateInstance(()=>this.updateStyles())),this._register(this._editorService.onDidActiveEditorChange(()=>{this._editorService.activeEditor instanceof Ae&&this.updateStyles()})),this._register(this._editorService.onDidCloseEditor(()=>{this._editorService.activeEditor instanceof Ae&&this.updateStyles()})),this._register(this._terminalProfileService.onDidChangeAvailableProfiles(()=>this.updateStyles()))}updateStyles(){var s;super.updateStyles();const e=this._themeService.getColorTheme();let t="";const i=this._themeService.getProductIconTheme();for(const o of this._terminalService.instances){const a=o.icon;if(!a)continue;let l;a instanceof L?l=a:a instanceof Object&&"light"in a&&"dark"in a&&(l=e.type===ba.LIGHT?a.light:a.dark);const h=Wt(o,e.type);if(l instanceof L&&h&&h.length>1&&(t+=`.monaco-workbench .terminal-tab.${h[0]}::before{background-image: ${wa(l)};}`),E.isThemeIcon(a)){const p=Jn().getIcon(a.id);if(p){const v=i.getIcon(p);v&&(t+=`.monaco-workbench .terminal-tab.codicon-${a.id}::before{content: '${v.fontCharacter}' !important; font-family: ${Th(((s=v.font)==null?void 0:s.id)??"codicon")} !important;}`)}}}const n=e.getColor(Dh);n&&(t+=`.monaco-workbench .show-file-icons .file-icon.terminal-tab::before { color: ${n}; }`),t+=$c(e,!0),this._styleElement.textContent=t}};hr=w([d(1,J),d(2,de),d(3,tt),d(4,_t)],hr);let dr=class extends H{constructor(e,t,i,n,s,o){super(),this._editorService=e,this._editorGroupsService=t,this._terminalInstanceService=i,this._instantiationService=n,this.instances=[],this._activeInstanceIndex=-1,this._isShuttingDown=!1,this._editorInputs=new Map,this._instanceDisposables=new Map,this._onDidDisposeInstance=new b,this.onDidDisposeInstance=this._onDidDisposeInstance.event,this._onDidFocusInstance=new b,this.onDidFocusInstance=this._onDidFocusInstance.event,this._onDidChangeInstanceCapability=new b,this.onDidChangeInstanceCapability=this._onDidChangeInstanceCapability.event,this._onDidChangeActiveInstance=new b,this.onDidChangeActiveInstance=this._onDidChangeActiveInstance.event,this._onDidChangeInstances=new b,this.onDidChangeInstances=this._onDidChangeInstances.event,this._terminalEditorActive=u.terminalEditorActive.bindTo(o),this._register(Ce(()=>{for(const a of this._instanceDisposables.values())ee(a)})),this._register(s.onWillShutdown(()=>this._isShuttingDown=!0)),this._register(this._editorService.onDidActiveEditorChange(()=>{var m;const a=this._editorService.activeEditor,l=a instanceof Ae?a==null?void 0:a.terminalInstance:void 0,h=!!l&&a instanceof Ae;if(this._terminalEditorActive.set(h),h)a==null||a.setGroup((m=this._editorService.activeEditorPane)==null?void 0:m.group),this.setActiveInstance(l);else for(const p of this.instances)p.resetFocusContextKey()})),this._register(this._editorService.onDidVisibleEditorsChange(()=>{const a=this.instances.map(m=>m.instanceId),h=this._getActiveTerminalEditors().find(m=>{var v;const p=m instanceof Ae?(v=m.terminalInstance)==null?void 0:v.instanceId:void 0;return p===void 0?!1:!a.includes(p)});h instanceof Ae&&h.terminalInstance&&(this._editorInputs.set(h.terminalInstance.resource.path,h),this.instances.push(h.terminalInstance))})),this._register(this._editorService.onDidCloseEditor(a=>{const l=a.editor instanceof Ae?a.editor.terminalInstance:void 0;if(l){const h=this.instances.findIndex(m=>m===l);if(h!==-1){const m=this.instances[h]===this.activeInstance;this._removeInstance(l),m&&this.setActiveInstance(void 0)}}}))}_getActiveTerminalEditors(){return this._editorService.visibleEditors.filter(e=>{var t;return e instanceof Ae&&((t=e.terminalInstance)==null?void 0:t.instanceId)})}get activeInstance(){if(!(this.instances.length===0||this._activeInstanceIndex===-1))return this.instances[this._activeInstanceIndex]}setActiveInstance(e){this._activeInstanceIndex=e?this.instances.findIndex(t=>t===e):-1,this._onDidChangeActiveInstance.fire(this.activeInstance)}async focusActiveInstance(){var e;return(e=this.activeInstance)==null?void 0:e.focusWhenReady(!0)}async openEditor(e,t){var n,s;const i=this.resolveResource(e);i&&(await((n=this._activeOpenEditorRequest)==null?void 0:n.promise),this._activeOpenEditorRequest={instanceId:e.instanceId,promise:this._editorService.openEditor({resource:i,description:e.description||e.shellLaunchConfig.type,options:{pinned:!0,forceReload:!0,preserveFocus:t==null?void 0:t.preserveFocus}},(t==null?void 0:t.viewColumn)??Kr)},await((s=this._activeOpenEditorRequest)==null?void 0:s.promise),this._activeOpenEditorRequest=void 0)}resolveResource(e){const t=e.resource,i=t.path,n=this._editorInputs.get(i);if(n)return n.resource;e.target=A.Editor;const s=this._instantiationService.createInstance(Ae,t,e);return this._registerInstance(i,s,e),s.resource}getInputFromResource(e){const t=this._editorInputs.get(e.path);if(!t)throw new Error(`Could not get input from resource: ${e.path}`);return t}_registerInstance(e,t,i){this._editorInputs.set(e,t),this._instanceDisposables.set(e,[i.onDidFocus(this._onDidFocusInstance.fire,this._onDidFocusInstance),i.onDisposed(this._onDidDisposeInstance.fire,this._onDidDisposeInstance),i.capabilities.onDidAddCapability(()=>this._onDidChangeInstanceCapability.fire(i)),i.capabilities.onDidRemoveCapability(()=>this._onDidChangeInstanceCapability.fire(i))]),this.instances.push(i),this._onDidChangeInstances.fire()}_removeInstance(e){const t=e.resource.path;this._editorInputs.delete(t);const i=this.instances.findIndex(s=>s===e);i!==-1&&this.instances.splice(i,1);const n=this._instanceDisposables.get(t);this._instanceDisposables.delete(t),n&&ee(n),this._onDidChangeInstances.fire()}getInstanceFromResource(e){return eo(this.instances,e)}splitInstance(e,t={}){var s;if(e.target===A.Editor){const o=(s=this._editorInputs.get(e.resource.path))==null?void 0:s.group;o&&this._editorGroupsService.activateGroup(o)}const i=this._terminalInstanceService.createInstance(t,A.Editor),n=this.resolveResource(i);return n&&this._editorService.openEditor({resource:L.revive(n),description:i.description,options:{pinned:!0,forceReload:!0}},Nn),i}reviveInput(e){if("pid"in e){const t={...e,findRevivedId:!0},i=this._terminalInstanceService.createInstance({attachPersistentProcess:t},A.Editor),n=this._instantiationService.createInstance(Ae,i.resource,i);return this._registerInstance(i.resource.path,n,i),n}else throw new Error(`Could not revive terminal editor input, ${e}`)}detachInstance(e){const t=e.resource.path,i=this._editorInputs.get(t);i==null||i.detachInstance(),this._removeInstance(e),this._isShuttingDown||i==null||i.dispose()}async revealActiveEditor(e){var n;const t=this.activeInstance;if(!t||((n=this._activeOpenEditorRequest)==null?void 0:n.instanceId)===t.instanceId)return;const i=this._editorInputs.get(t.resource.path);this._editorService.openEditor(i,{pinned:!0,forceReload:!0,preserveFocus:e,activation:Ph.PRESERVE})}};dr=w([d(0,_t),d(1,Nr),d(2,He),d(3,B),d(4,Hn),d(5,me)],dr);let ur=class extends H{get onDidChange(){return this._onDidChange}constructor(e,t,i){super(),this._container=e,this.orientation=t,this._layoutService=i,this._splitViewDisposables=this._register(new mt),this._children=[],this._terminalToPane=new Map,this._onDidChange=Q.None,this._width=this._container.offsetWidth,this._height=this._container.offsetHeight,this._createSplitView(),this._splitView.layout(this.orientation===1?this._width:this._height)}_createSplitView(){this._splitView=new Sa(this._container,{orientation:this.orientation}),this._splitViewDisposables.clear(),this._splitViewDisposables.add(this._splitView.onDidSashReset(()=>this._splitView.distributeViewSizes()))}split(e,t){this._addChild(e,t)}resizePane(e,t,i,n){const s=t===0||t===1;if(s&&this.orientation!==1||!s&&this.orientation!==0){(this.orientation===1&&t===3||this.orientation===0&&t===1)&&(i*=-1),this._layoutService.resizePart(n,i,i);return}if(this._children.length<=1)return;const o=[];for(let h=0;h<this._splitView.length;h++)o.push(this._splitView.getViewSize(h));const a=e!==this._children.length-1,l=a?e+1:e-1;(a&&t===0||!a&&t===1||a&&t===2||!a&&t===3)&&(i*=-1),o[e]+i<80?i=80-o[e]:o[l]-i<80&&(i=o[l]-80),o[e]+=i,o[l]-=i;for(let h=0;h<this._splitView.length-1;h++)this._splitView.resizeView(h,o[h])}resizePanes(e){if(this._children.length<=1)return;e[e.length-1]+=1-e.reduce((i,n)=>i+n,0);let t=0;for(let i=0;i<this._splitView.length;i++)t+=this._splitView.getViewSize(i);for(let i=0;i<this._splitView.length;i++)this._splitView.resizeView(i,t*e[i])}getPaneSize(e){const t=this._terminalToPane.get(e);if(!t)return 0;const i=this._children.indexOf(t);return this._splitView.getViewSize(i)}_addChild(e,t){const i=new mu(e,this.orientation===1?this._height:this._width);i.orientation=this.orientation,typeof t=="number"?this._children.splice(t,0,i):this._children.push(i),this._terminalToPane.set(e,this._children[this._children.indexOf(i)]),this._withDisabledLayout(()=>this._splitView.addView(i,vn.Distribute,t)),this.layout(this._width,this._height),this._onDidChange=Q.any(...this._children.map(n=>n.onDidChange))}remove(e){let t=null;for(let i=0;i<this._children.length;i++)this._children[i].instance===e&&(t=i);t!==null&&(this._children.splice(t,1),this._terminalToPane.delete(e),this._splitView.removeView(t,vn.Distribute),e.detachFromElement())}layout(e,t){this._width=e,this._height=t,this.orientation===1?(this._children.forEach(i=>i.orthogonalLayout(t)),this._splitView.layout(e)):(this._children.forEach(i=>i.orthogonalLayout(e)),this._splitView.layout(t))}setOrientation(e){if(this.orientation!==e){for(this.orientation=e;this._container.children.length>0;)this._container.removeChild(this._container.children[0]);this._splitViewDisposables.clear(),this._splitView.dispose(),this._createSplitView(),this._withDisabledLayout(()=>{this._children.forEach(t=>{t.orientation=e,this._splitView.addView(t,1)})})}}_withDisabledLayout(e){this._children.forEach(t=>t.instance.disableLayout=!0),e(),this._children.forEach(t=>t.instance.disableLayout=!1)}};ur=w([d(2,Gn)],ur);class mu{get onDidChange(){return this._onDidChange}constructor(e,t){this.instance=e,this.orthogonalSize=t,this.minimumSize=80,this.maximumSize=Number.MAX_VALUE,this._onDidChange=Q.None,this.element=document.createElement("div"),this.element.className="terminal-split-pane",this.instance.attachToElement(this.element)}layout(e){!e||!this.orthogonalSize||(this.orientation===0?this.instance.layout({width:this.orthogonalSize,height:e}):this.instance.layout({width:e,height:this.orthogonalSize}))}orthogonalLayout(e){this.orthogonalSize=e}}let mr=class extends H{get terminalInstances(){return this._terminalInstances}constructor(e,t,i,n,s,o,a){super(),this._container=e,this._terminalService=i,this._terminalInstanceService=n,this._layoutService=s,this._viewDescriptorService=o,this._instantiationService=a,this._terminalInstances=[],this._panelPosition=2,this._terminalLocation=1,this._instanceDisposables=new Map,this._activeInstanceIndex=-1,this._onDidDisposeInstance=this._register(new b),this.onDidDisposeInstance=this._onDidDisposeInstance.event,this._onDidFocusInstance=this._register(new b),this.onDidFocusInstance=this._onDidFocusInstance.event,this._onDidChangeInstanceCapability=this._register(new b),this.onDidChangeInstanceCapability=this._onDidChangeInstanceCapability.event,this._onDisposed=this._register(new b),this.onDisposed=this._onDisposed.event,this._onInstancesChanged=this._register(new b),this.onInstancesChanged=this._onInstancesChanged.event,this._onDidChangeActiveInstance=new b,this.onDidChangeActiveInstance=this._onDidChangeActiveInstance.event,this._onPanelOrientationChanged=new b,this.onPanelOrientationChanged=this._onPanelOrientationChanged.event,t&&this.addInstance(t),this._container&&this.attachToElement(this._container),this._onPanelOrientationChanged.fire(this._terminalLocation===1&&this._panelPosition===2?1:0)}addInstance(e,t){let i;const n=t?this._terminalInstances.findIndex(s=>s.instanceId===t):this._activeInstanceIndex;"instanceId"in e?i=e:i=this._terminalInstanceService.createInstance(e,A.Panel),this._terminalInstances.length===0?(this._terminalInstances.push(i),this._activeInstanceIndex=0):this._terminalInstances.splice(n+1,0,i),this._initInstanceListeners(i),this._splitPaneContainer&&this._splitPaneContainer.split(i,n+1),this._onInstancesChanged.fire()}dispose(){super.dispose(),this._container&&this._groupElement&&(this._container.removeChild(this._groupElement),this._groupElement=void 0),this._terminalInstances=[],this._onInstancesChanged.fire()}get activeInstance(){if(this._terminalInstances.length!==0)return this._terminalInstances[this._activeInstanceIndex]}getLayoutInfo(e){const t=this.terminalInstances.filter(n=>typeof n.persistentProcessId=="number"&&n.shouldPersist),i=t.map(n=>{var s;return((s=this._splitPaneContainer)==null?void 0:s.getPaneSize(n))||0}).reduce((n,s)=>n+=s,0);return{isActive:e,activePersistentProcessId:this.activeInstance?this.activeInstance.persistentProcessId:void 0,terminals:t.map(n=>({relativeSize:i>0?this._splitPaneContainer.getPaneSize(n)/i:0,terminal:n.persistentProcessId||0}))}}_initInstanceListeners(e){this._instanceDisposables.set(e.instanceId,[e.onDisposed(t=>{this._onDidDisposeInstance.fire(t),this._handleOnDidDisposeInstance(t)}),e.onDidFocus(t=>{this._setActiveInstance(t),this._onDidFocusInstance.fire(t)}),e.capabilities.onDidAddCapability(()=>this._onDidChangeInstanceCapability.fire(e)),e.capabilities.onDidRemoveCapability(()=>this._onDidChangeInstanceCapability.fire(e))])}_handleOnDidDisposeInstance(e){this._removeInstance(e)}removeInstance(e){this._removeInstance(e);const t=this._instanceDisposables.get(e.instanceId);t&&(ee(t),this._instanceDisposables.delete(e.instanceId))}_removeInstance(e){var n,s;const t=this._terminalInstances.indexOf(e);if(t===-1)return;const i=e===this.activeInstance;if(this._terminalInstances.splice(t,1),i&&this._terminalInstances.length>0){const o=t<this._terminalInstances.length?t:this._terminalInstances.length-1;this.setActiveInstanceByIndex(o),(n=this.activeInstance)==null||n.focus(!0)}else t<this._activeInstanceIndex&&this._activeInstanceIndex--;(s=this._splitPaneContainer)==null||s.remove(e),this._terminalInstances.length===0?(this._onDisposed.fire(this),this.dispose()):this._onInstancesChanged.fire()}moveInstance(e,t){const i=this.terminalInstances.indexOf(e);i!==-1&&(this._terminalInstances.splice(i,1),this._terminalInstances.splice(t,0,e),this._splitPaneContainer&&(this._splitPaneContainer.remove(e),this._splitPaneContainer.split(e,t)),this._onInstancesChanged.fire())}_setActiveInstance(e){this.setActiveInstanceByIndex(this._getIndexFromId(e.instanceId))}_getIndexFromId(e){let t=-1;if(this.terminalInstances.forEach((i,n)=>{i.instanceId===e&&(t=n)}),t===-1)throw new Error(`Terminal with ID ${e} does not exist (has it already been disposed?)`);return t}setActiveInstanceByIndex(e,t){if(e<0||e>=this._terminalInstances.length)return;const i=this.activeInstance;this._activeInstanceIndex=e,(i!==this.activeInstance||t)&&(this._onInstancesChanged.fire(),this._onDidChangeActiveInstance.fire(this.activeInstance))}attachToElement(e){if(this._container=e,this._groupElement||(this._groupElement=document.createElement("div"),this._groupElement.classList.add("terminal-group")),this._container.appendChild(this._groupElement),!this._splitPaneContainer){this._panelPosition=this._layoutService.getPanelPosition(),this._terminalLocation=this._viewDescriptorService.getViewLocationById(K);const t=this._terminalLocation===1&&this._panelPosition===2?1:0;this._splitPaneContainer=this._instantiationService.createInstance(ur,this._groupElement,t),this.terminalInstances.forEach(i=>this._splitPaneContainer.split(i,this._activeInstanceIndex+1)),this._initialRelativeSizes&&(this.resizePanes(this._initialRelativeSizes),this._initialRelativeSizes=void 0)}}get title(){if(this._terminalInstances.length===0)return"";let e=this.terminalInstances[0].title+this._getBellTitle(this.terminalInstances[0]);this.terminalInstances[0].description&&(e+=` (${this.terminalInstances[0].description})`);for(let t=1;t<this.terminalInstances.length;t++){const i=this.terminalInstances[t];i.title&&(e+=`, ${i.title+this._getBellTitle(i)}`,i.description&&(e+=` (${i.description})`))}return e}_getBellTitle(e){return this._terminalService.configHelper.config.enableBell&&e.statusList.statuses.some(t=>t.id==="bell")?"*":""}setVisible(e){this._groupElement&&(this._groupElement.style.display=e?"":"none"),this.terminalInstances.forEach(t=>t.setVisible(e))}split(e){const t=this._terminalInstanceService.createInstance(e,A.Panel);return this.addInstance(t,e.parentTerminalId),this._setActiveInstance(t),t}addDisposable(e){this._register(e)}layout(e,t){if(this._splitPaneContainer){const i=this._layoutService.getPanelPosition(),n=this._viewDescriptorService.getViewLocationById(K);if(i!==this._panelPosition||n!==this._terminalLocation){const o=n===1&&i===2?1:0;this._splitPaneContainer.setOrientation(o),this._panelPosition=i,this._terminalLocation=n,this._onPanelOrientationChanged.fire(this._splitPaneContainer.orientation)}this._splitPaneContainer.layout(e,t)}}focusPreviousPane(){const e=this._activeInstanceIndex===0?this._terminalInstances.length-1:this._activeInstanceIndex-1;this.setActiveInstanceByIndex(e)}focusNextPane(){const e=this._activeInstanceIndex===this._terminalInstances.length-1?0:this._activeInstanceIndex+1;this.setActiveInstanceByIndex(e)}resizePane(e){if(!this._splitPaneContainer)return;const t=e===0||e===1,i=this._terminalService.configHelper.getFont(),n=t?i.charWidth:i.charHeight;n&&this._splitPaneContainer.resizePane(this._activeInstanceIndex,e,n*4,id(this._terminalLocation))}resizePanes(e){if(!this._splitPaneContainer){this._initialRelativeSizes=e;return}this._splitPaneContainer.resizePanes(e)}};mr=w([d(2,J),d(3,He),d(4,Gn),d(5,Hi),d(6,B)],mr);let gr=class extends H{get instances(){return this.groups.reduce((e,t)=>e.concat(t.terminalInstances),[])}constructor(e,t,i,n,s){super(),this._contextKeyService=e,this._instantiationService=t,this._viewsService=i,this._viewDescriptorService=n,this._configurationService=s,this.groups=[],this.activeGroupIndex=-1,this._onDidChangeActiveGroup=new b,this.onDidChangeActiveGroup=this._onDidChangeActiveGroup.event,this._onDidDisposeGroup=new b,this.onDidDisposeGroup=this._onDidDisposeGroup.event,this._onDidChangeGroups=new b,this.onDidChangeGroups=this._onDidChangeGroups.event,this._onDidShow=new b,this.onDidShow=this._onDidShow.event,this._onDidDisposeInstance=new b,this.onDidDisposeInstance=this._onDidDisposeInstance.event,this._onDidFocusInstance=new b,this.onDidFocusInstance=this._onDidFocusInstance.event,this._onDidChangeActiveInstance=new b,this.onDidChangeActiveInstance=this._onDidChangeActiveInstance.event,this._onDidChangeInstances=new b,this.onDidChangeInstances=this._onDidChangeInstances.event,this._onDidChangeInstanceCapability=new b,this.onDidChangeInstanceCapability=this._onDidChangeInstanceCapability.event,this._onDidChangePanelOrientation=new b,this.onDidChangePanelOrientation=this._onDidChangePanelOrientation.event,this.onDidDisposeGroup(o=>this._removeGroup(o)),this._terminalGroupCountContextKey=u.groupCount.bindTo(this._contextKeyService),this.onDidChangeGroups(()=>this._terminalGroupCountContextKey.set(this.groups.length)),Q.any(this.onDidChangeActiveGroup,this.onDidChangeInstances)(()=>this.updateVisibility())}hidePanel(){const e=this._viewDescriptorService.getViewContainerByViewId(K);e&&this._viewDescriptorService.getViewContainerModel(e).activeViewDescriptors.length===1&&(this._viewsService.closeView(K),u.tabsMouse.bindTo(this._contextKeyService).set(!1))}showTabs(){this._configurationService.updateValue("terminal.integrated.tabs.enabled",!0)}get activeGroup(){if(!(this.activeGroupIndex<0||this.activeGroupIndex>=this.groups.length))return this.groups[this.activeGroupIndex]}set activeGroup(e){if(e===void 0)return;const t=this.groups.findIndex(i=>i===e);this.setActiveGroupByIndex(t)}get activeInstance(){var e;return(e=this.activeGroup)==null?void 0:e.activeInstance}setActiveInstance(e){this.setActiveInstanceByIndex(this._getIndexFromId(e.instanceId))}_getIndexFromId(e){const t=this.instances.findIndex(i=>i.instanceId===e);if(t===-1)throw new Error(`Terminal with ID ${e} does not exist (has it already been disposed?)`);return t}setContainer(e){this._container=e,this.groups.forEach(t=>t.attachToElement(e))}async focusTabs(){var t;if(this.instances.length===0)return;await this.showPanel(!0);const e=this._viewsService.getActiveViewWithId(K);(t=e==null?void 0:e.terminalTabbedView)==null||t.focusTabs()}async focusHover(){var t;if(this.instances.length===0)return;const e=this._viewsService.getActiveViewWithId(K);(t=e==null?void 0:e.terminalTabbedView)==null||t.focusHover()}async focusActiveInstance(){return this.showPanel(!0)}createGroup(e){const t=this._instantiationService.createInstance(mr,this._container,e);return t.onPanelOrientationChanged(i=>this._onDidChangePanelOrientation.fire(i)),this.groups.push(t),t.addDisposable(t.onDidDisposeInstance(this._onDidDisposeInstance.fire,this._onDidDisposeInstance)),t.addDisposable(t.onDidFocusInstance(this._onDidFocusInstance.fire,this._onDidFocusInstance)),t.addDisposable(t.onDidChangeActiveInstance(i=>{t===this.activeGroup&&this._onDidChangeActiveInstance.fire(i)})),t.addDisposable(t.onDidChangeInstanceCapability(this._onDidChangeInstanceCapability.fire,this._onDidChangeInstanceCapability)),t.addDisposable(t.onInstancesChanged(this._onDidChangeInstances.fire,this._onDidChangeInstances)),t.addDisposable(t.onDisposed(this._onDidDisposeGroup.fire,this._onDidDisposeGroup)),t.terminalInstances.length>0&&this._onDidChangeInstances.fire(),this.instances.length===1&&this.setActiveInstanceByIndex(0),this._onDidChangeGroups.fire(),t}async showPanel(e){const t=this._viewsService.getActiveViewWithId(K)??await this._viewsService.openView(K,e);if(t==null||t.setExpanded(!0),e){await Pt(0);const i=this.activeInstance;i&&(t&&!t.isVisible()&&await this._viewsService.openView(K,e),await i.focusWhenReady(!0))}this._onDidShow.fire()}getInstanceFromResource(e){return eo(this.instances,e)}_removeGroup(e){var s;const t=this.activeGroup,i=e===t,n=this.groups.indexOf(e);if(n!==-1&&(this.groups.splice(n,1),this._onDidChangeGroups.fire()),i){if(this.groups.length>0){const o=n<this.groups.length?n:this.groups.length-1;this.setActiveGroupByIndex(o,!0),(s=this.activeInstance)==null||s.focus(!0)}}else this.activeGroupIndex>n&&this.setActiveGroupByIndex(this.activeGroupIndex-1);this.activeGroupIndex>=this.groups.length&&this.setActiveGroupByIndex(this.groups.length-1),this._onDidChangeInstances.fire(),this._onDidChangeGroups.fire(),i&&(this._onDidChangeActiveGroup.fire(this.activeGroup),this._onDidChangeActiveInstance.fire(this.activeInstance))}setActiveGroupByIndex(e,t){if(e===-1&&this.groups.length===0){this.activeGroupIndex!==-1&&(this.activeGroupIndex=-1,this._onDidChangeActiveGroup.fire(this.activeGroup),this._onDidChangeActiveInstance.fire(this.activeInstance));return}if(e<0||e>=this.groups.length)return;const i=this.activeGroup;this.activeGroupIndex=e,(t||i!==this.activeGroup)&&(this._onDidChangeActiveGroup.fire(this.activeGroup),this._onDidChangeActiveInstance.fire(this.activeInstance))}_getInstanceLocation(e){let t=0;for(;e>=0&&t<this.groups.length;){const i=this.groups[t],n=i.terminalInstances.length;if(e<n)return{group:i,groupIndex:t,instance:i.terminalInstances[e],instanceIndex:e};e-=n,t++}}setActiveInstanceByIndex(e){const t=this.activeInstance,i=this._getInstanceLocation(e),n=i==null?void 0:i.group.terminalInstances[i.instanceIndex];if(!i||t===n)return;const s=i.instanceIndex;this.activeGroupIndex=i.groupIndex,this._onDidChangeActiveGroup.fire(this.activeGroup),i.group.setActiveInstanceByIndex(s,!0)}setActiveGroupToNext(){if(this.groups.length<=1)return;let e=this.activeGroupIndex+1;e>=this.groups.length&&(e=0),this.setActiveGroupByIndex(e)}setActiveGroupToPrevious(){if(this.groups.length<=1)return;let e=this.activeGroupIndex-1;e<0&&(e=this.groups.length-1),this.setActiveGroupByIndex(e)}moveGroup(e,t){const i=this.getGroupForInstance(e),n=this.getGroupForInstance(t);if(!i||!n)return;if(i===n){const a=i.terminalInstances.indexOf(t);a!==-1&&i.moveInstance(e,a);return}const s=this.groups.indexOf(i),o=this.groups.indexOf(n);this.groups.splice(s,1),this.groups.splice(o,0,i),this._onDidChangeInstances.fire()}moveGroupToEnd(e){const t=this.getGroupForInstance(e);if(!t)return;const i=this.groups.indexOf(t);this.groups.splice(i,1),this.groups.push(t),this._onDidChangeInstances.fire()}moveInstance(e,t,i){const n=this.getGroupForInstance(e),s=this.getGroupForInstance(t);if(!n||!s)return;n!==s&&(n.removeInstance(e),s.addInstance(e));const o=s.terminalInstances.indexOf(t)+(i==="after"?1:0);s.moveInstance(e,o)}unsplitInstance(e){const t=this.getGroupForInstance(e);!t||t.terminalInstances.length<2||(t.removeInstance(e),this.createGroup(e))}joinInstances(e){const t=this.getGroupForInstance(e[0]);if(t){let o=!0;for(let a=1;a<t.terminalInstances.length;a++)if(t.terminalInstances.includes(e[a])){o=!1;break}if(!o)return}let i,n;for(const o of e){const a=this.getGroupForInstance(o);if((a==null?void 0:a.terminalInstances.length)===1){i=o,n=a;break}}n||(n=this.createGroup());const s=this.activeGroup===n;for(const o of e){if(o===i)continue;const a=this.getGroupForInstance(o);a&&(a.removeInstance(o),n.addInstance(o))}this.setActiveInstance(e[0]),this._onDidChangeInstances.fire(),s||this._onDidChangeActiveGroup.fire(this.activeGroup)}instanceIsSplit(e){const t=this.getGroupForInstance(e);return t?t.terminalInstances.length>1:!1}getGroupForInstance(e){return this.groups.find(t=>t.terminalInstances.includes(e))}getGroupLabels(){return this.groups.filter(e=>e.terminalInstances.length>0).map((e,t)=>`${t+1}: ${e.title?e.title:""}`)}updateVisibility(){const e=this._viewsService.isViewVisible(K);this.groups.forEach((t,i)=>t.setVisible(e&&i===this.activeGroupIndex))}};gr=w([d(0,me),d(1,B),d(2,zr),d(3,Hi),d(4,X)],gr);let pr=class extends H{get onDidCreateInstance(){return this._onDidCreateInstance.event}constructor(e,t,i){super(),this._instantiationService=e,this._contextKeyService=t,this._environmentService=i,this._backendRegistration=new Map,this._onDidCreateInstance=new b,this._terminalShellTypeContextKey=u.shellType.bindTo(this._contextKeyService),this._terminalInRunCommandPicker=u.inTerminalRunCommandPicker.bindTo(this._contextKeyService),this._terminalSuggestWidgetVisibleContextKey=u.suggestWidgetVisible.bindTo(this._contextKeyService),this._configHelper=e.createInstance(Fn);for(const n of[void 0,i.remoteAuthority]){let s;const o=new Promise(a=>s=a);this._backendRegistration.set(n,{promise:o,resolve:s})}}createInstance(e,t){const i=this.convertProfileToShellLaunchConfig(e),n=this._instantiationService.createInstance(Pe,this._terminalShellTypeContextKey,this._terminalInRunCommandPicker,this._terminalSuggestWidgetVisibleContextKey,this._configHelper,i);return n.target=t,this._onDidCreateInstance.fire(n),n}convertProfileToShellLaunchConfig(e,t){if(e&&"profileName"in e){const i=e;return i.path?{executable:i.path,args:i.args,env:i.env,icon:i.icon,color:i.color,name:i.overrideName?i.profileName:void 0,cwd:t}:e}return e?(t&&(e.cwd=t),e):{}}async getBackend(e){var i;let t=fe.as(pi.Backend).getTerminalBackend(e);return t||(await((i=this._backendRegistration.get(e))==null?void 0:i.promise),t=fe.as(pi.Backend).getTerminalBackend(e)),t}getRegisteredBackends(){return fe.as(pi.Backend).backends.values()}didRegisterBackend(e){var t;(t=this._backendRegistration.get(e))==null||t.resolve()}};pr=w([d(0,B),d(1,me),d(2,si)],pr);const Ja={type:["string","null"],enum:["terminal.ansiBlack","terminal.ansiRed","terminal.ansiGreen","terminal.ansiYellow","terminal.ansiBlue","terminal.ansiMagenta","terminal.ansiCyan","terminal.ansiWhite"],default:null},Za={type:"string",enum:Array.from(Ds(),r=>r.id),markdownEnumDescriptions:Array.from(Ds(),r=>`$(${r.id})`)},Kt={args:{description:c("terminalProfile.args","An optional set of arguments to run the shell executable with."),type:"array",items:{type:"string"}},overrideName:{description:c("terminalProfile.overrideName","Controls whether or not the profile name overrides the auto detected one."),type:"boolean"},icon:{description:c("terminalProfile.icon","A codicon ID to associate with the terminal icon."),...Za},color:{description:c("terminalProfile.color","A theme color ID to associate with the terminal icon."),...Ja},env:{markdownDescription:c("terminalProfile.env","An object with environment variables that will be added to the terminal profile process. Set to `null` to delete environment variables from the base environment."),type:"object",additionalProperties:{type:["string","null"]},default:{}}},_s={type:"object",required:["path"],properties:{path:{description:c("terminalProfile.path","A single path to a shell executable or an array of paths that will be used as fallbacks when one fails."),type:["string","array"],items:{type:"string"}},...Kt}},vs={type:"object",required:["path"],properties:{path:{description:c("terminalAutomationProfile.path","A single path to a shell executable."),type:["string"],items:{type:"string"}},...Kt}};function bs(r){const e=r===2?"linux":r===1?"osx":"windows";return c({key:"terminal.integrated.profile",comment:["{0} is the platform, {1} is a code block, {2} and {3} are a link start and end"]},`A set of terminal profile customizations for {0} which allows adding, removing or changing how terminals are launched. Profiles are made up of a mandatory path, optional arguments and other presentation options.

To override an existing profile use its profile name as the key, for example:

{1}

{2}Read more about configuring profiles{3}.`,Ah(r),'```json\n"terminal.integrated.profile.'+e+'": {\n  "bash": null\n}\n```',"[","](https://code.visualstudio.com/docs/terminal/profiles)")}const gu={id:"terminal",order:100,title:c("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{"terminal.integrated.automationProfile.linux":{restricted:!0,markdownDescription:c("terminal.integrated.automationProfile.linux","The terminal profile to use on Linux for automation-related terminal usage like tasks and debug."),type:["object","null"],default:null,anyOf:[{type:"null"},vs],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.automationProfile.osx":{restricted:!0,markdownDescription:c("terminal.integrated.automationProfile.osx","The terminal profile to use on macOS for automation-related terminal usage like tasks and debug."),type:["object","null"],default:null,anyOf:[{type:"null"},vs],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.automationProfile.windows":{restricted:!0,markdownDescription:c("terminal.integrated.automationProfile.windows","The terminal profile to use for automation-related terminal usage like tasks and debug. This setting will currently be ignored if {0} (now deprecated) is set.","`terminal.integrated.automationShell.windows`"),type:["object","null"],default:null,anyOf:[{type:"null"},vs],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.profiles.windows":{restricted:!0,markdownDescription:bs(3),type:"object",default:{PowerShell:{source:"PowerShell",icon:"terminal-powershell"},"Command Prompt":{path:["${env:windir}\\Sysnative\\cmd.exe","${env:windir}\\System32\\cmd.exe"],args:[],icon:"terminal-cmd"},"Git Bash":{source:"Git Bash"}},additionalProperties:{anyOf:[{type:"object",required:["source"],properties:{source:{description:c("terminalProfile.windowsSource","A profile source that will auto detect the paths to the shell. Note that non-standard executable locations are not supported and must be created manually in a new profile."),enum:["PowerShell","Git Bash"]},...Kt}},{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:c("terminalProfile.windowsExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:c("terminalProfile.windowsExtensionId","The id of the extension terminal"),type:"string"},title:{description:c("terminalProfile.windowsExtensionTitle","The name of the extension terminal"),type:"string"},...Kt}},{type:"null"},_s]}},"terminal.integrated.profiles.osx":{restricted:!0,markdownDescription:bs(1),type:"object",default:{bash:{path:"bash",args:["-l"],icon:"terminal-bash"},zsh:{path:"zsh",args:["-l"]},fish:{path:"fish",args:["-l"]},tmux:{path:"tmux",icon:"terminal-tmux"},pwsh:{path:"pwsh",icon:"terminal-powershell"}},additionalProperties:{anyOf:[{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:c("terminalProfile.osxExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:c("terminalProfile.osxExtensionId","The id of the extension terminal"),type:"string"},title:{description:c("terminalProfile.osxExtensionTitle","The name of the extension terminal"),type:"string"},...Kt}},{type:"null"},_s]}},"terminal.integrated.profiles.linux":{restricted:!0,markdownDescription:bs(2),type:"object",default:{bash:{path:"bash",icon:"terminal-bash"},zsh:{path:"zsh"},fish:{path:"fish"},tmux:{path:"tmux",icon:"terminal-tmux"},pwsh:{path:"pwsh",icon:"terminal-powershell"}},additionalProperties:{anyOf:[{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:c("terminalProfile.linuxExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:c("terminalProfile.linuxExtensionId","The id of the extension terminal"),type:"string"},title:{description:c("terminalProfile.linuxExtensionTitle","The name of the extension terminal"),type:"string"},...Kt}},{type:"null"},_s]}},"terminal.integrated.useWslProfiles":{description:c("terminal.integrated.useWslProfiles","Controls whether or not WSL distros are shown in the terminal dropdown"),type:"boolean",default:!0},"terminal.integrated.inheritEnv":{scope:1,description:c("terminal.integrated.inheritEnv","Whether new shells should inherit their environment from VS Code, which may source a login shell to ensure $PATH and other development variables are initialized. This has no effect on Windows."),type:"boolean",default:!0},"terminal.integrated.persistentSessionScrollback":{scope:1,markdownDescription:c("terminal.integrated.persistentSessionScrollback","Controls the maximum amount of lines that will be restored when reconnecting to a persistent terminal session. Increasing this will restore more lines of scrollback at the cost of more memory and increase the time it takes to connect to terminals on start up. This setting requires a restart to take effect and should be set to a value less than or equal to `#terminal.integrated.scrollback#`."),type:"number",default:100},"terminal.integrated.showLinkHover":{scope:1,description:c("terminal.integrated.showLinkHover","Whether to show hovers for links in the terminal output."),type:"boolean",default:!0},"terminal.integrated.ignoreProcessNames":{description:c("terminal.integrated.confirmIgnoreProcesses","A set of process names to ignore when using the {0} setting.","`terminal.integrated.confirmOnKill`"),type:"array",items:{type:"string",uniqueItems:!0},default:["starship","oh-my-posh","bash","zsh"]}}};function pu(){fe.as(Yr.Configuration).registerConfiguration(gu),ec()}let ws;function ec(r,e){const t=fe.as(Yr.Configuration);let i;r&&(i=Ra(r==null?void 0:r.profiles,e));const n=ws;ws={id:"terminal",order:100,title:c("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{"terminal.integrated.defaultProfile.linux":{restricted:!0,markdownDescription:c("terminal.integrated.defaultProfile.linux","The default terminal profile on Linux."),type:["string","null"],default:null,enum:(r==null?void 0:r.os)===3?i==null?void 0:i.values:void 0,markdownEnumDescriptions:(r==null?void 0:r.os)===3?i==null?void 0:i.markdownDescriptions:void 0},"terminal.integrated.defaultProfile.osx":{restricted:!0,markdownDescription:c("terminal.integrated.defaultProfile.osx","The default terminal profile on macOS."),type:["string","null"],default:null,enum:(r==null?void 0:r.os)===2?i==null?void 0:i.values:void 0,markdownEnumDescriptions:(r==null?void 0:r.os)===2?i==null?void 0:i.markdownDescriptions:void 0},"terminal.integrated.defaultProfile.windows":{restricted:!0,markdownDescription:c("terminal.integrated.defaultProfile.windows","The default terminal profile on Windows."),type:["string","null"],default:null,enum:(r==null?void 0:r.os)===1?i==null?void 0:i.values:void 0,markdownEnumDescriptions:(r==null?void 0:r.os)===1?i==null?void 0:i.markdownDescriptions:void 0}}},t.updateConfigurations({add:[ws],remove:n?[n]:[]})}let Mi=class{get onDidChangeAvailableProfiles(){return this._onDidChangeAvailableProfiles.event}get profilesReady(){return this._profilesReadyBarrier.wait().then(()=>{})}get availableProfiles(){return this._platformConfigJustRefreshed||this.refreshAvailableProfiles(),this._availableProfiles||[]}get contributedProfiles(){return this._contributedProfiles||[]}constructor(e,t,i,n,s,o,a){this._contextKeyService=e,this._configurationService=t,this._terminalContributionService=i,this._extensionService=n,this._remoteAgentService=s,this._environmentService=o,this._terminalInstanceService=a,this._contributedProfiles=[],this._platformConfigJustRefreshed=!1,this._profileProviders=new Map,this._onDidChangeAvailableProfiles=new b,this._extensionService.onDidChangeExtensions(()=>this.refreshAvailableProfiles()),this._webExtensionContributedProfileContextKey=u.webExtensionContributedProfile.bindTo(this._contextKeyService),this._updateWebContextKey(),this._profilesReadyBarrier=new ks(2e4),this.refreshAvailableProfiles(),this._setupConfigListener()}async _setupConfigListener(){const e=await this.getPlatformKey();this._configurationService.onDidChangeConfiguration(async t=>{(t.affectsConfiguration("terminal.integrated.defaultProfile."+e)||t.affectsConfiguration("terminal.integrated.profiles."+e)||t.affectsConfiguration("terminal.integrated.useWslProfiles"))&&(t.source!==7?(this.refreshAvailableProfiles(),this._platformConfigJustRefreshed=!1):this._platformConfigJustRefreshed=!0)})}getDefaultProfileName(){return this._defaultProfileName}getDefaultProfile(e){let t;if(e){if(t=this._configurationService.getValue(`terminal.integrated.defaultProfile.${this._getOsKey(e)}`),!t||typeof t!="string")return}else t=this._defaultProfileName;if(t)return this.availableProfiles.find(i=>i.profileName===t&&!i.isAutoDetected)}_getOsKey(e){switch(e){case 3:return"linux";case 2:return"osx";case 1:return"windows"}}refreshAvailableProfiles(){this._refreshAvailableProfilesNow()}async _refreshAvailableProfilesNow(){const e=await this._detectProfiles(!0),t=!Ps(e,this._availableProfiles,fu),i=await this._updateContributedProfiles();(t||i)&&(this._availableProfiles=e,this._onDidChangeAvailableProfiles.fire(this._availableProfiles),this._profilesReadyBarrier.open(),this._updateWebContextKey(),await this._refreshPlatformConfig(this._availableProfiles))}async _updateContributedProfiles(){const e=await this.getPlatformKey(),t=[],i=this._configurationService.getValue("terminal.integrated.profiles."+e);for(const[o,a]of Object.entries(i))a===null&&t.push(o);const n=Array.from(this._terminalContributionService.terminalProfiles.filter(o=>!t.includes(o.title))),s=!Ps(n,this._contributedProfiles,_u);return this._contributedProfiles=n,s}getContributedProfileProvider(e,t){const i=this._profileProviders.get(e);return i==null?void 0:i.get(t)}async _detectProfiles(e){const t=await this._terminalInstanceService.getBackend(this._environmentService.remoteAuthority);if(!t)return this._availableProfiles||[];const i=await this.getPlatformKey();return this._defaultProfileName=this._configurationService.getValue(`terminal.integrated.defaultProfile.${i}`)??void 0,t.getProfiles(this._configurationService.getValue(`terminal.integrated.profiles.${i}`),this._defaultProfileName,e)}_updateWebContextKey(){this._webExtensionContributedProfileContextKey.set(Jt&&this._contributedProfiles.length>0)}async _refreshPlatformConfig(e){const t=await this._remoteAgentService.getEnvironment();ec({os:(t==null?void 0:t.os)||Ye,profiles:e},this._contributedProfiles),Ha(e)}async getPlatformKey(){const e=await this._remoteAgentService.getEnvironment();return e?e.os===1?"windows":e.os===2?"osx":"linux":re?"windows":Ee?"osx":"linux"}registerTerminalProfileProvider(e,t,i){let n=this._profileProviders.get(e);return n||(n=new Map,this._profileProviders.set(e,n)),n.set(t,i),Ce(()=>this._profileProviders.delete(t))}async registerContributedProfile(e){const t=await this.getPlatformKey(),i=await this._configurationService.getValue(`terminal.integrated.profiles.${t}`);if(typeof i=="object"){const n={extensionIdentifier:e.extensionIdentifier,icon:e.options.icon,id:e.id,title:e.title,color:e.options.color};i[e.title]=n}await this._configurationService.updateValue(`terminal.integrated.profiles.${t}`,i,2)}async getContributedDefaultProfile(e){if(e&&!e.extHostTerminalId&&!("executable"in e)){const t=await this.getPlatformKey(),i=this._configurationService.getValue(`terminal.integrated.defaultProfile.${t}`);return this.contributedProfiles.find(s=>s.title===i)}}};Mi.__decorator=w([Ca(2e3)],Mi.prototype,"refreshAvailableProfiles",null);Mi=w([d(0,me),d(1,X),d(2,oa),d(3,ue),d(4,et),d(5,si),d(6,He)],Mi);function fu(r,e){return r.profileName===e.profileName&&Ma(r.args,e.args)&&r.color===e.color&&fd(r.icon,e.icon)&&r.isAutoDetected===e.isAutoDetected&&r.isDefault===e.isDefault&&r.overrideName===e.overrideName&&r.path===e.path}function _u(r,e){return r.extensionIdentifier===e.extensionIdentifier&&r.color===e.color&&r.icon===e.icon&&r.id===e.id&&r.title===e.title}class vu{constructor(){this._linkProviders=new Set,this._onDidAddLinkProvider=new b,this._onDidRemoveLinkProvider=new b}get linkProviders(){return this._linkProviders}get onDidAddLinkProvider(){return this._onDidAddLinkProvider.event}get onDidRemoveLinkProvider(){return this._onDidRemoveLinkProvider.event}registerLinkProvider(e){const t=[];return this._linkProviders.add(e),this._onDidAddLinkProvider.fire(e),{dispose:()=>{for(const i of t)i.dispose();this._linkProviders.delete(e),this._onDidRemoveLinkProvider.fire(e)}}}}const Go="Generated";class fr{get defaultProfileName(){return this._defaultProfileName}constructor(e,t,i,n,s,o,a,l){this._context=e,this._configurationService=t,this._configurationResolverService=i,this._historyService=n,this._logService=s,this._terminalProfileService=o,this._workspaceContextService=a,this._remoteAgentService=l,this._iconRegistry=Jn(),this._remoteAgentService.getConnection()?this._remoteAgentService.getEnvironment().then(h=>this._primaryBackendOs=(h==null?void 0:h.os)||Ye):this._primaryBackendOs=Ye,this._configurationService.onDidChangeConfiguration(h=>{(h.affectsConfiguration("terminal.integrated.defaultProfile.windows")||h.affectsConfiguration("terminal.integrated.defaultProfile.osx")||h.affectsConfiguration("terminal.integrated.defaultProfile.linux"))&&this._refreshDefaultProfileName()}),this._terminalProfileService.onDidChangeAvailableProfiles(()=>this._refreshDefaultProfileName())}async _refreshDefaultProfileName(){var e,t;this._primaryBackendOs&&(this._defaultProfileName=(t=await this.getDefaultProfile({remoteAuthority:(e=this._remoteAgentService.getConnection())==null?void 0:e.remoteAuthority,os:this._primaryBackendOs}))==null?void 0:t.profileName)}resolveIcon(e,t){if(e.icon){e.icon=this._getCustomIcon(e.icon)||this.getDefaultIcon();return}if(e.customPtyImplementation){e.icon=this.getDefaultIcon();return}if(e.executable)return;const i=this._getUnresolvedRealDefaultProfile(t);i&&(e.icon=i.icon),e.icon||(e.icon=this.getDefaultIcon())}getDefaultIcon(e){return this._iconRegistry.getIcon(this._configurationService.getValue("terminal.integrated.tabs.defaultIcon",{resource:e}))||k.terminal}async resolveShellLaunchConfig(e,t){let i;e.executable?i=await this._resolveProfile({path:e.executable,args:e.args,profileName:Go,isDefault:!1},t):i=await this.getDefaultProfile(t),e.executable=i.path,e.args=i.args,i.env&&(e.env?e.env={...e.env,...i.env}:e.env=i.env);const n=e===void 0||typeof e.cwd=="string"?void 0:e.cwd;e.icon=this._getCustomIcon(e.icon)||this._getCustomIcon(i.icon)||this.getDefaultIcon(n),i.overrideName&&(e.name=i.profileName),e.color=e.color||i.color||this._configurationService.getValue("terminal.integrated.tabs.defaultColor",{resource:n}),e.useShellEnvironment===void 0&&(e.useShellEnvironment=this._configurationService.getValue("terminal.integrated.inheritEnv"))}async getDefaultShell(e){return(await this.getDefaultProfile(e)).path}async getDefaultShellArgs(e){return(await this.getDefaultProfile(e)).args||[]}async getDefaultProfile(e){return this._resolveProfile(await this._getUnresolvedDefaultProfile(e),e)}getEnvironment(e){return this._context.getEnvironment(e)}_getCustomIcon(e){if(e){if(typeof e=="string")return E.fromId(e);if(E.isThemeIcon(e))return e;if(L.isUri(e)||qe(e))return L.revive(e);if(typeof e=="object"&&"light"in e&&"dark"in e){const t=e;if((L.isUri(t.light)||qe(t.light))&&(L.isUri(t.dark)||qe(t.dark)))return{light:L.revive(t.light),dark:L.revive(t.dark)}}}}async _getUnresolvedDefaultProfile(e){if(e.allowAutomationShell){const i=this._getUnresolvedAutomationShellProfile(e);if(i)return i}await this._terminalProfileService.profilesReady;const t=this._getUnresolvedRealDefaultProfile(e.os);return t?this._setIconForAutomation(e,t):this._setIconForAutomation(e,await this._getUnresolvedFallbackDefaultProfile(e))}_setIconForAutomation(e,t){if(e.allowAutomationShell){const i=So(t);return i.icon=k.tools,i}return t}_getUnresolvedRealDefaultProfile(e){return this._terminalProfileService.getDefaultProfile(e)}async _getUnresolvedFallbackDefaultProfile(e){const t=await this._context.getDefaultSystemShell(e.remoteAuthority,e.os);if(e.os===Ye){let s=this._terminalProfileService.availableProfiles.find(o=>Xi(o.path).name===Xi(t).name);if(s)return e.allowAutomationShell&&(s=So(s),s.icon=k.tools),s}let i;e.os===2&&Xi(t).name.match(/(zsh|bash)/)?i=["--login"]:i=[];const n=this._guessProfileIcon(t);return{profileName:Go,path:t,args:i,icon:n,isDefault:!1}}_getUnresolvedAutomationShellProfile(e){const t=this._configurationService.getValue(`terminal.integrated.automationProfile.${this._getOsKey(e.os)}`);if(this._isValidAutomationProfile(t,e.os))return t.icon=this._getCustomIcon(t.icon)||k.tools,t}async _resolveProfile(e,t){if(t.os===1){const o=await this._context.getEnvironment(t.remoteAuthority),a=!!o.hasOwnProperty("PROCESSOR_ARCHITEW6432"),l=o.windir;if(!a&&l){const h=Is(l,"Sysnative").replace(/\//g,"\\").toLowerCase();e.path&&e.path.toLowerCase().indexOf(h)===0&&(e.path=Is(l,"System32",e.path.substr(h.length+1)))}e.path&&(e.path=e.path.replace(/\//g,"\\"))}const i=await this._context.getEnvironment(t.remoteAuthority),n=this._historyService.getLastActiveWorkspaceRoot(t.remoteAuthority?$.vscodeRemote:$.file),s=n?Qe(this._workspaceContextService.getWorkspaceFolder(n)):void 0;return e.path=await this._resolveVariables(e.path,i,s),e.args&&(typeof e.args=="string"?e.args=await this._resolveVariables(e.args,i,s):e.args=await Promise.all(e.args.map(o=>this._resolveVariables(o,i,s)))),e}async _resolveVariables(e,t,i){try{e=await this._configurationResolverService.resolveWithEnvironment(t,i,e)}catch(n){this._logService.error("Could not resolve shell",n)}return e}_getOsKey(e){switch(e){case 3:return"linux";case 2:return"osx";case 1:return"windows"}}_guessProfileIcon(e){switch(Xi(e).name){case"bash":return k.terminalBash;case"pwsh":case"powershell":return k.terminalPowershell;case"tmux":return k.terminalTmux;case"cmd":return k.terminalCmd;default:return}}_isValidShellArgs(e,t){return!!(e===void 0||t===1&&typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="string"))}async createProfileFromShellAndShellArgs(e,t){var l,h;const i=(l=this._terminalProfileService.availableProfiles)==null?void 0:l.find(m=>m.path!==e?!1:m.args===void 0||typeof m.args=="string"?m.args===t:m.path===e&&Ps(m.args,t||[])),n=await this.getDefaultProfile({remoteAuthority:(h=this._remoteAgentService.getConnection())==null?void 0:h.remoteAuthority,os:this._primaryBackendOs});n.profileName=`${n.path} (migrated)`;const s=i||n,o=this._isValidShellArgs(t,this._primaryBackendOs)?t:s.args,a={profileName:s.profileName,path:s.path,args:o,isDefault:!0};return i&&i.profileName===a.profileName&&i.path===a.path&&Ma(i.args,a.args)?i.profileName:a}_isValidAutomationProfile(e,t){return e==null||typeof e!="object"?!1:"path"in e&&typeof e.path=="string"}}fr.__decorator=w([$e(200)],fr.prototype,"_refreshDefaultProfileName",null);let _r=class extends fr{constructor(e,t,i,n,s,o,a,l){super({getDefaultSystemShell:async(h,m)=>{const p=await l.getBackend(h);if(!p)throw new Ts(`Cannot get default system shell when there is no backend for remote authority '${h}'`);return p.getDefaultSystemShell(m)},getEnvironment:async h=>{const m=await l.getBackend(h);if(!m)throw new Ts(`Cannot get environment when there is no backend for remote authority '${h}'`);return m.getEnvironment()}},t,e,i,n,o,s,a)}};_r=w([d(0,Bn),d(1,X),d(2,On),d(3,it),d(4,_e),d(5,tt),d(6,et),d(7,He)],_r);let Ft=class{get onDidChangeCollections(){return this._onDidChangeCollections.event}constructor(e,t){this._extensionService=e,this._storageService=t,this.collections=new Map,this._onDidChangeCollections=new b,this._storageService.remove("terminal.integrated.environmentVariableCollections",1);const i=this._storageService.get("terminal.integrated.environmentVariableCollectionsV2",1);i&&(JSON.parse(i).forEach(s=>this.collections.set(s.extensionIdentifier,{persistent:!0,map:zc(s.collection),descriptionMap:Kc(s.description)})),this._invalidateExtensionCollections()),this.mergedCollection=this._resolveMergedCollection(),this._extensionService.onDidChangeExtensions(()=>this._invalidateExtensionCollections())}set(e,t){this.collections.set(e,t),this._updateCollections()}delete(e){this.collections.delete(e),this._updateCollections()}_updateCollections(){this._persistCollectionsEventually(),this.mergedCollection=this._resolveMergedCollection(),this._notifyCollectionUpdatesEventually()}_persistCollectionsEventually(){this._persistCollections()}_persistCollections(){const e=[];this.collections.forEach((i,n)=>{i.persistent&&e.push({extensionIdentifier:n,collection:Uc(this.collections.get(n).map),description:qc(i.descriptionMap)})});const t=JSON.stringify(e);this._storageService.store("terminal.integrated.environmentVariableCollectionsV2",t,1,1)}_notifyCollectionUpdatesEventually(){this._notifyCollectionUpdates()}_notifyCollectionUpdates(){this._onDidChangeCollections.fire(this.mergedCollection)}_resolveMergedCollection(){return new Xa(this.collections)}async _invalidateExtensionCollections(){await this._extensionService.whenInstalledExtensionsRegistered();const e=this._extensionService.extensions;let t=!1;this.collections.forEach((i,n)=>{e.some(o=>o.identifier.value===n)||(this.collections.delete(n),t=!0)}),t&&this._updateCollections()}};Ft.__decorator=w([Ca(1e3)],Ft.prototype,"_persistCollectionsEventually",null);Ft.__decorator=w([$e(1e3)],Ft.prototype,"_notifyCollectionUpdatesEventually",null);Ft=w([d(0,ue),d(1,bt)],Ft);let vr=class extends H{get onDidChangeLogLevel(){return this._logger.onDidChangeLogLevel}constructor(e){super(),this._loggerService=e,this._logger=this._loggerService.createLogger("terminal",{name:c("terminalLoggerName","Terminal")})}getLevel(){return this._logger.getLevel()}setLevel(e){this._logger.setLevel(e)}trace(e,...t){this._logger.trace(e,t)}debug(e,...t){this._logger.debug(e,t)}info(e,...t){this._logger.info(e,t)}warn(e,...t){this._logger.warn(e,t)}error(e,...t){this._logger.error(e,t)}flush(){this._logger.flush()}};vr=w([d(0,Eh)],vr);class bu{get providers(){return this._providers}constructor(){this._selectors=new Map,this._providers=new Map,this._onDidRegisterProvider=new b,this.onDidRegisterProvider=this._onDidRegisterProvider.event,this._onDidRegisterCommandSelector=new b,this.onDidRegisterCommandSelector=this._onDidRegisterCommandSelector.event,this._onDidUnregisterProvider=new b,this.onDidUnregisterProvider=this._onDidUnregisterProvider.event,this.extensionQuickFixes=new Promise(e=>wu.setHandler(t=>{e(t.filter(i=>Xc(i.description,"terminalQuickFixProvider")).map(i=>i.value?i.value.map(n=>({...n,extensionIdentifier:i.description.identifier.value})):[]).flat())})),this.extensionQuickFixes.then(e=>{for(const t of e)this.registerCommandSelector(t)})}registerCommandSelector(e){this._selectors.set(e.id,e),this._onDidRegisterCommandSelector.fire(e)}registerQuickFixProvider(e,t){let i=!1;return this.extensionQuickFixes.then(()=>{if(i)return;this._providers.set(e,t);const n=this._selectors.get(e);if(!n)throw new Error(`No registered selector for ID: ${e}`);this._onDidRegisterProvider.fire({selector:n,provider:t})}),Ce(()=>{i=!0,this._providers.delete(e);const n=this._selectors.get(e);n&&(this._selectors.delete(e),this._onDidUnregisterProvider.fire(n.id))})}}const wu=jc.registerExtensionPoint({extensionPoint:"terminalQuickFixes",defaultExtensionKind:["workspace"],activationEventsGenerator:(r,e)=>{for(const t of r??[])e.push(`onTerminalQuickFixRequest:${t.id}`)},jsonSchema:{description:c("vscode.extension.contributes.terminalQuickFixes","Contributes terminal quick fixes."),type:"array",items:{type:"object",additionalProperties:!1,required:["id","commandLineMatcher","outputMatcher","commandExitResult"],defaultSnippets:[{body:{id:"$1",commandLineMatcher:"$2",outputMatcher:"$3",exitStatus:"$4"}}],properties:{id:{description:c("vscode.extension.contributes.terminalQuickFixes.id","The ID of the quick fix provider"),type:"string"},commandLineMatcher:{description:c("vscode.extension.contributes.terminalQuickFixes.commandLineMatcher","A regular expression or string to test the command line against"),type:"string"},outputMatcher:{markdownDescription:c("vscode.extension.contributes.terminalQuickFixes.outputMatcher",`A regular expression or string to match a single line of the output against, which provides groups to be referenced in terminalCommand and uri.

For example:

 \`lineMatcher: /git push --set-upstream origin (?<branchName>[^s]+)/;\`

\`terminalCommand: 'git push --set-upstream origin \${group:branchName}';\`
`),type:"object",required:["lineMatcher","anchor","offset","length"],properties:{lineMatcher:{description:"A regular expression or string to test the command line against",type:"string"},anchor:{description:"Where the search should begin in the buffer",enum:["top","bottom"]},offset:{description:"The number of lines vertically from the anchor in the buffer to start matching against",type:"number"},length:{description:"The number of rows to match against, this should be as small as possible for performance reasons",type:"number"}}},commandExitResult:{description:c("vscode.extension.contributes.terminalQuickFixes.commandExitResult","The command exit result to match on"),enum:["success","error"],enumDescriptions:["The command exited with an exit code of zero.","The command exited with a non-zero exit code."]}}}}});var Su=".monaco-workbench .xterm-viewport{-webkit-text-fill-color:transparent;-webkit-background-clip:text;background-clip:text;scrollbar-width:thin;transition:background-color .8s linear}.monaco-workbench .xterm-viewport::-webkit-scrollbar{width:10px}.monaco-workbench .xterm-viewport::-webkit-scrollbar-track{opacity:0}.monaco-workbench .xterm-viewport::-webkit-scrollbar-thumb{background-color:inherit;min-height:20px}.monaco-workbench .force-scrollbar .xterm .xterm-viewport,.monaco-workbench .xterm.focus .xterm-viewport,.monaco-workbench .xterm:focus .xterm-viewport,.monaco-workbench .xterm:hover .xterm-viewport{cursor:default;transition:opacity .1s linear}.monaco-workbench .xterm .xterm-viewport::-webkit-scrollbar-thumb:hover{transition:opacity 0ms linear}.monaco-workbench .xterm .xterm-viewport::-webkit-scrollbar-thumb:window-inactive{background-color:inherit}";ri(Su,{});var Cu='.monaco-workbench .pane-body.integrated-terminal{align-content:flex-start;align-items:baseline;background-color:transparent!important;display:flex;flex-direction:column;position:relative;user-select:auto;-webkit-user-select:initial;z-index:0}.terminal-command-decoration.hide{visibility:hidden}.monaco-workbench .part.panel .pane-body.integrated-terminal .terminal-outer-container{background-color:var(--vscode-terminal-background,--vscode-panel-background)}.monaco-workbench .pane-body.integrated-terminal .terminal-group,.monaco-workbench .pane-body.integrated-terminal .terminal-groups-container,.monaco-workbench .pane-body.integrated-terminal .terminal-outer-container,.monaco-workbench .pane-body.integrated-terminal .terminal-split-pane,.monaco-workbench .terminal-editor .terminal-outer-container,.monaco-workbench .terminal-editor .terminal-split-pane{height:100%}.monaco-workbench .part.auxiliarybar .pane-body.integrated-terminal .terminal-outer-container,.monaco-workbench .part.sidebar .pane-body.integrated-terminal .terminal-outer-container{background-color:var(--vscode-terminal-background,--vscode-sideBar-background)}.monaco-workbench .pane-body.integrated-terminal .split-view-view:not(:first-child),.monaco-workbench .pane-body.integrated-terminal .tabs-container{border-color:var(--vscode-terminal-border)}.monaco-workbench .pane-body.integrated-terminal .terminal-drop-overlay{background-color:var(--vscode-terminal-dropBackground,--vscode-editorGroup-dropBackground)}.monaco-workbench .pane-body.integrated-terminal .terminal-tabs-entry.is-active:before{background-color:var(--vscode-terminal-tab-activeBorder)}.monaco-workbench .terminal-editor .xterm textarea:focus{opacity:0!important;outline:0!important}.monaco-workbench .terminal-tab:before{font-family:codicon!important;font-size:16px!important}.monaco-workbench .terminal-tab:not(.terminal-uri-icon):before{background-image:none!important}.monaco-workbench .terminal-editor .terminal-wrapper{background-color:var(--vscode-terminal-background,--vscode-editorPane-background)}.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper,.monaco-workbench .terminal-editor .terminal-wrapper{box-sizing:border-box;display:block;height:100%}.monaco-workbench .xterm{padding:0 10px 2px}.monaco-workbench .pane-body.integrated-terminal .xterm,.monaco-workbench .terminal-editor .xterm{bottom:0;left:0;position:absolute;right:0}.terminal-side-view .terminal.xterm{top:0}.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper.fixed-dims .xterm,.monaco-workbench .terminal-editor .terminal-wrapper.fixed-dims .xterm{position:static}.monaco-workbench .pane-body.integrated-terminal .xterm-viewport,.monaco-workbench .terminal-editor .xterm-viewport{z-index:30}.monaco-workbench .pane-body.integrated-terminal .xterm-decoration-overview-ruler,.monaco-workbench .terminal-editor .xterm-decoration-overview-ruler{pointer-events:none;z-index:31}.monaco-workbench .pane-body.integrated-terminal .xterm-screen,.monaco-workbench .terminal-editor .xterm-screen{z-index:31}.xterm .xterm-screen{cursor:text}.monaco-workbench .simple-find-part-wrapper.result-count{z-index:33!important}.xterm .xterm-accessibility{pointer-events:none;z-index:32!important}.xterm.enable-mouse-events .xterm-screen{cursor:default}.xterm.xterm-cursor-pointer .xterm-screen{cursor:pointer}.xterm.column-select.focus .xterm-screen{cursor:crosshair}.integrated-terminal.shell-integration .xterm,.monaco-workbench .pane-body.integrated-terminal .terminal-group .monaco-split-view2.horizontal .split-view-view:first-child .xterm,.monaco-workbench .terminal-editor .xterm{padding-left:20px!important}.monaco-workbench .pane-body.integrated-terminal .terminal-group .monaco-split-view2.horizontal .split-view-view:last-child .xterm,.monaco-workbench .terminal-editor .terminal-group .monaco-split-view2.horizontal .split-view-view:last-child .xterm{padding-right:20px}.monaco-workbench .pane-body.integrated-terminal .xterm a:not(.xterm-invalid-link),.monaco-workbench .terminal-editor .xterm a:not(.xterm-invalid-link){position:relative}.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper>div,.monaco-workbench .terminal-editor .terminal-wrapper>div{height:100%}.monaco-workbench .pane-body.integrated-terminal .xterm-viewport,.monaco-workbench .terminal-editor .xterm-viewport{box-sizing:border-box}.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper.fixed-dims,.monaco-workbench .terminal-editor .terminal-wrapper.fixed-dims{position:relative}.monaco-workbench .pane-body.integrated-terminal .terminal-wrapper:not(.fixed-dims) .xterm-viewport,.monaco-workbench .terminal-editor .terminal-wrapper:not(.fixed-dims) .xterm-viewport{width:auto!important}.monaco-workbench .pane-body.integrated-terminal{font-variant-ligatures:none}.monaco-workbench .pane-body.integrated-terminal .split-view-view{box-sizing:border-box;overflow:hidden}.monaco-workbench .pane-body.integrated-terminal .split-view-view:first-child .tabs-container{border-right-style:solid;border-right-width:1px}.monaco-workbench .pane-body.integrated-terminal .split-view-view:last-child .tabs-container,.monaco-workbench .pane-body.integrated-terminal .terminal-group .monaco-split-view2.horizontal .split-view-view:not(:first-child){border-left-style:solid;border-left-width:1px}.monaco-workbench .pane-body.integrated-terminal .terminal-group .monaco-split-view2.vertical .split-view-view:not(:first-child){border-top-style:solid;border-top-width:1px}.monaco-workbench .pane-body.integrated-terminal .terminal-groups-container.alt-active .xterm{cursor:default}.monaco-workbench .pane-body.integrated-terminal .xterm{user-select:none;-webkit-user-select:none}.monaco-workbench .pane-body.integrated-terminal .monaco-split-view2.vertical .split-view-view:not(:last-child) .xterm{bottom:auto;top:0}.monaco-workbench .pane-body.integrated-terminal .xterm:focus{outline:none}.monaco-workbench.hc-black .pane-body.integrated-terminal .xterm.focus:before,.monaco-workbench.hc-black .pane-body.integrated-terminal .xterm:focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .xterm.focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .xterm:focus:before{border:1px solid;bottom:0;content:"";display:block;left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:32}.monaco-workbench.hc-black .pane-body.integrated-terminal .monaco-split-view2.horizontal .split-view-view:not(:only-child) .xterm.focus:before,.monaco-workbench.hc-black .pane-body.integrated-terminal .monaco-split-view2.horizontal .split-view-view:not(:only-child) .xterm:focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .monaco-split-view2.horizontal .split-view-view:not(:only-child) .xterm.focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .monaco-split-view2.horizontal .split-view-view:not(:only-child) .xterm:focus:before{right:0}.monaco-workbench .pane-body.integrated-terminal .xterm .xterm-helpers{position:absolute;top:0}.monaco-workbench .xterm .xterm-helper-textarea:focus{opacity:0!important}.monaco-workbench.hc-black.mac .pane-body.integrated-terminal .terminal-groups-container:not(.alt-active) .terminal:not(.enable-mouse-events),.monaco-workbench.vs-dark.mac .pane-body.integrated-terminal .terminal-groups-container:not(.alt-active) .terminal:not(.enable-mouse-events){cursor:-webkit-image-set(url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAL0lEQVQoz2NgCD3x//9/BhBYBWdhgFVAiVW4JBFKGIa4AqD0//9D3pt4I4tAdAMAHTQ/j5Zom30AAAAASUVORK5CYII=") 1x,url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAz0lEQVRIx2NgYGBY/R8I/vx5eelX3n82IJ9FxGf6tksvf/8FiTMQAcAGQMDvSwu09abffY8QYSAScNk45G198eX//yev73/4///701eh//kZSARckrNBRvz//+8+6ZohwCzjGNjdgQxkAg7B9WADeBjIBqtJCbhRA0YNoIkBSNmaPEMoNmA0FkYNoFKhapJ6FGyAH3nauaSmPfwI0v/3OukVi0CIZ+F25KrtYcx/CTIy0e+rC7R1Z4KMICVTQQ14feVXIbR695u14+Ir4gwAAD49E54wc1kWAAAAAElFTkSuQmCC") 2x) 5 8,text}.xterm .xterm-cursor-pointer,.xterm.xterm-cursor-pointer{cursor:pointer!important}.monaco-pane-view .pane>.pane-header .monaco-action-bar .switch-terminal,.monaco-workbench .part.sidebar>.title>.title-actions .switch-terminal,.part.panel>.title>.title-actions .switch-terminal>.monaco-select-box{border-style:solid;border-width:1px}.xterm-screen .xterm-decoration-container .xterm-decoration.quick-fix{z-index:7}.monaco-workbench .part.sidebar>.title>.title-actions .switch-terminal{align-items:center;display:flex;flex-shrink:1;font-size:11px;height:20px;margin-right:.3em;margin-top:7px}.monaco-workbench.mac .part.sidebar>.title>.title-actions .switch-terminal{border-radius:4px}.monaco-workbench .part.sidebar>.title>.title-actions .switch-terminal>.monaco-select-box{background-color:unset!important;border:none!important;display:block!important}.monaco-pane-view .pane>.pane-header .monaco-action-bar .switch-terminal.action-item.select-container{border:none!important}.monaco-workbench .part.sidebar>.title>.title-actions .switch-terminal>.monaco-select-box{padding:0 22px 0 6px}.monaco-workbench .pane-body.integrated-terminal .tabs-container{display:flex;flex-direction:column;height:100%}.monaco-workbench .terminal-overflow-guard{height:100%;overflow:hidden;position:relative}.monaco-workbench .pane-body.integrated-terminal .tabs-list-container{height:100%;overflow:hidden}.monaco-workbench .pane-body.integrated-terminal .tabs-container>.monaco-toolbar{margin:auto;padding:4px 0 2px}.monaco-workbench .pane-body.integrated-terminal .terminal-tabs-entry.is-active:before{bottom:0;content:"";display:block;left:0;position:absolute;top:0;width:1px}.monaco-workbench .pane-body.integrated-terminal .tabs-container.has-text>.monaco-toolbar{margin:0;padding:4px 7px 2px;text-align:left}.monaco-workbench .pane-body.integrated-terminal .tabs-list{height:100%}.monaco-workbench .pane-body.integrated-terminal .tabs-list .terminal-tabs-entry{text-align:center}.monaco-workbench .pane-body.integrated-terminal .tabs-container.has-text .tabs-list .terminal-tabs-entry{padding-left:10px;padding-right:10px;text-align:left}.monaco-workbench .pane-body.integrated-terminal .tabs-container.has-text .tabs-list .terminal-tabs-entry .monaco-icon-label:after{margin-right:0}.monaco-workbench .pane-body.integrated-terminal .tabs-container:not(.has-text) .terminal-tabs-entry .codicon{color:inherit}.monaco-workbench .pane-body.integrated-terminal .tabs-container:not(.has-text) .monaco-icon-description-container{display:none}.monaco-workbench .pane-body.integrated-terminal .tabs-list .codicon{vertical-align:text-bottom}.monaco-workbench .pane-body.integrated-terminal .tabs-list .actions,.monaco-workbench .pane-body.integrated-terminal .tabs-list .editable-tab .monaco-icon-name-container{display:none}.monaco-workbench .pane-body.integrated-terminal .tabs-list .actions .action-label{padding:2px}.monaco-workbench .pane-body.integrated-terminal .tabs-list .monaco-list-row:hover .actions,.monaco-workbench .pane-body.integrated-terminal .tabs-list:focus-within .monaco-list-row.focused .actions,.monaco-workbench .pane-body.integrated-terminal .tabs-list:focus-within .monaco-list-row.selected .actions{display:block}.monaco-action-bar .action-item .single-terminal-tab{align-items:center;display:flex!important}.monaco-action-bar .action-item .single-terminal-tab .codicon:first-child{margin-right:4px}.monaco-action-bar .action-item .single-terminal-tab .codicon:nth-child(2){color:inherit;margin-left:4px}.monaco-workbench .pane-body.integrated-terminal .tabs-container.has-text .tabs-list .terminal-tabs-entry .uri-icon{background-repeat:no-repeat;background-size:contain;height:100%;margin-right:4px}.monaco-action-bar .terminal-uri-icon.single-terminal-tab.action-label .codicon,.monaco-workbench .terminal-uri-icon .monaco-highlighted-label .codicon{background-size:16px}.monaco-action-bar .terminal-uri-icon.single-terminal-tab.action-label:not(.alt-command) .codicon:before,.monaco-workbench .terminal-uri-icon .monaco-highlighted-label .codicon:before{content:"";display:inline-block;height:16px;width:16px}.monaco-workbench .pane-body.integrated-terminal .terminal-drop-overlay{bottom:0;display:block;left:0;opacity:0;pointer-events:none;position:absolute;right:0;top:0;z-index:34}.monaco-workbench:not(.reduce-motion) .pane-body.integrated-terminal .terminal-drop-overlay{transition:left 70ms ease-out,right 70ms ease-out,top 70ms ease-out,bottom 70ms ease-out,opacity .15s ease-out}.monaco-workbench .pane-body.integrated-terminal .terminal-group>.monaco-split-view2.horizontal .terminal-drop-overlay.drop-before{right:50%}.monaco-workbench .pane-body.integrated-terminal .terminal-group>.monaco-split-view2.horizontal .terminal-drop-overlay.drop-after{left:50%}.monaco-workbench .pane-body.integrated-terminal .terminal-group>.monaco-split-view2.vertical .terminal-drop-overlay.drop-before{bottom:50%}.monaco-workbench .pane-body.integrated-terminal .terminal-group>.monaco-split-view2.vertical .terminal-drop-overlay.drop-after{top:50%}.monaco-workbench .terminal .terminal-command-decoration:not(.default):hover{background-color:var(--vscode-toolbar-hoverBackground);border-radius:5px;cursor:pointer}.monaco-workbench .terminal .terminal-command-decoration{color:var(--vscode-terminalCommandDecoration-successBackground)}.monaco-workbench .terminal .terminal-command-decoration.error{color:var(--vscode-terminalCommandDecoration-errorBackground)}.monaco-workbench .terminal .terminal-command-decoration.default{color:var(--vscode-terminalCommandDecoration-defaultBackground);pointer-events:none}.monaco-workbench .terminal .terminal-command-decoration.quick-fix{background-color:var(--vscode-terminal-background,--vscode-panel-background);color:var(--vscode-editorLightBulb-foreground)!important}.terminal-scroll-highlight{border-left:5px solid #fff;border-left-width:5px!important;left:0;pointer-events:none;right:0}.terminal-scroll-highlight-outline{border:1px solid #fff;pointer-events:none}.terminal-scroll-highlight{border-color:var(--vscode-focusBorder)}.hc-black .xterm-find-result-decoration,.hc-light .xterm-find-result-decoration{outline-style:dotted!important;outline-style:solid!important}.xterm-find-active-result-decoration{outline-style:solid!important;outline-width:2px!important;z-index:7!important}.monaco-workbench.hc-black .editor-instance .xterm.focus:before,.monaco-workbench.hc-black .editor-instance .xterm:focus:before,.monaco-workbench.hc-black .pane-body.integrated-terminal .xterm.focus:before,.monaco-workbench.hc-black .pane-body.integrated-terminal .xterm:focus:before,.monaco-workbench.hc-light .editor-instance .xterm.focus:before,.monaco-workbench.hc-light .editor-instance .xterm:focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .xterm.focus:before,.monaco-workbench.hc-light .pane-body.integrated-terminal .xterm:focus:before{border-color:var(--vscode-contrastActiveBorder)}.monaco-workbench .integrated-terminal .hoverHighlight{background-color:var(--vscode-terminal-hoverHighlightBackground)}.force-scrollbar .xterm .xterm-viewport,.monaco-workbench .xterm.focus .xterm-viewport,.monaco-workbench .xterm:focus .xterm-viewport,.monaco-workbench .xterm:hover .xterm-viewport{background-color:var(--vscode-scrollbarSlider-background)!important}.monaco-workbench .xterm-viewport{scrollbar-color:var(--vscode-scrollbarSlider-background) transparent}.monaco-workbench .xterm .xterm-viewport::-webkit-scrollbar-thumb:hover{background-color:var(--vscode-scrollbarSlider-hoverBackground)}.monaco-workbench .xterm-viewport:hover{scrollbar-color:var(--vscode-scrollbarSlider-hoverBackground) transparent}.monaco-workbench .xterm .xterm-viewport::-webkit-scrollbar-thumb:active{background-color:var(--vscode-scrollbarSlider-activeBackground)}.monaco-workbench .terminal-accessible-widget{bottom:0;cursor:default;left:10px;opacity:0;overflow:initial;overflow-x:initial;padding:0;pointer-events:none;position:absolute;right:0;top:0;z-index:0}.monaco-workbench .terminal-accessible-widget div{white-space:pre-wrap}.monaco-workbench .terminal-accessible-widget.active,.monaco-workbench .terminal-accessible-widget.focus-within{background-color:var(--vscode-terminal-background,--vscode-panel-background);opacity:1;pointer-events:all;z-index:33}.monaco-workbench .xterm.terminal.hide{visibility:hidden}';ri(Cu,{});var yu=".monaco-workbench .terminal-widget-container{bottom:0;left:0;overflow:visible;position:absolute;right:0;top:0}.monaco-workbench .terminal-overlay-widget{bottom:0;color:#3794ff;left:0;position:absolute}.monaco-workbench .terminal-hover-target{position:absolute;z-index:33}.monaco-workbench .terminal-env-var-info{height:28px;opacity:.5;position:absolute;right:10px;text-align:center;top:0;width:28px;z-index:32}.monaco-workbench .terminal-env-var-info.requires-action,.monaco-workbench .terminal-env-var-info:hover{opacity:1}.monaco-workbench .terminal-env-var-info.codicon{line-height:28px}";ri(yu,{});var xu=".xterm{cursor:text;position:relative;user-select:none;-ms-user-select:none;-webkit-user-select:none}.xterm.focus,.xterm:focus{outline:none}.xterm .xterm-helpers{position:absolute;top:0;z-index:5}.xterm .xterm-helper-textarea{border:0;height:0;left:-9999em;margin:0;opacity:0;overflow:hidden;padding:0;position:absolute;resize:none;top:0;white-space:nowrap;width:0;z-index:-5}.xterm .composition-view{background:#000;color:#fff;display:none;position:absolute;white-space:nowrap;z-index:1}.xterm .composition-view.active{display:block}.xterm .xterm-viewport{background-color:#000;bottom:0;cursor:default;left:0;overflow-y:scroll;position:absolute;right:0;top:0}.xterm .xterm-screen{position:relative}.xterm .xterm-screen canvas{left:0;position:absolute;top:0}.xterm .xterm-scroll-area{visibility:hidden}.xterm-char-measure-element{display:inline-block;left:-9999em;line-height:normal;position:absolute;top:0;visibility:hidden}.xterm.enable-mouse-events{cursor:default}.xterm .xterm-cursor-pointer,.xterm.xterm-cursor-pointer{cursor:pointer}.xterm.column-select.focus{cursor:crosshair}.xterm .xterm-accessibility,.xterm .xterm-message{bottom:0;color:transparent;left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:10}.xterm .live-region{height:1px;left:-9999px;overflow:hidden;position:absolute;width:1px}.xterm-dim{opacity:1!important}.xterm-underline-1{text-decoration:underline}.xterm-underline-2{text-decoration:double underline}.xterm-underline-3{text-decoration:wavy underline}.xterm-underline-4{text-decoration:dotted underline}.xterm-underline-5{text-decoration:dashed underline}.xterm-overline{text-decoration:overline}.xterm-overline.xterm-underline-1{text-decoration:overline underline}.xterm-overline.xterm-underline-2{text-decoration:overline double underline}.xterm-overline.xterm-underline-3{text-decoration:overline wavy underline}.xterm-overline.xterm-underline-4{text-decoration:overline dotted underline}.xterm-overline.xterm-underline-5{text-decoration:overline dashed underline}.xterm-strikethrough{text-decoration:line-through}.xterm-screen .xterm-decoration-container .xterm-decoration{position:absolute;z-index:6}.xterm-screen .xterm-decoration-container .xterm-decoration.xterm-decoration-top-layer{z-index:7}.xterm-decoration-overview-ruler{pointer-events:none;position:absolute;right:0;top:0;z-index:8}.xterm-decoration-top{position:relative;z-index:2}";ri(xu,{});function io(r){var a;let e="";const t=r.statusList.statuses,i=[];for(const l of t)e+=`

---

${l.icon?`$(${(a=l.icon)==null?void 0:a.id}) `:""}${l.tooltip||l.id}`,l.hoverActions&&i.push(...l.hoverActions);const n=ic(r,!0),s=tc(r,!0);return{content:new V(r.title+n+s+e,{supportThemeIcons:!0}),actions:i}}function tc(r,e){const t=[];r.capabilities.has(2)&&t.push(2),r.capabilities.has(0)&&t.push(0);let i="";return t.length>0?i+=`${e?`

---

`:`

`}${c("shellIntegration.enabled","Shell integration activated")}`:r.shellLaunchConfig.ignoreShellIntegration?i+=`${e?`

---

`:`

`}${c("launchFailed.exitCodeOnlyShellIntegration","The terminal process failed to launch. Disabling shell integration with terminal.integrated.shellIntegration.enabled might help.")}`:r.usedShellIntegrationInjection&&(i+=`${e?`

---

`:`

`}${c("shellIntegration.activationFailed","Shell integration failed to activate")}`),i}function ic(r,e){const t=[];if(r.processId&&t.push(c({key:"shellProcessTooltip.processId",comment:[`The first arg is "PID" which shouldn't be translated`]},"Process ID ({0}): {1}","PID",r.processId)+`
`),r.shellLaunchConfig.executable){let i=r.shellLaunchConfig.executable;const n=Lh(r.injectedArgs||r.shellLaunchConfig.args||[]).map(s=>`'${s}'`).join(" ");n&&(i+=` ${n}`),t.push(c("shellProcessTooltip.commandLine","Command line: {0}",i))}return t.length?`${e?`

---

`:`

`}${t.join(`
`)}`:""}const $o=Se;let br=class extends Rh{constructor(e,t,i,n,s,o,a,l,h,m,p,v){super("TerminalTabsList",e,{getHeight:()=>22,getTemplateId:()=>"terminal.tabs"},[l.createInstance(wr,e,l.createInstance(Qc,Jc),()=>this.getSelectedElements())],{horizontalScrolling:!1,supportDynamicHeights:!1,selectionNavigation:!0,identityProvider:{getId:_=>_==null?void 0:_.instanceId},accessibilityProvider:l.createInstance(Sr),smoothScrolling:s.getValue("workbench.list.smoothScrolling"),multipleSelectionSupport:!0,additionalScrollHeight:22,dnd:l.createInstance(Cr),openOnSingleClick:!0},t,i,s,l),this._configurationService=s,this._terminalService=o,this._terminalGroupService=a,this._themeService=m,this._hoverService=v;const f=[this._terminalGroupService.onDidChangeInstances(()=>this.refresh()),this._terminalGroupService.onDidChangeGroups(()=>this.refresh()),this._terminalGroupService.onDidShow(()=>this.refresh()),this._terminalGroupService.onDidChangeInstanceCapability(()=>this.refresh()),this._terminalService.onDidChangeInstanceTitle(()=>this.refresh()),this._terminalService.onDidChangeInstanceIcon(()=>this.refresh()),this._terminalService.onDidChangeInstancePrimaryStatus(()=>this.refresh()),this._terminalService.onDidChangeConnectionState(()=>this.refresh()),this._themeService.onDidColorThemeChange(()=>this.refresh()),this._terminalGroupService.onDidChangeActiveInstance(_=>{if(_){const S=this._terminalGroupService.instances.indexOf(_);this.setSelection([S]),this.reveal(S)}this.refresh()})];p.onWillShutdown(_=>{ee(f)}),this.onMouseDblClick(async _=>{var y,M,D;if(this.getFocus().length===0){const R=await this._terminalService.createTerminal({location:A.Panel});this._terminalGroupService.setActiveInstance(R),await R.focusWhenReady()}((y=this._terminalService.getEditingTerminal())==null?void 0:y.instanceId)!==((M=_.element)==null?void 0:M.instanceId)&&this._getFocusMode()==="doubleClick"&&this.getFocus().length===1&&((D=_.element)==null||D.focus(!0))}),this.onMouseClick(async _=>{var S,y,M;((S=this._terminalService.getEditingTerminal())==null?void 0:S.instanceId)!==((y=_.element)==null?void 0:y.instanceId)&&(_.browserEvent.altKey&&_.element?await this._terminalService.createTerminal({location:{parentTerminal:_.element}}):this._getFocusMode()==="singleClick"&&this.getSelection().length<=1&&((M=_.element)==null||M.focus(!0)))}),this.onContextMenu(_=>{if(!_.element){this.setSelection([]);return}const S=this.getSelectedElements();(!S||!S.find(y=>_.element===y))&&this.setFocus(_.index!==void 0?[_.index]:[])}),this._terminalTabsSingleSelectedContextKey=u.tabsSingularSelection.bindTo(t),this._isSplitContextKey=u.splitTerminal.bindTo(t),this.onDidChangeSelection(_=>this._updateContextKey()),this.onDidChangeFocus(()=>this._updateContextKey()),this.onDidOpen(async _=>{const S=_.element;S&&(this._terminalGroupService.setActiveInstance(S),_.editorOptions.preserveFocus||await S.focusWhenReady())}),this._decorationsProvider||(this._decorationsProvider=l.createInstance(yr),h.registerDecorationsProvider(this._decorationsProvider)),this.refresh()}_getFocusMode(){return this._configurationService.getValue("terminal.integrated.tabs.focusMode")}refresh(e=!0){e&&this._terminalService.isEditable(void 0)&&this.domFocus(),this.splice(0,this.length,this._terminalGroupService.instances.slice())}focusHover(){const e=this.getSelectedElements()[0];e&&this._hoverService.showHover({...io(e),target:this.getHTMLElement(),trapFocus:!0},!0)}_updateContextKey(){this._terminalTabsSingleSelectedContextKey.set(this.getSelectedElements().length===1);const e=this.getFocusedElements();this._isSplitContextKey.set(e.length>0&&this._terminalGroupService.instanceIsSplit(e[0]))}};br=w([d(1,me),d(2,zn),d(3,de),d(4,X),d(5,J),d(6,he),d(7,B),d(8,Yc),d(9,de),d(10,Hn),d(11,Vn)],br);let wr=class{constructor(e,t,i,n,s,o,a,l,h,m,p,v){this._container=e,this._labels=t,this._getSelection=i,this._instantiationService=n,this._terminalService=s,this._terminalGroupService=o,this._hoverService=a,this._configurationService=l,this._keybindingService=h,this._listService=m,this._themeService=p,this._contextViewService=v,this.templateId="terminal.tabs"}renderTemplate(e){const t=ke(e,$o(".terminal-tabs-entry")),i={},n=this._labels.create(t,{supportHighlights:!0,supportDescriptionHighlights:!0,supportIcons:!0,hoverDelegate:{delay:this._configurationService.getValue("workbench.hover.delay"),showHover:a=>this._hoverService.showHover({...a,actions:i.hoverActions,hideOnHover:!0})}}),s=ke(n.element,$o(".actions")),o=new Mh(s,{actionViewItemProvider:a=>a instanceof bn?this._instantiationService.createInstance(xa,a,void 0):void 0});return{element:t,label:n,actionBar:o,context:i,elementDisposables:new mt}}shouldHideText(){return this._container?this._container.clientWidth<63:!1}shouldHideActionBar(){return this._container?this._container.clientWidth<=105:!1}renderElement(e,t,i){var S;const n=!this.shouldHideText(),s=this._terminalGroupService.getGroupForInstance(e);if(!s)throw new Error(`Could not find group for instance "${e.instanceId}"`);i.element.classList.toggle("has-text",n),i.element.classList.toggle("is-active",this._terminalGroupService.activeInstance===e);let o="";if(s.terminalInstances.length>1){const y=s.terminalInstances.indexOf(e);y===0?o="┌ ":y===s.terminalInstances.length-1?o="└ ":o="├ "}const a=io(e);i.context.hoverActions=a.actions;const l=this._instantiationService.invokeFunction(Wr,e),h=!this.shouldHideActionBar();let m="";if(n)this.fillActionBar(e,i),m=o,e.icon&&(m+=`$(${l}) ${e.title}`);else{const y=e.statusList.primary;y&&y.severity>Oe.Ignore?m=`${o}$(${((S=y.icon)==null?void 0:S.id)||l})`:m=`${o}$(${l})`}h||i.actionBar.clear(),i.elementDisposables.add(O(i.element,De.AUXCLICK,y=>{y.stopImmediatePropagation(),y.button===1&&this._terminalService.safeDisposeTerminal(e)}));const p=[],v=ut(e);v&&p.push(v);const f=Wt(e,this._themeService.getColorTheme().type);f&&p.push(...f),i.label.setResource({resource:e.resource,name:m,description:n?e.description:void 0},{fileDecorations:{colors:!0,badges:n},title:{markdown:a.content,markdownNotSupportedFallback:void 0},extraClasses:p});const _=this._terminalService.getEditableData(e);i.label.element.classList.toggle("editable-tab",!!_),_&&(i.elementDisposables.add(this._renderInputBox(i.label.element.querySelector(".monaco-icon-label-container"),e,_)),i.actionBar.clear())}_renderInputBox(e,t,i){const n=t.title||"",s=new Fh(e,this._contextViewService,{validationOptions:{validation:h=>{const m=i.validationMessage(h);return!m||m.severity!==Oe.Error?null:{content:m.content,formatContent:!0,type:3}}},ariaLabel:c("terminalInputAriaLabel","Type terminal name. Press Enter to confirm or Escape to cancel."),inputBoxStyles:Wh});s.element.style.height="22px",s.value=n,s.focus(),s.select({start:0,end:n.length});const o=Oh((h,m)=>{s.element.style.display="none";const p=s.value;ee(l),s.element.remove(),m&&i.onFinish(p,h)}),a=()=>{if(s.isInputValid()){const h=i.validationMessage(s.value);h?s.showMessage({content:h.content,formatContent:!0,type:h.severity===Oe.Info?1:h.severity===Oe.Warning?2:3}):s.hideMessage()}};a();const l=[s,Co(s.inputElement,De.KEY_DOWN,h=>{h.stopPropagation(),h.equals(3)?o(s.isInputValid(),!0):h.equals(9)&&o(!1,!0)}),Co(s.inputElement,De.KEY_UP,h=>{a()}),O(s.inputElement,De.BLUR,()=>{o(s.isInputValid(),!0)})];return Ce(()=>{o(!1,!1)})}disposeElement(e,t,i){i.elementDisposables.clear(),i.actionBar.clear()}disposeTemplate(e){e.elementDisposables.dispose(),e.label.dispose(),e.actionBar.dispose()}fillActionBar(e,t){var n;const i=[new j("workbench.action.terminal.splitInstance",x.split.short,E.asClassName(k.splitHorizontal),!0,async()=>{this._runForSelectionOrInstance(e,async s=>{this._terminalService.createTerminal({location:{parentTerminal:s}})})}),new j("workbench.action.terminal.killInstance",x.kill.short,E.asClassName(k.trashcan),!0,async()=>{this._runForSelectionOrInstance(e,s=>this._terminalService.safeDisposeTerminal(s))})];t.actionBar.clear();for(const s of i)t.actionBar.push(s,{icon:!0,label:!1,keybinding:(n=this._keybindingService.lookupKeybinding(s.id))==null?void 0:n.getLabel()})}_runForSelectionOrInstance(e,t){var n;const i=this._getSelection();if(i.includes(e))for(const s of i)s&&t(s);else t(e);this._terminalGroupService.focusTabs(),(n=this._listService.lastFocusedList)==null||n.focusNext()}};wr=w([d(3,B),d(4,J),d(5,he),d(6,Vn),d(7,X),d(8,At),d(9,zn),d(10,de),d(11,ya)],wr);let Sr=class{constructor(e){this._terminalGroupService=e}getWidgetAriaLabel(){return c("terminal.tabs","Terminal tabs")}getAriaLabel(e){var n;let t="";const i=this._terminalGroupService.getGroupForInstance(e);if(i&&((n=i.terminalInstances)==null?void 0:n.length)>1){const s=i.terminalInstances.indexOf(e);t=c({key:"splitTerminalAriaLabel",comment:["The terminal's ID","The terminal's title","The terminal's split number","The terminal group's total split number"]},"Terminal {0} {1}, split {2} of {3}",e.instanceId,e.title,s+1,i.terminalInstances.length)}else t=c({key:"terminalAriaLabel",comment:["The terminal's ID","The terminal's title"]},"Terminal {0} {1}",e.instanceId,e.title);return t}};Sr=w([d(0,he)],Sr);let Cr=class{constructor(e,t){this._terminalService=e,this._terminalGroupService=t,this._autoFocusDisposable=H.None,this._primaryBackend=this._terminalService.getPrimaryBackend()}getDragURI(e){var t;return((t=this._terminalService.getEditingTerminal())==null?void 0:t.instanceId)===e.instanceId?null:e.resource.toString()}getDragLabel(e,t){return e.length===1?e[0].title:void 0}onDragLeave(){this._autoFocusInstance=void 0,this._autoFocusDisposable.dispose(),this._autoFocusDisposable=H.None}onDragStart(e,t){if(!t.dataTransfer)return;const i=e.getData();if(!Array.isArray(i))return;const n=i.filter(s=>"instanceId"in s);n.length>0&&t.dataTransfer.setData("Terminals",JSON.stringify(n.map(s=>s.resource.toString())))}onDragOver(e,t,i,n){if(e instanceof Nh&&!fi(n,qt.FILES,qt.RESOURCES,"Terminals",_n.FILES))return!1;const s=this._autoFocusInstance!==t;return s&&(this._autoFocusDisposable.dispose(),this._autoFocusInstance=t),!t&&!fi(n,"Terminals")?e instanceof yo:(s&&t&&(this._autoFocusDisposable=Bh(()=>{this._terminalService.setActiveInstance(t),this._autoFocusInstance=void 0},500)),{feedback:i?[i]:void 0,accept:!0,effect:1})}async drop(e,t,i,n){this._autoFocusDisposable.dispose(),this._autoFocusInstance=void 0;let s;const o=[],a=Ua(n);if(a)for(const h of a){const m=this._terminalService.getInstanceFromResource(h);if(m)s=[m],this._terminalService.moveToTerminalView(m);else if(this._primaryBackend){const p=Zr(h);p.instanceId&&o.push(this._primaryBackend.requestDetachInstance(p.workspaceId,p.instanceId))}}if(o.length){let h=await Promise.all(o);h=h.filter(p=>p!==void 0);let m;for(const p of h)m=await this._terminalService.createTerminal({config:{attachPersistentProcess:p}});m&&this._terminalService.setActiveInstance(m);return}if(s===void 0){if(!(e instanceof yo)){this._handleExternalDrop(t,n);return}const h=e.getData();if(!h||!Array.isArray(h))return;s=[];for(const m of h)"instanceId"in m&&s.push(m)}if(!t){this._terminalGroupService.moveGroupToEnd(s[0]),this._terminalService.setActiveInstance(s[0]);return}let l=!1;for(const h of s)this._terminalGroupService.moveGroup(h,t),l||(this._terminalService.setActiveInstance(h),l=!0)}async _handleExternalDrop(e,t){if(!e||!t.dataTransfer)return;let i;const n=t.dataTransfer.getData(qt.RESOURCES);n&&(i=L.parse(JSON.parse(n)[0]));const s=t.dataTransfer.getData(_n.FILES);!i&&s&&(i=L.file(JSON.parse(s)[0])),!i&&t.dataTransfer.files.length>0&&t.dataTransfer.files[0].path&&(i=L.file(t.dataTransfer.files[0].path)),i&&(this._terminalService.setActiveInstance(e),e.focus(),await e.sendPath(i,!1))}};Cr=w([d(0,J),d(1,he)],Cr);let yr=class{constructor(e){this._terminalService=e,this.label=c("label","Terminal"),this._onDidChange=new b,this._terminalService.onDidChangeInstancePrimaryStatus(t=>this._onDidChange.fire([t.resource]))}get onDidChange(){return this._onDidChange.event}provideDecorations(e){var n;if(e.scheme!==$.vscodeTerminal)return;const t=this._terminalService.getInstanceFromResource(e);if(!t)return;const i=(n=t==null?void 0:t.statusList)==null?void 0:n.primary;if(i!=null&&i.icon)return{color:Qa(i.severity),letter:i.icon,tooltip:i.tooltip}}dispose(){this.dispose()}};yr=w([d(0,J)],yr);function bi(r,e,t,i,n){const s=new Vh(r),o={x:s.posx,y:s.posy},a=[];Ia(t,void 0,a),n&&a.push(...n),i.showContextMenu({getAnchor:()=>o,getActions:()=>a,getActionsContext:()=>e})}const di=Se;let xr=class extends H{constructor(e,t,i,n,s,o,a,l,h,m,p){super(),this._terminalService=t,this._terminalGroupService=i,this._instantiationService=n,this._notificationService=s,this._contextMenuService=o,this._configurationService=a,this._storageService=h,this._hoverService=p,this._cancelContextMenu=!1,this._parentElement=e,this._tabContainer=di(".tabs-container");const v=di(".tabs-list-container");this._tabListElement=di(".tabs-list"),v.appendChild(this._tabListElement),this._tabContainer.appendChild(v),this._instanceMenu=this._register(l.createMenu(I.TerminalInstanceContext,m)),this._tabsListMenu=this._register(l.createMenu(I.TerminalTabContext,m)),this._tabsListEmptyMenu=this._register(l.createMenu(I.TerminalTabEmptyAreaContext,m)),this._tabList=this._register(this._instantiationService.createInstance(br,this._tabListElement));const f=di(".terminal-outer-container");this._terminalContainer=di(".terminal-groups-container"),f.appendChild(this._terminalContainer),this._terminalService.setContainers(e,this._terminalContainer),this._terminalIsTabsNarrowContextKey=u.tabsNarrow.bindTo(m),this._terminalTabsFocusContextKey=u.tabsFocus.bindTo(m),this._terminalTabsMouseContextKey=u.tabsMouse.bindTo(m),this._tabTreeIndex=this._terminalService.configHelper.config.tabs.location==="left"?0:1,this._terminalContainerIndex=this._terminalService.configHelper.config.tabs.location==="left"?1:0,a.onDidChangeConfiguration(_=>{_.affectsConfiguration("terminal.integrated.tabs.enabled")||_.affectsConfiguration("terminal.integrated.tabs.hideCondition")?this._refreshShowTabs():_.affectsConfiguration("terminal.integrated.tabs.location")&&(this._tabTreeIndex=this._terminalService.configHelper.config.tabs.location==="left"?0:1,this._terminalContainerIndex=this._terminalService.configHelper.config.tabs.location==="left"?1:0,this._shouldShowTabs()&&(this._splitView.swapViews(0,1),this._removeSashListener(),this._addSashListener(),this._splitView.resizeView(this._tabTreeIndex,this._getLastListWidth())))}),this._register(this._terminalGroupService.onDidChangeInstances(()=>this._refreshShowTabs())),this._register(this._terminalGroupService.onDidChangeGroups(()=>this._refreshShowTabs())),this._attachEventListeners(e,this._terminalContainer),this._terminalGroupService.onDidChangePanelOrientation(_=>{this._panelOrientation=_,this._panelOrientation===0?this._terminalContainer.classList.add("terminal-side-view"):this._terminalContainer.classList.remove("terminal-side-view")}),this._splitView=new Sa(e,{orientation:1,proportionalLayout:!1}),this._setupSplitView(f)}_shouldShowTabs(){const e=this._terminalService.configHelper.config.tabs.enabled,t=this._terminalService.configHelper.config.tabs.hideCondition;return e?t==="never"||t==="singleTerminal"&&this._terminalGroupService.instances.length>1||t==="singleGroup"&&this._terminalGroupService.groups.length>1:!1}_refreshShowTabs(){this._shouldShowTabs()?this._splitView.length===1&&(this._addTabTree(),this._addSashListener(),this._splitView.resizeView(this._tabTreeIndex,this._getLastListWidth()),this.rerenderTabs()):this._splitView.length===2&&!this._terminalTabsMouseContextKey.get()&&(this._splitView.removeView(this._tabTreeIndex),this._plusButton&&this._tabContainer.removeChild(this._plusButton),this._removeSashListener())}_getLastListWidth(){const e=this._panelOrientation===0?"tabs-list-width-vertical":"tabs-list-width-horizontal",t=this._storageService.get(e,0);return!t||!parseInt(t)?this._panelOrientation===0?46:120:parseInt(t)}_handleOnDidSashReset(){let e=80;const t=document.createElement("canvas");t.width=1,t.height=1;const i=t.getContext("2d");if(i){const s=window.getComputedStyle(this._tabListElement);i.font=`${s.fontStyle} ${s.fontSize} ${s.fontFamily}`;const o=this._terminalGroupService.instances.reduce((a,l)=>Math.max(a,i.measureText(l.title+(l.description||"")).width+this._getAdditionalWidth(l)),0);e=Math.ceil(Math.max(o,80))}Math.ceil(this._splitView.getViewSize(this._tabTreeIndex))===e&&(e=46),this._splitView.resizeView(this._tabTreeIndex,e),this._updateListWidth(e)}_getAdditionalWidth(e){var s;const i=e.statusList.statuses.length>0?30:0;return 40+((((s=this._terminalGroupService.getGroupForInstance(e))==null?void 0:s.terminalInstances.length)||0)>1?30:0)+i}_handleOnDidSashChange(){const e=this._splitView.getViewSize(this._tabTreeIndex);!this._width||e<=0||this._updateListWidth(e)}_updateListWidth(e){e<63&&e>=46?(e=46,this._splitView.resizeView(this._tabTreeIndex,e)):e>=63&&e<80&&(e=80,this._splitView.resizeView(this._tabTreeIndex,e)),this.rerenderTabs();const t=this._panelOrientation===0?"tabs-list-width-vertical":"tabs-list-width-horizontal";this._storageService.store(t,e,0,0)}_setupSplitView(e){this._register(this._splitView.onDidSashReset(()=>this._handleOnDidSashReset())),this._register(this._splitView.onDidSashChange(()=>this._handleOnDidSashChange())),this._shouldShowTabs()&&this._addTabTree(),this._splitView.addView({element:e,layout:t=>this._terminalGroupService.groups.forEach(i=>i.layout(t,this._height||0)),minimumSize:120,maximumSize:Number.POSITIVE_INFINITY,onDidChange:()=>H.None,priority:2},vn.Distribute,this._terminalContainerIndex),this._shouldShowTabs()&&this._addSashListener()}_addTabTree(){this._splitView.addView({element:this._tabContainer,layout:e=>this._tabList.layout(this._height||0,e),minimumSize:46,maximumSize:500,onDidChange:()=>H.None,priority:1},vn.Distribute,this._tabTreeIndex),this.rerenderTabs()}rerenderTabs(){this._updateHasText(),this._tabList.refresh()}_addSashListener(){let e;this._sashDisposables=[this._splitView.sashes[0].onDidStart(t=>{e=window.setInterval(()=>{this.rerenderTabs()},100)}),this._splitView.sashes[0].onDidEnd(t=>{window.clearInterval(e),e=0})]}_removeSashListener(){this._sashDisposables&&(ee(this._sashDisposables),this._sashDisposables=void 0)}_updateHasText(){const e=this._tabListElement.clientWidth>63;this._tabContainer.classList.toggle("has-text",e),this._terminalIsTabsNarrowContextKey.set(!e)}layout(e,t){this._height=t,this._width=e,this._splitView.layout(e),this._shouldShowTabs()&&this._splitView.resizeView(this._tabTreeIndex,this._getLastListWidth()),this._updateHasText()}_attachEventListeners(e,t){this._register(O(this._tabContainer,"mouseleave",async i=>{this._terminalTabsMouseContextKey.set(!1),this._refreshShowTabs(),i.stopPropagation()})),this._register(O(this._tabContainer,"mouseenter",async i=>{this._terminalTabsMouseContextKey.set(!0),i.stopPropagation()})),this._register(O(t,"mousedown",async i=>{const n=this._terminalGroupService.activeInstance;if(this._terminalGroupService.instances.length===0||!n){this._cancelContextMenu=!0;return}if(i.which===2&&Kn)n.focus();else if(i.which===3){const s=this._terminalService.configHelper.config.rightClickBehavior;if(s==="nothing"){i.shiftKey||(this._cancelContextMenu=!0);return}else if(s==="copyPaste"||s==="paste"){if(s==="copyPaste"&&i.shiftKey){bi(i,this._parentElement,this._instanceMenu,this._contextMenuService);return}s==="copyPaste"&&n.hasSelection()?(await n.copySelection(),n.clearSelection()):Ut.clipboard.readText?n.paste():this._notificationService.info(`This browser doesn't support the clipboard.readText API needed to trigger a paste, try ${Ee?"⌘":"Ctrl"}+V instead.`),Ee&&setTimeout(()=>{n.clearSelection()},0),this._cancelContextMenu=!0}}})),this._register(O(t,"contextmenu",i=>{this._terminalService.configHelper.config.rightClickBehavior==="nothing"&&!i.shiftKey&&(this._cancelContextMenu=!0),this._cancelContextMenu||bi(i,this._parentElement,this._instanceMenu,this._contextMenuService),i.preventDefault(),i.stopImmediatePropagation(),this._cancelContextMenu=!1})),this._register(O(this._tabContainer,"contextmenu",i=>{if(this._terminalService.configHelper.config.rightClickBehavior==="nothing"&&!i.shiftKey&&(this._cancelContextMenu=!0),!this._cancelContextMenu){const s=this._tabList.getFocus().length===0;bi(i,this._parentElement,s?this._tabsListEmptyMenu:this._tabsListMenu,this._contextMenuService,s?this._getTabActions():void 0)}i.preventDefault(),i.stopImmediatePropagation(),this._cancelContextMenu=!1})),this._register(O(document,"keydown",i=>{t.classList.toggle("alt-active",!!i.altKey)})),this._register(O(document,"keyup",i=>{t.classList.toggle("alt-active",!!i.altKey)})),this._register(O(e,"keyup",i=>{i.keyCode===27&&i.stopPropagation()})),this._register(O(this._tabContainer,De.FOCUS_IN,()=>{this._terminalTabsFocusContextKey.set(!0)})),this._register(O(this._tabContainer,De.FOCUS_OUT,()=>{this._terminalTabsFocusContextKey.set(!1)}))}_getTabActions(){return[new kt,this._configurationService.inspect("terminal.integrated.tabs.location").userValue==="left"?new j("moveRight",c("moveTabsRight","Move Tabs Right"),void 0,void 0,async()=>{this._configurationService.updateValue("terminal.integrated.tabs.location","right")}):new j("moveLeft",c("moveTabsLeft","Move Tabs Left"),void 0,void 0,async()=>{this._configurationService.updateValue("terminal.integrated.tabs.location","left")}),new j("hideTabs",c("hideTabs","Hide Tabs"),void 0,void 0,async()=>{this._configurationService.updateValue("terminal.integrated.tabs.enabled",!1)})]}setEditable(e){e||this._tabList.domFocus(),this._tabList.refresh(!1)}focusTabs(){if(!this._shouldShowTabs())return;this._terminalTabsFocusContextKey.set(!0);const e=this._tabList.getSelection();this._tabList.domFocus(),e&&this._tabList.setFocus(e)}focus(){if(this._terminalService.connectionState===0){const e=document.activeElement;this._register(this._terminalService.onDidChangeConnectionState(()=>{document.activeElement===e&&this._focus()}));return}this._focus()}focusHover(){if(this._shouldShowTabs()){this._tabList.focusHover();return}const e=this._terminalGroupService.activeInstance;e&&this._hoverService.showHover({...io(e),target:this._terminalContainer,trapFocus:!0},!0)}_focus(){var e;(e=this._terminalGroupService.activeInstance)==null||e.focusWhenReady()}};xr=w([d(1,J),d(2,he),d(3,B),d(4,se),d(5,Nt),d(6,X),d(7,Yn),d(8,bt),d(9,me),d(10,Vn)],xr);function Iu(){ve.appendMenuItems([{id:I.MenubarTerminalMenu,item:{group:"1_create",command:{id:"workbench.action.terminal.new",title:c({key:"miNewTerminal",comment:["&& denotes a mnemonic"]},"&&New Terminal")},order:1}},{id:I.MenubarTerminalMenu,item:{group:"1_create",command:{id:"workbench.action.terminal.split",title:c({key:"miSplitTerminal",comment:["&& denotes a mnemonic"]},"&&Split Terminal"),precondition:g.has("terminalIsOpen")},order:2,when:u.processSupported}},{id:I.MenubarTerminalMenu,item:{group:"2_run",command:{id:"workbench.action.terminal.runActiveFile",title:c({key:"miRunActiveFile",comment:["&& denotes a mnemonic"]},"Run &&Active File")},order:3,when:u.processSupported}},{id:I.MenubarTerminalMenu,item:{group:"2_run",command:{id:"workbench.action.terminal.runSelectedText",title:c({key:"miRunSelectedText",comment:["&& denotes a mnemonic"]},"Run &&Selected Text")},order:4,when:u.processSupported}}]),ve.appendMenuItems([{id:I.TerminalInstanceContext,item:{group:"1_create",command:{id:"workbench.action.terminal.split",title:x.split.value}}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.new",title:x.new},group:"1_create"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.kill",title:x.kill.value},group:"4_kill"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.copySelection",title:c("workbench.action.terminal.copySelection.short","Copy")},group:"2_edit",order:1}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.copySelectionAsHtml",title:c("workbench.action.terminal.copySelectionAsHtml","Copy as HTML")},group:"2_edit",order:2}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.paste",title:c("workbench.action.terminal.paste.short","Paste")},group:"2_edit",order:3}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.clear",title:c("workbench.action.terminal.clear","Clear")},group:"3_clear"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.showTabs",title:c("workbench.action.terminal.showsTabs","Show Tabs")},when:g.not("config.terminal.integrated.tabs.enabled"),group:"5_config"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.sizeToContentWidth",title:x.toggleSizeToContentWidth},group:"5_config"}},{id:I.TerminalInstanceContext,item:{command:{id:"workbench.action.terminal.selectAll",title:c("workbench.action.terminal.selectAll","Select All")},group:"2_edit",order:3}}]),ve.appendMenuItems([{id:I.TerminalEditorInstanceContext,item:{group:"1_create",command:{id:"workbench.action.terminal.split",title:x.split.value}}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.new",title:x.new},group:"1_create"}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.killEditor",title:x.kill.value},group:"4_kill"}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.copySelection",title:c("workbench.action.terminal.copySelection.short","Copy")},group:"2_edit",order:1}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.copySelectionAsHtml",title:c("workbench.action.terminal.copySelectionAsHtml","Copy as HTML")},group:"2_edit",order:2}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.paste",title:c("workbench.action.terminal.paste.short","Paste")},group:"2_edit",order:3}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.clear",title:c("workbench.action.terminal.clear","Clear")},group:"3_clear"}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.selectAll",title:c("workbench.action.terminal.selectAll","Select All")},group:"2_edit",order:3}},{id:I.TerminalEditorInstanceContext,item:{command:{id:"workbench.action.terminal.sizeToContentWidth",title:x.toggleSizeToContentWidth},group:"5_config"}}]),ve.appendMenuItems([{id:I.TerminalTabEmptyAreaContext,item:{command:{id:"workbench.action.terminal.newWithProfile",title:c("workbench.action.terminal.newWithProfile.short","New Terminal With Profile")},group:"1_create"}},{id:I.TerminalTabEmptyAreaContext,item:{command:{id:"workbench.action.terminal.new",title:x.new},group:"1_create"}}]),ve.appendMenuItems([{id:I.TerminalNewDropdownContext,item:{command:{id:"workbench.action.terminal.selectDefaultShell",title:{value:c("workbench.action.terminal.selectDefaultProfile","Select Default Profile"),original:"Select Default Profile"}},group:"3_configure"}},{id:I.TerminalNewDropdownContext,item:{command:{id:"workbench.action.terminal.openSettings",title:c("workbench.action.terminal.openSettings","Configure Terminal Settings")},group:"3_configure"}},{id:I.TerminalNewDropdownContext,item:{command:{id:"workbench.action.tasks.runTask",title:c("workbench.action.tasks.runTask","Run Task...")},when:po,group:"4_tasks",order:1}},{id:I.TerminalNewDropdownContext,item:{command:{id:"workbench.action.tasks.configureTaskRunner",title:c("workbench.action.tasks.configureTaskRunner","Configure Tasks...")},when:po,group:"4_tasks",order:2}}]),ve.appendMenuItems([{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.switchTerminal",title:{value:c("workbench.action.terminal.switchTerminal","Switch Terminal"),original:"Switch Terminal"}},group:"navigation",order:0,when:g.and(g.equals("view",K),g.not("config.terminal.integrated.tabs.enabled"))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.focus",title:x.focus},alt:{id:"workbench.action.terminal.split",title:x.split.value,icon:k.splitHorizontal},group:"navigation",order:0,when:g.and(g.equals("view",K),g.has("config.terminal.integrated.tabs.enabled"),g.or(g.and(g.equals("config.terminal.integrated.tabs.showActiveTerminal","singleTerminal"),g.equals("terminalCount",1)),g.and(g.equals("config.terminal.integrated.tabs.showActiveTerminal","singleTerminalOrNarrow"),g.or(g.equals("terminalCount",1),g.has("isTerminalTabsNarrow"))),g.and(g.equals("config.terminal.integrated.tabs.showActiveTerminal","singleGroup"),g.equals("terminalGroupCount",1)),g.equals("config.terminal.integrated.tabs.showActiveTerminal","always")))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.split",title:x.split,icon:k.splitHorizontal},group:"navigation",order:2,when:g.and(g.equals("view",K),g.notEquals("config.terminal.integrated.tabs.hideCondition","never"),g.or(g.not("config.terminal.integrated.tabs.enabled"),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleTerminal"),g.equals("terminalCount",1)),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleTerminalOrNarrow"),g.or(g.equals("terminalCount",1),g.has("isTerminalTabsNarrow"))),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleGroup"),g.equals("terminalGroupCount",1)),g.equals("config.terminal.integrated.tabs.showActions","always")))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.kill",title:x.kill,icon:k.trash},group:"navigation",order:3,when:g.and(g.equals("view",K),g.notEquals("config.terminal.integrated.tabs.hideCondition","never"),g.or(g.not("config.terminal.integrated.tabs.enabled"),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleTerminal"),g.equals("terminalCount",1)),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleTerminalOrNarrow"),g.or(g.equals("terminalCount",1),g.has("isTerminalTabsNarrow"))),g.and(g.equals("config.terminal.integrated.tabs.showActions","singleGroup"),g.equals("terminalGroupCount",1)),g.equals("config.terminal.integrated.tabs.showActions","always")))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.new",title:x.new,icon:k.plus},alt:{id:"workbench.action.terminal.split",title:x.split.value,icon:k.splitHorizontal},group:"navigation",order:0,when:g.and(g.equals("view",K),g.or(u.webExtensionContributedProfile,u.processSupported))}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.clear",title:c("workbench.action.terminal.clearLong","Clear Terminal"),icon:k.clearAll},group:"navigation",order:4,when:g.equals("view",K),isHiddenByDefault:!0}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.runActiveFile",title:c("workbench.action.terminal.runActiveFile","Run Active File"),icon:k.run},group:"navigation",order:5,when:g.equals("view",K),isHiddenByDefault:!0}},{id:I.ViewTitle,item:{command:{id:"workbench.action.terminal.runSelectedText",title:c("workbench.action.terminal.runSelectedText","Run Selected Text"),icon:k.selection},group:"navigation",order:6,when:g.equals("view",K),isHiddenByDefault:!0}}]),ve.appendMenuItems([{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.split",title:x.split.value},group:"1_create",order:1}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.moveToEditor",title:x.moveToEditor.value},group:"1_create",order:2}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.changeIconPanel",title:x.changeIcon.value},group:"2_edit"}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.changeColorPanel",title:x.changeColor.value},group:"2_edit"}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.renamePanel",title:x.rename.value},group:"2_edit"}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.sizeToContentWidthInstance",title:c("workbench.action.terminal.sizeToContentWidthInstance","Toggle Size to Content Width")},group:"2_edit"}},{id:I.TerminalInlineTabContext,item:{command:{id:"workbench.action.terminal.kill",title:x.kill.value},group:"4_kill"}}]),ve.appendMenuItems([{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.splitInstance",title:x.split.value},group:"1_create",order:1}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.moveToEditorInstance",title:x.moveToEditor.value},group:"1_create",order:2}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.renameInstance",title:c("workbench.action.terminal.renameInstance","Rename...")},group:"2_edit"}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.changeIconInstance",title:c("workbench.action.terminal.changeIcon","Change Icon...")},group:"2_edit"}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.changeColorInstance",title:c("workbench.action.terminal.changeColor","Change Color...")},group:"2_edit"}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.sizeToContentWidthInstance",title:c("workbench.action.terminal.sizeToContentWidthInstance","Toggle Size to Content Width")},group:"2_edit"}},{id:I.TerminalTabContext,item:{group:"5_config",command:{id:"workbench.action.terminal.joinInstance",title:c("workbench.action.terminal.joinInstance","Join Terminals")},when:u.tabsSingularSelection.toNegated()}},{id:I.TerminalTabContext,item:{group:"5_config",command:{id:"workbench.action.terminal.unsplitInstance",title:x.unsplit.value},when:g.and(u.tabsSingularSelection,u.splitTerminal)}},{id:I.TerminalTabContext,item:{command:{id:"workbench.action.terminal.killInstance",title:x.kill.value},group:"4_kill"}}]),ve.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.moveToTerminalPanel",title:x.moveToTerminalPanel},when:Ct.Scheme.isEqualTo($.vscodeTerminal),group:"2_files"}),ve.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.rename",title:x.rename},when:Ct.Scheme.isEqualTo($.vscodeTerminal),group:"3_files"}),ve.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.changeColor",title:x.changeColor},when:Ct.Scheme.isEqualTo($.vscodeTerminal),group:"3_files"}),ve.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.changeIcon",title:x.changeIcon},when:Ct.Scheme.isEqualTo($.vscodeTerminal),group:"3_files"}),ve.appendMenuItem(I.EditorTitleContext,{command:{id:"workbench.action.terminal.sizeToContentWidth",title:x.toggleSizeToContentWidth},when:Ct.Scheme.isEqualTo($.vscodeTerminal),group:"3_files"}),ve.appendMenuItem(I.EditorTitle,{command:{id:"workbench.action.createTerminalEditorSameGroup",title:x.new,icon:k.plus},alt:{id:"workbench.action.terminal.split",title:x.split.value,icon:k.splitHorizontal},group:"navigation",order:0,when:Ct.Scheme.isEqualTo($.vscodeTerminal)})}function Ir(r,e,t,i,n,s){let o=[],a=[];e=e.filter(f=>!f.isAutoDetected);const l=r===A.Editor||typeof r=="object"&&"viewColumn"in r&&r.viewColumn===Kr?{viewColumn:Nn}:{splitActiveTerminal:!0};for(const f of e){const _=f.profileName===t,S={config:f,location:r},y={config:f,location:l},M=f.profileName.replace(/[\n\r\t]/g,"");o.push(new j("workbench.action.terminal.newWithProfile",_?c("defaultTerminalProfile","{0} (Default)",M):M,void 0,!0,async()=>{const D=await n.createTerminal(S);n.setActiveInstance(D),await n.focusActiveInstance()})),a.push(new j("workbench.action.terminal.split",_?c("defaultTerminalProfile","{0} (Default)",M):M,void 0,!0,async()=>{const D=await n.createTerminal(y);n.setActiveInstance(D),await n.focusActiveInstance()}))}for(const f of i){const S=f.title===t?c("defaultTerminalProfile","{0} (Default)",f.title.replace(/[\n\r\t]/g,"")):f.title.replace(/[\n\r\t]/g,"");o.push(new j("contributed",S,void 0,!0,()=>n.createTerminal({config:{extensionIdentifier:f.extensionIdentifier,id:f.id,title:S},location:r}))),a.push(new j("contributed-split",S,void 0,!0,()=>n.createTerminal({config:{extensionIdentifier:f.extensionIdentifier,id:f.id,title:S},location:l})))}const h=o.find(f=>f.label.endsWith("(Default)"));h&&(o=o.filter(f=>f!==h).sort((f,_)=>f.label.localeCompare(_.label)),o.unshift(h)),o.length>0&&(o.push(new pa("split.profile",c("splitTerminal","Split Terminal"),a)),o.push(new kt));const m=s.getActions();o.push(...kt.join(...m.map(f=>f[1])));const p=a.find(f=>f.label.endsWith("(Default)"));return p&&(a=a.filter(f=>f!==p).sort((f,_)=>f.label.localeCompare(_.label)),a.unshift(p)),{dropdownAction:new j("refresh profiles","Launch Profile...","codicon-chevron-down",!0),dropdownMenuActions:o,className:`terminal-tab-actions-${n.resolveLocation(r)}`}}let kr=class extends Zc{get terminalTabbedView(){return this._terminalTabbedView}constructor(e,t,i,n,s,o,a,l,h,m,p,v,f,_,S,y,M,D){super(e,t,o,s,i,n,a,_,m,p),this._contextKeyService=i,this._configurationService=s,this._contextMenuService=o,this._instantiationService=a,this._terminalService=l,this._terminalGroupService=h,this._notificationService=v,this._keybindingService=f,this._menuService=S,this._terminalProfileService=y,this._terminalProfileResolverService=M,this._themeService=D,this._isWelcomeShowing=!1,this._register(this._terminalService.onDidRegisterProcessSupport(()=>{this._onDidChangeViewWelcomeState.fire()})),this._register(this._terminalService.onDidChangeInstances(()=>{this._isWelcomeShowing&&(this._isWelcomeShowing=!0,this._onDidChangeViewWelcomeState.fire(),!this._terminalTabbedView&&this._parentDomElement&&(this._createTabsView(),this.layoutBody(this._parentDomElement.offsetHeight,this._parentDomElement.offsetWidth)))})),this._dropdownMenu=this._register(this._menuService.createMenu(I.TerminalNewDropdownContext,this._contextKeyService)),this._singleTabMenu=this._register(this._menuService.createMenu(I.TerminalInlineTabContext,this._contextKeyService)),this._register(this._terminalProfileService.onDidChangeAvailableProfiles(R=>this._updateTabActionBar(R))),this._viewShowing=u.viewShowing.bindTo(this._contextKeyService),this._register(this.onDidChangeBodyVisibility(R=>{var N;R&&((N=this._terminalTabbedView)==null||N.rerenderTabs())})),this._register(this._configurationService.onDidChangeConfiguration(R=>{this._parentDomElement&&(R.affectsConfiguration("terminal.integrated.shellIntegration.decorationsEnabled")||R.affectsConfiguration("terminal.integrated.shellIntegration.enabled"))&&this._updateForShellIntegration(this._parentDomElement)})),this._register(this._terminalService.onDidCreateInstance(R=>{R.capabilities.onDidAddCapability(N=>{var C;N===2&&this._gutterDecorationsEnabled()&&((C=this._parentDomElement)==null||C.classList.add("shell-integration"))})}))}_updateForShellIntegration(e){e.classList.toggle("shell-integration",this._gutterDecorationsEnabled())}_gutterDecorationsEnabled(){const e=this._configurationService.getValue("terminal.integrated.shellIntegration.decorationsEnabled");return(e==="both"||e==="gutter")&&this._configurationService.getValue("terminal.integrated.shellIntegration.enabled")}_initializeTerminal(){this.isBodyVisible()&&this._terminalService.isProcessSupportRegistered&&this._terminalService.connectionState===1&&this._terminalService.restoredGroupCount===0&&this._terminalGroupService.groups.length===0&&this._terminalService.createTerminal({location:A.Panel})}renderBody(e){super.renderBody(e),this._parentDomElement||this._updateForShellIntegration(e),this._parentDomElement=e,this._parentDomElement.classList.add("integrated-terminal"),this._fontStyleElement=document.createElement("style"),this._instantiationService.createInstance(Pr,this._parentDomElement),this.shouldShowWelcome()||this._createTabsView(),this._parentDomElement.appendChild(this._fontStyleElement),this._register(this.configurationService.onDidChangeConfiguration(t=>{if((t.affectsConfiguration("terminal.integrated.fontFamily")||t.affectsConfiguration("editor.fontFamily"))&&!this._terminalService.configHelper.configFontIsMonospace()){const n=[{label:c("terminal.useMonospace","Use 'monospace'"),run:()=>this.configurationService.updateValue("terminal.integrated.fontFamily","monospace")}];this._notificationService.prompt(ne.Warning,c("terminal.monospaceOnly","The terminal only supports monospace fonts. Be sure to restart VS Code if this is a newly installed font."),n)}})),this._register(this.onDidChangeBodyVisibility(async t=>{if(this._viewShowing.set(t),t)this._terminalService.isProcessSupportRegistered||this._onDidChangeViewWelcomeState.fire(),this._initializeTerminal(),this._terminalGroupService.showPanel(!1);else for(const i of this._terminalGroupService.instances)i.resetFocusContextKey();this._terminalGroupService.updateVisibility()})),this._register(this._terminalService.onDidChangeConnectionState(()=>this._initializeTerminal())),this.layoutBody(this._parentDomElement.offsetHeight,this._parentDomElement.offsetWidth)}_createTabsView(){this._parentDomElement&&(this._terminalTabbedView=this.instantiationService.createInstance(xr,this._parentDomElement))}layoutBody(e,t){var i;super.layoutBody(e,t),(i=this._terminalTabbedView)==null||i.layout(t,e)}getActionViewItem(e){var t;switch(e.id){case"workbench.action.terminal.split":{const i=this,n=new class extends j{constructor(){super(e.id,e.label,e.class,e.enabled),this.checked=e.checked,this.tooltip=e.tooltip}dispose(){e.dispose()}async run(){const s=i._terminalGroupService.activeInstance;if(s){const o=await i._terminalService.createTerminal({location:{parentTerminal:s}});return o==null?void 0:o.focusWhenReady()}}};return new ma(e,n,{icon:!0,label:!1,keybinding:this._getKeybindingLabel(e)})}case"workbench.action.terminal.switchTerminal":return this._instantiationService.createInstance(Tr,e);case"workbench.action.terminal.focus":if(e instanceof bn){const i=[];return Ia(this._singleTabMenu,void 0,i),this._instantiationService.createInstance(Dr,e,i)}case"workbench.action.terminal.new":if(e instanceof bn){const i=Ir(A.Panel,this._terminalProfileService.availableProfiles,this._getDefaultProfileName(),this._terminalProfileService.contributedProfiles,this._terminalService,this._dropdownMenu);return(t=this._newDropdown)==null||t.dispose(),this._newDropdown=new Pa(e,i.dropdownAction,i.dropdownMenuActions,i.className,this._contextMenuService,{},this._keybindingService,this._notificationService,this._contextKeyService,this._themeService),this._updateTabActionBar(this._terminalProfileService.availableProfiles),this._newDropdown}}return super.getActionViewItem(e)}_getDefaultProfileName(){let e;try{e=this._terminalProfileService.getDefaultProfileName()}catch{e=this._terminalProfileResolverService.defaultProfileName}return e}_getKeybindingLabel(e){var t;return Qe((t=this._keybindingService.lookupKeybinding(e.id))==null?void 0:t.getLabel())}_updateTabActionBar(e){var i;const t=Ir(A.Panel,e,this._getDefaultProfileName(),this._terminalProfileService.contributedProfiles,this._terminalService,this._dropdownMenu);(i=this._newDropdown)==null||i.update(t.dropdownAction,t.dropdownMenuActions)}focus(){if(this._terminalService.connectionState===0){const e=document.activeElement;this._register(this._terminalService.onDidChangeConnectionState(()=>{document.activeElement===e&&this._terminalGroupService.showPanel(!0)}));return}this._terminalGroupService.showPanel(!0)}shouldShowWelcome(){return this._isWelcomeShowing=!this._terminalService.isProcessSupportRegistered&&this._terminalService.instances.length===0,this._isWelcomeShowing}};kr=w([d(1,At),d(2,me),d(3,Hi),d(4,X),d(5,Nt),d(6,B),d(7,J),d(8,he),d(9,de),d(10,ai),d(11,se),d(12,At),d(13,Gi),d(14,Yn),d(15,tt),d(16,vt),d(17,de)],kr);let Tr=class extends Hh{constructor(e,t,i,n,s){super(null,e,zo(t,i),i.activeGroupIndex,n,Gh,{ariaLabel:c("terminals","Open Terminals."),optionsAsChildren:!0}),this._terminalService=t,this._terminalGroupService=i,this._register(t.onDidChangeInstances(()=>this._updateItems(),this)),this._register(t.onDidChangeActiveGroup(()=>this._updateItems(),this)),this._register(t.onDidChangeActiveInstance(()=>this._updateItems(),this)),this._register(t.onDidChangeInstanceTitle(()=>this._updateItems(),this)),this._register(i.onDidChangeGroups(()=>this._updateItems(),this)),this._register(t.onDidChangeConnectionState(()=>this._updateItems(),this)),this._register(s.onDidChangeAvailableProfiles(()=>this._updateItems(),this)),this._register(t.onDidChangeInstancePrimaryStatus(()=>this._updateItems(),this))}render(e){super.render(e),e.classList.add("switch-terminal"),e.style.borderColor=en($h)}_updateItems(){const e=zo(this._terminalService,this._terminalGroupService);this.setOptions(e,this._terminalGroupService.activeGroupIndex)}};Tr=w([d(1,J),d(2,he),d(3,ya),d(4,tt)],Tr);function zo(r,e){let t;return r.connectionState===1?t=e.getGroupLabels().map(i=>({text:i})):t=[{text:c("terminalConnectingLabel","Starting...")}],t.push({text:Fa,isDisabled:!0}),t.push({text:Wa}),t}let Dr=class extends xa{constructor(e,t,i,n,s,o,a,l,h,m,p){super(e,{draggable:!0},i,n,s,o,h),this._actions=t,this._terminalService=a,this._terminalGroupService=l,this._commandService=m,this._instantiationService=p,this._elementDisposables=[],this._register(Q.debounce(Q.any(this._terminalService.onDidChangeInstancePrimaryStatus,this._terminalGroupService.onDidChangeActiveInstance,Q.map(this._terminalService.onDidChangeInstanceIcon,v=>v.instance),Q.map(this._terminalService.onDidChangeInstanceColor,v=>v.instance),this._terminalService.onDidChangeInstanceTitle,this._terminalService.onDidChangeInstanceCapability),(v,f)=>(v||(v=new Set),f&&v.add(f),v))(v=>{for(const f of v)this.updateLabel(f)})),this._register(Ce(()=>ee(this._elementDisposables)))}async onClick(e){e.altKey&&this._menuItemAction.alt?this._commandService.executeCommand(this._menuItemAction.alt.id,{target:A.Panel}):this._openContextMenu()}updateLabel(e){if(!(e&&e!==this._terminalGroupService.activeInstance)&&(this._elementDisposables.length===0&&this.element&&this.label&&(this._elementDisposables.push(O(this.element,De.CONTEXT_MENU,t=>{t.button===2&&(this._openContextMenu(),t.preventDefault())})),this._elementDisposables.push(O(this.element,De.AUXCLICK,t=>{if(t.button===1){const i=this._terminalGroupService.activeInstance;i&&this._terminalService.safeDisposeTerminal(i),t.preventDefault()}})),this._elementDisposables.push(O(this.element,De.DRAG_START,t=>{const i=this._terminalGroupService.activeInstance;t.dataTransfer&&i&&t.dataTransfer.setData("Terminals",JSON.stringify([i.resource.toString()]))}))),this.label)){const t=this.label,i=this._terminalGroupService.activeInstance;if(!i){xo(t,"");return}t.classList.add("single-terminal-tab");let n="";const s=i.statusList.primary;if(s){const l=Qa(s.severity);this._themeService.getColorTheme();const h=this._themeService.getColorTheme().getColor(l);h&&(n=h.toString())}t.style.color=n,xo(t,...zh(this._instantiationService.invokeFunction(ku,i,this._terminalService.configHelper.config.tabs.separator,E.isThemeIcon(this._commandAction.item.icon)?this._commandAction.item.icon:void 0))),this._altCommand&&(t.classList.remove(this._altCommand),this._altCommand=void 0),this._color&&(t.classList.remove(this._color),this._color=void 0),this._class&&(t.classList.remove(this._class),t.classList.remove("terminal-uri-icon"),this._class=void 0);const o=ut(i);o&&(this._color=o,t.classList.add(o));const a=Wt(i,this._themeService.getColorTheme().type);a&&(this._class=a==null?void 0:a[0],t.classList.add(...a)),this._commandAction.item.icon&&(this._altCommand="alt-command",t.classList.add(this._altCommand)),this._action.tooltip=Tu(i,this._terminalService.configHelper.config.tabs.separator),this.updateTooltip()}}_openContextMenu(){this._contextMenuService.showContextMenu({getAnchor:()=>this.element,getActions:()=>this._actions,getActionsContext:()=>this.label})}};Dr=w([d(2,At),d(3,se),d(4,me),d(5,de),d(6,J),d(7,he),d(8,Nt),d(9,pe),d(10,B)],Dr);function ku(r,e,t,i){if(!e||!e.title)return"";const n=E.isThemeIcon(e.icon)?e.icon.id:r.get(vt).getDefaultIcon().id,s=`$(${(i==null?void 0:i.id)||n}) ${nc(e,t)}`,o=e.statusList.primary;return o!=null&&o.icon?`${s} $(${o.icon.id})`:s}function Tu(r,e){var i;if(!r)return"";const t=[];return t.push(nc(r,e)+ic(r,!1)+tc(r,!1)),t.push(((i=r.statusList.primary)==null?void 0:i.tooltip)||""),t.filter(n=>n).join(`

`)}function nc(r,e){return r?r.description?`${r.title} ${e} ${r.description}`:r.title:""}let Pr=class extends va{constructor(e,t,i,n){super(t),this._themeService=t,this._terminalService=i,this._terminalGroupService=n,this._registerListeners(),this._styleElement=document.createElement("style"),e.appendChild(this._styleElement),this._register(Ce(()=>e.removeChild(this._styleElement))),this.updateStyles()}_registerListeners(){this._register(this._terminalService.onDidChangeInstanceIcon(()=>this.updateStyles())),this._register(this._terminalService.onDidChangeInstanceColor(()=>this.updateStyles())),this._register(this._terminalService.onDidChangeInstances(()=>this.updateStyles())),this._register(this._terminalGroupService.onDidChangeGroups(()=>this.updateStyles()))}updateStyles(){super.updateStyles();const e=this._themeService.getColorTheme();let t="";for(const i of this._terminalService.instances){const n=i.icon;if(!n)continue;let s;n instanceof L?s=n:n instanceof Object&&"light"in n&&"dark"in n&&(s=e.type===ba.LIGHT?n.light:n.dark);const o=Wt(i,e.type);s instanceof L&&o&&o.length>1&&(t+=`.monaco-workbench .${o[0]} .monaco-highlighted-label .codicon, .monaco-action-bar .terminal-uri-icon.single-terminal-tab.action-label:not(.alt-command) .codicon{background-image: ${wa(s)};}`)}for(const i of this._terminalService.instances){const n=ut(i);if(!n||!i.color)continue;const s=e.getColor(i.color);s&&(t+=`.monaco-workbench .${n} .codicon:first-child:not(.codicon-split-horizontal):not(.codicon-trashcan):not(.file-icon){ color: ${s} !important; }`)}this._styleElement.textContent=t}};Pr=w([d(1,de),d(2,J),d(3,he)],Pr);function Du(){Pu()}function Pu(){for(let r=0;r<9;r++){const e=r,t=r+1;ka.registerCommandAndKeybindingRule({id:`workbench.action.terminal.focusAtIndex${t}`,weight:200,when:void 0,primary:0,handler:i=>(i.get(he).setActiveInstanceByIndex(e),i.get(he).showPanel(!0))})}}const sc=`
- `+["`${cwd}`: "+c("cwd","the terminal's current working directory"),"`${cwdFolder}`: "+c("cwdFolder","the terminal's current working directory, displayed for multi-root workspaces or in a single root workspace when the value differs from the initial working directory. On Windows, this will only be displayed when shell integration is enabled."),"`${workspaceFolder}`: "+c("workspaceFolder","the workspace in which the terminal was launched"),"`${local}`: "+c("local","indicates a local terminal in a remote workspace"),"`${process}`: "+c("process","the name of the terminal process"),"`${separator}`: "+c("separator","a conditional separator {0} that only shows when surrounded by variables with values or static text.","(` - `)"),"`${sequence}`: "+c("sequence","the name provided to the terminal by the process"),"`${task}`: "+c("task","indicates this terminal is associated with a task")].join(`
- `);let rc=c("terminalTitle","Controls the terminal title. Variables are substituted based on the context:");rc+=sc;let oc=c("terminalDescription","Controls the terminal description, which appears to the right of the title. Variables are substituted based on the context:");oc+=sc;const Au={id:"terminal",order:100,title:c("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{"terminal.integrated.sendKeybindingsToShell":{markdownDescription:c("terminal.integrated.sendKeybindingsToShell","Dispatches most keybindings to the terminal instead of the workbench, overriding {0}, which can be used alternatively for fine tuning.","`#terminal.integrated.commandsToSkipShell#`"),type:"boolean",default:!1},"terminal.integrated.tabs.defaultColor":{description:c("terminal.integrated.tabs.defaultColor","A theme color ID to associate with terminal icons by default."),...Ja,scope:4},"terminal.integrated.tabs.defaultIcon":{description:c("terminal.integrated.tabs.defaultIcon","A codicon ID to associate with terminal icons by default."),...Za,default:k.terminal.id,scope:4},"terminal.integrated.tabs.enabled":{description:c("terminal.integrated.tabs.enabled","Controls whether terminal tabs display as a list to the side of the terminal. When this is disabled a dropdown will display instead."),type:"boolean",default:!0},"terminal.integrated.tabs.enableAnimation":{description:c("terminal.integrated.tabs.enableAnimation","Controls whether terminal tab statuses support animation (eg. in progress tasks)."),type:"boolean",default:!0},"terminal.integrated.tabs.hideCondition":{description:c("terminal.integrated.tabs.hideCondition","Controls whether the terminal tabs view will hide under certain conditions."),type:"string",enum:["never","singleTerminal","singleGroup"],enumDescriptions:[c("terminal.integrated.tabs.hideCondition.never","Never hide the terminal tabs view"),c("terminal.integrated.tabs.hideCondition.singleTerminal","Hide the terminal tabs view when there is only a single terminal opened"),c("terminal.integrated.tabs.hideCondition.singleGroup","Hide the terminal tabs view when there is only a single terminal group opened")],default:"singleTerminal"},"terminal.integrated.tabs.showActiveTerminal":{description:c("terminal.integrated.tabs.showActiveTerminal","Shows the active terminal information in the view. This is particularly useful when the title within the tabs aren't visible."),type:"string",enum:["always","singleTerminal","singleTerminalOrNarrow","never"],enumDescriptions:[c("terminal.integrated.tabs.showActiveTerminal.always","Always show the active terminal"),c("terminal.integrated.tabs.showActiveTerminal.singleTerminal","Show the active terminal when it is the only terminal opened"),c("terminal.integrated.tabs.showActiveTerminal.singleTerminalOrNarrow","Show the active terminal when it is the only terminal opened or when the tabs view is in its narrow textless state"),c("terminal.integrated.tabs.showActiveTerminal.never","Never show the active terminal")],default:"singleTerminalOrNarrow"},"terminal.integrated.tabs.showActions":{description:c("terminal.integrated.tabs.showActions","Controls whether terminal split and kill buttons are displays next to the new terminal button."),type:"string",enum:["always","singleTerminal","singleTerminalOrNarrow","never"],enumDescriptions:[c("terminal.integrated.tabs.showActions.always","Always show the actions"),c("terminal.integrated.tabs.showActions.singleTerminal","Show the actions when it is the only terminal opened"),c("terminal.integrated.tabs.showActions.singleTerminalOrNarrow","Show the actions when it is the only terminal opened or when the tabs view is in its narrow textless state"),c("terminal.integrated.tabs.showActions.never","Never show the actions")],default:"singleTerminalOrNarrow"},"terminal.integrated.tabs.location":{type:"string",enum:["left","right"],enumDescriptions:[c("terminal.integrated.tabs.location.left","Show the terminal tabs view to the left of the terminal"),c("terminal.integrated.tabs.location.right","Show the terminal tabs view to the right of the terminal")],default:"right",description:c("terminal.integrated.tabs.location","Controls the location of the terminal tabs, either to the left or right of the actual terminal(s).")},"terminal.integrated.tabFocusMode":{markdownDescription:c("tabFocusMode","Controls whether the terminal receives tabs or defers them to the workbench for navigation. When set, this overrides {0} when the terminal is focused.","`#editor.tabFocusMode#`"),type:["boolean","null"],default:null},"terminal.integrated.defaultLocation":{type:"string",enum:["editor","view"],enumDescriptions:[c("terminal.integrated.defaultLocation.editor","Create terminals in the editor"),c("terminal.integrated.defaultLocation.view","Create terminals in the terminal view")],default:"view",description:c("terminal.integrated.defaultLocation","Controls where newly created terminals will appear.")},"terminal.integrated.tabs.focusMode":{type:"string",enum:["singleClick","doubleClick"],enumDescriptions:[c("terminal.integrated.tabs.focusMode.singleClick","Focus the terminal when clicking a terminal tab"),c("terminal.integrated.tabs.focusMode.doubleClick","Focus the terminal when double-clicking a terminal tab")],default:"doubleClick",description:c("terminal.integrated.tabs.focusMode","Controls whether focusing the terminal of a tab happens on double or single click.")},"terminal.integrated.macOptionIsMeta":{description:c("terminal.integrated.macOptionIsMeta","Controls whether to treat the option key as the meta key in the terminal on macOS."),type:"boolean",default:!1},"terminal.integrated.macOptionClickForcesSelection":{description:c("terminal.integrated.macOptionClickForcesSelection","Controls whether to force selection when using Option+click on macOS. This will force a regular (line) selection and disallow the use of column selection mode. This enables copying and pasting using the regular terminal selection, for example, when mouse mode is enabled in tmux."),type:"boolean",default:!1},"terminal.integrated.altClickMovesCursor":{markdownDescription:c("terminal.integrated.altClickMovesCursor","If enabled, alt/option + click will reposition the prompt cursor to underneath the mouse when {0} is set to {1} (the default value). This may not work reliably depending on your shell.","`#editor.multiCursorModifier#`","`'alt'`"),type:"boolean",default:!0},"terminal.integrated.copyOnSelection":{description:c("terminal.integrated.copyOnSelection","Controls whether text selected in the terminal will be copied to the clipboard."),type:"boolean",default:!1},"terminal.integrated.enableMultiLinePasteWarning":{markdownDescription:c("terminal.integrated.enableMultiLinePasteWarning",`Show a warning dialog when pasting multiple lines into the terminal. The dialog does not show when:

- Bracketed paste mode is enabled (the shell supports multi-line paste natively)
- The paste is handled by the shell's readline (in the case of pwsh)`),type:"boolean",default:!0},"terminal.integrated.drawBoldTextInBrightColors":{description:c("terminal.integrated.drawBoldTextInBrightColors",'Controls whether bold text in the terminal will always use the "bright" ANSI color variant.'),type:"boolean",default:!0},"terminal.integrated.fontFamily":{markdownDescription:c("terminal.integrated.fontFamily","Controls the font family of the terminal. Defaults to {0}'s value.","`#editor.fontFamily#`"),type:"string"},"terminal.integrated.fontSize":{description:c("terminal.integrated.fontSize","Controls the font size in pixels of the terminal."),type:"number",default:Ee?12:14,minimum:6,maximum:100},"terminal.integrated.letterSpacing":{description:c("terminal.integrated.letterSpacing","Controls the letter spacing of the terminal. This is an integer value which represents the number of additional pixels to add between characters."),type:"number",default:Qo},"terminal.integrated.lineHeight":{description:c("terminal.integrated.lineHeight","Controls the line height of the terminal. This number is multiplied by the terminal font size to get the actual line-height in pixels."),type:"number",default:Jo},"terminal.integrated.minimumContrastRatio":{markdownDescription:c("terminal.integrated.minimumContrastRatio",`When set, the foreground color of each cell will change to try meet the contrast ratio specified. Note that this will not apply to \`powerline\` characters per #146406. Example values:

- 1: Do nothing and use the standard theme colors.
- 4.5: [WCAG AA compliance (minimum)](https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html) (default).
- 7: [WCAG AAA compliance (enhanced)](https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast7.html).
- 21: White on black or black on white.`),type:"number",default:4.5,tags:["accessibility"]},"terminal.integrated.tabStopWidth":{markdownDescription:c("terminal.integrated.tabStopWidth","The number of cells in a tab stop."),type:"number",minimum:1,default:8},"terminal.integrated.fastScrollSensitivity":{markdownDescription:c("terminal.integrated.fastScrollSensitivity","Scrolling speed multiplier when pressing `Alt`."),type:"number",default:5},"terminal.integrated.mouseWheelScrollSensitivity":{markdownDescription:c("terminal.integrated.mouseWheelScrollSensitivity","A multiplier to be used on the `deltaY` of mouse wheel scroll events."),type:"number",default:1},"terminal.integrated.bellDuration":{markdownDescription:c("terminal.integrated.bellDuration","The number of milliseconds to show the bell within a terminal tab when triggered."),type:"number",default:1e3},"terminal.integrated.fontWeight":{anyOf:[{type:"number",minimum:Ss,maximum:Cs,errorMessage:c("terminal.integrated.fontWeightError",'Only "normal" and "bold" keywords or numbers between 1 and 1000 are allowed.')},{type:"string",pattern:"^(normal|bold|1000|[1-9][0-9]{0,2})$"},{enum:fo}],description:c("terminal.integrated.fontWeight",'The font weight to use within the terminal for non-bold text. Accepts "normal" and "bold" keywords or numbers between 1 and 1000.'),default:"normal"},"terminal.integrated.fontWeightBold":{anyOf:[{type:"number",minimum:Ss,maximum:Cs,errorMessage:c("terminal.integrated.fontWeightError",'Only "normal" and "bold" keywords or numbers between 1 and 1000 are allowed.')},{type:"string",pattern:"^(normal|bold|1000|[1-9][0-9]{0,2})$"},{enum:fo}],description:c("terminal.integrated.fontWeightBold",'The font weight to use within the terminal for bold text. Accepts "normal" and "bold" keywords or numbers between 1 and 1000.'),default:"bold"},"terminal.integrated.cursorBlinking":{description:c("terminal.integrated.cursorBlinking","Controls whether the terminal cursor blinks."),type:"boolean",default:!1},"terminal.integrated.cursorStyle":{description:c("terminal.integrated.cursorStyle","Controls the style of terminal cursor."),enum:[zi.BLOCK,zi.LINE,zi.UNDERLINE],default:zi.BLOCK},"terminal.integrated.cursorWidth":{markdownDescription:c("terminal.integrated.cursorWidth","Controls the width of the cursor when {0} is set to {1}.","`#terminal.integrated.cursorStyle#`","`line`"),type:"number",default:1},"terminal.integrated.scrollback":{description:c("terminal.integrated.scrollback","Controls the maximum number of lines the terminal keeps in its buffer. We pre-allocate memory based on this value in order to ensure a smooth experience. As such, as the value increases, so will the amount of memory."),type:"number",default:1e3},"terminal.integrated.detectLocale":{markdownDescription:c("terminal.integrated.detectLocale","Controls whether to detect and set the `$LANG` environment variable to a UTF-8 compliant option since VS Code's terminal only supports UTF-8 encoded data coming from the shell."),type:"string",enum:["auto","off","on"],markdownEnumDescriptions:[c("terminal.integrated.detectLocale.auto","Set the `$LANG` environment variable if the existing variable does not exist or it does not end in `'.UTF-8'`."),c("terminal.integrated.detectLocale.off","Do not set the `$LANG` environment variable."),c("terminal.integrated.detectLocale.on","Always set the `$LANG` environment variable.")],default:"auto"},"terminal.integrated.gpuAcceleration":{type:"string",enum:["auto","on","off","canvas"],markdownEnumDescriptions:[c("terminal.integrated.gpuAcceleration.auto","Let VS Code detect which renderer will give the best experience."),c("terminal.integrated.gpuAcceleration.on","Enable GPU acceleration within the terminal."),c("terminal.integrated.gpuAcceleration.off","Disable GPU acceleration within the terminal. The terminal will render much slower when GPU acceleration is off but it should reliably work on all systems."),c("terminal.integrated.gpuAcceleration.canvas","Use the terminal's fallback canvas renderer which uses a 2d context instead of webgl which may perform better on some systems. Note that some features are limited in the canvas renderer like opaque selection.")],default:"auto",description:c("terminal.integrated.gpuAcceleration","Controls whether the terminal will leverage the GPU to do its rendering.")},"terminal.integrated.tabs.separator":{type:"string",default:" - ",markdownDescription:c("terminal.integrated.tabs.separator","Separator used by {0} and {0}.","`terminal.integrated.tabs.title`","`terminal.integrated.tabs.description`")},"terminal.integrated.tabs.title":{type:"string",default:"${process}",markdownDescription:rc},"terminal.integrated.tabs.description":{type:"string",default:"${task}${separator}${local}${separator}${cwdFolder}",markdownDescription:oc},"terminal.integrated.rightClickBehavior":{type:"string",enum:["default","copyPaste","paste","selectWord","nothing"],enumDescriptions:[c("terminal.integrated.rightClickBehavior.default","Show the context menu."),c("terminal.integrated.rightClickBehavior.copyPaste","Copy when there is a selection, otherwise paste."),c("terminal.integrated.rightClickBehavior.paste","Paste on right click."),c("terminal.integrated.rightClickBehavior.selectWord","Select the word under the cursor and show the context menu."),c("terminal.integrated.rightClickBehavior.nothing","Do nothing and pass event to terminal.")],default:Ee?"selectWord":re?"copyPaste":"default",description:c("terminal.integrated.rightClickBehavior","Controls how terminal reacts to right click.")},"terminal.integrated.cwd":{restricted:!0,description:c("terminal.integrated.cwd","An explicit start path where the terminal will be launched, this is used as the current working directory (cwd) for the shell process. This may be particularly useful in workspace settings if the root directory is not a convenient cwd."),type:"string",default:void 0,scope:4},"terminal.integrated.confirmOnExit":{description:c("terminal.integrated.confirmOnExit","Controls whether to confirm when the window closes if there are active terminal sessions."),type:"string",enum:["never","always","hasChildProcesses"],enumDescriptions:[c("terminal.integrated.confirmOnExit.never","Never confirm."),c("terminal.integrated.confirmOnExit.always","Always confirm if there are terminals."),c("terminal.integrated.confirmOnExit.hasChildProcesses","Confirm if there are any terminals that have child processes.")],default:"never"},"terminal.integrated.confirmOnKill":{description:c("terminal.integrated.confirmOnKill","Controls whether to confirm killing terminals when they have child processes. When set to editor, terminals in the editor area will be marked as changed when they have child processes. Note that child process detection may not work well for shells like Git Bash which don't run their processes as child processes of the shell."),type:"string",enum:["never","editor","panel","always"],enumDescriptions:[c("terminal.integrated.confirmOnKill.never","Never confirm."),c("terminal.integrated.confirmOnKill.editor","Confirm if the terminal is in the editor."),c("terminal.integrated.confirmOnKill.panel","Confirm if the terminal is in the panel."),c("terminal.integrated.confirmOnKill.always","Confirm if the terminal is either in the editor or panel.")],default:"editor"},"terminal.integrated.enableBell":{description:c("terminal.integrated.enableBell","Controls whether the terminal bell is enabled. This shows up as a visual bell next to the terminal's name."),type:"boolean",default:!1},"terminal.integrated.commandsToSkipShell":{markdownDescription:c("terminal.integrated.commandsToSkipShell",`A set of command IDs whose keybindings will not be sent to the shell but instead always be handled by VS Code. This allows keybindings that would normally be consumed by the shell to act instead the same as when the terminal is not focused, for example \`Ctrl+P\` to launch Quick Open.

&nbsp;

Many commands are skipped by default. To override a default and pass that command's keybinding to the shell instead, add the command prefixed with the \`-\` character. For example add \`-workbench.action.quickOpen\` to allow \`Ctrl+P\` to reach the shell.

&nbsp;

The following list of default skipped commands is truncated when viewed in Settings Editor. To see the full list, {1} and search for the first command from the list below.

&nbsp;

Default Skipped Commands:

{0}`,ra.sort().map(r=>`- ${r}`).join(`
`),`[${c("openDefaultSettingsJson","open the default settings JSON")}](command:workbench.action.openRawDefaultSettings '${c("openDefaultSettingsJson.capitalized","Open Default Settings (JSON)")}')`),type:"array",items:{type:"string"},default:[]},"terminal.integrated.allowChords":{markdownDescription:c("terminal.integrated.allowChords","Whether or not to allow chord keybindings in the terminal. Note that when this is true and the keystroke results in a chord it will bypass {0}, setting this to false is particularly useful when you want ctrl+k to go to your shell (not VS Code).","`#terminal.integrated.commandsToSkipShell#`"),type:"boolean",default:!0},"terminal.integrated.allowMnemonics":{markdownDescription:c("terminal.integrated.allowMnemonics","Whether to allow menubar mnemonics (for example Alt+F) to trigger the open of the menubar. Note that this will cause all alt keystrokes to skip the shell when true. This does nothing on macOS."),type:"boolean",default:!1},"terminal.integrated.env.osx":{restricted:!0,markdownDescription:c("terminal.integrated.env.osx","Object with environment variables that will be added to the VS Code process to be used by the terminal on macOS. Set to `null` to delete the environment variable."),type:"object",additionalProperties:{type:["string","null"]},default:{}},"terminal.integrated.env.linux":{restricted:!0,markdownDescription:c("terminal.integrated.env.linux","Object with environment variables that will be added to the VS Code process to be used by the terminal on Linux. Set to `null` to delete the environment variable."),type:"object",additionalProperties:{type:["string","null"]},default:{}},"terminal.integrated.env.windows":{restricted:!0,markdownDescription:c("terminal.integrated.env.windows","Object with environment variables that will be added to the VS Code process to be used by the terminal on Windows. Set to `null` to delete the environment variable."),type:"object",additionalProperties:{type:["string","null"]},default:{}},"terminal.integrated.environmentChangesIndicator":{markdownDescription:c("terminal.integrated.environmentChangesIndicator","Whether to display the environment changes indicator on each terminal which explains whether extensions have made, or want to make changes to the terminal's environment."),type:"string",enum:["off","on","warnonly"],enumDescriptions:[c("terminal.integrated.environmentChangesIndicator.off","Disable the indicator."),c("terminal.integrated.environmentChangesIndicator.on","Enable the indicator."),c("terminal.integrated.environmentChangesIndicator.warnonly","Only show the warning indicator when a terminal's environment is 'stale', not the information indicator that shows a terminal has had its environment modified by an extension.")],default:"warnonly"},"terminal.integrated.environmentChangesRelaunch":{markdownDescription:c("terminal.integrated.environmentChangesRelaunch","Whether to relaunch terminals automatically if extension want to contribute to their environment and have not been interacted with yet."),type:"boolean",default:!0},"terminal.integrated.showExitAlert":{description:c("terminal.integrated.showExitAlert",'Controls whether to show the alert "The terminal process terminated with exit code" when exit code is non-zero.'),type:"boolean",default:!0},"terminal.integrated.splitCwd":{description:c("terminal.integrated.splitCwd","Controls the working directory a split terminal starts with."),type:"string",enum:["workspaceRoot","initial","inherited"],enumDescriptions:[c("terminal.integrated.splitCwd.workspaceRoot","A new split terminal will use the workspace root as the working directory. In a multi-root workspace a choice for which root folder to use is offered."),c("terminal.integrated.splitCwd.initial","A new split terminal will use the working directory that the parent terminal started with."),c("terminal.integrated.splitCwd.inherited","On macOS and Linux, a new split terminal will use the working directory of the parent terminal. On Windows, this behaves the same as initial.")],default:"inherited"},"terminal.integrated.windowsEnableConpty":{description:c("terminal.integrated.windowsEnableConpty","Whether to use ConPTY for Windows terminal process communication (requires Windows 10 build number 18309+). Winpty will be used if this is false."),type:"boolean",default:!0},"terminal.integrated.wordSeparators":{description:c("terminal.integrated.wordSeparators","A string containing all characters to be considered word separators by the double-click to select word feature."),type:"string",default:" ()[]{}',\"`─‘’|"},"terminal.integrated.enableFileLinks":{description:c("terminal.integrated.enableFileLinks","Whether to enable file links in terminals. Links can be slow when working on a network drive in particular because each file link is verified against the file system. Changing this will take effect only in new terminals."),type:"string",enum:["off","on","notRemote"],enumDescriptions:[c("enableFileLinks.off","Always off."),c("enableFileLinks.on","Always on."),c("enableFileLinks.notRemote","Enable only when not in a remote workspace.")],default:"on"},"terminal.integrated.unicodeVersion":{type:"string",enum:["6","11"],enumDescriptions:[c("terminal.integrated.unicodeVersion.six","Version 6 of Unicode. This is an older version which should work better on older systems."),c("terminal.integrated.unicodeVersion.eleven","Version 11 of Unicode. This version provides better support on modern systems that use modern versions of Unicode.")],default:"11",description:c("terminal.integrated.unicodeVersion","Controls what version of Unicode to use when evaluating the width of characters in the terminal. If you experience emoji or other wide characters not taking up the right amount of space or backspace either deleting too much or too little then you may want to try tweaking this setting.")},"terminal.integrated.localEchoLatencyThreshold":{description:c("terminal.integrated.localEchoLatencyThreshold","Length of network delay, in milliseconds, where local edits will be echoed on the terminal without waiting for server acknowledgement. If '0', local echo will always be on, and if '-1' it will be disabled."),type:"integer",minimum:-1,default:30},"terminal.integrated.localEchoEnabled":{markdownDescription:c("terminal.integrated.localEchoEnabled","When local echo should be enabled. This will override {0}","`#terminal.integrated.localEchoLatencyThreshold#`"),type:"string",enum:["on","off","auto"],enumDescriptions:[c("terminal.integrated.localEchoEnabled.on","Always enabled"),c("terminal.integrated.localEchoEnabled.off","Always disabled"),c("terminal.integrated.localEchoEnabled.auto","Enabled only for remote workspaces")],default:"auto"},"terminal.integrated.localEchoExcludePrograms":{description:c("terminal.integrated.localEchoExcludePrograms","Local echo will be disabled when any of these program names are found in the terminal title."),type:"array",items:{type:"string",uniqueItems:!0},default:el},"terminal.integrated.localEchoStyle":{description:c("terminal.integrated.localEchoStyle","Terminal style of locally echoed text; either a font style or an RGB color."),default:"dim",oneOf:[{type:"string",default:"dim",enum:["bold","dim","italic","underlined","inverted"]},{type:"string",format:"color-hex",default:"#ff0000"}]},"terminal.integrated.enablePersistentSessions":{description:c("terminal.integrated.enablePersistentSessions","Persist terminal sessions/history for the workspace across window reloads."),type:"boolean",default:!0},"terminal.integrated.persistentSessionReviveProcess":{markdownDescription:c("terminal.integrated.persistentSessionReviveProcess",`When the terminal process must be shut down (for example on window or application close), this determines when the previous terminal session contents/history should be restored and processes be recreated when the workspace is next opened.

Caveats:

- Restoring of the process current working directory depends on whether it is supported by the shell.
- Time to persist the session during shutdown is limited, so it may be aborted when using high-latency remote connections.`),type:"string",enum:["onExit","onExitAndWindowClose","never"],markdownEnumDescriptions:[c("terminal.integrated.persistentSessionReviveProcess.onExit","Revive the processes after the last window is closed on Windows/Linux or when the `workbench.action.quit` command is triggered (command palette, keybinding, menu)."),c("terminal.integrated.persistentSessionReviveProcess.onExitAndWindowClose","Revive the processes after the last window is closed on Windows/Linux or when the `workbench.action.quit` command is triggered (command palette, keybinding, menu), or when the window is closed."),c("terminal.integrated.persistentSessionReviveProcess.never","Never restore the terminal buffers or recreate the process.")],default:"onExit"},"terminal.integrated.customGlyphs":{description:c("terminal.integrated.customGlyphs","Whether to draw custom glyphs for block element and box drawing characters instead of using the font, which typically yields better rendering with continuous lines. Note that this doesn't work when {0} is disabled.","`#terminal.integrated.gpuAcceleration#`"),type:"boolean",default:!0},"terminal.integrated.autoReplies":{markdownDescription:c("terminal.integrated.autoReplies",`A set of messages that, when encountered in the terminal, will be automatically responded to. Provided the message is specific enough, this can help automate away common responses.

Remarks:

- Use {0} to automatically respond to the terminate batch job prompt on Windows.
- The message includes escape sequences so the reply might not happen with styled text.
- Each reply can only happen once every second.
- Use {1} in the reply to mean the enter key.
- To unset a default key, set the value to null.
- Restart VS Code if new don't apply.`,'`"Terminate batch job (Y/N)": "Y\\r"`','`"\\r"`'),type:"object",additionalProperties:{oneOf:[{type:"string",description:c("terminal.integrated.autoReplies.reply","The reply to send to the process.")},{type:"null"}]},default:{}},"terminal.integrated.shellIntegration.enabled":{restricted:!0,markdownDescription:c("terminal.integrated.shellIntegration.enabled",`Determines whether or not shell integration is auto-injected to support features like enhanced command tracking and current working directory detection. 

Shell integration works by injecting the shell with a startup script. The script gives VS Code insight into what is happening within the terminal.

Supported shells:

- Linux/macOS: bash, fish, pwsh, zsh
 - Windows: pwsh

This setting applies only when terminals are created, so you will need to restart your terminals for it to take effect.

 Note that the script injection may not work if you have custom arguments defined in the terminal profile, have enabled {1}, have a [complex bash \`PROMPT_COMMAND\`](https://code.visualstudio.com/docs/editor/integrated-terminal#_complex-bash-promptcommand), or other unsupported setup. To disable decorations, see {0}`,"`#terminal.integrated.shellIntegrations.decorationsEnabled#`","`#editor.accessibilitySupport#`"),type:"boolean",default:!0},"terminal.integrated.shellIntegration.decorationsEnabled":{restricted:!0,markdownDescription:c("terminal.integrated.shellIntegration.decorationsEnabled","When shell integration is enabled, adds a decoration for each command."),type:"string",enum:["both","gutter","overviewRuler","never"],enumDescriptions:[c("terminal.integrated.shellIntegration.decorationsEnabled.both","Show decorations in the gutter (left) and overview ruler (right)"),c("terminal.integrated.shellIntegration.decorationsEnabled.gutter","Show gutter decorations to the left of the terminal"),c("terminal.integrated.shellIntegration.decorationsEnabled.overviewRuler","Show overview ruler decorations to the right of the terminal"),c("terminal.integrated.shellIntegration.decorationsEnabled.never","Do not show decorations")],default:"both"},"terminal.integrated.shellIntegration.history":{restricted:!0,markdownDescription:c("terminal.integrated.shellIntegration.history","Controls the number of recently used commands to keep in the terminal command history. Set to 0 to disable terminal command history."),type:"number",default:100},"terminal.integrated.shellIntegration.suggestEnabled":{restricted:!0,markdownDescription:c("terminal.integrated.shellIntegration.suggestEnabled","Enables experimental terminal Intellisense suggestions for supported shells when {0} is set to {1}. If shell integration is installed manually, {2} needs to be set to {3} before calling the script.","`#terminal.integrated.shellIntegration.enabled#`","`true`","`VSCODE_SUGGEST`","`1`"),type:"boolean",default:!1},"terminal.integrated.smoothScrolling":{markdownDescription:c("terminal.integrated.smoothScrolling","Controls whether the terminal will scroll using an animation."),type:"boolean",default:!1},"terminal.integrated.enableImages":{restricted:!0,markdownDescription:c("terminal.integrated.enableImages","Enables image support in the terminal. Both sixel and iTerm's inline image protocol are supported on Linux and macOS, Windows support will light up automatically when ConPTY passes through the sequences. Images will currently not be restored between window reloads/reconnects."),type:"boolean",default:!0}}};function Eu(){fe.as(Yr.Configuration).registerConfiguration(Au)}let Ar=class extends tl{constructor(e,t,i,n,s,o,a,l,h,m,p,v,f){super(mn,e,t,i),this._terminalEditorService=n,this._terminalProfileResolverService=s,this._terminalService=o,this._instantiationService=h,this._contextMenuService=m,this._notificationService=p,this._terminalProfileService=v,this._workbenchLayoutService=f,this._editorInput=void 0,this._cancelContextMenu=!1,this._dropdownMenu=this._register(l.createMenu(I.TerminalNewDropdownContext,a)),this._instanceMenu=this._register(l.createMenu(I.TerminalEditorInstanceContext,a))}async setInput(e,t,i,n){var s,o,a,l;(o=(s=this._editorInput)==null?void 0:s.terminalInstance)==null||o.detachFromElement(),this._editorInput=e,await super.setInput(e,t,i,n),(a=this._editorInput.terminalInstance)==null||a.attachToElement(this._overflowGuardElement),this._lastDimension&&this.layout(this._lastDimension),(l=this._editorInput.terminalInstance)==null||l.setVisible(this.isVisible()&&this._workbenchLayoutService.isVisible("workbench.parts.editor")),this._editorInput.terminalInstance&&(this._register(this._editorInput.terminalInstance.onDidFocus(()=>this._setActiveInstance())),this._editorInput.setCopyLaunchConfig(this._editorInput.terminalInstance.shellLaunchConfig))}clearInput(){var e,t;super.clearInput(),(t=(e=this._editorInput)==null?void 0:e.terminalInstance)==null||t.detachFromElement(),this._editorInput=void 0}_setActiveInstance(){var e;(e=this._editorInput)!=null&&e.terminalInstance&&this._terminalEditorService.setActiveInstance(this._editorInput.terminalInstance)}focus(){var e,t;(t=(e=this._editorInput)==null?void 0:e.terminalInstance)==null||t.focus()}createEditor(e){this._editorInstanceElement=e,this._overflowGuardElement=Se(".terminal-overflow-guard.terminal-editor"),this._editorInstanceElement.appendChild(this._overflowGuardElement),this._registerListeners()}_registerListeners(){this._editorInstanceElement&&(this._register(O(this._editorInstanceElement,"mousedown",async e=>{if(this._terminalEditorService.instances.length!==0){if(e.which===2&&Kn){const t=this._terminalEditorService.activeInstance;t==null||t.focus()}else if(e.which===3){const t=this._terminalService.configHelper.config.rightClickBehavior;if(t==="nothing"){e.shiftKey||(this._cancelContextMenu=!0);return}else if(t==="copyPaste"||t==="paste"){const i=this._terminalEditorService.activeInstance;if(!i)return;if(t==="copyPaste"&&e.shiftKey){bi(e,this._editorInstanceElement,this._instanceMenu,this._contextMenuService);return}t==="copyPaste"&&i.hasSelection()?(await i.copySelection(),i.clearSelection()):Ut.clipboard.readText?i.paste():this._notificationService.info(`This browser doesn't support the clipboard.readText API needed to trigger a paste, try ${Ee?"⌘":"Ctrl"}+V instead.`),Ee&&setTimeout(()=>{i.clearSelection()},0),this._cancelContextMenu=!0}}}})),this._register(O(this._editorInstanceElement,"contextmenu",e=>{const t=this._terminalService.configHelper.config.rightClickBehavior;if(t==="nothing"&&!e.shiftKey){e.preventDefault(),e.stopImmediatePropagation(),this._cancelContextMenu=!1;return}else!this._cancelContextMenu&&t!=="copyPaste"&&t!=="paste"&&(this._cancelContextMenu||bi(e,this._editorInstanceElement,this._instanceMenu,this._contextMenuService),e.preventDefault(),e.stopImmediatePropagation(),this._cancelContextMenu=!1)})))}layout(e){var t,i;(i=(t=this._editorInput)==null?void 0:t.terminalInstance)==null||i.layout(e),this._lastDimension=e}setVisible(e,t){var i,n;super.setVisible(e,t),(n=(i=this._editorInput)==null?void 0:i.terminalInstance)==null||n.setVisible(e&&this._workbenchLayoutService.isVisible("workbench.parts.editor"))}getActionViewItem(e){switch(e.id){case"workbench.action.createTerminalEditor":if(e instanceof bn){const i=Ir({viewColumn:Kr},this._terminalProfileService.availableProfiles,this._getDefaultProfileName(),this._terminalProfileService.contributedProfiles,this._terminalService,this._dropdownMenu);return this._instantiationService.createInstance(Pa,e,i.dropdownAction,i.dropdownMenuActions,i.className,this._contextMenuService,{})}}return super.getActionViewItem(e)}_getDefaultProfileName(){let e;try{e=this._terminalProfileService.getDefaultProfileName()}catch{e=this._terminalProfileResolverService.defaultProfileName}return e}};Ar=w([d(0,ai),d(1,de),d(2,bt),d(3,Tt),d(4,vt),d(5,J),d(6,me),d(7,Yn),d(8,B),d(9,Nt),d(10,se),d(11,tt),d(12,Gn)],Ar);let Er=class extends H{constructor(e,t,i,n,s,o,a){super(),e.registerEditor(`${$.vscodeTerminal}:/**`,{id:mn,label:x.terminal,priority:sl.exclusive},{canSupportResource:l=>l.scheme===$.vscodeTerminal,singlePerResource:!0},{createEditorInput:async({resource:l,options:h})=>{let m=n.getInstanceFromResource(l);if(m){const f=o.getGroupForInstance(m);f==null||f.removeInstance(m)}else{const f=Zr(l);if(!f.instanceId)throw new Error("Terminal identifier without instanceId");const _=n.getPrimaryBackend();if(!_)throw new Error("No terminal primary backend");const S=await _.requestDetachInstance(f.workspaceId,f.instanceId);if(!S)throw new Error("No terminal persistent process to attach");m=a.createInstance({attachPersistentProcess:S},A.Editor)}const p=s.resolveResource(m);return{editor:s.getInputFromResource(p),options:{...h,pinned:!0,forceReload:!0,override:mn}}}}),i.registerFormatter({scheme:$.vscodeTerminal,formatting:{label:"${path}",separator:""}}),t.onDidCreateTerminal(async l=>{const h=await n.createTerminal({config:l,location:A.Panel});n.setActiveInstance(h),await n.revealActiveTerminal()})}};Er=w([d(0,il),d(1,nl),d(2,$i),d(3,J),d(4,Tt),d(5,he),d(6,He)],Er);const Lu=fe.as(Kh.Quickaccess),Ru="inTerminalPicker";Lu.registerQuickAccessProvider({ctor:ei,prefix:ei.PREFIX,contextKey:Ru,placeholder:c("tasksQuickAccessPlaceholder","Type the name of a terminal to open."),helpEntries:[{description:c("tasksQuickAccessHelp","Show All Opened Terminals"),commandId:"workbench.action.quickOpenTerm"}]});const Ko="workbench.action.quickOpenNavigateNextInTerminalPicker";jn.registerCommand({id:Ko,handler:Da(Ko,!0)});const Uo="workbench.action.quickOpenNavigatePreviousInTerminalPicker";jn.registerCommand({id:Uo,handler:Da(Uo,!1)});const Mu=fe.as(rl.Workbench);Mu.registerWorkbenchContribution(Er,3);pu();Eu();fe.as(ol.EditorPane).registerEditorPane(al.create(Ar,mn,x.terminal),[new be(Ae)]);fe.as(Uh.DragAndDropContribution).register({dataFormatKey:"Terminals",getEditorInputs(r){const e=[];try{const t=JSON.parse(r);for(const i of t)e.push({resource:L.parse(i)})}catch{}return e},setData(r,e){var i;const t=r.filter(({resource:n})=>n.scheme===$.vscodeTerminal);t.length&&((i=e.dataTransfer)==null||i.setData("Terminals",JSON.stringify(t.map(({resource:n})=>n.toString()))))}});const Fu=fe.as(aa.ViewContainersRegistry).registerViewContainer({id:K,title:c("terminal","Terminal"),icon:Aa,ctorDescriptor:new be(cl,[K,{mergeViewWithContainerWhenSingleView:!0}]),storageId:K,hideIfEmpty:!0,order:3},1,{doNotRegisterOpenCommand:!0,isDefault:!0});fe.as(aa.ViewsRegistry).registerViews([{id:K,name:c("terminal","Terminal"),containerIcon:Aa,canToggleVisibility:!1,canMoveView:!0,ctorDescriptor:new be(kr),openCommandActionDescriptor:{id:"workbench.action.terminal.toggleTerminal",mnemonicTitle:c({key:"miToggleIntegratedTerminal",comment:["&& denotes a mnemonic"]},"&&Terminal"),keybindings:{primary:2139,mac:{primary:347}},order:3}}],Fu);Id();function ie(r,e){ka.registerCommandAndKeybindingRule({id:"workbench.action.terminal.sendSequence",weight:200,when:e.when||u.focus,primary:e.primary,mac:e.mac,linux:e.linux,win:e.win,handler:Ba,args:{text:r}})}re&&ie(String.fromCharCode("V".charCodeAt(0)-64),{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),Te.negate()),primary:2100});ie("\x1B[24~a",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate()),primary:2058,mac:{primary:266}});ie("\x1B[24~b",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate()),primary:522});ie("\x1B[24~c",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate()),primary:1027});ie("\x1B[24~d",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate()),mac:{primary:3089}});ie("\x1B[24~e",{when:g.and(u.focus,g.equals("terminalShellType","pwsh"),u.terminalShellIntegrationEnabled,Te.negate(),g.equals("config.terminal.integrated.shellIntegration.suggestEnabled",!0)),primary:2058,mac:{primary:266}});ie("\x1B[1;2H",{when:g.and(u.focus,g.equals("terminalShellType","pwsh")),mac:{primary:3087}});ie("",{when:g.and(u.focus,Te),primary:2608,mac:{primary:816}});ie("\x07",{when:u.focus,primary:2597,mac:{primary:805}});da&&ie(String.fromCharCode("C".charCodeAt(0)-64),{when:g.and(u.focus),primary:289});ie(String.fromCharCode("W".charCodeAt(0)-64),{primary:2049,mac:{primary:513}});re&&ie(String.fromCharCode("H".charCodeAt(0)-64),{when:g.and(u.focus,g.equals("terminalShellType","cmd")),primary:2049});ie("\x1Bd",{primary:2068,mac:{primary:532}});ie("",{mac:{primary:2049}});ie(String.fromCharCode("A".charCodeAt(0)-64),{mac:{primary:2063}});ie(String.fromCharCode("E".charCodeAt(0)-64),{mac:{primary:2065}});ie("\0",{primary:3095,mac:{primary:1303}});ie("",{primary:3099,mac:{primary:1307}});ie("",{primary:2138,mac:{primary:346}});Du();Iu();ll();let Lr=class extends H{onClose(){this._instance.focus(),this.dispose()}constructor(e,t,i,n,s){super(),this._instance=e,this._keybindingService=n,this._accessibilityService=s,this._hasShellIntegration=!1,this.options={type:"helpMenu",ariaLabel:c("terminal-help-label","terminal accessibility help"),readMoreUrl:"https://code.visualstudio.com/docs/editor/accessibility#_terminal-accessibility"},this.id="terminal",this._hasShellIntegration=t.shellIntegration.status===2}_descriptionForCommand(e,t,i){const n=this._keybindingService.lookupKeybindings(e);switch(n.length){case 0:return Yi(i,e);case 1:return Yi(t,n[0].getAriaLabel())}return this._accessibilityService.isScreenReaderOptimized()?Yi(t,n[1].getAriaLabel()):Yi(t,n[0].getAriaLabel())}provideContent(){const e=[];return e.push(this._descriptionForCommand("workbench.action.terminal.focusAccessibleBuffer",c("focusAccessibleBuffer","The Focus Accessible Buffer ({0}) command enables screen readers to read terminal contents."),c("focusAccessibleBufferNoKb","The Focus Accessible Buffer command enables screen readers to read terminal contents and is currently not triggerable by a keybinding."))),this._instance.shellType==="cmd"&&e.push(c("commandPromptMigration","Consider using powershell instead of command prompt for an improved experience")),this._hasShellIntegration?(e.push(c("shellIntegration","The terminal has a feature called shell integration that offers an enhanced experience and provides useful commands for screen readers such as:")),e.push("- "+this._descriptionForCommand("workbench.action.terminal.accessibleBufferGoToNextCommand",c("goToNextCommand","Go to Next Command ({0})"),c("goToNextCommandNoKb","Go to Next Command is currently not triggerable by a keybinding."))),e.push("- "+this._descriptionForCommand("workbench.action.terminal.accessibleBufferGoToPreviousCommand",c("goToPreviousCommand","Go to Previous Command ({0})"),c("goToPreviousCommandNoKb","Go to Previous Command is currently not triggerable by a keybinding."))),e.push("- "+this._descriptionForCommand("workbench.action.terminal.navigateAccessibleBuffer",c("navigateAccessibleBuffer","Navigate Accessible Buffer ({0})"),c("navigateAccessibleBufferNoKb","Navigate Accessible Buffer is currently not triggerable by a keybinding."))),e.push("- "+this._descriptionForCommand("workbench.action.terminal.runRecentCommand",c("runRecentCommand","Run Recent Command ({0})"),c("runRecentCommandNoKb","Run Recent Command is currently not triggerable by a keybinding."))),e.push("- "+this._descriptionForCommand("workbench.action.terminal.goToRecentDirectory",c("goToRecentDirectory","Go to Recent Directory ({0})"),c("goToRecentDirectoryNoKb","Go to Recent Directory is currently not triggerable by a keybinding.")))):e.push(this._descriptionForCommand("workbench.action.terminal.runRecentCommand",c("goToRecentDirectoryNoShellIntegration","The Go to Recent Directory command ({0}) enables screen readers to easily navigate to a directory that has been used in the terminal."),c("goToRecentDirectoryNoKbNoShellIntegration","The Go to Recent Directory command enables screen readers to easily navigate to a directory that has been used in the terminal and is currently not triggerable by a keybinding."))),e.push(this._descriptionForCommand("workbench.action.terminal.openDetectedLink",c("openDetectedLink","The Open Detected Link ({0}) command enables screen readers to easily open links found in the terminal."),c("openDetectedLinkNoKb","The Open Detected Link command enables screen readers to easily open links found in the terminal and is currently not triggerable by a keybinding."))),e.push(this._descriptionForCommand("workbench.action.terminal.newWithProfile",c("newWithProfile","The Create New Terminal (With Profile) ({0}) command allows for easy terminal creation using a specific profile."),c("newWithProfileNoKb","The Create New Terminal (With Profile) command allows for easy terminal creation using a specific profile and is currently not triggerable by a keybinding."))),e.push(c("accessibilitySettings","Access accessibility settings such as `terminal.integrated.tabFocusMode` via the Preferences: Open Accessibility Settings command.")),e.join(`
`)}};Lr=w([d(2,B),d(3,At),d(4,fa)],Lr);let Rr=class{get lines(){return this._lines}constructor(e,t,i){this._xterm=e,this._logService=t,this._configurationService=i,this._priorEditorViewportLineCount=0,this._lines=[],this.bufferToEditorLineMapping=new Map}reset(){this._lines=[],this._lastCachedMarker=void 0,this.update()}update(){var e;(e=this._lastCachedMarker)!=null&&e.isDisposed&&(this._lines=[],this._lastCachedMarker=void 0),this._removeViewportContent(),this._updateCachedContent(),this._updateViewportContent(),this._lastCachedMarker=this._xterm.raw.registerMarker(),this._logService.debug("Buffer content tracker: set ",this._lines.length," lines")}_updateCachedContent(){var h,m;const e=this._xterm.raw.buffer.active,t=(h=this._lastCachedMarker)!=null&&h.line?this._lastCachedMarker.line-this._xterm.raw.rows+1:0,i=e.baseY;if(t<0||t>i)return;const s=this._configurationService.getValue("terminal.integrated.scrollback")+this._xterm.raw.rows-1,o=i-t;if(o+this._lines.length>s){const p=o+this._lines.length-s;for(let v=0;v<p;v++)this._lines.shift();this._logService.debug("Buffer content tracker: removed ",p," lines from top of cached lines, now ",this._lines.length," lines")}const a=[];let l="";for(let p=t;p<i;p++){const v=e.getLine(p);if(!v)continue;this.bufferToEditorLineMapping.set(p,this._lines.length+a.length);const f=(m=e.getLine(p+1))==null?void 0:m.isWrapped;l+=v.translateToString(!f),(l&&!f||p===e.baseY+this._xterm.raw.rows-1)&&v.length&&(a.push(l),l="")}this._logService.debug("Buffer content tracker:",a.length," lines cached"),this._lines.push(...a)}_removeViewportContent(){if(!this._lines.length)return;let e=this._priorEditorViewportLineCount,t=1;for(;e;)this.bufferToEditorLineMapping.forEach((i,n)=>{i===this._lines.length-t&&this.bufferToEditorLineMapping.delete(n)}),this._lines.pop(),t++,e--;this._logService.debug("Buffer content tracker: removed lines from viewport, now ",this._lines.length," lines cached")}_updateViewportContent(){var i;const e=this._xterm.raw.buffer.active;this._priorEditorViewportLineCount=0;let t="";for(let n=e.baseY;n<e.baseY+this._xterm.raw.rows;n++){const s=e.getLine(n);if(!s)continue;this.bufferToEditorLineMapping.set(n,this._lines.length);const o=(i=e.getLine(n+1))==null?void 0:i.isWrapped;t+=s.translateToString(!o),(t&&!o||n===e.baseY+this._xterm.raw.rows-1)&&t.length&&(this._priorEditorViewportLineCount++,this._lines.push(t),t="")}this._logService.debug("Viewport content update complete, ",this._lines.length," lines in the viewport")}};Rr=w([d(1,it),d(2,X)],Rr);let Mr=class extends mt{get element(){return this._element}get editorWidget(){return this._editorWidget}constructor(e,t,i,n,s,o,a,l,h){super(),this._className=e,this._instance=t,this._xterm=i,this._focusContextKey=n,this._instantiationService=s,this._modelService=o,this._configurationService=a,this._contextKeyService=l,this._terminalService=h,this._listeners=[],this._xtermElement=i.raw.element,this._element=document.createElement("div"),this._element.setAttribute("role","document"),this._element.classList.add(e),this._element.classList.add("terminal-accessible-widget"),this._editorContainer=document.createElement("div");const m={contributions:qh.getSomeEditorContributions([jh.ID,hl,"editor.contrib.selectionAnchorController"])},p=i.getFont(),v={...dl(this._configurationService),lineDecorationsWidth:6,dragAndDrop:!0,cursorWidth:1,fontSize:p.fontSize,lineHeight:p.charHeight?p.charHeight*p.lineHeight:1,letterSpacing:p.letterSpacing,fontFamily:p.fontFamily,wrappingStrategy:"advanced",wrappingIndent:"none",padding:{top:2,bottom:2},quickSuggestions:!1,renderWhitespace:"none",dropIntoEditor:{enabled:!0},readOnly:!0};this._editorWidget=this.add(this._instantiationService.createInstance(Xh,this._editorContainer,v,m)),this._element.replaceChildren(this._editorContainer),this._xtermElement.insertAdjacentElement("beforebegin",this._element),this._focusContextKey&&(this._focusTracker=this.add(Yh(this._editorContainer)),this._focusedContextKey=this._focusContextKey.bindTo(this._contextKeyService),this.add(this._focusTracker.onDidFocus(()=>{var f;return(f=this._focusedContextKey)==null?void 0:f.set(!0)})),this.add(this._focusTracker.onDidBlur(()=>{var f;return(f=this._focusedContextKey)==null?void 0:f.reset()}))),this.add(Q.runAndSubscribe(this._xterm.raw.onResize,()=>this.layout())),this.add(this._configurationService.onDidChangeConfiguration(f=>{if(f.affectedKeys.has("terminal.integrated.fontFamily")||f.affectedKeys.has("terminal.integrated.fontSize")||f.affectedKeys.has("terminal.integrated.lineHeight")||f.affectedKeys.has("terminal.integrated.letterSpacing")){const _=this._xterm.getFont();this._editorWidget.updateOptions({fontFamily:_.fontFamily,fontSize:_.fontSize,lineHeight:_.charHeight?_.charHeight*_.lineHeight:1,letterSpacing:_.letterSpacing})}})),this.add(this._editorWidget.onKeyDown(f=>{switch(f.keyCode){case 9:this.hide(),this._xterm.raw.focus();break;case 2:this.hide();break}})),this.add(this._editorWidget.onDidFocusEditorText(async()=>{this._terminalService.setActiveInstance(this._instance),this._xtermElement.classList.add("hide")}))}registerListeners(){this._listeners.push(this._instance.onDidRequestFocus(()=>this.editorWidget.focus()))}layout(){this._editorWidget.layout({width:this._xtermElement.clientWidth,height:this._xtermElement.clientHeight})}async show(){this.registerListeners(),await this.updateEditor(),this.element.tabIndex=-1,this.layout(),this.element.classList.add("active"),this._xtermElement.classList.add("hide"),this.editorWidget.focus()}dispose(){this._disposeListeners(),super.dispose()}_disposeListeners(){for(const e of this._listeners)e.dispose()}hide(){this._disposeListeners(),this.element.classList.remove("active"),this._xtermElement.classList.remove("hide")}async getTextModel(e){const t=this._modelService.getModel(e);return t&&!t.isDisposed()?t:this._modelService.createModel(`${this._className}-${e.fragment}`,null,e,!1)}};Mr=w([d(4,B),d(5,Un),d(6,X),d(7,me),d(8,J)],Mr);let Fr=class extends Mr{constructor(e,t,i,n,s,o,a,l,h,m){super("accessible-buffer",e,t,u.accessibleBufferFocus,i,n,s,l,m),this._quickInputService=o,this._audioCueService=a,this._logService=h,this._isUpdating=!1,this._pendingUpdates=0,this._bufferTracker=i.createInstance(Rr,t),this.element.ariaRoleDescription=c("terminal.integrated.accessibleBuffer","Terminal buffer"),this.updateEditor(),this.add(this.editorWidget.onDidFocusEditorText(async()=>{this.element.classList.contains("active")||(this.registerListeners(),await this.updateEditor(),this.element.classList.add("active"))}))}navigateToCommand(e){var s,o;const t=((s=this.editorWidget.getPosition())==null?void 0:s.lineNumber)||((o=this._getDefaultCursorPosition())==null?void 0:o.lineNumber),i=this._getCommandsWithEditorLine();if(!(i!=null&&i.length)||!t)return;const n=e==="previous"?i.filter(a=>a.lineNumber<t).sort((a,l)=>l.lineNumber-a.lineNumber):i.filter(a=>a.lineNumber>t).sort((a,l)=>a.lineNumber-l.lineNumber);n.length&&(this._cursorPosition={lineNumber:n[0].lineNumber,column:1},this._resetPosition())}_getEditorLineForCommand(e){var i;let t=(i=e.marker)==null?void 0:i.line;if(!(t===void 0||!e.command.length||t<0)&&(t=this._bufferTracker.bufferToEditorLineMapping.get(t),t!==void 0))return t+1}_getCommandsWithEditorLine(){var i;const e=(i=this._instance.capabilities.get(2))==null?void 0:i.commands;if(!(e!=null&&e.length))return;const t=[];for(const n of e){const s=this._getEditorLineForCommand(n);s&&t.push({command:n,lineNumber:s})}return t}async createQuickPick(){this._cursorPosition=Qe(this.editorWidget.getPosition());const e=this._getCommandsWithEditorLine();if(!e)return;const t=[];for(const{command:n,lineNumber:s}of e)this._getEditorLineForCommand(n)&&t.push({label:c("terminal.integrated.symbolQuickPick.labelNoExitCode","{0}",n.command),lineNumber:s,exitCode:n.exitCode});const i=this._quickInputService.createQuickPick();return i.canSelectMany=!1,i.onDidChangeActive(()=>{const n=i.activeItems[0];n&&(n.exitCode&&this._audioCueService.playAudioCue(Xr.error,!0),this.editorWidget.revealLine(n.lineNumber,0))}),i.onDidHide(()=>{this._resetPosition(),i.dispose()}),i.onDidAccept(()=>{const n=i.activeItems[0];this.editorWidget.getModel()&&(!n&&this._cursorPosition?this._resetPosition():this._cursorPosition={lineNumber:n.lineNumber,column:1},i.dispose(),this.editorWidget.focus())}),i.items=t.reverse(),i}_resetPosition(){this._cursorPosition=this._cursorPosition??this._getDefaultCursorPosition(),this._cursorPosition&&(this.editorWidget.setPosition(this._cursorPosition),this.editorWidget.setScrollPosition({scrollTop:this.editorWidget.getTopForLineNumber(this._cursorPosition.lineNumber)}))}layout(){this._bufferTracker&&this._bufferTracker.reset(),super.layout()}async updateEditor(e){if(this._isUpdating){this._pendingUpdates++;return}this._isUpdating=!0,await this._updateModel(e)&&(this._isUpdating=!1,this._pendingUpdates&&(this._logService.debug("TerminalAccessibleBuffer._updateEditor: pending updates",this._pendingUpdates),this._pendingUpdates--,await this.updateEditor(e)))}registerListeners(){super.registerListeners(),this._xterm.raw.onWriteParsed(async()=>{this._xterm.raw.buffer.active.baseY===0&&await this.updateEditor(!0)});const e=Q.latch(this._xterm.raw.onScroll);this._listeners.push(e(async()=>await this.updateEditor(!0)))}_getDefaultCursorPosition(){var t;const e=(t=this.editorWidget.getModel())==null?void 0:t.getLineCount();return e?{lineNumber:e,column:1}:void 0}async _updateModel(e){var h,m;const t=this._bufferTracker.lines.length;this._bufferTracker.update();const i=this._bufferTracker.lines.length,n=t!==i;let s;e&&(s=Qe(this.editorWidget.saveViewState()));let o=this.editorWidget.getModel();const a=this._bufferTracker.lines.join(`
`);o?o.setValue(a):o=await this.getTextModel(this._instance.resource.with({fragment:`accessible-buffer-${a}`})),this.editorWidget.setModel(o);const l=((h=this.editorWidget.getPosition())==null?void 0:h.lineNumber)===1&&((m=this.editorWidget.getPosition())==null?void 0:m.column)===1;if(s)this.editorWidget.restoreViewState(s);else if(n||l){const p=this._getDefaultCursorPosition();p&&(this.editorWidget.setPosition(p),this.editorWidget.setScrollPosition({scrollTop:this.editorWidget.getTopForLineNumber(p.lineNumber)}))}return o}};Fr=w([d(2,B),d(3,Un),d(4,X),d(5,le),d(6,jr),d(7,me),d(8,it),d(9,J)],Fr);let Ze=class ac extends mt{static get(e){return e.getContribution(ac.ID)}constructor(e,t,i,n){super(),this._instance=e,this._instantiationService=n}layout(e){this._accessibleBufferWidget||(this._accessibleBufferWidget=this.add(this._instantiationService.createInstance(Fr,this._instance,e)))}async show(){var e;await((e=this._accessibleBufferWidget)==null?void 0:e.show())}async createCommandQuickPick(){var e;return(e=this._accessibleBufferWidget)==null?void 0:e.createQuickPick()}navigateToCommand(e){var t;return(t=this._accessibleBufferWidget)==null?void 0:t.navigateToCommand(e)}};Ze.ID="terminal.accessible-buffer";Ze=w([d(3,B)],Ze);qa(Ze.ID,Ze);class qo extends H{constructor(){super(),this._register(nd.addImplementation(105,"terminal",async e=>{const t=e.get(B),i=e.get(J),n=e.get(ml),s=await i.getActiveOrCreateInstance();await i.revealActiveTerminal();const o=s==null?void 0:s.xterm;o&&(n.registerProvider(t.createInstance(Lr,s,o)),n.show("terminal"))},u.focus))}}qa(qo.ID,qo);P({id:"workbench.action.terminal.focusAccessibleBuffer",title:{value:c("workbench.action.terminal.focusAccessibleBuffer","Focus Accessible Buffer"),original:"Focus Accessible Buffer"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:1026,weight:200,when:g.and(Te,ul,u.accessibleBufferFocus.negate())}],run:async r=>{var t;const e=await r.service.getActiveOrCreateInstance();await r.service.revealActiveTerminal(),e&&await((t=Ze.get(e))==null?void 0:t.show())}});P({id:"workbench.action.terminal.navigateAccessibleBuffer",title:{value:c("workbench.action.terminal.navigateAccessibleBuffer","Navigate Accessible Buffer"),original:"Navigate Accessible Buffer"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated),keybinding:[{primary:3117,weight:200+2,when:u.accessibleBufferFocus}],run:async r=>{var i;const e=await r.service.getActiveOrCreateInstance();if(await r.service.revealActiveTerminal(),!e)return;const t=await((i=Ze.get(e))==null?void 0:i.createCommandQuickPick());t==null||t.show()}});P({id:"workbench.action.terminal.accessibleBufferGoToNextCommand",title:{value:c("workbench.action.terminal.accessibleBufferGoToNextCommand","Accessible Buffer Go to Next Command"),original:"Accessible Buffer Go to Next Command"},precondition:g.or(u.processSupported,u.terminalHasBeenCreated,u.accessibleBufferFocus),keybinding:[{primary:2066,weight:200+2,when:u.accessibleBufferFocus}],run:async r=>{var t;const e=await r.service.getActiveOrCreateInstance();await r.service.revealActiveTerminal(),e&&await((t=Ze.get(e))==null?void 0:t.navigateToCommand("next"))}});P({id:"workbench.action.terminal.accessibleBufferGoToPreviousCommand",title:{value:c("workbench.action.terminal.accessibleBufferGoToPreviousCommand","Accessible Buffer Go to Previous Command"),original:"Accessible Buffer Go to Previous Command"},precondition:g.and(g.or(u.processSupported,u.terminalHasBeenCreated),u.accessibleBufferFocus),keybinding:[{primary:2064,weight:200+2,when:u.accessibleBufferFocus}],run:async r=>{var t;const e=await r.service.getActiveOrCreateInstance();await r.service.revealActiveTerminal(),e&&await((t=Ze.get(e))==null?void 0:t.navigateToCommand("previous"))}});class $m{constructor(){this.isResponsive=!0,this._whenConnected=new _a,this.restartPtyHost=Ne,this.remoteAuthority=void 0,this.onPtyHostUnresponsive=Q.None,this.onPtyHostResponsive=Q.None,this.onPtyHostRestart=Q.None,this.onDidRequestDetach=Q.None,this.attachToProcess=Ne,this.attachToRevivedProcess=Ne,this.listProcesses=Ne,this.getProfiles=async()=>[],this.getWslPath=Ne,this.getEnvironment=async()=>({}),this.getShellEnvironment=async()=>{},this.setTerminalLayoutInfo=async()=>{},this.updateTitle=async()=>{},this.updateIcon=async()=>{},this.getTerminalLayoutInfo=async()=>{},this.reduceConnectionGraceTime=Ne,this.requestDetachInstance=Ne,this.acceptDetachInstanceReply=Ne,this.persistTerminalState=Ne}get whenConnected(){return this._whenConnected.p}setConnected(){this._whenConnected.complete()}async getPerformanceMarks(){return[]}}class zm{constructor(e,t,i,n){this.id=e,this.pid=t,this.cwd=i,this.onData=n,this.onReady=new b,this.shouldPersist=!1,this.onProcessData=this.onData,this.onProcessReady=this.onReady.event,this.onDidChangeProperty=Q.None,this.onProcessExit=Q.None,this.processBinary=Ne,this.refreshProperty=async()=>{},setTimeout(()=>{this.onReady.fire({cwd:i,pid:t,windowsPty:void 0})})}acknowledgeDataEvent(){}async setUnicodeVersion(){}async getInitialCwd(){return this.cwd}async getCwd(){return this.cwd}async getLatency(){return 0}async updateProperty(){}}function Km(r){return fe.as(pi.Backend).registerTerminalBackend(r),{[J.toString()]:new be(Je),[it.toString()]:new be(vr),[Tt.toString()]:new be(dr),[he.toString()]:new be(gr),[He.toString()]:new be(pr),[tt.toString()]:new be(Mi),[oa.toString()]:new be(gl),[pl.toString()]:new be(vu),[vt.toString()]:new be(_r),[sa.toString()]:new be(Ft),[fl.toString()]:new be(bu)}}export{$m as SimpleTerminalBackend,zm as SimpleTerminalProcess,Km as default};
