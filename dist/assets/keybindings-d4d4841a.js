import{iu as x,_ as ne,h as S,iv as te,y as he,hR as fe,iw as Ce,ix as Ke}from"./index-5b71d1bd.js";import{db as j,di as _e,aW as ae,dm as le,av as k,bi as L,l6 as g,l4 as b,s0 as oe,li as m,bA as $,s1 as ge,s2 as ce,s3 as pe,l5 as A,s4 as ie,a_ as be,be as ue,cK as me,dq as Se,iC as Q,b8 as ve,aM as F,aD as E,aO as Le,br as V,d9 as ke,es as we,bW as Ie,ce as R,dj as Ae,aY as De,aZ as Te,bh as Ee,ex as B,e$ as Ue,f0 as Ge,fw as Me,hV as de,fg as se,bz as Pe,aa as $e,fu as z}from"./vendor-332432be.js";import"./workbench.contribution-30154607.js";import{s as xe}from"./logConstants-d978bbc0.js";function Fe(y){const e=y,t={};for(const o in e){const i=e[o];if(i.length){const n=i[0],r=i[1],a=i[2],c=i[3],f=Number(i[4]),l=i.length===6?i[5]:void 0;t[o]={value:n,vkey:l,withShift:r,withAltGr:a,withShiftAltGr:c,valueIsDeadKey:(f&1)>0,withShiftIsDeadKey:(f&2)>0,withAltGrIsDeadKey:(f&4)>0,withShiftAltGrIsDeadKey:(f&8)>0}}else t[o]={value:"",valueIsDeadKey:!1,withShift:"",withShiftIsDeadKey:!1,withAltGr:"",withAltGrIsDeadKey:!1,withShiftAltGr:"",withShiftAltGrIsDeadKey:!1}}return t}class W{constructor(e,t,o,i){this.layout=e,this.secondaryLayouts=t,this.mapping=Fe(o),this.isUserKeyboardLayout=!!i,this.layout.isUserKeyboardLayout=!!i}static createKeyboardLayoutFromDebugInfo(e,t,o){const i=new W(e,[],{},!0);return i.mapping=t,i}update(e){this.layout=e.layout,this.secondaryLayouts=e.secondaryLayouts,this.mapping=e.mapping,this.isUserKeyboardLayout=e.isUserKeyboardLayout,this.layout.isUserKeyboardLayout=e.isUserKeyboardLayout}getScore(e){let t=0;for(const o in e){if(j&&(o==="Backslash"||o==="KeyQ")||_e&&(o==="Backspace"||o==="Escape"))continue;const i=this.mapping[o];i===void 0&&(t-=1);const n=e[o];i&&n&&i.value!==n.value&&(t-=1)}return t}equal(e){return this.isUserKeyboardLayout!==e.isUserKeyboardLayout||x(this.layout)!==x(e.layout)?!1:this.fuzzyEqual(e.mapping)}fuzzyEqual(e){for(const t in e){if(j&&(t==="Backslash"||t==="KeyQ"))continue;if(this.mapping[t]===void 0)return!1;const o=this.mapping[t],i=e[t];if(o.value!==i.value)return!1}return!0}}function We(y){const e=y.getValue("keyboard"),t=(e==null?void 0:e.dispatch)==="keyCode"?1:0,o=!!(e!=null&&e.mapAltGrToCtrlAlt);return{dispatch:t,mapAltGrToCtrlAlt:o}}const Oe=ae.as(le.Configuration),Ye={id:"keyboard",order:15,type:"object",title:k("keyboardConfigurationTitle","Keyboard"),properties:{"keyboard.dispatch":{scope:1,type:"string",enum:["code","keyCode"],default:"code",markdownDescription:k("dispatch","Controls the dispatching logic for key presses to use either `code` (recommended) or `keyCode`."),included:L===2||L===3},"keyboard.mapAltGrToCtrlAlt":{scope:1,type:"boolean",default:!1,markdownDescription:k("mapAltGrToCtrlAlt","Controls if the AltGraph+ modifier should be treated as Ctrl+Alt+."),included:L===1}}};Oe.registerConfiguration(Ye);class Re{constructor(e){this._actual=e,this._cache=new Map}dumpDebugInfo(){return this._actual.dumpDebugInfo()}resolveKeyboardEvent(e){return this._actual.resolveKeyboardEvent(e)}resolveKeybinding(e){const t=e.getHashCode(),o=this._cache.get(t);if(!o){const i=this._actual.resolveKeybinding(e);return this._cache.set(t,i),i}return o}}class P extends ce{constructor(e,t){super(1,t),this._mapper=e}_getLabel(e){return e.isDuplicateModifierCase()?"":this._mapper.getUILabelForKeyCode(e.keyCode)}_getUSLabelForKeybinding(e){return e.isDuplicateModifierCase()?"":g.toString(e.keyCode)}getUSLabel(){return pe.toLabel(this._os,this._chords,e=>this._getUSLabelForKeybinding(e))}_getAriaLabel(e){return e.isDuplicateModifierCase()?"":this._mapper.getAriaLabelForKeyCode(e.keyCode)}_getElectronAccelerator(e){return this._mapper.getElectronAcceleratorForKeyBinding(e)}_getUserSettingsLabel(e){if(e.isDuplicateModifierCase())return"";const t=this._mapper.getUserSettingsLabelForKeyCode(e.keyCode);return t&&t.toLowerCase()}_isWYSIWYG(e){return this.__isWYSIWYG(e.keyCode)}__isWYSIWYG(e){if(e===15||e===16||e===17||e===18)return!0;const t=this._mapper.getAriaLabelForKeyCode(e),o=this._mapper.getUserSettingsLabelForKeyCode(e);return t===o}_getChordDispatch(e){if(e.isModifierKey())return null;let t="";return e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),e.metaKey&&(t+="meta+"),t+=g.toString(e.keyCode),t}_getSingleModifierChordDispatch(e){return e.keyCode===5&&!e.shiftKey&&!e.altKey&&!e.metaKey?"ctrl":e.keyCode===4&&!e.ctrlKey&&!e.altKey&&!e.metaKey?"shift":e.keyCode===6&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey?"alt":e.keyCode===57&&!e.ctrlKey&&!e.shiftKey&&!e.altKey?"meta":null}static getProducedCharCode(e,t){return t?e.ctrlKey&&e.shiftKey&&e.altKey?t.withShiftAltGr:e.ctrlKey&&e.altKey?t.withAltGr:e.shiftKey?t.withShift:t.value:null}static getProducedChar(e,t){const o=this.getProducedCharCode(e,t);return o===null||o.length===0?" --- ":"  "+o+"  "}}class Be{constructor(e,t,o){this._isUSStandard=e,this._mapAltGrToCtrlAlt=o,this._keyCodeToLabel=[],this._scanCodeToKeyCode=[],this._keyCodeToLabel=[],this._keyCodeExists=[],this._keyCodeToLabel[0]=g.toString(0);for(let a=0;a<193;a++){const c=m[a];c!==-1&&(this._scanCodeToKeyCode[a]=c,this._keyCodeToLabel[c]=g.toString(c),this._keyCodeExists[c]=!0)}const i=[];let n=!1;this._codeInfo=[];for(const a in t)if(t.hasOwnProperty(a)){const c=b.toEnum(a);if(c===0)continue;const f=t[a],l=m[c];if(l!==-1){const _=oe[f.vkey]||0;if(_===0||l===_||c!==134)continue}const s=f.value,u=f.withShift,h=f.withAltGr,K=f.withShiftAltGr,d=oe[f.vkey]||0,C={scanCode:c,keyCode:d,value:s,withShift:u,withAltGr:h,withShiftAltGr:K};if(this._codeInfo[c]=C,this._scanCodeToKeyCode[c]=d,d===0)continue;if(this._keyCodeExists[d]=!0,s.length===0)this._keyCodeToLabel[d]=null;else if(s.length>1)this._keyCodeToLabel[d]=s;else{const _=s.charCodeAt(0);if(_>=97&&_<=122){const v=65+(_-97);i[v]=!0,n=!0,this._keyCodeToLabel[d]=String.fromCharCode(65+(_-97))}else _>=65&&_<=90?(i[_]=!0,n=!0,this._keyCodeToLabel[d]=s):this._keyCodeToLabel[d]=s}}const r=(a,c)=>{i[a]||(this._keyCodeToLabel[c]=String.fromCharCode(a))};if(r(65,31),r(66,32),r(67,33),r(68,34),r(69,35),r(70,36),r(71,37),r(72,38),r(73,39),r(74,40),r(75,41),r(76,42),r(77,43),r(78,44),r(79,45),r(80,46),r(81,47),r(82,48),r(83,49),r(84,50),r(85,51),r(86,52),r(87,53),r(88,54),r(89,55),r(90,56),!n){const a=(c,f)=>{this._keyCodeToLabel[c]=String.fromCharCode(f)};a(85,59),a(86,61),a(87,44),a(88,45),a(89,46),a(90,47),a(91,96),a(92,91),a(93,92),a(94,93),a(95,39)}}dumpDebugInfo(){const e=[],t=[88,104];let o=0;e.push("-----------------------------------------------------------------------------------------------------------------------------------------");for(let i=0;i<193;i++){if(m[i]!==-1&&t.indexOf(i)===-1)continue;o%6===0&&(e.push("|       HW Code combination      |  Key  |    KeyCode combination    |          UI label         |        User settings       | WYSIWYG |"),e.push("-----------------------------------------------------------------------------------------------------------------------------------------")),o++;const n=this._codeInfo[i],r=b.toString(i),a=[0,2,5,7];for(const c of a){const f=!!(c&1),l=!!(c&2),s=!!(c&4),u=new A(f,l,s,!1,i),h=this._resolveChord(u),K=h?g.toString(h.keyCode):null,d=h?new P(this,[h]):null,C=`${f?"Ctrl+":""}${l?"Shift+":""}${s?"Alt+":""}${r}`,_=d?d.getAriaLabel():null,v=_?_.replace(/Control\+/,"Ctrl+"):null,Z=d?d.getUserSettingsLabel():null,U=P.getProducedChar(u,n),w=K?`${f?"Ctrl+":""}${l?"Shift+":""}${s?"Alt+":""}${K}`:null,O=(d?d.isWYSIWYG():!1)?"       ":"   NO  ";e.push(`| ${this._leftPad(C,30)} | ${U} | ${this._leftPad(w,25)} | ${this._leftPad(v,25)} |  ${this._leftPad(Z,25)} | ${O} |`)}e.push("-----------------------------------------------------------------------------------------------------------------------------------------")}return e.join(`
`)}_leftPad(e,t){for(e===null&&(e="null");e.length<t;)e=" "+e;return e}getUILabelForKeyCode(e){return this._getLabelForKeyCode(e)}getAriaLabelForKeyCode(e){return this._getLabelForKeyCode(e)}getUserSettingsLabelForKeyCode(e){return this._isUSStandard?g.toUserSettingsUS(e):g.toUserSettingsGeneral(e)}getElectronAcceleratorForKeyBinding(e){return g.toElectronAccelerator(e.keyCode)}_getLabelForKeyCode(e){return this._keyCodeToLabel[e]||g.toString(0)}resolveKeyboardEvent(e){const t=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,o=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,i=new $(t,e.shiftKey,o,e.metaKey,e.keyCode);return new P(this,[i])}_resolveChord(e){if(!e)return null;if(e instanceof $)return this._keyCodeExists[e.keyCode]?e:null;const t=this._scanCodeToKeyCode[e.scanCode]||0;return t===0||!this._keyCodeExists[t]?null:new $(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,t)}resolveKeybinding(e){const t=ge(e.chords.map(o=>this._resolveChord(o)));return t.length>0?[new P(this,t)]:[]}}const D=[];class re extends ce{constructor(e,t,o){super(t,o),this._mapper=e}_getLabel(e){return this._mapper.getUILabelForScanCodeChord(e)}_getAriaLabel(e){return this._mapper.getAriaLabelForScanCodeChord(e)}_getElectronAccelerator(e){return this._mapper.getElectronAcceleratorLabelForScanCodeChord(e)}_getUserSettingsLabel(e){return this._mapper.getUserSettingsLabelForScanCodeChord(e)}_isWYSIWYG(e){if(!e||m[e.scanCode]!==-1)return!0;const t=this._mapper.getAriaLabelForScanCodeChord(e),o=this._mapper.getUserSettingsLabelForScanCodeChord(e);return!t&&!o?!0:!t||!o?!1:t.toLowerCase()===o.toLowerCase()}_getChordDispatch(e){return this._mapper.getDispatchStrForScanCodeChord(e)}_getSingleModifierChordDispatch(e){return(e.scanCode===157||e.scanCode===161)&&!e.shiftKey&&!e.altKey&&!e.metaKey?"ctrl":(e.scanCode===159||e.scanCode===163)&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey?"alt":(e.scanCode===158||e.scanCode===162)&&!e.ctrlKey&&!e.altKey&&!e.metaKey?"shift":(e.scanCode===160||e.scanCode===164)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey?"meta":null}}class T{constructor(e,t,o,i){this.ctrlKey=e,this.shiftKey=t,this.altKey=o,this.scanCode=i}toString(){return`${this.ctrlKey?"Ctrl+":""}${this.shiftKey?"Shift+":""}${this.altKey?"Alt+":""}${b.toString(this.scanCode)}`}equals(e){return this.ctrlKey===e.ctrlKey&&this.shiftKey===e.shiftKey&&this.altKey===e.altKey&&this.scanCode===e.scanCode}getProducedCharCode(e){return e?this.ctrlKey&&this.shiftKey&&this.altKey?e.withShiftAltGr:this.ctrlKey&&this.altKey?e.withAltGr:this.shiftKey?e.withShift:e.value:""}getProducedChar(e){const t=p.getCharCode(this.getProducedCharCode(e));return t===0?" --- ":t>=768&&t<=879?"U+"+t.toString(16):"  "+String.fromCharCode(t)+"  "}}class q{constructor(e,t,o,i){this.ctrlKey=e,this.shiftKey=t,this.altKey=o,this.keyCode=i}toString(){return`${this.ctrlKey?"Ctrl+":""}${this.shiftKey?"Shift+":""}${this.altKey?"Alt+":""}${g.toString(this.keyCode)}`}}class ze{constructor(){this._scanCodeToKeyCode=[],this._keyCodeToScanCode=[],this._scanCodeToKeyCode=[],this._keyCodeToScanCode=[]}registrationComplete(){this._moveToEnd(56),this._moveToEnd(106)}_moveToEnd(e){for(let t=0;t<8;t++){const o=this._scanCodeToKeyCode[(e<<3)+t];if(o)for(let i=0,n=o.length;i<n;i++){const r=this._keyCodeToScanCode[o[i]];if(r.length!==1)for(let a=0,c=r.length;a<c;a++){const f=r[a];if(f>>>3===e){for(let s=a+1;s<c;s++)r[s-1]=r[s];r[c-1]=f}}}}}registerIfUnknown(e,t){if(t.keyCode===0)return;const o=this._encodeScanCodeCombo(e),i=this._encodeKeyCodeCombo(t),n=t.keyCode>=21&&t.keyCode<=30,r=t.keyCode>=31&&t.keyCode<=56,a=this._scanCodeToKeyCode[o];if(n||r){if(a){for(let c=0,f=a.length;c<f;c++)if(a[c]===i)return}}else if(a&&a.length!==0)return;this._scanCodeToKeyCode[o]=this._scanCodeToKeyCode[o]||[],this._scanCodeToKeyCode[o].unshift(i),this._keyCodeToScanCode[i]=this._keyCodeToScanCode[i]||[],this._keyCodeToScanCode[i].unshift(o)}lookupKeyCodeCombo(e){const t=this._encodeKeyCodeCombo(e),o=this._keyCodeToScanCode[t];if(!o||o.length===0)return[];const i=[];for(let n=0,r=o.length;n<r;n++){const a=o[n],c=!!(a&1),f=!!(a&2),l=!!(a&4),s=a>>>3;i[n]=new T(c,f,l,s)}return i}lookupScanCodeCombo(e){const t=this._encodeScanCodeCombo(e),o=this._scanCodeToKeyCode[t];if(!o||o.length===0)return[];const i=[];for(let n=0,r=o.length;n<r;n++){const a=o[n],c=!!(a&1),f=!!(a&2),l=!!(a&4),s=a>>>3;i[n]=new q(c,f,l,s)}return i}guessStableKeyCode(e){if(e>=36&&e<=45)switch(e){case 36:return 22;case 37:return 23;case 38:return 24;case 39:return 25;case 40:return 26;case 41:return 27;case 42:return 28;case 43:return 29;case 44:return 30;case 45:return 21}const t=this.lookupScanCodeCombo(new T(!1,!1,!1,e)),o=this.lookupScanCodeCombo(new T(!1,!0,!1,e));if(t.length===1&&o.length===1){const i=t[0].shiftKey,n=t[0].keyCode,r=o[0].shiftKey,a=o[0].keyCode;if(n===a&&i!==r)return n}return-1}_encodeScanCodeCombo(e){return this._encode(e.ctrlKey,e.shiftKey,e.altKey,e.scanCode)}_encodeKeyCodeCombo(e){return this._encode(e.ctrlKey,e.shiftKey,e.altKey,e.keyCode)}_encode(e,t,o,i){return((e?1:0)<<0|(t?1:0)<<1|(o?1:0)<<2|i<<3)>>>0}}class p{constructor(e,t,o,i){this._isUSStandard=e,this._mapAltGrToCtrlAlt=o,this._OS=i,this._scanCodeToLabel=[],this._scanCodeToDispatch=[],this._codeInfo=[],this._scanCodeKeyCodeMapper=new ze,this._scanCodeToLabel=[],this._scanCodeToDispatch=[];const n=(l,s,u,h,K,d,C,_)=>{this._scanCodeKeyCodeMapper.registerIfUnknown(new T(!!l,!!s,!!u,h),new q(!!K,!!d,!!C,_))},r=(l,s,u,h,K)=>{for(let d=l;d<=1;d++)for(let C=s;C<=1;C++)for(let _=u;_<=1;_++)n(d,C,_,h,d,C,_,K)};for(let l=0;l<193;l++)this._scanCodeToLabel[l]=null;for(let l=0;l<193;l++)this._scanCodeToDispatch[l]=null;for(let l=0;l<193;l++){const s=m[l];s!==-1&&(r(0,0,0,l,s),this._scanCodeToLabel[l]=g.toString(s),s===0||s===5||s===57||s===6||s===4?this._scanCodeToDispatch[l]=null:this._scanCodeToDispatch[l]=`[${b.toString(l)}]`)}const a={};{const l=[];for(const u in t)if(t.hasOwnProperty(u)){const h=b.toEnum(u);if(h===0||m[h]!==-1)continue;const K=t[u],d=p.getCharCode(K.value);if(d>=97&&d<=122){const C=65+(d-97);l[C]=!0}}const s=(u,h,K,d)=>{l[u]||(a[b.toString(h)]={value:K,withShift:d,withAltGr:"",withShiftAltGr:""})};s(65,10,"a","A"),s(66,11,"b","B"),s(67,12,"c","C"),s(68,13,"d","D"),s(69,14,"e","E"),s(70,15,"f","F"),s(71,16,"g","G"),s(72,17,"h","H"),s(73,18,"i","I"),s(74,19,"j","J"),s(75,20,"k","K"),s(76,21,"l","L"),s(77,22,"m","M"),s(78,23,"n","N"),s(79,24,"o","O"),s(80,25,"p","P"),s(81,26,"q","Q"),s(82,27,"r","R"),s(83,28,"s","S"),s(84,29,"t","T"),s(85,30,"u","U"),s(86,31,"v","V"),s(87,32,"w","W"),s(88,33,"x","X"),s(89,34,"y","Y"),s(90,35,"z","Z")}const c=[];let f=0;for(const l in t)if(t.hasOwnProperty(l)){const s=b.toEnum(l);if(s===0||m[s]!==-1)continue;this._codeInfo[s]=t[l];const u=a[l]||t[l],h=p.getCharCode(u.value),K=p.getCharCode(u.withShift),d=p.getCharCode(u.withAltGr),C=p.getCharCode(u.withShiftAltGr),_={scanCode:s,value:h,withShift:K,withAltGr:d,withShiftAltGr:C};if(c[f++]=_,this._scanCodeToDispatch[s]=`[${b.toString(s)}]`,h>=97&&h<=122){const v=65+(h-97);this._scanCodeToLabel[s]=String.fromCharCode(v)}else h>=65&&h<=90?this._scanCodeToLabel[s]=String.fromCharCode(h):h?this._scanCodeToLabel[s]=String.fromCharCode(h):this._scanCodeToLabel[s]=null}for(let l=c.length-1;l>=0;l--){const s=c[l],u=s.scanCode,h=s.withShiftAltGr;if(h===s.withAltGr||h===s.withShift||h===s.value)continue;const K=p._charCodeToKb(h);if(!K)continue;const d=K.shiftKey,C=K.keyCode;d?n(1,1,1,u,0,1,0,C):n(1,1,1,u,0,0,0,C)}for(let l=c.length-1;l>=0;l--){const s=c[l],u=s.scanCode,h=s.withAltGr;if(h===s.withShift||h===s.value)continue;const K=p._charCodeToKb(h);if(!K)continue;const d=K.shiftKey,C=K.keyCode;d?n(1,0,1,u,0,1,0,C):n(1,0,1,u,0,0,0,C)}for(let l=c.length-1;l>=0;l--){const s=c[l],u=s.scanCode,h=s.withShift;if(h===s.value)continue;const K=p._charCodeToKb(h);if(!K)continue;const d=K.shiftKey,C=K.keyCode;d?(n(0,1,0,u,0,1,0,C),n(0,1,1,u,0,1,1,C),n(1,1,0,u,1,1,0,C),n(1,1,1,u,1,1,1,C)):(n(0,1,0,u,0,0,0,C),n(0,1,0,u,0,1,0,C),n(0,1,1,u,0,0,1,C),n(0,1,1,u,0,1,1,C),n(1,1,0,u,1,0,0,C),n(1,1,0,u,1,1,0,C),n(1,1,1,u,1,0,1,C),n(1,1,1,u,1,1,1,C))}for(let l=c.length-1;l>=0;l--){const s=c[l],u=s.scanCode,h=p._charCodeToKb(s.value);if(!h)continue;const K=h.shiftKey,d=h.keyCode;K?(n(0,0,0,u,0,1,0,d),n(0,0,1,u,0,1,1,d),n(1,0,0,u,1,1,0,d),n(1,0,1,u,1,1,1,d)):(n(0,0,0,u,0,0,0,d),n(0,0,1,u,0,0,1,d),n(0,1,0,u,0,1,0,d),n(0,1,1,u,0,1,1,d),n(1,0,0,u,1,0,0,d),n(1,0,1,u,1,0,1,d),n(1,1,0,u,1,1,0,d),n(1,1,1,u,1,1,1,d))}r(0,0,0,36,22),r(0,0,0,37,23),r(0,0,0,38,24),r(0,0,0,39,25),r(0,0,0,40,26),r(0,0,0,41,27),r(0,0,0,42,28),r(0,0,0,43,29),r(0,0,0,44,30),r(0,0,0,45,21),this._scanCodeKeyCodeMapper.registrationComplete()}dumpDebugInfo(){const e=[],t=[88,104];let o=0;e.push(`isUSStandard: ${this._isUSStandard}`),e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------");for(let i=0;i<193;i++){if(m[i]!==-1&&t.indexOf(i)===-1)continue;o%4===0&&(e.push("|       HW Code combination      |  Key  |    KeyCode combination    | Pri |          UI label         |         User settings          |    Electron accelerator   |       Dispatching string       | WYSIWYG |"),e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------")),o++;const n=this._codeInfo[i];for(let r=0;r<8;r++){const a=!!(r&1),c=!!(r&2),f=!!(r&4),l=new T(a,c,f,i),s=this.resolveKeyboardEvent({_standardKeyboardEventBrand:!0,ctrlKey:l.ctrlKey,shiftKey:l.shiftKey,altKey:l.altKey,metaKey:!1,altGraphKey:!1,keyCode:-1,code:b.toString(i)}),u=l.toString(),h=l.getProducedChar(n),K=s.getAriaLabel(),d=K?K.replace(/Control\+/,"Ctrl+"):null,C=s.getUserSettingsLabel(),_=s.getElectronAccelerator(),v=s.getDispatchChords()[0],U=(s?s.isWYSIWYG():!1)?"       ":"   NO  ",w=this._scanCodeKeyCodeMapper.lookupScanCodeCombo(l);if(w.length===0)e.push(`| ${this._leftPad(u,30)} | ${h} | ${this._leftPad("",25)} | ${this._leftPad("",3)} | ${this._leftPad(d,25)} | ${this._leftPad(C,30)} | ${this._leftPad(_,25)} | ${this._leftPad(v,30)} | ${U} |`);else for(let I=0,O=w.length;I<O;I++){const J=w[I];let G;const Y=this._scanCodeKeyCodeMapper.lookupKeyCodeCombo(J);if(Y.length===1)G="";else{let ee=-1;for(let M=0;M<Y.length;M++)if(Y[M].equals(l)){ee=M+1;break}G=String(ee)}const X=J.toString();I===0?e.push(`| ${this._leftPad(u,30)} | ${h} | ${this._leftPad(X,25)} | ${this._leftPad(G,3)} | ${this._leftPad(d,25)} | ${this._leftPad(C,30)} | ${this._leftPad(_,25)} | ${this._leftPad(v,30)} | ${U} |`):e.push(`| ${this._leftPad("",30)} |       | ${this._leftPad(X,25)} | ${this._leftPad(G,3)} | ${this._leftPad("",25)} | ${this._leftPad("",30)} | ${this._leftPad("",25)} | ${this._leftPad("",30)} |         |`)}}e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------")}return e.join(`
`)}_leftPad(e,t){for(e===null&&(e="null");e.length<t;)e=" "+e;return e}keyCodeChordToScanCodeChord(e){if(e.keyCode===3)return[new A(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,46)];const t=this._scanCodeKeyCodeMapper.lookupKeyCodeCombo(new q(e.ctrlKey,e.shiftKey,e.altKey,e.keyCode)),o=[];for(let i=0,n=t.length;i<n;i++){const r=t[i];o[i]=new A(r.ctrlKey,r.shiftKey,r.altKey,e.metaKey,r.scanCode)}return o}getUILabelForScanCodeChord(e){if(!e)return null;if(e.isDuplicateModifierCase())return"";if(this._OS===2)switch(e.scanCode){case 86:return"←";case 88:return"↑";case 85:return"→";case 87:return"↓"}return this._scanCodeToLabel[e.scanCode]}getAriaLabelForScanCodeChord(e){return e?e.isDuplicateModifierCase()?"":this._scanCodeToLabel[e.scanCode]:null}getDispatchStrForScanCodeChord(e){const t=this._scanCodeToDispatch[e.scanCode];if(!t)return null;let o="";return e.ctrlKey&&(o+="ctrl+"),e.shiftKey&&(o+="shift+"),e.altKey&&(o+="alt+"),e.metaKey&&(o+="meta+"),o+=t,o}getUserSettingsLabelForScanCodeChord(e){if(!e)return null;if(e.isDuplicateModifierCase())return"";const t=m[e.scanCode];if(t!==-1)return g.toUserSettingsUS(t).toLowerCase();const o=this._scanCodeKeyCodeMapper.guessStableKeyCode(e.scanCode);if(o!==-1){const i=this.keyCodeChordToScanCodeChord(new $(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,o));for(let n=0,r=i.length;n<r;n++)if(i[n].scanCode===e.scanCode)return g.toUserSettingsUS(o).toLowerCase()}return this._scanCodeToDispatch[e.scanCode]}getElectronAcceleratorLabelForScanCodeChord(e){if(!e)return null;const t=m[e.scanCode];if(t!==-1)return g.toElectronAccelerator(t);const o=this._scanCodeKeyCodeMapper.guessStableKeyCode(e.scanCode);return this._OS===3&&!this._isUSStandard&&(o===85||o===86||o===87||o===88||o===89||o===90||o===91||o===92||o===93||o===94)?null:o!==-1?g.toElectronAccelerator(o):null}_toResolvedKeybinding(e){if(e.length===0)return[];const t=[];return this._generateResolvedKeybindings(e,0,[],t),t}_generateResolvedKeybindings(e,t,o,i){const n=e[t],r=t===e.length-1;for(let a=0,c=n.length;a<c;a++){const f=[...o,n[a]];r?i.push(new re(this,this._OS,f)):this._generateResolvedKeybindings(e,t+1,f,i)}}resolveKeyboardEvent(e){let t=b.toEnum(e.code);t===94&&(t=46);const o=e.keyCode;if(o===15||o===16||o===17||o===18||o===20||o===19||o===14||o===13||o===12||o===11||o===1){const a=ie[o];a!==-1&&(t=a)}else if((t===95||t===96||t===97||t===98||t===99||t===100||t===101||t===102||t===103||t===104||t===105)&&o>=0){const a=ie[o];a!==-1&&(t=a)}const i=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,n=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,r=new A(i,e.shiftKey,n,e.metaKey,t);return new re(this,this._OS,[r])}_resolveChord(e){return e?e instanceof A?[e]:this.keyCodeChordToScanCodeChord(e):[]}resolveKeybinding(e){const t=e.chords.map(o=>this._resolveChord(o));return this._toResolvedKeybinding(t)}static _redirectCharCode(e){switch(e){case 12290:return 46;case 12300:return 91;case 12301:return 93;case 12304:return 91;case 12305:return 93;case 65307:return 59;case 65292:return 44}return e}static _charCodeToKb(e){return e=this._redirectCharCode(e),e<D.length?D[e]:null}static getCharCode(e){if(e.length===0)return 0;const t=e.charCodeAt(0);switch(t){case 768:return 96;case 769:return 180;case 770:return 94;case 771:return 732;case 772:return 175;case 773:return 8254;case 774:return 728;case 775:return 729;case 776:return 168;case 778:return 730;case 779:return 733}return t}}(function(){function y(e,t,o){for(let i=D.length;i<e;i++)D[i]=null;D[e]={keyCode:t,shiftKey:o}}for(let e=65;e<=90;e++)y(e,31+(e-65),!0);for(let e=97;e<=122;e++)y(e,31+(e-97),!1);y(59,85,!1),y(58,85,!0),y(61,86,!1),y(43,86,!0),y(44,87,!1),y(60,87,!0),y(45,88,!1),y(95,88,!0),y(46,89,!1),y(62,89,!0),y(47,90,!1),y(63,90,!0),y(96,91,!1),y(126,91,!0),y(91,92,!1),y(123,92,!0),y(92,93,!1),y(124,93,!0),y(93,94,!1),y(125,94,!0),y(39,95,!1),y(34,95,!0)})();function je(y){switch(y){case"./keyboardLayouts/layout.contribution.darwin.js":return R(()=>import("./layout.contribution.darwin-4d95a593.js"),["assets/layout.contribution.darwin-4d95a593.js","assets/_.contribution-49d36299.js"]).then(e=>e.default??e);case"./keyboardLayouts/layout.contribution.linux.js":return R(()=>import("./layout.contribution.linux-60d75b79.js"),["assets/layout.contribution.linux-60d75b79.js","assets/_.contribution-49d36299.js"]).then(e=>e.default??e);case"./keyboardLayouts/layout.contribution.win.js":return R(()=>import("./layout.contribution.win-6e4f05fb.js"),["assets/layout.contribution.win-6e4f05fb.js","assets/_.contribution-49d36299.js"]).then(e=>e.default??e);default:return new Promise(function(e,t){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(t.bind(null,new Error("Unknown variable dynamic import: "+y)))})}}class Ve extends F{get activeKeymap(){return this._activeKeymapInfo}get keymapInfos(){return this._keymapInfos}get activeKeyboardLayout(){var e;return this._initialized?((e=this._activeKeymapInfo)==null?void 0:e.layout)??null:null}get activeKeyMapping(){var e;return this._initialized?((e=this._activeKeymapInfo)==null?void 0:e.mapping)??null:null}get keyboardLayouts(){return this._keymapInfos.map(e=>e.layout)}constructor(e){super(),this._configurationService=e,this._onDidChangeKeyboardMapper=new E,this.onDidChangeKeyboardMapper=this._onDidChangeKeyboardMapper.event,this._keyboardMapper=null,this._initialized=!1,this._keymapInfos=[],this._mru=[],this._activeKeymapInfo=null,navigator.keyboard&&navigator.keyboard.addEventListener&&navigator.keyboard.addEventListener("layoutchange",()=>{this._getBrowserKeyMapping().then(t=>{this.isKeyMappingActive(t)||this.setLayoutFromBrowserAPI()})}),this._register(this._configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration("keyboard")&&(this._keyboardMapper=null,this._onDidChangeKeyboardMapper.fire())}))}registerKeyboardLayout(e){this._keymapInfos.push(e),this._mru=this._keymapInfos}removeKeyboardLayout(e){let t=this._mru.indexOf(e);this._mru.splice(t,1),t=this._keymapInfos.indexOf(e),this._keymapInfos.splice(t,1)}getMatchedKeymapInfo(e){if(!e)return null;const t=this.getUSStandardLayout();if(t){let o=t.getScore(e);if(o===0)return{result:t,score:0};let i=t;for(let n=0;n<this._mru.length;n++){const r=this._mru[n].getScore(e);if(r>o){if(r===0)return{result:this._mru[n],score:0};o=r,i=this._mru[n]}}return{result:i,score:o}}for(let o=0;o<this._mru.length;o++)if(this._mru[o].fuzzyEqual(e))return{result:this._mru[o],score:0};return null}getUSStandardLayout(){const e=this._mru.filter(t=>t.layout.isUSStandard);return e.length?e[0]:null}isKeyMappingActive(e){return this._activeKeymapInfo&&e&&this._activeKeymapInfo.fuzzyEqual(e)}setUSKeyboardLayout(){this._activeKeymapInfo=this.getUSStandardLayout()}setActiveKeyMapping(e){let t=!1;const o=this.getMatchedKeymapInfo(e);if(o&&(this._activeKeymapInfo?e&&o.result.getScore(e)>this._activeKeymapInfo.getScore(e)&&(this._activeKeymapInfo=o.result,t=!0):(this._activeKeymapInfo=o.result,t=!0)),this._activeKeymapInfo||(this._activeKeymapInfo=this.getUSStandardLayout(),t=!0),!this._activeKeymapInfo||!t)return;const i=this._mru.indexOf(this._activeKeymapInfo);this._mru.splice(i,1),this._mru.unshift(this._activeKeymapInfo),this._setKeyboardData(this._activeKeymapInfo)}setActiveKeymapInfo(e){this._activeKeymapInfo=e;const t=this._mru.indexOf(this._activeKeymapInfo);t!==0&&(this._mru.splice(t,1),this._mru.unshift(this._activeKeymapInfo),this._setKeyboardData(this._activeKeymapInfo))}setLayoutFromBrowserAPI(){this._updateKeyboardLayoutAsync(this._initialized)}_updateKeyboardLayoutAsync(e,t){e&&this._getBrowserKeyMapping(t).then(o=>{this.isKeyMappingActive(o)||this.setActiveKeyMapping(o)})}getKeyboardMapper(){const e=We(this._configurationService);return e.dispatch===1||!this._initialized||!this._activeKeymapInfo?new te(e.mapAltGrToCtrlAlt,L):(this._keyboardMapper||(this._keyboardMapper=new Re(ye._createKeyboardMapper(this._activeKeymapInfo,e.mapAltGrToCtrlAlt))),this._keyboardMapper)}validateCurrentKeyboardMapping(e){!this._initialized||this._validateCurrentKeyboardMapping(e)||this._updateKeyboardLayoutAsync(!0,e)}setKeyboardLayout(e){const t=this.keymapInfos.filter(o=>x(o.layout)===e);t.length>0&&this.setActiveKeymapInfo(t[0])}_setKeyboardData(e){this._initialized=!0,this._keyboardMapper=null,this._onDidChangeKeyboardMapper.fire()}static _createKeyboardMapper(e,t){const o=e.mapping,i=!!e.layout.isUSStandard;return L===1?new Be(i,o,t):Object.keys(o).length===0?new te(t,L):new p(i,o,t,L)}_validateCurrentKeyboardMapping(e){if(!this._initialized)return!0;const t=e,o=this._activeKeymapInfo;if(!o||t.browserEvent.key==="Dead"||t.browserEvent.isComposing)return!0;const i=o.mapping[t.code];if(!i)return!1;if(i.value==="")return(e.ctrlKey||e.metaKey)&&setTimeout(()=>{this._getBrowserKeyMapping().then(a=>{this.isKeyMappingActive(a)||this.setLayoutFromBrowserAPI()})},350),!0;const n=t.altKey&&t.shiftKey?i.withShiftAltGr:t.altKey?i.withAltGr:t.shiftKey?i.withShift:i.value,r=t.altKey&&t.shiftKey&&i.withShiftAltGrIsDeadKey||t.altKey&&i.withAltGrIsDeadKey||t.shiftKey&&i.withShiftIsDeadKey||i.valueIsDeadKey;return!(r&&t.browserEvent.key!=="Dead"||!r&&t.browserEvent.key!==n)}async _getBrowserKeyMapping(e){if(navigator.keyboard)try{return navigator.keyboard.getLayoutMap().then(t=>{const o={};for(const i of t)o[i[0]]={value:i[1],withShift:"",withAltGr:"",withShiftAltGr:""};return o})}catch{}else if(e&&!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.metaKey){const t={},o=e;return t[o.browserEvent.code]={value:o.browserEvent.key,withShift:"",withAltGr:"",withShiftAltGr:""},this.getMatchedKeymapInfo(t)?t:null}return null}}class ye extends Ve{constructor(e,t,o,i){super(e),je("./keyboardLayouts/layout.contribution."+(j?"win":Ae?"darwin":"linux")+".js").then(r=>{const a=r.KeyboardLayoutContribution.INSTANCE.layoutInfos;this._keymapInfos.push(...a.map(c=>new W(c.layout,c.secondaryLayouts,c.mapping,c.isUserKeyboardLayout))),this._mru=this._keymapInfos,this._initialized=!0,this.setLayoutFromBrowserAPI()})}}class qe extends F{get keyboardLayout(){return this._keyboardLayout}constructor(e,t){super(),this.keyboardLayoutResource=e,this.fileService=t,this._onDidChange=this._register(new E),this.onDidChange=this._onDidChange.event,this._keyboardLayout=null,this.reloadConfigurationScheduler=this._register(new Le(()=>this.reload().then(o=>{o&&this._onDidChange.fire()}),50)),this._register(V.filter(this.fileService.onDidFilesChange,o=>o.contains(this.keyboardLayoutResource))(()=>this.reloadConfigurationScheduler.schedule()))}async initialize(){await this.reload()}async reload(){const e=this._keyboardLayout;try{const t=await this.fileService.readFile(this.keyboardLayoutResource),o=ke(t.value.toString());if(we(o)==="object"){const i=o.layout,n=o.rawMapping;this._keyboardLayout=W.createKeyboardLayoutFromDebugInfo(i,n,!0)}else this._keyboardLayout=null}catch{this._keyboardLayout=null}return e?!Ie(e,this._keyboardLayout):!0}}let N=class extends F{constructor(e,t,o,i,n,r){super(),this.configurationService=r,this._onDidChangeKeyboardLayout=new E,this.onDidChangeKeyboardLayout=this._onDidChangeKeyboardLayout.event;const c=r.getValue("keyboard").layout;this._keyboardLayoutMode=c??"autodetect",this._factory=new ye(r,o,i,n),this._register(this._factory.onDidChangeKeyboardMapper(()=>{this._onDidChangeKeyboardLayout.fire()})),c&&c!=="autodetect"&&this._factory.setKeyboardLayout(c),this._register(r.onDidChangeConfiguration(f=>{if(f.affectsConfiguration("keyboard.layout")){const s=r.getValue("keyboard").layout;this._keyboardLayoutMode=s,s==="autodetect"?this._factory.setLayoutFromBrowserAPI():this._factory.setKeyboardLayout(s)}})),this._userKeyboardLayout=new qe(e.keyboardLayoutResource,t),this._userKeyboardLayout.initialize().then(()=>{this._userKeyboardLayout.keyboardLayout&&(this._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout),this.setUserKeyboardLayoutIfMatched())}),this._register(this._userKeyboardLayout.onDidChange(()=>{const f=this._factory.keymapInfos.filter(l=>l.isUserKeyboardLayout);f.length?this._userKeyboardLayout.keyboardLayout?f[0].update(this._userKeyboardLayout.keyboardLayout):this._factory.removeKeyboardLayout(f[0]):this._userKeyboardLayout.keyboardLayout&&this._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout),this.setUserKeyboardLayoutIfMatched()}))}setUserKeyboardLayoutIfMatched(){const t=this.configurationService.getValue("keyboard").layout;t&&this._userKeyboardLayout.keyboardLayout&&x(this._userKeyboardLayout.keyboardLayout.layout)===t&&this._factory.activeKeymap&&(this._userKeyboardLayout.keyboardLayout.equal(this._factory.activeKeymap)||this._factory.setActiveKeymapInfo(this._userKeyboardLayout.keyboardLayout))}getKeyboardMapper(){return this._factory.getKeyboardMapper()}getCurrentKeyboardLayout(){return this._factory.activeKeyboardLayout}getAllKeyboardLayouts(){return this._factory.keyboardLayouts}getRawKeyboardMapping(){return this._factory.activeKeyMapping}validateCurrentKeyboardMapping(e){this._keyboardLayoutMode==="autodetect"&&this._factory.validateCurrentKeyboardMapping(e)}};N=ne([S(0,be),S(1,ue),S(2,me),S(3,Se),S(4,Q),S(5,ve)],N);const Ne=ae.as(le.Configuration),He={id:"keyboard",order:15,type:"object",title:k("keyboardConfigurationTitle","Keyboard"),properties:{"keyboard.layout":{type:"string",default:"autodetect",description:k("keyboard.layout.config","Control the keyboard layout used in web.")}}};Ne.registerConfiguration(He);let H=class extends F{constructor(e,t,o){super(),this._instantiationService=e,this._extensionService=t,this._logService=o,this._extensionHostIsReady=!1,this._onWillExecuteCommand=this._register(new E),this.onWillExecuteCommand=this._onWillExecuteCommand.event,this._onDidExecuteCommand=new E,this.onDidExecuteCommand=this._onDidExecuteCommand.event,this._extensionService.whenInstalledExtensionsRegistered().then(i=>this._extensionHostIsReady=i),this._starActivation=null}_activateStar(){return this._starActivation||(this._starActivation=Promise.race([this._extensionService.activateByEvent("*"),Ee(3e4)])),this._starActivation}async executeCommand(e,...t){this._logService.trace("CommandService#executeCommand",e);const o=`onCommand:${e}`;return B.getCommand(e)?this._extensionService.activationEventIsDone(o)?this._tryExecuteCommand(e,t):this._extensionHostIsReady?(await this._extensionService.activateByEvent(o),this._tryExecuteCommand(e,t)):(this._extensionService.activateByEvent(o),this._tryExecuteCommand(e,t)):(await Promise.all([this._extensionService.activateByEvent(o),Promise.race([this._activateStar(),V.toPromise(V.filter(B.onDidRegisterCommand,n=>n===e))])]),this._tryExecuteCommand(e,t))}_tryExecuteCommand(e,t){const o=B.getCommand(e);if(!o)return Promise.reject(new Error(`command '${e}' not found`));try{this._onWillExecuteCommand.fire({commandId:e,args:t});const i=this._instantiationService.invokeFunction(o.handler,...t);return this._onDidExecuteCommand.fire({commandId:e,args:t}),Promise.resolve(i)}catch(i){return Promise.reject(i)}}};H=ne([S(0,De),S(1,he),S(2,Te)],H);class Qe extends Ge{constructor(){super({id:"workbench.action.toggleKeybindingsLog",title:{value:k("toggleKeybindingsLog","Toggle Keyboard Shortcuts Troubleshooting"),original:"Toggle Keyboard Shortcuts Troubleshooting"},category:Me.Developer,f1:!0})}run(e){e.get(de).toggleLogging()&&e.get(Q).executeCommand(xe)}}Ue(Qe);async function it(y){const e=se.get(Pe);await se.get(ue).writeFile(e.defaultProfile.keybindingsResource,$e.fromString(y))}function st(){return{...fe(),[de.toString()]:new z(Ce),[Ke.toString()]:new z(N,void 0,!0),[Q.toString()]:new z(H)}}export{st as default,it as updateUserKeybindings};
