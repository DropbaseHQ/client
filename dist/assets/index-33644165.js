import{v as N,x as T,s as Z,ox as K,m1 as v,m3 as le,r as V,mB as $,j as e,oy as G,S as i,nb as H,W as C,T as m,B as z,mv as p,mw as x,mp as f,mz as j,M as w,oz as X,oA as ee,N as se,q as ae,mQ as me,mx as de}from"./vendor-332432be.js";import{a as D,u as J,w as oe,o as re,s as ne,b as ue,c as he,g as F,d as Y,e as M,f as B,D as ge}from"./index-5b71d1bd.js";import{u as pe}from"./useResetPassword-b2d1b6d0.js";const xe=async({email:n})=>(await D.post("/user/resend_confirmation_email",{email:n})).data,fe=n=>N(xe,{...n||{}}),Pe=()=>{var Q,O;const n=T(),o=J(),a=Z(),[d]=K(),u=v(oe),S=v(re),h=le(ne),[b,g]=V.useState(h),{register:k,formState:{errors:t},handleSubmit:y,watch:_,setValue:c}=$(),P=_("email");V.useEffect(()=>{c("email",d.get("email")||"")},[d,c]);const{mutate:L}=ue({onError:s=>{var l;o({title:"Login Failed",status:"error",description:F(s)}),((l=s.response)==null?void 0:l.status)===403&&g(!0)},onSuccess:s=>{var l;a.clear(),document.cookie="worker_sl_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",Y(s==null?void 0:s.access_token),localStorage.setItem("access_token",s==null?void 0:s.access_token),localStorage.setItem("refresh_token",s==null?void 0:s.refresh_token),M.defaults.headers.common["access-token"]=s==null?void 0:s.access_token,u(U=>{var I;return{...U,id:(I=s==null?void 0:s.workspace)==null?void 0:I.id}}),B((l=s==null?void 0:s.workspace)==null?void 0:l.id),g(!1),S((s==null?void 0:s.onboarding)||!1),n("/apps")}}),{mutate:q,isLoading:R}=he({onError:s=>{var l;o({title:"Login Failed",status:"error",description:F(s)}),((l=s.response)==null?void 0:l.status)===403&&g(!0)},onSuccess:s=>{var l;a.clear(),localStorage.getItem("access_token")&&localStorage.removeItem("access_token"),localStorage.getItem("refresh_token")&&localStorage.removeItem("refresh_token"),document.cookie="worker_sl_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",Y(s==null?void 0:s.access_token),localStorage.setItem("access_token",s==null?void 0:s.access_token),localStorage.setItem("refresh_token",s==null?void 0:s.refresh_token),M.defaults.headers.common["access-token"]=s==null?void 0:s.access_token,u(U=>{var I;return{...U,id:(I=s==null?void 0:s.workspace)==null?void 0:I.id}}),B((l=s==null?void 0:s.workspace)==null?void 0:l.id),g(!1),S((s==null?void 0:s.onboarding)||!1),n("/apps")}}),{mutate:r,isLoading:E,isSuccess:A}=fe(),W=y(s=>{q(s)}),ie=()=>{r({email:P})},te=s=>{L(s)},ce=()=>{o({title:"Login Failed",status:"error",description:"Unable to log in with google"})};return e.jsx(G,{display:"flex",alignItems:"center",h:"100vh",maxW:"lg",children:e.jsxs(i,{spacing:"8",children:[e.jsx(i,{spacing:"6",children:e.jsxs(i,{spacing:{base:"2",md:"3"},textAlign:"center",children:[e.jsx(H,{size:"sm",children:"Log in to your account"}),e.jsx(C,{to:"/register","data-cy":"link-to-register",children:e.jsx(m,{color:"fg.muted",fontSize:"sm",textDecoration:"underline",children:"Don't have an account?"})})]})}),e.jsxs(z,{width:"md",p:"12",boxShadow:"sm",bg:"white",borderRadius:"md",borderWidth:"1px",children:[e.jsx("form",{onSubmit:W,children:e.jsxs(i,{spacing:"6",children:[e.jsxs(i,{spacing:"5",children:[e.jsxs(p,{isInvalid:!!(t!=null&&t.email),children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(f,{placeholder:"Please enter your email",id:"email",type:"email","data-cy":"email",...k("email",{required:"Email is required"})}),e.jsx(j,{children:(Q=t==null?void 0:t.email)==null?void 0:Q.message})]}),e.jsxs(p,{isInvalid:!!(t!=null&&t.password),children:[e.jsx(x,{htmlFor:"password",children:"Password"}),e.jsx(f,{placeholder:"Please enter your password",id:"password",type:"password","data-cy":"password",...k("password",{required:"Password is required"})}),e.jsx(j,{children:(O=t==null?void 0:t.password)==null?void 0:O.message})]})]}),e.jsxs(i,{spacing:"6",children:[e.jsx(w,{isLoading:R,type:"submit",colorScheme:"blue","data-cy":"sign-in",children:"Sign in"}),e.jsx(C,{to:"/forgot",children:e.jsx(m,{color:"fg.muted",fontSize:"sm",textDecoration:"underline",children:"Forgot Password?"})}),e.jsxs(i,{display:"none",children:[e.jsx(X,{onSuccess:te,onError:ce,size:"medium",width:300,logo_alignment:"center"}),e.jsxs(w,{as:C,rounded:"md",variant:"outline",colorScheme:"gray",to:"https://github.com/login/oauth/authorize?scope=user:email&client_id=0cc0b4d0157e439493fc",w:300,children:[e.jsx(ee,{size:"14"}),e.jsx(m,{ml:"2",fontSize:"md",fontWeight:"medium",children:"Sign in with Github"})]})]})]})]})}),b&&e.jsxs(se,{mt:"6",direction:"column",children:[e.jsx(m,{color:"orange.500",fontSize:"md",align:"center",children:"Please confirm your email before logging in."}),e.jsx(m,{color:"gray.500",fontSize:"md",align:"center",children:"Make sure to check your spam folder."}),e.jsx(w,{marginTop:"4",onClick:ie,isLoading:E,isDisabled:A,children:A?"Email sent":"Resend Confirmation Email"})]})]})]})})},je=async({email:n,password:o})=>(await D.post("/user/register",{email:n,password:o})).data,we=async({credential:n})=>(await D.post("/user/registerGoogle",{credential:n})).data,Se=n=>N(je,{...n||{}}),be=n=>N(we,{...n||{}}),Ie=()=>{var L,q,R;const{register:n,formState:{errors:o},handleSubmit:a}=$(),d=T(),u=v(ne),S=Z(),h=J(),b=v(oe),g=v(re),{mutate:k}=be({onError:r=>{h({title:"Signup Failed",status:"error",description:F(r)})},onSuccess:r=>{var E;S.clear(),document.cookie="worker_sl_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",Y(r==null?void 0:r.access_token),localStorage.setItem("access_token",r==null?void 0:r.access_token),localStorage.setItem("refresh_token",r==null?void 0:r.refresh_token),M.defaults.headers.common["access-token"]=r==null?void 0:r.access_token,b(A=>{var W;return{...A,id:(W=r==null?void 0:r.workspace)==null?void 0:W.id}}),B((E=r==null?void 0:r.workspace)==null?void 0:E.id),h({title:"Registered successfully",status:"success"}),g((r==null?void 0:r.onboarding)||!1),d("/apps")}}),{mutate:t,isLoading:y}=Se({onError:r=>{h({title:"Register Failed",status:"error",description:F(r)})},onSuccess:()=>{h({title:"Registered successfully",status:"success"}),u(!0),d("/login")}}),_=a(r=>{t(r)}),c=r=>{k(r)},P=()=>{h({title:"Signup Failed",status:"error",description:"Unable to sign up with google"})};return e.jsx(G,{display:"flex",alignItems:"center",h:"100vh",maxW:"lg",children:e.jsxs(i,{spacing:"8",children:[e.jsx(i,{spacing:"6",children:e.jsxs(i,{spacing:{base:"2",md:"3"},textAlign:"center",children:[e.jsx(H,{size:"sm",children:"Sign up for dropbase"}),e.jsx(C,{to:"/login",children:e.jsx(m,{color:"fg.muted",fontSize:"sm",textDecoration:"underline",children:"Already have an account?"})})]})}),e.jsx(z,{minW:"md",p:"12",boxShadow:"sm",borderRadius:"md",borderWidth:"1px",children:e.jsx("form",{onSubmit:_,children:e.jsxs(i,{spacing:"6",children:[e.jsxs(i,{spacing:"5",children:[e.jsxs(p,{isInvalid:!!(o!=null&&o.email),children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(f,{placeholder:"Please enter your email",id:"email",type:"email","data-cy":"email",...n("email",{required:"Email is required"})}),e.jsx(j,{children:(L=o==null?void 0:o.email)==null?void 0:L.message})]}),e.jsxs(p,{isInvalid:!!(o!=null&&o.password),children:[e.jsx(x,{htmlFor:"password",children:"Password"}),e.jsx(f,{placeholder:"Please enter your password",id:"password",type:"password","data-cy":"password",...n("password",{required:"Password is required",validate:r=>r.length<6?"Your password needs a minimum of 6 characters":r.search(/[a-z]/)<0?"Your password needs a lower case letter":r.search(/[A-Z]/)<0?"Your password needs an upper case letter":r.search(/[0-9]/)<0?"Your password needs a number":!0})}),e.jsx(j,{children:(q=o==null?void 0:o.password)==null?void 0:q.message})]}),e.jsxs(p,{isInvalid:!!(o!=null&&o.confirm),children:[e.jsx(x,{htmlFor:"confirm",children:"Confirm Password"}),e.jsx(f,{placeholder:"Please confirm your password",id:"confirm",type:"password","data-cy":"confirm-password",...n("confirm",{required:"Password is required",validate:(r,E)=>r!==E.password?"Password didnt match":!0})}),e.jsx(j,{children:(R=o==null?void 0:o.confirm)==null?void 0:R.message})]})]}),e.jsx(i,{spacing:"6",children:e.jsx(w,{isLoading:y,type:"submit",colorScheme:"blue","data-cy":"sign-up-button",children:"Sign up"})}),e.jsxs(i,{display:"none",children:[e.jsx(X,{onSuccess:c,onError:P,size:"medium",text:"signup_with",width:300,logo_alignment:"center"}),e.jsxs(w,{as:C,variant:"outline",colorScheme:"gray",to:"https://github.com/login/oauth/authorize?scope=user:email&client_id=0cc0b4d0157e439493fc",children:[e.jsx(ee,{size:"14"}),e.jsx(m,{ml:"2",fontSize:"md",fontWeight:"medium",children:"Sign up with Github"})]})]})]})})})]})})},ve=()=>{var y,_;const{register:n,formState:{errors:o},handleSubmit:a}=$(),d=T(),[u]=K(),S=u.get("email")||"",h=u.get("token")||"",b=J(),{mutate:g,isLoading:k}=pe({onError:c=>{b({title:"Cannot reset password",status:"error",description:F(c)})},onSuccess:()=>{b({title:"Password reset successful",status:"success",description:"Login again with the updated password"}),d("/login")}}),t=a(c=>{g({...c,email:S,resetToken:h})});return e.jsx(G,{display:"flex",alignItems:"center",h:"100vh",maxW:"lg",children:e.jsxs(i,{spacing:"8",children:[e.jsx(i,{spacing:"6",children:e.jsxs(i,{spacing:{base:"2",md:"3"},textAlign:"center",children:[e.jsx(z,{mx:"auto",w:"24",children:e.jsx(ge,{})}),e.jsx(H,{size:"sm",children:"Reset password"})]})}),e.jsx(z,{minW:"md",p:"12",bg:"bg-surface",boxShadow:"sm",borderRadius:"md",border:"1px solid",borderColor:"bg-muted",children:e.jsx("form",{onSubmit:t,children:e.jsxs(i,{spacing:"6",children:[e.jsxs(i,{spacing:"5",children:[e.jsxs(p,{children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(f,{placeholder:"Please enter your email",id:"email",type:"email",...n("email",{required:"Email is required"})})]}),e.jsxs(p,{isInvalid:!!(o!=null&&o.password),children:[e.jsx(x,{htmlFor:"password",children:"New Password"}),e.jsx(f,{placeholder:"Please enter your password",id:"password",type:"password",...n("password",{required:"Password is required",validate:c=>c.length<6?"Your password needs a minimum of 6 characters":c.search(/[a-z]/)<0?"Your password needs a lower case letter":c.search(/[A-Z]/)<0?"Your password needs an uppser case letter":c.search(/[0-9]/)<0?"Your password needs a number":!0})}),e.jsx(j,{children:(y=o==null?void 0:o.password)==null?void 0:y.message})]}),e.jsxs(p,{isInvalid:!!(o!=null&&o.confirm),children:[e.jsx(x,{htmlFor:"confirm",children:"Confirm New Password"}),e.jsx(f,{placeholder:"Please confirm your password",id:"confirm",type:"password",...n("confirm",{required:"Password is required",validate:(c,P)=>c!==P.password?"Password didnt match":!0})}),e.jsx(j,{children:(_=o==null?void 0:o.confirm)==null?void 0:_.message})]})]}),e.jsxs(i,{spacing:"6",children:[e.jsx(w,{isLoading:k,type:"submit",colorScheme:"blue",children:"Reset"}),e.jsx(C,{to:"/login",children:e.jsx(m,{color:"bg.muted",fontSize:"sm",textDecoration:"underline",children:"Back to login"})})]})]})})})]})})},ke=async({userId:n,token:o})=>(await D.post(`user/verify?token=${o}&user_id=${n}`)).data,ye=({userId:n,token:o})=>ae(["confirmEmail",n,o],()=>ke({userId:n,token:o})),ze=()=>{const{token:n,userId:o}=me(),a=T(),{isLoading:d,isSuccess:u}=ye({userId:o||"",token:n||""});return e.jsx(G,{display:"flex",alignItems:"center",justifyContent:"center",h:"100vh",maxW:"lg",children:e.jsxs(z,{minW:"md",p:"12",bg:"bg-surface",boxShadow:"sm",borderRadius:"md",border:"1px solid",borderColor:"bg-muted",children:[d&&e.jsx(de,{}),u?e.jsxs(se,{direction:"column",children:[e.jsx(m,{textAlign:"center",fontSize:"md",children:"Email Confirmation Success!"}),e.jsx(w,{marginTop:"4",onClick:()=>{a("/login")},children:"Login"})]}):e.jsx(m,{textAlign:"center",fontSize:"md",children:"Unable to confirm email!"})]})})};export{ze as EmailConfirmation,Pe as Login,Ie as Register,ve as ResetPassword,re as onboardingAtom,ne as showConfirmationAtom};
