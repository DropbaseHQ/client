var M9=Object.defineProperty;var L9=(r,e,t)=>e in r?M9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var mi=(r,e,t)=>(L9(r,typeof e!="symbol"?e+"":e,t),t);import{m as F9,a as O9,t as gy,b as iq,e as N9,u as $9,c as MN,d as tk,j as f,S as q,B as ke,C as sh,X as ik,I as Kw,f as Uy,A as wP,Q as W9,g as H9,h as j9,G as B9,i as U9,k as V9,l as LN,n as nq,o as yu,p as Ji,q as rr,r as z,s as Li,v as Jt,w as q9,x as Eo,y as Ki,z as rq,D as mo,E as St,P as Ir,F as Rr,H as jr,J as xs,K as xo,T as Ie,L as Br,M as Qe,N as dn,O as If,R as G9,U as FN,V as ON,W as vh,Y as z9,Z as Bn,_ as K9,$ as Q9,a0 as Y9,a1 as sr,a2 as X9,a3 as J9,a4 as Ws,a5 as nk,a6 as re,a7 as rc,a8 as pe,a9 as NN,aa as De,ab as sq,ac as $t,ad as Z9,ae as ki,af as k,ag as Ds,ah as oq,ai as Nn,aj as pr,ak as Rt,al as bn,am as lt,an as eQ,ao as oH,ap as $N,aq as wg,ar as aq,as as bg,at as fn,au as G,av as p,aw as WN,ax as hC,ay as cq,az as tQ,aA as dq,aB as yh,aC as Xt,aD as A,aE as Or,aF as ad,aG as Fp,aH as Qw,aI as HN,aJ as ua,aK as lq,aL as Jn,aM as ne,aN as fC,aO as Ys,aP as Hr,aQ as Vy,aR as vt,aS as qt,aT as Wo,aU as Sn,aV as iQ,aW as st,aX as Hm,aY as Te,aZ as ze,a_ as ls,a$ as Mi,b0 as ot,b1 as yi,b2 as pC,b3 as nQ,b4 as rQ,b5 as Fs,b6 as me,b7 as rk,b8 as We,b9 as jN,ba as BN,bb as kc,bc as Ml,bd as _t,be as at,bf as Hi,bg as Rf,bh as zs,bi as dc,bj as sQ,bk as Mt,bl as oQ,bm as Ho,bn as oi,bo as aQ,bp as cQ,bq as en,br as F,bs as lc,bt as Ln,bu as ln,bv as aH,bw as Tc,bx as jt,by as Si,bz as Pf,bA as my,bB as uq,bC as dQ,bD as qy,bE as lQ,bF as uQ,bG as tu,bH as nt,bI as Zh,bJ as pn,bK as hQ,bL as Gy,bM as Gi,bN as hS,bO as fQ,bP as Sg,bQ as vd,bR as Cg,bS as Ur,bT as pQ,bU as gC,bV as UN,bW as xa,bX as sk,bY as Eg,bZ as gQ,b_ as xg,b$ as Pn,c0 as bP,c1 as hq,c2 as fq,c3 as Xr,c4 as mQ,c5 as ii,c6 as It,c7 as ok,c8 as fo,c9 as ol,ca as _i,cb as ji,cc as Af,cd as VN,ce as bi,cf as pq,cg as gq,ch as jm,ci as qN,cj as vQ,ck as mq,cl as Do,cm as Qi,cn as Ll,co as Is,cp as ak,cq as si,cr as vy,cs as cH,ct as fi,cu as vq,cv as Dg,cw as pt,cx as yc,cy as yQ,cz as yy,cA as yq,cB as Yn,cC as Yw,cD as _Q,cE as oh,cF as fS,cG as La,cH as _q,cI as Xw,cJ as wQ,cK as on,cL as dH,cM as wq,cN as zy,cO as kg,cP as bQ,cQ as En,cR as bq,cS as pc,cT as Fi,cU as Jw,cV as Mf,cW as ga,cX as Nu,cY as Sq,cZ as SQ,c_ as xb,c$ as es,d0 as GN,d1 as CQ,d2 as EQ,d3 as xQ,d4 as lH,d5 as Cq,d6 as qe,d7 as ma,d8 as ef,d9 as sc,da as or,db as wa,dc as Xu,dd as DQ,de as kQ,df as TQ,dg as IQ,dh as Eq,di as ck,dj as uc,dk as RQ,dl as PQ,dm as ks,dn as AQ,dp as Cs,dq as ri,dr as MQ,ds as Bm,dt as Lf,du as Us,dv as Zw,dw as LQ,dx as xq,dy as SP,dz as FQ,dA as Dq,dB as eb,dC as xt,dD as Xc,dE as Ff,dF as CP,dG as OQ,dH as tf,dI as NQ,dJ as kq,dK as dk,dL as Tr,dM as cd,dN as $Q,dO as lk,dP as WQ,dQ as uH,dR as HQ,dS as ba,dT as Ky,dU as Tq,dV as Tg,dW as jQ,dX as mC,dY as Iq,dZ as BQ,d_ as gi,d$ as vC,e0 as Db,e1 as hH,e2 as ie,e3 as UQ,e4 as Rq,e5 as Um,e6 as tb,e7 as Fl,e8 as VQ,e9 as qQ,ea as Ci,eb as sn,ec as uk,ed as GQ,ee as Qy,ef as Yy,eg as Go,eh as Da,ei as uv,ej as us,ek as ss,el as Rd,em as zN,en as zQ,eo as fH,ep as KQ,eq as QQ,er as YQ,es as Pq,et as XQ,eu as KN,ev as JQ,ew as ZQ,ex as Gt,ey as Sa,ez as Aq,eA as pH,eB as eY,eC as tY,eD as iY,eE as nY,eF as rY,eG as sY,eH as vo,eI as nf,eJ as Mq,eK as oY,eL as Vm,eM as hk,eN as EP,eO as xP,eP as aY,eQ as QN,eR as cY,eS as fk,eT as DP,eU as Pr,eV as Lq,eW as dY,eX as lY,eY as uY,eZ as kP,e_ as Xy,e$ as Nt,f0 as Le,f1 as Ee,f2 as Fq,f3 as ee,f4 as jo,f5 as ll,f6 as kb,f7 as ul,f8 as hl,f9 as Tb,fa as Ib,fb as Xe,fc as Rb,fd as Pb,fe as pk,ff as gk,fg as ka,fh as YN,fi as hY,fj as Oq,fk as fY,fl as Nq,fm as pY,fn as XN,fo as gY,fp as mY,fq as TP,fr as vY,fs as yY,ft as _Y,fu as er,fv as yC,fw as ye,fx as $q,fy as IP,fz as Wq,fA as _h,fB as gH,fC as wY,fD as bY,fE as SY,fF as _C,fG as Hq,fH as Op,fI as CY,fJ as wn,fK as EY,fL as wh,fM as wC,fN as Ig,fO as An,fP as al,fQ as xY,fR as Ka,fS as mH,fT as DY,fU as qm,fV as kY,fW as tp,fX as Jy,fY as TY,fZ as IY,f_ as RY,f$ as PY,g0 as vH,g1 as AY,g2 as MY,g3 as bh,g4 as Zy,g5 as bC,g6 as RP,g7 as LY,g8 as Of,g9 as SC,ga as PP,gb as yH,gc as FY,gd as OY,ge as jq,gf as Nr,gg as NY,gh as Bq,gi as Ta,gj as $Y,gk as JN,gl as CC,gm as WY,gn as HY,go as jY,gp as Kn,gq as Ks,gr as Uq,gs as BY,gt as UY,gu as ha,gv as Vq,gw as Fn,gx as qq,gy as ah,gz as ZN,gA as VY,gB as qY,gC as GY,gD as e1,gE as zY,gF as mk,gG as KY,gH as QY,gI as yo,gJ as AP,gK as _H,gL as YY,gM as Gq,gN as vk,gO as EC,gP as t1,gQ as XY,gR as JY,gS as ZY,gT as yk,gU as e7,gV as i1,gW as t7,gX as i7,gY as zq,gZ as wH,g_ as xC,g$ as MP,h0 as bH,h1 as n7,h2 as r7,h3 as s7,h4 as o7,h5 as a7,h6 as c7,h7 as d7,h8 as _s,h9 as l7,ha as Kq,hb as jn,hc as Ue,hd as yt,he as SH,hf as fl,hg as yd,hh as NI,hi as Ab,hj as rf,hk as Mb,hl as pl,hm as DC,hn as CH,ho as Np,hp as EH,hq as kC,hr as $p,hs as u7,ht as gl,hu as pS,hv as h7,hw as Ve,hx as Fe,hy as e_,hz as Qq,hA as Yq,hB as f7,hC as ml,hD as p7,hE as LP,hF as FP,hG as Rg,hH as g7,hI as _k,hJ as ib,hK as wk,hL as Un,hM as Xq,hN as Jq,hO as m7,hP as v7,hQ as Zq,hR as Wp,hS as eG,hT as tG,hU as y7,hV as Ts,hW as iG,hX as Zn,hY as _7,hZ as w7,h_ as b7,h$ as S7,i0 as C7,i1 as E7,i2 as xH,i3 as x7,i4 as n1,i5 as D7,i6 as nG,i7 as rG,i8 as sG,i9 as k7,ia as eo,ib as TC,ic as T7,id as oG,ie as I7,ig as r1,ih as R7,ii as P7,ij as IC,ik as A7,il as M7,im as RC,io as L7,ip as aG,iq as Bt,ir as $I,is as cG,it as F7,iu as O7,iv as N7,iw as $7,ix as dG,iy as W7,iz as zo,iA as lG,iB as mr,iC as un,iD as H7,iE as j7,iF as Sh,iG as B7,iH as uG,iI as U7,iJ as ku,iK as Ch,iL as s1,iM as OP,iN as o1,iO as Lb,iP as DH,iQ as kH,iR as Ko,iS as Pg,iT as bk,iU as V7,iV as NP,iW as a1,iX as TH,iY as Gm,iZ as c1,i_ as hG,i$ as fG,j0 as cg,j1 as q7,j2 as pG,j3 as zc,j4 as G7,j5 as Os,j6 as WI,j7 as HI,j8 as z7,j9 as K7,ja as gG,jb as mG,jc as vG,jd as t_,je as d1,jf as Q7,jg as Y7,jh as X7,ji as el,jj as yG,jk as IH,jl as RH,jm as J7,jn as Z7,jo as eX,jp as tX,jq as iX,jr as nX,js as _G,jt as PH,ju as AH,jv as rX,jw as $P,jx as wG,jy as sX,jz as MH,jA as oX,jB as aX,jC as jI,jD as l1,jE as cX,jF as Sk,jG as dX,jH as lX,jI as PC,jJ as bG,jK as uX,jL as LH,jM as SG,jN as hX,jO as fX,jP as pX,jQ as gX,jR as mX,jS as vX,jT as CG,jU as EG,jV as yX,jW as _X,jX as wX,jY as bX,jZ as SX,j_ as CX,j$ as EX,k0 as $u,k1 as xX,k2 as Vd,k3 as Mc,k4 as BI,k5 as ip,k6 as DX,k7 as FH,k8 as OH,k9 as gS,ka as kX,kb as NH,kc as TX,kd as UI,ke as IX,kf as xG,kg as RX,kh as PX,ki as AX,kj as MX,kk as LX,kl as $H,km as FX,kn as WH,ko as OX,kp as Xi,kq as DG,kr as HH,ks as kG,kt as NX,ku as $X,kv as WX,kw as u1,kx as HX,ky as h1,kz as jX,kA as BX,kB as UX,kC as VX,kD as TG,kE as qX,kF as WP,kG as HP,kH as GX,kI as zX,kJ as KX,kK as QX,kL as YX,kM as XX,kN as JX,kO as ZX,kP as eJ,kQ as tJ,kR as iJ,kS as nJ,kT as rJ,kU as IG,kV as sJ,kW as oJ,kX as aJ,kY as RG,kZ as cJ,k_ as dJ,k$ as f1,l0 as PG,l2 as Fb,l3 as lJ,l4 as jP,l5 as BP,l6 as AG,l7 as uJ,l8 as hJ,l9 as fJ,la as pJ,lb as gJ,lc as mJ,ld as VI,le as jH,lf as vJ,lg as MG,lh as Ob,li as BH,lj as yJ,lk as LG,ll as _J,lm as UH,ln as wJ,lo as bJ,lp as FG,lq as p1,lr as Nf,ls as SJ,lt as $f,lu as hv,lv as CJ,lw as EJ,lx as OG,ly as VH,lz as xJ,lA as DJ,lB as kJ,lC as TJ,lD as IJ,lE as RJ,lF as PJ,lG as g1,lH as mS,lI as NG,lJ as AJ,lK as MJ,lL as qH,lM as ws,lN as LJ,lO as FJ,lP as OJ,lQ as NJ,lR as $J,lS as WJ,lT as HJ,lU as $G,lV as jJ,lW as BJ,lX as UJ,lY as VJ,lZ as qJ,l_ as GJ,l$ as zJ,m0 as KJ,m1 as Ti,m2 as QJ,m3 as Ze,m4 as Ol,m5 as zm,m6 as i_,m7 as hi,m8 as _u,m9 as Km,ma as WG,mb as YJ,mc as XJ,md as JJ,me as ZJ,mf as eZ,mg as iu,mh as tZ,mi as sf,mj as of,mk as Ag,ml as Qm,mm as af,mn as ch,mo as AC,mp as as,mq as Fa,mr as Xs,ms as Mg,mt as iZ,mu as Ck,mv as tn,mw as ir,mx as _d,my as nZ,mz as Ek,mA as m1,mB as Oa,mC as _c,mD as wc,mE as bc,mF as Pd,mG as Sc,mH as Ad,mI as Md,mJ as nu,mK as xk,mL as Bi,mM as v1,mN as dd,mO as HG,mP as rZ,mQ as Ri,mR as MC,mS as UP,mT as Cc,mU as sZ,mV as oZ,mW as aZ,mX as cZ,mY as dZ,mZ as n_,m_ as cs,m$ as vr,n0 as qI,n1 as Nl,n2 as Wf,n3 as Dk,n4 as y1,n5 as r_,n6 as Hf,n7 as _1,n8 as lZ,n9 as uZ,na as hZ,nb as np,nc as cf,nd as df,ne as lf,nf as _o,ng as xr,nh as Wn,ni as jG,nj as BG,nk as UG,nl as fZ,nm as w1,nn as b1,no as pZ,np as gZ,nq as mZ,nr as vZ,ns as Lg,nt as yZ,nu as _Z,nv as wZ,nw as bZ,nx as SZ,ny as CZ,nz as Na,nA as EZ,nB as xZ,nC as VG,nD as DZ,nE as kZ,nF as qG,nG as Tu,nH as GH,nI as fv,nJ as Iu,nK as TZ,nL as kk,nM as IZ,nN as RZ,nO as PZ,nP as AZ,nQ as MZ,nR as LZ,nS as FZ,nT as OZ,nU as Cr,nV as NZ,nW as $Z,nX as WZ,nY as GG,nZ as jf,n_ as HZ,n$ as jZ,o0 as BZ,o1 as UZ,o2 as VZ,o3 as qZ,o4 as GZ,o5 as zZ,o6 as S1,o7 as KZ,o8 as QZ,o9 as YZ,oa as zH,ob as KH,oc as QH,od as zG,oe as C1,of as XZ,og as Hp,oh as No,oi as JZ,oj as KG,ok as ZZ,ol as eee,om as tee,on as iee,oo as Nb,op as QG,oq as Tk,or as Ik,os as YG,ot as nee,ou as XG,ov as JG,ow as ree,l1 as see}from"./vendor-332432be.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const oee={outline:r=>({field:{borderRadius:"sm"},addon:{borderRadius:"lg",bg:F9("gray.50","gray.700")(r)}})},aee={variants:oee,defaultProps:{colorScheme:"gray"}},cee={parts:["field","icon"],sizes:{md:{field:{height:"11",paddingInlineEnd:"8"},group:{height:"11"}},sm:{field:{height:"9",paddingInlineEnd:"8"},group:{height:"9"}}},defaultProps:{size:"md",variant:"outline"}},dee=Object.freeze(Object.defineProperty({__proto__:null,Input:aee,Select:cee},Symbol.toStringTag,{value:"Module"})),lee=O9(gy.components,dee),uee=()=>{const{width:r}=window.screen;return r<1024?.75:r<=1440?.8:.85},YH=uee(),hee=["fontSizes","letterSpacings","lineHeights","radii","sizes","space"],fee=hee.reduce((r,e)=>{const t={...iq[e],...gy[e]};return{...r,[e]:Object.keys(t).reduce((i,n)=>{const s=t[n];if(typeof s=="number")return{...i,[n]:s*YH};if(typeof s=="string"&&n!=="px"&&n!=="full"){const o=s.split(/(\d+)/),a=o[o.length-1],c=parseFloat(s),d=Number.isNaN(c)?s:`${parseFloat(s)*YH}${a}`;return{...i,[n]:d}}return{...i,[n]:s}},{})}},{});var X2,J2,Z2;const pee=N9({...gy,components:lee,...fee,colors:{...iq.colors,blue:{50:"#dae9fb",100:"#b5d4f7",200:"#90bef3",300:"#6ba9ef",400:"#4693ec",500:"#0066FF",600:"#156acb",700:"#1157a6",800:"#0e4481",900:"#0a305c"},gray:{50:"#F8F9FA",100:"#E9ECEF",200:"#DEE2E6",300:"#CED4DA",400:"#ADB5BD",500:"#6C757D",600:"#495057",700:"#343A40",800:"#212529",900:"#161616"},brand:{50:"#dae9fb",100:"#b5d4f7",200:"#90bef3",300:"#6ba9ef",400:"#4693ec",500:"#1775E1",600:"#156acb",700:"#1157a6",800:"#0e4481",900:"#0a305c"}},semanticTokens:{...((X2=gy)==null?void 0:X2.semanticTokens)||{},colors:{...((Z2=(J2=gy)==null?void 0:J2.semanticTokens)==null?void 0:Z2.colors)||{},"bg-canvas":{default:"gray.50",_dark:"gray.300"}}},fonts:{heading:"'Inter Variable', apple-system, sans-serif",body:"'Inter Variable', apple-system, sans-serif",mono:'"Fira Code", SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},config:{initialColorMode:"light"},styles:{global:{body:{overscrollBehaviorX:"none"},html:{overscrollBehaviorX:"none"}}}}),gee=({icon:r,title:e,description:t,onClose:i})=>{const n=tk().colorMode==="light";return f.jsxs(q,{spacing:"2",alignItems:"start",direction:"row",children:[r?f.jsx(ke,{children:r}):null,f.jsxs(q,{flex:"2",spacing:"0.5",position:"relative",children:[e?f.jsx(ke,{lineHeight:1,fontWeight:"medium",fontSize:"sm",children:e}):null,t?f.jsx(ke,{fontSize:"xs",color:"muted",children:t}):null]}),f.jsx(sh,{cursor:"pointer",size:"5",_hover:{bg:n?"gray.100":"gray.700"},onClick:i,border:"1px solid",borderColor:n?"gray.300":"gray.600",color:"muted","aria-label":"Close toast",children:f.jsx(ik,{size:"12"})})]})},mee=(r,e)=>({position:"bottom-right",containerStyle:{background:r.colors.gray[e?"50":"800"],padding:r.space[3],borderRadius:r.space[1],border:"1px solid",borderColor:r.colors.gray[e?"200":"700"]}}),Ut=()=>{const r=$9(),e=MN(),t=tk().colorMode==="light",i=({title:n,description:s,status:o="info"})=>{const a=()=>{switch(o){case"error":return f.jsx(ke,{color:"red.500",children:f.jsx(wP,{size:"15"})});case"warning":return f.jsx(ke,{color:"yellow.500",children:f.jsx(wP,{size:"15"})});case"success":return f.jsx(ke,{color:"green.500",children:f.jsx(Uy,{size:"15"})});case"info":return f.jsx(ke,{color:"blue.500",children:f.jsx(Kw,{size:"15"})});default:return null}};return r({...mee(e,t),render:({onClose:c})=>f.jsx(gee,{icon:a(),onClose:c,title:n,description:s})})};return i.close=r.close,i.closeAll=r.closeAll,i},vee=new W9({defaultOptions:{queries:{staleTime:5*1e3,refetchOnWindowFocus:!1,retry:!1}}}),yee=({children:r})=>f.jsx(H9,{children:f.jsx(j9,{theme:pee,children:f.jsx(B9,{clientId:"213282612010-bskbkd0ccja88fdtg8ua1jrt365qnenj.apps.googleusercontent.com",children:f.jsxs(U9,{client:vee,children:[r,f.jsx(V9.ReactQueryDevtools,{position:"bottom-right"})]})})})}),gn=LN("workspaceId",{id:null}),ZG=()=>`${window.location.protocol}//${window.location.hostname}:9090`,_ee=()=>`ws://${window.location.hostname}:9090/ws`,wee=()=>`ws://${window.location.hostname}:9095/lsp`,zt=nq.create({baseURL:"https://api.dropbase.io/"}),Ei=nq.create({baseURL:ZG(),withCredentials:!0});localStorage.getItem("access_token")&&(zt.defaults.headers.Authorization=`Bearer ${localStorage.getItem("access_token")}`,Ei.defaults.headers["access-token"]=localStorage.getItem("access_token"));const LC=r=>{zt.defaults.headers.Authorization=r?`Bearer ${r}`:null},FC=r=>{Ei.defaults.headers["access-token"]=r},XH=r=>{Ei.defaults.baseURL=r},bee=r=>{Ei.defaults.headers["workspace-id"]=r},JH=()=>{window.location.pathname.includes("/login")||window.location.pathname.includes("/register")||window.location.pathname.includes("/email-confirmation")||window.location.pathname.includes("/forgot")||window.location.pathname.includes("/reset")||window.location.pathname.includes("/github_auth")||(window.location.href="/login")};zt.interceptors.response.use(r=>r,async r=>{var t;const e=r.config;if(e.url!=="/login"&&e.url!=="/user/register"&&e.url!=="/user/refresh"&&r.response&&r.response.status===401){const i=localStorage.getItem("refresh_token");if(i){if(!e.retry){e.retry=!0;try{const n=await zt.post("/user/refresh",void 0,{headers:{Authorization:`Bearer ${i}`}}),s=(t=n==null?void 0:n.data)==null?void 0:t.access_token;return localStorage.setItem("access_token",s),LC(s),FC(s),await zt(e)}catch{JH()}}}else JH()}return Promise.reject(r)});Ei.interceptors.response.use(r=>r,async r=>{const e=r.config;return r.response.status===401&&!e.retry?(e.retry=!0,zt(e)):Promise.reject(r)});const ez="workspaces",See=async()=>(await zt.get("/user/workspaces")).data,Cee=async()=>(await Ei.get("/worker_workspace/")).data,E1=()=>{const{pathname:r}=yu(),{isFetched:e}=WW(),t=r.startsWith("/login")||r.startsWith("/register")||r.startsWith("/reset")||r.startsWith("/email-confirmation")||r.startsWith("/forgot")||r.startsWith("/github_auth"),{data:i,...n}=rr("workerWorkspace",Cee,{enabled:!t&&{}.VITE_APP_TYPE!=="app"&&!!Ei.defaults.headers["access-token"]&&e});return{...n,workspace:i}},Ld=()=>{const{pathname:r}=yu(),[,e]=Ji(gn),{workspace:t}=E1(),i=[ez],n=r.startsWith("/login")||r.startsWith("/register")||r.startsWith("/reset")||r.startsWith("/email-confirmation")||r.startsWith("/forgot")||r.startsWith("/github_auth"),{data:s,...o}=rr(i,()=>See(),{enabled:!n,onSuccess:c=>{const d=c==null?void 0:c.find(l=>l.id===(t==null?void 0:t.id));e(d||(c==null?void 0:c[0]))}}),a=z.useMemo(()=>s||[],[s]);return(a==null?void 0:a.length)===0&&!n?{...o,queryKey:i,workspaces:[]}:{...o,queryKey:i,workspaces:a}},Eee=async({name:r=null})=>{const e=r?{name:r}:{};return(await zt.post("/workspace",e)).data},xee=()=>{const r=Li();return Jt(Eee,{onSuccess:()=>{r.refetchQueries(ez)}})},Bf=({currentNames:r,prefix:e})=>{let t=1;for(;r.includes(`${e}${t}`);)t+=1;const i=`${e}${t}`,n=`${e.charAt(0).toUpperCase()+e.slice(1)}${t}`;return{name:i,label:n}},ni=r=>{var t,i,n,s,o,a,c,d,l,u,h,g,m,y,_,b,E,D,R,M,O,L,W,Z,K;if((i=(t=r==null?void 0:r.response)==null?void 0:t.data)!=null&&i.detail&&Array.isArray((s=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:s.detail))return(a=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:a.detail.map(H=>H.msg).join(", ");if(Array.isArray((d=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:d.result))return(u=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:u.result.join(", ");const e=((g=(h=r==null?void 0:r.response)==null?void 0:h.data)==null?void 0:g.error)||((y=(m=r==null?void 0:r.response)==null?void 0:m.data)==null?void 0:y.message)||((b=(_=r==null?void 0:r.response)==null?void 0:_.data)==null?void 0:b.result)||((R=(D=(E=r==null?void 0:r.response)==null?void 0:E.data)==null?void 0:D.detail)==null?void 0:R.message)||((L=(O=(M=r==null?void 0:r.response)==null?void 0:M.data)==null?void 0:O.detail)==null?void 0:L.error)||((Z=(W=r==null?void 0:r.response)==null?void 0:W.data)==null?void 0:Z.detail)||((K=r==null?void 0:r.response)==null?void 0:K.data)||(r==null?void 0:r.message)||"";return typeof e!="string"?JSON.stringify(e):e},Dee=()=>({}).VITE_APP_TYPE==="app",kee=(r,e,t,i=!0)=>{const n=t.find(s=>s===e&&s!==r);return e!==e.toLowerCase()&&i?"Must be lowercase":n?"Name already exists":e.includes(" ")?"Name cannot have spaces":e!==""&&!Number.isNaN(parseInt(e[0],10))?"Name cannot start with a number":!e.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/g)&&e!==""?"Name contains invalid characters":!1},OC=(r,e)=>{try{const t=/\{{(.*?)\}}/g,i=r==null?void 0:r.matchAll(t);let n=r;return[...i].forEach(s=>{const[o,a]=s,c=q9(e,a);n===o?n=c:n=n.replace(o,c||"")}),n}catch{return r}},Tee=async()=>(await zt.delete("/user/logout")).data,Iee=()=>{const r=Ut(),e=Li(),t=Eo();return Jt(()=>Tee(),{onSuccess:()=>{e.clear(),FC(null),LC(null),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),document.cookie="worker_sl_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",t("/login")},onError:i=>{r({status:"error",title:"Failed to logout",description:ni(i)})}})},Ree=({children:r,...e})=>{const{isOpen:t,onClose:i,onOpen:n}=Ki(),s=f.jsx(rq,{maxH:"full",...e,src:"/logo.svg",alt:""});return r?f.jsx(mo,{cursor:"pointer",tabIndex:0,h:"full",onMouseEnter:n,onFocus:n,onMouseOver:n,onMouseLeave:i,onBlur:i,children:t?r:s}):s},Pee=({children:r,icon:e,...t})=>{const{isOpen:i,onClose:n,onOpen:s}=Ki(),o=f.jsx(rq,{maxH:"full",src:"/logo.svg",alt:""});return f.jsx(St,{"aria-label":"",...t,icon:i?e:o,onMouseEnter:s,onFocus:s,onMouseOver:s,onMouseLeave:n,onBlur:n})},Aee=async()=>{const{data:r}=await zt.get("/user");return r},nb=()=>{const{pathname:r}=yu(),e=r.startsWith("/login")||r.startsWith("/register")||r.startsWith("/reset")||r.startsWith("/email-confirmation")||r.startsWith("/forgot")||r.startsWith("/github_auth"),t=["currentUser"],{data:i,...n}=rr(t,()=>Aee(),{enabled:!e});return{user:i||{},...n}},Mee=({workspace:r})=>{const[e,t]=Ji(gn),i=()=>{t(r)};return f.jsx(Qe,{variant:"ghost",w:"full",justifyContent:"flex-start",textAlign:"left",onClick:i,children:f.jsxs(dn,{alignItems:"center",justifyContent:"space-between",w:"full",children:[f.jsxs(If,{spacing:"4",children:[f.jsx(G9,{size:"24"}),f.jsx(Ie,{fontSize:"md",children:r==null?void 0:r.name}),f.jsx(FN,{size:"sm",textTransform:"capitalize",children:r==null?void 0:r.role_name})]}),(e==null?void 0:e.id)===(r==null?void 0:r.id)&&f.jsx(ON,{size:"16"})]})})},Lee=({trigger:r})=>{const{workspaces:e}=Ld(),{user:t}=nb();return f.jsxs(Ir,{placement:"right",children:[f.jsx(Rr,{children:r}),f.jsxs(jr,{children:[f.jsx(xs,{}),f.jsx(xo,{borderBottom:"0px",children:f.jsx(Ie,{fontSize:"sm",children:t==null?void 0:t.email})}),f.jsx(Br,{children:e==null?void 0:e.map(i=>f.jsx(Mee,{workspace:i},i==null?void 0:i.name))})]})]})},Fee=()=>{const{pathname:r}=yu(),{mutate:e}=Iee(),{workspaces:t}=Ld(),i=t.length>0,n=()=>{e()};return f.jsx(q,{w:"14",h:"full",bg:"white",borderRightWidth:"1px",p:"3",alignItems:"center",children:f.jsxs(q,{alignItems:"center",h:"full",children:[f.jsxs(ke,{mb:"8",w:"12",as:vh,to:"/apps",display:"flex",flexDirection:"column",children:[f.jsx(Ree,{}),i&&f.jsx(Lee,{trigger:f.jsx(St,{size:"sm",variant:"ghost",color:"body","aria-label":"Workspace Switcher",icon:f.jsx(z9,{size:"14"})})})]}),Dee()||!i?null:f.jsx(Bn,{label:"Apps",placement:"right",children:f.jsx(St,{variant:"ghost",as:vh,to:"/apps",color:r==="/apps"?"blue.500":"body",colorScheme:r==="/apps"?"blue":"gray","aria-label":"Apps",icon:f.jsx(K9,{size:"22"})})}),f.jsxs(q,{mt:"auto",alignItems:"center",children:[i&&f.jsx(Bn,{label:"Developer settings",placement:"right",children:f.jsx(St,{variant:"ghost",as:vh,to:"/settings/developer",color:r==="/settings/developer"?"blue.500":"body",colorScheme:r==="/settings/developer"?"blue":"gray","aria-label":"developer settings",icon:f.jsx(Q9,{size:"22"})})}),f.jsx(Bn,{label:"Logout",placement:"right",children:f.jsx(St,{variant:"ghost",onClick:n,colorScheme:"gray","aria-label":"Logouts",icon:f.jsx(Y9,{size:"22"})})})]})]})})},Zo=sr({isPreview:!1}),x1=sr(!1),Oee=["_protected","_key","_gte"],tz={tokenizer:{root:[[/(SELECT|select|FROM|from|WHERE|where|ORDER BY|order by|GROUP BY|group by|JOIN|join|LEFT JOIN|left join|RIGHT JOIN|right join|ON|on|AND|and|OR|or|NOT|not|IN|in|BETWEEN|between|AS|as|WITH|with)\b/i,"keyword"],[/'[^']*'/,"string"],[/`[^`]*`/,"string"],[/"/,"string","@string_double"],[/--.*/,"comment"]],string_double:[[/[^\\"]+/,"string"],[/"/,"string","@pop"]]}},Nee={schema:{public:{}},metadata:{}},$ee=5e3,Rk=r=>{const[e,t]=z.useState(!1),{colorMode:i}=tk();z.useEffect(()=>{r&&(r.editor.defineTheme("gh-dark",X9),r.editor.defineTheme("chrome-devtools",J9),t(!0))},[r]),z.useEffect(()=>{r&&e&&(i==="dark"?r.editor.setTheme("gh-dark"):r.editor.setTheme("chrome-devtools"))},[r,e,i])},iz=(r,e)=>{const t=[],i=/{{state(?:\.([^{}.]+))?(?:\.([^{}.]+))?/,n=r.match(i),s=/{{context(?:\.([^{}.]+))?(?:\.([^{}.]+))?(?:\.([^{}.]+))?(?:\.([^{}.]+))?/,o=r.match(s);if(r.includes("{{")){let a;if(n){const c=n[1],d=n[2];d?(a=e.state[c][d],a&&Object.keys(a).forEach(l=>{t.push({label:l,kind:Ws.CompletionItemKind.Property,insertText:l})})):c?(a=e.state[c],a&&Object.keys(a).forEach(l=>{t.push({label:l,kind:Ws.CompletionItemKind.Property,insertText:l})})):(a=e.state,Object.keys(a).forEach(l=>{t.push({label:l,kind:Ws.CompletionItemKind.Property,insertText:l})}))}else if(o){const c=o[1],d=o[2],l=o[3],u=o[4];u?(a=e.context[c][d][l][u],a&&Object.keys(a).forEach(h=>{t.push({label:h,kind:Ws.CompletionItemKind.Property,insertText:h})})):l?(a=e.context[c][d][l],a&&Object.keys(a).forEach(h=>{t.push({label:h,kind:Ws.CompletionItemKind.Property,insertText:h})})):d?(a=e.context[c][d],a&&Object.keys(a).forEach(h=>{t.push({label:h,kind:Ws.CompletionItemKind.Property,insertText:h})})):c?(a=e.context[c],a&&Object.keys(a).forEach(h=>{t.push({label:h,kind:Ws.CompletionItemKind.Property,insertText:h})})):(a=e.context,Object.keys(a).forEach(h=>{t.push({label:h,kind:Ws.CompletionItemKind.Property,insertText:h})}))}else a=e,Object.keys(a).forEach(c=>{t.push({label:c,kind:Ws.CompletionItemKind.Property,insertText:c})});return t}return[]},Wee=(r,e,t)=>{const i=r.getValueInRange({startLineNumber:e.lineNumber,startColumn:1,endLineNumber:e.lineNumber,endColumn:e.column});return{suggestions:iz(i,t)}},{CompletionItemKind:Lc}=Ws,Hee=["SELECT","FROM","AS","WHERE","ORDER BY","GROUP BY","JOIN","LEFT JOIN","RIGHT JOIN","ON","AND","OR","NOT","IN","BETWEEN","AS","WITH"],ZH=(r,e)=>r.split(e).length-1,jee=(r,e,t)=>{const i=e.schema,[n,s,o]=r.split(" ").reverse(),a=n.replace(/^("|\.)+|("|\.)+$/g,""),[c,d]=a.split("."),l=[],u=iz(r,t);if(u.length>0)return u;if((s==null?void 0:s.toUpperCase())==="FROM")return Object.keys(i).forEach(h=>{Object.keys(i[h]).forEach(g=>{`${h}.${g}`.includes(a)&&l.push({label:`${h}.${g}`,kind:Lc.Property,insertText:`${h}.${g}`})})}),Object.keys(i[e.metadata.default_schema]).forEach(h=>{h.startsWith(a)&&l.push({label:h,kind:Lc.Property,insertText:h,detail:`schema: ${e.metadata.default_schema}`})}),l;if((s==null?void 0:s.toUpperCase())!=="AS"||!o)return Hee.filter(h=>h.includes(a.toUpperCase())).map(h=>({label:h,kind:Lc.Keyword,insertText:h}));if(ZH(n,".")>2)return Oee.forEach(h=>{n.includes(h)||l.push({label:h,kind:Lc.Property,insertText:h})}),l;if(Object.keys(i).forEach(h=>{Object.keys(i[h]).forEach(g=>{i[h][g].forEach(m=>{(o.endsWith(`.${m}`)||o===m)&&l.push({label:`${h}.${g}.${m}`,kind:Lc.Property,insertText:`${h}.${g}.${m}`})})})}),Object.keys(i[e.metadata.default_schema]).forEach(h=>{i[e.metadata.default_schema][h].forEach(g=>{(o.endsWith(`.${g}`)||o===g)&&l.push({label:`${h}.${g}`,kind:Lc.Property,insertText:`${h}.${g}`,detail:`schema: ${e.metadata.default_schema}`})})}),d?i[c][d].forEach(h=>{(o.endsWith(`.${h}`)||o===h)&&l.push({label:h,kind:Lc.Property,insertText:h})}):c&&Object.keys(i[c]).forEach(h=>{Object.keys(i[c][h]).forEach(g=>{(o.endsWith(`.${g}`)||o===g)&&l.push({label:h,kind:Lc.Property,insertText:h})})}),l.length===0){let h;c?d?h=i[c][d]:h=Object.keys(i[c]):h=Object.keys(i),h.forEach(g=>{l.push({label:g,kind:Lc.Property,insertText:g})})}return l.forEach(h=>{const g=h,m=ZH(h.label,".");g.sortText=`${m}${h.label}`}),l},Bee=(r,e,t,i)=>{const n=r.getValueInRange({startLineNumber:e.lineNumber,startColumn:1,endLineNumber:e.lineNumber,endColumn:e.column});return{suggestions:jee(n,t,i)}},Uee=(r,e)=>{const t=nk();Rk(t),z.useEffect(()=>{if(!t)return()=>{};t.languages.register({id:"sql"}),t.languages.setMonarchTokensProvider("sql",tz);const{dispose:i}=t.languages.registerCompletionItemProvider("sql",{triggerCharacters:[".",'"'],provideCompletionItems:(n,s)=>Bee(n,s,r,e)});return i},[t,r,e])};var D1={};function T(r,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s}function v(r,e){return function(t,i){e(t,i,r)}}function V(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)}function rt(r,e,t,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t}const wu=re("remoteAuthorityResolverService");class nz{constructor(e){this.id=e,this.type=1}toString(){return`Managed(${this.id})`}}class rz{constructor(e,t){this.host=e,this.port=t,this.type=0}toString(){return`WebSocket(${this.host}:${this.port})`}}var $r;(function(r){r.Unknown="Unknown",r.NotAvailable="NotAvailable",r.TemporarilyNotAvailable="TemporarilyNotAvailable",r.NoResolverFound="NoResolverFound"})($r||($r={}));let Eh=class mp extends rc{static isNotAvailable(e){return e instanceof mp&&e._code===$r.NotAvailable}static isTemporarilyNotAvailable(e){return e instanceof mp&&e._code===$r.TemporarilyNotAvailable}static isNoResolverFound(e){return e instanceof mp&&e._code===$r.NoResolverFound}static isHandled(e){return e instanceof mp&&e.isHandled}constructor(e,t=$r.Unknown,i){super(e),this._message=e,this._code=t,this._detail=i,this.isHandled=t===$r.NotAvailable&&i===!0,Object.setPrototypeOf(this,mp.prototype)}};function NC(r){const e=r.indexOf("+");return e===-1?r:r.substring(0,e)}const Vee="workbench.editor.notebook";var jp;(function(r){r[r.Markup=1]="Markup",r[r.Code=2]="Code"})(jp||(jp={}));var _y;(function(r){r[r.Unconfirmed=1]="Unconfirmed",r[r.Pending=2]="Pending",r[r.Executing=3]="Executing"})(_y||(_y={}));var _n;(function(r){r[r.ModelChange=1]="ModelChange",r[r.Move=2]="Move",r[r.ChangeCellLanguage=5]="ChangeCellLanguage",r[r.Initialize=6]="Initialize",r[r.ChangeCellMetadata=7]="ChangeCellMetadata",r[r.Output=8]="Output",r[r.OutputItem=9]="OutputItem",r[r.ChangeCellContent=10]="ChangeCellContent",r[r.ChangeDocumentMetadata=11]="ChangeDocumentMetadata",r[r.ChangeCellInternalMetadata=12]="ChangeCellInternalMetadata",r[r.ChangeCellMime=13]="ChangeCellMime",r[r.Unknown=100]="Unknown"})(_n||(_n={}));var VP;(function(r){r[r.Handle=0]="Handle",r[r.Index=1]="Index"})(VP||(VP={}));var $C;(function(r){r.scheme=pe.vscodeNotebookCell;const e=["W","X","Y","Z","a","b","c","d","e","f"],t=new RegExp(`^[${e.join("")}]+`),i=7;function n(l,u){const h=u.toString(i),m=`${h.length<e.length?e[h.length-1]:"z"}${h}s${NN(De.fromString(l.scheme),!0,!0)}`;return l.with({scheme:r.scheme,fragment:m})}r.generate=n;function s(l){if(l.scheme!==r.scheme)return;const u=l.fragment.indexOf("s");if(u<0)return;const h=parseInt(l.fragment.substring(0,u).replace(t,""),i),g=sq(l.fragment.substring(u+1)).toString();if(!isNaN(h))return{handle:h,notebook:l.with({scheme:g,fragment:null})}}r.parse=s;function o(l,u){return l.with({scheme:pe.vscodeNotebookCellOutput,fragment:`op${u??""},${l.scheme!==pe.file?l.scheme:""}`})}r.generateCellOutputUri=o;function a(l){if(l.scheme!==pe.vscodeNotebookCellOutput)return;const u=/^op([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})?\,(.*)$/i.exec(l.fragment);if(!u)return;const h=u[1]&&u[1]!==""?u[1]:void 0,g=u[2];return{outputId:h,notebook:l.with({scheme:g||pe.file,fragment:null})}}r.parseCellOutputUri=a;function c(l,u,h){return r.generate(l,u).with({scheme:h})}r.generateCellPropertyUri=c;function d(l,u){if(l.scheme===u)return r.parse(l.with({scheme:r.scheme}))}r.parseCellPropertyUri=d})($C||($C={}));function sz(r){return["application/vnd.code.notebook.stdout","application/vnd.code.notebook.stderr"].includes(r)}const qee=new TextDecoder;function Gee(r){const e=[];let t=!1;for(const i of r)(e.length===0||t)&&(e.push(i),t=!0);return Kee(e),Zee(De.concat(e.map(i=>De.wrap(i))))}const vS=`${String.fromCharCode(27)}[A`,GI=vS.split("").map(r=>r.charCodeAt(0)),zee=10;function Kee(r){r.forEach((e,t)=>{if(t===0||e.length<vS.length)return;const i=r[t-1],n=e.subarray(0,vS.length);if(n[0]===GI[0]&&n[1]===GI[1]&&n[2]===GI[2]){const s=i.lastIndexOf(zee);if(s===-1)return;r[t-1]=i.subarray(0,s),r[t]=e.subarray(vS.length)}})}function Qee(r){let e=r;do r=e,e=r.replace(/[^\n]\x08/gm,"");while(e.length<r.length);return r}function Yee(r){for(r=r.replace(/\r+\n/gm,`
`);r.search(/\r[^$]/g)>-1;){const e=r.match(/^(.*)\r+/m)[1];let t=r.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),r=r.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return r}const Xee="\b".charCodeAt(0),Jee="\r".charCodeAt(0);function Zee(r){return!r.buffer.includes(Xee)&&!r.buffer.includes(Jee)?r:De.fromString(Yee(Qee(qee.decode(r.buffer))))}var vp,Qr,yS,rp,qd,Hv,oz,az,qP,Wu,Oc,GP,Hu,Yd,ju,zP,KP,_S,jv,QP,oc,Qa,YP,vs,XP,JP;function Je(r){return Object.assign(r,{apply:function(){const t=arguments.length===1?[]:arguments[1];return Reflect.construct(r,t,arguments[0].constructor)},call:function(){if(arguments.length===0)return Reflect.construct(r,[]);{const[t,...i]=arguments;return Reflect.construct(r,i,t.constructor)}}})}var ZP;(function(r){r[r.Top=0]="Top",r[r.Bottom=1]="Bottom"})(ZP||(ZP={}));var s_;(function(r){r[r.Command=0]="Command",r[r.Opener=1]="Opener"})(s_||(s_={}));let Yt=qP=class{static from(...e){let t=e;return new qP(function(){if(t){for(const i of t)i&&typeof i.dispose=="function"&&i.dispose();t=void 0}})}constructor(e){vp.set(this,void 0),rt(this,vp,e,"f")}dispose(){typeof V(this,vp,"f")=="function"&&(V(this,vp,"f").call(this),rt(this,vp,void 0,"f"))}};vp=new WeakMap;Yt=qP=T([Je],Yt);let At=Wu=class{static Min(...e){if(e.length===0)throw new TypeError;let t=e[0];for(let i=1;i<e.length;i++){const n=e[i];n.isBefore(t)&&(t=n)}return t}static Max(...e){if(e.length===0)throw new TypeError;let t=e[0];for(let i=1;i<e.length;i++){const n=e[i];n.isAfter(t)&&(t=n)}return t}static isPosition(e){if(!e)return!1;if(e instanceof Wu)return!0;const{line:t,character:i}=e;return typeof t=="number"&&typeof i=="number"}static of(e){if(e instanceof Wu)return e;if(this.isPosition(e))return new Wu(e.line,e.character);throw new Error("Invalid argument, is NOT a position-like object")}get line(){return this._line}get character(){return this._character}constructor(e,t){if(e<0)throw $t("line must be non-negative");if(t<0)throw $t("character must be non-negative");this._line=e,this._character=t}isBefore(e){return this._line<e._line?!0:e._line<this._line?!1:this._character<e._character}isBeforeOrEqual(e){return this._line<e._line?!0:e._line<this._line?!1:this._character<=e._character}isAfter(e){return!this.isBeforeOrEqual(e)}isAfterOrEqual(e){return!this.isBefore(e)}isEqual(e){return this._line===e._line&&this._character===e._character}compareTo(e){return this._line<e._line?-1:this._line>e.line?1:this._character<e._character?-1:this._character>e._character?1:0}translate(e,t=0){if(e===null||t===null)throw $t();let i;return typeof e>"u"?i=0:typeof e=="number"?i=e:(i=typeof e.lineDelta=="number"?e.lineDelta:0,t=typeof e.characterDelta=="number"?e.characterDelta:0),i===0&&t===0?this:new Wu(this.line+i,this.character+t)}with(e,t=this.character){if(e===null||t===null)throw $t();let i;return typeof e>"u"?i=this.line:typeof e=="number"?i=e:(i=typeof e.line=="number"?e.line:this.line,t=typeof e.character=="number"?e.character:this.character),i===this.line&&t===this.character?this:new Wu(i,t)}toJSON(){return{line:this.line,character:this.character}}};At=Wu=T([Je],At);let Tt=Oc=class{static isRange(e){return e instanceof Oc?!0:e?At.isPosition(e.start)&&At.isPosition(e.end):!1}static of(e){if(e instanceof Oc)return e;if(this.isRange(e))return new Oc(e.start,e.end);throw new Error("Invalid argument, is NOT a range-like object")}get start(){return this._start}get end(){return this._end}constructor(e,t,i,n){let s,o;if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"?(s=new At(e,t),o=new At(i,n)):At.isPosition(e)&&At.isPosition(t)&&(s=At.of(e),o=At.of(t)),!s||!o)throw new Error("Invalid arguments");s.isBefore(o)?(this._start=s,this._end=o):(this._start=o,this._end=s)}contains(e){return Oc.isRange(e)?this.contains(e.start)&&this.contains(e.end):At.isPosition(e)?!(At.of(e).isBefore(this._start)||this._end.isBefore(e)):!1}isEqual(e){return this._start.isEqual(e._start)&&this._end.isEqual(e._end)}intersection(e){const t=At.Max(e.start,this._start),i=At.Min(e.end,this._end);if(!t.isAfter(i))return new Oc(t,i)}union(e){if(this.contains(e))return this;if(e.contains(this))return e;const t=At.Min(e.start,this._start),i=At.Max(e.end,this.end);return new Oc(t,i)}get isEmpty(){return this._start.isEqual(this._end)}get isSingleLine(){return this._start.line===this._end.line}with(e,t=this.end){if(e===null||t===null)throw $t();let i;return e?At.isPosition(e)?i=e:(i=e.start||this.start,t=e.end||this.end):i=this.start,i.isEqual(this._start)&&t.isEqual(this.end)?this:new Oc(i,t)}toJSON(){return[this.start,this.end]}};Tt=Oc=T([Je],Tt);let wd=GP=class extends Tt{static isSelection(e){return e instanceof GP?!0:e?Tt.isRange(e)&&At.isPosition(e.anchor)&&At.isPosition(e.active)&&typeof e.isReversed=="boolean":!1}get anchor(){return this._anchor}get active(){return this._active}constructor(e,t,i,n){let s,o;if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"?(s=new At(e,t),o=new At(i,n)):At.isPosition(e)&&At.isPosition(t)&&(s=At.of(e),o=At.of(t)),!s||!o)throw new Error("Invalid arguments");super(s,o),this._anchor=s,this._active=o}get isReversed(){return this._anchor===this._end}toJSON(){return{start:this.start,end:this.end,active:this.active,anchor:this.anchor}}};wd=GP=T([Je],wd);const cz=r=>{if(typeof r!="string"||r.length===0||!/^[0-9A-Za-z_\-]+$/.test(r))throw $t("connectionToken")};class ete{static isResolvedAuthority(e){return e&&typeof e=="object"&&typeof e.host=="string"&&typeof e.port=="number"&&(e.connectionToken===void 0||typeof e.connectionToken=="string")}constructor(e,t,i){if(typeof e!="string"||e.length===0)throw $t("host");if(typeof t!="number"||t===0||Math.round(t)!==t)throw $t("port");typeof i<"u"&&cz(i),this.host=e,this.port=Math.round(t),this.connectionToken=i}}class eA{static isManagedResolvedAuthority(e){return e&&typeof e=="object"&&typeof e.makeConnection=="function"&&(e.connectionToken===void 0||typeof e.connectionToken=="string")}constructor(e,t){this.makeConnection=e,this.connectionToken=t,typeof t<"u"&&cz(t)}}class $l extends Error{static NotAvailable(e,t){return new $l(e,$r.NotAvailable,t)}static TemporarilyNotAvailable(e){return new $l(e,$r.TemporarilyNotAvailable)}constructor(e,t=$r.Unknown,i){super(e),this._message=e,this._code=t,this._detail=i,Object.setPrototypeOf(this,$l.prototype)}}var Bo;(function(r){r[r.LF=1]="LF",r[r.CRLF=2]="CRLF"})(Bo||(Bo={}));var xh;(function(r){r[r.Replace=1]="Replace",r[r.Append=2]="Append",r[r.Prepend=3]="Prepend"})(xh||(xh={}));let bd=Hu=class{static isTextEdit(e){return e instanceof Hu?!0:e?Tt.isRange(e)&&typeof e.newText=="string":!1}static replace(e,t){return new Hu(e,t)}static insert(e,t){return Hu.replace(new Tt(e,e),t)}static delete(e){return Hu.replace(e,"")}static setEndOfLine(e){const t=new Hu(new Tt(new At(0,0),new At(0,0)),"");return t.newEol=e,t}get range(){return this._range}set range(e){if(e&&!Tt.isRange(e))throw $t("range");this._range=e}get newText(){return this._newText||""}set newText(e){if(e&&typeof e!="string")throw $t("newText");this._newText=e}get newEol(){return this._newEol}set newEol(e){if(e&&typeof e!="number")throw $t("newEol");this._newEol=e}constructor(e,t){this._range=e,this._newText=t}toJSON(){return{range:this.range,newText:this.newText,newEol:this._newEol}}};bd=Hu=T([Je],bd);let WC=Yd=class{static isNotebookCellEdit(e){return e instanceof Yd?!0:e?Zc.isNotebookRange(e)&&Array.isArray(e.newCells):!1}static replaceCells(e,t){return new Yd(e,t)}static insertCells(e,t){return new Yd(new Zc(e,e),t)}static deleteCells(e){return new Yd(e,[])}static updateCellMetadata(e,t){const i=new Yd(new Zc(e,e),[]);return i.newCellMetadata=t,i}static updateNotebookMetadata(e){const t=new Yd(new Zc(0,0),[]);return t.newNotebookMetadata=e,t}constructor(e,t){this.range=e,this.newCells=t}};WC=Yd=T([Je],WC);let Pk=class wS{static isSnippetTextEdit(e){return e instanceof wS?!0:e?Tt.isRange(e.range)&&ru.isSnippetString(e.snippet):!1}static replace(e,t){return new wS(e,t)}static insert(e,t){return wS.replace(new Tt(e,e),t)}constructor(e,t){this.range=e,this.snippet=t}},Sd=class{constructor(){this._edits=[]}_allEntries(){return this._edits}renameFile(e,t,i,n){this._edits.push({_type:1,from:e,to:t,options:i,metadata:n})}createFile(e,t,i){this._edits.push({_type:1,from:void 0,to:e,options:t,metadata:i})}deleteFile(e,t,i){this._edits.push({_type:1,from:e,to:void 0,options:t,metadata:i})}replaceNotebookMetadata(e,t,i){this._edits.push({_type:3,metadata:i,uri:e,edit:{editType:5,metadata:t},notebookMetadata:t})}replaceNotebookCells(e,t,i,n){const s=t.start,o=t.end;(s!==o||i.length>0)&&this._edits.push({_type:5,uri:e,index:s,count:o-s,cells:i,metadata:n})}replaceNotebookCellMetadata(e,t,i,n){this._edits.push({_type:3,metadata:n,uri:e,edit:{editType:3,index:t,metadata:i}})}replace(e,t,i,n){this._edits.push({_type:2,uri:e,edit:new bd(t,i),metadata:n})}insert(e,t,i,n){this.replace(e,new Tt(t,t),i,n)}delete(e,t,i){this.replace(e,t,"",i)}has(e){return this._edits.some(t=>t._type===2&&t.uri.toString()===e.toString())}set(e,t){if(t)for(const i of t){if(!i)continue;let n,s;Array.isArray(i)?(n=i[0],s=i[1]):n=i,WC.isNotebookCellEdit(n)?n.newCellMetadata?this.replaceNotebookCellMetadata(e,n.range.start,n.newCellMetadata,s):n.newNotebookMetadata?this.replaceNotebookMetadata(e,n.newNotebookMetadata,s):this.replaceNotebookCells(e,n.range,n.newCells,s):Pk.isSnippetTextEdit(n)?this._edits.push({_type:6,uri:e,range:n.range,edit:n.snippet,metadata:s}):this._edits.push({_type:2,uri:e,edit:n,metadata:s})}else{for(let i=0;i<this._edits.length;i++){const n=this._edits[i];switch(n._type){case 2:case 6:case 3:case 5:n.uri.toString()===e.toString()&&(this._edits[i]=void 0);break}}Z9(this._edits)}}get(e){const t=[];for(const i of this._edits)i._type===2&&i.uri.toString()===e.toString()&&t.push(i.edit);return t}entries(){const e=new ki;for(const t of this._edits)if(t._type===2){let i=e.get(t.uri);i||(i=[t.uri,[]],e.set(t.uri,i)),i[1].push(t.edit)}return[...e.values()]}get size(){return this.entries().length}toJSON(){return this.entries()}};Sd=T([Je],Sd);let ru=ju=class{static isSnippetString(e){return e instanceof ju?!0:e?typeof e.value=="string":!1}static _escape(e){return e.replace(/\$|}|\\/g,"\\$&")}constructor(e){this._tabstop=1,this.value=e||""}appendText(e){return this.value+=ju._escape(e),this}appendTabstop(e=this._tabstop++){return this.value+="$",this.value+=e,this}appendPlaceholder(e,t=this._tabstop++){if(typeof e=="function"){const i=new ju;i._tabstop=this._tabstop,e(i),this._tabstop=i._tabstop,e=i.value}else e=ju._escape(e);return this.value+="${",this.value+=t,this.value+=":",this.value+=e,this.value+="}",this}appendChoice(e,t=this._tabstop++){const i=e.map(n=>n.replace(/\$|}|\\|,/g,"\\$&")).join(",");return this.value+="${",this.value+=t,this.value+="|",this.value+=i,this.value+="|}",this}appendVariable(e,t){if(typeof t=="function"){const i=new ju;i._tabstop=this._tabstop,t(i),this._tabstop=i._tabstop,t=i.value}else typeof t=="string"&&(t=t.replace(/\$|}/g,"\\$&"));return this.value+="${",this.value+=e,t&&(this.value+=":",this.value+=t),this.value+="}",this}};ru=ju=T([Je],ru);var vl;(function(r){r[r.Unnecessary=1]="Unnecessary",r[r.Deprecated=2]="Deprecated"})(vl||(vl={}));var ur;(function(r){r[r.Hint=3]="Hint",r[r.Information=2]="Information",r[r.Warning=1]="Warning",r[r.Error=0]="Error"})(ur||(ur={}));let wo=zP=class{static isLocation(e){return e instanceof zP?!0:e?Tt.isRange(e.range)&&k.isUri(e.uri):!1}constructor(e,t){if(this.uri=e,t)if(Tt.isRange(t))this.range=Tt.of(t);else if(At.isPosition(t))this.range=new Tt(t,t);else throw new Error("Illegal argument")}toJSON(){return{uri:this.uri,range:this.range}}};wo=zP=T([Je],wo);let Fg=class{static is(e){return e?typeof e.message=="string"&&e.location&&Tt.isRange(e.location.range)&&k.isUri(e.location.uri):!1}constructor(e,t){this.location=e,this.message=t}static isEqual(e,t){return e===t?!0:!e||!t?!1:e.message===t.message&&e.location.range.isEqual(t.location.range)&&e.location.uri.toString()===t.location.uri.toString()}};Fg=T([Je],Fg);let o_=class{constructor(e,t,i=ur.Error){if(!Tt.isRange(e))throw new TypeError("range must be set");if(!t)throw new TypeError("message must be set");this.range=e,this.message=t,this.severity=i}toJSON(){return{severity:ur[this.severity],message:this.message,range:this.range,source:this.source,code:this.code}}static isEqual(e,t){return e===t?!0:!e||!t?!1:e.message===t.message&&e.severity===t.severity&&e.code===t.code&&e.severity===t.severity&&e.source===t.source&&e.range.isEqual(t.range)&&Ds(e.tags,t.tags)&&Ds(e.relatedInformation,t.relatedInformation,Fg.isEqual)}};o_=T([Je],o_);let a_=class{constructor(e,t){if(!e)throw new Error("Illegal argument, contents must be defined");Array.isArray(e)?this.contents=e:this.contents=[e],this.range=t}};a_=T([Je],a_);var Og;(function(r){r[r.Text=0]="Text",r[r.Read=1]="Read",r[r.Write=2]="Write"})(Og||(Og={}));let c_=class{constructor(e,t=Og.Text){this.range=e,this.kind=t}toJSON(){return{range:this.range,kind:Og[this.kind]}}};c_=T([Je],c_);var Ai;(function(r){r[r.File=0]="File",r[r.Module=1]="Module",r[r.Namespace=2]="Namespace",r[r.Package=3]="Package",r[r.Class=4]="Class",r[r.Method=5]="Method",r[r.Property=6]="Property",r[r.Field=7]="Field",r[r.Constructor=8]="Constructor",r[r.Enum=9]="Enum",r[r.Interface=10]="Interface",r[r.Function=11]="Function",r[r.Variable=12]="Variable",r[r.Constant=13]="Constant",r[r.String=14]="String",r[r.Number=15]="Number",r[r.Boolean=16]="Boolean",r[r.Array=17]="Array",r[r.Object=18]="Object",r[r.Key=19]="Key",r[r.Null=20]="Null",r[r.EnumMember=21]="EnumMember",r[r.Struct=22]="Struct",r[r.Event=23]="Event",r[r.Operator=24]="Operator",r[r.TypeParameter=25]="TypeParameter"})(Ai||(Ai={}));var Ng;(function(r){r[r.Deprecated=1]="Deprecated"})(Ng||(Ng={}));let $g=KP=class{static validate(e){if(!e.name)throw new Error("name must not be falsy")}constructor(e,t,i,n,s){this.name=e,this.kind=t,this.containerName=s,typeof i=="string"&&(this.containerName=i),n instanceof wo?this.location=n:i instanceof Tt&&(this.location=new wo(n,i)),KP.validate(this)}toJSON(){return{name:this.name,kind:Ai[this.kind],location:this.location,containerName:this.containerName}}};$g=KP=T([Je],$g);let Wg=_S=class{static validate(e){var t;if(!e.name)throw new Error("name must not be falsy");if(!e.range.contains(e.selectionRange))throw new Error("selectionRange must be contained in fullRange");(t=e.children)==null||t.forEach(_S.validate)}constructor(e,t,i,n,s){this.name=e,this.detail=t,this.kind=i,this.range=n,this.selectionRange=s,this.children=[],_S.validate(this)}};Wg=_S=T([Je],Wg);var uf;(function(r){r[r.Invoke=1]="Invoke",r[r.Automatic=2]="Automatic"})(uf||(uf={}));let d_=class{constructor(e,t){this.title=e,this.kind=t}};d_=T([Je],d_);let $i=jv=class{constructor(e){this.value=e}append(e){return new jv(this.value?this.value+jv.sep+e:e)}intersects(e){return this.contains(e)||e.contains(this)}contains(e){return this.value===e.value||e.value.startsWith(this.value+jv.sep)}};$i.sep=".";$i=jv=T([Je],$i);class tte extends $i{constructor(e){super(e),this.value=e}}$i.Empty=new $i("");$i.QuickFix=$i.Empty.append("quickfix");$i.Refactor=$i.Empty.append("refactor");$i.RefactorExtract=$i.Refactor.append("extract");$i.RefactorInline=$i.Refactor.append("inline");$i.RefactorMove=$i.Refactor.append("move");$i.RefactorRewrite=$i.Refactor.append("rewrite");$i.Source=$i.Empty.append("source");$i.SourceOrganizeImports=$i.Source.append("organizeImports");$i.SourceFixAll=$i.Source.append("fixAll");$i.Notebook=$i.Empty.append("notebook");let Hg=class{constructor(e,t){if(this.range=e,this.parent=t,t&&!t.range.contains(this.range))throw new Error("Invalid argument: parent must contain this range")}};Hg=T([Je],Hg);let Ak=class{constructor(e,t,i,n,s,o){this.kind=e,this.name=t,this.detail=i,this.uri=n,this.range=s,this.selectionRange=o}},k1=class{constructor(e,t){this.fromRanges=t,this.from=e}},T1=class{constructor(e,t){this.fromRanges=t,this.to=e}};var Dh;(function(r){r[r.Information=0]="Information",r[r.Warning=1]="Warning",r[r.Error=2]="Error"})(Dh||(Dh={}));let l_=class{constructor(e,t){this.range=e,this.command=t}get isResolved(){return!!this.command}};l_=T([Je],l_);let Ia=QP=class{static isMarkdownString(e){return e instanceof QP?!0:e&&e.appendCodeblock&&e.appendMarkdown&&e.appendText&&e.value!==void 0}constructor(e,t=!1){Qr.set(this,void 0),rt(this,Qr,new oq(e,{supportThemeIcons:t}),"f")}get value(){return V(this,Qr,"f").value}set value(e){V(this,Qr,"f").value=e}get isTrusted(){return V(this,Qr,"f").isTrusted}set isTrusted(e){V(this,Qr,"f").isTrusted=e}get supportThemeIcons(){return V(this,Qr,"f").supportThemeIcons}set supportThemeIcons(e){V(this,Qr,"f").supportThemeIcons=e}get supportHtml(){return V(this,Qr,"f").supportHtml}set supportHtml(e){V(this,Qr,"f").supportHtml=e}get baseUri(){return V(this,Qr,"f").baseUri}set baseUri(e){V(this,Qr,"f").baseUri=e}appendText(e){return V(this,Qr,"f").appendText(e),this}appendMarkdown(e){return V(this,Qr,"f").appendMarkdown(e),this}appendCodeblock(e,t){return V(this,Qr,"f").appendCodeblock(t??"",e),this}};Qr=new WeakMap;Ia=QP=T([Je],Ia);let HC=class{constructor(e,t){this.label=e,this.documentation=t}};HC=T([Je],HC);let jC=class{constructor(e,t){this.label=e,this.documentation=t,this.parameters=[]}};jC=T([Je],jC);let BC=class{constructor(){this.activeSignature=0,this.activeParameter=0,this.signatures=[]}};BC=T([Je],BC);var UC;(function(r){r[r.Invoke=1]="Invoke",r[r.TriggerCharacter=2]="TriggerCharacter",r[r.ContentChange=3]="ContentChange"})(UC||(UC={}));var VC;(function(r){r[r.Type=1]="Type",r[r.Parameter=2]="Parameter"})(VC||(VC={}));let u_=class{constructor(e){this.value=e}};u_=T([Je],u_);let h_=class{constructor(e,t,i){this.position=e,this.label=t,this.kind=i}};h_=T([Je],h_);var kh;(function(r){r[r.Invoke=0]="Invoke",r[r.TriggerCharacter=1]="TriggerCharacter",r[r.TriggerForIncompleteCompletions=2]="TriggerForIncompleteCompletions"})(kh||(kh={}));var ht;(function(r){r[r.Text=0]="Text",r[r.Method=1]="Method",r[r.Function=2]="Function",r[r.Constructor=3]="Constructor",r[r.Field=4]="Field",r[r.Variable=5]="Variable",r[r.Class=6]="Class",r[r.Interface=7]="Interface",r[r.Module=8]="Module",r[r.Property=9]="Property",r[r.Unit=10]="Unit",r[r.Value=11]="Value",r[r.Enum=12]="Enum",r[r.Keyword=13]="Keyword",r[r.Snippet=14]="Snippet",r[r.Color=15]="Color",r[r.File=16]="File",r[r.Reference=17]="Reference",r[r.Folder=18]="Folder",r[r.EnumMember=19]="EnumMember",r[r.Constant=20]="Constant",r[r.Struct=21]="Struct",r[r.Event=22]="Event",r[r.Operator=23]="Operator",r[r.TypeParameter=24]="TypeParameter",r[r.User=25]="User",r[r.Issue=26]="Issue"})(ht||(ht={}));var jg;(function(r){r[r.Deprecated=1]="Deprecated"})(jg||(jg={}));let f_=class{constructor(e,t){this.label=e,this.kind=t}toJSON(){return{label:this.label,kind:this.kind&&ht[this.kind],detail:this.detail,documentation:this.documentation,sortText:this.sortText,filterText:this.filterText,preselect:this.preselect,insertText:this.insertText,textEdit:this.textEdit}}};f_=T([Je],f_);let hf=class{constructor(e=[],t=!1){this.items=e,this.isIncomplete=t}};hf=T([Je],hf);let qC=class{constructor(e,t,i){this.insertText=e,this.range=t,this.command=i}};qC=T([Je],qC);let GC=class{constructor(e){this.commands=void 0,this.suppressSuggestions=void 0,this.items=e}};GC=T([Je],GC);var Bg;(function(r){r[r.Active=-1]="Active",r[r.Beside=-2]="Beside",r[r.One=1]="One",r[r.Two=2]="Two",r[r.Three=3]="Three",r[r.Four=4]="Four",r[r.Five=5]="Five",r[r.Six=6]="Six",r[r.Seven=7]="Seven",r[r.Eight=8]="Eight",r[r.Nine=9]="Nine"})(Bg||(Bg={}));var Jc;(function(r){r[r.Left=1]="Left",r[r.Right=2]="Right"})(Jc||(Jc={}));function ite(r,e){return`${fn.toKey(r)}.${e}`}var ic;(function(r){r[r.Off=0]="Off",r[r.On=1]="On",r[r.Relative=2]="Relative"})(ic||(ic={}));var Th;(function(r){r[r.Manual=1]="Manual",r[r.AfterDelay=2]="AfterDelay",r[r.FocusOut=3]="FocusOut"})(Th||(Th={}));var p_;(function(r){r[r.Default=0]="Default",r[r.InCenter=1]="InCenter",r[r.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",r[r.AtTop=3]="AtTop"})(p_||(p_={}));var ff;(function(r){r[r.Keyboard=1]="Keyboard",r[r.Mouse=2]="Mouse",r[r.Command=3]="Command"})(ff||(ff={}));var Ug;(function(r){r[r.Undo=1]="Undo",r[r.Redo=2]="Redo"})(Ug||(Ug={}));var yl;(function(r){r[r.OpenOpen=0]="OpenOpen",r[r.ClosedClosed=1]="ClosedClosed",r[r.OpenClosed=2]="OpenClosed",r[r.ClosedOpen=3]="ClosedOpen"})(yl||(yl={}));(function(r){function e(t){switch(t){case"keyboard":return r.Keyboard;case"mouse":return r.Mouse;case"api":return r.Command}}r.fromValue=e})(ff||(ff={}));let g_=class{constructor(e,t){if(t&&!k.isUri(t))throw $t("target");if(!Tt.isRange(e)||e.isEmpty)throw $t("range");this.range=e,this.target=t}};g_=T([Je],g_);let pf=class{constructor(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n}};pf=T([Je],pf);let m_=class{constructor(e,t){if(t&&!(t instanceof pf))throw $t("color");if(!Tt.isRange(e)||e.isEmpty)throw $t("range");this.range=e,this.color=t}};m_=T([Je],m_);let v_=class{constructor(e){if(!e||typeof e!="string")throw $t("label");this.label=e}};v_=T([Je],v_);var tA;(function(r){r[r.Error=0]="Error",r[r.Warning=1]="Warning",r[r.Information=2]="Information"})(tA||(tA={}));var zC;(function(r){r[r.Unknown=0]="Unknown",r[r.Shutdown=1]="Shutdown",r[r.Process=2]="Process",r[r.User=3]="User",r[r.Extension=4]="Extension"})(zC||(zC={}));let dz=class{constructor(e,t,i){if(this.startIndex=e,this.length=t,this.tooltip=i,typeof e!="number"||e<0)throw $t("startIndex");if(typeof t!="number"||t<1)throw $t("length");if(i!==void 0&&typeof i!="string")throw $t("tooltip")}};class nte{constructor(e){this.uri=e}}class rte{constructor(e){this.terminalCommand=e}}var KC;(function(r){r[r.Panel=1]="Panel",r[r.Editor=2]="Editor"})(KC||(KC={}));let lz=class{constructor(e){if(this.options=e,typeof e!="object")throw $t("options")}};var iA;(function(r){r[r.Always=1]="Always",r[r.Silent=2]="Silent",r[r.Never=3]="Never"})(iA||(iA={}));var nA;(function(r){r[r.Shared=1]="Shared",r[r.Dedicated=2]="Dedicated",r[r.New=3]="New"})(nA||(nA={}));let Cd=oc=class{static from(e){switch(e){case"clean":return oc.Clean;case"build":return oc.Build;case"rebuild":return oc.Rebuild;case"test":return oc.Test;default:return}}constructor(e,t){if(this.label=t,typeof e!="string")throw $t("name");if(typeof t!="string")throw $t("name");this._id=e}get id(){return this._id}};Cd.Clean=new oc("clean","Clean");Cd.Build=new oc("build","Build");Cd.Rebuild=new oc("rebuild","Rebuild");Cd.Test=new oc("test","Test");Cd=oc=T([Je],Cd);function uz(r){let e="";for(let t=0;t<r.length;t++)e+=r[t].replace(/,/g,",,")+",";return e}let gf=class{constructor(e,t,i){if(typeof e!="string")throw $t("process");this._args=[],this._process=e,t!==void 0&&(Array.isArray(t)?(this._args=t,this._options=i):this._options=t)}get process(){return this._process}set process(e){if(typeof e!="string")throw $t("process");this._process=e}get args(){return this._args}set args(e){Array.isArray(e)||(e=[]),this._args=e}get options(){return this._options}set options(e){this._options=e}computeId(){const e=[];if(e.push("process"),this._process!==void 0&&e.push(this._process),this._args&&this._args.length>0)for(const t of this._args)e.push(t);return uz(e)}};gf=T([Je],gf);let su=class{constructor(e,t,i){if(this._args=[],Array.isArray(t)){if(!e)throw $t("command can't be undefined or null");if(typeof e!="string"&&typeof e.value!="string")throw $t("command");this._command=e,this._args=t,this._options=i}else{if(typeof e!="string")throw $t("commandLine");this._commandLine=e,this._options=t}}get commandLine(){return this._commandLine}set commandLine(e){if(typeof e!="string")throw $t("commandLine");this._commandLine=e}get command(){return this._command?this._command:""}set command(e){if(typeof e!="string"&&typeof e.value!="string")throw $t("command");this._command=e}get args(){return this._args}set args(e){this._args=e||[]}get options(){return this._options}set options(e){this._options=e}computeId(){const e=[];if(e.push("shell"),this._commandLine!==void 0&&e.push(this._commandLine),this._command!==void 0&&e.push(typeof this._command=="string"?this._command:this._command.value),this._args&&this._args.length>0)for(const t of this._args)e.push(typeof t=="string"?t:t.value);return uz(e)}};su=T([Je],su);var QC;(function(r){r[r.Escape=1]="Escape",r[r.Strong=2]="Strong",r[r.Weak=3]="Weak"})(QC||(QC={}));var mf;(function(r){r[r.Global=1]="Global",r[r.Workspace=2]="Workspace"})(mf||(mf={}));let Mk=class{constructor(e){this._callback=e}computeId(){return"customExecution"+Nn()}set callback(e){this._callback=e}get callback(){return this._callback}},ou=Qa=class{constructor(e,t,i,n,s,o){this.__deprecated=!1,this._definition=this.definition=e;let a;typeof t=="string"?(this._name=this.name=t,this._source=this.source=i,this.execution=n,a=s,this.__deprecated=!0):t===mf.Global||t===mf.Workspace?(this.target=t,this._name=this.name=i,this._source=this.source=n,this.execution=s,a=o):(this.target=t,this._name=this.name=i,this._source=this.source=n,this.execution=s,a=o),typeof a=="string"?(this._problemMatchers=[a],this._hasDefinedMatchers=!0):Array.isArray(a)?(this._problemMatchers=a,this._hasDefinedMatchers=!0):(this._problemMatchers=[],this._hasDefinedMatchers=!1),this._isBackground=!1,this._presentationOptions=Object.create(null),this._runOptions=Object.create(null)}get _id(){return this.__id}set _id(e){this.__id=e}get _deprecated(){return this.__deprecated}clear(){this.__id!==void 0&&(this.__id=void 0,this._scope=void 0,this.computeDefinitionBasedOnExecution())}computeDefinitionBasedOnExecution(){this._execution instanceof gf?this._definition={type:Qa.ProcessType,id:this._execution.computeId()}:this._execution instanceof su?this._definition={type:Qa.ShellType,id:this._execution.computeId()}:this._execution instanceof Mk?this._definition={type:Qa.ExtensionCallbackType,id:this._execution.computeId()}:this._definition={type:Qa.EmptyType,id:Nn()}}get definition(){return this._definition}set definition(e){if(e==null)throw $t("Kind can't be undefined or null");this.clear(),this._definition=e}get scope(){return this._scope}set target(e){this.clear(),this._scope=e}get name(){return this._name}set name(e){if(typeof e!="string")throw $t("name");this.clear(),this._name=e}get execution(){return this._execution}set execution(e){e===null&&(e=void 0),this.clear(),this._execution=e;const t=this._definition.type;(Qa.EmptyType===t||Qa.ProcessType===t||Qa.ShellType===t||Qa.ExtensionCallbackType===t)&&this.computeDefinitionBasedOnExecution()}get problemMatchers(){return this._problemMatchers}set problemMatchers(e){if(Array.isArray(e))this.clear(),this._problemMatchers=e,this._hasDefinedMatchers=!0;else{this.clear(),this._problemMatchers=[],this._hasDefinedMatchers=!1;return}}get hasDefinedMatchers(){return this._hasDefinedMatchers}get isBackground(){return this._isBackground}set isBackground(e){e!==!0&&e!==!1&&(e=!1),this.clear(),this._isBackground=e}get source(){return this._source}set source(e){if(typeof e!="string"||e.length===0)throw $t("source must be a string of length > 0");this.clear(),this._source=e}get group(){return this._group}set group(e){e===null&&(e=void 0),this.clear(),this._group=e}get detail(){return this._detail}set detail(e){e===null&&(e=void 0),this._detail=e}get presentationOptions(){return this._presentationOptions}set presentationOptions(e){e==null&&(e=Object.create(null)),this.clear(),this._presentationOptions=e}get runOptions(){return this._runOptions}set runOptions(e){e==null&&(e=Object.create(null)),this.clear(),this._runOptions=e}};ou.ExtensionCallbackType="customExecution";ou.ProcessType="process";ou.ShellType="shell";ou.EmptyType="$empty";ou=Qa=T([Je],ou);var Wl;(function(r){r[r.SourceControl=1]="SourceControl",r[r.Window=10]="Window",r[r.Notification=15]="Notification"})(Wl||(Wl={}));var rA;(function(r){function e(t){const i=t;return pr(i.value)?i.tooltip&&!Rt(i.tooltip)?(console.log("INVALID view badge, invalid tooltip",i.tooltip),!1):!0:(console.log("INVALID view badge, invalid value",i.value),!1)}r.isViewBadge=e})(rA||(rA={}));let y_=YP=class{static isTreeItem(e,t){var n,s;const i=e;if(i.checkboxState!==void 0){const o=pr(i.checkboxState)?i.checkboxState:bn(i.checkboxState)&&pr(i.checkboxState.state)?i.checkboxState.state:void 0,a=!pr(i.checkboxState)&&bn(i.checkboxState)?i.checkboxState.tooltip:void 0;if(o===void 0||o!==fa.Checked&&o!==fa.Unchecked||a!==void 0&&!Rt(a))return console.log("INVALID tree item, invalid checkboxState",i.checkboxState),!1}if(e instanceof YP)return!0;if(i.label!==void 0&&!Rt(i.label)&&!((n=i.label)!=null&&n.label))return console.log("INVALID tree item, invalid label",i.label),!1;if(i.id!==void 0&&!Rt(i.id))return console.log("INVALID tree item, invalid id",i.id),!1;if(i.iconPath!==void 0&&!Rt(i.iconPath)&&!k.isUri(i.iconPath)&&(!i.iconPath||!Rt(i.iconPath.id))){const o=i.iconPath;if(!o||!Rt(o.light)&&!k.isUri(o.light)&&!Rt(o.dark)&&!k.isUri(o.dark))return console.log("INVALID tree item, invalid iconPath",i.iconPath),!1}return i.description!==void 0&&!Rt(i.description)&&typeof i.description!="boolean"?(console.log("INVALID tree item, invalid description",i.description),!1):i.resourceUri!==void 0&&!k.isUri(i.resourceUri)?(console.log("INVALID tree item, invalid resourceUri",i.resourceUri),!1):i.tooltip!==void 0&&!Rt(i.tooltip)&&!(i.tooltip instanceof Ia)?(console.log("INVALID tree item, invalid tooltip",i.tooltip),!1):i.command!==void 0&&!i.command.command?(console.log("INVALID tree item, invalid command",i.command),!1):i.collapsibleState!==void 0&&i.collapsibleState<Hl.None&&i.collapsibleState>Hl.Expanded?(console.log("INVALID tree item, invalid collapsibleState",i.collapsibleState),!1):i.contextValue!==void 0&&!Rt(i.contextValue)?(console.log("INVALID tree item, invalid contextValue",i.contextValue),!1):i.accessibilityInformation!==void 0&&!((s=i.accessibilityInformation)!=null&&s.label)?(console.log("INVALID tree item, invalid accessibilityInformation",i.accessibilityInformation),!1):!0}constructor(e,t=Hl.None){this.collapsibleState=t,k.isUri(e)?this.resourceUri=e:this.label=e}};y_=YP=T([Je],y_);var Hl;(function(r){r[r.None=0]="None",r[r.Collapsed=1]="Collapsed",r[r.Expanded=2]="Expanded"})(Hl||(Hl={}));var fa;(function(r){r[r.Unchecked=0]="Unchecked",r[r.Checked=1]="Checked"})(fa||(fa={}));let __=class{async asString(){return typeof this.value=="string"?this.value:JSON.stringify(this.value)}asFile(){}constructor(e){this.value=e}};__=T([Je],__);class YC extends __{}class ste extends YC{constructor(e){super(""),yS.set(this,void 0),rt(this,yS,e,"f")}asFile(){return V(this,yS,"f")}}yS=new WeakMap;class ote{constructor(e,t,i,n){this.name=e,this.uri=t,this._itemId=i,this._getData=n}data(){return this._getData()}}let Vg=class{constructor(e){rp.add(this),qd.set(this,new Map);for(const[t,i]of e??[]){const n=V(this,qd,"f").get(V(this,rp,"m",Hv).call(this,t));n?n.push(i):V(this,qd,"f").set(V(this,rp,"m",Hv).call(this,t),[i])}}get(e){var t;return(t=V(this,qd,"f").get(V(this,rp,"m",Hv).call(this,e)))==null?void 0:t[0]}set(e,t){V(this,qd,"f").set(V(this,rp,"m",Hv).call(this,e),[t])}forEach(e,t){for(const[i,n]of V(this,qd,"f"))for(const s of n)e.call(t,s,i,this)}*[(qd=new WeakMap,rp=new WeakSet,Symbol.iterator)](){for(const[e,t]of V(this,qd,"f"))for(const i of t)yield[e,i]}};Hv=function(e){return e.toLowerCase()};Vg=T([Je],Vg);let XC=class{constructor(e){this.insertText=e}};XC=T([Je],XC);let JC=class{constructor(e,t,i){this.id=t,this.label=i,this.insertText=e}};JC=T([Je],JC);let Es=class{constructor(e,t){this.id=e,this.color=t}static isThemeIcon(e){return typeof e.id!="string"?(console.log("INVALID ThemeIcon, invalid id",e.id),!1):!0}};Es=T([Je],Es);Es.File=new Es("file");Es.Folder=new Es("folder");let qg=class{constructor(e){this.id=e}};qg=T([Je],qg);var Ih;(function(r){r[r.Global=1]="Global",r[r.Workspace=2]="Workspace",r[r.WorkspaceFolder=3]="WorkspaceFolder"})(Ih||(Ih={}));let Rh=class{get base(){return this._base}set base(e){this._base=e,this._baseUri=k.file(e)}get baseUri(){return this._baseUri}set baseUri(e){this._baseUri=e,this._base=e.fsPath}constructor(e,t){if(typeof e!="string"&&(!e||!k.isUri(e)&&!k.isUri(e.uri)))throw $t("base");if(typeof t!="string")throw $t("pattern");typeof e=="string"?this.baseUri=k.file(e):k.isUri(e)?this.baseUri=e:this.baseUri=e.uri,this.pattern=t}toJSON(){return{pattern:this.pattern,base:this.base,baseUri:this.baseUri.toJSON()}}};Rh=T([Je],Rh);const hz=new WeakMap;function ate(r,e){hz.set(r,e)}let vf=class{constructor(e,t,i,n){this.enabled=typeof e=="boolean"?e:!0,typeof t=="string"&&(this.condition=t),typeof i=="string"&&(this.hitCondition=i),typeof n=="string"&&(this.logMessage=n)}get id(){return this._id||(this._id=hz.get(this)??Nn()),this._id}};vf=T([Je],vf);let _l=class extends vf{constructor(e,t,i,n,s){if(super(t,i,n,s),e===null)throw $t("location");this.location=e}};_l=T([Je],_l);let wl=class extends vf{constructor(e,t,i,n,s){super(t,i,n,s),this.functionName=e}};wl=T([Je],wl);let ZC=class extends vf{constructor(e,t,i,n,s,o,a){if(super(n,s,o,a),!t)throw $t("dataId");this.label=e,this.dataId=t,this.canPersist=i}};ZC=T([Je],ZC);let w_=class{constructor(e,t,i){this.command=e,this.args=t||[],this.options=i}};w_=T([Je],w_);let Gg=class{constructor(e,t){this.port=e,this.host=t}};Gg=T([Je],Gg);let b_=class{constructor(e){this.path=e}};b_=T([Je],b_);let S_=class{constructor(e){this.implementation=e}};S_=T([Je],S_);let eE=class{constructor(e,t,i){this.session=e,this.threadId=t,this.frameId=i}};eE=T([Je],eE);let tE=class{constructor(e,t){this.session=e,this.threadId=t}};tE=T([Je],tE);let C_=class{constructor(e,t){this.range=e,this.expression=t}};C_=T([Je],C_);var zg;(function(r){r[r.Invoke=0]="Invoke",r[r.Automatic=1]="Automatic"})(zg||(zg={}));let E_=class{constructor(e,t){this.range=e,this.text=t}};E_=T([Je],E_);let x_=class{constructor(e,t,i=!0){this.range=e,this.variableName=t,this.caseSensitiveLookup=i}};x_=T([Je],x_);let D_=class{constructor(e,t){this.range=e,this.expression=t}};D_=T([Je],D_);let sA=class{constructor(e,t){this.frameId=e,this.stoppedLocation=t}};sA=T([Je],sA);var Ph;(function(r){r[r.Changed=1]="Changed",r[r.Created=2]="Created",r[r.Deleted=3]="Deleted"})(Ph||(Ph={}));let In=vs=class extends Error{static FileExists(e){return new vs(e,lt.FileExists,vs.FileExists)}static FileNotFound(e){return new vs(e,lt.FileNotFound,vs.FileNotFound)}static FileNotADirectory(e){return new vs(e,lt.FileNotADirectory,vs.FileNotADirectory)}static FileIsADirectory(e){return new vs(e,lt.FileIsADirectory,vs.FileIsADirectory)}static NoPermissions(e){return new vs(e,lt.NoPermissions,vs.NoPermissions)}static Unavailable(e){return new vs(e,lt.Unavailable,vs.Unavailable)}constructor(e,t=lt.Unknown,i){super(k.isUri(e)?e.toString(!0):e),this.code=(i==null?void 0:i.name)??"Unknown",eQ(this,t),Object.setPrototypeOf(this,vs.prototype),typeof Error.captureStackTrace=="function"&&typeof i=="function"&&Error.captureStackTrace(this,i)}};In=vs=T([Je],In);let iE=class{constructor(e,t,i){this.start=e,this.end=t,this.kind=i}};iE=T([Je],iE);var nc;(function(r){r[r.Comment=1]="Comment",r[r.Imports=2]="Imports",r[r.Region=3]="Region"})(nc||(nc={}));var Kg;(function(r){r[r.Collapsed=0]="Collapsed",r[r.Expanded=1]="Expanded"})(Kg||(Kg={}));var nE;(function(r){r[r.Editing=0]="Editing",r[r.Preview=1]="Preview"})(nE||(nE={}));var oA;(function(r){r[r.Published=0]="Published",r[r.Draft=1]="Draft"})(oA||(oA={}));var k_;(function(r){r[r.Unresolved=0]="Unresolved",r[r.Resolved=1]="Resolved"})(k_||(k_={}));let rE=class{constructor(e,t=[]){this.tokenTypes=e,this.tokenModifiers=t}};function cte(r){return typeof r>"u"||$N(r)}let fz=class pz{constructor(e){if(this._prevLine=0,this._prevChar=0,this._dataIsSortedAndDeltaEncoded=!0,this._data=[],this._dataLen=0,this._tokenTypeStrToInt=new Map,this._tokenModifierStrToInt=new Map,this._hasLegend=!1,e){this._hasLegend=!0;for(let t=0,i=e.tokenTypes.length;t<i;t++)this._tokenTypeStrToInt.set(e.tokenTypes[t],t);for(let t=0,i=e.tokenModifiers.length;t<i;t++)this._tokenModifierStrToInt.set(e.tokenModifiers[t],t)}}push(e,t,i,n,s){if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"&&(typeof s=="number"||typeof s>"u"))return typeof s>"u"&&(s=0),this._pushEncoded(e,t,i,n,s);if(Tt.isRange(e)&&typeof t=="string"&&cte(i))return this._push(e,t,i);throw $t()}_push(e,t,i){if(!this._hasLegend)throw new Error("Legend must be provided in constructor");if(e.start.line!==e.end.line)throw new Error("`range` cannot span multiple lines");if(!this._tokenTypeStrToInt.has(t))throw new Error("`tokenType` is not in the provided legend");const n=e.start.line,s=e.start.character,o=e.end.character-e.start.character,a=this._tokenTypeStrToInt.get(t);let c=0;if(i)for(const d of i){if(!this._tokenModifierStrToInt.has(d))throw new Error("`tokenModifier` is not in the provided legend");const l=this._tokenModifierStrToInt.get(d);c|=1<<l>>>0}this._pushEncoded(n,s,o,a,c)}_pushEncoded(e,t,i,n,s){if(this._dataIsSortedAndDeltaEncoded&&(e<this._prevLine||e===this._prevLine&&t<this._prevChar)){this._dataIsSortedAndDeltaEncoded=!1;const c=this._data.length/5|0;let d=0,l=0;for(let u=0;u<c;u++){let h=this._data[5*u],g=this._data[5*u+1];h===0?(h=d,g+=l):h+=d,this._data[5*u]=h,this._data[5*u+1]=g,d=h,l=g}}let o=e,a=t;this._dataIsSortedAndDeltaEncoded&&this._dataLen>0&&(o-=this._prevLine,o===0&&(a-=this._prevChar)),this._data[this._dataLen++]=o,this._data[this._dataLen++]=a,this._data[this._dataLen++]=i,this._data[this._dataLen++]=n,this._data[this._dataLen++]=s,this._prevLine=e,this._prevChar=t}static _sortAndDeltaEncode(e){const t=[],i=e.length/5|0;for(let a=0;a<i;a++)t[a]=a;t.sort((a,c)=>{const d=e[5*a],l=e[5*c];if(d===l){const u=e[5*a+1],h=e[5*c+1];return u-h}return d-l});const n=new Uint32Array(e.length);let s=0,o=0;for(let a=0;a<i;a++){const c=5*t[a],d=e[c+0],l=e[c+1],u=e[c+2],h=e[c+3],g=e[c+4],m=d-s,y=m===0?l-o:l,_=5*a;n[_+0]=m,n[_+1]=y,n[_+2]=u,n[_+3]=h,n[_+4]=g,s=d,o=l}return n}build(e){return this._dataIsSortedAndDeltaEncoded?new yf(new Uint32Array(this._data),e):new yf(pz._sortAndDeltaEncode(this._data),e)}},yf=class{constructor(e,t){this.resultId=t,this.data=e}},I1=class{constructor(e,t,i){this.start=e,this.deleteCount=t,this.data=i}},wy=class{constructor(e,t){this.resultId=t,this.edits=e}};var T_;(function(r){r[r.Separate=0]="Separate",r[r.MergeWithParent=1]="MergeWithParent"})(T_||(T_={}));let _f=class{constructor(){}};_f.Back={iconPath:new Es("arrow-left")};_f=T([Je],_f);var Qg;(function(r){r[r.Separator=-1]="Separator",r[r.Default=0]="Default"})(Qg||(Qg={}));var Ah;(function(r){r[r.Info=1]="Info",r[r.Warning=2]="Warning",r[r.Error=3]="Error"})(Ah||(Ah={}));var jl;(function(r){r[r.UI=1]="UI",r[r.Workspace=2]="Workspace"})(jl||(jl={}));let sE=class{static validate(e){if(typeof e.badge=="string"){let t=oH(e.badge,0);if(t<e.badge.length&&(t+=oH(e.badge,t)),e.badge.length>t)throw new Error("The 'badge'-property must be undefined or a short character")}else if(e.badge&&!Es.isThemeIcon(e.badge))throw new Error("The 'badge'-property is not a valid ThemeIcon");if(!e.color&&!e.badge&&!e.tooltip)throw new Error("The decoration is empty");return!0}constructor(e,t,i){this.badge=e,this.tooltip=t,this.color=i}},oE=class{constructor(e){this.kind=e}};oE=T([Je],oE);var Kc;(function(r){r[r.Light=1]="Light",r[r.Dark=2]="Dark",r[r.HighContrast=3]="HighContrast",r[r.HighContrastLight=4]="HighContrastLight"})(Kc||(Kc={}));let Zc=class aA{static isNotebookRange(e){return e instanceof aA?!0:e?typeof e.start=="number"&&typeof e.end=="number":!1}get start(){return this._start}get end(){return this._end}get isEmpty(){return this._start===this._end}constructor(e,t){if(e<0)throw $t("start must be positive");if(t<0)throw $t("end must be positive");e<=t?(this._start=e,this._end=t):(this._start=t,this._end=e)}with(e){let t=this._start,i=this._end;return e.start!==void 0&&(t=e.start),e.end!==void 0&&(i=e.end),t===this._start&&i===this._end?this:new aA(t,i)}},Lk=class cA{static validate(e){if(typeof e.kind!="number")throw new Error("NotebookCellData MUST have 'kind' property");if(typeof e.value!="string")throw new Error("NotebookCellData MUST have 'value' property");if(typeof e.languageId!="string")throw new Error("NotebookCellData MUST have 'languageId' property")}static isNotebookCellDataArray(e){return Array.isArray(e)&&e.every(t=>cA.isNotebookCellData(t))}static isNotebookCellData(e){return!0}constructor(e,t,i,n,s,o,a){this.kind=e,this.value=t,this.languageId=i,this.mime=n,this.outputs=s??[],this.metadata=o,this.executionSummary=a,cA.validate(this)}},gz=class{constructor(e){this.cells=e}},R1=class Nc{static isNotebookCellOutputItem(e){return e instanceof Nc?!0:e?typeof e.mime=="string"&&e.data instanceof Uint8Array:!1}static error(e){const t={name:e.name,message:e.message,stack:e.stack};return Nc.json(t,"application/vnd.code.notebook.error")}static stdout(e){return Nc.text(e,"application/vnd.code.notebook.stdout")}static stderr(e){return Nc.text(e,"application/vnd.code.notebook.stderr")}static bytes(e,t="application/octet-stream"){return new Nc(e,t)}static text(e,t=wg.text){const i=V(Nc,oz,"f",az).encode(String(e));return new Nc(i,t)}static json(e,t="text/x-json"){const i=JSON.stringify(e,void 0,"	");return Nc.text(i,t)}constructor(e,t){this.data=e,this.mime=t;const i=aq(t,!0);if(!i)throw new Error(`INVALID mime type: ${t}. Must be in the format "type/subtype[;optionalparameter]"`);this.mime=i}};oz=R1;az={value:new TextEncoder};let aE=class dA{static isNotebookCellOutput(e){return e instanceof dA?!0:!e||typeof e!="object"?!1:typeof e.id=="string"&&Array.isArray(e.items)}static ensureUniqueMimeTypes(e,t=!1){const i=new Set,n=new Set;for(let s=0;s<e.length;s++){const o=e[s],a=aq(o.mime);if(!i.has(a)||sz(a)){i.add(a);continue}n.add(s),t&&console.warn(`DUPLICATED mime type '${o.mime}' will be dropped`)}return n.size===0?e:e.filter((s,o)=>!n.has(o))}constructor(e,t,i){this.items=dA.ensureUniqueMimeTypes(e,!0),typeof t=="string"?(this.id=t,this.metadata=i):(this.id=Nn(),this.metadata=t??i)}};var dh;(function(r){r[r.Markup=1]="Markup",r[r.Code=2]="Code"})(dh||(dh={}));var Yg;(function(r){r[r.Idle=1]="Idle",r[r.Pending=2]="Pending",r[r.Executing=3]="Executing"})(Yg||(Yg={}));var cE;(function(r){r[r.Left=1]="Left",r[r.Right=2]="Right"})(cE||(cE={}));var dE;(function(r){r[r.Default=0]="Default",r[r.InCenter=1]="InCenter",r[r.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",r[r.AtTop=3]="AtTop"})(dE||(dE={}));let dte=class{constructor(e,t){this.text=e,this.alignment=t}};var lA;(function(r){r[r.Default=1]="Default",r[r.Preferred=2]="Preferred"})(lA||(lA={}));var lE;(function(r){r[r.Default=1]="Default",r[r.Preferred=2]="Preferred",r[r.Hidden=-1]="Hidden"})(lE||(lE={}));let mz=class{constructor(e,t=[]){this.uri=e,this.provides=bg(t)}},lte=class{constructor(e){this.label=e}},uA=class{constructor(e,t){this.label=e,this.timestamp=t}};uA=T([Je],uA);var Mh;(function(r){r[r.Production=1]="Production",r[r.Development=2]="Development",r[r.Test=3]="Test"})(Mh||(Mh={}));var uE;(function(r){r[r.Node=1]="Node",r[r.Webworker=2]="Webworker"})(uE||(uE={}));var bl;(function(r){r[r.Other=0]="Other",r[r.Comment=1]="Comment",r[r.String=2]="String",r[r.RegEx=3]="RegEx"})(bl||(bl={}));let vz=class{constructor(e,t){this.ranges=e,this.wordPattern=t}};class ute{constructor(e){this._autoForwardAction=e}get autoForwardAction(){return this._autoForwardAction}}var hA;(function(r){r[r.Queued=1]="Queued",r[r.Running=2]="Running",r[r.Passed=3]="Passed",r[r.Failed=4]="Failed",r[r.Skipped=5]="Skipped",r[r.Errored=6]="Errored"})(hA||(hA={}));var Lh;(function(r){r[r.Run=1]="Run",r[r.Debug=2]="Debug",r[r.Coverage=3]="Coverage"})(Lh||(Lh={}));let Xg=class{constructor(e=void 0,t=void 0,i=void 0,n=!1){this.include=e,this.exclude=t,this.profile=i,this.continuous=n}};Xg=T([Je],Xg);let fA=class extends Xg{};fA=T([Je],fA);let I_=XP=class{static diff(e,t,i){const n=new XP(e);return n.expectedOutput=t,n.actualOutput=i,n}constructor(e){this.message=e}};I_=XP=T([Je],I_);let Jg=class{constructor(e){this.id=e}};Jg=T([Je],Jg);let dg=class{constructor(e,t){this.covered=e,this.total=t}};dg=T([Je],dg);let pA=JP=class{static fromDetails(e,t){const i=new dg(0,0),n=new dg(0,0),s=new dg(0,0);for(const a of t)if("branches"in a){i.total+=1,i.covered+=a.executionCount>0?1:0;for(const c of a.branches)n.total+=1,n.covered+=c.executionCount>0?1:0}else s.total+=1,s.covered+=a.executionCount>0?1:0;const o=new JP(e,i,n.total>0?n:void 0,s.total>0?s:void 0);return o.detailedCoverage=t,o}constructor(e,t,i,n){this.uri=e,this.statementCoverage=t,this.branchCoverage=i,this.functionCoverage=n}};pA=JP=T([Je],pA);let gA=class{constructor(e,t,i=[]){this.executionCount=e,this.location=t,this.branches=i}};gA=T([Je],gA);let mA=class{constructor(e,t){this.executionCount=e,this.location=t}};mA=T([Je],mA);let vA=class{constructor(e,t){this.executionCount=e,this.location=t}};vA=T([Je],vA);var hE;(function(r){r[r.None=0]="None",r[r.Option=1]="Option",r[r.Default=2]="Default",r[r.Preferred=3]="Preferred"})(hE||(hE={}));var yA;(function(r){r[r.Untrusted=0]="Untrusted",r[r.Trusted=1]="Trusted",r[r.Unspecified=2]="Unspecified"})(yA||(yA={}));var _A;(function(r){r[r.Notify=1]="Notify",r[r.OpenBrowser=2]="OpenBrowser",r[r.OpenPreview=3]="OpenPreview",r[r.Silent=4]="Silent",r[r.Ignore=5]="Ignore",r[r.OpenBrowserOnce=6]="OpenBrowserOnce"})(_A||(_A={}));let Fk=class{constructor(e,t,i,n,s,o){this.kind=e,this.name=t,this.detail=i,this.uri=n,this.range=s,this.selectionRange=o}};class Ok{constructor(e){this.uri=e}}class Nk{constructor(e,t){this.original=e,this.modified=t}}class yz{constructor(e,t,i,n){this.base=e,this.input1=t,this.input2=i,this.result=n}}class $k{constructor(e,t){this.uri=e,this.viewType=t}}class P1{constructor(e){this.viewType=e}}class Wk{constructor(e,t){this.uri=e,this.notebookType=t}}class Hk{constructor(e,t,i){this.original=e,this.modified=t,this.notebookType=i}}class A1{constructor(){}}class _z{constructor(e,t){this.uri=e,this.inputBoxUri=t}}var wA;(function(r){r[r.Up=1]="Up",r[r.Down=2]="Down"})(wA||(wA={}));var bA;(function(r){r[r.Action=1]="Action",r[r.Toolbar=2]="Toolbar"})(bA||(bA={}));var lg;(function(r){r[r.Unhelpful=0]="Unhelpful",r[r.Helpful=1]="Helpful",r[r.Undone=2]="Undone"})(lg||(lg={}));const Fke="workbench.view.debug",Oke="workbench.debug.variablesView",Nke="workbench.debug.watchExpressionsView",$ke="workbench.debug.callStackView",Wke="workbench.debug.loadedScriptsView",Hke="workbench.debug.breakPointsView",jke="workbench.debug.disassemblyView",Bke="workbench.panel.repl",Uke="workbench.panel.repl.view",Vke=new G("debugType",void 0,{type:"string",description:p("debugType","Debug type of the active debug session. For example 'python'.")}),qke=new G("debugConfigurationType",void 0,{type:"string",description:p("debugConfigurationType","Debug type of the selected launch configuration. For example 'python'.")}),Gke=new G("debugState","inactive",{type:"string",description:p("debugState","State that the focused debug session is in. One of the following: 'inactive', 'initializing', 'stopped' or 'running'.")}),hte="debugUx",zke=new G(hte,"default",{type:"string",description:p("debugUX","Debug UX state. When there are no debug configurations it is 'simple', otherwise 'default'. Used to decide when to show welcome views in the debug viewlet.")}),Kke=new G("hasDebugged",!1,{type:"boolean",description:p("hasDebugged","True when a debug session has been started at least once, false otherwise.")}),Qke=new G("inDebugMode",!1,{type:"boolean",description:p("inDebugMode","True when debugging, false otherwise.")}),Yke=new G("inDebugRepl",!1,{type:"boolean",description:p("inDebugRepl","True when focus is in the debug console, false otherwise.")}),Xke=new G("breakpointWidgetVisible",!1,{type:"boolean",description:p("breakpointWidgetVisibile","True when breakpoint editor zone widget is visible, false otherwise.")}),Jke=new G("inBreakpointWidget",!1,{type:"boolean",description:p("inBreakpointWidget","True when focus is in the breakpoint editor zone widget, false otherwise.")}),Zke=new G("breakpointsFocused",!0,{type:"boolean",description:p("breakpointsFocused","True when the BREAKPOINTS view is focused, false otherwise.")}),eTe=new G("watchExpressionsFocused",!0,{type:"boolean",description:p("watchExpressionsFocused","True when the WATCH view is focused, false otherwsie.")}),tTe=new G("watchExpressionsExist",!1,{type:"boolean",description:p("watchExpressionsExist","True when at least one watch expression exists, false otherwise.")}),iTe=new G("variablesFocused",!0,{type:"boolean",description:p("variablesFocused","True when the VARIABLES views is focused, false otherwsie")}),nTe=new G("expressionSelected",!1,{type:"boolean",description:p("expressionSelected","True when an expression input box is open in either the WATCH or the VARIABLES view, false otherwise.")}),rTe=new G("breakpointInputFocused",!1,{type:"boolean",description:p("breakpointInputFocused","True when the input box has focus in the BREAKPOINTS view.")}),sTe=new G("callStackItemType",void 0,{type:"string",description:p("callStackItemType","Represents the item type of the focused element in the CALL STACK view. For example: 'session', 'thread', 'stackFrame'")}),oTe=new G("callStackSessionIsAttach",!1,{type:"boolean",description:p("callStackSessionIsAttach","True when the session in the CALL STACK view is attach, false otherwise. Used internally for inline menus in the CALL STACK view.")}),aTe=new G("callStackItemStopped",!1,{type:"boolean",description:p("callStackItemStopped","True when the focused item in the CALL STACK is stopped. Used internaly for inline menus in the CALL STACK view.")}),cTe=new G("callStackSessionHasOneThread",!1,{type:"boolean",description:p("callStackSessionHasOneThread","True when the focused session in the CALL STACK view has exactly one thread. Used internally for inline menus in the CALL STACK view.")}),dTe=new G("watchItemType",void 0,{type:"string",description:p("watchItemType","Represents the item type of the focused element in the WATCH view. For example: 'expression', 'variable'")}),lTe=new G("canViewMemory",void 0,{type:"boolean",description:p("canViewMemory","Indicates whether the item in the view has an associated memory refrence.")}),uTe=new G("breakpointItemType",void 0,{type:"string",description:p("breakpointItemType","Represents the item type of the focused element in the BREAKPOINTS view. For example: 'breakpoint', 'exceptionBreakppint', 'functionBreakpoint', 'dataBreakpoint'")}),hTe=new G("breakpointSupportsCondition",!1,{type:"boolean",description:p("breakpointSupportsCondition","True when the focused breakpoint supports conditions.")}),fTe=new G("loadedScriptsSupported",!1,{type:"boolean",description:p("loadedScriptsSupported","True when the focused sessions supports the LOADED SCRIPTS view")}),pTe=new G("loadedScriptsItemType",void 0,{type:"string",description:p("loadedScriptsItemType","Represents the item type of the focused element in the LOADED SCRIPTS view.")}),gTe=new G("focusedSessionIsAttach",!1,{type:"boolean",description:p("focusedSessionIsAttach","True when the focused session is 'attach'.")}),mTe=new G("stepBackSupported",!1,{type:"boolean",description:p("stepBackSupported","True when the focused session supports 'stepBack' requests.")}),vTe=new G("restartFrameSupported",!1,{type:"boolean",description:p("restartFrameSupported","True when the focused session supports 'restartFrame' requests.")}),yTe=new G("stackFrameSupportsRestart",!1,{type:"boolean",description:p("stackFrameSupportsRestart","True when the focused stack frame suppots 'restartFrame'.")}),_Te=new G("jumpToCursorSupported",!1,{type:"boolean",description:p("jumpToCursorSupported","True when the focused session supports 'jumpToCursor' request.")}),wTe=new G("stepIntoTargetsSupported",!1,{type:"boolean",description:p("stepIntoTargetsSupported","True when the focused session supports 'stepIntoTargets' request.")}),bTe=new G("breakpointsExist",!1,{type:"boolean",description:p("breakpointsExist","True when at least one breakpoint exists.")}),STe=new G("debuggersAvailable",!1,{type:"boolean",description:p("debuggersAvailable","True when there is at least one debug extensions active.")}),CTe=new G("debugExtensionAvailable",!0,{type:"boolean",description:p("debugExtensionsAvailable","True when there is at least one debug extension installed and enabled.")}),ETe=new G("debugProtocolVariableMenuContext",void 0,{type:"string",description:p("debugProtocolVariableMenuContext","Represents the context the debug adapter sets on the focused variable in the VARIABLES view.")}),xTe=new G("debugSetVariableSupported",!1,{type:"boolean",description:p("debugSetVariableSupported","True when the focused session supports 'setVariable' request.")}),DTe=new G("debugSetExpressionSupported",!1,{type:"boolean",description:p("debugSetExpressionSupported","True when the focused session supports 'setExpression' request.")}),kTe=new G("breakWhenValueChangesSupported",!1,{type:"boolean",description:p("breakWhenValueChangesSupported","True when the focused session supports to break when value changes.")}),TTe=new G("breakWhenValueIsAccessedSupported",!1,{type:"boolean",description:p("breakWhenValueIsAccessedSupported","True when the focused breakpoint supports to break when value is accessed.")}),ITe=new G("breakWhenValueIsReadSupported",!1,{type:"boolean",description:p("breakWhenValueIsReadSupported","True when the focused breakpoint supports to break when value is read.")}),RTe=new G("terminateDebuggeeSupported",!1,{type:"boolean",description:p("terminateDebuggeeSupported","True when the focused session supports the terminate debuggee capability.")}),PTe=new G("suspendDebuggeeSupported",!1,{type:"boolean",description:p("suspendDebuggeeSupported","True when the focused session supports the suspend debuggee capability.")}),ATe=new G("variableEvaluateNamePresent",!1,{type:"boolean",description:p("variableEvaluateNamePresent","True when the focused variable has an 'evalauteName' field set.")}),MTe=new G("variableIsReadonly",!1,{type:"boolean",description:p("variableIsReadonly","True when the focused variable is read-only.")}),LTe=new G("exceptionWidgetVisible",!1,{type:"boolean",description:p("exceptionWidgetVisible","True when the exception widget is visible.")}),FTe=new G("multiSessionRepl",!1,{type:"boolean",description:p("multiSessionRepl","True when there is more than 1 debug console.")}),OTe=new G("multiSessionDebug",!1,{type:"boolean",description:p("multiSessionDebug","True when there is more than 1 active debug session.")}),NTe=new G("disassembleRequestSupported",!1,{type:"boolean",description:p("disassembleRequestSupported","True when the focused sessions supports disassemble request.")}),$Te=new G("disassemblyViewFocus",!1,{type:"boolean",description:p("disassemblyViewFocus","True when the Disassembly View is focused.")}),WTe=new G("languageSupportsDisassembleRequest",!1,{type:"boolean",description:p("languageSupportsDisassembleRequest","True when the language in the current editor supports disassemble request.")}),HTe=new G("focusedStackFrameHasInstructionReference",!1,{type:"boolean",description:p("focusedStackFrameHasInstructionReference","True when the focused stack frame has instruction pointer reference.")}),jTe=r=>p("debuggerDisabled","Configured debug type '{0}' is installed but not supported in this environment.",r),BTe="editor.contrib.debug",UTe="editor.contrib.breakpoint",VTe="debug",qTe={enum:["neverOpen","openOnSessionStart","openOnFirstSessionStart"],default:"openOnFirstSessionStart",description:p("internalConsoleOptions","Controls when the internal Debug Console should open.")};function GTe(r){switch(r){case 1:return"initializing";case 2:return"stopped";case 3:return"running";default:return"inactive"}}const zTe="vscode-debug-memory";var R_;(function(r){r[r.Initial=1]="Initial",r[r.Dynamic=2]="Dynamic"})(R_||(R_={}));var ej;(function(r){r.UnverifiedBreakpoints="unverifiedBreakpoints"})(ej||(ej={}));const wz=re("debugService");var Yo;(function(r){r[r.Desktop=1]="Desktop",r[r.Web=2]="Web"})(Yo||(Yo={}));function bz(r){const e=De.alloc(1);switch(r){case 0:e.writeUInt8(1,0);break;case 1:e.writeUInt8(2,0);break;case 2:e.writeUInt8(3,0);break}return e}function fE(r,e){if(r.byteLength!==1)return!1;switch(r.readUInt8(0)){case 1:return e===0;case 2:return e===1;case 3:return e===2;default:return!1}}let jk=class{constructor(e){this.value=e,this.isTrustedTelemetryValue=!0}};class fte{async publicLog(e,t,i){}async publicLogError(e,t,i){}}const pte="extensionTelemetryLog";function bS(r,e){return!e.isBuilt&&!e.disableTelemetry?!0:!(e.disableTelemetry||!r.enableTelemetry||e.extensionTestsLocationURI)}function M1(r,e){var t;return!(e.isBuilt||e.disableTelemetry||r.enableTelemetry&&((t=r.aiConfig)!=null&&t.ariaKey))}function gte(r){const e=r.getValue(cq),t=r.getValue(tQ);if(r.getValue(dq)===!1||t===!1)return 0;switch(e??"all"){case"all":return 3;case"error":return 2;case"crash":return 1;case"off":return 0}}const mte=new Set(["ssh-remote","dev-container","attached-container","wsl","tunnel","codespaces","amlext"]);function vte(r){if(!r)return"none";const e=WN(r);return mte.has(e)?e:"other"}function yte(r,e){if(!r||!r.includes("/")&&!r.includes("\\"))return r;let t=r;const i=[];for(const a of e)for(;;){const c=a.exec(r);if(!c)break;i.push([c.index,a.lastIndex])}const n=/^[\\\/]?(node_modules|node_modules\.asar)[\\\/]/,s=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-\._]+(\\\\|\\|\/))+[\w-\._]*/g;let o=0;for(t="";;){const a=s.exec(r);if(!a)break;const c=i.some(([d,l])=>a.index<l&&d<s.lastIndex);!n.test(a[0])&&!c&&(t+=r.substring(o,a.index)+"<REDACTED: user-file-path>",o=s.lastIndex)}return o<r.length&&(t+=r.substr(o)),t}function _te(r){if(!r)return r;const e=[{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"Generic Secret",regex:/(key|token|sig|secret|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]/i},{label:"Email",regex:/@[a-zA-Z0-9-]+\.[a-zA-Z0-9-]+/}];for(const t of e)if(t.regex.test(r))return`<REDACTED: ${t.label}>`;return r}function wte(r,e){return hC(r,t=>{if(t instanceof jk||Object.hasOwnProperty.call(t,"isTrustedTelemetryValue"))return t.value;if(typeof t=="string"){let i=t.replaceAll("%20"," ");i=yte(i,e);for(const n of e)i=i.replace(n,"");return i=_te(i),i}})}var pE;(function(r){r[r.Information=1]="Information",r[r.Warning=2]="Warning"})(pE||(pE={}));let SA;function Sz(r){SA=r}function Ms(r){return new Proxy({},{get(e,t){if(SA==null)throw new Error("Default api is not ready yet, do not forget to call `initialize` from 'vscode/extensions'");return SA[r][t]}})}const Mr=void 0,bte={version:"1.80.0",tasks:Ms("tasks"),notebooks:Ms("notebooks"),scm:Ms("scm"),comments:Ms("comments"),authentication:Ms("authentication"),tests:Ms("tests"),extensions:Ms("extensions"),debug:Ms("debug"),env:Ms("env"),commands:Ms("commands"),window:Ms("window"),workspace:Ms("workspace"),languages:Ms("languages"),l10n:Ms("l10n"),Breakpoint:vf,CallHierarchyIncomingCall:k1,CallHierarchyItem:Ak,CallHierarchyOutgoingCall:T1,CancellationError:yh,CancellationTokenSource:Xt,CodeAction:d_,CodeActionKind:$i,CodeActionTriggerKind:uf,CodeLens:l_,Color:pf,ColorInformation:m_,ColorPresentation:v_,ColorThemeKind:Kc,CommentMode:nE,CommentThreadCollapsibleState:Kg,CompletionItem:f_,CompletionItemKind:ht,CompletionItemTag:jg,CompletionList:hf,CompletionTriggerKind:kh,ConfigurationTarget:Ih,CustomExecution:Mk,DebugAdapterExecutable:w_,DebugAdapterInlineImplementation:S_,DebugAdapterNamedPipeServer:b_,DebugAdapterServer:Gg,DebugConfigurationProviderTriggerKind:R_,DebugConsoleMode:T_,DecorationRangeBehavior:yl,Diagnostic:o_,DiagnosticRelatedInformation:Fg,DiagnosticSeverity:ur,DiagnosticTag:vl,Disposable:Yt,DocumentHighlight:c_,DocumentHighlightKind:Og,DocumentLink:g_,DocumentSymbol:Wg,EndOfLine:Bo,EnvironmentVariableMutatorType:xh,EvaluatableExpression:C_,InlineValueText:E_,InlineValueVariableLookup:x_,InlineValueEvaluatableExpression:D_,EventEmitter:A,ExtensionKind:jl,ExtensionMode:Mh,FileChangeType:Ph,FileDecoration:sE,FileSystemError:In,FileType:Or,FilePermission:ad,FoldingRange:iE,FoldingRangeKind:nc,FunctionBreakpoint:wl,Hover:a_,IndentAction:Fp,Location:wo,MarkdownString:Ia,OverviewRulerLane:Qw,ParameterInformation:HC,Position:At,ProcessExecution:gf,ProgressLocation:Wl,QuickInputButtons:_f,Range:Tt,RelativePattern:Rh,Selection:wd,SelectionRange:Hg,SemanticTokens:yf,SemanticTokensBuilder:fz,SemanticTokensEdit:I1,SemanticTokensEdits:wy,SemanticTokensLegend:rE,ShellExecution:su,ShellQuoting:QC,SignatureHelp:BC,SignatureHelpTriggerKind:UC,SignatureInformation:jC,SnippetString:ru,SourceBreakpoint:_l,StatusBarAlignment:Jc,SymbolInformation:$g,SymbolKind:Ai,SymbolTag:Ng,Task:Mr,TaskGroup:Mr,TaskPanelKind:Mr,TaskRevealKind:Mr,TaskScope:Mr,TerminalLink:dz,TerminalLocation:KC,TerminalProfile:lz,TextDocumentSaveReason:Th,TextEdit:bd,TextEditorCursorStyle:HN,TextEditorLineNumbersStyle:ic,TextEditorRevealType:p_,TextEditorSelectionChangeKind:ff,TextDocumentChangeReason:Ug,ThemeColor:qg,ThemeIcon:Es,TreeItem:y_,TreeItemCollapsibleState:Hl,TypeHierarchyItem:Fk,UIKind:Yo,Uri:k,ViewColumn:Bg,WorkspaceEdit:Sd,InlayHint:h_,InlayHintLabelPart:u_,InlayHintKind:VC,NotebookRange:Mr,NotebookCellKind:Mr,NotebookCellData:Mr,NotebookData:Mr,NotebookCellStatusBarAlignment:Mr,NotebookCellOutput:Mr,NotebookCellOutputItem:Mr,NotebookCellStatusBarItem:Mr,NotebookControllerAffinity:Mr,LinkedEditingRanges:vz,TestRunRequest:Xg,TestMessage:I_,TestTag:Jg,TestRunProfileKind:Lh,DataTransfer:Vg,DataTransferItem:__,LanguageStatusSeverity:Dh,QuickPickItemKind:Qg,TabInputText:Ok,TabInputTextDiff:Nk,TabInputCustom:$k,TabInputNotebook:Wk,TabInputNotebookDiff:Hk,TabInputWebview:P1,TabInputTerminal:A1,InputBoxValidationSeverity:Ah,InlineCompletionList:GC,InlineCompletionTriggerKind:zg,InlineCompletionItem:qC,DocumentDropEdit:XC,NotebookEditorRevealType:Mr,SnippetTextEdit:Pk,NotebookEdit:Mr,LogLevel:ua,TerminalExitReason:zC,CommentThreadState:Mr,TelemetryTrustedValue:jk,TextSearchCompleteMessageType:pE,DocumentPasteEdit:JC,ExternalUriOpenerPriority:hE,TreeItemCheckboxState:fa},{version:Ste,tasks:Cte,notebooks:Ete,scm:xte,comments:Dte,authentication:kte,tests:Tte,extensions:Ite,debug:Rte,env:Pte,commands:Ate,window:Mte,workspace:Lte,languages:Fte,l10n:Ote,Breakpoint:Nte,CallHierarchyIncomingCall:$te,CallHierarchyItem:Wte,CallHierarchyOutgoingCall:Hte,CancellationError:jte,CancellationTokenSource:Bte,CodeAction:Ute,CodeActionKind:Vte,CodeActionTriggerKind:qte,CodeLens:Gte,Color:zte,ColorInformation:Kte,ColorPresentation:Qte,ColorThemeKind:Yte,CommentMode:Xte,CommentThreadCollapsibleState:Jte,CompletionItem:Zte,CompletionItemKind:eie,CompletionItemTag:tie,CompletionList:iie,CompletionTriggerKind:nie,ConfigurationTarget:rie,CustomExecution:sie,DebugAdapterExecutable:oie,DebugAdapterInlineImplementation:aie,DebugAdapterNamedPipeServer:cie,DebugAdapterServer:die,DebugConfigurationProviderTriggerKind:lie,DebugConsoleMode:uie,DecorationRangeBehavior:hie,Diagnostic:fie,DiagnosticRelatedInformation:pie,DiagnosticSeverity:gie,DiagnosticTag:mie,Disposable:vie,DocumentHighlight:yie,DocumentHighlightKind:_ie,DocumentLink:wie,DocumentSymbol:bie,EndOfLine:Sie,EnvironmentVariableMutatorType:Cie,EvaluatableExpression:Eie,InlineValueText:xie,InlineValueVariableLookup:Die,InlineValueEvaluatableExpression:kie,EventEmitter:Tie,ExtensionKind:Iie,ExtensionMode:Rie,FileChangeType:Pie,FileDecoration:Aie,FileSystemError:Mie,FileType:Lie,FilePermission:Fie,FoldingRange:Oie,FoldingRangeKind:Nie,FunctionBreakpoint:$ie,Hover:Wie,IndentAction:Hie,Location:jie,MarkdownString:Bie,OverviewRulerLane:Uie,ParameterInformation:Vie,Position:qie,ProcessExecution:Gie,ProgressLocation:zie,QuickInputButtons:Kie,Range:Qie,RelativePattern:Yie,Selection:Xie,SelectionRange:Jie,SemanticTokens:Zie,SemanticTokensBuilder:ene,SemanticTokensEdit:tne,SemanticTokensEdits:ine,SemanticTokensLegend:nne,ShellExecution:rne,ShellQuoting:sne,SignatureHelp:one,SignatureHelpTriggerKind:ane,SignatureInformation:cne,SnippetString:dne,SourceBreakpoint:lne,StatusBarAlignment:une,SymbolInformation:hne,SymbolKind:fne,SymbolTag:pne,Task:gne,TaskGroup:mne,TaskPanelKind:vne,TaskRevealKind:yne,TaskScope:_ne,TerminalLink:wne,TerminalLocation:bne,TerminalProfile:Sne,TextDocumentSaveReason:Cne,TextEdit:Ene,TextEditorCursorStyle:xne,TextEditorLineNumbersStyle:Dne,TextEditorRevealType:kne,TextEditorSelectionChangeKind:Tne,TextDocumentChangeReason:Ine,ThemeColor:Rne,ThemeIcon:Pne,TreeItem:Ane,TreeItemCollapsibleState:Mne,TypeHierarchyItem:Lne,UIKind:Fne,Uri:One,ViewColumn:Nne,WorkspaceEdit:$ne,InlayHint:Wne,InlayHintLabelPart:Hne,InlayHintKind:jne,NotebookRange:Bne,NotebookCellKind:Une,NotebookCellData:Vne,NotebookData:qne,NotebookCellStatusBarAlignment:Gne,NotebookCellOutput:zne,NotebookCellOutputItem:Kne,NotebookCellStatusBarItem:Qne,NotebookControllerAffinity:Yne,LinkedEditingRanges:Xne,TestRunRequest:Jne,TestMessage:Zne,TestTag:ere,TestRunProfileKind:tre,DataTransfer:ire,DataTransferItem:nre,LanguageStatusSeverity:rre,QuickPickItemKind:sre,TabInputText:ore,TabInputTextDiff:are,TabInputCustom:cre,TabInputNotebook:dre,TabInputNotebookDiff:lre,TabInputWebview:ure,TabInputTerminal:hre,InputBoxValidationSeverity:fre,InlineCompletionList:pre,InlineCompletionTriggerKind:gre,InlineCompletionItem:mre,DocumentDropEdit:vre,NotebookEditorRevealType:yre,SnippetTextEdit:_re,NotebookEdit:wre,LogLevel:bre,TerminalExitReason:Sre,CommentThreadState:Cre,TelemetryTrustedValue:Ere,TextSearchCompleteMessageType:xre,DocumentPasteEdit:Dre,ExternalUriOpenerPriority:kre,TreeItemCheckboxState:Tre}=bte,Ire=Object.freeze(Object.defineProperty({__proto__:null,Breakpoint:Nte,CallHierarchyIncomingCall:$te,CallHierarchyItem:Wte,CallHierarchyOutgoingCall:Hte,CancellationError:jte,CancellationTokenSource:Bte,CodeAction:Ute,CodeActionKind:Vte,CodeActionTriggerKind:qte,CodeLens:Gte,Color:zte,ColorInformation:Kte,ColorPresentation:Qte,ColorThemeKind:Yte,CommentMode:Xte,CommentThreadCollapsibleState:Jte,CommentThreadState:Cre,CompletionItem:Zte,CompletionItemKind:eie,CompletionItemTag:tie,CompletionList:iie,CompletionTriggerKind:nie,ConfigurationTarget:rie,CustomExecution:sie,DataTransfer:ire,DataTransferItem:nre,DebugAdapterExecutable:oie,DebugAdapterInlineImplementation:aie,DebugAdapterNamedPipeServer:cie,DebugAdapterServer:die,DebugConfigurationProviderTriggerKind:lie,DebugConsoleMode:uie,DecorationRangeBehavior:hie,Diagnostic:fie,DiagnosticRelatedInformation:pie,DiagnosticSeverity:gie,DiagnosticTag:mie,Disposable:vie,DocumentDropEdit:vre,DocumentHighlight:yie,DocumentHighlightKind:_ie,DocumentLink:wie,DocumentPasteEdit:Dre,DocumentSymbol:bie,EndOfLine:Sie,EnvironmentVariableMutatorType:Cie,EvaluatableExpression:Eie,EventEmitter:Tie,ExtensionKind:Iie,ExtensionMode:Rie,ExternalUriOpenerPriority:kre,FileChangeType:Pie,FileDecoration:Aie,FilePermission:Fie,FileSystemError:Mie,FileType:Lie,FoldingRange:Oie,FoldingRangeKind:Nie,FunctionBreakpoint:$ie,Hover:Wie,IndentAction:Hie,InlayHint:Wne,InlayHintKind:jne,InlayHintLabelPart:Hne,InlineCompletionItem:mre,InlineCompletionList:pre,InlineCompletionTriggerKind:gre,InlineValueEvaluatableExpression:kie,InlineValueText:xie,InlineValueVariableLookup:Die,InputBoxValidationSeverity:fre,LanguageStatusSeverity:rre,LinkedEditingRanges:Xne,Location:jie,LogLevel:bre,MarkdownString:Bie,NotebookCellData:Vne,NotebookCellKind:Une,NotebookCellOutput:zne,NotebookCellOutputItem:Kne,NotebookCellStatusBarAlignment:Gne,NotebookCellStatusBarItem:Qne,NotebookControllerAffinity:Yne,NotebookData:qne,NotebookEdit:wre,NotebookEditorRevealType:yre,NotebookRange:Bne,OverviewRulerLane:Uie,ParameterInformation:Vie,Position:qie,ProcessExecution:Gie,ProgressLocation:zie,QuickInputButtons:Kie,QuickPickItemKind:sre,Range:Qie,RelativePattern:Yie,Selection:Xie,SelectionRange:Jie,SemanticTokens:Zie,SemanticTokensBuilder:ene,SemanticTokensEdit:tne,SemanticTokensEdits:ine,SemanticTokensLegend:nne,ShellExecution:rne,ShellQuoting:sne,SignatureHelp:one,SignatureHelpTriggerKind:ane,SignatureInformation:cne,SnippetString:dne,SnippetTextEdit:_re,SourceBreakpoint:lne,StatusBarAlignment:une,SymbolInformation:hne,SymbolKind:fne,SymbolTag:pne,TabInputCustom:cre,TabInputNotebook:dre,TabInputNotebookDiff:lre,TabInputTerminal:hre,TabInputText:ore,TabInputTextDiff:are,TabInputWebview:ure,Task:gne,TaskGroup:mne,TaskPanelKind:vne,TaskRevealKind:yne,TaskScope:_ne,TelemetryTrustedValue:Ere,TerminalExitReason:Sre,TerminalLink:wne,TerminalLocation:bne,TerminalProfile:Sne,TestMessage:Zne,TestRunProfileKind:tre,TestRunRequest:Jne,TestTag:ere,TextDocumentChangeReason:Ine,TextDocumentSaveReason:Cne,TextEdit:Ene,TextEditorCursorStyle:xne,TextEditorLineNumbersStyle:Dne,TextEditorRevealType:kne,TextEditorSelectionChangeKind:Tne,TextSearchCompleteMessageType:xre,ThemeColor:Rne,ThemeIcon:Pne,TreeItem:Ane,TreeItemCheckboxState:Tre,TreeItemCollapsibleState:Mne,TypeHierarchyItem:Lne,UIKind:Fne,Uri:One,ViewColumn:Nne,WorkspaceEdit:$ne,authentication:kte,commands:Ate,comments:Dte,debug:Rte,env:Pte,extensions:Ite,l10n:Ote,languages:Fte,notebooks:Ete,scm:xte,setDefaultApi:Sz,tasks:Cte,tests:Tte,version:Ste,window:Mte,workspace:Lte},Symbol.toStringTag,{value:"Module"})),Dt=lq(Ire);var Lt={},Uf={},L1={},gE={},F1={},Qn={};Object.defineProperty(Qn,"__esModule",{value:!0});Qn.stringArray=Qn.array=Qn.func=Qn.error=Qn.number=Qn.string=Qn.boolean=void 0;function Rre(r){return r===!0||r===!1}Qn.boolean=Rre;function Cz(r){return typeof r=="string"||r instanceof String}Qn.string=Cz;function Pre(r){return typeof r=="number"||r instanceof Number}Qn.number=Pre;function Are(r){return r instanceof Error}Qn.error=Are;function Mre(r){return typeof r=="function"}Qn.func=Mre;function Ez(r){return Array.isArray(r)}Qn.array=Ez;function Lre(r){return Ez(r)&&r.every(e=>Cz(e))}Qn.stringArray=Lre;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Message=r.NotificationType9=r.NotificationType8=r.NotificationType7=r.NotificationType6=r.NotificationType5=r.NotificationType4=r.NotificationType3=r.NotificationType2=r.NotificationType1=r.NotificationType0=r.NotificationType=r.RequestType9=r.RequestType8=r.RequestType7=r.RequestType6=r.RequestType5=r.RequestType4=r.RequestType3=r.RequestType2=r.RequestType1=r.RequestType=r.RequestType0=r.AbstractMessageSignature=r.ParameterStructures=r.ResponseError=r.ErrorCodes=void 0;const e=Qn;var t;(function(C){C.ParseError=-32700,C.InvalidRequest=-32600,C.MethodNotFound=-32601,C.InvalidParams=-32602,C.InternalError=-32603,C.jsonrpcReservedErrorRangeStart=-32099,C.serverErrorStart=-32099,C.MessageWriteError=-32099,C.MessageReadError=-32098,C.PendingResponseRejected=-32097,C.ConnectionInactive=-32096,C.ServerNotInitialized=-32002,C.UnknownErrorCode=-32001,C.jsonrpcReservedErrorRangeEnd=-32e3,C.serverErrorEnd=-32e3})(t=r.ErrorCodes||(r.ErrorCodes={}));class i extends Error{constructor(B,te,ue){super(te),this.code=e.number(B)?B:t.UnknownErrorCode,this.data=ue,Object.setPrototypeOf(this,i.prototype)}toJson(){const B={code:this.code,message:this.message};return this.data!==void 0&&(B.data=this.data),B}}r.ResponseError=i;class n{constructor(B){this.kind=B}static is(B){return B===n.auto||B===n.byName||B===n.byPosition}toString(){return this.kind}}r.ParameterStructures=n,n.auto=new n("auto"),n.byPosition=new n("byPosition"),n.byName=new n("byName");class s{constructor(B,te){this.method=B,this.numberOfParams=te}get parameterStructures(){return n.auto}}r.AbstractMessageSignature=s;class o extends s{constructor(B){super(B,0)}}r.RequestType0=o;class a extends s{constructor(B,te=n.auto){super(B,1),this._parameterStructures=te}get parameterStructures(){return this._parameterStructures}}r.RequestType=a;class c extends s{constructor(B,te=n.auto){super(B,1),this._parameterStructures=te}get parameterStructures(){return this._parameterStructures}}r.RequestType1=c;class d extends s{constructor(B){super(B,2)}}r.RequestType2=d;class l extends s{constructor(B){super(B,3)}}r.RequestType3=l;class u extends s{constructor(B){super(B,4)}}r.RequestType4=u;class h extends s{constructor(B){super(B,5)}}r.RequestType5=h;class g extends s{constructor(B){super(B,6)}}r.RequestType6=g;class m extends s{constructor(B){super(B,7)}}r.RequestType7=m;class y extends s{constructor(B){super(B,8)}}r.RequestType8=y;class _ extends s{constructor(B){super(B,9)}}r.RequestType9=_;class b extends s{constructor(B,te=n.auto){super(B,1),this._parameterStructures=te}get parameterStructures(){return this._parameterStructures}}r.NotificationType=b;class E extends s{constructor(B){super(B,0)}}r.NotificationType0=E;class D extends s{constructor(B,te=n.auto){super(B,1),this._parameterStructures=te}get parameterStructures(){return this._parameterStructures}}r.NotificationType1=D;class R extends s{constructor(B){super(B,2)}}r.NotificationType2=R;class M extends s{constructor(B){super(B,3)}}r.NotificationType3=M;class O extends s{constructor(B){super(B,4)}}r.NotificationType4=O;class L extends s{constructor(B){super(B,5)}}r.NotificationType5=L;class W extends s{constructor(B){super(B,6)}}r.NotificationType6=W;class Z extends s{constructor(B){super(B,7)}}r.NotificationType7=Z;class K extends s{constructor(B){super(B,8)}}r.NotificationType8=K;class H extends s{constructor(B){super(B,9)}}r.NotificationType9=H,function(C){function B(be){const de=be;return de&&e.string(de.method)&&(e.string(de.id)||e.number(de.id))}C.isRequest=B;function te(be){const de=be;return de&&e.string(de.method)&&be.id===void 0}C.isNotification=te;function ue(be){const de=be;return de&&(de.result!==void 0||!!de.error)&&(e.string(de.id)||e.number(de.id)||de.id===null)}C.isResponse=ue}(r.Message||(r.Message={}))})(F1);var O1={};(function(r){var e;Object.defineProperty(r,"__esModule",{value:!0}),r.LRUCache=r.LinkedMap=r.Touch=void 0;var t;(function(s){s.None=0,s.First=1,s.AsOld=s.First,s.Last=2,s.AsNew=s.Last})(t=r.Touch||(r.Touch={}));class i{constructor(){this[e]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var o;return(o=this._head)==null?void 0:o.value}get last(){var o;return(o=this._tail)==null?void 0:o.value}has(o){return this._map.has(o)}get(o,a=t.None){const c=this._map.get(o);if(c)return a!==t.None&&this.touch(c,a),c.value}set(o,a,c=t.None){let d=this._map.get(o);if(d)d.value=a,c!==t.None&&this.touch(d,c);else{switch(d={key:o,value:a,next:void 0,previous:void 0},c){case t.None:this.addItemLast(d);break;case t.First:this.addItemFirst(d);break;case t.Last:this.addItemLast(d);break;default:this.addItemLast(d);break}this._map.set(o,d),this._size++}return this}delete(o){return!!this.remove(o)}remove(o){const a=this._map.get(o);if(a)return this._map.delete(o),this.removeItem(a),this._size--,a.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const o=this._head;return this._map.delete(o.key),this.removeItem(o),this._size--,o.value}forEach(o,a){const c=this._state;let d=this._head;for(;d;){if(a?o.bind(a)(d.value,d.key,this):o(d.value,d.key,this),this._state!==c)throw new Error("LinkedMap got modified during iteration.");d=d.next}}keys(){const o=this._state;let a=this._head;const c={[Symbol.iterator]:()=>c,next:()=>{if(this._state!==o)throw new Error("LinkedMap got modified during iteration.");if(a){const d={value:a.key,done:!1};return a=a.next,d}else return{value:void 0,done:!0}}};return c}values(){const o=this._state;let a=this._head;const c={[Symbol.iterator]:()=>c,next:()=>{if(this._state!==o)throw new Error("LinkedMap got modified during iteration.");if(a){const d={value:a.value,done:!1};return a=a.next,d}else return{value:void 0,done:!0}}};return c}entries(){const o=this._state;let a=this._head;const c={[Symbol.iterator]:()=>c,next:()=>{if(this._state!==o)throw new Error("LinkedMap got modified during iteration.");if(a){const d={value:[a.key,a.value],done:!1};return a=a.next,d}else return{value:void 0,done:!0}}};return c}[(e=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(o){if(o>=this.size)return;if(o===0){this.clear();return}let a=this._head,c=this.size;for(;a&&c>o;)this._map.delete(a.key),a=a.next,c--;this._head=a,this._size=c,a&&(a.previous=void 0),this._state++}addItemFirst(o){if(!this._head&&!this._tail)this._tail=o;else if(this._head)o.next=this._head,this._head.previous=o;else throw new Error("Invalid list");this._head=o,this._state++}addItemLast(o){if(!this._head&&!this._tail)this._head=o;else if(this._tail)o.previous=this._tail,this._tail.next=o;else throw new Error("Invalid list");this._tail=o,this._state++}removeItem(o){if(o===this._head&&o===this._tail)this._head=void 0,this._tail=void 0;else if(o===this._head){if(!o.next)throw new Error("Invalid list");o.next.previous=void 0,this._head=o.next}else if(o===this._tail){if(!o.previous)throw new Error("Invalid list");o.previous.next=void 0,this._tail=o.previous}else{const a=o.next,c=o.previous;if(!a||!c)throw new Error("Invalid list");a.previous=c,c.next=a}o.next=void 0,o.previous=void 0,this._state++}touch(o,a){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(a!==t.First&&a!==t.Last)){if(a===t.First){if(o===this._head)return;const c=o.next,d=o.previous;o===this._tail?(d.next=void 0,this._tail=d):(c.previous=d,d.next=c),o.previous=void 0,o.next=this._head,this._head.previous=o,this._head=o,this._state++}else if(a===t.Last){if(o===this._tail)return;const c=o.next,d=o.previous;o===this._head?(c.previous=void 0,this._head=c):(c.previous=d,d.next=c),o.next=void 0,o.previous=this._tail,this._tail.next=o,this._tail=o,this._state++}}}toJSON(){const o=[];return this.forEach((a,c)=>{o.push([c,a])}),o}fromJSON(o){this.clear();for(const[a,c]of o)this.set(a,c)}}r.LinkedMap=i;class n extends i{constructor(o,a=1){super(),this._limit=o,this._ratio=Math.min(Math.max(0,a),1)}get limit(){return this._limit}set limit(o){this._limit=o,this.checkTrim()}get ratio(){return this._ratio}set ratio(o){this._ratio=Math.min(Math.max(0,o),1),this.checkTrim()}get(o,a=t.AsNew){return super.get(o,a)}peek(o){return super.get(o,t.None)}set(o,a){return super.set(o,a,t.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}r.LRUCache=n})(O1);var xz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Disposable=void 0,function(e){function t(i){return{dispose:i}}e.create=t}(r.Disposable||(r.Disposable={}))})(xz);var Ym={},Fd={};Object.defineProperty(Fd,"__esModule",{value:!0});let CA;function EA(){if(CA===void 0)throw new Error("No runtime abstraction layer installed");return CA}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");CA=t}r.install=e})(EA||(EA={}));Fd.default=EA;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Emitter=r.Event=void 0;const e=Fd;(function(n){const s={dispose(){}};n.None=function(){return s}})(r.Event||(r.Event={}));class t{add(s,o=null,a){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(s),this._contexts.push(o),Array.isArray(a)&&a.push({dispose:()=>this.remove(s,o)})}remove(s,o=null){if(!this._callbacks)return;let a=!1;for(let c=0,d=this._callbacks.length;c<d;c++)if(this._callbacks[c]===s)if(this._contexts[c]===o){this._callbacks.splice(c,1),this._contexts.splice(c,1);return}else a=!0;if(a)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...s){if(!this._callbacks)return[];const o=[],a=this._callbacks.slice(0),c=this._contexts.slice(0);for(let d=0,l=a.length;d<l;d++)try{o.push(a[d].apply(c[d],s))}catch(u){(0,e.default)().console.error(u)}return o}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}}class i{constructor(s){this._options=s}get event(){return this._event||(this._event=(s,o,a)=>{this._callbacks||(this._callbacks=new t),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(s,o);const c={dispose:()=>{this._callbacks&&(this._callbacks.remove(s,o),c.dispose=i._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(a)&&a.push(c),c}),this._event}fire(s){this._callbacks&&this._callbacks.invoke.call(this._callbacks,s)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}r.Emitter=i,i._noop=function(){}})(Ym);var Bk={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CancellationTokenSource=r.CancellationToken=void 0;const e=Fd,t=Qn,i=Ym;var n;(function(c){c.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:i.Event.None}),c.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:i.Event.None});function d(l){const u=l;return u&&(u===c.None||u===c.Cancelled||t.boolean(u.isCancellationRequested)&&!!u.onCancellationRequested)}c.is=d})(n=r.CancellationToken||(r.CancellationToken={}));const s=Object.freeze(function(c,d){const l=(0,e.default)().timer.setTimeout(c.bind(d),0);return{dispose(){l.dispose()}}});class o{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?s:(this._emitter||(this._emitter=new i.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}class a{get token(){return this._token||(this._token=new o),this._token}cancel(){this._token?this._token.cancel():this._token=n.Cancelled}dispose(){this._token?this._token instanceof o&&this._token.dispose():this._token=n.None}}r.CancellationTokenSource=a})(Bk);var Zg={};Object.defineProperty(Zg,"__esModule",{value:!0});Zg.SharedArrayReceiverStrategy=Zg.SharedArraySenderStrategy=void 0;const Fre=Bk;var P_;(function(r){r.Continue=0,r.Cancelled=1})(P_||(P_={}));class Ore{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;const t=new SharedArrayBuffer(4),i=new Int32Array(t,0,1);i[0]=P_.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){const i=this.buffers.get(t);if(i===void 0)return;const n=new Int32Array(i,0,1);Atomics.store(n,0,P_.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}}Zg.SharedArraySenderStrategy=Ore;class Nre{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===P_.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}}class $re{constructor(e){this.token=new Nre(e)}cancel(){}dispose(){}}class Wre{constructor(){this.kind="request"}createCancellationTokenSource(e){const t=e.$cancellationData;return t===void 0?new Fre.CancellationTokenSource:new $re(t)}}Zg.SharedArrayReceiverStrategy=Wre;var N1={},rb={};Object.defineProperty(rb,"__esModule",{value:!0});rb.Semaphore=void 0;const Hre=Fd;let jre=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,i)=>{this._waiting.push({thunk:e,resolve:t,reject:i}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Hre.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;const e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{const t=e.thunk();t instanceof Promise?t.then(i=>{this._active--,e.resolve(i),this.runNext()},i=>{this._active--,e.reject(i),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};rb.Semaphore=jre;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ReadableStreamMessageReader=r.AbstractMessageReader=r.MessageReader=void 0;const e=Fd,t=Qn,i=Ym,n=rb;(function(c){function d(l){let u=l;return u&&t.func(u.listen)&&t.func(u.dispose)&&t.func(u.onError)&&t.func(u.onClose)&&t.func(u.onPartialMessage)}c.is=d})(r.MessageReader||(r.MessageReader={}));class s{constructor(){this.errorEmitter=new i.Emitter,this.closeEmitter=new i.Emitter,this.partialMessageEmitter=new i.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(d){this.errorEmitter.fire(this.asError(d))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(d){this.partialMessageEmitter.fire(d)}asError(d){return d instanceof Error?d:new Error(`Reader received error. Reason: ${t.string(d.message)?d.message:"unknown"}`)}}r.AbstractMessageReader=s;var o;(function(c){function d(l){let u,h;const g=new Map;let m;const y=new Map;if(l===void 0||typeof l=="string")u=l??"utf-8";else{if(u=l.charset??"utf-8",l.contentDecoder!==void 0&&(h=l.contentDecoder,g.set(h.name,h)),l.contentDecoders!==void 0)for(const _ of l.contentDecoders)g.set(_.name,_);if(l.contentTypeDecoder!==void 0&&(m=l.contentTypeDecoder,y.set(m.name,m)),l.contentTypeDecoders!==void 0)for(const _ of l.contentTypeDecoders)y.set(_.name,_)}return m===void 0&&(m=(0,e.default)().applicationJson.decoder,y.set(m.name,m)),{charset:u,contentDecoder:h,contentDecoders:g,contentTypeDecoder:m,contentTypeDecoders:y}}c.fromOptions=d})(o||(o={}));class a extends s{constructor(d,l){super(),this.readable=d,this.options=o.fromOptions(l),this.buffer=(0,e.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new n.Semaphore(1)}set partialMessageTimeout(d){this._partialMessageTimeout=d}get partialMessageTimeout(){return this._partialMessageTimeout}listen(d){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=d;const l=this.readable.onData(u=>{this.onData(u)});return this.readable.onError(u=>this.fireError(u)),this.readable.onClose(()=>this.fireClose()),l}onData(d){for(this.buffer.append(d);;){if(this.nextMessageLength===-1){const u=this.buffer.tryReadHeaders(!0);if(!u)return;const h=u.get("content-length");if(!h){this.fireError(new Error("Header must provide a Content-Length property."));return}const g=parseInt(h);if(isNaN(g)){this.fireError(new Error("Content-Length value must be a number."));return}this.nextMessageLength=g}const l=this.buffer.tryReadBody(this.nextMessageLength);if(l===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{const u=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(l):l,h=await this.options.contentTypeDecoder.decode(u,this.options);this.callback(h)}).catch(u=>{this.fireError(u)})}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,e.default)().timer.setTimeout((d,l)=>{this.partialMessageTimer=void 0,d===this.messageToken&&(this.firePartialMessage({messageToken:d,waitingTime:l}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}r.ReadableStreamMessageReader=a})(N1);var $1={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WriteableStreamMessageWriter=r.AbstractMessageWriter=r.MessageWriter=void 0;const e=Fd,t=Qn,i=rb,n=Ym,s="Content-Length: ",o=`\r
`;(function(l){function u(h){let g=h;return g&&t.func(g.dispose)&&t.func(g.onClose)&&t.func(g.onError)&&t.func(g.write)}l.is=u})(r.MessageWriter||(r.MessageWriter={}));class a{constructor(){this.errorEmitter=new n.Emitter,this.closeEmitter=new n.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(u,h,g){this.errorEmitter.fire([this.asError(u),h,g])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(u){return u instanceof Error?u:new Error(`Writer received error. Reason: ${t.string(u.message)?u.message:"unknown"}`)}}r.AbstractMessageWriter=a;var c;(function(l){function u(h){return h===void 0||typeof h=="string"?{charset:h??"utf-8",contentTypeEncoder:(0,e.default)().applicationJson.encoder}:{charset:h.charset??"utf-8",contentEncoder:h.contentEncoder,contentTypeEncoder:h.contentTypeEncoder??(0,e.default)().applicationJson.encoder}}l.fromOptions=u})(c||(c={}));class d extends a{constructor(u,h){super(),this.writable=u,this.options=c.fromOptions(h),this.errorCount=0,this.writeSemaphore=new i.Semaphore(1),this.writable.onError(g=>this.fireError(g)),this.writable.onClose(()=>this.fireClose())}async write(u){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(u,this.options).then(g=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(g):g).then(g=>{const m=[];return m.push(s,g.byteLength.toString(),o),m.push(o),this.doWrite(u,m,g)},g=>{throw this.fireError(g),g}))}async doWrite(u,h,g){try{return await this.writable.write(h.join(""),"ascii"),this.writable.write(g)}catch(m){return this.handleError(m,u),Promise.reject(m)}}handleError(u,h){this.errorCount++,this.fireError(u,h,this.errorCount)}end(){this.writable.end()}}r.WriteableStreamMessageWriter=d})($1);var Uk={};Object.defineProperty(Uk,"__esModule",{value:!0});Uk.AbstractMessageBuffer=void 0;const Bre=13,Ure=10,Vre=`\r
`;class qre{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){const t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,i=0,n=0,s=0;e:for(;i<this._chunks.length;){const d=this._chunks[i];for(n=0;n<d.length;){switch(d[n]){case Bre:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case Ure:switch(t){case 1:t=2;break;case 3:t=4,n++;break e;default:t=0}break;default:t=0}n++}s+=d.byteLength,i++}if(t!==4)return;const o=this._read(s+n),a=new Map,c=this.toString(o,"ascii").split(Vre);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){const l=c[d],u=l.indexOf(":");if(u===-1)throw new Error("Message header must separate key and value using :");const h=l.substr(0,u),g=l.substr(u+1).trim();a.set(e?h.toLowerCase():h,g)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){const s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}const t=this.allocNative(e);let i=0,n=0;for(;e>0;){const s=this._chunks[n];if(s.byteLength>e){const o=s.slice(0,e);t.set(o,i),i+=e,this._chunks[n]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,i),i+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}}Uk.AbstractMessageBuffer=qre;var Dz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.createMessageConnection=r.ConnectionOptions=r.MessageStrategy=r.CancellationStrategy=r.CancellationSenderStrategy=r.CancellationReceiverStrategy=r.RequestCancellationReceiverStrategy=r.IdCancellationReceiverStrategy=r.ConnectionStrategy=r.ConnectionError=r.ConnectionErrors=r.LogTraceNotification=r.SetTraceNotification=r.TraceFormat=r.TraceValues=r.Trace=r.NullLogger=r.ProgressType=r.ProgressToken=void 0;const e=Fd,t=Qn,i=F1,n=O1,s=Ym,o=Bk;var a;(function(H){H.type=new i.NotificationType("$/cancelRequest")})(a||(a={}));var c;(function(H){function C(B){return typeof B=="string"||typeof B=="number"}H.is=C})(c=r.ProgressToken||(r.ProgressToken={}));var d;(function(H){H.type=new i.NotificationType("$/progress")})(d||(d={}));class l{constructor(){}}r.ProgressType=l;var u;(function(H){function C(B){return t.func(B)}H.is=C})(u||(u={})),r.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var h;(function(H){H[H.Off=0]="Off",H[H.Messages=1]="Messages",H[H.Compact=2]="Compact",H[H.Verbose=3]="Verbose"})(h=r.Trace||(r.Trace={})),function(H){H.Off="off",H.Messages="messages",H.Compact="compact",H.Verbose="verbose"}(r.TraceValues||(r.TraceValues={})),function(H){function C(te){if(!t.string(te))return H.Off;switch(te=te.toLowerCase(),te){case"off":return H.Off;case"messages":return H.Messages;case"compact":return H.Compact;case"verbose":return H.Verbose;default:return H.Off}}H.fromString=C;function B(te){switch(te){case H.Off:return"off";case H.Messages:return"messages";case H.Compact:return"compact";case H.Verbose:return"verbose";default:return"off"}}H.toString=B}(h=r.Trace||(r.Trace={}));var g;(function(H){H.Text="text",H.JSON="json"})(g=r.TraceFormat||(r.TraceFormat={})),function(H){function C(B){return t.string(B)?(B=B.toLowerCase(),B==="json"?H.JSON:H.Text):H.Text}H.fromString=C}(g=r.TraceFormat||(r.TraceFormat={}));var m;(function(H){H.type=new i.NotificationType("$/setTrace")})(m=r.SetTraceNotification||(r.SetTraceNotification={}));var y;(function(H){H.type=new i.NotificationType("$/logTrace")})(y=r.LogTraceNotification||(r.LogTraceNotification={}));var _;(function(H){H[H.Closed=1]="Closed",H[H.Disposed=2]="Disposed",H[H.AlreadyListening=3]="AlreadyListening"})(_=r.ConnectionErrors||(r.ConnectionErrors={}));class b extends Error{constructor(C,B){super(B),this.code=C,Object.setPrototypeOf(this,b.prototype)}}r.ConnectionError=b;var E;(function(H){function C(B){const te=B;return te&&t.func(te.cancelUndispatched)}H.is=C})(E=r.ConnectionStrategy||(r.ConnectionStrategy={}));var D;(function(H){function C(B){const te=B;return te&&(te.kind===void 0||te.kind==="id")&&t.func(te.createCancellationTokenSource)&&(te.dispose===void 0||t.func(te.dispose))}H.is=C})(D=r.IdCancellationReceiverStrategy||(r.IdCancellationReceiverStrategy={}));var R;(function(H){function C(B){const te=B;return te&&te.kind==="request"&&t.func(te.createCancellationTokenSource)&&(te.dispose===void 0||t.func(te.dispose))}H.is=C})(R=r.RequestCancellationReceiverStrategy||(r.RequestCancellationReceiverStrategy={}));var M;(function(H){H.Message=Object.freeze({createCancellationTokenSource(B){return new o.CancellationTokenSource}});function C(B){return D.is(B)||R.is(B)}H.is=C})(M=r.CancellationReceiverStrategy||(r.CancellationReceiverStrategy={}));var O;(function(H){H.Message=Object.freeze({sendCancellation(B,te){return B.sendNotification(a.type,{id:te})},cleanup(B){}});function C(B){const te=B;return te&&t.func(te.sendCancellation)&&t.func(te.cleanup)}H.is=C})(O=r.CancellationSenderStrategy||(r.CancellationSenderStrategy={}));var L;(function(H){H.Message=Object.freeze({receiver:M.Message,sender:O.Message});function C(B){const te=B;return te&&M.is(te.receiver)&&O.is(te.sender)}H.is=C})(L=r.CancellationStrategy||(r.CancellationStrategy={}));var W;(function(H){function C(B){const te=B;return te&&t.func(te.handleMessage)}H.is=C})(W=r.MessageStrategy||(r.MessageStrategy={})),function(H){function C(B){const te=B;return te&&(L.is(te.cancellationStrategy)||E.is(te.connectionStrategy)||W.is(te.messageStrategy))}H.is=C}(r.ConnectionOptions||(r.ConnectionOptions={}));var Z;(function(H){H[H.New=1]="New",H[H.Listening=2]="Listening",H[H.Closed=3]="Closed",H[H.Disposed=4]="Disposed"})(Z||(Z={}));function K(H,C,B,te){const ue=B!==void 0?B:r.NullLogger;let be=0,de=0,le=0;const Me="2.0";let Re;const Oe=new Map;let Ge;const xe=new Map,Kt=new Map;let je,et=new n.LinkedMap,Qt=new Map,ct=new Set,ai=new Map,dt=h.Off,xi=g.Text,ci,mt=Z.New;const vn=new s.Emitter,zr=new s.Emitter,Kr=new s.Emitter,qn=new s.Emitter,ut=new s.Emitter,U=te&&te.cancellationStrategy?te.cancellationStrategy:L.Message;function J(N){if(N===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+N.toString()}function Y(N){return N===null?"res-unknown-"+(++le).toString():"res-"+N.toString()}function _e(){return"not-"+(++de).toString()}function Se(N,Q){i.Message.isRequest(Q)?N.set(J(Q.id),Q):i.Message.isResponse(Q)?N.set(Y(Q.id),Q):N.set(_e(),Q)}function Ce(N){}function Vt(){return mt===Z.Listening}function Pt(){return mt===Z.Closed}function Zt(){return mt===Z.Disposed}function cr(){(mt===Z.New||mt===Z.Listening)&&(mt=Z.Closed,zr.fire(void 0))}function yn(N){vn.fire([N,void 0,void 0])}function Ro(N){vn.fire(N)}H.onClose(cr),H.onError(yn),C.onClose(cr),C.onError(Ro);function Ua(){je||et.size===0||(je=(0,e.default)().timer.setImmediate(()=>{je=void 0,Va()}))}function hs(N){i.Message.isRequest(N)?Po(N):i.Message.isNotification(N)?X(N):i.Message.isResponse(N)?na(N):wr(N)}function Va(){if(et.size===0)return;const N=et.shift();try{const Q=te==null?void 0:te.messageStrategy;W.is(Q)?Q.handleMessage(N,hs):hs(N)}finally{Ua()}}const Rc=N=>{try{if(i.Message.isNotification(N)&&N.method===a.type.method){const Q=N.params.id,ve=J(Q),x=et.get(ve);if(i.Message.isRequest(x)){const j=te==null?void 0:te.connectionStrategy,$e=j&&j.cancelUndispatched?j.cancelUndispatched(x,Ce):void 0;if($e&&($e.error!==void 0||$e.result!==void 0)){et.delete(ve),ai.delete(Q),$e.id=x.id,ei($e,N.method,Date.now()),C.write($e).catch(()=>ue.error("Sending response for canceled message failed."));return}}const I=ai.get(Q);if(I!==void 0){I.cancel(),nn(N);return}else ct.add(Q)}Se(et,N)}finally{Ua()}};function Po(N){if(Zt())return;function Q($,ae,Ae){const Ft={jsonrpc:Me,id:N.id};$ instanceof i.ResponseError?Ft.error=$.toJson():Ft.result=$===void 0?null:$,ei(Ft,ae,Ae),C.write(Ft).catch(()=>ue.error("Sending response failed."))}function ve($,ae,Ae){const Ft={jsonrpc:Me,id:N.id,error:$.toJson()};ei(Ft,ae,Ae),C.write(Ft).catch(()=>ue.error("Sending response failed."))}function x($,ae,Ae){$===void 0&&($=null);const Ft={jsonrpc:Me,id:N.id,result:$};ei(Ft,ae,Ae),C.write(Ft).catch(()=>ue.error("Sending response failed."))}wi(N);const I=Oe.get(N.method);let j,$e;I&&(j=I.type,$e=I.handler);const S=Date.now();if($e||Re){const $=N.id??String(Date.now()),ae=D.is(U.receiver)?U.receiver.createCancellationTokenSource($):U.receiver.createCancellationTokenSource(N);N.id!==null&&ct.has(N.id)&&ae.cancel(),N.id!==null&&ai.set($,ae);try{let Ae;if($e)if(N.params===void 0){if(j!==void 0&&j.numberOfParams!==0){ve(new i.ResponseError(i.ErrorCodes.InvalidParams,`Request ${N.method} defines ${j.numberOfParams} params but received none.`),N.method,S);return}Ae=$e(ae.token)}else if(Array.isArray(N.params)){if(j!==void 0&&j.parameterStructures===i.ParameterStructures.byName){ve(new i.ResponseError(i.ErrorCodes.InvalidParams,`Request ${N.method} defines parameters by name but received parameters by position`),N.method,S);return}Ae=$e(...N.params,ae.token)}else{if(j!==void 0&&j.parameterStructures===i.ParameterStructures.byPosition){ve(new i.ResponseError(i.ErrorCodes.InvalidParams,`Request ${N.method} defines parameters by position but received parameters by name`),N.method,S);return}Ae=$e(N.params,ae.token)}else Re&&(Ae=Re(N.method,N.params,ae.token));const Ft=Ae;Ae?Ft.then?Ft.then(Wt=>{ai.delete($),Q(Wt,N.method,S)},Wt=>{ai.delete($),Wt instanceof i.ResponseError?ve(Wt,N.method,S):Wt&&t.string(Wt.message)?ve(new i.ResponseError(i.ErrorCodes.InternalError,`Request ${N.method} failed with message: ${Wt.message}`),N.method,S):ve(new i.ResponseError(i.ErrorCodes.InternalError,`Request ${N.method} failed unexpectedly without providing any details.`),N.method,S)}):(ai.delete($),Q(Ae,N.method,S)):(ai.delete($),x(Ae,N.method,S))}catch(Ae){ai.delete($),Ae instanceof i.ResponseError?Q(Ae,N.method,S):Ae&&t.string(Ae.message)?ve(new i.ResponseError(i.ErrorCodes.InternalError,`Request ${N.method} failed with message: ${Ae.message}`),N.method,S):ve(new i.ResponseError(i.ErrorCodes.InternalError,`Request ${N.method} failed unexpectedly without providing any details.`),N.method,S)}}else ve(new i.ResponseError(i.ErrorCodes.MethodNotFound,`Unhandled method ${N.method}`),N.method,S)}function na(N){if(!Zt())if(N.id===null)N.error?ue.error(`Received response message without id: Error is: 
${JSON.stringify(N.error,void 0,4)}`):ue.error("Received response message without id. No further error information provided.");else{const Q=N.id,ve=Qt.get(Q);if(kn(N,ve),ve!==void 0){Qt.delete(Q);try{if(N.error){const x=N.error;ve.reject(new i.ResponseError(x.code,x.message,x.data))}else if(N.result!==void 0)ve.resolve(N.result);else throw new Error("Should never happen.")}catch(x){x.message?ue.error(`Response handler '${ve.method}' failed with message: ${x.message}`):ue.error(`Response handler '${ve.method}' failed unexpectedly.`)}}}}function X(N){if(Zt())return;let Q,ve;if(N.method===a.type.method){const x=N.params.id;ct.delete(x),nn(N);return}else{const x=xe.get(N.method);x&&(ve=x.handler,Q=x.type)}if(ve||Ge)try{if(nn(N),ve)if(N.params===void 0)Q!==void 0&&Q.numberOfParams!==0&&Q.parameterStructures!==i.ParameterStructures.byName&&ue.error(`Notification ${N.method} defines ${Q.numberOfParams} params but received none.`),ve();else if(Array.isArray(N.params)){const x=N.params;N.method===d.type.method&&x.length===2&&c.is(x[0])?ve({token:x[0],value:x[1]}):(Q!==void 0&&(Q.parameterStructures===i.ParameterStructures.byName&&ue.error(`Notification ${N.method} defines parameters by name but received parameters by position`),Q.numberOfParams!==N.params.length&&ue.error(`Notification ${N.method} defines ${Q.numberOfParams} params but received ${x.length} arguments`)),ve(...x))}else Q!==void 0&&Q.parameterStructures===i.ParameterStructures.byPosition&&ue.error(`Notification ${N.method} defines parameters by position but received parameters by name`),ve(N.params);else Ge&&Ge(N.method,N.params)}catch(x){x.message?ue.error(`Notification handler '${N.method}' failed with message: ${x.message}`):ue.error(`Notification handler '${N.method}' failed unexpectedly.`)}else Kr.fire(N)}function wr(N){if(!N){ue.error("Received empty message.");return}ue.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(N,null,4)}`);const Q=N;if(t.string(Q.id)||t.number(Q.id)){const ve=Q.id,x=Qt.get(ve);x&&x.reject(new Error("The received response has neither a result nor an error property."))}}function P(N){if(N!=null)switch(dt){case h.Verbose:return JSON.stringify(N,null,4);case h.Compact:return JSON.stringify(N);default:return}}function oe(N){if(!(dt===h.Off||!ci))if(xi===g.Text){let Q;(dt===h.Verbose||dt===h.Compact)&&N.params&&(Q=`Params: ${P(N.params)}

`),ci.log(`Sending request '${N.method} - (${N.id})'.`,Q)}else Tn("send-request",N)}function tt(N){if(!(dt===h.Off||!ci))if(xi===g.Text){let Q;(dt===h.Verbose||dt===h.Compact)&&(N.params?Q=`Params: ${P(N.params)}

`:Q=`No parameters provided.

`),ci.log(`Sending notification '${N.method}'.`,Q)}else Tn("send-notification",N)}function ei(N,Q,ve){if(!(dt===h.Off||!ci))if(xi===g.Text){let x;(dt===h.Verbose||dt===h.Compact)&&(N.error&&N.error.data?x=`Error data: ${P(N.error.data)}

`:N.result?x=`Result: ${P(N.result)}

`:N.error===void 0&&(x=`No result returned.

`)),ci.log(`Sending response '${Q} - (${N.id})'. Processing request took ${Date.now()-ve}ms`,x)}else Tn("send-response",N)}function wi(N){if(!(dt===h.Off||!ci))if(xi===g.Text){let Q;(dt===h.Verbose||dt===h.Compact)&&N.params&&(Q=`Params: ${P(N.params)}

`),ci.log(`Received request '${N.method} - (${N.id})'.`,Q)}else Tn("receive-request",N)}function nn(N){if(!(dt===h.Off||!ci||N.method===y.type.method))if(xi===g.Text){let Q;(dt===h.Verbose||dt===h.Compact)&&(N.params?Q=`Params: ${P(N.params)}

`:Q=`No parameters provided.

`),ci.log(`Received notification '${N.method}'.`,Q)}else Tn("receive-notification",N)}function kn(N,Q){if(!(dt===h.Off||!ci))if(xi===g.Text){let ve;if((dt===h.Verbose||dt===h.Compact)&&(N.error&&N.error.data?ve=`Error data: ${P(N.error.data)}

`:N.result?ve=`Result: ${P(N.result)}

`:N.error===void 0&&(ve=`No result returned.

`)),Q){const x=N.error?` Request failed: ${N.error.message} (${N.error.code}).`:"";ci.log(`Received response '${Q.method} - (${N.id})' in ${Date.now()-Q.timerStart}ms.${x}`,ve)}else ci.log(`Received response ${N.id} without active response promise.`,ve)}else Tn("receive-response",N)}function Tn(N,Q){if(!ci||dt===h.Off)return;const ve={isLSPMessage:!0,type:N,message:Q,timestamp:Date.now()};ci.log(ve)}function Ao(){if(Pt())throw new b(_.Closed,"Connection is closed.");if(Zt())throw new b(_.Disposed,"Connection is disposed.")}function ra(){if(Vt())throw new b(_.AlreadyListening,"Connection is already listening")}function Pc(){if(!Vt())throw new Error("Call listen() first.")}function no(N){return N===void 0?null:N}function Ac(N){if(N!==null)return N}function qa(N){return N!=null&&!Array.isArray(N)&&typeof N=="object"}function Ga(N,Q){switch(N){case i.ParameterStructures.auto:return qa(Q)?Ac(Q):[no(Q)];case i.ParameterStructures.byName:if(!qa(Q))throw new Error("Received parameters by name but param is not an object literal.");return Ac(Q);case i.ParameterStructures.byPosition:return[no(Q)];default:throw new Error(`Unknown parameter structure ${N.toString()}`)}}function Pe(N,Q){let ve;const x=N.numberOfParams;switch(x){case 0:ve=void 0;break;case 1:ve=Ga(N.parameterStructures,Q[0]);break;default:ve=[];for(let I=0;I<Q.length&&I<x;I++)ve.push(no(Q[I]));if(Q.length<x)for(let I=Q.length;I<x;I++)ve.push(null);break}return ve}const Ne={sendNotification:(N,...Q)=>{Ao();let ve,x;if(t.string(N)){ve=N;const j=Q[0];let $e=0,S=i.ParameterStructures.auto;i.ParameterStructures.is(j)&&($e=1,S=j);let $=Q.length;const ae=$-$e;switch(ae){case 0:x=void 0;break;case 1:x=Ga(S,Q[$e]);break;default:if(S===i.ParameterStructures.byName)throw new Error(`Received ${ae} parameters for 'by Name' notification parameter structure.`);x=Q.slice($e,$).map(Ae=>no(Ae));break}}else{const j=Q;ve=N.method,x=Pe(N,j)}const I={jsonrpc:Me,method:ve,params:x};return tt(I),C.write(I).catch(j=>{throw ue.error("Sending notification failed."),j})},onNotification:(N,Q)=>{Ao();let ve;return t.func(N)?Ge=N:Q&&(t.string(N)?(ve=N,xe.set(N,{type:void 0,handler:Q})):(ve=N.method,xe.set(N.method,{type:N,handler:Q}))),{dispose:()=>{ve!==void 0?xe.delete(ve):Ge=void 0}}},onProgress:(N,Q,ve)=>{if(Kt.has(Q))throw new Error(`Progress handler for token ${Q} already registered`);return Kt.set(Q,ve),{dispose:()=>{Kt.delete(Q)}}},sendProgress:(N,Q,ve)=>Ne.sendNotification(d.type,{token:Q,value:ve}),onUnhandledProgress:qn.event,sendRequest:(N,...Q)=>{Ao(),Pc();let ve,x,I;if(t.string(N)){ve=N;const $=Q[0],ae=Q[Q.length-1];let Ae=0,Ft=i.ParameterStructures.auto;i.ParameterStructures.is($)&&(Ae=1,Ft=$);let Wt=Q.length;o.CancellationToken.is(ae)&&(Wt=Wt-1,I=ae);const kt=Wt-Ae;switch(kt){case 0:x=void 0;break;case 1:x=Ga(Ft,Q[Ae]);break;default:if(Ft===i.ParameterStructures.byName)throw new Error(`Received ${kt} parameters for 'by Name' request parameter structure.`);x=Q.slice(Ae,Wt).map(br=>no(br));break}}else{const $=Q;ve=N.method,x=Pe(N,$);const ae=N.numberOfParams;I=o.CancellationToken.is($[ae])?$[ae]:void 0}const j=be++;let $e;I&&($e=I.onCancellationRequested(()=>{const $=U.sender.sendCancellation(Ne,j);return $===void 0?(ue.log(`Received no promise from cancellation strategy when cancelling id ${j}`),Promise.resolve()):$.catch(()=>{ue.log(`Sending cancellation messages for id ${j} failed`)})}));const S={jsonrpc:Me,id:j,method:ve,params:x};return oe(S),typeof U.sender.enableCancellation=="function"&&U.sender.enableCancellation(S),new Promise(async($,ae)=>{const Ae=kt=>{$(kt),U.sender.cleanup(j),$e==null||$e.dispose()},Ft=kt=>{ae(kt),U.sender.cleanup(j),$e==null||$e.dispose()},Wt={method:ve,timerStart:Date.now(),resolve:Ae,reject:Ft};try{await C.write(S),Qt.set(j,Wt)}catch(kt){throw ue.error("Sending request failed."),Wt.reject(new i.ResponseError(i.ErrorCodes.MessageWriteError,kt.message?kt.message:"Unknown reason")),kt}})},onRequest:(N,Q)=>{Ao();let ve=null;return u.is(N)?(ve=void 0,Re=N):t.string(N)?(ve=null,Q!==void 0&&(ve=N,Oe.set(N,{handler:Q,type:void 0}))):Q!==void 0&&(ve=N.method,Oe.set(N.method,{type:N,handler:Q})),{dispose:()=>{ve!==null&&(ve!==void 0?Oe.delete(ve):Re=void 0)}}},hasPendingResponse:()=>Qt.size>0,trace:async(N,Q,ve)=>{let x=!1,I=g.Text;ve!==void 0&&(t.boolean(ve)?x=ve:(x=ve.sendNotification||!1,I=ve.traceFormat||g.Text)),dt=N,xi=I,dt===h.Off?ci=void 0:ci=Q,x&&!Pt()&&!Zt()&&await Ne.sendNotification(m.type,{value:h.toString(N)})},onError:vn.event,onClose:zr.event,onUnhandledNotification:Kr.event,onDispose:ut.event,end:()=>{C.end()},dispose:()=>{if(Zt())return;mt=Z.Disposed,ut.fire(void 0);const N=new i.ResponseError(i.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(const Q of Qt.values())Q.reject(N);Qt=new Map,ai=new Map,ct=new Set,et=new n.LinkedMap,t.func(C.dispose)&&C.dispose(),t.func(H.dispose)&&H.dispose()},listen:()=>{Ao(),ra(),mt=Z.Listening,H.listen(Rc)},inspect:()=>{(0,e.default)().console.log("inspect")}};return Ne.onNotification(y.type,N=>{if(dt===h.Off||!ci)return;const Q=dt===h.Verbose||dt===h.Compact;ci.log(N.message,Q?N.verbose:void 0)}),Ne.onNotification(d.type,N=>{const Q=Kt.get(N.token);Q?Q(N.value):qn.fire(N)}),Ne}r.createMessageConnection=K})(Dz);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ProgressType=r.ProgressToken=r.createMessageConnection=r.NullLogger=r.ConnectionOptions=r.ConnectionStrategy=r.AbstractMessageBuffer=r.WriteableStreamMessageWriter=r.AbstractMessageWriter=r.MessageWriter=r.ReadableStreamMessageReader=r.AbstractMessageReader=r.MessageReader=r.SharedArrayReceiverStrategy=r.SharedArraySenderStrategy=r.CancellationToken=r.CancellationTokenSource=r.Emitter=r.Event=r.Disposable=r.LRUCache=r.Touch=r.LinkedMap=r.ParameterStructures=r.NotificationType9=r.NotificationType8=r.NotificationType7=r.NotificationType6=r.NotificationType5=r.NotificationType4=r.NotificationType3=r.NotificationType2=r.NotificationType1=r.NotificationType0=r.NotificationType=r.ErrorCodes=r.ResponseError=r.RequestType9=r.RequestType8=r.RequestType7=r.RequestType6=r.RequestType5=r.RequestType4=r.RequestType3=r.RequestType2=r.RequestType1=r.RequestType0=r.RequestType=r.Message=r.RAL=void 0,r.MessageStrategy=r.CancellationStrategy=r.CancellationSenderStrategy=r.CancellationReceiverStrategy=r.ConnectionError=r.ConnectionErrors=r.LogTraceNotification=r.SetTraceNotification=r.TraceFormat=r.TraceValues=r.Trace=void 0;const e=F1;Object.defineProperty(r,"Message",{enumerable:!0,get:function(){return e.Message}}),Object.defineProperty(r,"RequestType",{enumerable:!0,get:function(){return e.RequestType}}),Object.defineProperty(r,"RequestType0",{enumerable:!0,get:function(){return e.RequestType0}}),Object.defineProperty(r,"RequestType1",{enumerable:!0,get:function(){return e.RequestType1}}),Object.defineProperty(r,"RequestType2",{enumerable:!0,get:function(){return e.RequestType2}}),Object.defineProperty(r,"RequestType3",{enumerable:!0,get:function(){return e.RequestType3}}),Object.defineProperty(r,"RequestType4",{enumerable:!0,get:function(){return e.RequestType4}}),Object.defineProperty(r,"RequestType5",{enumerable:!0,get:function(){return e.RequestType5}}),Object.defineProperty(r,"RequestType6",{enumerable:!0,get:function(){return e.RequestType6}}),Object.defineProperty(r,"RequestType7",{enumerable:!0,get:function(){return e.RequestType7}}),Object.defineProperty(r,"RequestType8",{enumerable:!0,get:function(){return e.RequestType8}}),Object.defineProperty(r,"RequestType9",{enumerable:!0,get:function(){return e.RequestType9}}),Object.defineProperty(r,"ResponseError",{enumerable:!0,get:function(){return e.ResponseError}}),Object.defineProperty(r,"ErrorCodes",{enumerable:!0,get:function(){return e.ErrorCodes}}),Object.defineProperty(r,"NotificationType",{enumerable:!0,get:function(){return e.NotificationType}}),Object.defineProperty(r,"NotificationType0",{enumerable:!0,get:function(){return e.NotificationType0}}),Object.defineProperty(r,"NotificationType1",{enumerable:!0,get:function(){return e.NotificationType1}}),Object.defineProperty(r,"NotificationType2",{enumerable:!0,get:function(){return e.NotificationType2}}),Object.defineProperty(r,"NotificationType3",{enumerable:!0,get:function(){return e.NotificationType3}}),Object.defineProperty(r,"NotificationType4",{enumerable:!0,get:function(){return e.NotificationType4}}),Object.defineProperty(r,"NotificationType5",{enumerable:!0,get:function(){return e.NotificationType5}}),Object.defineProperty(r,"NotificationType6",{enumerable:!0,get:function(){return e.NotificationType6}}),Object.defineProperty(r,"NotificationType7",{enumerable:!0,get:function(){return e.NotificationType7}}),Object.defineProperty(r,"NotificationType8",{enumerable:!0,get:function(){return e.NotificationType8}}),Object.defineProperty(r,"NotificationType9",{enumerable:!0,get:function(){return e.NotificationType9}}),Object.defineProperty(r,"ParameterStructures",{enumerable:!0,get:function(){return e.ParameterStructures}});const t=O1;Object.defineProperty(r,"LinkedMap",{enumerable:!0,get:function(){return t.LinkedMap}}),Object.defineProperty(r,"LRUCache",{enumerable:!0,get:function(){return t.LRUCache}}),Object.defineProperty(r,"Touch",{enumerable:!0,get:function(){return t.Touch}});const i=xz;Object.defineProperty(r,"Disposable",{enumerable:!0,get:function(){return i.Disposable}});const n=Ym;Object.defineProperty(r,"Event",{enumerable:!0,get:function(){return n.Event}}),Object.defineProperty(r,"Emitter",{enumerable:!0,get:function(){return n.Emitter}});const s=Bk;Object.defineProperty(r,"CancellationTokenSource",{enumerable:!0,get:function(){return s.CancellationTokenSource}}),Object.defineProperty(r,"CancellationToken",{enumerable:!0,get:function(){return s.CancellationToken}});const o=Zg;Object.defineProperty(r,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return o.SharedArraySenderStrategy}}),Object.defineProperty(r,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return o.SharedArrayReceiverStrategy}});const a=N1;Object.defineProperty(r,"MessageReader",{enumerable:!0,get:function(){return a.MessageReader}}),Object.defineProperty(r,"AbstractMessageReader",{enumerable:!0,get:function(){return a.AbstractMessageReader}}),Object.defineProperty(r,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return a.ReadableStreamMessageReader}});const c=$1;Object.defineProperty(r,"MessageWriter",{enumerable:!0,get:function(){return c.MessageWriter}}),Object.defineProperty(r,"AbstractMessageWriter",{enumerable:!0,get:function(){return c.AbstractMessageWriter}}),Object.defineProperty(r,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return c.WriteableStreamMessageWriter}});const d=Uk;Object.defineProperty(r,"AbstractMessageBuffer",{enumerable:!0,get:function(){return d.AbstractMessageBuffer}});const l=Dz;Object.defineProperty(r,"ConnectionStrategy",{enumerable:!0,get:function(){return l.ConnectionStrategy}}),Object.defineProperty(r,"ConnectionOptions",{enumerable:!0,get:function(){return l.ConnectionOptions}}),Object.defineProperty(r,"NullLogger",{enumerable:!0,get:function(){return l.NullLogger}}),Object.defineProperty(r,"createMessageConnection",{enumerable:!0,get:function(){return l.createMessageConnection}}),Object.defineProperty(r,"ProgressToken",{enumerable:!0,get:function(){return l.ProgressToken}}),Object.defineProperty(r,"ProgressType",{enumerable:!0,get:function(){return l.ProgressType}}),Object.defineProperty(r,"Trace",{enumerable:!0,get:function(){return l.Trace}}),Object.defineProperty(r,"TraceValues",{enumerable:!0,get:function(){return l.TraceValues}}),Object.defineProperty(r,"TraceFormat",{enumerable:!0,get:function(){return l.TraceFormat}}),Object.defineProperty(r,"SetTraceNotification",{enumerable:!0,get:function(){return l.SetTraceNotification}}),Object.defineProperty(r,"LogTraceNotification",{enumerable:!0,get:function(){return l.LogTraceNotification}}),Object.defineProperty(r,"ConnectionErrors",{enumerable:!0,get:function(){return l.ConnectionErrors}}),Object.defineProperty(r,"ConnectionError",{enumerable:!0,get:function(){return l.ConnectionError}}),Object.defineProperty(r,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return l.CancellationReceiverStrategy}}),Object.defineProperty(r,"CancellationSenderStrategy",{enumerable:!0,get:function(){return l.CancellationSenderStrategy}}),Object.defineProperty(r,"CancellationStrategy",{enumerable:!0,get:function(){return l.CancellationStrategy}}),Object.defineProperty(r,"MessageStrategy",{enumerable:!0,get:function(){return l.MessageStrategy}});const u=Fd;r.RAL=u.default})(gE);Object.defineProperty(L1,"__esModule",{value:!0});const ac=gE;let kz=class Tz extends ac.AbstractMessageBuffer{constructor(e="utf-8"){super(e),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return Tz.emptyBuffer}fromString(e,t){return new TextEncoder().encode(e)}toString(e,t){return t==="ascii"?this.asciiDecoder.decode(e):new TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e:e.slice(0,t)}allocNative(e){return new Uint8Array(e)}};kz.emptyBuffer=new Uint8Array(0);class Gre{constructor(e){this.socket=e,this._onData=new ac.Emitter,this._messageListener=t=>{t.data.arrayBuffer().then(n=>{this._onData.fire(new Uint8Array(n))},()=>{(0,ac.RAL)().console.error("Converting blob to array buffer failed.")})},this.socket.addEventListener("message",this._messageListener)}onClose(e){return this.socket.addEventListener("close",e),ac.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),ac.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),ac.Disposable.create(()=>this.socket.removeEventListener("end",e))}onData(e){return this._onData.event(e)}}class zre{constructor(e){this.socket=e}onClose(e){return this.socket.addEventListener("close",e),ac.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),ac.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),ac.Disposable.create(()=>this.socket.removeEventListener("end",e))}write(e,t){if(typeof e=="string"){if(t!==void 0&&t!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${t}`);this.socket.send(e)}else this.socket.send(e);return Promise.resolve()}end(){this.socket.close()}}const Kre=new TextEncoder,Iz=Object.freeze({messageBuffer:Object.freeze({create:r=>new kz(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{if(e.charset!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${e.charset}`);return Promise.resolve(Kre.encode(JSON.stringify(r,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{if(!(r instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(e.charset).decode(r)))}})}),stream:Object.freeze({asReadableStream:r=>new Gre(r),asWritableStream:r=>new zre(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){const i=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(i)}},setImmediate(r,...e){const t=setTimeout(r,0,...e);return{dispose:()=>clearTimeout(t)}},setInterval(r,e,...t){const i=setInterval(r,e,...t);return{dispose:()=>clearInterval(i)}}})});function xA(){return Iz}(function(r){function e(){ac.RAL.install(Iz)}r.install=e})(xA||(xA={}));L1.default=xA;(function(r){var e=Jn&&Jn.__createBinding||(Object.create?function(c,d,l,u){u===void 0&&(u=l);var h=Object.getOwnPropertyDescriptor(d,l);(!h||("get"in h?!d.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return d[l]}}),Object.defineProperty(c,u,h)}:function(c,d,l,u){u===void 0&&(u=l),c[u]=d[l]}),t=Jn&&Jn.__exportStar||function(c,d){for(var l in c)l!=="default"&&!Object.prototype.hasOwnProperty.call(d,l)&&e(d,c,l)};Object.defineProperty(r,"__esModule",{value:!0}),r.createMessageConnection=r.BrowserMessageWriter=r.BrowserMessageReader=void 0,L1.default.install();const n=gE;t(gE,r);class s extends n.AbstractMessageReader{constructor(d){super(),this._onData=new n.Emitter,this._messageListener=l=>{this._onData.fire(l.data)},d.addEventListener("error",l=>this.fireError(l)),d.onmessage=this._messageListener}listen(d){return this._onData.event(d)}}r.BrowserMessageReader=s;class o extends n.AbstractMessageWriter{constructor(d){super(),this.port=d,this.errorCount=0,d.addEventListener("error",l=>this.fireError(l))}write(d){try{return this.port.postMessage(d),Promise.resolve()}catch(l){return this.handleError(l,d),Promise.reject(l)}}handleError(d,l){this.errorCount++,this.fireError(d,l,this.errorCount)}end(){}}r.BrowserMessageWriter=o;function a(c,d,l,u){return l===void 0&&(l=n.NullLogger),n.ConnectionStrategy.is(u)&&(u={connectionStrategy:u}),(0,n.createMessageConnection)(c,d,l,u)}r.createMessageConnection=a})(Uf);var tj=Uf,Rz={},DA;(function(r){function e(t){return typeof t=="string"}r.is=e})(DA||(DA={}));var mE;(function(r){function e(t){return typeof t=="string"}r.is=e})(mE||(mE={}));var kA;(function(r){r.MIN_VALUE=-2147483648,r.MAX_VALUE=2147483647;function e(t){return typeof t=="number"&&r.MIN_VALUE<=t&&t<=r.MAX_VALUE}r.is=e})(kA||(kA={}));var A_;(function(r){r.MIN_VALUE=0,r.MAX_VALUE=2147483647;function e(t){return typeof t=="number"&&r.MIN_VALUE<=t&&t<=r.MAX_VALUE}r.is=e})(A_||(A_={}));var $o;(function(r){function e(i,n){return i===Number.MAX_VALUE&&(i=A_.MAX_VALUE),n===Number.MAX_VALUE&&(n=A_.MAX_VALUE),{line:i,character:n}}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&se.uinteger(n.line)&&se.uinteger(n.character)}r.is=t})($o||($o={}));var On;(function(r){function e(i,n,s,o){if(se.uinteger(i)&&se.uinteger(n)&&se.uinteger(s)&&se.uinteger(o))return{start:$o.create(i,n),end:$o.create(s,o)};if($o.is(i)&&$o.is(n))return{start:i,end:n};throw new Error("Range#create called with invalid arguments[".concat(i,", ").concat(n,", ").concat(s,", ").concat(o,"]"))}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&$o.is(n.start)&&$o.is(n.end)}r.is=t})(On||(On={}));var M_;(function(r){function e(i,n){return{uri:i,range:n}}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&On.is(n.range)&&(se.string(n.uri)||se.undefined(n.uri))}r.is=t})(M_||(M_={}));var TA;(function(r){function e(i,n,s,o){return{targetUri:i,targetRange:n,targetSelectionRange:s,originSelectionRange:o}}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&On.is(n.targetRange)&&se.string(n.targetUri)&&On.is(n.targetSelectionRange)&&(On.is(n.originSelectionRange)||se.undefined(n.originSelectionRange))}r.is=t})(TA||(TA={}));var vE;(function(r){function e(i,n,s,o){return{red:i,green:n,blue:s,alpha:o}}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&se.numberRange(n.red,0,1)&&se.numberRange(n.green,0,1)&&se.numberRange(n.blue,0,1)&&se.numberRange(n.alpha,0,1)}r.is=t})(vE||(vE={}));var IA;(function(r){function e(i,n){return{range:i,color:n}}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&On.is(n.range)&&vE.is(n.color)}r.is=t})(IA||(IA={}));var RA;(function(r){function e(i,n,s){return{label:i,textEdit:n,additionalTextEdits:s}}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&se.string(n.label)&&(se.undefined(n.textEdit)||gc.is(n))&&(se.undefined(n.additionalTextEdits)||se.typedArray(n.additionalTextEdits,gc.is))}r.is=t})(RA||(RA={}));var PA;(function(r){r.Comment="comment",r.Imports="imports",r.Region="region"})(PA||(PA={}));var AA;(function(r){function e(i,n,s,o,a,c){var d={startLine:i,endLine:n};return se.defined(s)&&(d.startCharacter=s),se.defined(o)&&(d.endCharacter=o),se.defined(a)&&(d.kind=a),se.defined(c)&&(d.collapsedText=c),d}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&se.uinteger(n.startLine)&&se.uinteger(n.startLine)&&(se.undefined(n.startCharacter)||se.uinteger(n.startCharacter))&&(se.undefined(n.endCharacter)||se.uinteger(n.endCharacter))&&(se.undefined(n.kind)||se.string(n.kind))}r.is=t})(AA||(AA={}));var yE;(function(r){function e(i,n){return{location:i,message:n}}r.create=e;function t(i){var n=i;return se.defined(n)&&M_.is(n.location)&&se.string(n.message)}r.is=t})(yE||(yE={}));var MA;(function(r){r.Error=1,r.Warning=2,r.Information=3,r.Hint=4})(MA||(MA={}));var LA;(function(r){r.Unnecessary=1,r.Deprecated=2})(LA||(LA={}));var FA;(function(r){function e(t){var i=t;return se.objectLiteral(i)&&se.string(i.href)}r.is=e})(FA||(FA={}));var L_;(function(r){function e(i,n,s,o,a,c){var d={range:i,message:n};return se.defined(s)&&(d.severity=s),se.defined(o)&&(d.code=o),se.defined(a)&&(d.source=a),se.defined(c)&&(d.relatedInformation=c),d}r.create=e;function t(i){var n,s=i;return se.defined(s)&&On.is(s.range)&&se.string(s.message)&&(se.number(s.severity)||se.undefined(s.severity))&&(se.integer(s.code)||se.string(s.code)||se.undefined(s.code))&&(se.undefined(s.codeDescription)||se.string((n=s.codeDescription)===null||n===void 0?void 0:n.href))&&(se.string(s.source)||se.undefined(s.source))&&(se.undefined(s.relatedInformation)||se.typedArray(s.relatedInformation,yE.is))}r.is=t})(L_||(L_={}));var wf;(function(r){function e(i,n){for(var s=[],o=2;o<arguments.length;o++)s[o-2]=arguments[o];var a={title:i,command:n};return se.defined(s)&&s.length>0&&(a.arguments=s),a}r.create=e;function t(i){var n=i;return se.defined(n)&&se.string(n.title)&&se.string(n.command)}r.is=t})(wf||(wf={}));var gc;(function(r){function e(s,o){return{range:s,newText:o}}r.replace=e;function t(s,o){return{range:{start:s,end:s},newText:o}}r.insert=t;function i(s){return{range:s,newText:""}}r.del=i;function n(s){var o=s;return se.objectLiteral(o)&&se.string(o.newText)&&On.is(o.range)}r.is=n})(gc||(gc={}));var Fh;(function(r){function e(i,n,s){var o={label:i};return n!==void 0&&(o.needsConfirmation=n),s!==void 0&&(o.description=s),o}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&se.string(n.label)&&(se.boolean(n.needsConfirmation)||n.needsConfirmation===void 0)&&(se.string(n.description)||n.description===void 0)}r.is=t})(Fh||(Fh={}));var Fr;(function(r){function e(t){var i=t;return se.string(i)}r.is=e})(Fr||(Fr={}));var Vc;(function(r){function e(s,o,a){return{range:s,newText:o,annotationId:a}}r.replace=e;function t(s,o,a){return{range:{start:s,end:s},newText:o,annotationId:a}}r.insert=t;function i(s,o){return{range:s,newText:"",annotationId:o}}r.del=i;function n(s){var o=s;return gc.is(o)&&(Fh.is(o.annotationId)||Fr.is(o.annotationId))}r.is=n})(Vc||(Vc={}));var F_;(function(r){function e(i,n){return{textDocument:i,edits:n}}r.create=e;function t(i){var n=i;return se.defined(n)&&O_.is(n.textDocument)&&Array.isArray(n.edits)}r.is=t})(F_||(F_={}));var em;(function(r){function e(i,n,s){var o={kind:"create",uri:i};return n!==void 0&&(n.overwrite!==void 0||n.ignoreIfExists!==void 0)&&(o.options=n),s!==void 0&&(o.annotationId=s),o}r.create=e;function t(i){var n=i;return n&&n.kind==="create"&&se.string(n.uri)&&(n.options===void 0||(n.options.overwrite===void 0||se.boolean(n.options.overwrite))&&(n.options.ignoreIfExists===void 0||se.boolean(n.options.ignoreIfExists)))&&(n.annotationId===void 0||Fr.is(n.annotationId))}r.is=t})(em||(em={}));var tm;(function(r){function e(i,n,s,o){var a={kind:"rename",oldUri:i,newUri:n};return s!==void 0&&(s.overwrite!==void 0||s.ignoreIfExists!==void 0)&&(a.options=s),o!==void 0&&(a.annotationId=o),a}r.create=e;function t(i){var n=i;return n&&n.kind==="rename"&&se.string(n.oldUri)&&se.string(n.newUri)&&(n.options===void 0||(n.options.overwrite===void 0||se.boolean(n.options.overwrite))&&(n.options.ignoreIfExists===void 0||se.boolean(n.options.ignoreIfExists)))&&(n.annotationId===void 0||Fr.is(n.annotationId))}r.is=t})(tm||(tm={}));var im;(function(r){function e(i,n,s){var o={kind:"delete",uri:i};return n!==void 0&&(n.recursive!==void 0||n.ignoreIfNotExists!==void 0)&&(o.options=n),s!==void 0&&(o.annotationId=s),o}r.create=e;function t(i){var n=i;return n&&n.kind==="delete"&&se.string(n.uri)&&(n.options===void 0||(n.options.recursive===void 0||se.boolean(n.options.recursive))&&(n.options.ignoreIfNotExists===void 0||se.boolean(n.options.ignoreIfNotExists)))&&(n.annotationId===void 0||Fr.is(n.annotationId))}r.is=t})(im||(im={}));var _E;(function(r){function e(t){var i=t;return i&&(i.changes!==void 0||i.documentChanges!==void 0)&&(i.documentChanges===void 0||i.documentChanges.every(function(n){return se.string(n.kind)?em.is(n)||tm.is(n)||im.is(n):F_.is(n)}))}r.is=e})(_E||(_E={}));var $b=function(){function r(e,t){this.edits=e,this.changeAnnotations=t}return r.prototype.insert=function(e,t,i){var n,s;if(i===void 0?n=gc.insert(e,t):Fr.is(i)?(s=i,n=Vc.insert(e,t,i)):(this.assertChangeAnnotations(this.changeAnnotations),s=this.changeAnnotations.manage(i),n=Vc.insert(e,t,s)),this.edits.push(n),s!==void 0)return s},r.prototype.replace=function(e,t,i){var n,s;if(i===void 0?n=gc.replace(e,t):Fr.is(i)?(s=i,n=Vc.replace(e,t,i)):(this.assertChangeAnnotations(this.changeAnnotations),s=this.changeAnnotations.manage(i),n=Vc.replace(e,t,s)),this.edits.push(n),s!==void 0)return s},r.prototype.delete=function(e,t){var i,n;if(t===void 0?i=gc.del(e):Fr.is(t)?(n=t,i=Vc.del(e,t)):(this.assertChangeAnnotations(this.changeAnnotations),n=this.changeAnnotations.manage(t),i=Vc.del(e,n)),this.edits.push(i),n!==void 0)return n},r.prototype.add=function(e){this.edits.push(e)},r.prototype.all=function(){return this.edits},r.prototype.clear=function(){this.edits.splice(0,this.edits.length)},r.prototype.assertChangeAnnotations=function(e){if(e===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},r}(),ij=function(){function r(e){this._annotations=e===void 0?Object.create(null):e,this._counter=0,this._size=0}return r.prototype.all=function(){return this._annotations},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),r.prototype.manage=function(e,t){var i;if(Fr.is(e)?i=e:(i=this.nextId(),t=e),this._annotations[i]!==void 0)throw new Error("Id ".concat(i," is already in use."));if(t===void 0)throw new Error("No annotation provided for id ".concat(i));return this._annotations[i]=t,this._size++,i},r.prototype.nextId=function(){return this._counter++,this._counter.toString()},r}(),Qre=function(){function r(e){var t=this;this._textEditChanges=Object.create(null),e!==void 0?(this._workspaceEdit=e,e.documentChanges?(this._changeAnnotations=new ij(e.changeAnnotations),e.changeAnnotations=this._changeAnnotations.all(),e.documentChanges.forEach(function(i){if(F_.is(i)){var n=new $b(i.edits,t._changeAnnotations);t._textEditChanges[i.textDocument.uri]=n}})):e.changes&&Object.keys(e.changes).forEach(function(i){var n=new $b(e.changes[i]);t._textEditChanges[i]=n})):this._workspaceEdit={}}return Object.defineProperty(r.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),r.prototype.getTextEditChange=function(e){if(O_.is(e)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var t={uri:e.uri,version:e.version},i=this._textEditChanges[t.uri];if(!i){var n=[],s={textDocument:t,edits:n};this._workspaceEdit.documentChanges.push(s),i=new $b(n,this._changeAnnotations),this._textEditChanges[t.uri]=i}return i}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var i=this._textEditChanges[e];if(!i){var n=[];this._workspaceEdit.changes[e]=n,i=new $b(n),this._textEditChanges[e]=i}return i}},r.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new ij,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},r.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},r.prototype.createFile=function(e,t,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var n;Fh.is(t)||Fr.is(t)?n=t:i=t;var s,o;if(n===void 0?s=em.create(e,i):(o=Fr.is(n)?n:this._changeAnnotations.manage(n),s=em.create(e,i,o)),this._workspaceEdit.documentChanges.push(s),o!==void 0)return o},r.prototype.renameFile=function(e,t,i,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var s;Fh.is(i)||Fr.is(i)?s=i:n=i;var o,a;if(s===void 0?o=tm.create(e,t,n):(a=Fr.is(s)?s:this._changeAnnotations.manage(s),o=tm.create(e,t,n,a)),this._workspaceEdit.documentChanges.push(o),a!==void 0)return a},r.prototype.deleteFile=function(e,t,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var n;Fh.is(t)||Fr.is(t)?n=t:i=t;var s,o;if(n===void 0?s=im.create(e,i):(o=Fr.is(n)?n:this._changeAnnotations.manage(n),s=im.create(e,i,o)),this._workspaceEdit.documentChanges.push(s),o!==void 0)return o},r}(),OA;(function(r){function e(i){return{uri:i}}r.create=e;function t(i){var n=i;return se.defined(n)&&se.string(n.uri)}r.is=t})(OA||(OA={}));var NA;(function(r){function e(i,n){return{uri:i,version:n}}r.create=e;function t(i){var n=i;return se.defined(n)&&se.string(n.uri)&&se.integer(n.version)}r.is=t})(NA||(NA={}));var O_;(function(r){function e(i,n){return{uri:i,version:n}}r.create=e;function t(i){var n=i;return se.defined(n)&&se.string(n.uri)&&(n.version===null||se.integer(n.version))}r.is=t})(O_||(O_={}));var $A;(function(r){function e(i,n,s,o){return{uri:i,languageId:n,version:s,text:o}}r.create=e;function t(i){var n=i;return se.defined(n)&&se.string(n.uri)&&se.string(n.languageId)&&se.integer(n.version)&&se.string(n.text)}r.is=t})($A||($A={}));var wE;(function(r){r.PlainText="plaintext",r.Markdown="markdown";function e(t){var i=t;return i===r.PlainText||i===r.Markdown}r.is=e})(wE||(wE={}));var nm;(function(r){function e(t){var i=t;return se.objectLiteral(t)&&wE.is(i.kind)&&se.string(i.value)}r.is=e})(nm||(nm={}));var WA;(function(r){r.Text=1,r.Method=2,r.Function=3,r.Constructor=4,r.Field=5,r.Variable=6,r.Class=7,r.Interface=8,r.Module=9,r.Property=10,r.Unit=11,r.Value=12,r.Enum=13,r.Keyword=14,r.Snippet=15,r.Color=16,r.File=17,r.Reference=18,r.Folder=19,r.EnumMember=20,r.Constant=21,r.Struct=22,r.Event=23,r.Operator=24,r.TypeParameter=25})(WA||(WA={}));var HA;(function(r){r.PlainText=1,r.Snippet=2})(HA||(HA={}));var jA;(function(r){r.Deprecated=1})(jA||(jA={}));var BA;(function(r){function e(i,n,s){return{newText:i,insert:n,replace:s}}r.create=e;function t(i){var n=i;return n&&se.string(n.newText)&&On.is(n.insert)&&On.is(n.replace)}r.is=t})(BA||(BA={}));var UA;(function(r){r.asIs=1,r.adjustIndentation=2})(UA||(UA={}));var VA;(function(r){function e(t){var i=t;return i&&(se.string(i.detail)||i.detail===void 0)&&(se.string(i.description)||i.description===void 0)}r.is=e})(VA||(VA={}));var qA;(function(r){function e(t){return{label:t}}r.create=e})(qA||(qA={}));var GA;(function(r){function e(t,i){return{items:t||[],isIncomplete:!!i}}r.create=e})(GA||(GA={}));var N_;(function(r){function e(i){return i.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}r.fromPlainText=e;function t(i){var n=i;return se.string(n)||se.objectLiteral(n)&&se.string(n.language)&&se.string(n.value)}r.is=t})(N_||(N_={}));var zA;(function(r){function e(t){var i=t;return!!i&&se.objectLiteral(i)&&(nm.is(i.contents)||N_.is(i.contents)||se.typedArray(i.contents,N_.is))&&(t.range===void 0||On.is(t.range))}r.is=e})(zA||(zA={}));var KA;(function(r){function e(t,i){return i?{label:t,documentation:i}:{label:t}}r.create=e})(KA||(KA={}));var QA;(function(r){function e(t,i){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];var o={label:t};return se.defined(i)&&(o.documentation=i),se.defined(n)?o.parameters=n:o.parameters=[],o}r.create=e})(QA||(QA={}));var YA;(function(r){r.Text=1,r.Read=2,r.Write=3})(YA||(YA={}));var XA;(function(r){function e(t,i){var n={range:t};return se.number(i)&&(n.kind=i),n}r.create=e})(XA||(XA={}));var JA;(function(r){r.File=1,r.Module=2,r.Namespace=3,r.Package=4,r.Class=5,r.Method=6,r.Property=7,r.Field=8,r.Constructor=9,r.Enum=10,r.Interface=11,r.Function=12,r.Variable=13,r.Constant=14,r.String=15,r.Number=16,r.Boolean=17,r.Array=18,r.Object=19,r.Key=20,r.Null=21,r.EnumMember=22,r.Struct=23,r.Event=24,r.Operator=25,r.TypeParameter=26})(JA||(JA={}));var ZA;(function(r){r.Deprecated=1})(ZA||(ZA={}));var eM;(function(r){function e(t,i,n,s,o){var a={name:t,kind:i,location:{uri:s,range:n}};return o&&(a.containerName=o),a}r.create=e})(eM||(eM={}));var tM;(function(r){function e(t,i,n,s){return s!==void 0?{name:t,kind:i,location:{uri:n,range:s}}:{name:t,kind:i,location:{uri:n}}}r.create=e})(tM||(tM={}));var iM;(function(r){function e(i,n,s,o,a,c){var d={name:i,detail:n,kind:s,range:o,selectionRange:a};return c!==void 0&&(d.children=c),d}r.create=e;function t(i){var n=i;return n&&se.string(n.name)&&se.number(n.kind)&&On.is(n.range)&&On.is(n.selectionRange)&&(n.detail===void 0||se.string(n.detail))&&(n.deprecated===void 0||se.boolean(n.deprecated))&&(n.children===void 0||Array.isArray(n.children))&&(n.tags===void 0||Array.isArray(n.tags))}r.is=t})(iM||(iM={}));var nM;(function(r){r.Empty="",r.QuickFix="quickfix",r.Refactor="refactor",r.RefactorExtract="refactor.extract",r.RefactorInline="refactor.inline",r.RefactorRewrite="refactor.rewrite",r.Source="source",r.SourceOrganizeImports="source.organizeImports",r.SourceFixAll="source.fixAll"})(nM||(nM={}));var $_;(function(r){r.Invoked=1,r.Automatic=2})($_||($_={}));var rM;(function(r){function e(i,n,s){var o={diagnostics:i};return n!=null&&(o.only=n),s!=null&&(o.triggerKind=s),o}r.create=e;function t(i){var n=i;return se.defined(n)&&se.typedArray(n.diagnostics,L_.is)&&(n.only===void 0||se.typedArray(n.only,se.string))&&(n.triggerKind===void 0||n.triggerKind===$_.Invoked||n.triggerKind===$_.Automatic)}r.is=t})(rM||(rM={}));var sM;(function(r){function e(i,n,s){var o={title:i},a=!0;return typeof n=="string"?(a=!1,o.kind=n):wf.is(n)?o.command=n:o.edit=n,a&&s!==void 0&&(o.kind=s),o}r.create=e;function t(i){var n=i;return n&&se.string(n.title)&&(n.diagnostics===void 0||se.typedArray(n.diagnostics,L_.is))&&(n.kind===void 0||se.string(n.kind))&&(n.edit!==void 0||n.command!==void 0)&&(n.command===void 0||wf.is(n.command))&&(n.isPreferred===void 0||se.boolean(n.isPreferred))&&(n.edit===void 0||_E.is(n.edit))}r.is=t})(sM||(sM={}));var oM;(function(r){function e(i,n){var s={range:i};return se.defined(n)&&(s.data=n),s}r.create=e;function t(i){var n=i;return se.defined(n)&&On.is(n.range)&&(se.undefined(n.command)||wf.is(n.command))}r.is=t})(oM||(oM={}));var aM;(function(r){function e(i,n){return{tabSize:i,insertSpaces:n}}r.create=e;function t(i){var n=i;return se.defined(n)&&se.uinteger(n.tabSize)&&se.boolean(n.insertSpaces)}r.is=t})(aM||(aM={}));var cM;(function(r){function e(i,n,s){return{range:i,target:n,data:s}}r.create=e;function t(i){var n=i;return se.defined(n)&&On.is(n.range)&&(se.undefined(n.target)||se.string(n.target))}r.is=t})(cM||(cM={}));var dM;(function(r){function e(i,n){return{range:i,parent:n}}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&On.is(n.range)&&(n.parent===void 0||r.is(n.parent))}r.is=t})(dM||(dM={}));var lM;(function(r){r.namespace="namespace",r.type="type",r.class="class",r.enum="enum",r.interface="interface",r.struct="struct",r.typeParameter="typeParameter",r.parameter="parameter",r.variable="variable",r.property="property",r.enumMember="enumMember",r.event="event",r.function="function",r.method="method",r.macro="macro",r.keyword="keyword",r.modifier="modifier",r.comment="comment",r.string="string",r.number="number",r.regexp="regexp",r.operator="operator",r.decorator="decorator"})(lM||(lM={}));var uM;(function(r){r.declaration="declaration",r.definition="definition",r.readonly="readonly",r.static="static",r.deprecated="deprecated",r.abstract="abstract",r.async="async",r.modification="modification",r.documentation="documentation",r.defaultLibrary="defaultLibrary"})(uM||(uM={}));var hM;(function(r){function e(t){var i=t;return se.objectLiteral(i)&&(i.resultId===void 0||typeof i.resultId=="string")&&Array.isArray(i.data)&&(i.data.length===0||typeof i.data[0]=="number")}r.is=e})(hM||(hM={}));var fM;(function(r){function e(i,n){return{range:i,text:n}}r.create=e;function t(i){var n=i;return n!=null&&On.is(n.range)&&se.string(n.text)}r.is=t})(fM||(fM={}));var pM;(function(r){function e(i,n,s){return{range:i,variableName:n,caseSensitiveLookup:s}}r.create=e;function t(i){var n=i;return n!=null&&On.is(n.range)&&se.boolean(n.caseSensitiveLookup)&&(se.string(n.variableName)||n.variableName===void 0)}r.is=t})(pM||(pM={}));var gM;(function(r){function e(i,n){return{range:i,expression:n}}r.create=e;function t(i){var n=i;return n!=null&&On.is(n.range)&&(se.string(n.expression)||n.expression===void 0)}r.is=t})(gM||(gM={}));var mM;(function(r){function e(i,n){return{frameId:i,stoppedLocation:n}}r.create=e;function t(i){var n=i;return se.defined(n)&&On.is(i.stoppedLocation)}r.is=t})(mM||(mM={}));var bE;(function(r){r.Type=1,r.Parameter=2;function e(t){return t===1||t===2}r.is=e})(bE||(bE={}));var SE;(function(r){function e(i){return{value:i}}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&(n.tooltip===void 0||se.string(n.tooltip)||nm.is(n.tooltip))&&(n.location===void 0||M_.is(n.location))&&(n.command===void 0||wf.is(n.command))}r.is=t})(SE||(SE={}));var vM;(function(r){function e(i,n,s){var o={position:i,label:n};return s!==void 0&&(o.kind=s),o}r.create=e;function t(i){var n=i;return se.objectLiteral(n)&&$o.is(n.position)&&(se.string(n.label)||se.typedArray(n.label,SE.is))&&(n.kind===void 0||bE.is(n.kind))&&n.textEdits===void 0||se.typedArray(n.textEdits,gc.is)&&(n.tooltip===void 0||se.string(n.tooltip)||nm.is(n.tooltip))&&(n.paddingLeft===void 0||se.boolean(n.paddingLeft))&&(n.paddingRight===void 0||se.boolean(n.paddingRight))}r.is=t})(vM||(vM={}));var yM;(function(r){function e(t){var i=t;return se.objectLiteral(i)&&mE.is(i.uri)&&se.string(i.name)}r.is=e})(yM||(yM={}));var Yre=[`
`,`\r
`,"\r"],_M;(function(r){function e(s,o,a,c){return new Xre(s,o,a,c)}r.create=e;function t(s){var o=s;return!!(se.defined(o)&&se.string(o.uri)&&(se.undefined(o.languageId)||se.string(o.languageId))&&se.uinteger(o.lineCount)&&se.func(o.getText)&&se.func(o.positionAt)&&se.func(o.offsetAt))}r.is=t;function i(s,o){for(var a=s.getText(),c=n(o,function(m,y){var _=m.range.start.line-y.range.start.line;return _===0?m.range.start.character-y.range.start.character:_}),d=a.length,l=c.length-1;l>=0;l--){var u=c[l],h=s.offsetAt(u.range.start),g=s.offsetAt(u.range.end);if(g<=d)a=a.substring(0,h)+u.newText+a.substring(g,a.length);else throw new Error("Overlapping edit");d=h}return a}r.applyEdits=i;function n(s,o){if(s.length<=1)return s;var a=s.length/2|0,c=s.slice(0,a),d=s.slice(a);n(c,o),n(d,o);for(var l=0,u=0,h=0;l<c.length&&u<d.length;){var g=o(c[l],d[u]);g<=0?s[h++]=c[l++]:s[h++]=d[u++]}for(;l<c.length;)s[h++]=c[l++];for(;u<d.length;)s[h++]=d[u++];return s}})(_M||(_M={}));var Xre=function(){function r(e,t,i,n){this._uri=e,this._languageId=t,this._version=i,this._content=n,this._lineOffsets=void 0}return Object.defineProperty(r.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),r.prototype.getText=function(e){if(e){var t=this.offsetAt(e.start),i=this.offsetAt(e.end);return this._content.substring(t,i)}return this._content},r.prototype.update=function(e,t){this._content=e.text,this._version=t,this._lineOffsets=void 0},r.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var e=[],t=this._content,i=!0,n=0;n<t.length;n++){i&&(e.push(n),i=!1);var s=t.charAt(n);i=s==="\r"||s===`
`,s==="\r"&&n+1<t.length&&t.charAt(n+1)===`
`&&n++}i&&t.length>0&&e.push(t.length),this._lineOffsets=e}return this._lineOffsets},r.prototype.positionAt=function(e){e=Math.max(Math.min(e,this._content.length),0);var t=this.getLineOffsets(),i=0,n=t.length;if(n===0)return $o.create(0,e);for(;i<n;){var s=Math.floor((i+n)/2);t[s]>e?n=s:i=s+1}var o=i-1;return $o.create(o,e-t[o])},r.prototype.offsetAt=function(e){var t=this.getLineOffsets();if(e.line>=t.length)return this._content.length;if(e.line<0)return 0;var i=t[e.line],n=e.line+1<t.length?t[e.line+1]:this._content.length;return Math.max(Math.min(i+e.character,n),i)},Object.defineProperty(r.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),r}(),se;(function(r){var e=Object.prototype.toString;function t(g){return typeof g<"u"}r.defined=t;function i(g){return typeof g>"u"}r.undefined=i;function n(g){return g===!0||g===!1}r.boolean=n;function s(g){return e.call(g)==="[object String]"}r.string=s;function o(g){return e.call(g)==="[object Number]"}r.number=o;function a(g,m,y){return e.call(g)==="[object Number]"&&m<=g&&g<=y}r.numberRange=a;function c(g){return e.call(g)==="[object Number]"&&-2147483648<=g&&g<=2147483647}r.integer=c;function d(g){return e.call(g)==="[object Number]"&&0<=g&&g<=2147483647}r.uinteger=d;function l(g){return e.call(g)==="[object Function]"}r.func=l;function u(g){return g!==null&&typeof g=="object"}r.objectLiteral=u;function h(g,m){return Array.isArray(g)&&g.every(m)}r.typedArray=h})(se||(se={}));const Jre=Object.freeze(Object.defineProperty({__proto__:null,get AnnotatedTextEdit(){return Vc},get ChangeAnnotation(){return Fh},get ChangeAnnotationIdentifier(){return Fr},get CodeAction(){return sM},get CodeActionContext(){return rM},get CodeActionKind(){return nM},get CodeActionTriggerKind(){return $_},get CodeDescription(){return FA},get CodeLens(){return oM},get Color(){return vE},get ColorInformation(){return IA},get ColorPresentation(){return RA},get Command(){return wf},get CompletionItem(){return qA},get CompletionItemKind(){return WA},get CompletionItemLabelDetails(){return VA},get CompletionItemTag(){return jA},get CompletionList(){return GA},get CreateFile(){return em},get DeleteFile(){return im},get Diagnostic(){return L_},get DiagnosticRelatedInformation(){return yE},get DiagnosticSeverity(){return MA},get DiagnosticTag(){return LA},get DocumentHighlight(){return XA},get DocumentHighlightKind(){return YA},get DocumentLink(){return cM},get DocumentSymbol(){return iM},get DocumentUri(){return DA},EOL:Yre,get FoldingRange(){return AA},get FoldingRangeKind(){return PA},get FormattingOptions(){return aM},get Hover(){return zA},get InlayHint(){return vM},get InlayHintKind(){return bE},get InlayHintLabelPart(){return SE},get InlineValueContext(){return mM},get InlineValueEvaluatableExpression(){return gM},get InlineValueText(){return fM},get InlineValueVariableLookup(){return pM},get InsertReplaceEdit(){return BA},get InsertTextFormat(){return HA},get InsertTextMode(){return UA},get Location(){return M_},get LocationLink(){return TA},get MarkedString(){return N_},get MarkupContent(){return nm},get MarkupKind(){return wE},get OptionalVersionedTextDocumentIdentifier(){return O_},get ParameterInformation(){return KA},get Position(){return $o},get Range(){return On},get RenameFile(){return tm},get SelectionRange(){return dM},get SemanticTokenModifiers(){return uM},get SemanticTokenTypes(){return lM},get SemanticTokens(){return hM},get SignatureInformation(){return QA},get SymbolInformation(){return eM},get SymbolKind(){return JA},get SymbolTag(){return ZA},get TextDocument(){return _M},get TextDocumentEdit(){return F_},get TextDocumentIdentifier(){return OA},get TextDocumentItem(){return $A},get TextEdit(){return gc},get URI(){return mE},get VersionedTextDocumentIdentifier(){return NA},WorkspaceChange:Qre,get WorkspaceEdit(){return _E},get WorkspaceFolder(){return yM},get WorkspaceSymbol(){return tM},get integer(){return kA},get uinteger(){return A_}},Symbol.toStringTag,{value:"Module"})),W1=lq(Jre);var xn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ProtocolNotificationType=r.ProtocolNotificationType0=r.ProtocolRequestType=r.ProtocolRequestType0=r.RegistrationType=r.MessageDirection=void 0;const e=Uf;(function(a){a.clientToServer="clientToServer",a.serverToClient="serverToClient",a.both="both"})(r.MessageDirection||(r.MessageDirection={}));class t{constructor(c){this.method=c}}r.RegistrationType=t;class i extends e.RequestType0{constructor(c){super(c)}}r.ProtocolRequestType0=i;class n extends e.RequestType{constructor(c){super(c,e.ParameterStructures.byName)}}r.ProtocolRequestType=n;class s extends e.NotificationType0{constructor(c){super(c)}}r.ProtocolNotificationType0=s;class o extends e.NotificationType{constructor(c){super(c,e.ParameterStructures.byName)}}r.ProtocolNotificationType=o})(xn);var Pz={},Mn={};Object.defineProperty(Mn,"__esModule",{value:!0});Mn.objectLiteral=Mn.typedArray=Mn.stringArray=Mn.array=Mn.func=Mn.error=Mn.number=Mn.string=Mn.boolean=void 0;function Zre(r){return r===!0||r===!1}Mn.boolean=Zre;function Az(r){return typeof r=="string"||r instanceof String}Mn.string=Az;function ese(r){return typeof r=="number"||r instanceof Number}Mn.number=ese;function tse(r){return r instanceof Error}Mn.error=tse;function ise(r){return typeof r=="function"}Mn.func=ise;function Mz(r){return Array.isArray(r)}Mn.array=Mz;function nse(r){return Mz(r)&&r.every(e=>Az(e))}Mn.stringArray=nse;function rse(r,e){return Array.isArray(r)&&r.every(e)}Mn.typedArray=rse;function sse(r){return r!==null&&typeof r=="object"}Mn.objectLiteral=sse;var Lz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ImplementationRequest=void 0;const e=xn;(function(t){t.method="textDocument/implementation",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.ImplementationRequest||(r.ImplementationRequest={}))})(Lz);var Fz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.TypeDefinitionRequest=void 0;const e=xn;(function(t){t.method="textDocument/typeDefinition",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.TypeDefinitionRequest||(r.TypeDefinitionRequest={}))})(Fz);var Oz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DidChangeWorkspaceFoldersNotification=r.WorkspaceFoldersRequest=void 0;const e=xn;(function(t){t.method="workspace/workspaceFolders",t.messageDirection=e.MessageDirection.serverToClient,t.type=new e.ProtocolRequestType0(t.method)})(r.WorkspaceFoldersRequest||(r.WorkspaceFoldersRequest={})),function(t){t.method="workspace/didChangeWorkspaceFolders",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolNotificationType(t.method)}(r.DidChangeWorkspaceFoldersNotification||(r.DidChangeWorkspaceFoldersNotification={}))})(Oz);var Nz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ConfigurationRequest=void 0;const e=xn;(function(t){t.method="workspace/configuration",t.messageDirection=e.MessageDirection.serverToClient,t.type=new e.ProtocolRequestType(t.method)})(r.ConfigurationRequest||(r.ConfigurationRequest={}))})(Nz);var $z={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ColorPresentationRequest=r.DocumentColorRequest=void 0;const e=xn;(function(t){t.method="textDocument/documentColor",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.DocumentColorRequest||(r.DocumentColorRequest={})),function(t){t.method="textDocument/colorPresentation",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.ColorPresentationRequest||(r.ColorPresentationRequest={}))})($z);var Wz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.FoldingRangeRequest=void 0;const e=xn;(function(t){t.method="textDocument/foldingRange",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.FoldingRangeRequest||(r.FoldingRangeRequest={}))})(Wz);var Hz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DeclarationRequest=void 0;const e=xn;(function(t){t.method="textDocument/declaration",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.DeclarationRequest||(r.DeclarationRequest={}))})(Hz);var jz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionRangeRequest=void 0;const e=xn;(function(t){t.method="textDocument/selectionRange",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.SelectionRangeRequest||(r.SelectionRangeRequest={}))})(jz);var Bz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkDoneProgressCancelNotification=r.WorkDoneProgressCreateRequest=r.WorkDoneProgress=void 0;const e=Uf,t=xn;(function(i){i.type=new e.ProgressType;function n(s){return s===i.type}i.is=n})(r.WorkDoneProgress||(r.WorkDoneProgress={})),function(i){i.method="window/workDoneProgress/create",i.messageDirection=t.MessageDirection.serverToClient,i.type=new t.ProtocolRequestType(i.method)}(r.WorkDoneProgressCreateRequest||(r.WorkDoneProgressCreateRequest={})),function(i){i.method="window/workDoneProgress/cancel",i.messageDirection=t.MessageDirection.clientToServer,i.type=new t.ProtocolNotificationType(i.method)}(r.WorkDoneProgressCancelNotification||(r.WorkDoneProgressCancelNotification={}))})(Bz);var Uz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CallHierarchyOutgoingCallsRequest=r.CallHierarchyIncomingCallsRequest=r.CallHierarchyPrepareRequest=void 0;const e=xn;(function(t){t.method="textDocument/prepareCallHierarchy",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.CallHierarchyPrepareRequest||(r.CallHierarchyPrepareRequest={})),function(t){t.method="callHierarchy/incomingCalls",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.CallHierarchyIncomingCallsRequest||(r.CallHierarchyIncomingCallsRequest={})),function(t){t.method="callHierarchy/outgoingCalls",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.CallHierarchyOutgoingCallsRequest||(r.CallHierarchyOutgoingCallsRequest={}))})(Uz);var Vz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SemanticTokensRefreshRequest=r.SemanticTokensRangeRequest=r.SemanticTokensDeltaRequest=r.SemanticTokensRequest=r.SemanticTokensRegistrationType=r.TokenFormat=void 0;const e=xn;(function(i){i.Relative="relative"})(r.TokenFormat||(r.TokenFormat={}));var t;(function(i){i.method="textDocument/semanticTokens",i.type=new e.RegistrationType(i.method)})(t=r.SemanticTokensRegistrationType||(r.SemanticTokensRegistrationType={})),function(i){i.method="textDocument/semanticTokens/full",i.messageDirection=e.MessageDirection.clientToServer,i.type=new e.ProtocolRequestType(i.method),i.registrationMethod=t.method}(r.SemanticTokensRequest||(r.SemanticTokensRequest={})),function(i){i.method="textDocument/semanticTokens/full/delta",i.messageDirection=e.MessageDirection.clientToServer,i.type=new e.ProtocolRequestType(i.method),i.registrationMethod=t.method}(r.SemanticTokensDeltaRequest||(r.SemanticTokensDeltaRequest={})),function(i){i.method="textDocument/semanticTokens/range",i.messageDirection=e.MessageDirection.clientToServer,i.type=new e.ProtocolRequestType(i.method),i.registrationMethod=t.method}(r.SemanticTokensRangeRequest||(r.SemanticTokensRangeRequest={})),function(i){i.method="workspace/semanticTokens/refresh",i.messageDirection=e.MessageDirection.serverToClient,i.type=new e.ProtocolRequestType0(i.method)}(r.SemanticTokensRefreshRequest||(r.SemanticTokensRefreshRequest={}))})(Vz);var qz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ShowDocumentRequest=void 0;const e=xn;(function(t){t.method="window/showDocument",t.messageDirection=e.MessageDirection.serverToClient,t.type=new e.ProtocolRequestType(t.method)})(r.ShowDocumentRequest||(r.ShowDocumentRequest={}))})(qz);var Gz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.LinkedEditingRangeRequest=void 0;const e=xn;(function(t){t.method="textDocument/linkedEditingRange",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.LinkedEditingRangeRequest||(r.LinkedEditingRangeRequest={}))})(Gz);var zz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WillDeleteFilesRequest=r.DidDeleteFilesNotification=r.DidRenameFilesNotification=r.WillRenameFilesRequest=r.DidCreateFilesNotification=r.WillCreateFilesRequest=r.FileOperationPatternKind=void 0;const e=xn;(function(t){t.file="file",t.folder="folder"})(r.FileOperationPatternKind||(r.FileOperationPatternKind={})),function(t){t.method="workspace/willCreateFiles",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.WillCreateFilesRequest||(r.WillCreateFilesRequest={})),function(t){t.method="workspace/didCreateFiles",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolNotificationType(t.method)}(r.DidCreateFilesNotification||(r.DidCreateFilesNotification={})),function(t){t.method="workspace/willRenameFiles",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.WillRenameFilesRequest||(r.WillRenameFilesRequest={})),function(t){t.method="workspace/didRenameFiles",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolNotificationType(t.method)}(r.DidRenameFilesNotification||(r.DidRenameFilesNotification={})),function(t){t.method="workspace/didDeleteFiles",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolNotificationType(t.method)}(r.DidDeleteFilesNotification||(r.DidDeleteFilesNotification={})),function(t){t.method="workspace/willDeleteFiles",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.WillDeleteFilesRequest||(r.WillDeleteFilesRequest={}))})(zz);var Kz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.MonikerRequest=r.MonikerKind=r.UniquenessLevel=void 0;const e=xn;(function(t){t.document="document",t.project="project",t.group="group",t.scheme="scheme",t.global="global"})(r.UniquenessLevel||(r.UniquenessLevel={})),function(t){t.$import="import",t.$export="export",t.local="local"}(r.MonikerKind||(r.MonikerKind={})),function(t){t.method="textDocument/moniker",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.MonikerRequest||(r.MonikerRequest={}))})(Kz);var Qz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.TypeHierarchySubtypesRequest=r.TypeHierarchySupertypesRequest=r.TypeHierarchyPrepareRequest=void 0;const e=xn;(function(t){t.method="textDocument/prepareTypeHierarchy",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.TypeHierarchyPrepareRequest||(r.TypeHierarchyPrepareRequest={})),function(t){t.method="typeHierarchy/supertypes",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.TypeHierarchySupertypesRequest||(r.TypeHierarchySupertypesRequest={})),function(t){t.method="typeHierarchy/subtypes",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.TypeHierarchySubtypesRequest||(r.TypeHierarchySubtypesRequest={}))})(Qz);var Yz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.InlineValueRefreshRequest=r.InlineValueRequest=void 0;const e=xn;(function(t){t.method="textDocument/inlineValue",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.InlineValueRequest||(r.InlineValueRequest={})),function(t){t.method="workspace/inlineValue/refresh",t.messageDirection=e.MessageDirection.serverToClient,t.type=new e.ProtocolRequestType0(t.method)}(r.InlineValueRefreshRequest||(r.InlineValueRefreshRequest={}))})(Yz);var Xz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.InlayHintRefreshRequest=r.InlayHintResolveRequest=r.InlayHintRequest=void 0;const e=xn;(function(t){t.method="textDocument/inlayHint",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)})(r.InlayHintRequest||(r.InlayHintRequest={})),function(t){t.method="inlayHint/resolve",t.messageDirection=e.MessageDirection.clientToServer,t.type=new e.ProtocolRequestType(t.method)}(r.InlayHintResolveRequest||(r.InlayHintResolveRequest={})),function(t){t.method="workspace/inlayHint/refresh",t.messageDirection=e.MessageDirection.serverToClient,t.type=new e.ProtocolRequestType0(t.method)}(r.InlayHintRefreshRequest||(r.InlayHintRefreshRequest={}))})(Xz);var Jz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DiagnosticRefreshRequest=r.WorkspaceDiagnosticRequest=r.DocumentDiagnosticRequest=r.DocumentDiagnosticReportKind=r.DiagnosticServerCancellationData=void 0;const e=Uf,t=Mn,i=xn;(function(n){function s(o){const a=o;return a&&t.boolean(a.retriggerRequest)}n.is=s})(r.DiagnosticServerCancellationData||(r.DiagnosticServerCancellationData={})),function(n){n.Full="full",n.Unchanged="unchanged"}(r.DocumentDiagnosticReportKind||(r.DocumentDiagnosticReportKind={})),function(n){n.method="textDocument/diagnostic",n.messageDirection=i.MessageDirection.clientToServer,n.type=new i.ProtocolRequestType(n.method),n.partialResult=new e.ProgressType}(r.DocumentDiagnosticRequest||(r.DocumentDiagnosticRequest={})),function(n){n.method="workspace/diagnostic",n.messageDirection=i.MessageDirection.clientToServer,n.type=new i.ProtocolRequestType(n.method),n.partialResult=new e.ProgressType}(r.WorkspaceDiagnosticRequest||(r.WorkspaceDiagnosticRequest={})),function(n){n.method="workspace/diagnostic/refresh",n.messageDirection=i.MessageDirection.serverToClient,n.type=new i.ProtocolRequestType0(n.method)}(r.DiagnosticRefreshRequest||(r.DiagnosticRefreshRequest={}))})(Jz);var Zz={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DidCloseNotebookDocumentNotification=r.DidSaveNotebookDocumentNotification=r.DidChangeNotebookDocumentNotification=r.NotebookCellArrayChange=r.DidOpenNotebookDocumentNotification=r.NotebookDocumentSyncRegistrationType=r.NotebookDocument=r.NotebookCell=r.ExecutionSummary=r.NotebookCellKind=void 0;const e=W1,t=Mn,i=xn;var n;(function(c){c.Markup=1,c.Code=2;function d(l){return l===1||l===2}c.is=d})(n=r.NotebookCellKind||(r.NotebookCellKind={}));var s;(function(c){function d(h,g){const m={executionOrder:h};return(g===!0||g===!1)&&(m.success=g),m}c.create=d;function l(h){const g=h;return t.objectLiteral(g)&&e.uinteger.is(g.executionOrder)&&(g.success===void 0||t.boolean(g.success))}c.is=l;function u(h,g){return h===g?!0:h==null||g===null||g===void 0?!1:h.executionOrder===g.executionOrder&&h.success===g.success}c.equals=u})(s=r.ExecutionSummary||(r.ExecutionSummary={}));var o;(function(c){function d(g,m){return{kind:g,document:m}}c.create=d;function l(g){const m=g;return t.objectLiteral(m)&&n.is(m.kind)&&e.DocumentUri.is(m.document)&&(m.metadata===void 0||t.objectLiteral(m.metadata))}c.is=l;function u(g,m){const y=new Set;return g.document!==m.document&&y.add("document"),g.kind!==m.kind&&y.add("kind"),g.executionSummary!==m.executionSummary&&y.add("executionSummary"),(g.metadata!==void 0||m.metadata!==void 0)&&!h(g.metadata,m.metadata)&&y.add("metadata"),(g.executionSummary!==void 0||m.executionSummary!==void 0)&&!s.equals(g.executionSummary,m.executionSummary)&&y.add("executionSummary"),y}c.diff=u;function h(g,m){if(g===m)return!0;if(g==null||m===null||m===void 0||typeof g!=typeof m||typeof g!="object")return!1;const y=Array.isArray(g),_=Array.isArray(m);if(y!==_)return!1;if(y&&_){if(g.length!==m.length)return!1;for(let b=0;b<g.length;b++)if(!h(g[b],m[b]))return!1}if(t.objectLiteral(g)&&t.objectLiteral(m)){const b=Object.keys(g),E=Object.keys(m);if(b.length!==E.length||(b.sort(),E.sort(),!h(b,E)))return!1;for(let D=0;D<b.length;D++){const R=b[D];if(!h(g[R],m[R]))return!1}}return!0}})(o=r.NotebookCell||(r.NotebookCell={})),function(c){function d(u,h,g,m){return{uri:u,notebookType:h,version:g,cells:m}}c.create=d;function l(u){const h=u;return t.objectLiteral(h)&&t.string(h.uri)&&e.integer.is(h.version)&&t.typedArray(h.cells,o.is)}c.is=l}(r.NotebookDocument||(r.NotebookDocument={}));var a;(function(c){c.method="notebookDocument/sync",c.messageDirection=i.MessageDirection.clientToServer,c.type=new i.RegistrationType(c.method)})(a=r.NotebookDocumentSyncRegistrationType||(r.NotebookDocumentSyncRegistrationType={})),function(c){c.method="notebookDocument/didOpen",c.messageDirection=i.MessageDirection.clientToServer,c.type=new i.ProtocolNotificationType(c.method),c.registrationMethod=a.method}(r.DidOpenNotebookDocumentNotification||(r.DidOpenNotebookDocumentNotification={})),function(c){function d(u){const h=u;return t.objectLiteral(h)&&e.uinteger.is(h.start)&&e.uinteger.is(h.deleteCount)&&(h.cells===void 0||t.typedArray(h.cells,o.is))}c.is=d;function l(u,h,g){const m={start:u,deleteCount:h};return g!==void 0&&(m.cells=g),m}c.create=l}(r.NotebookCellArrayChange||(r.NotebookCellArrayChange={})),function(c){c.method="notebookDocument/didChange",c.messageDirection=i.MessageDirection.clientToServer,c.type=new i.ProtocolNotificationType(c.method),c.registrationMethod=a.method}(r.DidChangeNotebookDocumentNotification||(r.DidChangeNotebookDocumentNotification={})),function(c){c.method="notebookDocument/didSave",c.messageDirection=i.MessageDirection.clientToServer,c.type=new i.ProtocolNotificationType(c.method),c.registrationMethod=a.method}(r.DidSaveNotebookDocumentNotification||(r.DidSaveNotebookDocumentNotification={})),function(c){c.method="notebookDocument/didClose",c.messageDirection=i.MessageDirection.clientToServer,c.type=new i.ProtocolNotificationType(c.method),c.registrationMethod=a.method}(r.DidCloseNotebookDocumentNotification||(r.DidCloseNotebookDocumentNotification={}))})(Zz);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkspaceSymbolRequest=r.CodeActionResolveRequest=r.CodeActionRequest=r.DocumentSymbolRequest=r.DocumentHighlightRequest=r.ReferencesRequest=r.DefinitionRequest=r.SignatureHelpRequest=r.SignatureHelpTriggerKind=r.HoverRequest=r.CompletionResolveRequest=r.CompletionRequest=r.CompletionTriggerKind=r.PublishDiagnosticsNotification=r.WatchKind=r.RelativePattern=r.FileChangeType=r.DidChangeWatchedFilesNotification=r.WillSaveTextDocumentWaitUntilRequest=r.WillSaveTextDocumentNotification=r.TextDocumentSaveReason=r.DidSaveTextDocumentNotification=r.DidCloseTextDocumentNotification=r.DidChangeTextDocumentNotification=r.TextDocumentContentChangeEvent=r.DidOpenTextDocumentNotification=r.TextDocumentSyncKind=r.TelemetryEventNotification=r.LogMessageNotification=r.ShowMessageRequest=r.ShowMessageNotification=r.MessageType=r.DidChangeConfigurationNotification=r.ExitNotification=r.ShutdownRequest=r.InitializedNotification=r.InitializeErrorCodes=r.InitializeRequest=r.WorkDoneProgressOptions=r.TextDocumentRegistrationOptions=r.StaticRegistrationOptions=r.PositionEncodingKind=r.FailureHandlingKind=r.ResourceOperationKind=r.UnregistrationRequest=r.RegistrationRequest=r.DocumentSelector=r.NotebookCellTextDocumentFilter=r.NotebookDocumentFilter=r.TextDocumentFilter=void 0,r.TypeHierarchySubtypesRequest=r.TypeHierarchyPrepareRequest=r.MonikerRequest=r.MonikerKind=r.UniquenessLevel=r.WillDeleteFilesRequest=r.DidDeleteFilesNotification=r.WillRenameFilesRequest=r.DidRenameFilesNotification=r.WillCreateFilesRequest=r.DidCreateFilesNotification=r.FileOperationPatternKind=r.LinkedEditingRangeRequest=r.ShowDocumentRequest=r.SemanticTokensRegistrationType=r.SemanticTokensRefreshRequest=r.SemanticTokensRangeRequest=r.SemanticTokensDeltaRequest=r.SemanticTokensRequest=r.TokenFormat=r.CallHierarchyPrepareRequest=r.CallHierarchyOutgoingCallsRequest=r.CallHierarchyIncomingCallsRequest=r.WorkDoneProgressCancelNotification=r.WorkDoneProgressCreateRequest=r.WorkDoneProgress=r.SelectionRangeRequest=r.DeclarationRequest=r.FoldingRangeRequest=r.ColorPresentationRequest=r.DocumentColorRequest=r.ConfigurationRequest=r.DidChangeWorkspaceFoldersNotification=r.WorkspaceFoldersRequest=r.TypeDefinitionRequest=r.ImplementationRequest=r.ApplyWorkspaceEditRequest=r.ExecuteCommandRequest=r.PrepareRenameRequest=r.RenameRequest=r.PrepareSupportDefaultBehavior=r.DocumentOnTypeFormattingRequest=r.DocumentRangeFormattingRequest=r.DocumentFormattingRequest=r.DocumentLinkResolveRequest=r.DocumentLinkRequest=r.CodeLensRefreshRequest=r.CodeLensResolveRequest=r.CodeLensRequest=r.WorkspaceSymbolResolveRequest=void 0,r.DidCloseNotebookDocumentNotification=r.DidSaveNotebookDocumentNotification=r.DidChangeNotebookDocumentNotification=r.NotebookCellArrayChange=r.DidOpenNotebookDocumentNotification=r.NotebookDocumentSyncRegistrationType=r.NotebookDocument=r.NotebookCell=r.ExecutionSummary=r.NotebookCellKind=r.DiagnosticRefreshRequest=r.WorkspaceDiagnosticRequest=r.DocumentDiagnosticRequest=r.DocumentDiagnosticReportKind=r.DiagnosticServerCancellationData=r.InlayHintRefreshRequest=r.InlayHintResolveRequest=r.InlayHintRequest=r.InlineValueRefreshRequest=r.InlineValueRequest=r.TypeHierarchySupertypesRequest=void 0;const e=xn,t=W1,i=Mn,n=Lz;Object.defineProperty(r,"ImplementationRequest",{enumerable:!0,get:function(){return n.ImplementationRequest}});const s=Fz;Object.defineProperty(r,"TypeDefinitionRequest",{enumerable:!0,get:function(){return s.TypeDefinitionRequest}});const o=Oz;Object.defineProperty(r,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return o.WorkspaceFoldersRequest}}),Object.defineProperty(r,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return o.DidChangeWorkspaceFoldersNotification}});const a=Nz;Object.defineProperty(r,"ConfigurationRequest",{enumerable:!0,get:function(){return a.ConfigurationRequest}});const c=$z;Object.defineProperty(r,"DocumentColorRequest",{enumerable:!0,get:function(){return c.DocumentColorRequest}}),Object.defineProperty(r,"ColorPresentationRequest",{enumerable:!0,get:function(){return c.ColorPresentationRequest}});const d=Wz;Object.defineProperty(r,"FoldingRangeRequest",{enumerable:!0,get:function(){return d.FoldingRangeRequest}});const l=Hz;Object.defineProperty(r,"DeclarationRequest",{enumerable:!0,get:function(){return l.DeclarationRequest}});const u=jz;Object.defineProperty(r,"SelectionRangeRequest",{enumerable:!0,get:function(){return u.SelectionRangeRequest}});const h=Bz;Object.defineProperty(r,"WorkDoneProgress",{enumerable:!0,get:function(){return h.WorkDoneProgress}}),Object.defineProperty(r,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return h.WorkDoneProgressCreateRequest}}),Object.defineProperty(r,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return h.WorkDoneProgressCancelNotification}});const g=Uz;Object.defineProperty(r,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return g.CallHierarchyIncomingCallsRequest}}),Object.defineProperty(r,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return g.CallHierarchyOutgoingCallsRequest}}),Object.defineProperty(r,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return g.CallHierarchyPrepareRequest}});const m=Vz;Object.defineProperty(r,"TokenFormat",{enumerable:!0,get:function(){return m.TokenFormat}}),Object.defineProperty(r,"SemanticTokensRequest",{enumerable:!0,get:function(){return m.SemanticTokensRequest}}),Object.defineProperty(r,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return m.SemanticTokensDeltaRequest}}),Object.defineProperty(r,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return m.SemanticTokensRangeRequest}}),Object.defineProperty(r,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return m.SemanticTokensRefreshRequest}}),Object.defineProperty(r,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return m.SemanticTokensRegistrationType}});const y=qz;Object.defineProperty(r,"ShowDocumentRequest",{enumerable:!0,get:function(){return y.ShowDocumentRequest}});const _=Gz;Object.defineProperty(r,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return _.LinkedEditingRangeRequest}});const b=zz;Object.defineProperty(r,"FileOperationPatternKind",{enumerable:!0,get:function(){return b.FileOperationPatternKind}}),Object.defineProperty(r,"DidCreateFilesNotification",{enumerable:!0,get:function(){return b.DidCreateFilesNotification}}),Object.defineProperty(r,"WillCreateFilesRequest",{enumerable:!0,get:function(){return b.WillCreateFilesRequest}}),Object.defineProperty(r,"DidRenameFilesNotification",{enumerable:!0,get:function(){return b.DidRenameFilesNotification}}),Object.defineProperty(r,"WillRenameFilesRequest",{enumerable:!0,get:function(){return b.WillRenameFilesRequest}}),Object.defineProperty(r,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return b.DidDeleteFilesNotification}}),Object.defineProperty(r,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return b.WillDeleteFilesRequest}});const E=Kz;Object.defineProperty(r,"UniquenessLevel",{enumerable:!0,get:function(){return E.UniquenessLevel}}),Object.defineProperty(r,"MonikerKind",{enumerable:!0,get:function(){return E.MonikerKind}}),Object.defineProperty(r,"MonikerRequest",{enumerable:!0,get:function(){return E.MonikerRequest}});const D=Qz;Object.defineProperty(r,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return D.TypeHierarchyPrepareRequest}}),Object.defineProperty(r,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return D.TypeHierarchySubtypesRequest}}),Object.defineProperty(r,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return D.TypeHierarchySupertypesRequest}});const R=Yz;Object.defineProperty(r,"InlineValueRequest",{enumerable:!0,get:function(){return R.InlineValueRequest}}),Object.defineProperty(r,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return R.InlineValueRefreshRequest}});const M=Xz;Object.defineProperty(r,"InlayHintRequest",{enumerable:!0,get:function(){return M.InlayHintRequest}}),Object.defineProperty(r,"InlayHintResolveRequest",{enumerable:!0,get:function(){return M.InlayHintResolveRequest}}),Object.defineProperty(r,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return M.InlayHintRefreshRequest}});const O=Jz;Object.defineProperty(r,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return O.DiagnosticServerCancellationData}}),Object.defineProperty(r,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return O.DocumentDiagnosticReportKind}}),Object.defineProperty(r,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return O.DocumentDiagnosticRequest}}),Object.defineProperty(r,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return O.WorkspaceDiagnosticRequest}}),Object.defineProperty(r,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return O.DiagnosticRefreshRequest}});const L=Zz;Object.defineProperty(r,"NotebookCellKind",{enumerable:!0,get:function(){return L.NotebookCellKind}}),Object.defineProperty(r,"ExecutionSummary",{enumerable:!0,get:function(){return L.ExecutionSummary}}),Object.defineProperty(r,"NotebookCell",{enumerable:!0,get:function(){return L.NotebookCell}}),Object.defineProperty(r,"NotebookDocument",{enumerable:!0,get:function(){return L.NotebookDocument}}),Object.defineProperty(r,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return L.NotebookDocumentSyncRegistrationType}}),Object.defineProperty(r,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return L.DidOpenNotebookDocumentNotification}}),Object.defineProperty(r,"NotebookCellArrayChange",{enumerable:!0,get:function(){return L.NotebookCellArrayChange}}),Object.defineProperty(r,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return L.DidChangeNotebookDocumentNotification}}),Object.defineProperty(r,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return L.DidSaveNotebookDocumentNotification}}),Object.defineProperty(r,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return L.DidCloseNotebookDocumentNotification}});var W;(function(C){function B(te){const ue=te;return i.string(ue.language)||i.string(ue.scheme)||i.string(ue.pattern)}C.is=B})(W=r.TextDocumentFilter||(r.TextDocumentFilter={}));var Z;(function(C){function B(te){const ue=te;return i.objectLiteral(ue)&&(i.string(ue.notebookType)||i.string(ue.scheme)||i.string(ue.pattern))}C.is=B})(Z=r.NotebookDocumentFilter||(r.NotebookDocumentFilter={}));var K;(function(C){function B(te){const ue=te;return i.objectLiteral(ue)&&(i.string(ue.notebook)||Z.is(ue.notebook))&&(ue.language===void 0||i.string(ue.language))}C.is=B})(K=r.NotebookCellTextDocumentFilter||(r.NotebookCellTextDocumentFilter={}));var H;(function(C){function B(te){if(!Array.isArray(te))return!1;for(let ue of te)if(!i.string(ue)&&!W.is(ue)&&!K.is(ue))return!1;return!0}C.is=B})(H=r.DocumentSelector||(r.DocumentSelector={})),function(C){C.method="client/registerCapability",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolRequestType(C.method)}(r.RegistrationRequest||(r.RegistrationRequest={})),function(C){C.method="client/unregisterCapability",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolRequestType(C.method)}(r.UnregistrationRequest||(r.UnregistrationRequest={})),function(C){C.Create="create",C.Rename="rename",C.Delete="delete"}(r.ResourceOperationKind||(r.ResourceOperationKind={})),function(C){C.Abort="abort",C.Transactional="transactional",C.TextOnlyTransactional="textOnlyTransactional",C.Undo="undo"}(r.FailureHandlingKind||(r.FailureHandlingKind={})),function(C){C.UTF8="utf-8",C.UTF16="utf-16",C.UTF32="utf-32"}(r.PositionEncodingKind||(r.PositionEncodingKind={})),function(C){function B(te){const ue=te;return ue&&i.string(ue.id)&&ue.id.length>0}C.hasId=B}(r.StaticRegistrationOptions||(r.StaticRegistrationOptions={})),function(C){function B(te){const ue=te;return ue&&(ue.documentSelector===null||H.is(ue.documentSelector))}C.is=B}(r.TextDocumentRegistrationOptions||(r.TextDocumentRegistrationOptions={})),function(C){function B(ue){const be=ue;return i.objectLiteral(be)&&(be.workDoneProgress===void 0||i.boolean(be.workDoneProgress))}C.is=B;function te(ue){const be=ue;return be&&i.boolean(be.workDoneProgress)}C.hasWorkDoneProgress=te}(r.WorkDoneProgressOptions||(r.WorkDoneProgressOptions={})),function(C){C.method="initialize",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.InitializeRequest||(r.InitializeRequest={})),function(C){C.unknownProtocolVersion=1}(r.InitializeErrorCodes||(r.InitializeErrorCodes={})),function(C){C.method="initialized",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType(C.method)}(r.InitializedNotification||(r.InitializedNotification={})),function(C){C.method="shutdown",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType0(C.method)}(r.ShutdownRequest||(r.ShutdownRequest={})),function(C){C.method="exit",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType0(C.method)}(r.ExitNotification||(r.ExitNotification={})),function(C){C.method="workspace/didChangeConfiguration",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType(C.method)}(r.DidChangeConfigurationNotification||(r.DidChangeConfigurationNotification={})),function(C){C.Error=1,C.Warning=2,C.Info=3,C.Log=4}(r.MessageType||(r.MessageType={})),function(C){C.method="window/showMessage",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolNotificationType(C.method)}(r.ShowMessageNotification||(r.ShowMessageNotification={})),function(C){C.method="window/showMessageRequest",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolRequestType(C.method)}(r.ShowMessageRequest||(r.ShowMessageRequest={})),function(C){C.method="window/logMessage",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolNotificationType(C.method)}(r.LogMessageNotification||(r.LogMessageNotification={})),function(C){C.method="telemetry/event",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolNotificationType(C.method)}(r.TelemetryEventNotification||(r.TelemetryEventNotification={})),function(C){C.None=0,C.Full=1,C.Incremental=2}(r.TextDocumentSyncKind||(r.TextDocumentSyncKind={})),function(C){C.method="textDocument/didOpen",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType(C.method)}(r.DidOpenTextDocumentNotification||(r.DidOpenTextDocumentNotification={})),function(C){function B(ue){let be=ue;return be!=null&&typeof be.text=="string"&&be.range!==void 0&&(be.rangeLength===void 0||typeof be.rangeLength=="number")}C.isIncremental=B;function te(ue){let be=ue;return be!=null&&typeof be.text=="string"&&be.range===void 0&&be.rangeLength===void 0}C.isFull=te}(r.TextDocumentContentChangeEvent||(r.TextDocumentContentChangeEvent={})),function(C){C.method="textDocument/didChange",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType(C.method)}(r.DidChangeTextDocumentNotification||(r.DidChangeTextDocumentNotification={})),function(C){C.method="textDocument/didClose",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType(C.method)}(r.DidCloseTextDocumentNotification||(r.DidCloseTextDocumentNotification={})),function(C){C.method="textDocument/didSave",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType(C.method)}(r.DidSaveTextDocumentNotification||(r.DidSaveTextDocumentNotification={})),function(C){C.Manual=1,C.AfterDelay=2,C.FocusOut=3}(r.TextDocumentSaveReason||(r.TextDocumentSaveReason={})),function(C){C.method="textDocument/willSave",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType(C.method)}(r.WillSaveTextDocumentNotification||(r.WillSaveTextDocumentNotification={})),function(C){C.method="textDocument/willSaveWaitUntil",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.WillSaveTextDocumentWaitUntilRequest||(r.WillSaveTextDocumentWaitUntilRequest={})),function(C){C.method="workspace/didChangeWatchedFiles",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolNotificationType(C.method)}(r.DidChangeWatchedFilesNotification||(r.DidChangeWatchedFilesNotification={})),function(C){C.Created=1,C.Changed=2,C.Deleted=3}(r.FileChangeType||(r.FileChangeType={})),function(C){function B(te){const ue=te;return i.objectLiteral(ue)&&(t.URI.is(ue.baseUri)||t.WorkspaceFolder.is(ue.baseUri))&&i.string(ue.pattern)}C.is=B}(r.RelativePattern||(r.RelativePattern={})),function(C){C.Create=1,C.Change=2,C.Delete=4}(r.WatchKind||(r.WatchKind={})),function(C){C.method="textDocument/publishDiagnostics",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolNotificationType(C.method)}(r.PublishDiagnosticsNotification||(r.PublishDiagnosticsNotification={})),function(C){C.Invoked=1,C.TriggerCharacter=2,C.TriggerForIncompleteCompletions=3}(r.CompletionTriggerKind||(r.CompletionTriggerKind={})),function(C){C.method="textDocument/completion",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.CompletionRequest||(r.CompletionRequest={})),function(C){C.method="completionItem/resolve",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.CompletionResolveRequest||(r.CompletionResolveRequest={})),function(C){C.method="textDocument/hover",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.HoverRequest||(r.HoverRequest={})),function(C){C.Invoked=1,C.TriggerCharacter=2,C.ContentChange=3}(r.SignatureHelpTriggerKind||(r.SignatureHelpTriggerKind={})),function(C){C.method="textDocument/signatureHelp",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.SignatureHelpRequest||(r.SignatureHelpRequest={})),function(C){C.method="textDocument/definition",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.DefinitionRequest||(r.DefinitionRequest={})),function(C){C.method="textDocument/references",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.ReferencesRequest||(r.ReferencesRequest={})),function(C){C.method="textDocument/documentHighlight",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.DocumentHighlightRequest||(r.DocumentHighlightRequest={})),function(C){C.method="textDocument/documentSymbol",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.DocumentSymbolRequest||(r.DocumentSymbolRequest={})),function(C){C.method="textDocument/codeAction",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.CodeActionRequest||(r.CodeActionRequest={})),function(C){C.method="codeAction/resolve",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.CodeActionResolveRequest||(r.CodeActionResolveRequest={})),function(C){C.method="workspace/symbol",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.WorkspaceSymbolRequest||(r.WorkspaceSymbolRequest={})),function(C){C.method="workspaceSymbol/resolve",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.WorkspaceSymbolResolveRequest||(r.WorkspaceSymbolResolveRequest={})),function(C){C.method="textDocument/codeLens",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.CodeLensRequest||(r.CodeLensRequest={})),function(C){C.method="codeLens/resolve",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.CodeLensResolveRequest||(r.CodeLensResolveRequest={})),function(C){C.method="workspace/codeLens/refresh",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolRequestType0(C.method)}(r.CodeLensRefreshRequest||(r.CodeLensRefreshRequest={})),function(C){C.method="textDocument/documentLink",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.DocumentLinkRequest||(r.DocumentLinkRequest={})),function(C){C.method="documentLink/resolve",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.DocumentLinkResolveRequest||(r.DocumentLinkResolveRequest={})),function(C){C.method="textDocument/formatting",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.DocumentFormattingRequest||(r.DocumentFormattingRequest={})),function(C){C.method="textDocument/rangeFormatting",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.DocumentRangeFormattingRequest||(r.DocumentRangeFormattingRequest={})),function(C){C.method="textDocument/onTypeFormatting",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.DocumentOnTypeFormattingRequest||(r.DocumentOnTypeFormattingRequest={})),function(C){C.Identifier=1}(r.PrepareSupportDefaultBehavior||(r.PrepareSupportDefaultBehavior={})),function(C){C.method="textDocument/rename",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.RenameRequest||(r.RenameRequest={})),function(C){C.method="textDocument/prepareRename",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.PrepareRenameRequest||(r.PrepareRenameRequest={})),function(C){C.method="workspace/executeCommand",C.messageDirection=e.MessageDirection.clientToServer,C.type=new e.ProtocolRequestType(C.method)}(r.ExecuteCommandRequest||(r.ExecuteCommandRequest={})),function(C){C.method="workspace/applyEdit",C.messageDirection=e.MessageDirection.serverToClient,C.type=new e.ProtocolRequestType("workspace/applyEdit")}(r.ApplyWorkspaceEditRequest||(r.ApplyWorkspaceEditRequest={}))})(Pz);var Vk={};Object.defineProperty(Vk,"__esModule",{value:!0});Vk.createProtocolConnection=void 0;const nj=Uf;function ose(r,e,t,i){return nj.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),(0,nj.createMessageConnection)(r,e,t,i)}Vk.createProtocolConnection=ose;(function(r){var e=Jn&&Jn.__createBinding||(Object.create?function(n,s,o,a){a===void 0&&(a=o);var c=Object.getOwnPropertyDescriptor(s,o);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(n,a,c)}:function(n,s,o,a){a===void 0&&(a=o),n[a]=s[o]}),t=Jn&&Jn.__exportStar||function(n,s){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,n,o)};Object.defineProperty(r,"__esModule",{value:!0}),r.LSPErrorCodes=r.createProtocolConnection=void 0,t(Uf,r),t(W1,r),t(xn,r),t(Pz,r);var i=Vk;Object.defineProperty(r,"createProtocolConnection",{enumerable:!0,get:function(){return i.createProtocolConnection}}),function(n){n.lspReservedErrorRangeStart=-32899,n.RequestFailed=-32803,n.ServerCancelled=-32802,n.ContentModified=-32801,n.RequestCancelled=-32800,n.lspReservedErrorRangeEnd=-32800}(r.LSPErrorCodes||(r.LSPErrorCodes={}))})(Rz);(function(r){var e=Jn&&Jn.__createBinding||(Object.create?function(s,o,a,c){c===void 0&&(c=a);var d=Object.getOwnPropertyDescriptor(o,a);(!d||("get"in d?!o.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,d)}:function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]}),t=Jn&&Jn.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&e(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),r.createProtocolConnection=void 0;const i=tj;t(tj,r),t(Rz,r);function n(s,o,a,c){return(0,i.createMessageConnection)(s,o,a,c)}r.createProtocolConnection=n})(Lt);var qk={},Ni={};Object.defineProperty(Ni,"__esModule",{value:!0});Ni.asPromise=Ni.thenable=Ni.typedArray=Ni.stringArray=Ni.array=Ni.func=Ni.error=Ni.number=Ni.string=Ni.boolean=void 0;function ase(r){return r===!0||r===!1}Ni.boolean=ase;function eK(r){return typeof r=="string"||r instanceof String}Ni.string=eK;function cse(r){return typeof r=="number"||r instanceof Number}Ni.number=cse;function dse(r){return r instanceof Error}Ni.error=dse;function tK(r){return typeof r=="function"}Ni.func=tK;function iK(r){return Array.isArray(r)}Ni.array=iK;function lse(r){return iK(r)&&r.every(e=>eK(e))}Ni.stringArray=lse;function use(r,e){return Array.isArray(r)&&r.every(e)}Ni.typedArray=use;function nK(r){return r&&tK(r.then)}Ni.thenable=nK;function hse(r){return r instanceof Promise?r:nK(r)?new Promise((e,t)=>{r.then(i=>e(i),i=>t(i))}):Promise.resolve(r)}Ni.asPromise=hse;var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});Dr.forEach=Dr.mapAsync=Dr.map=Dr.clearTestMode=Dr.setTestMode=Dr.Semaphore=Dr.Delayer=void 0;const sb=Lt;class fse{constructor(e){this.defaultDelay=e,this.timeout=void 0,this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0}trigger(e,t=this.defaultDelay){return this.task=e,t>=0&&this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise(i=>{this.onSuccess=i}).then(()=>{this.completionPromise=void 0,this.onSuccess=void 0;var i=this.task();return this.task=void 0,i})),(t>=0||this.timeout===void 0)&&(this.timeout=(0,sb.RAL)().timer.setTimeout(()=>{this.timeout=void 0,this.onSuccess(void 0)},t>=0?t:this.defaultDelay)),this.completionPromise}forceDelivery(){if(!this.completionPromise)return;this.cancelTimeout();let e=this.task();return this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0,e}isTriggered(){return this.timeout!==void 0}cancel(){this.cancelTimeout(),this.completionPromise=void 0}cancelTimeout(){this.timeout!==void 0&&(this.timeout.dispose(),this.timeout=void 0)}}Dr.Delayer=fse;class pse{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,i)=>{this._waiting.push({thunk:e,resolve:t,reject:i}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,sb.RAL)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;const e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{const t=e.thunk();t instanceof Promise?t.then(i=>{this._active--,e.resolve(i),this.runNext()},i=>{this._active--,e.reject(i),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}}Dr.Semaphore=pse;let H1=!1;function gse(){H1=!0}Dr.setTestMode=gse;function mse(){H1=!1}Dr.clearTestMode=mse;const rj=15;class j1{constructor(e=rj){this.yieldAfter=H1===!0?Math.max(e,2):Math.max(e,rj),this.startTime=Date.now(),this.counter=0,this.total=0,this.counterInterval=1}start(){this.counter=0,this.total=0,this.counterInterval=1,this.startTime=Date.now()}shouldYield(){if(++this.counter>=this.counterInterval){const e=Date.now()-this.startTime,t=Math.max(0,this.yieldAfter-e);if(this.total+=this.counter,this.counter=0,e>=this.yieldAfter||t<=1)return this.counterInterval=1,this.total=0,!0;switch(e){case 0:case 1:this.counterInterval=this.total*2;break}}return!1}}async function vse(r,e,t,i){if(r.length===0)return[];const n=new Array(r.length),s=new j1(i==null?void 0:i.yieldAfter);function o(c){s.start();for(let d=c;d<r.length;d++)if(n[d]=e(r[d]),s.shouldYield())return i!=null&&i.yieldCallback&&i.yieldCallback(),d+1;return-1}let a=o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,sb.RAL)().timer.setImmediate(()=>{c(o(a))})});return n}Dr.map=vse;async function yse(r,e,t,i){if(r.length===0)return[];const n=new Array(r.length),s=new j1(i==null?void 0:i.yieldAfter);async function o(c){s.start();for(let d=c;d<r.length;d++)if(n[d]=await e(r[d],t),s.shouldYield())return i!=null&&i.yieldCallback&&i.yieldCallback(),d+1;return-1}let a=await o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,sb.RAL)().timer.setImmediate(()=>{c(o(a))})});return n}Dr.mapAsync=yse;async function _se(r,e,t,i){if(r.length===0)return;const n=new j1(i==null?void 0:i.yieldAfter);function s(a){n.start();for(let c=a;c<r.length;c++)if(e(r[c]),n.shouldYield())return i!=null&&i.yieldCallback&&i.yieldCallback(),c+1;return-1}let o=s(0);for(;o!==-1&&!(t!==void 0&&t.isCancellationRequested);)o=await new Promise(a=>{(0,sb.RAL)().timer.setImmediate(()=>{a(s(o))})})}Dr.forEach=_se;var Gk={};Object.defineProperty(Gk,"__esModule",{value:!0});const wse=Dt;class bse extends wse.CompletionItem{constructor(e){super(e)}}Gk.default=bse;var zk={};Object.defineProperty(zk,"__esModule",{value:!0});const Sse=Dt;class Cse extends Sse.CodeLens{constructor(e){super(e)}}zk.default=Cse;var Kk={};Object.defineProperty(Kk,"__esModule",{value:!0});const Ese=Dt;class xse extends Ese.DocumentLink{constructor(e,t){super(e,t)}}Kk.default=xse;var Qk={};Object.defineProperty(Qk,"__esModule",{value:!0});const Dse=Dt;class kse extends Dse.CodeAction{constructor(e,t){super(e),this.data=t}}Qk.default=kse;var B1={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ProtocolDiagnostic=r.DiagnosticCode=void 0;const e=Dt,t=Ni;(function(n){function s(o){const a=o;return a!=null&&(t.number(a.value)||t.string(a.value))&&t.string(a.target)}n.is=s})(r.DiagnosticCode||(r.DiagnosticCode={}));class i extends e.Diagnostic{constructor(s,o,a,c){super(s,o,a),this.data=c,this.hasDiagnosticCode=!1}}r.ProtocolDiagnostic=i})(B1);var Yk={};Object.defineProperty(Yk,"__esModule",{value:!0});const Tse=Dt;class Ise extends Tse.CallHierarchyItem{constructor(e,t,i,n,s,o,a){super(e,t,i,n,s,o),a!==void 0&&(this.data=a)}}Yk.default=Ise;var Xk={};Object.defineProperty(Xk,"__esModule",{value:!0});const Rse=Dt;class Pse extends Rse.TypeHierarchyItem{constructor(e,t,i,n,s,o,a){super(e,t,i,n,s,o),a!==void 0&&(this.data=a)}}Xk.default=Pse;var Jk={};Object.defineProperty(Jk,"__esModule",{value:!0});const Wb=Dt;let Ase=class extends Wb.SymbolInformation{constructor(e,t,i,n,s){const o=!(n instanceof Wb.Uri);super(e,t,i,o?n:new Wb.Location(n,new Wb.Range(0,0,0,0))),this.hasRange=o,s!==void 0&&(this.data=s)}};Jk.default=Ase;var Zk={};Object.defineProperty(Zk,"__esModule",{value:!0});const Mse=Dt;class Lse extends Mse.InlayHint{constructor(e,t,i){super(e,t,i)}}Zk.default=Lse;Object.defineProperty(qk,"__esModule",{value:!0});qk.createConverter=void 0;const zn=Dt,Ht=Lt,sp=Ni,sj=Dr,Fse=Gk,Ose=zk,Nse=Kk,$se=Qk,oj=B1,Wse=Yk,Hse=Xk,jse=Jk,Bse=Zk;var wM;(function(r){function e(t){const i=t;return i&&!!i.inserting&&!!i.replacing}r.is=e})(wM||(wM={}));function Use(r){const t=r||(P=>P.toString());function i(P){return t(P)}function n(P){return{uri:t(P.uri)}}function s(P){return{uri:t(P.uri),languageId:P.languageId,version:P.version,text:P.getText()}}function o(P){return{uri:t(P.uri),version:P.version}}function a(P){return{textDocument:s(P)}}function c(P){const oe=P;return!!oe.document&&!!oe.contentChanges}function d(P){const oe=P;return!!oe.uri&&!!oe.version}function l(P,oe,tt){if(d(P))return{textDocument:{uri:t(P.uri),version:P.version},contentChanges:[{text:P.getText()}]};if(c(P)){const ei=oe,wi=tt;return{textDocument:{uri:t(ei),version:wi},contentChanges:P.contentChanges.map(kn=>{const Tn=kn.range;return{range:{start:{line:Tn.start.line,character:Tn.start.character},end:{line:Tn.end.line,character:Tn.end.character}},rangeLength:kn.rangeLength,text:kn.text}})}}else throw Error("Unsupported text document change parameter")}function u(P){return{textDocument:n(P)}}function h(P,oe=!1){let tt={textDocument:n(P)};return oe&&(tt.text=P.getText()),tt}function g(P){switch(P){case zn.TextDocumentSaveReason.Manual:return Ht.TextDocumentSaveReason.Manual;case zn.TextDocumentSaveReason.AfterDelay:return Ht.TextDocumentSaveReason.AfterDelay;case zn.TextDocumentSaveReason.FocusOut:return Ht.TextDocumentSaveReason.FocusOut}return Ht.TextDocumentSaveReason.Manual}function m(P){return{textDocument:n(P.document),reason:g(P.reason)}}function y(P){return{files:P.files.map(oe=>({uri:t(oe)}))}}function _(P){return{files:P.files.map(oe=>({oldUri:t(oe.oldUri),newUri:t(oe.newUri)}))}}function b(P){return{files:P.files.map(oe=>({uri:t(oe)}))}}function E(P){return{files:P.files.map(oe=>({uri:t(oe)}))}}function D(P){return{files:P.files.map(oe=>({oldUri:t(oe.oldUri),newUri:t(oe.newUri)}))}}function R(P){return{files:P.files.map(oe=>({uri:t(oe)}))}}function M(P,oe){return{textDocument:n(P),position:ue(oe)}}function O(P){switch(P){case zn.CompletionTriggerKind.TriggerCharacter:return Ht.CompletionTriggerKind.TriggerCharacter;case zn.CompletionTriggerKind.TriggerForIncompleteCompletions:return Ht.CompletionTriggerKind.TriggerForIncompleteCompletions;default:return Ht.CompletionTriggerKind.Invoked}}function L(P,oe,tt){return{textDocument:n(P),position:ue(oe),context:{triggerKind:O(tt.triggerKind),triggerCharacter:tt.triggerCharacter}}}function W(P){switch(P){case zn.SignatureHelpTriggerKind.Invoke:return Ht.SignatureHelpTriggerKind.Invoked;case zn.SignatureHelpTriggerKind.TriggerCharacter:return Ht.SignatureHelpTriggerKind.TriggerCharacter;case zn.SignatureHelpTriggerKind.ContentChange:return Ht.SignatureHelpTriggerKind.ContentChange}}function Z(P){return{label:P.label}}function K(P){return P.map(Z)}function H(P){return{label:P.label,parameters:K(P.parameters)}}function C(P){return P.map(H)}function B(P){return P===void 0?P:{signatures:C(P.signatures),activeSignature:P.activeSignature,activeParameter:P.activeParameter}}function te(P,oe,tt){return{textDocument:n(P),position:ue(oe),context:{isRetrigger:tt.isRetrigger,triggerCharacter:tt.triggerCharacter,triggerKind:W(tt.triggerKind),activeSignatureHelp:B(tt.activeSignatureHelp)}}}function ue(P){return{line:P.line,character:P.character}}function be(P){return P==null?P:{line:P.line>Ht.uinteger.MAX_VALUE?Ht.uinteger.MAX_VALUE:P.line,character:P.character>Ht.uinteger.MAX_VALUE?Ht.uinteger.MAX_VALUE:P.character}}function de(P,oe){return sj.map(P,be,oe)}function le(P){return P==null?P:{start:be(P.start),end:be(P.end)}}function Me(P){return P==null?P:Ht.Location.create(i(P.uri),le(P.range))}function Re(P){switch(P){case zn.DiagnosticSeverity.Error:return Ht.DiagnosticSeverity.Error;case zn.DiagnosticSeverity.Warning:return Ht.DiagnosticSeverity.Warning;case zn.DiagnosticSeverity.Information:return Ht.DiagnosticSeverity.Information;case zn.DiagnosticSeverity.Hint:return Ht.DiagnosticSeverity.Hint}}function Oe(P){if(!P)return;let oe=[];for(let tt of P){let ei=Ge(tt);ei!==void 0&&oe.push(ei)}return oe.length>0?oe:void 0}function Ge(P){switch(P){case zn.DiagnosticTag.Unnecessary:return Ht.DiagnosticTag.Unnecessary;case zn.DiagnosticTag.Deprecated:return Ht.DiagnosticTag.Deprecated;default:return}}function xe(P){return{message:P.message,location:Me(P.location)}}function Kt(P){return P.map(xe)}function je(P){if(P!=null)return sp.number(P)||sp.string(P)?P:{value:P.value,target:i(P.target)}}function et(P){const oe=Ht.Diagnostic.create(le(P.range),P.message),tt=P instanceof oj.ProtocolDiagnostic?P:void 0;tt!==void 0&&tt.data!==void 0&&(oe.data=tt.data);const ei=je(P.code);return oj.DiagnosticCode.is(ei)?tt!==void 0&&tt.hasDiagnosticCode?oe.code=ei:(oe.code=ei.value,oe.codeDescription={href:ei.target}):oe.code=ei,sp.number(P.severity)&&(oe.severity=Re(P.severity)),Array.isArray(P.tags)&&(oe.tags=Oe(P.tags)),P.relatedInformation&&(oe.relatedInformation=Kt(P.relatedInformation)),P.source&&(oe.source=P.source),oe}function Qt(P,oe){return P==null?P:sj.map(P,et,oe)}function ct(P,oe){switch(P){case"$string":return oe;case Ht.MarkupKind.PlainText:return{kind:P,value:oe};case Ht.MarkupKind.Markdown:return{kind:P,value:oe.value};default:return`Unsupported Markup content received. Kind is: ${P}`}}function ai(P){switch(P){case zn.CompletionItemTag.Deprecated:return Ht.CompletionItemTag.Deprecated}}function dt(P){if(P===void 0)return P;const oe=[];for(let tt of P){const ei=ai(tt);ei!==void 0&&oe.push(ei)}return oe}function xi(P,oe){return oe!==void 0?oe:P+1}function ci(P,oe=!1){let tt,ei;sp.string(P.label)?tt=P.label:(tt=P.label.label,oe&&(P.label.detail!==void 0||P.label.description!==void 0)&&(ei={detail:P.label.detail,description:P.label.description}));let wi={label:tt};ei!==void 0&&(wi.labelDetails=ei);let nn=P instanceof Fse.default?P:void 0;P.detail&&(wi.detail=P.detail),P.documentation&&(!nn||nn.documentationFormat==="$string"?wi.documentation=P.documentation:wi.documentation=ct(nn.documentationFormat,P.documentation)),P.filterText&&(wi.filterText=P.filterText),mt(wi,P),sp.number(P.kind)&&(wi.kind=xi(P.kind,nn&&nn.originalItemKind)),P.sortText&&(wi.sortText=P.sortText),P.additionalTextEdits&&(wi.additionalTextEdits=Kr(P.additionalTextEdits)),P.commitCharacters&&(wi.commitCharacters=P.commitCharacters.slice()),P.command&&(wi.command=Pt(P.command)),(P.preselect===!0||P.preselect===!1)&&(wi.preselect=P.preselect);const kn=dt(P.tags);if(nn){if(nn.data!==void 0&&(wi.data=nn.data),nn.deprecated===!0||nn.deprecated===!1){if(nn.deprecated===!0&&kn!==void 0&&kn.length>0){const Tn=kn.indexOf(zn.CompletionItemTag.Deprecated);Tn!==-1&&kn.splice(Tn,1)}wi.deprecated=nn.deprecated}nn.insertTextMode!==void 0&&(wi.insertTextMode=nn.insertTextMode)}return kn!==void 0&&kn.length>0&&(wi.tags=kn),wi.insertTextMode===void 0&&P.keepWhitespace===!0&&(wi.insertTextMode=Ht.InsertTextMode.adjustIndentation),wi}function mt(P,oe){let tt=Ht.InsertTextFormat.PlainText,ei,wi;oe.textEdit?(ei=oe.textEdit.newText,wi=oe.textEdit.range):oe.insertText instanceof zn.SnippetString?(tt=Ht.InsertTextFormat.Snippet,ei=oe.insertText.value):ei=oe.insertText,oe.range&&(wi=oe.range),P.insertTextFormat=tt,oe.fromEdit&&ei!==void 0&&wi!==void 0?P.textEdit=vn(ei,wi):P.insertText=ei}function vn(P,oe){return wM.is(oe)?Ht.InsertReplaceEdit.create(P,le(oe.inserting),le(oe.replacing)):{newText:P,range:le(oe)}}function zr(P){return{range:le(P.range),newText:P.newText}}function Kr(P){return P==null?P:P.map(zr)}function qn(P){return P<=zn.SymbolKind.TypeParameter?P+1:Ht.SymbolKind.Property}function ut(P){return P}function U(P){return P.map(ut)}function J(P,oe,tt){return{textDocument:n(P),position:ue(oe),context:{includeDeclaration:tt.includeDeclaration}}}async function Y(P,oe){let tt=Ht.CodeAction.create(P.title);if(P instanceof $se.default&&P.data!==void 0&&(tt.data=P.data),P.kind!==void 0&&(tt.kind=Ce(P.kind)),P.diagnostics!==void 0&&(tt.diagnostics=await Qt(P.diagnostics,oe)),P.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return P.command!==void 0&&(tt.command=Pt(P.command)),P.isPreferred!==void 0&&(tt.isPreferred=P.isPreferred),P.disabled!==void 0&&(tt.disabled={reason:P.disabled.reason}),tt}async function _e(P,oe){if(P==null)return P;let tt;return P.only&&sp.string(P.only.value)&&(tt=[P.only.value]),Ht.CodeActionContext.create(await Qt(P.diagnostics,oe),tt,Se(P.triggerKind))}function Se(P){switch(P){case zn.CodeActionTriggerKind.Invoke:return Ht.CodeActionTriggerKind.Invoked;case zn.CodeActionTriggerKind.Automatic:return Ht.CodeActionTriggerKind.Automatic;default:return}}function Ce(P){if(P!=null)return P.value}function Vt(P){return P==null?P:Ht.InlineValueContext.create(P.frameId,le(P.stoppedLocation))}function Pt(P){let oe=Ht.Command.create(P.title,P.command);return P.arguments&&(oe.arguments=P.arguments),oe}function Zt(P){let oe=Ht.CodeLens.create(le(P.range));return P.command&&(oe.command=Pt(P.command)),P instanceof Ose.default&&P.data&&(oe.data=P.data),oe}function cr(P,oe){const tt={tabSize:P.tabSize,insertSpaces:P.insertSpaces};return oe.trimTrailingWhitespace&&(tt.trimTrailingWhitespace=!0),oe.trimFinalNewlines&&(tt.trimFinalNewlines=!0),oe.insertFinalNewline&&(tt.insertFinalNewline=!0),tt}function yn(P){return{textDocument:n(P)}}function Ro(P){return{textDocument:n(P)}}function Ua(P){let oe=Ht.DocumentLink.create(le(P.range));P.target&&(oe.target=i(P.target)),P.tooltip!==void 0&&(oe.tooltip=P.tooltip);let tt=P instanceof Nse.default?P:void 0;return tt&&tt.data&&(oe.data=tt.data),oe}function hs(P){return{textDocument:n(P)}}function Va(P){const oe={name:P.name,kind:qn(P.kind),uri:i(P.uri),range:le(P.range),selectionRange:le(P.selectionRange)};return P.detail!==void 0&&P.detail.length>0&&(oe.detail=P.detail),P.tags!==void 0&&(oe.tags=U(P.tags)),P instanceof Wse.default&&P.data!==void 0&&(oe.data=P.data),oe}function Rc(P){const oe={name:P.name,kind:qn(P.kind),uri:i(P.uri),range:le(P.range),selectionRange:le(P.selectionRange)};return P.detail!==void 0&&P.detail.length>0&&(oe.detail=P.detail),P.tags!==void 0&&(oe.tags=U(P.tags)),P instanceof Hse.default&&P.data!==void 0&&(oe.data=P.data),oe}function Po(P){const oe=P instanceof jse.default?{name:P.name,kind:qn(P.kind),location:P.hasRange?Me(P.location):{uri:t(P.location.uri)},data:P.data}:{name:P.name,kind:qn(P.kind),location:Me(P.location)};return P.tags!==void 0&&(oe.tags=U(P.tags)),P.containerName!==""&&(oe.containerName=P.containerName),oe}function na(P){const oe=typeof P.label=="string"?P.label:P.label.map(X),tt=Ht.InlayHint.create(be(P.position),oe);return P.kind!==void 0&&(tt.kind=P.kind),P.textEdits!==void 0&&(tt.textEdits=Kr(P.textEdits)),P.tooltip!==void 0&&(tt.tooltip=wr(P.tooltip)),P.paddingLeft!==void 0&&(tt.paddingLeft=P.paddingLeft),P.paddingRight!==void 0&&(tt.paddingRight=P.paddingRight),P instanceof Bse.default&&P.data!==void 0&&(tt.data=P.data),tt}function X(P){const oe=Ht.InlayHintLabelPart.create(P.value);return P.location!==void 0&&(oe.location=Me(P.location)),P.command!==void 0&&(oe.command=Pt(P.command)),P.tooltip!==void 0&&(oe.tooltip=wr(P.tooltip)),oe}function wr(P){return typeof P=="string"?P:{kind:Ht.MarkupKind.Markdown,value:P.value}}return{asUri:i,asTextDocumentIdentifier:n,asTextDocumentItem:s,asVersionedTextDocumentIdentifier:o,asOpenTextDocumentParams:a,asChangeTextDocumentParams:l,asCloseTextDocumentParams:u,asSaveTextDocumentParams:h,asWillSaveTextDocumentParams:m,asDidCreateFilesParams:y,asDidRenameFilesParams:_,asDidDeleteFilesParams:b,asWillCreateFilesParams:E,asWillRenameFilesParams:D,asWillDeleteFilesParams:R,asTextDocumentPositionParams:M,asCompletionParams:L,asSignatureHelpParams:te,asWorkerPosition:ue,asRange:le,asPosition:be,asPositions:de,asLocation:Me,asDiagnosticSeverity:Re,asDiagnosticTag:Ge,asDiagnostic:et,asDiagnostics:Qt,asCompletionItem:ci,asTextEdit:zr,asSymbolKind:qn,asSymbolTag:ut,asSymbolTags:U,asReferenceParams:J,asCodeAction:Y,asCodeActionContext:_e,asInlineValueContext:Vt,asCommand:Pt,asCodeLens:Zt,asFormattingOptions:cr,asDocumentSymbolParams:yn,asCodeLensParams:Ro,asDocumentLink:Ua,asDocumentLinkParams:hs,asCallHierarchyItem:Va,asTypeHierarchyItem:Rc,asInlayHint:na,asWorkspaceSymbol:Po}}qk.createConverter=Use;var eT={};Object.defineProperty(eT,"__esModule",{value:!0});eT.createConverter=void 0;const Ye=Dt,bt=Lt,Lo=Ni,Oi=Dr,Vse=Gk,qse=zk,Gse=Kk,zse=Qk,aj=B1,Kse=Yk,Qse=Xk,Yse=Jk,Xse=Zk,cj=Lt;var CE;(function(r){function e(t){let i=t;return i&&Lo.string(i.language)&&Lo.string(i.value)}r.is=e})(CE||(CE={}));function Jse(r,e,t){const n=r||(S=>Ye.Uri.parse(S));function s(S){return n(S)}function o(S){const $=[];for(const ae of S)if(typeof ae=="string")$.push(ae);else if(cj.NotebookCellTextDocumentFilter.is(ae))if(typeof ae.notebook=="string")$.push({notebookType:ae.notebook,language:ae.language});else{const Ae=ae.notebook.notebookType??"*";$.push({notebookType:Ae,scheme:ae.notebook.scheme,pattern:ae.notebook.pattern,language:ae.language})}else cj.TextDocumentFilter.is(ae)&&$.push({language:ae.language,scheme:ae.scheme,pattern:ae.pattern});return $}async function a(S,$){return Oi.map(S,d,$)}function c(S){const $=new Array(S.length);for(let ae=0;ae<S.length;ae++)$[ae]=d(S[ae]);return $}function d(S){let $=new aj.ProtocolDiagnostic(m(S.range),S.message,_(S.severity),S.data);if(S.code!==void 0){if(typeof S.code=="string"||typeof S.code=="number")bt.CodeDescription.is(S.codeDescription)?$.code={value:S.code,target:s(S.codeDescription.href)}:$.code=S.code;else if(aj.DiagnosticCode.is(S.code)){$.hasDiagnosticCode=!0;const ae=S.code;$.code={value:ae.value,target:s(ae.target)}}}return S.source&&($.source=S.source),S.relatedInformation&&($.relatedInformation=l(S.relatedInformation)),Array.isArray(S.tags)&&($.tags=u(S.tags)),$}function l(S){const $=new Array(S.length);for(let ae=0;ae<S.length;ae++){const Ae=S[ae];$[ae]=new Ye.DiagnosticRelatedInformation(Ge(Ae.location),Ae.message)}return $}function u(S){if(!S)return;let $=[];for(let ae of S){let Ae=h(ae);Ae!==void 0&&$.push(Ae)}return $.length>0?$:void 0}function h(S){switch(S){case bt.DiagnosticTag.Unnecessary:return Ye.DiagnosticTag.Unnecessary;case bt.DiagnosticTag.Deprecated:return Ye.DiagnosticTag.Deprecated;default:return}}function g(S){return S?new Ye.Position(S.line,S.character):void 0}function m(S){return S?new Ye.Range(S.start.line,S.start.character,S.end.line,S.end.character):void 0}async function y(S,$){return Oi.map(S,ae=>new Ye.Range(ae.start.line,ae.start.character,ae.end.line,ae.end.character),$)}function _(S){if(S==null)return Ye.DiagnosticSeverity.Error;switch(S){case bt.DiagnosticSeverity.Error:return Ye.DiagnosticSeverity.Error;case bt.DiagnosticSeverity.Warning:return Ye.DiagnosticSeverity.Warning;case bt.DiagnosticSeverity.Information:return Ye.DiagnosticSeverity.Information;case bt.DiagnosticSeverity.Hint:return Ye.DiagnosticSeverity.Hint}return Ye.DiagnosticSeverity.Error}function b(S){if(Lo.string(S))return D(S);if(CE.is(S))return D().appendCodeblock(S.value,S.language);if(Array.isArray(S)){let $=[];for(let ae of S){let Ae=D();CE.is(ae)?Ae.appendCodeblock(ae.value,ae.language):Ae.appendMarkdown(ae),$.push(Ae)}return $}else return D(S)}function E(S){if(Lo.string(S))return S;switch(S.kind){case bt.MarkupKind.Markdown:return D(S.value);case bt.MarkupKind.PlainText:return S.value;default:return`Unsupported Markup content received. Kind is: ${S.kind}`}}function D(S){let $;if(S===void 0||typeof S=="string")$=new Ye.MarkdownString(S);else switch(S.kind){case bt.MarkupKind.Markdown:$=new Ye.MarkdownString(S.value);break;case bt.MarkupKind.PlainText:$=new Ye.MarkdownString,$.appendText(S.value);break;default:$=new Ye.MarkdownString,$.appendText(`Unsupported Markup content received. Kind is: ${S.kind}`);break}return $.isTrusted=e,$.supportHtml=t,$}function R(S){if(S)return new Ye.Hover(b(S.contents),m(S.range))}async function M(S,$,ae){if(!S)return;if(Array.isArray(S))return Oi.map(S,br=>K(br,$),ae);const Ae=S,{defaultRange:Ft,commitCharacters:Wt}=O(Ae,$),kt=await Oi.map(Ae.items,br=>{var di,ro,Gn;return K(br,Wt,Ft,(di=Ae.itemDefaults)==null?void 0:di.insertTextMode,(ro=Ae.itemDefaults)==null?void 0:ro.insertTextFormat,(Gn=Ae.itemDefaults)==null?void 0:Gn.data)},ae);return new Ye.CompletionList(kt,Ae.isIncomplete)}function O(S,$){var Ft,Wt;const ae=(Ft=S.itemDefaults)==null?void 0:Ft.editRange,Ae=((Wt=S.itemDefaults)==null?void 0:Wt.commitCharacters)??$;return bt.Range.is(ae)?{defaultRange:m(ae),commitCharacters:Ae}:ae!==void 0?{defaultRange:{inserting:m(ae.insert),replacing:m(ae.replace)},commitCharacters:Ae}:{defaultRange:void 0,commitCharacters:Ae}}function L(S){return bt.CompletionItemKind.Text<=S&&S<=bt.CompletionItemKind.TypeParameter?[S-1,void 0]:[Ye.CompletionItemKind.Text,S]}function W(S){switch(S){case bt.CompletionItemTag.Deprecated:return Ye.CompletionItemTag.Deprecated}}function Z(S){if(S==null)return[];const $=[];for(const ae of S){const Ae=W(ae);Ae!==void 0&&$.push(Ae)}return $}function K(S,$,ae,Ae,Ft,Wt){const kt=Z(S.tags),br=H(S),di=new Vse.default(br);S.detail&&(di.detail=S.detail),S.documentation&&(di.documentation=E(S.documentation),di.documentationFormat=Lo.string(S.documentation)?"$string":S.documentation.kind),S.filterText&&(di.filterText=S.filterText);const ro=C(S,ae,Ft);if(ro&&(di.insertText=ro.text,di.range=ro.range,di.fromEdit=ro.fromEdit),Lo.number(S.kind)){let[Eb,lv]=L(S.kind);di.kind=Eb,lv&&(di.originalItemKind=lv)}S.sortText&&(di.sortText=S.sortText),S.additionalTextEdits&&(di.additionalTextEdits=be(S.additionalTextEdits));const Gn=S.commitCharacters!==void 0?Lo.stringArray(S.commitCharacters)?S.commitCharacters:void 0:$;Gn&&(di.commitCharacters=Gn.slice()),S.command&&(di.command=U(S.command)),(S.deprecated===!0||S.deprecated===!1)&&(di.deprecated=S.deprecated,S.deprecated===!0&&kt.push(Ye.CompletionItemTag.Deprecated)),(S.preselect===!0||S.preselect===!1)&&(di.preselect=S.preselect);const ep=S.data??Wt;ep!==void 0&&(di.data=ep),kt.length>0&&(di.tags=kt);const Ps=S.insertTextMode??Ae;return Ps!==void 0&&(di.insertTextMode=Ps,Ps===bt.InsertTextMode.asIs&&(di.keepWhitespace=!0)),di}function H(S){return bt.CompletionItemLabelDetails.is(S.labelDetails)?{label:S.label,detail:S.labelDetails.detail,description:S.labelDetails.description}:S.label}function C(S,$,ae){const Ae=S.insertTextFormat??ae;if(S.textEdit!==void 0||$!==void 0){const[Ft,Wt]=S.textEdit!==void 0?B(S.textEdit):[$,S.textEditText??S.label];return Ae===bt.InsertTextFormat.Snippet?{text:new Ye.SnippetString(Wt),range:Ft,fromEdit:!0}:{text:Wt,range:Ft,fromEdit:!0}}else return S.insertText?Ae===bt.InsertTextFormat.Snippet?{text:new Ye.SnippetString(S.insertText),fromEdit:!1}:{text:S.insertText,fromEdit:!1}:void 0}function B(S){return bt.InsertReplaceEdit.is(S)?[{inserting:m(S.insert),replacing:m(S.replace)},S.newText]:[m(S.range),S.newText]}function te(S){if(S)return new Ye.TextEdit(m(S.range),S.newText)}async function ue(S,$){if(S)return Oi.map(S,te,$)}function be(S){if(!S)return;const $=new Array(S.length);for(let ae=0;ae<S.length;ae++)$[ae]=te(S[ae]);return $}async function de(S,$){if(!S)return;let ae=new Ye.SignatureHelp;return Lo.number(S.activeSignature)?ae.activeSignature=S.activeSignature:ae.activeSignature=0,Lo.number(S.activeParameter)?ae.activeParameter=S.activeParameter:ae.activeParameter=0,S.signatures&&(ae.signatures=await le(S.signatures,$)),ae}async function le(S,$){return Oi.mapAsync(S,Me,$)}async function Me(S,$){let ae=new Ye.SignatureInformation(S.label);return S.documentation!==void 0&&(ae.documentation=E(S.documentation)),S.parameters!==void 0&&(ae.parameters=await Re(S.parameters,$)),S.activeParameter!==void 0&&(ae.activeParameter=S.activeParameter),ae}function Re(S,$){return Oi.map(S,Oe,$)}function Oe(S){let $=new Ye.ParameterInformation(S.label);return S.documentation&&($.documentation=E(S.documentation)),$}function Ge(S){return S?new Ye.Location(n(S.uri),m(S.range)):void 0}async function xe(S,$){if(S)return et(S,$)}async function Kt(S,$){if(S)return et(S,$)}function je(S){if(!S)return;let $={targetUri:n(S.targetUri),targetRange:m(S.targetRange),originSelectionRange:m(S.originSelectionRange),targetSelectionRange:m(S.targetSelectionRange)};if(!$.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return $}async function et(S,$){if(S)if(Lo.array(S)){if(S.length===0)return[];if(bt.LocationLink.is(S[0])){const ae=S;return Oi.map(ae,je,$)}else{const ae=S;return Oi.map(ae,Ge,$)}}else return bt.LocationLink.is(S)?[je(S)]:Ge(S)}async function Qt(S,$){if(S)return Oi.map(S,Ge,$)}async function ct(S,$){if(S)return Oi.map(S,ai,$)}function ai(S){let $=new Ye.DocumentHighlight(m(S.range));return Lo.number(S.kind)&&($.kind=dt(S.kind)),$}function dt(S){switch(S){case bt.DocumentHighlightKind.Text:return Ye.DocumentHighlightKind.Text;case bt.DocumentHighlightKind.Read:return Ye.DocumentHighlightKind.Read;case bt.DocumentHighlightKind.Write:return Ye.DocumentHighlightKind.Write}return Ye.DocumentHighlightKind.Text}async function xi(S,$){if(S)return Oi.map(S,zr,$)}function ci(S){return S<=bt.SymbolKind.TypeParameter?S-1:Ye.SymbolKind.Property}function mt(S){switch(S){case bt.SymbolTag.Deprecated:return Ye.SymbolTag.Deprecated;default:return}}function vn(S){if(S==null)return;const $=[];for(const ae of S){const Ae=mt(ae);Ae!==void 0&&$.push(Ae)}return $.length===0?void 0:$}function zr(S){const $=S.data,ae=S.location,Ae=ae.range===void 0||$!==void 0?new Yse.default(S.name,ci(S.kind),S.containerName??"",ae.range===void 0?n(ae.uri):new Ye.Location(n(S.location.uri),m(ae.range)),$):new Ye.SymbolInformation(S.name,ci(S.kind),S.containerName??"",new Ye.Location(n(S.location.uri),m(ae.range)));return ut(Ae,S),Ae}async function Kr(S,$){if(S!=null)return Oi.map(S,qn,$)}function qn(S){let $=new Ye.DocumentSymbol(S.name,S.detail||"",ci(S.kind),m(S.range),m(S.selectionRange));if(ut($,S),S.children!==void 0&&S.children.length>0){let ae=[];for(let Ae of S.children)ae.push(qn(Ae));$.children=ae}return $}function ut(S,$){S.tags=vn($.tags),$.deprecated&&(S.tags?S.tags.includes(Ye.SymbolTag.Deprecated)||(S.tags=S.tags.concat(Ye.SymbolTag.Deprecated)):S.tags=[Ye.SymbolTag.Deprecated])}function U(S){let $={title:S.title,command:S.command};return S.arguments&&($.arguments=S.arguments),$}async function J(S,$){if(S)return Oi.map(S,U,$)}const Y=new Map;Y.set(bt.CodeActionKind.Empty,Ye.CodeActionKind.Empty),Y.set(bt.CodeActionKind.QuickFix,Ye.CodeActionKind.QuickFix),Y.set(bt.CodeActionKind.Refactor,Ye.CodeActionKind.Refactor),Y.set(bt.CodeActionKind.RefactorExtract,Ye.CodeActionKind.RefactorExtract),Y.set(bt.CodeActionKind.RefactorInline,Ye.CodeActionKind.RefactorInline),Y.set(bt.CodeActionKind.RefactorRewrite,Ye.CodeActionKind.RefactorRewrite),Y.set(bt.CodeActionKind.Source,Ye.CodeActionKind.Source),Y.set(bt.CodeActionKind.SourceOrganizeImports,Ye.CodeActionKind.SourceOrganizeImports);function _e(S){if(S==null)return;let $=Y.get(S);if($)return $;let ae=S.split(".");$=Ye.CodeActionKind.Empty;for(let Ae of ae)$=$.append(Ae);return $}function Se(S){if(S!=null)return S.map($=>_e($))}async function Ce(S,$){if(S==null)return;let ae=new zse.default(S.title,S.data);return S.kind!==void 0&&(ae.kind=_e(S.kind)),S.diagnostics!==void 0&&(ae.diagnostics=c(S.diagnostics)),S.edit!==void 0&&(ae.edit=await cr(S.edit,$)),S.command!==void 0&&(ae.command=U(S.command)),S.isPreferred!==void 0&&(ae.isPreferred=S.isPreferred),S.disabled!==void 0&&(ae.disabled={reason:S.disabled.reason}),ae}function Vt(S,$){return Oi.mapAsync(S,async ae=>bt.Command.is(ae)?U(ae):Ce(ae,$),$)}function Pt(S){if(!S)return;let $=new qse.default(m(S.range));return S.command&&($.command=U(S.command)),S.data!==void 0&&S.data!==null&&($.data=S.data),$}async function Zt(S,$){if(S)return Oi.map(S,Pt,$)}async function cr(S,$){if(!S)return;const ae=new Map;if(S.changeAnnotations!==void 0){const Wt=S.changeAnnotations;await Oi.forEach(Object.keys(Wt),kt=>{const br=yn(Wt[kt]);ae.set(kt,br)},$)}const Ae=Wt=>{if(Wt!==void 0)return ae.get(Wt)},Ft=new Ye.WorkspaceEdit;if(S.documentChanges){const Wt=S.documentChanges;await Oi.forEach(Wt,kt=>{if(bt.CreateFile.is(kt))Ft.createFile(n(kt.uri),kt.options,Ae(kt.annotationId));else if(bt.RenameFile.is(kt))Ft.renameFile(n(kt.oldUri),n(kt.newUri),kt.options,Ae(kt.annotationId));else if(bt.DeleteFile.is(kt))Ft.deleteFile(n(kt.uri),kt.options,Ae(kt.annotationId));else if(bt.TextDocumentEdit.is(kt)){const br=n(kt.textDocument.uri);for(const di of kt.edits)bt.AnnotatedTextEdit.is(di)?Ft.replace(br,m(di.range),di.newText,Ae(di.annotationId)):Ft.replace(br,m(di.range),di.newText)}else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(kt,void 0,4)}`)},$)}else if(S.changes){const Wt=S.changes;await Oi.forEach(Object.keys(Wt),kt=>{Ft.set(n(kt),be(Wt[kt]))},$)}return Ft}function yn(S){if(S!==void 0)return{label:S.label,needsConfirmation:!!S.needsConfirmation,description:S.description}}function Ro(S){let $=m(S.range),ae=S.target?s(S.target):void 0,Ae=new Gse.default($,ae);return S.tooltip!==void 0&&(Ae.tooltip=S.tooltip),S.data!==void 0&&S.data!==null&&(Ae.data=S.data),Ae}async function Ua(S,$){if(S)return Oi.map(S,Ro,$)}function hs(S){return new Ye.Color(S.red,S.green,S.blue,S.alpha)}function Va(S){return new Ye.ColorInformation(m(S.range),hs(S.color))}async function Rc(S,$){if(S)return Oi.map(S,Va,$)}function Po(S){let $=new Ye.ColorPresentation(S.label);return $.additionalTextEdits=be(S.additionalTextEdits),S.textEdit&&($.textEdit=te(S.textEdit)),$}async function na(S,$){if(S)return Oi.map(S,Po,$)}function X(S){if(S)switch(S){case bt.FoldingRangeKind.Comment:return Ye.FoldingRangeKind.Comment;case bt.FoldingRangeKind.Imports:return Ye.FoldingRangeKind.Imports;case bt.FoldingRangeKind.Region:return Ye.FoldingRangeKind.Region}}function wr(S){return new Ye.FoldingRange(S.startLine,S.endLine,X(S.kind))}async function P(S,$){if(S)return Oi.map(S,wr,$)}function oe(S){return new Ye.SelectionRange(m(S.range),S.parent?oe(S.parent):void 0)}async function tt(S,$){return Array.isArray(S)?Oi.map(S,oe,$):[]}function ei(S){return bt.InlineValueText.is(S)?new Ye.InlineValueText(m(S.range),S.text):bt.InlineValueVariableLookup.is(S)?new Ye.InlineValueVariableLookup(m(S.range),S.variableName,S.caseSensitiveLookup):new Ye.InlineValueEvaluatableExpression(m(S.range),S.expression)}async function wi(S,$){return Array.isArray(S)?Oi.map(S,ei,$):[]}async function nn(S,$){const ae=typeof S.label=="string"?S.label:await Oi.map(S.label,kn,$),Ae=new Xse.default(g(S.position),ae);return S.kind!==void 0&&(Ae.kind=S.kind),S.textEdits!==void 0&&(Ae.textEdits=await ue(S.textEdits,$)),S.tooltip!==void 0&&(Ae.tooltip=Tn(S.tooltip)),S.paddingLeft!==void 0&&(Ae.paddingLeft=S.paddingLeft),S.paddingRight!==void 0&&(Ae.paddingRight=S.paddingRight),S.data!==void 0&&(Ae.data=S.data),Ae}function kn(S){const $=new Ye.InlayHintLabelPart(S.value);return S.location!==void 0&&($.location=Ge(S.location)),S.tooltip!==void 0&&($.tooltip=Tn(S.tooltip)),S.command!==void 0&&($.command=U(S.command)),$}function Tn(S){return typeof S=="string"?S:D(S)}async function Ao(S,$){if(Array.isArray(S))return Oi.mapAsync(S,nn,$)}function ra(S){if(S===null)return;const $=new Kse.default(ci(S.kind),S.name,S.detail||"",s(S.uri),m(S.range),m(S.selectionRange),S.data);return S.tags!==void 0&&($.tags=vn(S.tags)),$}async function Pc(S,$){if(S!==null)return Oi.map(S,ra,$)}async function no(S,$){return new Ye.CallHierarchyIncomingCall(ra(S.from),await y(S.fromRanges,$))}async function Ac(S,$){if(S!==null)return Oi.mapAsync(S,no,$)}async function qa(S,$){return new Ye.CallHierarchyOutgoingCall(ra(S.to),await y(S.fromRanges,$))}async function Ga(S,$){if(S!==null)return Oi.mapAsync(S,qa,$)}async function Pe(S,$){if(S!=null)return new Ye.SemanticTokens(new Uint32Array(S.data),S.resultId)}function Ne(S){return new Ye.SemanticTokensEdit(S.start,S.deleteCount,S.data!==void 0?new Uint32Array(S.data):void 0)}async function N(S,$){if(S!=null)return new Ye.SemanticTokensEdits(S.edits.map(Ne),S.resultId)}function Q(S){return S}async function ve(S,$){if(S!=null)return new Ye.LinkedEditingRanges(await y(S.ranges,$),x(S.wordPattern))}function x(S){if(S!=null)return new RegExp(S)}function I(S){if(S===null)return;let $=new Qse.default(ci(S.kind),S.name,S.detail||"",s(S.uri),m(S.range),m(S.selectionRange),S.data);return S.tags!==void 0&&($.tags=vn(S.tags)),$}async function j(S,$){if(S!==null)return Oi.map(S,I,$)}function $e(S){if(Lo.string(S))return S;if(bt.RelativePattern.is(S)){if(bt.URI.is(S.baseUri))return new Ye.RelativePattern(s(S.baseUri),S.pattern);if(bt.WorkspaceFolder.is(S.baseUri)){const $=Ye.workspace.getWorkspaceFolder(s(S.baseUri.uri));return $!==void 0?new Ye.RelativePattern($,S.pattern):void 0}}}return{asUri:s,asDocumentSelector:o,asDiagnostics:a,asDiagnostic:d,asRange:m,asRanges:y,asPosition:g,asDiagnosticSeverity:_,asDiagnosticTag:h,asHover:R,asCompletionResult:M,asCompletionItem:K,asTextEdit:te,asTextEdits:ue,asSignatureHelp:de,asSignatureInformations:le,asSignatureInformation:Me,asParameterInformations:Re,asParameterInformation:Oe,asDeclarationResult:xe,asDefinitionResult:Kt,asLocation:Ge,asReferences:Qt,asDocumentHighlights:ct,asDocumentHighlight:ai,asDocumentHighlightKind:dt,asSymbolKind:ci,asSymbolTag:mt,asSymbolTags:vn,asSymbolInformations:xi,asSymbolInformation:zr,asDocumentSymbols:Kr,asDocumentSymbol:qn,asCommand:U,asCommands:J,asCodeAction:Ce,asCodeActionKind:_e,asCodeActionKinds:Se,asCodeActionResult:Vt,asCodeLens:Pt,asCodeLenses:Zt,asWorkspaceEdit:cr,asDocumentLink:Ro,asDocumentLinks:Ua,asFoldingRangeKind:X,asFoldingRange:wr,asFoldingRanges:P,asColor:hs,asColorInformation:Va,asColorInformations:Rc,asColorPresentation:Po,asColorPresentations:na,asSelectionRange:oe,asSelectionRanges:tt,asInlineValue:ei,asInlineValues:wi,asInlayHint:nn,asInlayHints:Ao,asSemanticTokensLegend:Q,asSemanticTokens:Pe,asSemanticTokensEdit:Ne,asSemanticTokensEdits:N,asCallHierarchyItem:ra,asCallHierarchyItems:Pc,asCallHierarchyIncomingCall:no,asCallHierarchyIncomingCalls:Ac,asCallHierarchyOutgoingCall:qa,asCallHierarchyOutgoingCalls:Ga,asLinkedEditingRanges:ve,asTypeHierarchyItem:I,asTypeHierarchyItems:j,asGlobPattern:$e}}eT.createConverter=Jse;var Di={};Object.defineProperty(Di,"__esModule",{value:!0});Di.generateUuid=Di.parse=Di.isUUID=Di.v4=Di.empty=void 0;class U1{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}}class ti extends U1{constructor(){super([ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),"-",ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),"-","4",ti._randomHex(),ti._randomHex(),ti._randomHex(),"-",ti._oneOf(ti._timeHighBits),ti._randomHex(),ti._randomHex(),ti._randomHex(),"-",ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex(),ti._randomHex()].join(""))}static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return ti._oneOf(ti._chars)}}ti._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];ti._timeHighBits=["8","9","a","b"];Di.empty=new U1("00000000-0000-0000-0000-000000000000");function rK(){return new ti}Di.v4=rK;const Zse=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function sK(r){return Zse.test(r)}Di.isUUID=sK;function eoe(r){if(!sK(r))throw new Error("invalid uuid");return new U1(r)}Di.parse=eoe;function toe(){return rK().asHex()}Di.generateUuid=toe;var ob={};Object.defineProperty(ob,"__esModule",{value:!0});ob.ProgressPart=void 0;const dj=Dt,lj=Lt,uj=Ni;class ioe{constructor(e,t,i){this._client=e,this._token=t,this._reported=0,this._infinite=!1,this._lspProgressDisposable=this._client.onProgress(lj.WorkDoneProgress.type,this._token,n=>{switch(n.kind){case"begin":this.begin(n);break;case"report":this.report(n);break;case"end":this.done(),i&&i(this);break}})}begin(e){this._infinite=e.percentage===void 0,this._lspProgressDisposable!==void 0&&dj.window.withProgress({location:dj.ProgressLocation.Window,cancellable:e.cancellable,title:e.title},async(t,i)=>{if(this._lspProgressDisposable!==void 0)return this._progress=t,this._cancellationToken=i,this._tokenDisposable=this._cancellationToken.onCancellationRequested(()=>{this._client.sendNotification(lj.WorkDoneProgressCancelNotification.type,{token:this._token})}),this.report(e),new Promise((n,s)=>{this._resolve=n,this._reject=s})})}report(e){if(this._infinite&&uj.string(e.message))this._progress!==void 0&&this._progress.report({message:e.message});else if(uj.number(e.percentage)){const t=Math.max(0,Math.min(e.percentage,100)),i=Math.max(0,t-this._reported);this._reported+=i,this._progress!==void 0&&this._progress.report({message:e.message,increment:i})}}cancel(){this.cleanup(),this._reject!==void 0&&(this._reject(),this._resolve=void 0,this._reject=void 0)}done(){this.cleanup(),this._resolve!==void 0&&(this._resolve(),this._resolve=void 0,this._reject=void 0)}cleanup(){this._lspProgressDisposable!==void 0&&(this._lspProgressDisposable.dispose(),this._lspProgressDisposable=void 0),this._tokenDisposable!==void 0&&(this._tokenDisposable.dispose(),this._tokenDisposable=void 0),this._progress=void 0,this._cancellationToken=void 0}}ob.ProgressPart=ioe;var Pi={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkspaceFeature=r.TextDocumentLanguageFeature=r.TextDocumentEventFeature=r.DynamicDocumentFeature=r.DynamicFeature=r.StaticFeature=r.ensure=r.LSPCancellationError=void 0;const e=Dt,t=Lt,i=Ni,n=Di;class s extends e.CancellationError{constructor(h){super(),this.data=h}}r.LSPCancellationError=s;function o(u,h){return u[h]===void 0&&(u[h]={}),u[h]}r.ensure=o,function(u){function h(g){const m=g;return m!=null&&i.func(m.fillClientCapabilities)&&i.func(m.initialize)&&i.func(m.getState)&&i.func(m.dispose)&&(m.fillInitializeParams===void 0||i.func(m.fillInitializeParams))}u.is=h}(r.StaticFeature||(r.StaticFeature={})),function(u){function h(g){const m=g;return m!=null&&i.func(m.fillClientCapabilities)&&i.func(m.initialize)&&i.func(m.getState)&&i.func(m.dispose)&&(m.fillInitializeParams===void 0||i.func(m.fillInitializeParams))&&i.func(m.register)&&i.func(m.unregister)&&m.registrationType!==void 0}u.is=h}(r.DynamicFeature||(r.DynamicFeature={}));class a{constructor(h){this._client=h}getState(){const h=this.getDocumentSelectors();let g=0;for(const y of h){g++;for(const _ of e.workspace.textDocuments)if(e.languages.match(y,_)>0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}const m=g>0;return{kind:"document",id:this.registrationType.method,registrations:m,matches:!1}}}r.DynamicDocumentFeature=a;class c extends a{constructor(h,g,m,y,_,b,E){super(h),this._event=g,this._type=m,this._middleware=y,this._createParams=_,this._textDocument=b,this._selectorFilter=E,this._selectors=new Map,this._onNotificationSent=new e.EventEmitter}static textDocumentFilter(h,g){for(const m of h)if(e.languages.match(m,g)>0)return!0;return!1}getStateInfo(){return[this._selectors.values(),!1]}getDocumentSelectors(){return this._selectors.values()}register(h){h.registerOptions.documentSelector&&(this._listener||(this._listener=this._event(g=>{this.callback(g).catch(m=>{this._client.error(`Sending document notification ${this._type.method} failed.`,m)})})),this._selectors.set(h.id,this._client.protocol2CodeConverter.asDocumentSelector(h.registerOptions.documentSelector)))}async callback(h){const g=async m=>{const y=this._createParams(m);await this._client.sendNotification(this._type,y),this.notificationSent(this.getTextDocument(m),this._type,y)};if(this.matches(h)){const m=this._middleware();return m?m(h,y=>g(y)):g(h)}}matches(h){return this._client.hasDedicatedTextSynchronizationFeature(this._textDocument(h))?!1:!this._selectorFilter||this._selectorFilter(this._selectors.values(),h)}get onNotificationSent(){return this._onNotificationSent.event}notificationSent(h,g,m){this._onNotificationSent.fire({textDocument:h,type:g,params:m})}unregister(h){this._selectors.delete(h),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._selectors.clear(),this._onNotificationSent.dispose(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getProvider(h){for(const g of this._selectors.values())if(e.languages.match(g,h)>0)return{send:m=>this.callback(m)}}}r.TextDocumentEventFeature=c;class d extends a{constructor(h,g){super(h),this._registrationType=g,this._registrations=new Map}*getDocumentSelectors(){for(const h of this._registrations.values()){const g=h.data.registerOptions.documentSelector;g!==null&&(yield this._client.protocol2CodeConverter.asDocumentSelector(g))}}get registrationType(){return this._registrationType}register(h){if(!h.registerOptions.documentSelector)return;let g=this.registerLanguageProvider(h.registerOptions,h.id);this._registrations.set(h.id,{disposable:g[0],data:h,provider:g[1]})}unregister(h){let g=this._registrations.get(h);g!==void 0&&g.disposable.dispose()}dispose(){this._registrations.forEach(h=>{h.disposable.dispose()}),this._registrations.clear()}getRegistration(h,g){if(g){if(t.TextDocumentRegistrationOptions.is(g)){const m=t.StaticRegistrationOptions.hasId(g)?g.id:n.generateUuid(),y=g.documentSelector??h;if(y)return[m,Object.assign({},g,{documentSelector:y})]}else if(i.boolean(g)&&g===!0||t.WorkDoneProgressOptions.is(g)){if(!h)return[void 0,void 0];const m=i.boolean(g)&&g===!0?{documentSelector:h}:Object.assign({},g,{documentSelector:h});return[n.generateUuid(),m]}}else return[void 0,void 0];return[void 0,void 0]}getRegistrationOptions(h,g){if(!(!h||!g))return i.boolean(g)&&g===!0?{documentSelector:h}:Object.assign({},g,{documentSelector:h})}getProvider(h){for(const g of this._registrations.values()){let m=g.data.registerOptions.documentSelector;if(m!==null&&e.languages.match(this._client.protocol2CodeConverter.asDocumentSelector(m),h)>0)return g.provider}}getAllProviders(){const h=[];for(const g of this._registrations.values())h.push(g.provider);return h}}r.TextDocumentLanguageFeature=d;class l{constructor(h,g){this._client=h,this._registrationType=g,this._registrations=new Map}getState(){const h=this._registrations.size>0;return{kind:"workspace",id:this._registrationType.method,registrations:h}}get registrationType(){return this._registrationType}register(h){const g=this.registerLanguageProvider(h.registerOptions);this._registrations.set(h.id,{disposable:g[0],provider:g[1]})}unregister(h){let g=this._registrations.get(h);g!==void 0&&g.disposable.dispose()}dispose(){this._registrations.forEach(h=>{h.disposable.dispose()}),this._registrations.clear()}getProviders(){const h=[];for(const g of this._registrations.values())h.push(g.provider);return h}}r.WorkspaceFeature=l})(Pi);var tT={};const noe=typeof process=="object"&&process&&process.platform==="win32";var roe=noe?{sep:"\\"}:{sep:"/"},soe=oK;function oK(r,e,t){r instanceof RegExp&&(r=hj(r,t)),e instanceof RegExp&&(e=hj(e,t));var i=aK(r,e,t);return i&&{start:i[0],end:i[1],pre:t.slice(0,i[0]),body:t.slice(i[0]+r.length,i[1]),post:t.slice(i[1]+e.length)}}function hj(r,e){var t=e.match(r);return t?t[0]:null}oK.range=aK;function aK(r,e,t){var i,n,s,o,a,c=t.indexOf(r),d=t.indexOf(e,c+1),l=c;if(c>=0&&d>0){if(r===e)return[c,d];for(i=[],s=t.length;l>=0&&!a;)l==c?(i.push(l),c=t.indexOf(r,l+1)):i.length==1?a=[i.pop(),d]:(n=i.pop(),n<s&&(s=n,o=d),d=t.indexOf(e,l+1)),l=c<d&&c>=0?c:d;i.length&&(a=[s,o])}return a}var cK=soe,ooe=doe,dK="\0SLASH"+Math.random()+"\0",lK="\0OPEN"+Math.random()+"\0",V1="\0CLOSE"+Math.random()+"\0",uK="\0COMMA"+Math.random()+"\0",hK="\0PERIOD"+Math.random()+"\0";function zI(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function aoe(r){return r.split("\\\\").join(dK).split("\\{").join(lK).split("\\}").join(V1).split("\\,").join(uK).split("\\.").join(hK)}function coe(r){return r.split(dK).join("\\").split(lK).join("{").split(V1).join("}").split(uK).join(",").split(hK).join(".")}function fK(r){if(!r)return[""];var e=[],t=cK("{","}",r);if(!t)return r.split(",");var i=t.pre,n=t.body,s=t.post,o=i.split(",");o[o.length-1]+="{"+n+"}";var a=fK(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function doe(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),Bv(aoe(r),!0).map(coe)):[]}function loe(r){return"{"+r+"}"}function uoe(r){return/^-?0\d/.test(r)}function hoe(r,e){return r<=e}function foe(r,e){return r>=e}function Bv(r,e){var t=[],i=cK("{","}",r);if(!i)return[r];var n=i.pre,s=i.post.length?Bv(i.post,!1):[""];if(/\$$/.test(i.pre))for(var o=0;o<s.length;o++){var a=n+"{"+i.body+"}"+s[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),l=c||d,u=i.body.indexOf(",")>=0;if(!l&&!u)return i.post.match(/,.*\}/)?(r=i.pre+"{"+i.body+V1+i.post,Bv(r)):[r];var h;if(l)h=i.body.split(/\.\./);else if(h=fK(i.body),h.length===1&&(h=Bv(h[0],!1).map(loe),h.length===1))return s.map(function(K){return i.pre+h[0]+K});var g;if(l){var m=zI(h[0]),y=zI(h[1]),_=Math.max(h[0].length,h[1].length),b=h.length==3?Math.abs(zI(h[2])):1,E=hoe,D=y<m;D&&(b*=-1,E=foe);var R=h.some(uoe);g=[];for(var M=m;E(M,y);M+=b){var O;if(d)O=String.fromCharCode(M),O==="\\"&&(O="");else if(O=String(M),R){var L=_-O.length;if(L>0){var W=new Array(L+1).join("0");M<0?O="-"+W+O.slice(1):O=W+O}}g.push(O)}}else{g=[];for(var Z=0;Z<h.length;Z++)g.push.apply(g,Bv(h[Z],!1))}for(var Z=0;Z<g.length;Z++)for(var o=0;o<s.length;o++){var a=n+g[Z]+s[o];(!e||l||a)&&t.push(a)}}return t}const po=iT=(r,e,t={})=>(EE(e),!t.nocomment&&e.charAt(0)==="#"?!1:new nT(e,t).match(r));var iT=po;const bM=roe;po.sep=bM.sep;const sa=Symbol("globstar **");po.GLOBSTAR=sa;const poe=ooe,fj={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},SM="[^/]",KI=SM+"*?",goe="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",moe="(?:(?!(?:\\/|^)\\.).)*?",pK=r=>r.split("").reduce((e,t)=>(e[t]=!0,e),{}),pj=pK("().*{}+?[]^$\\!"),voe=pK("[.("),gj=/\/+/;po.filter=(r,e={})=>(t,i,n)=>po(t,r,e);const Gd=(r,e={})=>{const t={};return Object.keys(r).forEach(i=>t[i]=r[i]),Object.keys(e).forEach(i=>t[i]=e[i]),t};po.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return po;const e=po,t=(i,n,s)=>e(i,n,Gd(r,s));return t.Minimatch=class extends e.Minimatch{constructor(n,s){super(n,Gd(r,s))}},t.Minimatch.defaults=i=>e.defaults(Gd(r,i)).Minimatch,t.filter=(i,n)=>e.filter(i,Gd(r,n)),t.defaults=i=>e.defaults(Gd(r,i)),t.makeRe=(i,n)=>e.makeRe(i,Gd(r,n)),t.braceExpand=(i,n)=>e.braceExpand(i,Gd(r,n)),t.match=(i,n,s)=>e.match(i,n,Gd(r,s)),t};po.braceExpand=(r,e)=>gK(r,e);const gK=(r,e={})=>(EE(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:poe(r)),yoe=1024*64,EE=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>yoe)throw new TypeError("pattern is too long")},QI=Symbol("subparse");po.makeRe=(r,e)=>new nT(r,e||{}).makeRe();po.match=(r,e,t={})=>{const i=new nT(e,t);return r=r.filter(n=>i.match(n)),i.options.nonull&&!r.length&&r.push(e),r};const _oe=r=>r.replace(/\\(.)/g,"$1"),woe=r=>r.replace(/\\([^-\]])/g,"$1"),boe=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Soe=r=>r.replace(/[[\]\\]/g,"\\$&");class nT{constructor(e,t){EE(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let i=this.globSet=this.braceExpand();t.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,i),i=this.globParts=i.map(n=>n.split(gj)),this.debug(this.pattern,i),i=i.map((n,s,o)=>n.map(this.parse,this)),this.debug(this.pattern,i),i=i.filter(n=>n.indexOf(!1)===-1),this.debug(this.pattern,i),this.set=i}parseNegate(){if(this.options.nonegate)return;const e=this.pattern;let t=!1,i=0;for(let n=0;n<e.length&&e.charAt(n)==="!";n++)t=!t,i++;i&&(this.pattern=e.slice(i)),this.negate=t}matchOne(e,t,i){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,o=0,a=e.length,c=t.length;s<a&&o<c;s++,o++){this.debug("matchOne loop");var d=t[o],l=e[s];if(this.debug(t,d,l),d===!1)return!1;if(d===sa){this.debug("GLOBSTAR",[t,d,l]);var u=s,h=o+1;if(h===c){for(this.debug("** at the end");s<a;s++)if(e[s]==="."||e[s]===".."||!n.dot&&e[s].charAt(0)===".")return!1;return!0}for(;u<a;){var g=e[u];if(this.debug(`
globstar while`,e,u,t,h,g),this.matchOne(e.slice(u),t.slice(h),i))return this.debug("globstar found match!",u,a,g),!0;if(g==="."||g===".."||!n.dot&&g.charAt(0)==="."){this.debug("dot detected!",e,u,t,h);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(i&&(this.debug(`
>>> no match, partial?`,e,u,t,h),u===a))}var m;if(typeof d=="string"?(m=l===d,this.debug("string match",d,l,m)):(m=l.match(d),this.debug("pattern match",d,l,m)),!m)return!1}if(s===a&&o===c)return!0;if(s===a)return i;if(o===c)return s===a-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return gK(this.pattern,this.options)}parse(e,t){EE(e);const i=this.options;if(e==="**")if(i.noglobstar)e="*";else return sa;if(e==="")return"";let n="",s=!1,o=!1;const a=[],c=[];let d,l=!1,u=-1,h=-1,g,m,y,_=e.charAt(0)===".",b=i.dot||_;const E=()=>_?"":b?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",D=L=>L.charAt(0)==="."?"":i.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",R=()=>{if(d){switch(d){case"*":n+=KI,s=!0;break;case"?":n+=SM,s=!0;break;default:n+="\\"+d;break}this.debug("clearStateChar %j %j",d,n),d=!1}};for(let L=0,W;L<e.length&&(W=e.charAt(L));L++){if(this.debug("%s	%s %s %j",e,L,n,W),o){if(W==="/")return!1;pj[W]&&(n+="\\"),n+=W,o=!1;continue}switch(W){case"/":return!1;case"\\":if(l&&e.charAt(L+1)==="-"){n+=W;continue}R(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,L,n,W),l){this.debug("  in class"),W==="!"&&L===h+1&&(W="^"),n+=W;continue}this.debug("call clearStateChar %j",d),R(),d=W,i.noext&&R();continue;case"(":{if(l){n+="(";continue}if(!d){n+="\\(";continue}const Z={type:d,start:L-1,reStart:n.length,open:fj[d].open,close:fj[d].close};this.debug(this.pattern,"	",Z),a.push(Z),n+=Z.open,Z.start===0&&Z.type!=="!"&&(_=!0,n+=D(e.slice(L+1))),this.debug("plType %j %j",d,n),d=!1;continue}case")":{const Z=a[a.length-1];if(l||!Z){n+="\\)";continue}a.pop(),R(),s=!0,m=Z,n+=m.close,m.type==="!"&&c.push(Object.assign(m,{reEnd:n.length}));continue}case"|":{const Z=a[a.length-1];if(l||!Z){n+="\\|";continue}R(),n+="|",Z.start===0&&Z.type!=="!"&&(_=!0,n+=D(e.slice(L+1)));continue}case"[":if(R(),l){n+="\\"+W;continue}l=!0,h=L,u=n.length,n+=W;continue;case"]":if(L===h+1||!l){n+="\\"+W;continue}g=e.substring(h+1,L);try{RegExp("["+Soe(woe(g))+"]"),n+=W}catch{n=n.substring(0,u)+"(?:$.)"}s=!0,l=!1;continue;default:R(),pj[W]&&!(W==="^"&&l)&&(n+="\\"),n+=W;break}}for(l&&(g=e.slice(h+1),y=this.parse(g,QI),n=n.substring(0,u)+"\\["+y[0],s=s||y[1]),m=a.pop();m;m=a.pop()){let L;L=n.slice(m.reStart+m.open.length),this.debug("setting tail",n,m),L=L.replace(/((?:\\{2}){0,64})(\\?)\|/g,(Z,K,H)=>(H||(H="\\"),K+K+H+"|")),this.debug(`tail=%j
   %s`,L,L,m,n);const W=m.type==="*"?KI:m.type==="?"?SM:"\\"+m.type;s=!0,n=n.slice(0,m.reStart)+W+"\\("+L}R(),o&&(n+="\\\\");const M=voe[n.charAt(0)];for(let L=c.length-1;L>-1;L--){const W=c[L],Z=n.slice(0,W.reStart),K=n.slice(W.reStart,W.reEnd-8);let H=n.slice(W.reEnd);const C=n.slice(W.reEnd-8,W.reEnd)+H,B=Z.split(")").length,te=Z.split("(").length-B;let ue=H;for(let de=0;de<te;de++)ue=ue.replace(/\)[+*?]?/,"");H=ue;const be=H===""&&t!==QI?"(?:$|\\/)":"";n=Z+K+H+be+C}if(n!==""&&s&&(n="(?=.)"+n),M&&(n=E()+n),t===QI)return[n,s];if(i.nocase&&!s&&(s=e.toUpperCase()!==e.toLowerCase()),!s)return _oe(e);const O=i.nocase?"i":"";try{return Object.assign(new RegExp("^"+n+"$",O),{_glob:e,_src:n})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,i=t.noglobstar?KI:t.dot?goe:moe,n=t.nocase?"i":"";let s=e.map(o=>(o=o.map(a=>typeof a=="string"?boe(a):a===sa?sa:a._src).reduce((a,c)=>(a[a.length-1]===sa&&c===sa||a.push(c),a),[]),o.forEach((a,c)=>{a!==sa||o[c-1]===sa||(c===0?o.length>1?o[c+1]="(?:\\/|"+i+"\\/)?"+o[c+1]:o[c]=i:c===o.length-1?o[c-1]+="(?:\\/|"+i+")?":(o[c-1]+="(?:\\/|\\/"+i+"\\/)"+o[c+1],o[c+1]=sa))}),o.filter(a=>a!==sa).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,n)}catch{this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const i=this.options;bM.sep!=="/"&&(e=e.split(bM.sep).join("/")),e=e.split(gj),this.debug(this.pattern,"split",e);const n=this.set;this.debug(this.pattern,"set",n);let s;for(let o=e.length-1;o>=0&&(s=e[o],!s);o--);for(let o=0;o<n.length;o++){const a=n[o];let c=e;if(i.matchBase&&a.length===1&&(c=[s]),this.matchOne(c,a,t))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(e){return po.defaults(e).Minimatch}}po.Minimatch=nT;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DiagnosticFeature=r.DiagnosticPullMode=r.vsdiag=void 0;const e=iT,t=Dt,i=Lt,n=Di,s=Pi;function o(E,D){return E[D]===void 0&&(E[D]={}),E[D]}var a;(function(E){(function(D){D.full="full",D.unChanged="unChanged"})(E.DocumentDiagnosticReportKind||(E.DocumentDiagnosticReportKind={}))})(a=r.vsdiag||(r.vsdiag={}));var c;(function(E){E.onType="onType",E.onSave="onSave"})(c=r.DiagnosticPullMode||(r.DiagnosticPullMode={}));var d;(function(E){E.active="open",E.reschedule="reschedule",E.outDated="drop"})(d||(d={}));class l{constructor(){this.open=new Set,this._onOpen=new t.EventEmitter,this._onClose=new t.EventEmitter,l.fillTabResources(this.open);const D=R=>{if(R.closed.length===0&&R.opened.length===0)return;const M=this.open,O=new Set;l.fillTabResources(O);const L=new Set,W=new Set(O);for(const Z of M.values())O.has(Z)?W.delete(Z):L.add(Z);if(this.open=O,L.size>0){const Z=new Set;for(const K of L)Z.add(t.Uri.parse(K));this._onClose.fire(Z)}if(W.size>0){const Z=new Set;for(const K of W)Z.add(t.Uri.parse(K));this._onOpen.fire(Z)}};t.window.tabGroups.onDidChangeTabs!==void 0?this.disposable=t.window.tabGroups.onDidChangeTabs(D):this.disposable={dispose:()=>{}}}get onClose(){return this._onClose.event}get onOpen(){return this._onOpen.event}dispose(){this.disposable.dispose()}isActive(D){var R,M;return D instanceof t.Uri?((R=t.window.activeTextEditor)==null?void 0:R.document.uri)===D:((M=t.window.activeTextEditor)==null?void 0:M.document)===D}isVisible(D){const R=D instanceof t.Uri?D:D.uri;return this.open.has(R.toString())}getTabResources(){const D=new Set;return l.fillTabResources(new Set,D),D}static fillTabResources(D,R){const M=D??new Set;for(const O of t.window.tabGroups.all)for(const L of O.tabs){const W=L.input;let Z;W instanceof t.TabInputText?Z=W.uri:W instanceof t.TabInputTextDiff&&(Z=W.modified),Z!==void 0&&!M.has(Z.toString())&&(M.add(Z.toString()),R!==void 0&&R.add(Z))}}}var u;(function(E){E[E.document=1]="document",E[E.workspace=2]="workspace"})(u||(u={}));var h;(function(E){function D(R){return R instanceof t.Uri?R.toString():R.uri.toString()}E.asKey=D})(h||(h={}));class g{constructor(){this.documentPullStates=new Map,this.workspacePullStates=new Map}track(D,R,M){const O=D===u.document?this.documentPullStates:this.workspacePullStates,[L,W,Z]=R instanceof t.Uri?[R.toString(),R,M]:[R.uri.toString(),R.uri,R.version];let K=O.get(L);return K===void 0&&(K={document:W,pulledVersion:Z,resultId:void 0},O.set(L,K)),K}update(D,R,M,O){const L=D===u.document?this.documentPullStates:this.workspacePullStates,[W,Z,K,H]=R instanceof t.Uri?[R.toString(),R,M,O]:[R.uri.toString(),R.uri,R.version,M];let C=L.get(W);C===void 0?(C={document:Z,pulledVersion:K,resultId:H},L.set(W,C)):(C.pulledVersion=K,C.resultId=H)}unTrack(D,R){const M=h.asKey(R);(D===u.document?this.documentPullStates:this.workspacePullStates).delete(M)}tracks(D,R){const M=h.asKey(R);return(D===u.document?this.documentPullStates:this.workspacePullStates).has(M)}getResultId(D,R){var L;const M=h.asKey(R);return(L=(D===u.document?this.documentPullStates:this.workspacePullStates).get(M))==null?void 0:L.resultId}getAllResultIds(){const D=[];for(let[R,M]of this.workspacePullStates)this.documentPullStates.has(R)&&(M=this.documentPullStates.get(R)),M.resultId!==void 0&&D.push({uri:R,value:M.resultId});return D}}class m{constructor(D,R,M){this.client=D,this.tabs=R,this.options=M,this.isDisposed=!1,this.onDidChangeDiagnosticsEmitter=new t.EventEmitter,this.provider=this.createProvider(),this.diagnostics=t.languages.createDiagnosticCollection(M.identifier),this.openRequests=new Map,this.documentStates=new g,this.workspaceErrorCounter=0}knows(D,R){const M=R instanceof t.Uri?R:R.uri;return this.documentStates.tracks(D,R)||this.openRequests.has(M.toString())}forget(D,R){this.documentStates.unTrack(D,R)}pull(D,R){if(this.isDisposed)return;const M=D instanceof t.Uri?D:D.uri;this.pullAsync(D).then(()=>{R&&R()},O=>{this.client.error(`Document pull failed for text document ${M.toString()}`,O,!1)})}async pullAsync(D,R){if(this.isDisposed)return;const M=D instanceof t.Uri,O=M?D:D.uri,L=O.toString();R=M?R:D.version;const W=this.openRequests.get(L),Z=M?this.documentStates.track(u.document,D,R):this.documentStates.track(u.document,D);if(W===void 0){const K=new t.CancellationTokenSource;this.openRequests.set(L,{state:d.active,document:D,version:R,tokenSource:K});let H,C;try{H=await this.provider.provideDiagnostics(D,Z.resultId,K.token)??{kind:a.DocumentDiagnosticReportKind.full,items:[]}}catch(B){if(B instanceof s.LSPCancellationError&&i.DiagnosticServerCancellationData.is(B.data)&&B.data.retriggerRequest===!1&&(C={state:d.outDated,document:D}),C===void 0&&B instanceof t.CancellationError)C={state:d.reschedule,document:D};else throw B}if(C=C??this.openRequests.get(L),C===void 0){this.client.error(`Lost request state in diagnostic pull model. Clearing diagnostics for ${L}`),this.diagnostics.delete(O);return}if(this.openRequests.delete(L),!this.tabs.isVisible(D)){this.documentStates.unTrack(u.document,D);return}if(C.state===d.outDated)return;H!==void 0&&(H.kind===a.DocumentDiagnosticReportKind.full&&this.diagnostics.set(O,H.items),Z.pulledVersion=R,Z.resultId=H.resultId),C.state===d.reschedule&&this.pull(D)}else W.state===d.active?(W.tokenSource.cancel(),this.openRequests.set(L,{state:d.reschedule,document:W.document})):W.state===d.outDated&&this.openRequests.set(L,{state:d.reschedule,document:W.document})}forgetDocument(D){const R=D instanceof t.Uri?D:D.uri,M=R.toString(),O=this.openRequests.get(M);this.options.workspaceDiagnostics?O!==void 0?this.openRequests.set(M,{state:d.reschedule,document:D}):this.pull(D,()=>{this.forget(u.document,D)}):(O!==void 0&&(O.state===d.active&&O.tokenSource.cancel(),this.openRequests.set(M,{state:d.outDated,document:D})),this.diagnostics.delete(R),this.forget(u.document,D))}pullWorkspace(){this.isDisposed||this.pullWorkspaceAsync().then(()=>{this.workspaceTimeout=(0,i.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3)},D=>{!(D instanceof s.LSPCancellationError)&&!i.DiagnosticServerCancellationData.is(D.data)&&(this.client.error("Workspace diagnostic pull failed.",D,!1),this.workspaceErrorCounter++),this.workspaceErrorCounter<=5&&(this.workspaceTimeout=(0,i.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3))})}async pullWorkspaceAsync(){if(!this.provider.provideWorkspaceDiagnostics||this.isDisposed)return;this.workspaceCancellation!==void 0&&(this.workspaceCancellation.cancel(),this.workspaceCancellation=void 0),this.workspaceCancellation=new t.CancellationTokenSource;const D=this.documentStates.getAllResultIds().map(R=>({uri:this.client.protocol2CodeConverter.asUri(R.uri),value:R.value}));await this.provider.provideWorkspaceDiagnostics(D,this.workspaceCancellation.token,R=>{if(!(!R||this.isDisposed))for(const M of R.items)M.kind===a.DocumentDiagnosticReportKind.full&&(this.documentStates.tracks(u.document,M.uri)||this.diagnostics.set(M.uri,M.items)),this.documentStates.update(u.workspace,M.uri,M.version??void 0,M.resultId)})}createProvider(){const D={onDidChangeDiagnostics:this.onDidChangeDiagnosticsEmitter.event,provideDiagnostics:(R,M,O)=>{const L=(Z,K,H)=>{const C={identifier:this.options.identifier,textDocument:{uri:this.client.code2ProtocolConverter.asUri(Z instanceof t.Uri?Z:Z.uri)},previousResultId:K};return this.isDisposed===!0||!this.client.isRunning()?{kind:a.DocumentDiagnosticReportKind.full,items:[]}:this.client.sendRequest(i.DocumentDiagnosticRequest.type,C,H).then(async B=>B==null||this.isDisposed||H.isCancellationRequested?{kind:a.DocumentDiagnosticReportKind.full,items:[]}:B.kind===i.DocumentDiagnosticReportKind.Full?{kind:a.DocumentDiagnosticReportKind.full,resultId:B.resultId,items:await this.client.protocol2CodeConverter.asDiagnostics(B.items,H)}:{kind:a.DocumentDiagnosticReportKind.unChanged,resultId:B.resultId},B=>this.client.handleFailedRequest(i.DocumentDiagnosticRequest.type,H,B,{kind:a.DocumentDiagnosticReportKind.full,items:[]}))},W=this.client.middleware;return W.provideDiagnostics?W.provideDiagnostics(R,M,O,L):L(R,M,O)}};return this.options.workspaceDiagnostics&&(D.provideWorkspaceDiagnostics=(R,M,O)=>{const L=async H=>H.kind===i.DocumentDiagnosticReportKind.Full?{kind:a.DocumentDiagnosticReportKind.full,uri:this.client.protocol2CodeConverter.asUri(H.uri),resultId:H.resultId,version:H.version,items:await this.client.protocol2CodeConverter.asDiagnostics(H.items,M)}:{kind:a.DocumentDiagnosticReportKind.unChanged,uri:this.client.protocol2CodeConverter.asUri(H.uri),resultId:H.resultId,version:H.version},W=H=>{const C=[];for(const B of H)C.push({uri:this.client.code2ProtocolConverter.asUri(B.uri),value:B.value});return C},Z=(H,C)=>{const B=(0,n.generateUuid)(),te=this.client.onProgress(i.WorkspaceDiagnosticRequest.partialResult,B,async be=>{if(be==null){O(null);return}const de={items:[]};for(const le of be.items)try{de.items.push(await L(le))}catch(Me){this.client.error("Converting workspace diagnostics failed.",Me)}O(de)}),ue={identifier:this.options.identifier,previousResultIds:W(H),partialResultToken:B};return this.isDisposed===!0||!this.client.isRunning()?{items:[]}:this.client.sendRequest(i.WorkspaceDiagnosticRequest.type,ue,C).then(async be=>{if(C.isCancellationRequested)return{items:[]};const de={items:[]};for(const le of be.items)de.items.push(await L(le));return te.dispose(),O(de),{items:[]}},be=>(te.dispose(),this.client.handleFailedRequest(i.DocumentDiagnosticRequest.type,C,be,{items:[]})))},K=this.client.middleware;return K.provideWorkspaceDiagnostics?K.provideWorkspaceDiagnostics(R,M,O,Z):Z(R,M)}),D}dispose(){var D,R;this.isDisposed=!0,(D=this.workspaceCancellation)==null||D.cancel(),(R=this.workspaceTimeout)==null||R.dispose();for(const[M,O]of this.openRequests)O.state===d.active&&O.tokenSource.cancel(),this.openRequests.set(M,{state:d.outDated,document:O.document});this.diagnostics.dispose()}}class y{constructor(D){this.diagnosticRequestor=D,this.documents=new i.LinkedMap,this.isDisposed=!1}add(D){if(this.isDisposed===!0)return;const R=h.asKey(D);this.documents.has(R)||(this.documents.set(R,D,i.Touch.Last),this.trigger())}remove(D){const R=h.asKey(D);this.documents.delete(R),this.documents.size===0?this.stop():R===this.endDocumentKey()&&(this.endDocument=this.documents.last)}trigger(){if(this.isDisposed!==!0){if(this.intervalHandle!==void 0){this.endDocument=this.documents.last;return}this.endDocument=this.documents.last,this.intervalHandle=(0,i.RAL)().timer.setInterval(()=>{const D=this.documents.first;if(D!==void 0){const R=h.asKey(D);this.diagnosticRequestor.pull(D),this.documents.set(R,D,i.Touch.Last),R===this.endDocumentKey()&&this.stop()}},200)}}dispose(){this.isDisposed=!0,this.stop(),this.documents.clear()}stop(){var D;(D=this.intervalHandle)==null||D.dispose(),this.intervalHandle=void 0,this.endDocument=void 0}endDocumentKey(){return this.endDocument!==void 0?h.asKey(this.endDocument):void 0}}class _{constructor(D,R,M){var be;const O=D.clientOptions.diagnosticPullOptions??{onChange:!0,onSave:!1},L=D.protocol2CodeConverter.asDocumentSelector(M.documentSelector),W=[],Z=de=>{const le=M.documentSelector;if(O.match!==void 0)return O.match(le,de);for(const Me of le)if(i.TextDocumentFilter.is(Me)){if(typeof Me=="string"||Me.language!==void 0&&Me.language!=="*"||Me.scheme!==void 0&&Me.scheme!=="*"&&Me.scheme!==de.scheme)return!1;if(Me.pattern!==void 0){const Re=new e.Minimatch(Me.pattern,{noext:!0});if(!Re.makeRe()||!Re.match(de.fsPath))return!1}}return!0},K=de=>de instanceof t.Uri?Z(de):t.languages.match(L,de)>0&&R.isVisible(de),H=de=>{var le;return de instanceof t.Uri?((le=this.activeTextDocument)==null?void 0:le.uri.toString())===de.toString():this.activeTextDocument===de};this.diagnosticRequestor=new m(D,R,M),this.backgroundScheduler=new y(this.diagnosticRequestor);const C=de=>{!K(de)||!M.interFileDependencies||H(de)||this.backgroundScheduler.add(de)};this.activeTextDocument=(be=t.window.activeTextEditor)==null?void 0:be.document,t.window.onDidChangeActiveTextEditor(de=>{const le=this.activeTextDocument;this.activeTextDocument=de==null?void 0:de.document,le!==void 0&&C(le),this.activeTextDocument!==void 0&&this.backgroundScheduler.remove(this.activeTextDocument)});const B=D.getFeature(i.DidOpenTextDocumentNotification.method);W.push(B.onNotificationSent(de=>{const le=de.textDocument;this.diagnosticRequestor.knows(u.document,le)||K(le)&&this.diagnosticRequestor.pull(le,()=>{C(le)})})),R.onOpen(de=>{for(const le of de){if(this.diagnosticRequestor.knows(u.document,le))continue;const Me=le.toString();let Re;for(const Oe of t.workspace.textDocuments)if(Me===Oe.uri.toString()){Re=Oe;break}Re!==void 0&&K(Re)?this.diagnosticRequestor.pull(Re,()=>{C(Re)}):K(le)&&this.diagnosticRequestor.pull(le,()=>{C(le)})}});const te=new Set;for(const de of t.workspace.textDocuments)K(de)&&(this.diagnosticRequestor.pull(de,()=>{C(de)}),te.add(de.uri.toString()));if(O.onTabs===!0)for(const de of R.getTabResources())!te.has(de.toString())&&K(de)&&this.diagnosticRequestor.pull(de,()=>{C(de)});if(O.onChange===!0){const de=D.getFeature(i.DidChangeTextDocumentNotification.method);W.push(de.onNotificationSent(async le=>{const Me=le.textDocument;(O.filter===void 0||!O.filter(Me,c.onType))&&this.diagnosticRequestor.knows(u.document,Me)&&this.diagnosticRequestor.pull(Me,()=>{this.backgroundScheduler.trigger()})}))}if(O.onSave===!0){const de=D.getFeature(i.DidSaveTextDocumentNotification.method);W.push(de.onNotificationSent(le=>{const Me=le.textDocument;(O.filter===void 0||!O.filter(Me,c.onSave))&&this.diagnosticRequestor.knows(u.document,Me)&&this.diagnosticRequestor.pull(le.textDocument,()=>{this.backgroundScheduler.trigger()})}))}const ue=D.getFeature(i.DidCloseTextDocumentNotification.method);W.push(ue.onNotificationSent(de=>{this.cleanUpDocument(de.textDocument)})),R.onClose(de=>{for(const le of de)this.cleanUpDocument(le)}),this.diagnosticRequestor.onDidChangeDiagnosticsEmitter.event(()=>{for(const de of t.workspace.textDocuments)K(de)&&this.diagnosticRequestor.pull(de)}),M.workspaceDiagnostics===!0&&M.identifier!=="da348dc5-c30a-4515-9d98-31ff3be38d14"&&this.diagnosticRequestor.pullWorkspace(),this.disposable=t.Disposable.from(...W,this.backgroundScheduler,this.diagnosticRequestor)}get onDidChangeDiagnosticsEmitter(){return this.diagnosticRequestor.onDidChangeDiagnosticsEmitter}get diagnostics(){return this.diagnosticRequestor.provider}cleanUpDocument(D){this.diagnosticRequestor.knows(u.document,D)&&(this.diagnosticRequestor.forgetDocument(D),this.backgroundScheduler.remove(D))}}class b extends s.TextDocumentLanguageFeature{constructor(D){super(D,i.DocumentDiagnosticRequest.type)}fillClientCapabilities(D){let R=o(o(D,"textDocument"),"diagnostic");R.dynamicRegistration=!0,R.relatedDocumentSupport=!1,o(o(D,"workspace"),"diagnostics").refreshSupport=!0}initialize(D,R){this._client.onRequest(i.DiagnosticRefreshRequest.type,async()=>{for(const W of this.getAllProviders())W.onDidChangeDiagnosticsEmitter.fire()});let[O,L]=this.getRegistration(R,D.diagnosticProvider);!O||!L||this.register({id:O,registerOptions:L})}dispose(){this.tabs!==void 0&&(this.tabs.dispose(),this.tabs=void 0),super.dispose()}registerLanguageProvider(D){this.tabs===void 0&&(this.tabs=new l);const R=new _(this._client,this.tabs,D);return[R.disposable,R]}}r.DiagnosticFeature=b})(tT);var rT={};Object.defineProperty(rT,"__esModule",{value:!0});var mK=rT.NotebookDocumentSyncFeature=void 0;const Jr=Dt,Coe=iT,ed=Lt,Eoe=Di,mj=Ni;function vj(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var Bp;(function(r){(function(e){function t(u,h){return{version:u.version,uri:h.asUri(u.uri)}}e.asVersionedNotebookDocumentIdentifier=t;function i(u,h,g){const m=ed.NotebookDocument.create(g.asUri(u.uri),u.notebookType,u.version,n(h,g));return Object.keys(u.metadata).length>0&&(m.metadata=s(u.metadata)),m}e.asNotebookDocument=i;function n(u,h){return u.map(g=>o(g,h))}e.asNotebookCells=n;function s(u){return c(new Set,u)}e.asMetadata=s;function o(u,h){const g=ed.NotebookCell.create(a(u.kind),h.asUri(u.document.uri));return Object.keys(u.metadata).length>0&&(g.metadata=s(u.metadata)),u.executionSummary!==void 0&&mj.number(u.executionSummary.executionOrder)&&mj.boolean(u.executionSummary.success)&&(g.executionSummary={executionOrder:u.executionSummary.executionOrder,success:u.executionSummary.success}),g}e.asNotebookCell=o;function a(u){switch(u){case Jr.NotebookCellKind.Markup:return ed.NotebookCellKind.Markup;case Jr.NotebookCellKind.Code:return ed.NotebookCellKind.Code}}function c(u,h){if(u.has(h))throw new Error("Can't deep copy cyclic structures.");if(Array.isArray(h)){const g=[];for(const m of h)if(m!==null&&typeof m=="object"||Array.isArray(m))g.push(c(u,m));else{if(m instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");g.push(m)}return g}else{const g=Object.keys(h),m=Object.create(null);for(const y of g){const _=h[y];if(_!==null&&typeof _=="object"||Array.isArray(_))m[y]=c(u,_);else{if(_ instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");m[y]=_}}return m}}function d(u,h){const g=h.asChangeTextDocumentParams(u,u.document.uri,u.document.version);return{document:g.textDocument,changes:g.contentChanges}}e.asTextContentChange=d;function l(u,h){const g=Object.create(null);if(u.metadata&&(g.metadata=r.c2p.asMetadata(u.metadata)),u.cells!==void 0){const m=Object.create(null),y=u.cells;y.structure&&(m.structure={array:{start:y.structure.array.start,deleteCount:y.structure.array.deleteCount,cells:y.structure.array.cells!==void 0?y.structure.array.cells.map(_=>r.c2p.asNotebookCell(_,h)):void 0},didOpen:y.structure.didOpen!==void 0?y.structure.didOpen.map(_=>h.asOpenTextDocumentParams(_.document).textDocument):void 0,didClose:y.structure.didClose!==void 0?y.structure.didClose.map(_=>h.asCloseTextDocumentParams(_.document).textDocument):void 0}),y.data!==void 0&&(m.data=y.data.map(_=>r.c2p.asNotebookCell(_,h))),y.textContent!==void 0&&(m.textContent=y.textContent.map(_=>r.c2p.asTextContentChange(_,h))),Object.keys(m).length>0&&(g.cells=m)}return g}e.asNotebookDocumentChangeEvent=l})(r.c2p||(r.c2p={}))})(Bp||(Bp={}));var CM;(function(r){function e(a,c,d){const l=a.length,u=c.length;let h=0;for(;h<u&&h<l&&t(a[h],c[h],d);)h++;if(h<u&&h<l){let g=l-1,m=u-1;for(;g>=0&&m>=0&&t(a[g],c[m],d);)g--,m--;const y=g+1-h,_=h===m+1?void 0:c.slice(h,m+1);return _!==void 0?{start:h,deleteCount:y,cells:_}:{start:h,deleteCount:y}}else return h<u?{start:h,deleteCount:0,cells:c.slice(h)}:h<l?{start:h,deleteCount:l-h}:void 0}r.computeDiff=e;function t(a,c,d=!0){return a.kind!==c.kind||a.document.uri.toString()!==c.document.uri.toString()||a.document.languageId!==c.document.languageId||!i(a.executionSummary,c.executionSummary)?!1:!d||d&&s(a.metadata,c.metadata)}function i(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.executionOrder===c.executionOrder&&a.success===c.success&&n(a.timing,c.timing)}function n(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.startTime===c.startTime&&a.endTime===c.endTime}function s(a,c){if(a===c)return!0;if(a==null||c===null||c===void 0||typeof a!=typeof c||typeof a!="object")return!1;const d=Array.isArray(a),l=Array.isArray(c);if(d!==l)return!1;if(d&&l){if(a.length!==c.length)return!1;for(let u=0;u<a.length;u++)if(!s(a[u],c[u]))return!1}if(o(a)&&o(c)){const u=Object.keys(a),h=Object.keys(c);if(u.length!==h.length||(u.sort(),h.sort(),!s(u,h)))return!1;for(let g=0;g<u.length;g++){const m=u[g];if(!s(a[m],c[m]))return!1}return!0}return!1}function o(a){return a!==null&&typeof a=="object"}r.isObjectLiteral=o})(CM||(CM={}));var EM;(function(r){function e(t,i){if(typeof t=="string")return t==="*"||i.notebookType===t;if(t.notebookType!==void 0&&t.notebookType!=="*"&&i.notebookType!==t.notebookType)return!1;const n=i.uri;if(t.scheme!==void 0&&t.scheme!=="*"&&n.scheme!==t.scheme)return!1;if(t.pattern!==void 0){const s=new Coe.Minimatch(t.pattern,{noext:!0});if(!s.makeRe()||!s.match(n.fsPath))return!1}return!0}r.matchNotebook=e})(EM||(EM={}));var xE;(function(r){function e(i){var o,a,c;const n=i.notebookSelector,s=[];for(const d of n){const l=(typeof d.notebook=="string"?d.notebook:(o=d.notebook)==null?void 0:o.notebookType)??"*",u=typeof d.notebook=="string"||(a=d.notebook)==null?void 0:a.scheme,h=typeof d.notebook=="string"||(c=d.notebook)==null?void 0:c.pattern;if(d.cells!==void 0)for(const g of d.cells)s.push(t(l,u,h,g.language));else s.push(t(l,u,h,void 0))}return s}r.asDocumentSelector=e;function t(i,n,s,o){return n===void 0&&s===void 0?{notebook:i,language:o}:{notebook:{notebookType:i,scheme:n,pattern:s},language:o}}})(xE||(xE={}));var DE;(function(r){function e(t){return{cells:t,uris:new Set(t.map(i=>i.document.uri.toString()))}}r.create=e})(DE||(DE={}));class Hb{constructor(e,t){this.client=e,this.options=t,this.notebookSyncInfo=new Map,this.notebookDidOpen=new Set,this.disposables=[],this.selector=e.protocol2CodeConverter.asDocumentSelector(xE.asDocumentSelector(t)),Jr.workspace.onDidOpenNotebookDocument(i=>{this.notebookDidOpen.add(i.uri.toString()),this.didOpen(i)},void 0,this.disposables);for(const i of Jr.workspace.notebookDocuments)this.notebookDidOpen.add(i.uri.toString()),this.didOpen(i);Jr.workspace.onDidChangeNotebookDocument(i=>this.didChangeNotebookDocument(i),void 0,this.disposables),this.options.save===!0&&Jr.workspace.onDidSaveNotebookDocument(i=>this.didSave(i),void 0,this.disposables),Jr.workspace.onDidCloseNotebookDocument(i=>{this.didClose(i),this.notebookDidOpen.delete(i.uri.toString())},void 0,this.disposables)}getState(){for(const e of Jr.workspace.notebookDocuments)if(this.getMatchingCells(e)!==void 0)return{kind:"document",id:"$internal",registrations:!0,matches:!0};return{kind:"document",id:"$internal",registrations:!0,matches:!1}}get mode(){return"notebook"}handles(e){return Jr.languages.match(this.selector,e)>0}didOpenNotebookCellTextDocument(e,t){if(Jr.languages.match(this.selector,t.document)===0||!this.notebookDidOpen.has(e.uri.toString()))return;const i=this.notebookSyncInfo.get(e.uri.toString()),n=this.cellMatches(e,t);if(i!==void 0){const s=i.uris.has(t.document.uri.toString());if(n&&s||!n&&!s)return;if(n){const o=this.getMatchingCells(e);if(o!==void 0){const a=this.asNotebookDocumentChangeEvent(e,void 0,i,o);a!==void 0&&this.doSendChange(a,o).catch(()=>{})}}}else n&&this.doSendOpen(e,[t]).catch(()=>{})}didChangeNotebookCellTextDocument(e,t){Jr.languages.match(this.selector,t.document)!==0&&this.doSendChange({notebook:e,cells:{textContent:[t]}},void 0).catch(()=>{})}didCloseNotebookCellTextDocument(e,t){const i=this.notebookSyncInfo.get(e.uri.toString());if(i===void 0)return;const n=t.document.uri,s=i.cells.findIndex(o=>o.document.uri.toString()===n.toString());if(s!==-1)if(s===0&&i.cells.length===1)this.doSendClose(e,i.cells).catch(()=>{});else{const o=i.cells.slice(),a=o.splice(s,1);this.doSendChange({notebook:e,cells:{structure:{array:{start:s,deleteCount:1},didClose:a}}},o).catch(()=>{})}}dispose(){for(const e of this.disposables)e.dispose()}didOpen(e,t=this.getMatchingCells(e),i=this.notebookSyncInfo.get(e.uri.toString())){if(i!==void 0)if(t!==void 0){const n=this.asNotebookDocumentChangeEvent(e,void 0,i,t);n!==void 0&&this.doSendChange(n,t).catch(()=>{})}else this.doSendClose(e,[]).catch(()=>{});else{if(t===void 0)return;this.doSendOpen(e,t).catch(()=>{})}}didChangeNotebookDocument(e){const t=e.notebook,i=this.notebookSyncInfo.get(t.uri.toString());if(i===void 0){if(e.contentChanges.length===0)return;const n=this.getMatchingCells(t);if(n===void 0)return;this.didOpen(t,n,i)}else{const n=this.getMatchingCells(t);if(n===void 0){this.didClose(t,i);return}const s=this.asNotebookDocumentChangeEvent(e.notebook,e,i,n);s!==void 0&&this.doSendChange(s,n).catch(()=>{})}}didSave(e){this.notebookSyncInfo.get(e.uri.toString())!==void 0&&this.doSendSave(e).catch(()=>{})}didClose(e,t=this.notebookSyncInfo.get(e.uri.toString())){if(t===void 0)return;const i=e.getCells().filter(n=>t.uris.has(n.document.uri.toString()));this.doSendClose(e,i).catch(()=>{})}async sendDidOpenNotebookDocument(e){const t=this.getMatchingCells(e);if(t!==void 0)return this.doSendOpen(e,t)}async doSendOpen(e,t){var s;const i=async(o,a)=>{const c=Bp.c2p.asNotebookDocument(o,a,this.client.code2ProtocolConverter),d=a.map(l=>this.client.code2ProtocolConverter.asTextDocumentItem(l.document));try{await this.client.sendNotification(ed.DidOpenNotebookDocumentNotification.type,{notebookDocument:c,cellTextDocuments:d})}catch(l){throw this.client.error("Sending DidOpenNotebookDocumentNotification failed",l),l}},n=(s=this.client.middleware)==null?void 0:s.notebooks;return this.notebookSyncInfo.set(e.uri.toString(),DE.create(t)),(n==null?void 0:n.didOpen)!==void 0?n.didOpen(e,t,i):i(e,t)}async sendDidChangeNotebookDocument(e){return this.doSendChange(e,void 0)}async doSendChange(e,t=this.getMatchingCells(e.notebook)){var s,o;const i=async a=>{try{await this.client.sendNotification(ed.DidChangeNotebookDocumentNotification.type,{notebookDocument:Bp.c2p.asVersionedNotebookDocumentIdentifier(a.notebook,this.client.code2ProtocolConverter),change:Bp.c2p.asNotebookDocumentChangeEvent(a,this.client.code2ProtocolConverter)})}catch(c){throw this.client.error("Sending DidChangeNotebookDocumentNotification failed",c),c}},n=(s=this.client.middleware)==null?void 0:s.notebooks;return((o=e.cells)==null?void 0:o.structure)!==void 0&&this.notebookSyncInfo.set(e.notebook.uri.toString(),DE.create(t??[])),(n==null?void 0:n.didChange)!==void 0?n==null?void 0:n.didChange(e,i):i(e)}async sendDidSaveNotebookDocument(e){return this.doSendSave(e)}async doSendSave(e){var n;const t=async s=>{try{await this.client.sendNotification(ed.DidSaveNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(s.uri)}})}catch(o){throw this.client.error("Sending DidSaveNotebookDocumentNotification failed",o),o}},i=(n=this.client.middleware)==null?void 0:n.notebooks;return(i==null?void 0:i.didSave)!==void 0?i.didSave(e,t):t(e)}async sendDidCloseNotebookDocument(e){return this.doSendClose(e,this.getMatchingCells(e)??[])}async doSendClose(e,t){var s;const i=async(o,a)=>{try{await this.client.sendNotification(ed.DidCloseNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(o.uri)},cellTextDocuments:a.map(c=>this.client.code2ProtocolConverter.asTextDocumentIdentifier(c.document))})}catch(c){throw this.client.error("Sending DidCloseNotebookDocumentNotification failed",c),c}},n=(s=this.client.middleware)==null?void 0:s.notebooks;return this.notebookSyncInfo.delete(e.uri.toString()),(n==null?void 0:n.didClose)!==void 0?n.didClose(e,t,i):i(e,t)}asNotebookDocumentChangeEvent(e,t,i,n){if(t!==void 0&&t.notebook!==e)throw new Error("Notebook must be identical");const s={notebook:e};(t==null?void 0:t.metadata)!==void 0&&(s.metadata=Bp.c2p.asMetadata(t.metadata));let o;if((t==null?void 0:t.cellChanges)!==void 0&&t.cellChanges.length>0){const a=[];o=new Set(n.map(c=>c.document.uri.toString()));for(const c of t.cellChanges)o.has(c.cell.document.uri.toString())&&(c.executionSummary!==void 0||c.metadata!==void 0)&&a.push(c.cell);a.length>0&&(s.cells=s.cells??{},s.cells.data=a)}if(((t==null?void 0:t.contentChanges)!==void 0&&t.contentChanges.length>0||t===void 0)&&i!==void 0&&n!==void 0){const a=i.cells,c=n,d=CM.computeDiff(a,c,!1);let l,u;if(d!==void 0){l=d.cells===void 0?new Map:new Map(d.cells.map(m=>[m.document.uri.toString(),m])),u=d.deleteCount===0?new Map:new Map(a.slice(d.start,d.start+d.deleteCount).map(m=>[m.document.uri.toString(),m]));for(const m of Array.from(u.keys()))l.has(m)&&(u.delete(m),l.delete(m));s.cells=s.cells??{};const h=[],g=[];if(l.size>0||u.size>0){for(const m of l.values())h.push(m);for(const m of u.values())g.push(m)}s.cells.structure={array:d,didOpen:h,didClose:g}}}return Object.keys(s).length>1?s:void 0}getMatchingCells(e,t=e.getCells()){if(this.options.notebookSelector!==void 0){for(const i of this.options.notebookSelector)if(i.notebook===void 0||EM.matchNotebook(i.notebook,e)){const n=this.filterCells(e,t,i.cells);return n.length===0?void 0:n}}}cellMatches(e,t){const i=this.getMatchingCells(e,[t]);return i!==void 0&&i[0]===t}filterCells(e,t,i){var s;const n=i!==void 0?t.filter(o=>{const a=o.document.languageId;return i.some(c=>c.language==="*"||a===c.language)}):t;return typeof((s=this.client.clientOptions.notebookDocumentOptions)==null?void 0:s.filterCells)=="function"?this.client.clientOptions.notebookDocumentOptions.filterCells(e,n):n}}class lh{constructor(e){this.client=e,this.registrations=new Map,this.registrationType=ed.NotebookDocumentSyncRegistrationType.type,Jr.workspace.onDidOpenTextDocument(t=>{if(t.uri.scheme!==lh.CellScheme)return;const[i,n]=this.findNotebookDocumentAndCell(t);if(!(i===void 0||n===void 0))for(const s of this.registrations.values())s instanceof Hb&&s.didOpenNotebookCellTextDocument(i,n)}),Jr.workspace.onDidChangeTextDocument(t=>{if(t.contentChanges.length===0)return;const i=t.document;if(i.uri.scheme!==lh.CellScheme)return;const[n]=this.findNotebookDocumentAndCell(i);if(n!==void 0)for(const s of this.registrations.values())s instanceof Hb&&s.didChangeNotebookCellTextDocument(n,t)}),Jr.workspace.onDidCloseTextDocument(t=>{if(t.uri.scheme!==lh.CellScheme)return;const[i,n]=this.findNotebookDocumentAndCell(t);if(!(i===void 0||n===void 0))for(const s of this.registrations.values())s instanceof Hb&&s.didCloseNotebookCellTextDocument(i,n)})}getState(){if(this.registrations.size===0)return{kind:"document",id:this.registrationType.method,registrations:!1,matches:!1};for(const e of this.registrations.values()){const t=e.getState();if(t.kind==="document"&&t.registrations===!0&&t.matches===!0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!1}}fillClientCapabilities(e){const t=vj(vj(e,"notebookDocument"),"synchronization");t.dynamicRegistration=!0,t.executionSummarySupport=!0}preInitialize(e){const t=e.notebookDocumentSync;t!==void 0&&(this.dedicatedChannel=this.client.protocol2CodeConverter.asDocumentSelector(xE.asDocumentSelector(t)))}initialize(e){const t=e.notebookDocumentSync;if(t===void 0)return;const i=t.id??Eoe.generateUuid();this.register({id:i,registerOptions:t})}register(e){const t=new Hb(this.client,e.registerOptions);this.registrations.set(e.id,t)}unregister(e){const t=this.registrations.get(e);t&&t.dispose()}dispose(){for(const e of this.registrations.values())e.dispose();this.registrations.clear()}handles(e){if(e.uri.scheme!==lh.CellScheme)return!1;if(this.dedicatedChannel!==void 0&&Jr.languages.match(this.dedicatedChannel,e)>0)return!0;for(const t of this.registrations.values())if(t.handles(e))return!0;return!1}getProvider(e){for(const t of this.registrations.values())if(t.handles(e.document))return t}findNotebookDocumentAndCell(e){const t=e.uri.toString();for(const i of Jr.workspace.notebookDocuments)for(const n of i.getCells())if(n.document.uri.toString()===t)return[i,n];return[void 0,void 0]}}mK=rT.NotebookDocumentSyncFeature=lh;lh.CellScheme="vscode-notebook-cell";var Bl={};Object.defineProperty(Bl,"__esModule",{value:!0});var vK=Bl.SyncConfigurationFeature=Bl.toJSONObject=yK=Bl.ConfigurationFeature=void 0;const ug=Dt,Uv=Lt,xoe=Ni,Doe=Di,yj=Pi;class koe{constructor(e){this._client=e}getState(){return{kind:"static"}}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.configuration=!0}initialize(){let e=this._client;e.onRequest(Uv.ConfigurationRequest.type,(t,i)=>{let n=o=>{let a=[];for(let c of o.items){let d=c.scopeUri!==void 0&&c.scopeUri!==null?this._client.protocol2CodeConverter.asUri(c.scopeUri):void 0;a.push(this.getConfiguration(d,c.section!==null?c.section:void 0))}return a},s=e.middleware.workspace;return s&&s.configuration?s.configuration(t,i,n):n(t)})}getConfiguration(e,t){let i=null;if(t){let n=t.lastIndexOf(".");if(n===-1)i=Oh(ug.workspace.getConfiguration(void 0,e).get(t));else{let s=ug.workspace.getConfiguration(t.substr(0,n),e);s&&(i=Oh(s.get(t.substr(n+1))))}}else{let n=ug.workspace.getConfiguration(void 0,e);i={};for(let s of Object.keys(n))n.has(s)&&(i[s]=Oh(n.get(s)))}return i===void 0&&(i=null),i}dispose(){}}var yK=Bl.ConfigurationFeature=koe;function Oh(r){if(r){if(Array.isArray(r))return r.map(Oh);if(typeof r=="object"){const e=Object.create(null);for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=Oh(r[t]));return e}}return r}Bl.toJSONObject=Oh;class Toe{constructor(e){this._client=e,this.isDisposed=!1,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Uv.DidChangeConfigurationNotification.type}fillClientCapabilities(e){(0,yj.ensure)((0,yj.ensure)(e,"workspace"),"didChangeConfiguration").dynamicRegistration=!0}initialize(){var t;let e=(t=this._client.clientOptions.synchronize)==null?void 0:t.configurationSection;e!==void 0&&this.register({id:Doe.generateUuid(),registerOptions:{section:e}})}register(e){let t=ug.workspace.onDidChangeConfiguration(i=>{this.onDidChangeConfiguration(e.registerOptions.section,i)});this._listeners.set(e.id,t),e.registerOptions.section!==void 0&&this.onDidChangeConfiguration(e.registerOptions.section,void 0)}unregister(e){let t=this._listeners.get(e);t&&(this._listeners.delete(e),t.dispose())}dispose(){for(const e of this._listeners.values())e.dispose();this._listeners.clear(),this.isDisposed=!0}onDidChangeConfiguration(e,t){var o;if(this.isDisposed)return;let i;if(xoe.string(e)?i=[e]:i=e,i!==void 0&&t!==void 0&&!i.some(c=>t.affectsConfiguration(c)))return;const n=async a=>a===void 0?this._client.sendNotification(Uv.DidChangeConfigurationNotification.type,{settings:null}):this._client.sendNotification(Uv.DidChangeConfigurationNotification.type,{settings:this.extractSettingsInformation(a)});let s=(o=this._client.middleware.workspace)==null?void 0:o.didChangeConfiguration;(s?s(i,n):n(i)).catch(a=>{this._client.error(`Sending notification ${Uv.DidChangeConfigurationNotification.type.method} failed`,a)})}extractSettingsInformation(e){function t(s,o){let a=s;for(let c=0;c<o.length-1;c++){let d=a[o[c]];d||(d=Object.create(null),a[o[c]]=d),a=d}return a}let i=this._client.clientOptions.workspaceFolder?this._client.clientOptions.workspaceFolder.uri:void 0,n=Object.create(null);for(let s=0;s<e.length;s++){let o=e[s],a=o.indexOf("."),c=null;if(a>=0?c=ug.workspace.getConfiguration(o.substr(0,a),i).get(o.substr(a+1)):c=ug.workspace.getConfiguration(void 0,i).get(o),c){let d=e[s].split(".");t(n,d)[d[d.length-1]]=Oh(c)}}return n}}vK=Bl.SyncConfigurationFeature=Toe;var Hs={};Object.defineProperty(Hs,"__esModule",{value:!0});var _K=Hs.DidSaveTextDocumentFeature=EK=Hs.WillSaveWaitUntilFeature=CK=Hs.WillSaveFeature=SK=Hs.DidChangeTextDocumentFeature=bK=Hs.DidCloseTextDocumentFeature=wK=Hs.DidOpenTextDocumentFeature=void 0;const uo=Dt,Yi=Lt,Cn=Pi,Xm=Di;class Ioe extends Cn.TextDocumentEventFeature{constructor(e,t){super(e,uo.workspace.onDidOpenTextDocument,Yi.DidOpenTextDocumentNotification.type,()=>e.middleware.didOpen,i=>e.code2ProtocolConverter.asOpenTextDocumentParams(i),i=>i,Cn.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t}get openDocuments(){return this._syncedDocuments.values()}fillClientCapabilities(e){(0,Cn.ensure)((0,Cn.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){const i=e.resolvedTextDocumentSync;t&&i&&i.openClose&&this.register({id:Xm.generateUuid(),registerOptions:{documentSelector:t}})}get registrationType(){return Yi.DidOpenTextDocumentNotification.type}register(e){if(super.register(e),!e.registerOptions.documentSelector)return;const t=this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector);uo.workspace.textDocuments.forEach(i=>{const n=i.uri.toString();if(!this._syncedDocuments.has(n)&&uo.languages.match(t,i)>0&&!this._client.hasDedicatedTextSynchronizationFeature(i)){const s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));(s.didOpen?s.didOpen(i,o):o(i)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)}),this._syncedDocuments.set(n,i)}})}getTextDocument(e){return e}notificationSent(e,t,i){this._syncedDocuments.set(e.uri.toString(),e),super.notificationSent(e,t,i)}}var wK=Hs.DidOpenTextDocumentFeature=Ioe;class Roe extends Cn.TextDocumentEventFeature{constructor(e,t,i){super(e,uo.workspace.onDidCloseTextDocument,Yi.DidCloseTextDocumentNotification.type,()=>e.middleware.didClose,n=>e.code2ProtocolConverter.asCloseTextDocumentParams(n),n=>n,Cn.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t,this._pendingTextDocumentChanges=i}get registrationType(){return Yi.DidCloseTextDocumentNotification.type}fillClientCapabilities(e){(0,Cn.ensure)((0,Cn.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let i=e.resolvedTextDocumentSync;t&&i&&i.openClose&&this.register({id:Xm.generateUuid(),registerOptions:{documentSelector:t}})}async callback(e){await super.callback(e),this._pendingTextDocumentChanges.delete(e.uri.toString())}getTextDocument(e){return e}notificationSent(e,t,i){this._syncedDocuments.delete(e.uri.toString()),super.notificationSent(e,t,i)}unregister(e){const t=this._selectors.get(e);super.unregister(e);const i=this._selectors.values();this._syncedDocuments.forEach(n=>{if(uo.languages.match(t,n)>0&&!this._selectorFilter(i,n)&&!this._client.hasDedicatedTextSynchronizationFeature(n)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));this._syncedDocuments.delete(n.uri.toString()),(s.didClose?s.didClose(n,o):o(n)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)})}})}}var bK=Hs.DidCloseTextDocumentFeature=Roe;class Poe extends Cn.DynamicDocumentFeature{constructor(e,t){super(e),this._changeData=new Map,this._onNotificationSent=new uo.EventEmitter,this._onPendingChangeAdded=new uo.EventEmitter,this._pendingTextDocumentChanges=t,this._syncKind=Yi.TextDocumentSyncKind.None}get onNotificationSent(){return this._onNotificationSent.event}get onPendingChangeAdded(){return this._onPendingChangeAdded.event}get syncKind(){return this._syncKind}get registrationType(){return Yi.DidChangeTextDocumentNotification.type}fillClientCapabilities(e){(0,Cn.ensure)((0,Cn.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let i=e.resolvedTextDocumentSync;t&&i&&i.change!==void 0&&i.change!==Yi.TextDocumentSyncKind.None&&this.register({id:Xm.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},{syncKind:i.change})})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=uo.workspace.onDidChangeTextDocument(this.callback,this)),this._changeData.set(e.id,{syncKind:e.registerOptions.syncKind,documentSelector:this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)}),this.updateSyncKind(e.registerOptions.syncKind))}*getDocumentSelectors(){for(const e of this._changeData.values())yield e.documentSelector}async callback(e){if(e.contentChanges.length===0)return;const t=e.document.uri,i=e.document.version,n=[];for(const s of this._changeData.values())if(uo.languages.match(s.documentSelector,e.document)>0&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){const o=this._client.middleware;if(s.syncKind===Yi.TextDocumentSyncKind.Incremental){const a=async c=>{const d=this._client.code2ProtocolConverter.asChangeTextDocumentParams(c,t,i);await this._client.sendNotification(Yi.DidChangeTextDocumentNotification.type,d),this.notificationSent(c.document,Yi.DidChangeTextDocumentNotification.type,d)};n.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}else if(s.syncKind===Yi.TextDocumentSyncKind.Full){const a=async c=>{const d=c.document.uri.toString();this._pendingTextDocumentChanges.set(d,c.document),this._onPendingChangeAdded.fire()};n.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}}return Promise.all(n).then(void 0,s=>{throw this._client.error(`Sending document notification ${Yi.DidChangeTextDocumentNotification.type.method} failed`,s),s})}notificationSent(e,t,i){this._onNotificationSent.fire({textDocument:e,type:t,params:i})}unregister(e){if(this._changeData.delete(e),this._changeData.size===0)this._listener&&(this._listener.dispose(),this._listener=void 0),this._syncKind=Yi.TextDocumentSyncKind.None;else{this._syncKind=Yi.TextDocumentSyncKind.None;for(const t of this._changeData.values())if(this.updateSyncKind(t.syncKind),this._syncKind===Yi.TextDocumentSyncKind.Full)break}}dispose(){this._pendingTextDocumentChanges.clear(),this._changeData.clear(),this._syncKind=Yi.TextDocumentSyncKind.None,this._listener&&(this._listener.dispose(),this._listener=void 0)}getPendingDocumentChanges(e){if(this._pendingTextDocumentChanges.size===0)return[];let t;if(e.size===0)t=Array.from(this._pendingTextDocumentChanges.values()),this._pendingTextDocumentChanges.clear();else{t=[];for(const i of this._pendingTextDocumentChanges)e.has(i[0])||(t.push(i[1]),this._pendingTextDocumentChanges.delete(i[0]))}return t}getProvider(e){for(const t of this._changeData.values())if(uo.languages.match(t.documentSelector,e)>0)return{send:i=>this.callback(i)}}updateSyncKind(e){if(this._syncKind!==Yi.TextDocumentSyncKind.Full)switch(e){case Yi.TextDocumentSyncKind.Full:this._syncKind=e;break;case Yi.TextDocumentSyncKind.Incremental:this._syncKind===Yi.TextDocumentSyncKind.None&&(this._syncKind=Yi.TextDocumentSyncKind.Incremental);break}}}var SK=Hs.DidChangeTextDocumentFeature=Poe;class Aoe extends Cn.TextDocumentEventFeature{constructor(e){super(e,uo.workspace.onWillSaveTextDocument,Yi.WillSaveTextDocumentNotification.type,()=>e.middleware.willSave,t=>e.code2ProtocolConverter.asWillSaveTextDocumentParams(t),t=>t.document,(t,i)=>Cn.TextDocumentEventFeature.textDocumentFilter(t,i.document))}get registrationType(){return Yi.WillSaveTextDocumentNotification.type}fillClientCapabilities(e){let t=(0,Cn.ensure)((0,Cn.ensure)(e,"textDocument"),"synchronization");t.willSave=!0}initialize(e,t){let i=e.resolvedTextDocumentSync;t&&i&&i.willSave&&this.register({id:Xm.generateUuid(),registerOptions:{documentSelector:t}})}getTextDocument(e){return e.document}}var CK=Hs.WillSaveFeature=Aoe;class Moe extends Cn.DynamicDocumentFeature{constructor(e){super(e),this._selectors=new Map}getDocumentSelectors(){return this._selectors.values()}get registrationType(){return Yi.WillSaveTextDocumentWaitUntilRequest.type}fillClientCapabilities(e){let t=(0,Cn.ensure)((0,Cn.ensure)(e,"textDocument"),"synchronization");t.willSaveWaitUntil=!0}initialize(e,t){let i=e.resolvedTextDocumentSync;t&&i&&i.willSaveWaitUntil&&this.register({id:Xm.generateUuid(),registerOptions:{documentSelector:t}})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=uo.workspace.onWillSaveTextDocument(this.callback,this)),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}callback(e){if(Cn.TextDocumentEventFeature.textDocumentFilter(this._selectors.values(),e.document)&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let t=this._client.middleware,i=n=>this._client.sendRequest(Yi.WillSaveTextDocumentWaitUntilRequest.type,this._client.code2ProtocolConverter.asWillSaveTextDocumentParams(n)).then(async s=>{let o=await this._client.protocol2CodeConverter.asTextEdits(s);return o===void 0?[]:o});e.waitUntil(t.willSaveWaitUntil?t.willSaveWaitUntil(e,i):i(e))}}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._selectors.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}}var EK=Hs.WillSaveWaitUntilFeature=Moe;class Loe extends Cn.TextDocumentEventFeature{constructor(e){super(e,uo.workspace.onDidSaveTextDocument,Yi.DidSaveTextDocumentNotification.type,()=>e.middleware.didSave,t=>e.code2ProtocolConverter.asSaveTextDocumentParams(t,this._includeText),t=>t,Cn.TextDocumentEventFeature.textDocumentFilter),this._includeText=!1}get registrationType(){return Yi.DidSaveTextDocumentNotification.type}fillClientCapabilities(e){(0,Cn.ensure)((0,Cn.ensure)(e,"textDocument"),"synchronization").didSave=!0}initialize(e,t){const i=e.resolvedTextDocumentSync;if(t&&i&&i.save){const n=typeof i.save=="boolean"?{includeText:!1}:{includeText:!!i.save.includeText};this.register({id:Xm.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},n)})}}register(e){this._includeText=!!e.registerOptions.includeText,super.register(e)}getTextDocument(e){return e}}_K=Hs.DidSaveTextDocumentFeature=Loe;var sT={};Object.defineProperty(sT,"__esModule",{value:!0});var xK=sT.CompletionItemFeature=void 0;const Foe=Dt,ui=Lt,YI=Pi,Ooe=Di,Noe=[ui.CompletionItemKind.Text,ui.CompletionItemKind.Method,ui.CompletionItemKind.Function,ui.CompletionItemKind.Constructor,ui.CompletionItemKind.Field,ui.CompletionItemKind.Variable,ui.CompletionItemKind.Class,ui.CompletionItemKind.Interface,ui.CompletionItemKind.Module,ui.CompletionItemKind.Property,ui.CompletionItemKind.Unit,ui.CompletionItemKind.Value,ui.CompletionItemKind.Enum,ui.CompletionItemKind.Keyword,ui.CompletionItemKind.Snippet,ui.CompletionItemKind.Color,ui.CompletionItemKind.File,ui.CompletionItemKind.Reference,ui.CompletionItemKind.Folder,ui.CompletionItemKind.EnumMember,ui.CompletionItemKind.Constant,ui.CompletionItemKind.Struct,ui.CompletionItemKind.Event,ui.CompletionItemKind.Operator,ui.CompletionItemKind.TypeParameter];class $oe extends YI.TextDocumentLanguageFeature{constructor(e){super(e,ui.CompletionRequest.type),this.labelDetailsSupport=new Map}fillClientCapabilities(e){let t=(0,YI.ensure)((0,YI.ensure)(e,"textDocument"),"completion");t.dynamicRegistration=!0,t.contextSupport=!0,t.completionItem={snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:[ui.MarkupKind.Markdown,ui.MarkupKind.PlainText],deprecatedSupport:!0,preselectSupport:!0,tagSupport:{valueSet:[ui.CompletionItemTag.Deprecated]},insertReplaceSupport:!0,resolveSupport:{properties:["documentation","detail","additionalTextEdits"]},insertTextModeSupport:{valueSet:[ui.InsertTextMode.asIs,ui.InsertTextMode.adjustIndentation]},labelDetailsSupport:!0},t.insertTextMode=ui.InsertTextMode.adjustIndentation,t.completionItemKind={valueSet:Noe},t.completionList={itemDefaults:["commitCharacters","editRange","insertTextFormat","insertTextMode"]}}initialize(e,t){const i=this.getRegistrationOptions(t,e.completionProvider);i&&this.register({id:Ooe.generateUuid(),registerOptions:i})}registerLanguageProvider(e,t){var a;this.labelDetailsSupport.set(t,!!((a=e.completionItem)!=null&&a.labelDetailsSupport));const i=e.triggerCharacters??[],n=e.allCommitCharacters,s=e.documentSelector,o={provideCompletionItems:(c,d,l,u)=>{const h=this._client,g=this._client.middleware,m=(y,_,b,E)=>h.sendRequest(ui.CompletionRequest.type,h.code2ProtocolConverter.asCompletionParams(y,_,b),E).then(D=>E.isCancellationRequested?null:h.protocol2CodeConverter.asCompletionResult(D,n,E),D=>h.handleFailedRequest(ui.CompletionRequest.type,E,D,null));return g.provideCompletionItem?g.provideCompletionItem(c,d,u,l,m):m(c,d,u,l)},resolveCompletionItem:e.resolveProvider?(c,d)=>{const l=this._client,u=this._client.middleware,h=(g,m)=>l.sendRequest(ui.CompletionResolveRequest.type,l.code2ProtocolConverter.asCompletionItem(g,!!this.labelDetailsSupport.get(t)),m).then(y=>m.isCancellationRequested?null:l.protocol2CodeConverter.asCompletionItem(y),y=>l.handleFailedRequest(ui.CompletionResolveRequest.type,m,y,g));return u.resolveCompletionItem?u.resolveCompletionItem(c,d,h):h(c,d)}:void 0};return[Foe.languages.registerCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(s),o,...i),o]}}xK=sT.CompletionItemFeature=$oe;var oT={};Object.defineProperty(oT,"__esModule",{value:!0});var DK=oT.HoverFeature=void 0;const Woe=Dt,pv=Lt,XI=Pi,Hoe=Di;class joe extends XI.TextDocumentLanguageFeature{constructor(e){super(e,pv.HoverRequest.type)}fillClientCapabilities(e){const t=(0,XI.ensure)((0,XI.ensure)(e,"textDocument"),"hover");t.dynamicRegistration=!0,t.contentFormat=[pv.MarkupKind.Markdown,pv.MarkupKind.PlainText]}initialize(e,t){const i=this.getRegistrationOptions(t,e.hoverProvider);i&&this.register({id:Hoe.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideHover:(n,s,o)=>{const a=this._client,c=(l,u,h)=>a.sendRequest(pv.HoverRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(l,u),h).then(g=>h.isCancellationRequested?null:a.protocol2CodeConverter.asHover(g),g=>a.handleFailedRequest(pv.HoverRequest.type,h,g,null)),d=a.middleware;return d.provideHover?d.provideHover(n,s,o,c):c(n,s,o)}};return[this.registerProvider(t,i),i]}registerProvider(e,t){return Woe.languages.registerHoverProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}DK=oT.HoverFeature=joe;var aT={};Object.defineProperty(aT,"__esModule",{value:!0});var kK=aT.DefinitionFeature=void 0;const Boe=Dt,JI=Lt,ZI=Pi,Uoe=Di;class Voe extends ZI.TextDocumentLanguageFeature{constructor(e){super(e,JI.DefinitionRequest.type)}fillClientCapabilities(e){let t=(0,ZI.ensure)((0,ZI.ensure)(e,"textDocument"),"definition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.definitionProvider);i&&this.register({id:Uoe.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideDefinition:(n,s,o)=>{const a=this._client,c=(l,u,h)=>a.sendRequest(JI.DefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(l,u),h).then(g=>h.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(g,h),g=>a.handleFailedRequest(JI.DefinitionRequest.type,h,g,null)),d=a.middleware;return d.provideDefinition?d.provideDefinition(n,s,o,c):c(n,s,o)}};return[this.registerProvider(t,i),i]}registerProvider(e,t){return Boe.languages.registerDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}kK=aT.DefinitionFeature=Voe;var cT={};Object.defineProperty(cT,"__esModule",{value:!0});var TK=cT.SignatureHelpFeature=void 0;const _j=Dt,gv=Lt,eR=Pi,qoe=Di;class Goe extends eR.TextDocumentLanguageFeature{constructor(e){super(e,gv.SignatureHelpRequest.type)}fillClientCapabilities(e){let t=(0,eR.ensure)((0,eR.ensure)(e,"textDocument"),"signatureHelp");t.dynamicRegistration=!0,t.signatureInformation={documentationFormat:[gv.MarkupKind.Markdown,gv.MarkupKind.PlainText]},t.signatureInformation.parameterInformation={labelOffsetSupport:!0},t.signatureInformation.activeParameterSupport=!0,t.contextSupport=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.signatureHelpProvider);i&&this.register({id:qoe.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t={provideSignatureHelp:(i,n,s,o)=>{const a=this._client,c=(l,u,h,g)=>a.sendRequest(gv.SignatureHelpRequest.type,a.code2ProtocolConverter.asSignatureHelpParams(l,u,h),g).then(m=>g.isCancellationRequested?null:a.protocol2CodeConverter.asSignatureHelp(m,g),m=>a.handleFailedRequest(gv.SignatureHelpRequest.type,g,m,null)),d=a.middleware;return d.provideSignatureHelp?d.provideSignatureHelp(i,n,o,s,c):c(i,n,o,s)}};return[this.registerProvider(e,t),t]}registerProvider(e,t){const i=this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector);if(e.retriggerCharacters===void 0){const n=e.triggerCharacters||[];return _j.languages.registerSignatureHelpProvider(i,t,...n)}else{const n={triggerCharacters:e.triggerCharacters||[],retriggerCharacters:e.retriggerCharacters||[]};return _j.languages.registerSignatureHelpProvider(i,t,n)}}}TK=cT.SignatureHelpFeature=Goe;var dT={};Object.defineProperty(dT,"__esModule",{value:!0});var IK=dT.DocumentHighlightFeature=void 0;const zoe=Dt,tR=Lt,iR=Pi,Koe=Di;class Qoe extends iR.TextDocumentLanguageFeature{constructor(e){super(e,tR.DocumentHighlightRequest.type)}fillClientCapabilities(e){(0,iR.ensure)((0,iR.ensure)(e,"textDocument"),"documentHighlight").dynamicRegistration=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.documentHighlightProvider);i&&this.register({id:Koe.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideDocumentHighlights:(n,s,o)=>{const a=this._client,c=(l,u,h)=>a.sendRequest(tR.DocumentHighlightRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(l,u),h).then(g=>h.isCancellationRequested?null:a.protocol2CodeConverter.asDocumentHighlights(g,h),g=>a.handleFailedRequest(tR.DocumentHighlightRequest.type,h,g,null)),d=a.middleware;return d.provideDocumentHighlights?d.provideDocumentHighlights(n,s,o,c):c(n,s,o)}};return[zoe.languages.registerDocumentHighlightProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),i]}}IK=dT.DocumentHighlightFeature=Qoe;var lT={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DocumentSymbolFeature=r.SupportedSymbolTags=r.SupportedSymbolKinds=void 0;const e=Dt,t=Lt,i=Pi,n=Di;r.SupportedSymbolKinds=[t.SymbolKind.File,t.SymbolKind.Module,t.SymbolKind.Namespace,t.SymbolKind.Package,t.SymbolKind.Class,t.SymbolKind.Method,t.SymbolKind.Property,t.SymbolKind.Field,t.SymbolKind.Constructor,t.SymbolKind.Enum,t.SymbolKind.Interface,t.SymbolKind.Function,t.SymbolKind.Variable,t.SymbolKind.Constant,t.SymbolKind.String,t.SymbolKind.Number,t.SymbolKind.Boolean,t.SymbolKind.Array,t.SymbolKind.Object,t.SymbolKind.Key,t.SymbolKind.Null,t.SymbolKind.EnumMember,t.SymbolKind.Struct,t.SymbolKind.Event,t.SymbolKind.Operator,t.SymbolKind.TypeParameter],r.SupportedSymbolTags=[t.SymbolTag.Deprecated];class s extends i.TextDocumentLanguageFeature{constructor(a){super(a,t.DocumentSymbolRequest.type)}fillClientCapabilities(a){let c=(0,i.ensure)((0,i.ensure)(a,"textDocument"),"documentSymbol");c.dynamicRegistration=!0,c.symbolKind={valueSet:r.SupportedSymbolKinds},c.hierarchicalDocumentSymbolSupport=!0,c.tagSupport={valueSet:r.SupportedSymbolTags},c.labelSupport=!0}initialize(a,c){const d=this.getRegistrationOptions(c,a.documentSymbolProvider);d&&this.register({id:n.generateUuid(),registerOptions:d})}registerLanguageProvider(a){const c=a.documentSelector,d={provideDocumentSymbols:(u,h)=>{const g=this._client,m=async(_,b)=>{try{const E=await g.sendRequest(t.DocumentSymbolRequest.type,g.code2ProtocolConverter.asDocumentSymbolParams(_),b);if(b.isCancellationRequested||E===void 0||E===null)return null;if(E.length===0)return[];{const D=E[0];return t.DocumentSymbol.is(D)?await g.protocol2CodeConverter.asDocumentSymbols(E,b):await g.protocol2CodeConverter.asSymbolInformations(E,b)}}catch(E){return g.handleFailedRequest(t.DocumentSymbolRequest.type,b,E,null)}},y=g.middleware;return y.provideDocumentSymbols?y.provideDocumentSymbols(u,h,m):m(u,h)}},l=a.label!==void 0?{label:a.label}:void 0;return[e.languages.registerDocumentSymbolProvider(this._client.protocol2CodeConverter.asDocumentSelector(c),d,l),d]}}r.DocumentSymbolFeature=s})(lT);var uT={};Object.defineProperty(uT,"__esModule",{value:!0});var RK=uT.WorkspaceSymbolFeature=void 0;const Yoe=Dt,mv=Lt,nR=Pi,wj=lT,Xoe=Di;class Joe extends nR.WorkspaceFeature{constructor(e){super(e,mv.WorkspaceSymbolRequest.type)}fillClientCapabilities(e){let t=(0,nR.ensure)((0,nR.ensure)(e,"workspace"),"symbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:wj.SupportedSymbolKinds},t.tagSupport={valueSet:wj.SupportedSymbolTags},t.resolveSupport={properties:["location.range"]}}initialize(e){e.workspaceSymbolProvider&&this.register({id:Xoe.generateUuid(),registerOptions:e.workspaceSymbolProvider===!0?{workDoneProgress:!1}:e.workspaceSymbolProvider})}registerLanguageProvider(e){const t={provideWorkspaceSymbols:(i,n)=>{const s=this._client,o=(c,d)=>s.sendRequest(mv.WorkspaceSymbolRequest.type,{query:c},d).then(l=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformations(l,d),l=>s.handleFailedRequest(mv.WorkspaceSymbolRequest.type,d,l,null)),a=s.middleware;return a.provideWorkspaceSymbols?a.provideWorkspaceSymbols(i,n,o):o(i,n)},resolveWorkspaceSymbol:e.resolveProvider===!0?(i,n)=>{const s=this._client,o=(c,d)=>s.sendRequest(mv.WorkspaceSymbolResolveRequest.type,s.code2ProtocolConverter.asWorkspaceSymbol(c),d).then(l=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformation(l),l=>s.handleFailedRequest(mv.WorkspaceSymbolResolveRequest.type,d,l,null)),a=s.middleware;return a.resolveWorkspaceSymbol?a.resolveWorkspaceSymbol(i,n,o):o(i,n)}:void 0};return[Yoe.languages.registerWorkspaceSymbolProvider(t),t]}}RK=uT.WorkspaceSymbolFeature=Joe;var hT={};Object.defineProperty(hT,"__esModule",{value:!0});var PK=hT.ReferencesFeature=void 0;const Zoe=Dt,rR=Lt,sR=Pi,eae=Di;class tae extends sR.TextDocumentLanguageFeature{constructor(e){super(e,rR.ReferencesRequest.type)}fillClientCapabilities(e){(0,sR.ensure)((0,sR.ensure)(e,"textDocument"),"references").dynamicRegistration=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.referencesProvider);i&&this.register({id:eae.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideReferences:(n,s,o,a)=>{const c=this._client,d=(u,h,g,m)=>c.sendRequest(rR.ReferencesRequest.type,c.code2ProtocolConverter.asReferenceParams(u,h,g),m).then(y=>m.isCancellationRequested?null:c.protocol2CodeConverter.asReferences(y,m),y=>c.handleFailedRequest(rR.ReferencesRequest.type,m,y,null)),l=c.middleware;return l.provideReferences?l.provideReferences(n,s,o,a,d):d(n,s,o,a)}};return[this.registerProvider(t,i),i]}registerProvider(e,t){return Zoe.languages.registerReferenceProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}PK=hT.ReferencesFeature=tae;var fT={};Object.defineProperty(fT,"__esModule",{value:!0});var AK=fT.CodeActionFeature=void 0;const iae=Dt,oo=Lt,nae=Di,oR=Pi;class rae extends oR.TextDocumentLanguageFeature{constructor(e){super(e,oo.CodeActionRequest.type)}fillClientCapabilities(e){const t=(0,oR.ensure)((0,oR.ensure)(e,"textDocument"),"codeAction");t.dynamicRegistration=!0,t.isPreferredSupport=!0,t.disabledSupport=!0,t.dataSupport=!0,t.resolveSupport={properties:["edit"]},t.codeActionLiteralSupport={codeActionKind:{valueSet:[oo.CodeActionKind.Empty,oo.CodeActionKind.QuickFix,oo.CodeActionKind.Refactor,oo.CodeActionKind.RefactorExtract,oo.CodeActionKind.RefactorInline,oo.CodeActionKind.RefactorRewrite,oo.CodeActionKind.Source,oo.CodeActionKind.SourceOrganizeImports]}},t.honorsChangeAnnotations=!1}initialize(e,t){const i=this.getRegistrationOptions(t,e.codeActionProvider);i&&this.register({id:nae.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideCodeActions:(n,s,o,a)=>{const c=this._client,d=async(u,h,g,m)=>{const y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(u),range:c.code2ProtocolConverter.asRange(h),context:await c.code2ProtocolConverter.asCodeActionContext(g,m)};return c.sendRequest(oo.CodeActionRequest.type,y,m).then(_=>m.isCancellationRequested||_===null||_===void 0?null:c.protocol2CodeConverter.asCodeActionResult(_,m),_=>c.handleFailedRequest(oo.CodeActionRequest.type,m,_,null))},l=c.middleware;return l.provideCodeActions?l.provideCodeActions(n,s,o,a,d):d(n,s,o,a)},resolveCodeAction:e.resolveProvider?(n,s)=>{const o=this._client,a=this._client.middleware,c=async(d,l)=>o.sendRequest(oo.CodeActionResolveRequest.type,await o.code2ProtocolConverter.asCodeAction(d,l),l).then(u=>l.isCancellationRequested?d:o.protocol2CodeConverter.asCodeAction(u,l),u=>o.handleFailedRequest(oo.CodeActionResolveRequest.type,l,u,d));return a.resolveCodeAction?a.resolveCodeAction(n,s,c):c(n,s)}:void 0};return[iae.languages.registerCodeActionsProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i,e.codeActionKinds?{providedCodeActionKinds:this._client.protocol2CodeConverter.asCodeActionKinds(e.codeActionKinds)}:void 0),i]}}AK=fT.CodeActionFeature=rae;var pT={};Object.defineProperty(pT,"__esModule",{value:!0});var MK=pT.CodeLensFeature=void 0;const bj=Dt,op=Lt,sae=Di,vv=Pi;class oae extends vv.TextDocumentLanguageFeature{constructor(e){super(e,op.CodeLensRequest.type)}fillClientCapabilities(e){(0,vv.ensure)((0,vv.ensure)(e,"textDocument"),"codeLens").dynamicRegistration=!0,(0,vv.ensure)((0,vv.ensure)(e,"workspace"),"codeLens").refreshSupport=!0}initialize(e,t){this._client.onRequest(op.CodeLensRefreshRequest.type,async()=>{for(const s of this.getAllProviders())s.onDidChangeCodeLensEmitter.fire()});const n=this.getRegistrationOptions(t,e.codeLensProvider);n&&this.register({id:sae.generateUuid(),registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i=new bj.EventEmitter,n={onDidChangeCodeLenses:i.event,provideCodeLenses:(s,o)=>{const a=this._client,c=(l,u)=>a.sendRequest(op.CodeLensRequest.type,a.code2ProtocolConverter.asCodeLensParams(l),u).then(h=>u.isCancellationRequested?null:a.protocol2CodeConverter.asCodeLenses(h,u),h=>a.handleFailedRequest(op.CodeLensRequest.type,u,h,null)),d=a.middleware;return d.provideCodeLenses?d.provideCodeLenses(s,o,c):c(s,o)},resolveCodeLens:e.resolveProvider?(s,o)=>{const a=this._client,c=(l,u)=>a.sendRequest(op.CodeLensResolveRequest.type,a.code2ProtocolConverter.asCodeLens(l),u).then(h=>u.isCancellationRequested?l:a.protocol2CodeConverter.asCodeLens(h),h=>a.handleFailedRequest(op.CodeLensResolveRequest.type,u,h,l)),d=a.middleware;return d.resolveCodeLens?d.resolveCodeLens(s,o,c):c(s,o)}:void 0};return[bj.languages.registerCodeLensProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),{provider:n,onDidChangeCodeLensEmitter:i}]}}MK=pT.CodeLensFeature=oae;var Ul={};Object.defineProperty(Ul,"__esModule",{value:!0});var LK=Ul.DocumentOnTypeFormattingFeature=OK=Ul.DocumentRangeFormattingFeature=FK=Ul.DocumentFormattingFeature=void 0;const gT=Dt,ld=Lt,q1=Di,ud=Pi;var W_;(function(r){function e(t){const i=gT.workspace.getConfiguration("files",t);return{trimTrailingWhitespace:i.get("trimTrailingWhitespace"),trimFinalNewlines:i.get("trimFinalNewlines"),insertFinalNewline:i.get("insertFinalNewline")}}r.fromConfiguration=e})(W_||(W_={}));class aae extends ud.TextDocumentLanguageFeature{constructor(e){super(e,ld.DocumentFormattingRequest.type)}fillClientCapabilities(e){(0,ud.ensure)((0,ud.ensure)(e,"textDocument"),"formatting").dynamicRegistration=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.documentFormattingProvider);i&&this.register({id:q1.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideDocumentFormattingEdits:(n,s,o)=>{const a=this._client,c=(l,u,h)=>{const g={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(l),options:a.code2ProtocolConverter.asFormattingOptions(u,W_.fromConfiguration(l))};return a.sendRequest(ld.DocumentFormattingRequest.type,g,h).then(m=>h.isCancellationRequested?null:a.protocol2CodeConverter.asTextEdits(m,h),m=>a.handleFailedRequest(ld.DocumentFormattingRequest.type,h,m,null))},d=a.middleware;return d.provideDocumentFormattingEdits?d.provideDocumentFormattingEdits(n,s,o,c):c(n,s,o)}};return[gT.languages.registerDocumentFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),i]}}var FK=Ul.DocumentFormattingFeature=aae;class cae extends ud.TextDocumentLanguageFeature{constructor(e){super(e,ld.DocumentRangeFormattingRequest.type)}fillClientCapabilities(e){(0,ud.ensure)((0,ud.ensure)(e,"textDocument"),"rangeFormatting").dynamicRegistration=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.documentRangeFormattingProvider);i&&this.register({id:q1.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideDocumentRangeFormattingEdits:(n,s,o,a)=>{const c=this._client,d=(u,h,g,m)=>{const y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(u),range:c.code2ProtocolConverter.asRange(h),options:c.code2ProtocolConverter.asFormattingOptions(g,W_.fromConfiguration(u))};return c.sendRequest(ld.DocumentRangeFormattingRequest.type,y,m).then(_=>m.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(_,m),_=>c.handleFailedRequest(ld.DocumentRangeFormattingRequest.type,m,_,null))},l=c.middleware;return l.provideDocumentRangeFormattingEdits?l.provideDocumentRangeFormattingEdits(n,s,o,a,d):d(n,s,o,a)}};return[gT.languages.registerDocumentRangeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),i]}}var OK=Ul.DocumentRangeFormattingFeature=cae;class dae extends ud.TextDocumentLanguageFeature{constructor(e){super(e,ld.DocumentOnTypeFormattingRequest.type)}fillClientCapabilities(e){(0,ud.ensure)((0,ud.ensure)(e,"textDocument"),"onTypeFormatting").dynamicRegistration=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.documentOnTypeFormattingProvider);i&&this.register({id:q1.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideOnTypeFormattingEdits:(s,o,a,c,d)=>{const l=this._client,u=(g,m,y,_,b)=>{let E={textDocument:l.code2ProtocolConverter.asTextDocumentIdentifier(g),position:l.code2ProtocolConverter.asPosition(m),ch:y,options:l.code2ProtocolConverter.asFormattingOptions(_,W_.fromConfiguration(g))};return l.sendRequest(ld.DocumentOnTypeFormattingRequest.type,E,b).then(D=>b.isCancellationRequested?null:l.protocol2CodeConverter.asTextEdits(D,b),D=>l.handleFailedRequest(ld.DocumentOnTypeFormattingRequest.type,b,D,null))},h=l.middleware;return h.provideOnTypeFormattingEdits?h.provideOnTypeFormattingEdits(s,o,a,c,d,u):u(s,o,a,c,d)}},n=e.moreTriggerCharacter||[];return[gT.languages.registerOnTypeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i,e.firstTriggerCharacter,...n),i]}}LK=Ul.DocumentOnTypeFormattingFeature=dae;var mT={};Object.defineProperty(mT,"__esModule",{value:!0});var NK=mT.RenameFeature=void 0;const lae=Dt,Ru=Lt,uae=Di,Sj=Ni,aR=Pi;class hae extends aR.TextDocumentLanguageFeature{constructor(e){super(e,Ru.RenameRequest.type)}fillClientCapabilities(e){let t=(0,aR.ensure)((0,aR.ensure)(e,"textDocument"),"rename");t.dynamicRegistration=!0,t.prepareSupport=!0,t.prepareSupportDefaultBehavior=Ru.PrepareSupportDefaultBehavior.Identifier,t.honorsChangeAnnotations=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.renameProvider);i&&(Sj.boolean(e.renameProvider)&&(i.prepareProvider=!1),this.register({id:uae.generateUuid(),registerOptions:i}))}registerLanguageProvider(e){const t=e.documentSelector,i={provideRenameEdits:(n,s,o,a)=>{const c=this._client,d=(u,h,g,m)=>{let y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(u),position:c.code2ProtocolConverter.asPosition(h),newName:g};return c.sendRequest(Ru.RenameRequest.type,y,m).then(_=>m.isCancellationRequested?null:c.protocol2CodeConverter.asWorkspaceEdit(_,m),_=>c.handleFailedRequest(Ru.RenameRequest.type,m,_,null,!1))},l=c.middleware;return l.provideRenameEdits?l.provideRenameEdits(n,s,o,a,d):d(n,s,o,a)},prepareRename:e.prepareProvider?(n,s,o)=>{const a=this._client,c=(l,u,h)=>{let g={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(l),position:a.code2ProtocolConverter.asPosition(u)};return a.sendRequest(Ru.PrepareRenameRequest.type,g,h).then(m=>h.isCancellationRequested?null:Ru.Range.is(m)?a.protocol2CodeConverter.asRange(m):this.isDefaultBehavior(m)?m.defaultBehavior===!0?null:Promise.reject(new Error("The element can't be renamed.")):m&&Ru.Range.is(m.range)?{range:a.protocol2CodeConverter.asRange(m.range),placeholder:m.placeholder}:Promise.reject(new Error("The element can't be renamed.")),m=>{throw typeof m.message=="string"?new Error(m.message):new Error("The element can't be renamed.")})},d=a.middleware;return d.prepareRename?d.prepareRename(n,s,o,c):c(n,s,o)}:void 0};return[this.registerProvider(t,i),i]}registerProvider(e,t){return lae.languages.registerRenameProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}isDefaultBehavior(e){const t=e;return t&&Sj.boolean(t.defaultBehavior)}}NK=mT.RenameFeature=hae;var vT={};Object.defineProperty(vT,"__esModule",{value:!0});var $K=vT.DocumentLinkFeature=void 0;const fae=Dt,yv=Lt,cR=Pi,pae=Di;class gae extends cR.TextDocumentLanguageFeature{constructor(e){super(e,yv.DocumentLinkRequest.type)}fillClientCapabilities(e){const t=(0,cR.ensure)((0,cR.ensure)(e,"textDocument"),"documentLink");t.dynamicRegistration=!0,t.tooltipSupport=!0}initialize(e,t){const i=this.getRegistrationOptions(t,e.documentLinkProvider);i&&this.register({id:pae.generateUuid(),registerOptions:i})}registerLanguageProvider(e){const t=e.documentSelector,i={provideDocumentLinks:(n,s)=>{const o=this._client,a=(d,l)=>o.sendRequest(yv.DocumentLinkRequest.type,o.code2ProtocolConverter.asDocumentLinkParams(d),l).then(u=>l.isCancellationRequested?null:o.protocol2CodeConverter.asDocumentLinks(u,l),u=>o.handleFailedRequest(yv.DocumentLinkRequest.type,l,u,null)),c=o.middleware;return c.provideDocumentLinks?c.provideDocumentLinks(n,s,a):a(n,s)},resolveDocumentLink:e.resolveProvider?(n,s)=>{const o=this._client;let a=(d,l)=>o.sendRequest(yv.DocumentLinkResolveRequest.type,o.code2ProtocolConverter.asDocumentLink(d),l).then(u=>l.isCancellationRequested?d:o.protocol2CodeConverter.asDocumentLink(u),u=>o.handleFailedRequest(yv.DocumentLinkResolveRequest.type,l,u,d));const c=o.middleware;return c.resolveDocumentLink?c.resolveDocumentLink(n,s,a):a(n,s)}:void 0};return[fae.languages.registerDocumentLinkProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),i]}}$K=vT.DocumentLinkFeature=gae;var yT={};Object.defineProperty(yT,"__esModule",{value:!0});var WK=yT.ExecuteCommandFeature=void 0;const mae=Dt,dR=Lt,vae=Di,Cj=Pi;class yae{constructor(e){this._client=e,this._commands=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._commands.size>0}}get registrationType(){return dR.ExecuteCommandRequest.type}fillClientCapabilities(e){(0,Cj.ensure)((0,Cj.ensure)(e,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(e){e.executeCommandProvider&&this.register({id:vae.generateUuid(),registerOptions:Object.assign({},e.executeCommandProvider)})}register(e){const t=this._client,i=t.middleware,n=(s,o)=>{let a={command:s,arguments:o};return t.sendRequest(dR.ExecuteCommandRequest.type,a).then(void 0,c=>t.handleFailedRequest(dR.ExecuteCommandRequest.type,void 0,c,void 0))};if(e.registerOptions.commands){const s=[];for(const o of e.registerOptions.commands)s.push(mae.commands.registerCommand(o,(...a)=>i.executeCommand?i.executeCommand(o,a,n):n(o,a)));this._commands.set(e.id,s)}}unregister(e){let t=this._commands.get(e);t&&t.forEach(i=>i.dispose())}dispose(){this._commands.forEach(e=>{e.forEach(t=>t.dispose())}),this._commands.clear()}}WK=yT.ExecuteCommandFeature=yae;var _T={};Object.defineProperty(_T,"__esModule",{value:!0});_T.FileSystemWatcherFeature=void 0;const _ae=Dt,Pu=Lt,jb=Pi;class wae{constructor(e,t){this._client=e,this._notifyFileEvent=t,this._watchers=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._watchers.size>0}}get registrationType(){return Pu.DidChangeWatchedFilesNotification.type}fillClientCapabilities(e){(0,jb.ensure)((0,jb.ensure)(e,"workspace"),"didChangeWatchedFiles").dynamicRegistration=!0,(0,jb.ensure)((0,jb.ensure)(e,"workspace"),"didChangeWatchedFiles").relativePatternSupport=!0}initialize(e,t){}register(e){if(!Array.isArray(e.registerOptions.watchers))return;const t=[];for(const i of e.registerOptions.watchers){const n=this._client.protocol2CodeConverter.asGlobPattern(i.globPattern);if(n===void 0)continue;let s=!0,o=!0,a=!0;i.kind!==void 0&&i.kind!==null&&(s=(i.kind&Pu.WatchKind.Create)!==0,o=(i.kind&Pu.WatchKind.Change)!==0,a=(i.kind&Pu.WatchKind.Delete)!==0);const c=_ae.workspace.createFileSystemWatcher(n,!s,!o,!a);this.hookListeners(c,s,o,a,t),t.push(c)}this._watchers.set(e.id,t)}registerRaw(e,t){let i=[];for(let n of t)this.hookListeners(n,!0,!0,!0,i);this._watchers.set(e,i)}hookListeners(e,t,i,n,s){t&&e.onDidCreate(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Pu.FileChangeType.Created}),null,s),i&&e.onDidChange(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Pu.FileChangeType.Changed}),null,s),n&&e.onDidDelete(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Pu.FileChangeType.Deleted}),null,s)}unregister(e){let t=this._watchers.get(e);if(t)for(let i of t)i.dispose()}dispose(){this._watchers.forEach(e=>{for(let t of e)t.dispose()}),this._watchers.clear()}}_T.FileSystemWatcherFeature=wae;var wT={};Object.defineProperty(wT,"__esModule",{value:!0});var HK=wT.ColorProviderFeature=void 0;const bae=Dt,_v=Lt,lR=Pi;class Sae extends lR.TextDocumentLanguageFeature{constructor(e){super(e,_v.DocumentColorRequest.type)}fillClientCapabilities(e){(0,lR.ensure)((0,lR.ensure)(e,"textDocument"),"colorProvider").dynamicRegistration=!0}initialize(e,t){let[i,n]=this.getRegistration(t,e.colorProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i={provideColorPresentations:(n,s,o)=>{const a=this._client,c=(l,u,h)=>{const g={color:l,textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(u.document),range:a.code2ProtocolConverter.asRange(u.range)};return a.sendRequest(_v.ColorPresentationRequest.type,g,h).then(m=>h.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorPresentations(m,h),m=>a.handleFailedRequest(_v.ColorPresentationRequest.type,h,m,null))},d=a.middleware;return d.provideColorPresentations?d.provideColorPresentations(n,s,o,c):c(n,s,o)},provideDocumentColors:(n,s)=>{const o=this._client,a=(d,l)=>{const u={textDocument:o.code2ProtocolConverter.asTextDocumentIdentifier(d)};return o.sendRequest(_v.DocumentColorRequest.type,u,l).then(h=>l.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorInformations(h,l),h=>o.handleFailedRequest(_v.DocumentColorRequest.type,l,h,null))},c=o.middleware;return c.provideDocumentColors?c.provideDocumentColors(n,s,a):a(n,s)}};return[bae.languages.registerColorProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),i]}}HK=wT.ColorProviderFeature=Sae;var bT={};Object.defineProperty(bT,"__esModule",{value:!0});var jK=bT.ImplementationFeature=void 0;const Cae=Dt,uR=Lt,hR=Pi;class Eae extends hR.TextDocumentLanguageFeature{constructor(e){super(e,uR.ImplementationRequest.type)}fillClientCapabilities(e){let t=(0,hR.ensure)((0,hR.ensure)(e,"textDocument"),"implementation");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[i,n]=this.getRegistration(t,e.implementationProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i={provideImplementation:(n,s,o)=>{const a=this._client,c=(l,u,h)=>a.sendRequest(uR.ImplementationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(l,u),h).then(g=>h.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(g,h),g=>a.handleFailedRequest(uR.ImplementationRequest.type,h,g,null)),d=a.middleware;return d.provideImplementation?d.provideImplementation(n,s,o,c):c(n,s,o)}};return[this.registerProvider(t,i),i]}registerProvider(e,t){return Cae.languages.registerImplementationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}jK=bT.ImplementationFeature=Eae;var ST={};Object.defineProperty(ST,"__esModule",{value:!0});var BK=ST.TypeDefinitionFeature=void 0;const xae=Dt,fR=Lt,wv=Pi;class Dae extends wv.TextDocumentLanguageFeature{constructor(e){super(e,fR.TypeDefinitionRequest.type)}fillClientCapabilities(e){(0,wv.ensure)((0,wv.ensure)(e,"textDocument"),"typeDefinition").dynamicRegistration=!0;let t=(0,wv.ensure)((0,wv.ensure)(e,"textDocument"),"typeDefinition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[i,n]=this.getRegistration(t,e.typeDefinitionProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i={provideTypeDefinition:(n,s,o)=>{const a=this._client,c=(l,u,h)=>a.sendRequest(fR.TypeDefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(l,u),h).then(g=>h.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(g,h),g=>a.handleFailedRequest(fR.TypeDefinitionRequest.type,h,g,null)),d=a.middleware;return d.provideTypeDefinition?d.provideTypeDefinition(n,s,o,c):c(n,s,o)}};return[this.registerProvider(t,i),i]}registerProvider(e,t){return xae.languages.registerTypeDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}BK=ST.TypeDefinitionFeature=Dae;var rm={};Object.defineProperty(rm,"__esModule",{value:!0});var UK=rm.WorkspaceFoldersFeature=rm.arrayDiff=void 0;const kae=Di,Bb=Dt,bv=Lt;function pR(r,e){if(r!=null)return r[e]}function xM(r,e){return r.filter(t=>e.indexOf(t)<0)}rm.arrayDiff=xM;class Tae{constructor(e){this._client=e,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return bv.DidChangeWorkspaceFoldersNotification.type}fillInitializeParams(e){const t=Bb.workspace.workspaceFolders;this.initializeWithFolders(t),t===void 0?e.workspaceFolders=null:e.workspaceFolders=t.map(i=>this.asProtocol(i))}initializeWithFolders(e){this._initialFolders=e}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.workspaceFolders=!0}initialize(e){const t=this._client;t.onRequest(bv.WorkspaceFoldersRequest.type,s=>{const o=()=>{const c=Bb.workspace.workspaceFolders;return c===void 0?null:c.map(l=>this.asProtocol(l))},a=t.middleware.workspace;return a&&a.workspaceFolders?a.workspaceFolders(s,o):o()});const i=pR(pR(pR(e,"workspace"),"workspaceFolders"),"changeNotifications");let n;typeof i=="string"?n=i:i===!0&&(n=kae.generateUuid()),n&&this.register({id:n,registerOptions:void 0})}sendInitialEvent(e){let t;if(this._initialFolders&&e){const i=xM(this._initialFolders,e),n=xM(e,this._initialFolders);(n.length>0||i.length>0)&&(t=this.doSendEvent(n,i))}else this._initialFolders?t=this.doSendEvent([],this._initialFolders):e&&(t=this.doSendEvent(e,[]));t!==void 0&&t.catch(i=>{this._client.error(`Sending notification ${bv.DidChangeWorkspaceFoldersNotification.type.method} failed`,i)})}doSendEvent(e,t){let i={event:{added:e.map(n=>this.asProtocol(n)),removed:t.map(n=>this.asProtocol(n))}};return this._client.sendNotification(bv.DidChangeWorkspaceFoldersNotification.type,i)}register(e){let t=e.id,i=this._client,n=Bb.workspace.onDidChangeWorkspaceFolders(s=>{let o=d=>this.doSendEvent(d.added,d.removed),a=i.middleware.workspace;(a&&a.didChangeWorkspaceFolders?a.didChangeWorkspaceFolders(s,o):o(s)).catch(d=>{this._client.error(`Sending notification ${bv.DidChangeWorkspaceFoldersNotification.type.method} failed`,d)})});this._listeners.set(t,n),this.sendInitialEvent(Bb.workspace.workspaceFolders)}unregister(e){let t=this._listeners.get(e);t!==void 0&&(this._listeners.delete(e),t.dispose())}dispose(){for(let e of this._listeners.values())e.dispose();this._listeners.clear()}asProtocol(e){return e===void 0?null:{uri:this._client.code2ProtocolConverter.asUri(e.uri),name:e.name}}}UK=rm.WorkspaceFoldersFeature=Tae;var CT={};Object.defineProperty(CT,"__esModule",{value:!0});var VK=CT.FoldingRangeFeature=void 0;const Iae=Dt,ap=Lt,gR=Pi;class Rae extends gR.TextDocumentLanguageFeature{constructor(e){super(e,ap.FoldingRangeRequest.type)}fillClientCapabilities(e){let t=(0,gR.ensure)((0,gR.ensure)(e,"textDocument"),"foldingRange");t.dynamicRegistration=!0,t.rangeLimit=5e3,t.lineFoldingOnly=!0,t.foldingRangeKind={valueSet:[ap.FoldingRangeKind.Comment,ap.FoldingRangeKind.Imports,ap.FoldingRangeKind.Region]},t.foldingRange={collapsedText:!1}}initialize(e,t){let[i,n]=this.getRegistration(t,e.foldingRangeProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i={provideFoldingRanges:(n,s,o)=>{const a=this._client,c=(l,u,h)=>{const g={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(l)};return a.sendRequest(ap.FoldingRangeRequest.type,g,h).then(m=>h.isCancellationRequested?null:a.protocol2CodeConverter.asFoldingRanges(m,h),m=>a.handleFailedRequest(ap.FoldingRangeRequest.type,h,m,null))},d=a.middleware;return d.provideFoldingRanges?d.provideFoldingRanges(n,s,o,c):c(n,s,o)}};return[Iae.languages.registerFoldingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),i]}}VK=CT.FoldingRangeFeature=Rae;var ET={};Object.defineProperty(ET,"__esModule",{value:!0});var qK=ET.DeclarationFeature=void 0;const Pae=Dt,mR=Lt,vR=Pi;class Aae extends vR.TextDocumentLanguageFeature{constructor(e){super(e,mR.DeclarationRequest.type)}fillClientCapabilities(e){const t=(0,vR.ensure)((0,vR.ensure)(e,"textDocument"),"declaration");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){const[i,n]=this.getRegistration(t,e.declarationProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i={provideDeclaration:(n,s,o)=>{const a=this._client,c=(l,u,h)=>a.sendRequest(mR.DeclarationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(l,u),h).then(g=>h.isCancellationRequested?null:a.protocol2CodeConverter.asDeclarationResult(g,h),g=>a.handleFailedRequest(mR.DeclarationRequest.type,h,g,null)),d=a.middleware;return d.provideDeclaration?d.provideDeclaration(n,s,o,c):c(n,s,o)}};return[this.registerProvider(t,i),i]}registerProvider(e,t){return Pae.languages.registerDeclarationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}qK=ET.DeclarationFeature=Aae;var xT={};Object.defineProperty(xT,"__esModule",{value:!0});var GK=xT.SelectionRangeFeature=void 0;const Mae=Dt,yR=Lt,_R=Pi;class Lae extends _R.TextDocumentLanguageFeature{constructor(e){super(e,yR.SelectionRangeRequest.type)}fillClientCapabilities(e){const t=(0,_R.ensure)((0,_R.ensure)(e,"textDocument"),"selectionRange");t.dynamicRegistration=!0}initialize(e,t){const[i,n]=this.getRegistration(t,e.selectionRangeProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i={provideSelectionRanges:(n,s,o)=>{const a=this._client,c=async(l,u,h)=>{const g={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(l),positions:await a.code2ProtocolConverter.asPositions(u,h)};return a.sendRequest(yR.SelectionRangeRequest.type,g,h).then(m=>h.isCancellationRequested?null:a.protocol2CodeConverter.asSelectionRanges(m,h),m=>a.handleFailedRequest(yR.SelectionRangeRequest.type,h,m,null))},d=a.middleware;return d.provideSelectionRanges?d.provideSelectionRanges(n,s,o,c):c(n,s,o)}};return[this.registerProvider(t,i),i]}registerProvider(e,t){return Mae.languages.registerSelectionRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}GK=xT.SelectionRangeFeature=Lae;var DT={};Object.defineProperty(DT,"__esModule",{value:!0});var zK=DT.ProgressFeature=void 0;const Ej=Lt,Fae=ob;function Oae(r,e){return r[e]===void 0&&(r[e]=Object.create(null)),r[e]}class Nae{constructor(e){this._client=e,this.activeParts=new Set}getState(){return{kind:"window",id:Ej.WorkDoneProgressCreateRequest.method,registrations:this.activeParts.size>0}}fillClientCapabilities(e){Oae(e,"window").workDoneProgress=!0}initialize(){const e=this._client,t=n=>{this.activeParts.delete(n)},i=n=>{this.activeParts.add(new Fae.ProgressPart(this._client,n.token,t))};e.onRequest(Ej.WorkDoneProgressCreateRequest.type,i)}dispose(){for(const e of this.activeParts)e.done();this.activeParts.clear()}}zK=DT.ProgressFeature=Nae;var kT={};Object.defineProperty(kT,"__esModule",{value:!0});var KK=kT.CallHierarchyFeature=void 0;const $ae=Dt,Bu=Lt,wR=Pi;class Wae{constructor(e){this.client=e,this.middleware=e.middleware}prepareCallHierarchy(e,t,i){const n=this.client,s=this.middleware,o=(a,c,d)=>{const l=n.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return n.sendRequest(Bu.CallHierarchyPrepareRequest.type,l,d).then(u=>d.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyItems(u,d),u=>n.handleFailedRequest(Bu.CallHierarchyPrepareRequest.type,d,u,null))};return s.prepareCallHierarchy?s.prepareCallHierarchy(e,t,i,o):o(e,t,i)}provideCallHierarchyIncomingCalls(e,t){const i=this.client,n=this.middleware,s=(o,a)=>{const c={item:i.code2ProtocolConverter.asCallHierarchyItem(o)};return i.sendRequest(Bu.CallHierarchyIncomingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:i.protocol2CodeConverter.asCallHierarchyIncomingCalls(d,a),d=>i.handleFailedRequest(Bu.CallHierarchyIncomingCallsRequest.type,a,d,null))};return n.provideCallHierarchyIncomingCalls?n.provideCallHierarchyIncomingCalls(e,t,s):s(e,t)}provideCallHierarchyOutgoingCalls(e,t){const i=this.client,n=this.middleware,s=(o,a)=>{const c={item:i.code2ProtocolConverter.asCallHierarchyItem(o)};return i.sendRequest(Bu.CallHierarchyOutgoingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:i.protocol2CodeConverter.asCallHierarchyOutgoingCalls(d,a),d=>i.handleFailedRequest(Bu.CallHierarchyOutgoingCallsRequest.type,a,d,null))};return n.provideCallHierarchyOutgoingCalls?n.provideCallHierarchyOutgoingCalls(e,t,s):s(e,t)}}class Hae extends wR.TextDocumentLanguageFeature{constructor(e){super(e,Bu.CallHierarchyPrepareRequest.type)}fillClientCapabilities(e){const t=e,i=(0,wR.ensure)((0,wR.ensure)(t,"textDocument"),"callHierarchy");i.dynamicRegistration=!0}initialize(e,t){const[i,n]=this.getRegistration(t,e.callHierarchyProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=this._client,i=new Wae(t);return[$ae.languages.registerCallHierarchyProvider(this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector),i),i]}}KK=kT.CallHierarchyFeature=Hae;var TT={};Object.defineProperty(TT,"__esModule",{value:!0});var QK=TT.SemanticTokensFeature=void 0;const Ub=Dt,Ot=Lt,Sv=Pi,jae=Ni;class Bae extends Sv.TextDocumentLanguageFeature{constructor(e){super(e,Ot.SemanticTokensRegistrationType.type)}fillClientCapabilities(e){const t=(0,Sv.ensure)((0,Sv.ensure)(e,"textDocument"),"semanticTokens");t.dynamicRegistration=!0,t.tokenTypes=[Ot.SemanticTokenTypes.namespace,Ot.SemanticTokenTypes.type,Ot.SemanticTokenTypes.class,Ot.SemanticTokenTypes.enum,Ot.SemanticTokenTypes.interface,Ot.SemanticTokenTypes.struct,Ot.SemanticTokenTypes.typeParameter,Ot.SemanticTokenTypes.parameter,Ot.SemanticTokenTypes.variable,Ot.SemanticTokenTypes.property,Ot.SemanticTokenTypes.enumMember,Ot.SemanticTokenTypes.event,Ot.SemanticTokenTypes.function,Ot.SemanticTokenTypes.method,Ot.SemanticTokenTypes.macro,Ot.SemanticTokenTypes.keyword,Ot.SemanticTokenTypes.modifier,Ot.SemanticTokenTypes.comment,Ot.SemanticTokenTypes.string,Ot.SemanticTokenTypes.number,Ot.SemanticTokenTypes.regexp,Ot.SemanticTokenTypes.operator,Ot.SemanticTokenTypes.decorator],t.tokenModifiers=[Ot.SemanticTokenModifiers.declaration,Ot.SemanticTokenModifiers.definition,Ot.SemanticTokenModifiers.readonly,Ot.SemanticTokenModifiers.static,Ot.SemanticTokenModifiers.deprecated,Ot.SemanticTokenModifiers.abstract,Ot.SemanticTokenModifiers.async,Ot.SemanticTokenModifiers.modification,Ot.SemanticTokenModifiers.documentation,Ot.SemanticTokenModifiers.defaultLibrary],t.formats=[Ot.TokenFormat.Relative],t.requests={range:!0,full:{delta:!0}},t.multilineTokenSupport=!1,t.overlappingTokenSupport=!1,t.serverCancelSupport=!0,t.augmentsSyntaxTokens=!0,(0,Sv.ensure)((0,Sv.ensure)(e,"workspace"),"semanticTokens").refreshSupport=!0}initialize(e,t){this._client.onRequest(Ot.SemanticTokensRefreshRequest.type,async()=>{for(const o of this.getAllProviders())o.onDidChangeSemanticTokensEmitter.fire()});const[n,s]=this.getRegistration(t,e.semanticTokensProvider);!n||!s||this.register({id:n,registerOptions:s})}registerLanguageProvider(e){const t=e.documentSelector,i=jae.boolean(e.full)?e.full:e.full!==void 0,n=e.full!==void 0&&typeof e.full!="boolean"&&e.full.delta===!0,s=new Ub.EventEmitter,o=i?{onDidChangeSemanticTokens:s.event,provideDocumentSemanticTokens:(g,m)=>{const y=this._client,_=y.middleware,b=(E,D)=>{const R={textDocument:y.code2ProtocolConverter.asTextDocumentIdentifier(E)};return y.sendRequest(Ot.SemanticTokensRequest.type,R,D).then(M=>D.isCancellationRequested?null:y.protocol2CodeConverter.asSemanticTokens(M,D),M=>y.handleFailedRequest(Ot.SemanticTokensRequest.type,D,M,null))};return _.provideDocumentSemanticTokens?_.provideDocumentSemanticTokens(g,m,b):b(g,m)},provideDocumentSemanticTokensEdits:n?(g,m,y)=>{const _=this._client,b=_.middleware,E=(D,R,M)=>{const O={textDocument:_.code2ProtocolConverter.asTextDocumentIdentifier(D),previousResultId:R};return _.sendRequest(Ot.SemanticTokensDeltaRequest.type,O,M).then(async L=>M.isCancellationRequested?null:Ot.SemanticTokens.is(L)?await _.protocol2CodeConverter.asSemanticTokens(L,M):await _.protocol2CodeConverter.asSemanticTokensEdits(L,M),L=>_.handleFailedRequest(Ot.SemanticTokensDeltaRequest.type,M,L,null))};return b.provideDocumentSemanticTokensEdits?b.provideDocumentSemanticTokensEdits(g,m,y,E):E(g,m,y)}:void 0}:void 0,c=e.range===!0?{provideDocumentRangeSemanticTokens:(g,m,y)=>{const _=this._client,b=_.middleware,E=(D,R,M)=>{const O={textDocument:_.code2ProtocolConverter.asTextDocumentIdentifier(D),range:_.code2ProtocolConverter.asRange(R)};return _.sendRequest(Ot.SemanticTokensRangeRequest.type,O,M).then(L=>M.isCancellationRequested?null:_.protocol2CodeConverter.asSemanticTokens(L,M),L=>_.handleFailedRequest(Ot.SemanticTokensRangeRequest.type,M,L,null))};return b.provideDocumentRangeSemanticTokens?b.provideDocumentRangeSemanticTokens(g,m,y,E):E(g,m,y)}}:void 0,d=[],l=this._client,u=l.protocol2CodeConverter.asSemanticTokensLegend(e.legend),h=l.protocol2CodeConverter.asDocumentSelector(t);return o!==void 0&&d.push(Ub.languages.registerDocumentSemanticTokensProvider(h,o,u)),c!==void 0&&d.push(Ub.languages.registerDocumentRangeSemanticTokensProvider(h,c,u)),[new Ub.Disposable(()=>d.forEach(g=>g.dispose())),{range:c,full:o,onDidChangeSemanticTokensEmitter:s}]}}QK=TT.SemanticTokensFeature=Bae;var js={};Object.defineProperty(js,"__esModule",{value:!0});var YK=js.WillDeleteFilesFeature=n3=js.WillRenameFilesFeature=i3=js.WillCreateFilesFeature=t3=js.DidDeleteFilesFeature=e3=js.DidRenameFilesFeature=ZK=js.DidCreateFilesFeature=void 0;const Uo=Dt,Uae=iT,hd=Lt,Vae=Di;function xj(r,e){return r[e]===void 0&&(r[e]={}),r[e]}function qae(r,e){return r[e]}function Dj(r,e,t){r[e]=t}class Nh{constructor(e,t,i,n,s){this._client=e,this._event=t,this._registrationType=i,this._clientCapability=n,this._serverCapability=s,this._filters=new Map}getState(){return{kind:"workspace",id:this._registrationType.method,registrations:this._filters.size>0}}filterSize(){return this._filters.size}get registrationType(){return this._registrationType}fillClientCapabilities(e){const t=xj(xj(e,"workspace"),"fileOperations");Dj(t,"dynamicRegistration",!0),Dj(t,this._clientCapability,!0)}initialize(e){var n;const t=(n=e.workspace)==null?void 0:n.fileOperations,i=t!==void 0?qae(t,this._serverCapability):void 0;if((i==null?void 0:i.filters)!==void 0)try{this.register({id:Vae.generateUuid(),registerOptions:{filters:i.filters}})}catch(s){this._client.warn(`Ignoring invalid glob pattern for ${this._serverCapability} registration: ${s}`)}}register(e){this._listener||(this._listener=this._event(this.send,this));const t=e.registerOptions.filters.map(i=>{const n=new Uae.Minimatch(i.pattern.glob,Nh.asMinimatchOptions(i.pattern.options));if(!n.makeRe())throw new Error(`Invalid pattern ${i.pattern.glob}!`);return{scheme:i.scheme,matcher:n,kind:i.pattern.matches}});this._filters.set(e.id,t)}unregister(e){this._filters.delete(e),this._filters.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._filters.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getFileType(e){return Nh.getFileType(e)}async filter(e,t){const i=await Promise.all(e.files.map(async s=>{const o=t(s),a=o.fsPath.replace(/\\/g,"/");for(const c of this._filters.values())for(const d of c)if(!(d.scheme!==void 0&&d.scheme!==o.scheme)){if(d.matcher.match(a)){if(d.kind===void 0)return!0;const l=await this.getFileType(o);if(l===void 0)return this._client.error(`Failed to determine file type for ${o.toString()}.`),!0;if(l===Uo.FileType.File&&d.kind===hd.FileOperationPatternKind.file||l===Uo.FileType.Directory&&d.kind===hd.FileOperationPatternKind.folder)return!0}else if(d.kind===hd.FileOperationPatternKind.folder&&await Nh.getFileType(o)===Uo.FileType.Directory&&d.matcher.match(`${a}/`))return!0}return!1})),n=e.files.filter((s,o)=>i[o]);return{...e,files:n}}static async getFileType(e){try{return(await Uo.workspace.fs.stat(e)).type}catch{return}}static asMinimatchOptions(e){if(e!==void 0&&e.ignoreCase===!0)return{nocase:!0}}}class XK extends Nh{constructor(e,t,i,n,s,o,a){super(e,t,i,n,s),this._notificationType=i,this._accessUri=o,this._createParams=a}async send(e){const t=await this.filter(e,this._accessUri);if(t.files.length){const i=async n=>this._client.sendNotification(this._notificationType,this._createParams(n));return this.doSend(t,i)}}}class JK extends XK{constructor(){super(...arguments),this._fsPathFileTypes=new Map}async getFileType(e){const t=e.fsPath;if(this._fsPathFileTypes.has(t))return this._fsPathFileTypes.get(t);const i=await Nh.getFileType(e);return i&&this._fsPathFileTypes.set(t,i),i}async cacheFileTypes(e,t){await this.filter(e,t)}clearFileTypeCache(){this._fsPathFileTypes.clear()}unregister(e){super.unregister(e),this.filterSize()===0&&this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}dispose(){super.dispose(),this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}}class Gae extends XK{constructor(e){super(e,Uo.workspace.onDidCreateFiles,hd.DidCreateFilesNotification.type,"didCreate","didCreate",t=>t,e.code2ProtocolConverter.asDidCreateFilesParams)}doSend(e,t){const i=this._client.middleware.workspace;return i!=null&&i.didCreateFiles?i.didCreateFiles(e,t):t(e)}}var ZK=js.DidCreateFilesFeature=Gae;class zae extends JK{constructor(e){super(e,Uo.workspace.onDidRenameFiles,hd.DidRenameFilesNotification.type,"didRename","didRename",t=>t.oldUri,e.code2ProtocolConverter.asDidRenameFilesParams)}register(e){this._willListener||(this._willListener=Uo.workspace.onWillRenameFiles(this.willRename,this)),super.register(e)}willRename(e){e.waitUntil(this.cacheFileTypes(e,t=>t.oldUri))}doSend(e,t){this.clearFileTypeCache();const i=this._client.middleware.workspace;return i!=null&&i.didRenameFiles?i.didRenameFiles(e,t):t(e)}}var e3=js.DidRenameFilesFeature=zae;class Kae extends JK{constructor(e){super(e,Uo.workspace.onDidDeleteFiles,hd.DidDeleteFilesNotification.type,"didDelete","didDelete",t=>t,e.code2ProtocolConverter.asDidDeleteFilesParams)}register(e){this._willListener||(this._willListener=Uo.workspace.onWillDeleteFiles(this.willDelete,this)),super.register(e)}willDelete(e){e.waitUntil(this.cacheFileTypes(e,t=>t))}doSend(e,t){this.clearFileTypeCache();const i=this._client.middleware.workspace;return i!=null&&i.didDeleteFiles?i.didDeleteFiles(e,t):t(e)}}var t3=js.DidDeleteFilesFeature=Kae;class G1 extends Nh{constructor(e,t,i,n,s,o,a){super(e,t,i,n,s),this._requestType=i,this._accessUri=o,this._createParams=a}async send(e){const t=this.waitUntil(e);e.waitUntil(t)}async waitUntil(e){const t=await this.filter(e,this._accessUri);if(t.files.length){const i=n=>this._client.sendRequest(this._requestType,this._createParams(n),n.token).then(this._client.protocol2CodeConverter.asWorkspaceEdit);return this.doSend(t,i)}else return}}class Qae extends G1{constructor(e){super(e,Uo.workspace.onWillCreateFiles,hd.WillCreateFilesRequest.type,"willCreate","willCreate",t=>t,e.code2ProtocolConverter.asWillCreateFilesParams)}doSend(e,t){const i=this._client.middleware.workspace;return i!=null&&i.willCreateFiles?i.willCreateFiles(e,t):t(e)}}var i3=js.WillCreateFilesFeature=Qae;class Yae extends G1{constructor(e){super(e,Uo.workspace.onWillRenameFiles,hd.WillRenameFilesRequest.type,"willRename","willRename",t=>t.oldUri,e.code2ProtocolConverter.asWillRenameFilesParams)}doSend(e,t){const i=this._client.middleware.workspace;return i!=null&&i.willRenameFiles?i.willRenameFiles(e,t):t(e)}}var n3=js.WillRenameFilesFeature=Yae;class Xae extends G1{constructor(e){super(e,Uo.workspace.onWillDeleteFiles,hd.WillDeleteFilesRequest.type,"willDelete","willDelete",t=>t,e.code2ProtocolConverter.asWillDeleteFilesParams)}doSend(e,t){const i=this._client.middleware.workspace;return i!=null&&i.willDeleteFiles?i.willDeleteFiles(e,t):t(e)}}YK=js.WillDeleteFilesFeature=Xae;var IT={};Object.defineProperty(IT,"__esModule",{value:!0});var r3=IT.LinkedEditingFeature=void 0;const Jae=Dt,bR=Lt,SR=Pi;class Zae extends SR.TextDocumentLanguageFeature{constructor(e){super(e,bR.LinkedEditingRangeRequest.type)}fillClientCapabilities(e){const t=(0,SR.ensure)((0,SR.ensure)(e,"textDocument"),"linkedEditingRange");t.dynamicRegistration=!0}initialize(e,t){let[i,n]=this.getRegistration(t,e.linkedEditingRangeProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i={provideLinkedEditingRanges:(n,s,o)=>{const a=this._client,c=(l,u,h)=>a.sendRequest(bR.LinkedEditingRangeRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(l,u),h).then(g=>h.isCancellationRequested?null:a.protocol2CodeConverter.asLinkedEditingRanges(g,h),g=>a.handleFailedRequest(bR.LinkedEditingRangeRequest.type,h,g,null)),d=a.middleware;return d.provideLinkedEditingRange?d.provideLinkedEditingRange(n,s,o,c):c(n,s,o)}};return[this.registerProvider(t,i),i]}registerProvider(e,t){return Jae.languages.registerLinkedEditingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}r3=IT.LinkedEditingFeature=Zae;var RT={};Object.defineProperty(RT,"__esModule",{value:!0});var s3=RT.TypeHierarchyFeature=void 0;const ece=Dt,Uu=Lt,CR=Pi;class tce{constructor(e){this.client=e,this.middleware=e.middleware}prepareTypeHierarchy(e,t,i){const n=this.client,s=this.middleware,o=(a,c,d)=>{const l=n.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return n.sendRequest(Uu.TypeHierarchyPrepareRequest.type,l,d).then(u=>d.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(u,d),u=>n.handleFailedRequest(Uu.TypeHierarchyPrepareRequest.type,d,u,null))};return s.prepareTypeHierarchy?s.prepareTypeHierarchy(e,t,i,o):o(e,t,i)}provideTypeHierarchySupertypes(e,t){const i=this.client,n=this.middleware,s=(o,a)=>{const c={item:i.code2ProtocolConverter.asTypeHierarchyItem(o)};return i.sendRequest(Uu.TypeHierarchySupertypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:i.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>i.handleFailedRequest(Uu.TypeHierarchySupertypesRequest.type,a,d,null))};return n.provideTypeHierarchySupertypes?n.provideTypeHierarchySupertypes(e,t,s):s(e,t)}provideTypeHierarchySubtypes(e,t){const i=this.client,n=this.middleware,s=(o,a)=>{const c={item:i.code2ProtocolConverter.asTypeHierarchyItem(o)};return i.sendRequest(Uu.TypeHierarchySubtypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:i.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>i.handleFailedRequest(Uu.TypeHierarchySubtypesRequest.type,a,d,null))};return n.provideTypeHierarchySubtypes?n.provideTypeHierarchySubtypes(e,t,s):s(e,t)}}class ice extends CR.TextDocumentLanguageFeature{constructor(e){super(e,Uu.TypeHierarchyPrepareRequest.type)}fillClientCapabilities(e){const t=(0,CR.ensure)((0,CR.ensure)(e,"textDocument"),"typeHierarchy");t.dynamicRegistration=!0}initialize(e,t){const[i,n]=this.getRegistration(t,e.typeHierarchyProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=this._client,i=new tce(t);return[ece.languages.registerTypeHierarchyProvider(t.protocol2CodeConverter.asDocumentSelector(e.documentSelector),i),i]}}s3=RT.TypeHierarchyFeature=ice;var PT={};Object.defineProperty(PT,"__esModule",{value:!0});var o3=PT.InlineValueFeature=void 0;const kj=Dt,Vb=Lt,Cv=Pi;class nce extends Cv.TextDocumentLanguageFeature{constructor(e){super(e,Vb.InlineValueRequest.type)}fillClientCapabilities(e){(0,Cv.ensure)((0,Cv.ensure)(e,"textDocument"),"inlineValue").dynamicRegistration=!0,(0,Cv.ensure)((0,Cv.ensure)(e,"workspace"),"inlineValue").refreshSupport=!0}initialize(e,t){this._client.onRequest(Vb.InlineValueRefreshRequest.type,async()=>{for(const s of this.getAllProviders())s.onDidChangeInlineValues.fire()});const[i,n]=this.getRegistration(t,e.inlineValueProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i=new kj.EventEmitter,n={onDidChangeInlineValues:i.event,provideInlineValues:(s,o,a,c)=>{const d=this._client,l=(h,g,m,y)=>{const _={textDocument:d.code2ProtocolConverter.asTextDocumentIdentifier(h),range:d.code2ProtocolConverter.asRange(g),context:d.code2ProtocolConverter.asInlineValueContext(m)};return d.sendRequest(Vb.InlineValueRequest.type,_,y).then(b=>y.isCancellationRequested?null:d.protocol2CodeConverter.asInlineValues(b,y),b=>d.handleFailedRequest(Vb.InlineValueRequest.type,y,b,null))},u=d.middleware;return u.provideInlineValues?u.provideInlineValues(s,o,a,c,l):l(s,o,a,c)}};return[this.registerProvider(t,n),{provider:n,onDidChangeInlineValues:i}]}registerProvider(e,t){return kj.languages.registerInlineValuesProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}o3=PT.InlineValueFeature=nce;var AT={};Object.defineProperty(AT,"__esModule",{value:!0});var a3=AT.InlayHintsFeature=void 0;const Tj=Dt,cp=Lt,Ev=Pi;class rce extends Ev.TextDocumentLanguageFeature{constructor(e){super(e,cp.InlayHintRequest.type)}fillClientCapabilities(e){const t=(0,Ev.ensure)((0,Ev.ensure)(e,"textDocument"),"inlayHint");t.dynamicRegistration=!0,t.resolveSupport={properties:["tooltip","textEdits","label.tooltip","label.location","label.command"]},(0,Ev.ensure)((0,Ev.ensure)(e,"workspace"),"inlayHint").refreshSupport=!0}initialize(e,t){this._client.onRequest(cp.InlayHintRefreshRequest.type,async()=>{for(const s of this.getAllProviders())s.onDidChangeInlayHints.fire()});const[i,n]=this.getRegistration(t,e.inlayHintProvider);!i||!n||this.register({id:i,registerOptions:n})}registerLanguageProvider(e){const t=e.documentSelector,i=new Tj.EventEmitter,n={onDidChangeInlayHints:i.event,provideInlayHints:(s,o,a)=>{const c=this._client,d=async(u,h,g)=>{const m={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(u),range:c.code2ProtocolConverter.asRange(h)};try{const y=await c.sendRequest(cp.InlayHintRequest.type,m,g);return g.isCancellationRequested?null:c.protocol2CodeConverter.asInlayHints(y,g)}catch(y){return c.handleFailedRequest(cp.InlayHintRequest.type,g,y,null)}},l=c.middleware;return l.provideInlayHints?l.provideInlayHints(s,o,a,d):d(s,o,a)}};return n.resolveInlayHint=e.resolveProvider===!0?(s,o)=>{const a=this._client,c=async(l,u)=>{try{const h=await a.sendRequest(cp.InlayHintResolveRequest.type,a.code2ProtocolConverter.asInlayHint(l),u);if(u.isCancellationRequested)return null;const g=a.protocol2CodeConverter.asInlayHint(h,u);return u.isCancellationRequested?null:g}catch(h){return a.handleFailedRequest(cp.InlayHintResolveRequest.type,u,h,null)}},d=a.middleware;return d.resolveInlayHint?d.resolveInlayHint(s,o,c):c(s,o)}:void 0,[this.registerProvider(t,n),{provider:n,onDidChangeInlayHints:i}]}registerProvider(e,t){return Tj.languages.registerInlayHintsProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}}a3=AT.InlayHintsFeature=rce;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ProposedFeatures=r.BaseLanguageClient=r.MessageTransports=r.SuspendMode=r.State=r.CloseAction=r.ErrorAction=r.RevealOutputChannelOn=void 0;const e=Dt,t=Lt,i=qk,n=eT,s=Ni,o=Dr,a=Di,c=ob,d=Pi,l=tT,u=rT,h=Bl,g=Hs,m=sT,y=oT,_=aT,b=cT,E=dT,D=lT,R=uT,M=hT,O=fT,L=pT,W=Ul,Z=mT,K=vT,H=yT,C=_T,B=wT,te=bT,ue=ST,be=rm,de=CT,le=ET,Me=xT,Re=DT,Oe=kT,Ge=TT,xe=js,Kt=IT,je=RT,et=PT,Qt=AT;var ct;(function(ut){ut[ut.Info=1]="Info",ut[ut.Warn=2]="Warn",ut[ut.Error=3]="Error",ut[ut.Never=4]="Never"})(ct=r.RevealOutputChannelOn||(r.RevealOutputChannelOn={}));var ai;(function(ut){ut[ut.Continue=1]="Continue",ut[ut.Shutdown=2]="Shutdown"})(ai=r.ErrorAction||(r.ErrorAction={}));var dt;(function(ut){ut[ut.DoNotRestart=1]="DoNotRestart",ut[ut.Restart=2]="Restart"})(dt=r.CloseAction||(r.CloseAction={}));var xi;(function(ut){ut[ut.Stopped=1]="Stopped",ut[ut.Starting=3]="Starting",ut[ut.Running=2]="Running"})(xi=r.State||(r.State={})),function(ut){ut.off="off",ut.on="on"}(r.SuspendMode||(r.SuspendMode={}));class ci{constructor(U,J){this.client=U,this.maxRestartCount=J,this.restarts=[]}error(U,J,Y){return Y&&Y<=3?{action:ai.Continue}:{action:ai.Shutdown}}closed(){return this.restarts.push(Date.now()),this.restarts.length<=this.maxRestartCount?{action:dt.Restart}:this.restarts[this.restarts.length-1]-this.restarts[0]<=3*60*1e3?{action:dt.DoNotRestart,message:`The ${this.client.name} server crashed ${this.maxRestartCount+1} times in the last 3 minutes. The server will not be restarted. See the output for more information.`}:(this.restarts.shift(),{action:dt.Restart})}}var mt;(function(ut){ut.Initial="initial",ut.Starting="starting",ut.StartFailed="startFailed",ut.Running="running",ut.Stopping="stopping",ut.Stopped="stopped"})(mt||(mt={})),function(ut){function U(J){return J&&t.MessageReader.is(J.reader)&&t.MessageWriter.is(J.writer)}ut.is=U}(r.MessageTransports||(r.MessageTransports={}));class vn{constructor(U,J,Y){var Se;this._traceFormat=t.TraceFormat.Text,this._diagnosticQueue=new Map,this._diagnosticQueueState={state:"idle"},this._features=[],this._dynamicFeatures=new Map,this.workspaceEditLock=new o.Semaphore(1),this._id=U,this._name=J,Y=Y||{};const _e={isTrusted:!1,supportHtml:!1};Y.markdown!==void 0&&(_e.isTrusted=Y.markdown.isTrusted===!0,_e.supportHtml=Y.markdown.supportHtml===!0),this._clientOptions={documentSelector:Y.documentSelector??[],synchronize:Y.synchronize??{},diagnosticCollectionName:Y.diagnosticCollectionName,outputChannelName:Y.outputChannelName??this._name,revealOutputChannelOn:Y.revealOutputChannelOn??ct.Error,stdioEncoding:Y.stdioEncoding??"utf8",initializationOptions:Y.initializationOptions,initializationFailedHandler:Y.initializationFailedHandler,progressOnInitialization:!!Y.progressOnInitialization,errorHandler:Y.errorHandler??this.createDefaultErrorHandler((Se=Y.connectionOptions)==null?void 0:Se.maxRestartCount),middleware:Y.middleware??{},uriConverters:Y.uriConverters,workspaceFolder:Y.workspaceFolder,connectionOptions:Y.connectionOptions,markdown:_e,diagnosticPullOptions:Y.diagnosticPullOptions??{onChange:!0,onSave:!1},notebookDocumentOptions:Y.notebookDocumentOptions??{}},this._clientOptions.synchronize=this._clientOptions.synchronize||{},this._state=mt.Initial,this._ignoredRegistrations=new Set,this._listeners=[],this._notificationHandlers=new Map,this._pendingNotificationHandlers=new Map,this._notificationDisposables=new Map,this._requestHandlers=new Map,this._pendingRequestHandlers=new Map,this._requestDisposables=new Map,this._progressHandlers=new Map,this._pendingProgressHandlers=new Map,this._progressDisposables=new Map,this._connection=void 0,this._initializeResult=void 0,Y.outputChannel?(this._outputChannel=Y.outputChannel,this._disposeOutputChannel=!1):(this._outputChannel=void 0,this._disposeOutputChannel=!0),this._traceOutputChannel=Y.traceOutputChannel,this._diagnostics=void 0,this._pendingOpenNotifications=new Set,this._pendingChangeSemaphore=new o.Semaphore(1),this._pendingChangeDelayer=new o.Delayer(250),this._fileEvents=[],this._fileEventDelayer=new o.Delayer(250),this._onStop=void 0,this._telemetryEmitter=new t.Emitter,this._stateChangeEmitter=new t.Emitter,this._trace=t.Trace.Off,this._tracer={log:(Ce,Vt)=>{s.string(Ce)?this.logTrace(Ce,Vt):this.logObjectTrace(Ce)}},this._c2p=i.createConverter(Y.uriConverters?Y.uriConverters.code2Protocol:void 0),this._p2c=n.createConverter(Y.uriConverters?Y.uriConverters.protocol2Code:void 0,this._clientOptions.markdown.isTrusted,this._clientOptions.markdown.supportHtml),this._syncedDocuments=new Map,this.registerBuiltinFeatures()}get name(){return this._name}get middleware(){return this._clientOptions.middleware??Object.create(null)}get clientOptions(){return this._clientOptions}get protocol2CodeConverter(){return this._p2c}get code2ProtocolConverter(){return this._c2p}get onTelemetry(){return this._telemetryEmitter.event}get onDidChangeState(){return this._stateChangeEmitter.event}get outputChannel(){return this._outputChannel||(this._outputChannel=e.window.createOutputChannel(this._clientOptions.outputChannelName?this._clientOptions.outputChannelName:this._name)),this._outputChannel}get traceOutputChannel(){return this._traceOutputChannel?this._traceOutputChannel:this.outputChannel}get diagnostics(){return this._diagnostics}get state(){return this.getPublicState()}get $state(){return this._state}set $state(U){let J=this.getPublicState();this._state=U;let Y=this.getPublicState();Y!==J&&this._stateChangeEmitter.fire({oldState:J,newState:Y})}getPublicState(){switch(this.$state){case mt.Starting:return xi.Starting;case mt.Running:return xi.Running;default:return xi.Stopped}}get initializeResult(){return this._initializeResult}async sendRequest(U,...J){if(this.$state===mt.StartFailed||this.$state===mt.Stopping||this.$state===mt.Stopped)return Promise.reject(new t.ResponseError(t.ErrorCodes.ConnectionInactive,"Client is not running"));const Y=await this.$start();return this._didChangeTextDocumentFeature.syncKind===t.TextDocumentSyncKind.Full&&await this.sendPendingFullTextDocumentChanges(Y),Y.sendRequest(U,...J)}onRequest(U,J){const Y=typeof U=="string"?U:U.method;this._requestHandlers.set(Y,J);const _e=this.activeConnection();let Se;return _e!==void 0?(this._requestDisposables.set(Y,_e.onRequest(U,J)),Se={dispose:()=>{const Ce=this._requestDisposables.get(Y);Ce!==void 0&&(Ce.dispose(),this._requestDisposables.delete(Y))}}):(this._pendingRequestHandlers.set(Y,J),Se={dispose:()=>{this._pendingRequestHandlers.delete(Y);const Ce=this._requestDisposables.get(Y);Ce!==void 0&&(Ce.dispose(),this._requestDisposables.delete(Y))}}),{dispose:()=>{this._requestHandlers.delete(Y),Se.dispose()}}}async sendNotification(U,J){if(this.$state===mt.StartFailed||this.$state===mt.Stopping||this.$state===mt.Stopped)return Promise.reject(new t.ResponseError(t.ErrorCodes.ConnectionInactive,"Client is not running"));const Y=this._didChangeTextDocumentFeature.syncKind===t.TextDocumentSyncKind.Full;let _e;Y&&typeof U!="string"&&U.method===t.DidOpenTextDocumentNotification.method&&(_e=J==null?void 0:J.textDocument.uri,this._pendingOpenNotifications.add(_e));const Se=await this.$start();return Y&&await this.sendPendingFullTextDocumentChanges(Se),_e!==void 0&&this._pendingOpenNotifications.delete(_e),Se.sendNotification(U,J)}onNotification(U,J){const Y=typeof U=="string"?U:U.method;this._notificationHandlers.set(Y,J);const _e=this.activeConnection();let Se;return _e!==void 0?(this._notificationDisposables.set(Y,_e.onNotification(U,J)),Se={dispose:()=>{const Ce=this._notificationDisposables.get(Y);Ce!==void 0&&(Ce.dispose(),this._notificationDisposables.delete(Y))}}):(this._pendingNotificationHandlers.set(Y,J),Se={dispose:()=>{this._pendingNotificationHandlers.delete(Y);const Ce=this._notificationDisposables.get(Y);Ce!==void 0&&(Ce.dispose(),this._notificationDisposables.delete(Y))}}),{dispose:()=>{this._notificationHandlers.delete(Y),Se.dispose()}}}async sendProgress(U,J,Y){if(this.$state===mt.StartFailed||this.$state===mt.Stopping||this.$state===mt.Stopped)return Promise.reject(new t.ResponseError(t.ErrorCodes.ConnectionInactive,"Client is not running"));try{return(await this.$start()).sendProgress(U,J,Y)}catch(_e){throw this.error(`Sending progress for token ${J} failed.`,_e),_e}}onProgress(U,J,Y){var Pt;this._progressHandlers.set(J,{type:U,handler:Y});const _e=this.activeConnection();let Se;const Ce=(Pt=this._clientOptions.middleware)==null?void 0:Pt.handleWorkDoneProgress,Vt=t.WorkDoneProgress.is(U)&&Ce!==void 0?Zt=>{Ce(J,Zt,()=>Y(Zt))}:Y;return _e!==void 0?(this._progressDisposables.set(J,_e.onProgress(U,J,Vt)),Se={dispose:()=>{const Zt=this._progressDisposables.get(J);Zt!==void 0&&(Zt.dispose(),this._progressDisposables.delete(J))}}):(this._pendingProgressHandlers.set(J,{type:U,handler:Y}),Se={dispose:()=>{this._pendingProgressHandlers.delete(J);const Zt=this._progressDisposables.get(J);Zt!==void 0&&(Zt.dispose(),this._progressDisposables.delete(J))}}),{dispose:()=>{this._progressHandlers.delete(J),Se.dispose()}}}createDefaultErrorHandler(U){if(U!==void 0&&U<0)throw new Error(`Invalid maxRestartCount: ${U}`);return new ci(this,U??4)}async setTrace(U){this._trace=U;const J=this.activeConnection();J!==void 0&&await J.trace(this._trace,this._tracer,{sendNotification:!1,traceFormat:this._traceFormat})}data2String(U){if(U instanceof t.ResponseError){const J=U;return`  Message: ${J.message}
  Code: ${J.code} ${J.data?`
`+J.data.toString():""}`}return U instanceof Error?s.string(U.stack)?U.stack:U.message:s.string(U)?U:U.toString()}info(U,J,Y=!0){this.outputChannel.appendLine(`[Info  - ${new Date().toLocaleTimeString()}] ${U}`),J!=null&&this.outputChannel.appendLine(this.data2String(J)),Y&&this._clientOptions.revealOutputChannelOn<=ct.Info&&this.showNotificationMessage(t.MessageType.Info,U)}warn(U,J,Y=!0){this.outputChannel.appendLine(`[Warn  - ${new Date().toLocaleTimeString()}] ${U}`),J!=null&&this.outputChannel.appendLine(this.data2String(J)),Y&&this._clientOptions.revealOutputChannelOn<=ct.Warn&&this.showNotificationMessage(t.MessageType.Warning,U)}error(U,J,Y=!0){this.outputChannel.appendLine(`[Error - ${new Date().toLocaleTimeString()}] ${U}`),J!=null&&this.outputChannel.appendLine(this.data2String(J)),(Y==="force"||Y&&this._clientOptions.revealOutputChannelOn<=ct.Error)&&this.showNotificationMessage(t.MessageType.Error,U)}showNotificationMessage(U,J){J=J??"A request has failed. See the output for more information.",(U===t.MessageType.Error?e.window.showErrorMessage:U===t.MessageType.Warning?e.window.showWarningMessage:e.window.showInformationMessage)(J,"Go to output").then(_e=>{_e!==void 0&&this.outputChannel.show(!0)})}logTrace(U,J){this.traceOutputChannel.appendLine(`[Trace - ${new Date().toLocaleTimeString()}] ${U}`),J&&this.traceOutputChannel.appendLine(this.data2String(J))}logObjectTrace(U){U.isLSPMessage&&U.type?this.traceOutputChannel.append(`[LSP   - ${new Date().toLocaleTimeString()}] `):this.traceOutputChannel.append(`[Trace - ${new Date().toLocaleTimeString()}] `),U&&this.traceOutputChannel.appendLine(`${JSON.stringify(U)}`)}needsStart(){return this.$state===mt.Initial||this.$state===mt.Stopping||this.$state===mt.Stopped}needsStop(){return this.$state===mt.Starting||this.$state===mt.Running}activeConnection(){return this.$state===mt.Running&&this._connection!==void 0?this._connection:void 0}isRunning(){return this.$state===mt.Running}async start(){if(this._disposed==="disposing"||this._disposed==="disposed")throw new Error("Client got disposed and can't be restarted.");if(this.$state===mt.Stopping)throw new Error("Client is currently stopping. Can only restart a full stopped client");if(this._onStart!==void 0)return this._onStart;const[U,J,Y]=this.createOnStartPromise();this._onStart=U,this._diagnostics===void 0&&(this._diagnostics=this._clientOptions.diagnosticCollectionName?e.languages.createDiagnosticCollection(this._clientOptions.diagnosticCollectionName):e.languages.createDiagnosticCollection());for(const[_e,Se]of this._notificationHandlers)this._pendingNotificationHandlers.has(_e)||this._pendingNotificationHandlers.set(_e,Se);for(const[_e,Se]of this._requestHandlers)this._pendingRequestHandlers.has(_e)||this._pendingRequestHandlers.set(_e,Se);for(const[_e,Se]of this._progressHandlers)this._pendingProgressHandlers.has(_e)||this._pendingProgressHandlers.set(_e,Se);this.$state=mt.Starting;try{const _e=await this.createConnection();_e.onNotification(t.LogMessageNotification.type,Se=>{switch(Se.type){case t.MessageType.Error:this.error(Se.message,void 0,!1);break;case t.MessageType.Warning:this.warn(Se.message,void 0,!1);break;case t.MessageType.Info:this.info(Se.message,void 0,!1);break;default:this.outputChannel.appendLine(Se.message)}}),_e.onNotification(t.ShowMessageNotification.type,Se=>{switch(Se.type){case t.MessageType.Error:e.window.showErrorMessage(Se.message);break;case t.MessageType.Warning:e.window.showWarningMessage(Se.message);break;case t.MessageType.Info:e.window.showInformationMessage(Se.message);break;default:e.window.showInformationMessage(Se.message)}}),_e.onRequest(t.ShowMessageRequest.type,Se=>{let Ce;switch(Se.type){case t.MessageType.Error:Ce=e.window.showErrorMessage;break;case t.MessageType.Warning:Ce=e.window.showWarningMessage;break;case t.MessageType.Info:Ce=e.window.showInformationMessage;break;default:Ce=e.window.showInformationMessage}let Vt=Se.actions||[];return Ce(Se.message,...Vt)}),_e.onNotification(t.TelemetryEventNotification.type,Se=>{this._telemetryEmitter.fire(Se)}),_e.onRequest(t.ShowDocumentRequest.type,async Se=>{var Pt;const Ce=async Zt=>{const cr=this.protocol2CodeConverter.asUri(Zt.uri);try{if(Zt.external===!0)return{success:await e.env.openExternal(cr)};{const yn={};return Zt.selection!==void 0&&(yn.selection=this.protocol2CodeConverter.asRange(Zt.selection)),Zt.takeFocus===void 0||Zt.takeFocus===!1?yn.preserveFocus=!0:Zt.takeFocus===!0&&(yn.preserveFocus=!1),await e.window.showTextDocument(cr,yn),{success:!0}}}catch{return{success:!1}}},Vt=(Pt=this._clientOptions.middleware.window)==null?void 0:Pt.showDocument;return Vt!==void 0?Vt(Se,Ce):Ce(Se)}),_e.listen(),await this.initialize(_e),J()}catch(_e){this.$state=mt.StartFailed,this.error(`${this._name} client: couldn't create connection to server.`,_e,"force"),Y(_e)}return this._onStart}createOnStartPromise(){let U,J;return[new Promise((_e,Se)=>{U=_e,J=Se}),U,J]}async initialize(U){this.refreshTrace(U,!1);const J=this._clientOptions.initializationOptions,[Y,_e]=this._clientOptions.workspaceFolder!==void 0?[this._clientOptions.workspaceFolder.uri.fsPath,[{uri:this._c2p.asUri(this._clientOptions.workspaceFolder.uri),name:this._clientOptions.workspaceFolder.name}]]:[this._clientGetRootPath(),null],Se={processId:null,clientInfo:{name:e.env.appName,version:e.version},locale:this.getLocale(),rootPath:Y||null,rootUri:Y?this._c2p.asUri(e.Uri.file(Y)):null,capabilities:this.computeClientCapabilities(),initializationOptions:s.func(J)?J():J,trace:t.Trace.toString(this._trace),workspaceFolders:_e};if(this.fillInitializeParams(Se),this._clientOptions.progressOnInitialization){const Ce=a.generateUuid(),Vt=new c.ProgressPart(U,Ce);Se.workDoneToken=Ce;try{const Pt=await this.doInitialize(U,Se);return Vt.done(),Pt}catch(Pt){throw Vt.cancel(),Pt}}else return this.doInitialize(U,Se)}async doInitialize(U,J){try{const Y=await U.initialize(J);if(Y.capabilities.positionEncoding!==void 0&&Y.capabilities.positionEncoding!==t.PositionEncodingKind.UTF16)throw new Error(`Unsupported position encoding (${Y.capabilities.positionEncoding}) received from server ${this.name}`);this._initializeResult=Y,this.$state=mt.Running;let _e;s.number(Y.capabilities.textDocumentSync)?Y.capabilities.textDocumentSync===t.TextDocumentSyncKind.None?_e={openClose:!1,change:t.TextDocumentSyncKind.None,save:void 0}:_e={openClose:!0,change:Y.capabilities.textDocumentSync,save:{includeText:!1}}:Y.capabilities.textDocumentSync!==void 0&&Y.capabilities.textDocumentSync!==null&&(_e=Y.capabilities.textDocumentSync),this._capabilities=Object.assign({},Y.capabilities,{resolvedTextDocumentSync:_e}),U.onNotification(t.PublishDiagnosticsNotification.type,Se=>this.handleDiagnostics(Se)),U.onRequest(t.RegistrationRequest.type,Se=>this.handleRegistrationRequest(Se)),U.onRequest("client/registerFeature",Se=>this.handleRegistrationRequest(Se)),U.onRequest(t.UnregistrationRequest.type,Se=>this.handleUnregistrationRequest(Se)),U.onRequest("client/unregisterFeature",Se=>this.handleUnregistrationRequest(Se)),U.onRequest(t.ApplyWorkspaceEditRequest.type,Se=>this.handleApplyWorkspaceEdit(Se));for(const[Se,Ce]of this._pendingNotificationHandlers)this._notificationDisposables.set(Se,U.onNotification(Se,Ce));this._pendingNotificationHandlers.clear();for(const[Se,Ce]of this._pendingRequestHandlers)this._requestDisposables.set(Se,U.onRequest(Se,Ce));this._pendingRequestHandlers.clear();for(const[Se,Ce]of this._pendingProgressHandlers)this._progressDisposables.set(Se,U.onProgress(Ce.type,Se,Ce.handler));return this._pendingProgressHandlers.clear(),await U.sendNotification(t.InitializedNotification.type,{}),this.hookFileEvents(U),this.hookConfigurationChanged(U),this.initializeFeatures(U),Y}catch(Y){throw this._clientOptions.initializationFailedHandler?this._clientOptions.initializationFailedHandler(Y)?this.initialize(U):this.stop():Y instanceof t.ResponseError&&Y.data&&Y.data.retry?e.window.showErrorMessage(Y.message,{title:"Retry",id:"retry"}).then(_e=>{_e&&_e.id==="retry"?this.initialize(U):this.stop()}):(Y&&Y.message&&e.window.showErrorMessage(Y.message),this.error("Server initialization failed.",Y),this.stop()),Y}}_clientGetRootPath(){let U=e.workspace.workspaceFolders;if(!U||U.length===0)return;let J=U[0];if(J.uri.scheme==="file")return J.uri.fsPath}stop(U=2e3){return this.shutdown("stop",U)}dispose(U=2e3){try{return this._disposed="disposing",this.stop(U)}finally{this._disposed="disposed"}}async shutdown(U,J){if(this.$state===mt.Stopped||this.$state===mt.Initial)return;if(this.$state===mt.Stopping){if(this._onStop!==void 0)return this._onStop;throw new Error("Client is stopping but no stop promise available.")}const Y=this.activeConnection();if(Y===void 0||this.$state!==mt.Running)throw new Error(`Client is not running and can't be stopped. It's current state is: ${this.$state}`);this._initializeResult=void 0,this.$state=mt.Stopping,this.cleanUp(U);const _e=new Promise(Ce=>{(0,t.RAL)().timer.setTimeout(Ce,J)}),Se=(async Ce=>(await Ce.shutdown(),await Ce.exit(),Ce))(Y);return this._onStop=Promise.race([_e,Se]).then(Ce=>{if(Ce!==void 0)Ce.end(),Ce.dispose();else throw this.error("Stopping server timed out",void 0,!1),new Error("Stopping the server timed out")},Ce=>{throw this.error("Stopping server failed",Ce,!1),Ce}).finally(()=>{this.$state=mt.Stopped,U==="stop"&&this.cleanUpChannel(),this._onStart=void 0,this._onStop=void 0,this._connection=void 0,this._ignoredRegistrations.clear()})}cleanUp(U){this._fileEvents=[],this._fileEventDelayer.cancel();const J=this._listeners.splice(0,this._listeners.length);for(const Y of J)Y.dispose();this._syncedDocuments&&this._syncedDocuments.clear();for(const Y of Array.from(this._features.entries()).map(_e=>_e[1]).reverse())Y.dispose();U==="stop"&&this._diagnostics!==void 0&&(this._diagnostics.dispose(),this._diagnostics=void 0),this._idleInterval!==void 0&&(this._idleInterval.dispose(),this._idleInterval=void 0)}cleanUpChannel(){this._outputChannel!==void 0&&this._disposeOutputChannel&&(this._outputChannel.dispose(),this._outputChannel=void 0)}notifyFileEvent(U){var Se;const J=this;async function Y(Ce){return J._fileEvents.push(Ce),J._fileEventDelayer.trigger(async()=>{await J.sendNotification(t.DidChangeWatchedFilesNotification.type,{changes:J._fileEvents}),J._fileEvents=[]})}const _e=(Se=this.clientOptions.middleware)==null?void 0:Se.workspace;(_e!=null&&_e.didChangeWatchedFile?_e.didChangeWatchedFile(U,Y):Y(U)).catch(Ce=>{J.error("Notify file events failed.",Ce)})}async sendPendingFullTextDocumentChanges(U){return this._pendingChangeSemaphore.lock(async()=>{try{const J=this._didChangeTextDocumentFeature.getPendingDocumentChanges(this._pendingOpenNotifications);if(J.length===0)return;for(const Y of J){const _e=this.code2ProtocolConverter.asChangeTextDocumentParams(Y);await U.sendNotification(t.DidChangeTextDocumentNotification.type,_e),this._didChangeTextDocumentFeature.notificationSent(Y,t.DidChangeTextDocumentNotification.type,_e)}}catch(J){throw this.error("Sending pending changes failed",J,!1),J}})}triggerPendingChangeDelivery(){this._pendingChangeDelayer.trigger(async()=>{const U=this.activeConnection();if(U===void 0){this.triggerPendingChangeDelivery();return}await this.sendPendingFullTextDocumentChanges(U)}).catch(U=>this.error("Delivering pending changes failed",U,!1))}handleDiagnostics(U){if(!this._diagnostics)return;const J=U.uri;this._diagnosticQueueState.state==="busy"&&this._diagnosticQueueState.document===J&&this._diagnosticQueueState.tokenSource.cancel(),this._diagnosticQueue.set(U.uri,U.diagnostics),this.triggerDiagnosticQueue()}triggerDiagnosticQueue(){(0,t.RAL)().timer.setImmediate(()=>{this.workDiagnosticQueue()})}workDiagnosticQueue(){if(this._diagnosticQueueState.state==="busy")return;const U=this._diagnosticQueue.entries().next();if(U.done===!0)return;const[J,Y]=U.value;this._diagnosticQueue.delete(J);const _e=new e.CancellationTokenSource;this._diagnosticQueueState={state:"busy",document:J,tokenSource:_e},this._p2c.asDiagnostics(Y,_e.token).then(Se=>{if(!_e.token.isCancellationRequested){const Ce=this._p2c.asUri(J),Vt=this.clientOptions.middleware;Vt.handleDiagnostics?Vt.handleDiagnostics(Ce,Se,(Pt,Zt)=>this.setDiagnostics(Pt,Zt)):this.setDiagnostics(Ce,Se)}}).finally(()=>{this._diagnosticQueueState={state:"idle"},this.triggerDiagnosticQueue()})}setDiagnostics(U,J){this._diagnostics&&this._diagnostics.set(U,J)}getLocale(){return e.env.language}async $start(){if(this.$state===mt.StartFailed)throw new Error("Previous start failed. Can't restart server.");await this.start();const U=this.activeConnection();if(U===void 0)throw new Error("Starting server failed");return U}async createConnection(){let U=(_e,Se,Ce)=>{this.handleConnectionError(_e,Se,Ce).catch(Vt=>this.error("Handling connection error failed",Vt))},J=()=>{this.handleConnectionClosed().catch(_e=>this.error("Handling connection close failed",_e))};const Y=await this.createMessageTransports(this._clientOptions.stdioEncoding||"utf8");return this._connection=Kr(Y.reader,Y.writer,U,J,this._clientOptions.connectionOptions),this._connection}async handleConnectionClosed(){if(this.$state===mt.Stopped)return;try{this._connection!==void 0&&this._connection.dispose()}catch{}let U={action:dt.DoNotRestart};if(this.$state!==mt.Stopping)try{U=await this._clientOptions.errorHandler.closed()}catch{}this._connection=void 0,U.action===dt.DoNotRestart?(this.error(U.message??"Connection to server got closed. Server will not be restarted.",void 0,U.handled===!0?!1:"force"),this.cleanUp("stop"),this.$state===mt.Starting?this.$state=mt.StartFailed:this.$state=mt.Stopped,this._onStop=Promise.resolve(),this._onStart=void 0):U.action===dt.Restart&&(this.info(U.message??"Connection to server got closed. Server will restart.",!U.handled),this.cleanUp("restart"),this.$state=mt.Initial,this._onStop=Promise.resolve(),this._onStart=void 0,this.start().catch(J=>this.error("Restarting server failed",J,"force")))}async handleConnectionError(U,J,Y){const _e=await this._clientOptions.errorHandler.error(U,J,Y);_e.action===ai.Shutdown&&(this.error(_e.message??`Client ${this._name}: connection to server is erroring. Shutting down server.`,void 0,_e.handled===!0?!1:"force"),this.stop().catch(Se=>{this.error("Stopping server failed",Se,!1)}))}hookConfigurationChanged(U){this._listeners.push(e.workspace.onDidChangeConfiguration(()=>{this.refreshTrace(U,!0)}))}refreshTrace(U,J=!1){const Y=e.workspace.getConfiguration(this._id);let _e=t.Trace.Off,Se=t.TraceFormat.Text;if(Y){const Ce=Y.get("trace.server","off");typeof Ce=="string"?_e=t.Trace.fromString(Ce):(_e=t.Trace.fromString(Y.get("trace.server.verbosity","off")),Se=t.TraceFormat.fromString(Y.get("trace.server.format","text")))}this._trace=_e,this._traceFormat=Se,U.trace(this._trace,this._tracer,{sendNotification:J,traceFormat:this._traceFormat}).catch(Ce=>{this.error("Updating trace failed with error",Ce,!1)})}hookFileEvents(U){let J=this._clientOptions.synchronize.fileEvents;if(!J)return;let Y;s.array(J)?Y=J:Y=[J],Y&&this._dynamicFeatures.get(t.DidChangeWatchedFilesNotification.type.method).registerRaw(a.generateUuid(),Y)}registerFeatures(U){for(let J of U)this.registerFeature(J)}registerFeature(U){if(this._features.push(U),d.DynamicFeature.is(U)){const J=U.registrationType;this._dynamicFeatures.set(J.method,U)}}getFeature(U){return this._dynamicFeatures.get(U)}hasDedicatedTextSynchronizationFeature(U){const J=this.getFeature(t.NotebookDocumentSyncRegistrationType.method);return J===void 0||!(J instanceof u.NotebookDocumentSyncFeature)?!1:J.handles(U)}registerBuiltinFeatures(){const U=new Map;this.registerFeature(new h.ConfigurationFeature(this)),this.registerFeature(new g.DidOpenTextDocumentFeature(this,this._syncedDocuments)),this._didChangeTextDocumentFeature=new g.DidChangeTextDocumentFeature(this,U),this._didChangeTextDocumentFeature.onPendingChangeAdded(()=>{this.triggerPendingChangeDelivery()}),this.registerFeature(this._didChangeTextDocumentFeature),this.registerFeature(new g.WillSaveFeature(this)),this.registerFeature(new g.WillSaveWaitUntilFeature(this)),this.registerFeature(new g.DidSaveTextDocumentFeature(this)),this.registerFeature(new g.DidCloseTextDocumentFeature(this,this._syncedDocuments,U)),this.registerFeature(new C.FileSystemWatcherFeature(this,J=>this.notifyFileEvent(J))),this.registerFeature(new m.CompletionItemFeature(this)),this.registerFeature(new y.HoverFeature(this)),this.registerFeature(new b.SignatureHelpFeature(this)),this.registerFeature(new _.DefinitionFeature(this)),this.registerFeature(new M.ReferencesFeature(this)),this.registerFeature(new E.DocumentHighlightFeature(this)),this.registerFeature(new D.DocumentSymbolFeature(this)),this.registerFeature(new R.WorkspaceSymbolFeature(this)),this.registerFeature(new O.CodeActionFeature(this)),this.registerFeature(new L.CodeLensFeature(this)),this.registerFeature(new W.DocumentFormattingFeature(this)),this.registerFeature(new W.DocumentRangeFormattingFeature(this)),this.registerFeature(new W.DocumentOnTypeFormattingFeature(this)),this.registerFeature(new Z.RenameFeature(this)),this.registerFeature(new K.DocumentLinkFeature(this)),this.registerFeature(new H.ExecuteCommandFeature(this)),this.registerFeature(new h.SyncConfigurationFeature(this)),this.registerFeature(new ue.TypeDefinitionFeature(this)),this.registerFeature(new te.ImplementationFeature(this)),this.registerFeature(new B.ColorProviderFeature(this)),this.clientOptions.workspaceFolder===void 0&&this.registerFeature(new be.WorkspaceFoldersFeature(this)),this.registerFeature(new de.FoldingRangeFeature(this)),this.registerFeature(new le.DeclarationFeature(this)),this.registerFeature(new Me.SelectionRangeFeature(this)),this.registerFeature(new Re.ProgressFeature(this)),this.registerFeature(new Oe.CallHierarchyFeature(this)),this.registerFeature(new Ge.SemanticTokensFeature(this)),this.registerFeature(new Kt.LinkedEditingFeature(this)),this.registerFeature(new xe.DidCreateFilesFeature(this)),this.registerFeature(new xe.DidRenameFilesFeature(this)),this.registerFeature(new xe.DidDeleteFilesFeature(this)),this.registerFeature(new xe.WillCreateFilesFeature(this)),this.registerFeature(new xe.WillRenameFilesFeature(this)),this.registerFeature(new xe.WillDeleteFilesFeature(this)),this.registerFeature(new je.TypeHierarchyFeature(this)),this.registerFeature(new et.InlineValueFeature(this)),this.registerFeature(new Qt.InlayHintsFeature(this)),this.registerFeature(new l.DiagnosticFeature(this)),this.registerFeature(new u.NotebookDocumentSyncFeature(this))}registerProposedFeatures(){this.registerFeatures(qn.createAll(this))}fillInitializeParams(U){for(let J of this._features)s.func(J.fillInitializeParams)&&J.fillInitializeParams(U)}computeClientCapabilities(){const U={};(0,d.ensure)(U,"workspace").applyEdit=!0;const J=(0,d.ensure)((0,d.ensure)(U,"workspace"),"workspaceEdit");J.documentChanges=!0,J.resourceOperations=[t.ResourceOperationKind.Create,t.ResourceOperationKind.Rename,t.ResourceOperationKind.Delete],J.failureHandling=t.FailureHandlingKind.TextOnlyTransactional,J.normalizesLineEndings=!0,J.changeAnnotationSupport={groupsOnLabel:!0};const Y=(0,d.ensure)((0,d.ensure)(U,"textDocument"),"publishDiagnostics");Y.relatedInformation=!0,Y.versionSupport=!1,Y.tagSupport={valueSet:[t.DiagnosticTag.Unnecessary,t.DiagnosticTag.Deprecated]},Y.codeDescriptionSupport=!0,Y.dataSupport=!0;const _e=(0,d.ensure)(U,"window"),Se=(0,d.ensure)(_e,"showMessage");Se.messageActionItem={additionalPropertiesSupport:!0};const Ce=(0,d.ensure)(_e,"showDocument");Ce.support=!0;const Vt=(0,d.ensure)(U,"general");Vt.staleRequestSupport={cancel:!0,retryOnContentModified:Array.from(vn.RequestsToCancelOnContentModified)},Vt.regularExpressions={engine:"ECMAScript",version:"ES2020"},Vt.markdown={parser:"marked",version:"1.1.0"},Vt.positionEncodings=["utf-16"],this._clientOptions.markdown.supportHtml&&(Vt.markdown.allowedTags=["ul","li","p","code","blockquote","ol","h1","h2","h3","h4","h5","h6","hr","em","pre","table","thead","tbody","tr","th","td","div","del","a","strong","br","img","span"]);for(let Pt of this._features)Pt.fillClientCapabilities(U);return U}initializeFeatures(U){const J=this._clientOptions.documentSelector;for(const Y of this._features)s.func(Y.preInitialize)&&Y.preInitialize(this._capabilities,J);for(const Y of this._features)Y.initialize(this._capabilities,J)}async handleRegistrationRequest(U){if(!this.isRunning()){for(const J of U.registrations)this._ignoredRegistrations.add(J.id);return}for(const J of U.registrations){const Y=this._dynamicFeatures.get(J.method);if(Y===void 0)return Promise.reject(new Error(`No feature implementation for ${J.method} found. Registration failed.`));const _e=J.registerOptions??{};_e.documentSelector=_e.documentSelector??this._clientOptions.documentSelector;const Se={id:J.id,registerOptions:_e};try{Y.register(Se)}catch(Ce){return Promise.reject(Ce)}}}async handleUnregistrationRequest(U){for(let J of U.unregisterations){if(this._ignoredRegistrations.has(J.id))continue;const Y=this._dynamicFeatures.get(J.method);if(!Y)return Promise.reject(new Error(`No feature implementation for ${J.method} found. Unregistration failed.`));Y.unregister(J.id)}}async handleApplyWorkspaceEdit(U){const J=U.edit,Y=await this.workspaceEditLock.lock(()=>this._p2c.asWorkspaceEdit(J)),_e=new Map;e.workspace.textDocuments.forEach(Ce=>_e.set(Ce.uri.toString(),Ce));let Se=!1;if(J.documentChanges){for(const Ce of J.documentChanges)if(t.TextDocumentEdit.is(Ce)&&Ce.textDocument.version&&Ce.textDocument.version>=0){const Vt=this._p2c.asUri(Ce.textDocument.uri).toString(),Pt=_e.get(Vt);if(Pt&&Pt.version!==Ce.textDocument.version){Se=!0;break}}}return Se?Promise.resolve({applied:!1}):s.asPromise(e.workspace.applyEdit(Y).then(Ce=>({applied:Ce})))}handleFailedRequest(U,J,Y,_e,Se=!0){if(Y instanceof t.ResponseError){if(Y.code===t.ErrorCodes.PendingResponseRejected||Y.code===t.ErrorCodes.ConnectionInactive)return _e;if(Y.code===t.LSPErrorCodes.RequestCancelled||Y.code===t.LSPErrorCodes.ServerCancelled){if(J!==void 0&&J.isCancellationRequested)return _e;throw Y.data!==void 0?new d.LSPCancellationError(Y.data):new e.CancellationError}else if(Y.code===t.LSPErrorCodes.ContentModified){if(vn.RequestsToCancelOnContentModified.has(U.method)||vn.CancellableResolveCalls.has(U.method))throw new e.CancellationError;return _e}}throw this.error(`Request ${U.method} failed.`,Y,Se),Y}}r.BaseLanguageClient=vn,vn.RequestsToCancelOnContentModified=new Set([t.SemanticTokensRequest.method,t.SemanticTokensRangeRequest.method,t.SemanticTokensDeltaRequest.method]),vn.CancellableResolveCalls=new Set([t.CompletionResolveRequest.method,t.CodeLensResolveRequest.method,t.CodeActionResolveRequest.method,t.InlayHintResolveRequest.method,t.DocumentLinkResolveRequest.method,t.WorkspaceSymbolResolveRequest.method]);class zr{error(U){(0,t.RAL)().console.error(U)}warn(U){(0,t.RAL)().console.warn(U)}info(U){(0,t.RAL)().console.info(U)}log(U){(0,t.RAL)().console.log(U)}}function Kr(ut,U,J,Y,_e){const Se=new zr,Ce=(0,t.createProtocolConnection)(ut,U,Se,_e);return Ce.onError(Pt=>{J(Pt[0],Pt[1],Pt[2])}),Ce.onClose(Y),{listen:()=>Ce.listen(),sendRequest:Ce.sendRequest,onRequest:Ce.onRequest,hasPendingResponse:Ce.hasPendingResponse,sendNotification:Ce.sendNotification,onNotification:Ce.onNotification,onProgress:Ce.onProgress,sendProgress:Ce.sendProgress,trace:(Pt,Zt,cr)=>{const yn={sendNotification:!1,traceFormat:t.TraceFormat.Text};return cr===void 0?Ce.trace(Pt,Zt,yn):(s.boolean(cr),Ce.trace(Pt,Zt,cr))},initialize:Pt=>Ce.sendRequest(t.InitializeRequest.type,Pt),shutdown:()=>Ce.sendRequest(t.ShutdownRequest.type,void 0),exit:()=>Ce.sendNotification(t.ExitNotification.type),end:()=>Ce.end(),dispose:()=>Ce.dispose()}}var qn;(function(ut){function U(J){return[]}ut.createAll=U})(qn=r.ProposedFeatures||(r.ProposedFeatures={}))})(D1);class sce extends D1.BaseLanguageClient{constructor({id:t,name:i,clientOptions:n,connectionProvider:s}){super(t||i.toLowerCase(),i,n);mi(this,"connectionProvider");this.connectionProvider=s;const o=this.handleRegistrationRequest.bind(this);this.handleRegistrationRequest=c=>{o({...c,registrations:c.registrations.filter(d=>this.getFeature(d.method)!=null)})};const a=this.handleUnregistrationRequest.bind(this);this.handleUnregistrationRequest=c=>{a({...c,unregisterations:c.unregisterations.filter(d=>this.getFeature(d.method)!=null)})}}createMessageTransports(t){return this.connectionProvider.get(t)}getLocale(){return navigator.language||"en-US"}registerBuiltinFeatures(){const t=new Map;this.registerFeature(new yK(this)),this.registerFeature(new wK(this,this._syncedDocuments)),this._didChangeTextDocumentFeature=new SK(this,t),this._didChangeTextDocumentFeature.onPendingChangeAdded(()=>{this.triggerPendingChangeDelivery()}),this.registerFeature(this._didChangeTextDocumentFeature),this.registerFeature(new bK(this,this._syncedDocuments,t)),this.registerFeature(new xK(this)),this.registerFeature(new DK(this)),this.registerFeature(new TK(this)),this.registerFeature(new kK(this)),this.registerFeature(new PK(this)),this.registerFeature(new IK(this)),this.registerFeature(new lT.DocumentSymbolFeature(this)),this.registerFeature(new AK(this)),this.registerFeature(new MK(this)),this.registerFeature(new FK(this)),this.registerFeature(new OK(this)),this.registerFeature(new LK(this)),this.registerFeature(new NK(this)),this.registerFeature(new $K(this)),this.registerFeature(new WK(this)),this.registerFeature(new vK(this)),this.registerFeature(new BK(this)),this.registerFeature(new jK(this)),this.registerFeature(new HK(this)),this.clientOptions.workspaceFolder===void 0&&this.registerFeature(new UK(this)),this.registerFeature(new VK(this)),this.registerFeature(new qK(this)),this.registerFeature(new GK(this)),this.registerFeature(new QK(this)),this.registerFeature(new r3(this)),this.registerFeature(new a3(this)),this.registerFeature(new tT.DiagnosticFeature(this)),this.registerFeature(new CK(this)),this.registerFeature(new EK(this)),this.registerFeature(new _K(this)),this.registerFeature(new RK(this)),this.registerFeature(new ZK(this)),this.registerFeature(new e3(this)),this.registerFeature(new t3(this)),this.registerFeature(new i3(this)),this.registerFeature(new n3(this)),this.registerFeature(new YK(this)),this.registerFeature(new KK(this)),this.registerFeature(new s3(this)),this.registerFeature(new o3(this))}registerNotUsedFeatures(){this.registerFeature(new zK(this)),this.registerFeature(new mK(this))}}const oce="__$__isNewStorageMarker",SS="__$__targetStorageMarker";var Up;(function(r){r[r.NONE=0]="NONE",r[r.SHUTDOWN=1]="SHUTDOWN"})(Up||(Up={}));var Ij;(function(r){r[r.APPLICATION=-1]="APPLICATION",r[r.PROFILE=0]="PROFILE",r[r.WORKSPACE=1]="WORKSPACE"})(Ij||(Ij={}));var Rj;(function(r){r[r.USER=0]="USER",r[r.MACHINE=1]="MACHINE"})(Rj||(Rj={}));function ace(r){const e=r.get(SS);if(e)try{return JSON.parse(e)}catch{}return Object.create(null)}class z1 extends ne{constructor(e={flushInterval:z1.DEFAULT_FLUSH_INTERVAL}){super(),this.options=e,this._onDidChangeValue=this._register(new fC),this.onDidChangeValue=this._onDidChangeValue.event,this._onDidChangeTarget=this._register(new fC),this.onDidChangeTarget=this._onDidChangeTarget.event,this._onWillSaveState=this._register(new A),this.onWillSaveState=this._onWillSaveState.event,this.flushWhenIdleScheduler=this._register(new Ys(()=>this.doFlushWhenIdle(),this.options.flushInterval)),this.runFlushWhenIdle=this._register(new Hr),this._workspaceKeyTargets=void 0,this._profileKeyTargets=void 0,this._applicationKeyTargets=void 0}doFlushWhenIdle(){this.runFlushWhenIdle.value=Vy(()=>{this.shouldFlushWhenIdle()&&this.flush(),this.flushWhenIdleScheduler.schedule()})}shouldFlushWhenIdle(){return!0}stopFlushWhenIdle(){vt([this.runFlushWhenIdle,this.flushWhenIdleScheduler])}initialize(){return this.initializationPromise||(this.initializationPromise=(async()=>{qt("code/willInitStorage");try{await this.doInitialize()}finally{qt("code/didInitStorage")}this.flushWhenIdleScheduler.schedule()})()),this.initializationPromise}emitDidChangeValue(e,t){const{key:i,external:n}=t;if(i===SS){switch(e){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:e})}else this._onDidChangeValue.fire({scope:e,key:i,target:this.getKeyTargets(e)[i],external:n})}emitWillSaveState(e){this._onWillSaveState.fire({reason:e})}get(e,t,i){var n;return(n=this.getStorage(t))==null?void 0:n.get(e,i)}getBoolean(e,t,i){var n;return(n=this.getStorage(t))==null?void 0:n.getBoolean(e,i)}getNumber(e,t,i){var n;return(n=this.getStorage(t))==null?void 0:n.getNumber(e,i)}getObject(e,t,i){var n;return(n=this.getStorage(t))==null?void 0:n.getObject(e,i)}storeAll(e,t){this.withPausedEmitters(()=>{for(const i of e)this.store(i.key,i.value,i.scope,i.target,t)})}store(e,t,i,n,s=!1){if(Wo(t)){this.remove(e,i,s);return}this.withPausedEmitters(()=>{var o;this.updateKeyTarget(e,i,n),(o=this.getStorage(i))==null||o.set(e,t,s)})}remove(e,t,i=!1){this.withPausedEmitters(()=>{var n;this.updateKeyTarget(e,t,void 0),(n=this.getStorage(t))==null||n.delete(e,i)})}withPausedEmitters(e){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{e()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}keys(e,t){const i=[],n=this.getKeyTargets(e);for(const s of Object.keys(n))n[s]===t&&i.push(s);return i}updateKeyTarget(e,t,i,n=!1){var o,a;const s=this.getKeyTargets(t);typeof i=="number"?s[e]!==i&&(s[e]=i,(o=this.getStorage(t))==null||o.set(SS,JSON.stringify(s),n)):typeof s[e]=="number"&&(delete s[e],(a=this.getStorage(t))==null||a.set(SS,JSON.stringify(s),n))}get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(e){switch(e){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(e){const t=this.getStorage(e);return t?ace(t):Object.create(null)}isNew(e){return this.getBoolean(oce,e)===!0}async flush(e=Up.NONE){this._onWillSaveState.fire({reason:e});const t=this.getStorage(-1),i=this.getStorage(0),n=this.getStorage(1);switch(e){case Up.NONE:await Sn.settled([(t==null?void 0:t.whenFlushed())??Promise.resolve(),(i==null?void 0:i.whenFlushed())??Promise.resolve(),(n==null?void 0:n.whenFlushed())??Promise.resolve()]);break;case Up.SHUTDOWN:await Sn.settled([(t==null?void 0:t.flush(0))??Promise.resolve(),(i==null?void 0:i.flush(0))??Promise.resolve(),(n==null?void 0:n.flush(0))??Promise.resolve()]);break}}async log(){var n,s,o;const e=((n=this.getStorage(-1))==null?void 0:n.items)??new Map,t=((s=this.getStorage(0))==null?void 0:s.items)??new Map,i=((o=this.getStorage(1))==null?void 0:o.items)??new Map;return cce(e,t,i,this.getLogDetails(-1)??"",this.getLogDetails(0)??"",this.getLogDetails(1)??"")}async switch(e,t){return this.emitWillSaveState(Up.NONE),iQ(e)?this.switchToProfile(e,t):this.switchToWorkspace(e,t)}canSwitchProfile(e,t){return!(e.id===t.id||Pj(t)&&Pj(e))}switchData(e,t,i){this.withPausedEmitters(()=>{const n=new Set;for(const[s,o]of e)n.add(s),t.get(s)!==o&&this.emitDidChangeValue(i,{key:s,external:!0});for(const[s]of t.items)n.has(s)||this.emitDidChangeValue(i,{key:s,external:!0})})}}z1.DEFAULT_FLUSH_INTERVAL=60*1e3;function Pj(r){var e;return r.isDefault||!!((e=r.useDefaultFlags)!=null&&e.uiState)}async function cce(r,e,t,i,n,s){const o=y=>{try{return JSON.parse(y)}catch{return y}},a=new Map,c=new Map;r.forEach((y,_)=>{a.set(_,y),c.set(_,o(y))});const d=new Map,l=new Map;e.forEach((y,_)=>{d.set(_,y),l.set(_,o(y))});const u=new Map,h=new Map;t.forEach((y,_)=>{u.set(_,y),h.set(_,o(y))}),console.group(i!==n?`Storage: Application (path: ${i})`:`Storage: Application & Profile (path: ${i}, default profile)`);const g=[];if(a.forEach((y,_)=>{g.push({key:_,value:y})}),console.table(g),console.groupEnd(),console.log(c),i!==n){console.group(`Storage: Profile (path: ${n}, profile specific)`);const y=[];d.forEach((_,b)=>{y.push({key:b,value:_})}),console.table(y),console.groupEnd(),console.log(l)}console.group(`Storage: Workspace (path: ${s})`);const m=[];u.forEach((y,_)=>{m.push({key:_,value:y})}),console.table(m),console.groupEnd(),console.log(h)}const ea=re("lifecycleService");function dce(r){switch(r){case 1:return"Starting";case 2:return"Ready";case 3:return"Restored";case 4:return"Eventually"}}var Js;(function(r){r.Workbench="workbench.contributions.kind"})(Js||(Js={}));class lce{constructor(){this.contributions=new Map,this.pendingRestoredContributions=new Hm}registerWorkbenchContribution(e,t=1){if(this.instantiationService&&this.lifecycleService&&this.logService&&this.environmentService&&this.lifecycleService.phase>=t)this.safeCreateContribution(this.instantiationService,this.logService,this.environmentService,e,t);else{let i=this.contributions.get(t);i||(i=[],this.contributions.set(t,i)),i.push(e)}}start(e){const t=this.instantiationService=e.get(Te),i=this.lifecycleService=e.get(ea),n=this.logService=e.get(ze),s=this.environmentService=e.get(ls);for(const o of[1,2,3,4])this.instantiateByPhase(t,i,n,s,o)}instantiateByPhase(e,t,i,n,s){t.phase>=s?this.doInstantiateByPhase(e,i,n,s):t.when(s).then(()=>this.doInstantiateByPhase(e,i,n,s))}async doInstantiateByPhase(e,t,i,n){const s=this.contributions.get(n);if(s)switch(this.contributions.delete(n),n){case 1:case 2:{qt(`code/willCreateWorkbenchContributions/${n}`);for(const o of s)this.safeCreateContribution(e,t,i,o,n);qt(`code/didCreateWorkbenchContributions/${n}`);break}case 3:case 4:{n===4&&await this.pendingRestoredContributions.p,this.doInstantiateWhenIdle(s,e,t,i,n);break}}}doInstantiateWhenIdle(e,t,i,n,s){qt(`code/willCreateWorkbenchContributions/${s}`);let o=0;const a=s===4?3e3:500,c=d=>{for(;o<e.length;){const l=e[o++];if(this.safeCreateContribution(t,i,n,l,s),d.timeRemaining()<1){Vy(c,a);break}}o===e.length&&(qt(`code/didCreateWorkbenchContributions/${s}`),s===3&&this.pendingRestoredContributions.complete())};Vy(c,a)}safeCreateContribution(e,t,i,n,s){const o=s<3?Date.now():void 0;try{e.createInstance(n)}catch(a){t.error(`Unable to create workbench contribution ${n.name}.`,a)}if(typeof o=="number"&&!i.isBuilt){const a=Date.now()-o;a>20&&t.warn(`Workbench contribution ${n.name} blocked restore phase by ${a}ms.`)}}}st.add(Js.Workbench,new lce);const au={EditorPane:"workbench.contributions.editors",EditorFactory:"workbench.contributions.editor.inputFactories"},fd={id:"default",displayName:p("promptOpenWith.defaultEditor.displayName","Text Editor"),providerDisplayName:p("builtinProviderDisplayName","Built-in")},uce="workbench.editor.sidebysideEditor",c3="workbench.editors.textDiffEditor",hce="workbench.editors.binaryResourceDiffEditor";function Aj(r){const e=r;return!!e&&typeof e.getSelection=="function"&&!!e.onDidChangeSelection}function CS(r,e,t){for(const i of t.visibleEditorPanes)if(i.group.id===e&&r.matches(i.input))return i.getViewState()}function d3(r){if(gr(r))return!1;const e=r;return k.isUri(e==null?void 0:e.resource)}function va(r){if(gr(r))return!1;const e=r;return(e==null?void 0:e.original)!==void 0&&e.modified!==void 0}function td(r){if(gr(r)||va(r))return!1;const e=r;return(e==null?void 0:e.primary)!==void 0&&e.secondary!==void 0}function fce(r){if(gr(r))return!1;const e=r;return e?e.resource===void 0||e.resource.scheme===pe.untitled||e.forceUntitled===!0:!1}function hc(r){var t,i,n,s;if(gr(r))return!1;const e=r;return k.isUri((t=e==null?void 0:e.base)==null?void 0:t.resource)&&k.isUri((i=e==null?void 0:e.input1)==null?void 0:i.resource)&&k.isUri((n=e==null?void 0:e.input2)==null?void 0:n.resource)&&k.isUri((s=e==null?void 0:e.result)==null?void 0:s.resource)}class pce{constructor(){this.mapIdToSaveSource=new Map}registerSource(e,t){let i=this.mapIdToSaveSource.get(e);return i||(i={source:e,label:t},this.mapIdToSaveSource.set(e,i)),i.source}getSourceLabel(e){var t;return((t=this.mapIdToSaveSource.get(e))==null?void 0:t.label)??e}}const MT=new pce;class l3 extends ne{}function gr(r){return r instanceof l3}function gce(r){const e=r;return k.isUri(e==null?void 0:e.preferredResource)}function mce(r){const e=r;return gr(e==null?void 0:e.primary)&&gr(e==null?void 0:e.secondary)}function u3(r){const e=r;return gr(e==null?void 0:e.modified)&&gr(e==null?void 0:e.original)}function vce(r,e,t,i,n){return Sce(i,[pC({id:"workbench.action.openLargeFile",label:p("openLargeFile","Open Anyway"),run:()=>{const s={...t,limits:{size:Number.MAX_VALUE}};r.openEditor(e,s)}}),pC({id:"workbench.action.configureEditorLargeFileConfirmation",label:p("configureEditorLargeFileConfirmation","Configure Limit"),run:()=>n.openUserSettings({query:"workbench.editorLargeFileConfirmation"})})],{forceMessage:!0,forceSeverity:yi.Warning})}function yce(r){const e=r;return gr(e==null?void 0:e.editor)}function _ce(r){const e=r;return yce(r)&&(e==null?void 0:e.group)!==void 0}function DM(r){const e=r;return typeof(e==null?void 0:e.groupId)=="number"&&gr(e.editor)}var by;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.REPLACE=1]="REPLACE",r[r.MOVE=2]="MOVE",r[r.UNPIN=3]="UNPIN"})(by||(by={}));var Ui;(function(r){r[r.PRIMARY=1]="PRIMARY",r[r.SECONDARY=2]="SECONDARY",r[r.BOTH=3]="BOTH",r[r.ANY=4]="ANY"})(Ui||(Ui={}));class wce{getOriginalUri(e,t){if(!e)return;if(hc(e))return Vn.getOriginalUri(e.result,t);if(t!=null&&t.supportSideBySide){const{primary:n,secondary:s}=this.getSideEditors(e);if(n&&s){if((t==null?void 0:t.supportSideBySide)===Ui.BOTH)return{primary:this.getOriginalUri(n,{filterByScheme:t.filterByScheme}),secondary:this.getOriginalUri(s,{filterByScheme:t.filterByScheme})};if((t==null?void 0:t.supportSideBySide)===Ui.ANY)return this.getOriginalUri(n,{filterByScheme:t.filterByScheme})??this.getOriginalUri(s,{filterByScheme:t.filterByScheme});e=t.supportSideBySide===Ui.PRIMARY?n:s}}if(va(e)||td(e)||hc(e))return;const i=gce(e)?e.preferredResource:e.resource;return!i||!t||!t.filterByScheme?i:this.filterUri(i,t.filterByScheme)}getSideEditors(e){return mce(e)||td(e)?{primary:e.primary,secondary:e.secondary}:u3(e)||va(e)?{primary:e.modified,secondary:e.original}:{primary:void 0,secondary:void 0}}getCanonicalUri(e,t){if(!e)return;if(hc(e))return Vn.getCanonicalUri(e.result,t);if(t!=null&&t.supportSideBySide){const{primary:n,secondary:s}=this.getSideEditors(e);if(n&&s){if((t==null?void 0:t.supportSideBySide)===Ui.BOTH)return{primary:this.getCanonicalUri(n,{filterByScheme:t.filterByScheme}),secondary:this.getCanonicalUri(s,{filterByScheme:t.filterByScheme})};if((t==null?void 0:t.supportSideBySide)===Ui.ANY)return this.getCanonicalUri(n,{filterByScheme:t.filterByScheme})??this.getCanonicalUri(s,{filterByScheme:t.filterByScheme});e=t.supportSideBySide===Ui.PRIMARY?n:s}}if(va(e)||td(e)||hc(e))return;const i=e.resource;return!i||!t||!t.filterByScheme?i:this.filterUri(i,t.filterByScheme)}filterUri(e,t){if(Array.isArray(t)){if(t.some(i=>e.scheme===i))return e}else if(t===e.scheme)return e}}const Vn=new wce;var Mj;(function(r){r[r.LEFT=0]="LEFT",r[r.RIGHT=1]="RIGHT"})(Mj||(Mj={}));class bce{constructor(){this.editorSerializerConstructors=new Map,this.editorSerializerInstances=new Map}start(e){const t=this.instantiationService=e.get(Te);for(const[i,n]of this.editorSerializerConstructors)this.createEditorSerializer(i,n,t);this.editorSerializerConstructors.clear()}createEditorSerializer(e,t,i){const n=i.createInstance(t);this.editorSerializerInstances.set(e,n)}registerFileEditorFactory(e){if(this.fileEditorFactory)throw new Error("Can only register one file editor factory.");this.fileEditorFactory=e}getFileEditorFactory(){return Mi(this.fileEditorFactory)}registerEditorSerializer(e,t){if(this.editorSerializerConstructors.has(e)||this.editorSerializerInstances.has(e))throw new Error(`A editor serializer with type ID '${e}' was already registered.`);return this.instantiationService?this.createEditorSerializer(e,t,this.instantiationService):this.editorSerializerConstructors.set(e,t),ot(()=>{this.editorSerializerConstructors.delete(e),this.editorSerializerInstances.delete(e)})}getEditorSerializer(e){return this.editorSerializerInstances.get(typeof e=="string"?e:e.typeId)}}st.add(au.EditorFactory,new bce);var Lj;(function(r){r[r.MOST_RECENTLY_ACTIVE=0]="MOST_RECENTLY_ACTIVE",r[r.SEQUENTIAL=1]="SEQUENTIAL"})(Lj||(Lj={}));function LT(r){const e=r;if(!e)return!1;const t=e;if(t.modified)return LT(t.modified);const i=e;return!!(i.contributionsState&&i.viewState&&Array.isArray(i.cursorState))}function JTe(r){return rQ(r)}function Sce(r,e,t){const i=nQ(r,e);return i.forceMessage=t==null?void 0:t.forceMessage,i.forceSeverity=t==null?void 0:t.forceSeverity,i.allowDialog=t==null?void 0:t.allowDialog,i}const it=re("editorGroupsService");var Fj;(function(r){r[r.UP=0]="UP",r[r.DOWN=1]="DOWN",r[r.LEFT=2]="LEFT",r[r.RIGHT=3]="RIGHT"})(Fj||(Fj={}));var Oj;(function(r){r[r.HORIZONTAL=0]="HORIZONTAL",r[r.VERTICAL=1]="VERTICAL"})(Oj||(Oj={}));var Nj;(function(r){r[r.FIRST=0]="FIRST",r[r.LAST=1]="LAST",r[r.NEXT=2]="NEXT",r[r.PREVIOUS=3]="PREVIOUS"})(Nj||(Nj={}));var $j;(function(r){r[r.MAXIMIZE=0]="MAXIMIZE",r[r.EVEN=1]="EVEN",r[r.TOGGLE=2]="TOGGLE"})($j||($j={}));var Wj;(function(r){r[r.COPY_EDITORS=0]="COPY_EDITORS",r[r.MOVE_EDITORS=1]="MOVE_EDITORS"})(Wj||(Wj={}));function ZTe(r){const e=r;return gr(e==null?void 0:e.editor)&&gr(e==null?void 0:e.replacement)}var Hj;(function(r){r[r.CREATION_TIME=0]="CREATION_TIME",r[r.MOST_RECENTLY_ACTIVE=1]="MOST_RECENTLY_ACTIVE",r[r.GRID_APPEARANCE=2]="GRID_APPEARANCE"})(Hj||(Hj={}));function ES(r){const e=r;return!!e&&typeof e.id=="number"&&Array.isArray(e.editors)}function Vf(r){return r.getValue("workbench.editor.openSideBySideDirection")==="down"?1:3}const Ke=re("editorService"),Vl=-1,Ed=-2;function eIe(r){return typeof r=="number"||ES(r)}const Jm=re("paneCompositePartService"),Dn=re("textFileService");class Cce extends Fs{static isTextFileOperationError(e){return e instanceof Error&&!Wo(e.textFileOperationResult)}constructor(e,t,i){super(e,10),this.textFileOperationResult=t,this.options=i}}function Ece(r){let e=!1;return{read(){return e?null:(e=!0,r)}}}function xce(r){if(!(typeof r>"u"))return typeof r=="string"?De.fromString(r):{read:()=>{const e=r.read();return typeof e=="string"?De.fromString(e):null}}}const Od=re("workingCopyService");class Dce extends ne{constructor(){super(...arguments),this._onDidRegister=this._register(new A),this.onDidRegister=this._onDidRegister.event,this._onDidUnregister=this._register(new A),this.onDidUnregister=this._onDidUnregister.event,this._onDidChangeDirty=this._register(new A),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeContent=this._register(new A),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidSave=this._register(new A),this.onDidSave=this._onDidSave.event,this._workingCopies=new Set,this.mapResourceToWorkingCopies=new ki}get workingCopies(){return Array.from(this._workingCopies.values())}registerWorkingCopy(e){let t=this.mapResourceToWorkingCopies.get(e.resource);if(t!=null&&t.has(e.typeId))throw new Error(`Cannot register more than one working copy with the same resource ${e.resource.toString()} and type ${e.typeId}.`);this._workingCopies.add(e),t||(t=new Map,this.mapResourceToWorkingCopies.set(e.resource,t)),t.set(e.typeId,e);const i=new me;return i.add(e.onDidChangeContent(()=>this._onDidChangeContent.fire(e))),i.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire(e))),i.add(e.onDidSave(n=>this._onDidSave.fire({workingCopy:e,...n}))),this._onDidRegister.fire(e),e.isDirty()&&this._onDidChangeDirty.fire(e),ot(()=>{this.unregisterWorkingCopy(e),vt(i),this._onDidUnregister.fire(e)})}unregisterWorkingCopy(e){this._workingCopies.delete(e);const t=this.mapResourceToWorkingCopies.get(e.resource);t!=null&&t.delete(e.typeId)&&t.size===0&&this.mapResourceToWorkingCopies.delete(e.resource),e.isDirty()&&this._onDidChangeDirty.fire(e)}has(e){var t;return k.isUri(e)?this.mapResourceToWorkingCopies.has(e):((t=this.mapResourceToWorkingCopies.get(e.resource))==null?void 0:t.has(e.typeId))??!1}get(e){var t;return(t=this.mapResourceToWorkingCopies.get(e.resource))==null?void 0:t.get(e.typeId)}getAll(e){const t=this.mapResourceToWorkingCopies.get(e);if(t)return Array.from(t.values())}get hasDirty(){for(const e of this._workingCopies)if(e.isDirty())return!0;return!1}get dirtyCount(){let e=0;for(const t of this._workingCopies)t.isDirty()&&e++;return e}get dirtyWorkingCopies(){return this.workingCopies.filter(e=>e.isDirty())}get modifiedCount(){let e=0;for(const t of this._workingCopies)t.isModified()&&e++;return e}get modifiedWorkingCopies(){return this.workingCopies.filter(e=>e.isModified())}isDirty(e,t){var n;const i=this.mapResourceToWorkingCopies.get(e);if(i){if(typeof t=="string")return((n=i.get(t))==null?void 0:n.isDirty())??!1;for(const[,s]of i)if(s.isDirty())return!0}return!1}}let kM=class extends ne{constructor(e,t){super(),this.logService=e,this.configurationService=t,this.participants=new rk}addFileOperationParticipant(e){const t=this.participants.push(e);return ot(()=>t())}async participate(e,t,i,n){const s=this.configurationService.getValue("files.participants.timeout");if(!(typeof s!="number"||s<=0))for(const o of this.participants)try{await o.participate(e,t,i,s,n)}catch(a){this.logService.warn(a)}}dispose(){this.participants.clear()}};kM=T([v(0,ze),v(1,We)],kM);let TM=class extends ne{get length(){return this.saveParticipants.length}constructor(e,t){super(),this.progressService=e,this.logService=t,this.saveParticipants=[]}addSaveParticipant(e){const t=jN(this.saveParticipants,e);return ot(()=>t())}participate(e,t,i){const n=new Xt(i);return this.progressService.withProgress({title:p("saveParticipants","Saving '{0}'",e.name),location:15,cancellable:!0,delay:e.isDirty()?3e3:5e3},async s=>{var o,a;(o=e.model)==null||o.pushStackElement();for(const c of this.saveParticipants){if(n.token.isCancellationRequested||e.isDisposed())break;try{const d=c.participate(e,t,s,n.token);await BN(d,n.token)}catch(d){this.logService.warn(d)}}(a=e.model)==null||a.pushStackElement()},()=>{n.dispose(!0)})}dispose(){this.saveParticipants.splice(0,this.saveParticipants.length)}};TM=T([v(0,kc),v(1,ze)],TM);const $a=re("workingCopyFileService");let IM=class extends ne{constructor(e,t,i,n){super(),this.fileService=e,this.workingCopyService=t,this.instantiationService=i,this.uriIdentityService=n,this._onWillRunWorkingCopyFileOperation=this._register(new Ml),this.onWillRunWorkingCopyFileOperation=this._onWillRunWorkingCopyFileOperation.event,this._onDidFailWorkingCopyFileOperation=this._register(new Ml),this.onDidFailWorkingCopyFileOperation=this._onDidFailWorkingCopyFileOperation.event,this._onDidRunWorkingCopyFileOperation=this._register(new Ml),this.onDidRunWorkingCopyFileOperation=this._onDidRunWorkingCopyFileOperation.event,this.correlationIds=0,this.fileOperationParticipants=this._register(this.instantiationService.createInstance(kM)),this.saveParticipants=this._register(this.instantiationService.createInstance(TM)),this.workingCopyProviders=[],this._register(this.registerWorkingCopyProvider(s=>this.workingCopyService.workingCopies.filter(o=>this.fileService.hasProvider(s)?this.uriIdentityService.extUri.isEqualOrParent(o.resource,s):this.uriIdentityService.extUri.isEqual(o.resource,s))))}create(e,t,i){return this.doCreateFileOrFolder(e,!0,t,i)}createFolder(e,t,i){return this.doCreateFileOrFolder(e,!1,t,i)}async doCreateFileOrFolder(e,t,i,n){if(e.length===0)return[];if(t){const d=(await Sn.settled(e.map(l=>this.fileService.canCreateFile(l.resource,{overwrite:l.overwrite})))).find(l=>l instanceof Error);if(d instanceof Error)throw d}const s=e.map(c=>({target:c.resource}));await this.runFileOperationParticipants(s,0,n,i);const o={correlationId:this.correlationIds++,operation:0,files:s};await this._onWillRunWorkingCopyFileOperation.fireAsync(o,_t.None);let a;try{t?a=await Sn.settled(e.map(c=>this.fileService.createFile(c.resource,c.contents,{overwrite:c.overwrite}))):a=await Sn.settled(e.map(c=>this.fileService.createFolder(c.resource)))}catch(c){throw await this._onDidFailWorkingCopyFileOperation.fireAsync(o,_t.None),c}return await this._onDidRunWorkingCopyFileOperation.fireAsync(o,_t.None),a}async move(e,t,i){return this.doMoveOrCopy(e,!0,t,i)}async copy(e,t,i){return this.doMoveOrCopy(e,!1,t,i)}async doMoveOrCopy(e,t,i,n){const s=[];for(const{file:{source:c,target:d},overwrite:l}of e){const u=await(t?this.fileService.canMove(c,d,l):this.fileService.canCopy(c,d,l));if(u instanceof Error)throw u}const o=e.map(c=>c.file);await this.runFileOperationParticipants(o,t?2:3,n,i);const a={correlationId:this.correlationIds++,operation:t?2:3,files:o};await this._onWillRunWorkingCopyFileOperation.fireAsync(a,_t.None);try{for(const{file:{source:c,target:d},overwrite:l}of e){if(!this.uriIdentityService.extUri.isEqual(c,d)){const u=t?[...this.getDirty(c),...this.getDirty(d)]:this.getDirty(d);await Sn.settled(u.map(h=>h.revert({soft:!0})))}t?s.push(await this.fileService.move(c,d,l)):s.push(await this.fileService.copy(c,d,l))}}catch(c){throw await this._onDidFailWorkingCopyFileOperation.fireAsync(a,_t.None),c}return await this._onDidRunWorkingCopyFileOperation.fireAsync(a,_t.None),s}async delete(e,t,i){for(const o of e){const a=await this.fileService.canDelete(o.resource,{recursive:o.recursive,useTrash:o.useTrash});if(a instanceof Error)throw a}const n=e.map(o=>({target:o.resource}));await this.runFileOperationParticipants(n,1,i,t);const s={correlationId:this.correlationIds++,operation:1,files:n};await this._onWillRunWorkingCopyFileOperation.fireAsync(s,_t.None);for(const o of e){const a=this.getDirty(o.resource);await Sn.settled(a.map(c=>c.revert({soft:!0})))}try{for(const o of e)await this.fileService.del(o.resource,{recursive:o.recursive,useTrash:o.useTrash})}catch(o){throw await this._onDidFailWorkingCopyFileOperation.fireAsync(s,_t.None),o}await this._onDidRunWorkingCopyFileOperation.fireAsync(s,_t.None)}addFileOperationParticipant(e){return this.fileOperationParticipants.addFileOperationParticipant(e)}runFileOperationParticipants(e,t,i,n){return this.fileOperationParticipants.participate(e,t,i,n)}get hasSaveParticipants(){return this.saveParticipants.length>0}addSaveParticipant(e){return this.saveParticipants.addSaveParticipant(e)}runSaveParticipants(e,t,i){return this.saveParticipants.participate(e,t,i)}registerWorkingCopyProvider(e){const t=jN(this.workingCopyProviders,e);return ot(t)}getDirty(e){const t=new Set;for(const i of this.workingCopyProviders)for(const n of i(e))n.isDirty()&&t.add(n);return Array.from(t)}};IM=T([v(0,at),v(1,Od),v(2,Te),v(3,Hi)],IM);function jj(r){return r.scheme!==pe.file&&r.scheme!==pe.vscodeRemote}function h3(r){if(r.folders.length)return r.folders.every(e=>jj(e.uri))?r.folders[0].uri:void 0;if(r.configuration&&jj(r.configuration))return r.configuration}function kce(r){var e;return(e=h3(r))==null?void 0:e.scheme}function rIe(r){return h3(r)!==void 0}const Ar=Rf(ls);var ER,xR,dp,DR,Au,kR,TR,IR,RR,xv,Bj;const Wa=re("remoteAgentService");new(Bj=class{constructor(){ER.set(this,5),xR.set(this,2e3),dp.set(this,[]),DR.set(this,3),Au.set(this,[]),kR.set(this,100),TR.set(this,2),IR.set(this,500),RR.set(this,1500),xv.set(this,void 0)}get latency(){return V(this,xv,"f")}async measure(r){let e=1/0;for(let i=0;i<V(this,ER,"f");i++){const n=await r.getRoundTripTime();if(n===void 0)return;e=Math.min(e,n/2),await zs(V(this,xR,"f"))}V(this,Au,"f").push(e),V(this,Au,"f").length>V(this,kR,"f")&&V(this,Au,"f").shift();let t;return V(this,dp,"f").length<V(this,DR,"f")?V(this,dp,"f").push(e):t=V(this,dp,"f").reduce((i,n)=>i+n,0)/V(this,dp,"f").length,rt(this,xv,{initial:t,current:e,average:V(this,Au,"f").reduce((i,n)=>i+n,0)/V(this,Au,"f").length,high:(()=>typeof t>"u"?!1:e>V(this,RR,"f")||e>V(this,IR,"f")&&e>t*V(this,TR,"f"))()},"f"),V(this,xv,"f")}},ER=new WeakMap,xR=new WeakMap,dp=new WeakMap,DR=new WeakMap,Au=new WeakMap,kR=new WeakMap,TR=new WeakMap,IR=new WeakMap,RR=new WeakMap,xv=new WeakMap,Bj);const ta=re("pathService");let kE=class f3{constructor(e,t,i,n){this.localUserHome=e,this.remoteAgentService=t,this.environmentService=i,this.contextService=n,this.resolveOS=(async()=>{const s=await this.remoteAgentService.getEnvironment();return(s==null?void 0:s.os)||dc})(),this.resolveUserHome=(async()=>{const s=await this.remoteAgentService.getEnvironment();return this.maybeUnresolvedUserHome=(s==null?void 0:s.userHome)??e})()}hasValidBasename(e,t,i){return typeof t=="string"||typeof t>"u"?this.resolveOS.then(n=>this.doHasValidBasename(e,n,t)):this.doHasValidBasename(e,t,i)}doHasValidBasename(e,t,i){return e.scheme===pe.file||e.scheme===pe.vscodeRemote?sQ(i??Mt(e),t===1):!0}get defaultUriScheme(){return f3.findDefaultUriScheme(this.environmentService,this.contextService)}static findDefaultUriScheme(e,t){if(e.remoteAuthority)return pe.vscodeRemote;const i=kce(t.getWorkspace());if(i)return i;const n=t.getWorkspace().folders[0];if(n)return n.uri.scheme;const s=t.getWorkspace().configuration;return s?s.scheme:pe.file}userHome(e){return e!=null&&e.preferLocal?this.localUserHome:this.resolveUserHome}get resolvedUserHome(){return this.maybeUnresolvedUserHome}get path(){return this.resolveOS.then(e=>e===1?oQ:Ho)}async fileURI(e){let t="";if(await this.resolveOS===1&&(e=e.replace(/\\/g,"/")),e[0]==="/"&&e[1]==="/"){const n=e.indexOf("/",2);n===-1?(t=e.substring(2),e="/"):(t=e.substring(2,n),e=e.substring(n)||"/")}return k.from({scheme:pe.file,authority:t,path:e,query:"",fragment:""})}};kE=T([v(1,Wa),v(2,Ar),v(3,oi)],kE);const Rs=re("productService"),Tce="vscode://schemas/vscode-product",p3=re("ILanguageStatusService"),bu=re("hostService"),ab=re("ILanguageDetectionService"),Uj="languageDetection",sIe="automaticlanguagedetection.likelywrong",oIe="automaticlanguagedetection.stats";function g3(r,e){return r.uuid&&e.uuid?r.uuid===e.uuid:r.id===e.id?!0:aQ(r.id,e.id)===0}function K1(r,e){return`${r}.${e}`}function m3(r){return r.toLowerCase()}function Xd(r,e){return m3(K1(r??cQ,e))}class Ice{constructor(){this._generators=new Map,this._cache=new WeakMap}register(e,t){this._generators.set(e,t)}readActivationEvents(e){return this._cache.has(e)||this._cache.set(e,this._readActivationEvents(e)),this._cache.get(e)}createActivationEventsMap(e){const t=Object.create(null);for(const i of e){const n=this.readActivationEvents(i);n.length>0&&(t[fn.toKey(i.identifier)]=n)}return t}_readActivationEvents(e){if(typeof e.main>"u"&&typeof e.browser>"u")return[];const t=Array.isArray(e.activationEvents)?e.activationEvents.slice(0):[];if(!e.contributes)return t;for(const i in e.contributes){const n=this._generators.get(i);if(!n)continue;const s=e.contributes[i],o=Array.isArray(s)?s:[s];try{n(o,t)}catch(a){en(a)}}return t}}const H_=new Ice,v3=Object.freeze({identifier:new fn("nullExtensionDescription"),name:"Null Extension Description",version:"0.0.0",publisher:"vscode",engines:{vscode:""},extensionLocation:k.parse("void:location"),isBuiltin:!1,targetPlatform:"undefined",isUserBuiltin:!1,isUnderDevelopment:!1}),yr=re("extensionService");class Vj{constructor(e){this.dependency=e}}class FT{constructor(){this._allExtensions=[],this._myExtensions=[]}toDelta(){return{toRemove:[],toAdd:this._allExtensions,addActivationEvents:H_.createActivationEventsMap(this._allExtensions),myToRemove:[],myToAdd:this._myExtensions}}set(e,t){const i=[],n=[],s=[],o=[],a=qj(this._allExtensions),c=qj(e),d=(m,y)=>m.extensionLocation.toString()===y.extensionLocation.toString()||m.isBuiltin===y.isBuiltin||m.isUserBuiltin===y.isUserBuiltin||m.isUnderDevelopment===y.isUnderDevelopment;for(const m of this._allExtensions){const y=c.get(m.identifier);if(!y){i.push(m.identifier),a.delete(m.identifier);continue}if(!d(m,y)){i.push(m.identifier),a.delete(m.identifier);continue}}for(const m of e){const y=a.get(m.identifier);if(!y){n.push(m);continue}if(!d(y,m)){i.push(y.identifier),a.delete(y.identifier);continue}}const l=new lc(this._myExtensions),u=new lc(t);for(const m of this._myExtensions)u.has(m)||s.push(m);for(const m of t)l.has(m)||o.push(m);const h=H_.createActivationEventsMap(n),g={toRemove:i,toAdd:n,addActivationEvents:h,myToRemove:s,myToAdd:o};return this.delta(g),g}delta(e){const{toRemove:t,toAdd:i,myToRemove:n,myToAdd:s}=e,o=new lc(t),a=new lc(n);for(let c=0;c<this._allExtensions.length;c++)o.has(this._allExtensions[c].identifier)&&(this._allExtensions.splice(c,1),c--);for(let c=0;c<this._myExtensions.length;c++)a.has(this._myExtensions[c])&&(this._myExtensions.splice(c,1),c--);for(const c of i)this._allExtensions.push(c);for(const c of s)this._myExtensions.push(c)}containsExtension(e){for(const t of this._myExtensions)if(fn.equals(t,e))return!0;return!1}}function qj(r){const e=new Ln;for(const t of r)e.set(t.identifier,t);return e}function ts(r,e){return r.enabledApiProposals?r.enabledApiProposals.includes(e):!1}function He(r,e){var t;if(!ts(r,e))throw new Error(`Extension '${r.identifier.value}' CANNOT use API proposal: ${e}.
Its package.json#enabledApiProposals-property declares: ${((t=r.enabledApiProposals)==null?void 0:t.join(", "))??"[]"} but NOT ${e}.
 The missing proposal MUST be added and you must start in extension development mode or use the following command line switch: --enable-proposed-api ${r.identifier.value}`)}class Rce{constructor(e,t,i,n){this.codeLoadingTime=e,this.activateCallTime=t,this.activateResolvedTime=i,this.activationReason=n}}class Pce{constructor(e,t){this.description=e,this.value=t}}function Ace(r){return{type:r.isBuiltin?0:1,isBuiltin:r.isBuiltin||r.isUserBuiltin,identifier:{id:Xd(r.publisher,r.name),uuid:r.uuid},manifest:r,location:r.extensionLocation,targetPlatform:r.targetPlatform,validations:[],isValid:!0}}function Mce(r,e){return{identifier:new fn(K1(r.manifest.publisher,r.manifest.name)),isBuiltin:r.type===0,isUserBuiltin:r.type===1&&r.isBuiltin,isUnderDevelopment:!!e,extensionLocation:r.location,...r.manifest,uuid:r.identifier.uuid,targetPlatform:r.targetPlatform}}class Lce{constructor(){this.onDidRegisterExtensions=F.None,this.onDidChangeExtensionsStatus=F.None,this.onDidChangeExtensions=F.None,this.onWillActivateByEvent=F.None,this.onDidChangeResponsiveChange=F.None,this.onWillStop=F.None,this.extensions=[]}activateByEvent(e){return Promise.resolve(void 0)}activationEventIsDone(e){return!1}whenInstalledExtensionsRegistered(){return Promise.resolve(!0)}getExtension(){return Promise.resolve(void 0)}readExtensionPointContributions(e){return Promise.resolve(Object.create(null))}getExtensionsStatus(){return Object.create(null)}getInspectPorts(e,t){return Promise.resolve([])}stopExtensionHosts(){}async startExtensionHosts(){}async setRemoteEnvironment(e){}canAddExtension(){return!1}canRemoveExtension(){return!1}}const y3=re("keyboardLayoutService");function aIe(r){return r.name?r.name:r.id?r.id:r.layout}const OT=re("IUserDataInitializationService");let RM=class{constructor(e,t,i){i.whenInstalledExtensionsRegistered().then(()=>this.initializeOtherResource(e,t))}async initializeOtherResource(e,t){await e.requiresInitialization()&&(qt("code/willInitOtherUserData"),await e.initializeOtherResources(t),qt("code/didInitOtherUserData"))}};RM=T([v(0,OT),v(1,Te),v(2,yr)],RM);ln&&st.as(Js.Workbench).registerWorkbenchContribution(RM,3);class Fce extends ne{constructor(){super(),this._onDidSchemeChangeEvent=this._register(new A),this.registerListeners()}registerListeners(){aH("(prefers-color-scheme: dark)",()=>{this._onDidSchemeChangeEvent.fire()}),aH("(forced-colors: active)",()=>{this._onDidSchemeChangeEvent.fire()})}get onDidChangeColorScheme(){return this._onDidSchemeChangeEvent.event}get dark(){return window.matchMedia("(prefers-color-scheme: light)").matches?!1:!!window.matchMedia("(prefers-color-scheme: dark)").matches}get highContrast(){return!!window.matchMedia("(forced-colors: active)").matches}}const Oce=re("hostColorSchemeService");var Gj;(function(r){r.Null="null",r.Enum="enum",r.String="string",r.MultilineString="multiline-string",r.Integer="integer",r.Number="number",r.Boolean="boolean",r.Array="array",r.Exclude="exclude",r.Include="include",r.Complex="complex",r.NullableInteger="nullable-integer",r.NullableNumber="nullable-number",r.Object="object",r.BooleanObject="boolean-object",r.LanguageTag="language-tag",r.ExtensionToggle="extension-toggle"})(Gj||(Gj={}));var zj;(function(r){r[r.None=0]="None",r[r.WholeWordMatch=1]="WholeWordMatch",r[r.KeyMatch=2]="KeyMatch"})(zj||(zj={}));function dIe(r){return{...r,override:fd.id,pinned:!0}}const Q1=re("preferencesService"),lIe="editor.contrib.defineKeybinding",uIe=".vscode/settings.json",hIe="workbench.settings.openDefaultSettings",fIe="workbench.settings.useSplitJSON",NT=re("IUserDataProfileService"),_3=re("IUserDataProfileImportExportService"),Nce=Tc("defaultProfile-icon",jt.settings,p("defaultProfileIcon","Icon for Default Profile."));let PM=class extends ne{get currentProfile(){return this._currentProfile}constructor(e,t){super(),this._onDidChangeCurrentProfile=this._register(new A),this.onDidChangeCurrentProfile=this._onDidChangeCurrentProfile.event,this._onDidUpdateCurrentProfile=this._register(new A),this.onDidUpdateCurrentProfile=this._onDidUpdateCurrentProfile.event,this._currentProfile=e,this._register(t.onDidChangeProfiles(i=>{const n=i.updated.find(s=>this._currentProfile.id===s.id);n&&(this._currentProfile=n,this._onDidUpdateCurrentProfile.fire())}))}async updateCurrentProfile(e){if(this._currentProfile.id===e.id)return;const t=this._currentProfile;this._currentProfile=e;const i=[];this._onDidChangeCurrentProfile.fire({previous:t,profile:e,join(n){i.push(n)}}),await Sn.settled(i)}getShortName(e){return!e.isDefault&&e.shortName&&Si.fromId(e.shortName)?e.shortName:`$(${Nce.id})`}};PM=T([v(1,Pf)],PM);const $T=re("snippetService");class $ce{constructor(e,t){this._mapAltGrToCtrlAlt=e,this._OS=t}dumpDebugInfo(){return"FallbackKeyboardMapper dispatching on keyCode"}resolveKeyboardEvent(e){const t=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,i=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,n=new my(t,e.shiftKey,i,e.metaKey,e.keyCode);return this.resolveKeybinding(new uq([n]))[0]}resolveKeybinding(e){return dQ.resolveKeybinding(e,this._OS)}}const w3=re("textMateTokenizationFeature"),b3=re("activityService");class WT{constructor(e){this.descriptorFn=e,this.descriptorFn=e}getDescription(){return this.descriptorFn(null)}}class Wce extends WT{constructor(e,t){super(t),this.number=e,this.number=e}getDescription(){return this.descriptorFn(this.number)}}class gIe extends WT{constructor(e,t){super(t),this.text=e}}class mIe extends WT{constructor(e,t){super(t),this.icon=e}}class vIe extends WT{}const S3=re("extensionHostDebugService"),Hce=Tc("default-view-icon",jt.window,p("defaultViewIcon","Default view icon."));var Xo;(function(r){r.ViewContainersRegistry="workbench.registry.view.containers",r.ViewsRegistry="workbench.registry.view"})(Xo||(Xo={}));var Kj;(function(r){r[r.Sidebar=0]="Sidebar",r[r.Panel=1]="Panel",r[r.AuxiliaryBar=2]="AuxiliaryBar"})(Kj||(Kj={}));function j_(r){switch(r){case 0:return"sidebar";case 1:return"panel";case 2:return"auxiliarybar"}}class jce extends ne{constructor(){super(...arguments),this._onDidRegister=this._register(new A),this.onDidRegister=this._onDidRegister.event,this._onDidDeregister=this._register(new A),this.onDidDeregister=this._onDidDeregister.event,this.viewContainers=new Map,this.defaultViewContainers=[]}get all(){return qy([...this.viewContainers.values()])}registerViewContainer(e,t,i){const n=this.get(e.id);if(n)return n;const s=e;return s.openCommandActionDescriptor=i!=null&&i.doNotRegisterOpenCommand?void 0:s.openCommandActionDescriptor??{id:s.id},lQ(this.viewContainers,t,[]).push(s),i!=null&&i.isDefault&&this.defaultViewContainers.push(s),this._onDidRegister.fire({viewContainer:s,viewContainerLocation:t}),s}deregisterViewContainer(e){for(const t of this.viewContainers.keys()){const i=this.viewContainers.get(t),n=i==null?void 0:i.indexOf(e);if(n!==-1){i==null||i.splice(n,1),i.length===0&&this.viewContainers.delete(t),this._onDidDeregister.fire({viewContainer:e,viewContainerLocation:t});return}}}get(e){return this.all.filter(t=>t.id===e)[0]}getViewContainers(e){return[...this.viewContainers.get(e)||[]]}getViewContainerLocation(e){return[...this.viewContainers.keys()].filter(t=>this.getViewContainers(t).filter(i=>(i==null?void 0:i.id)===e.id).length>0)[0]}getDefaultViewContainer(e){return this.defaultViewContainers.find(t=>this.getViewContainerLocation(t)===e)}}st.add(Xo.ViewContainersRegistry,new jce);var B_;(function(r){r.Open="2_open",r.Debug="4_debug",r.SCM="5_scm",r.More="9_more"})(B_||(B_={}));function Bce(r,e){const t=r.group??B_.More,i=e.group??B_.More;return t!==i?t.localeCompare(i):(r.order??5)-(e.order??5)}class Uce extends ne{constructor(){super(...arguments),this._onViewsRegistered=this._register(new A),this.onViewsRegistered=this._onViewsRegistered.event,this._onViewsDeregistered=this._register(new A),this.onViewsDeregistered=this._onViewsDeregistered.event,this._onDidChangeContainer=this._register(new A),this.onDidChangeContainer=this._onDidChangeContainer.event,this._onDidChangeViewWelcomeContent=this._register(new A),this.onDidChangeViewWelcomeContent=this._onDidChangeViewWelcomeContent.event,this._viewContainers=[],this._views=new Map,this._viewWelcomeContents=new uQ}registerViews(e,t){this.registerViews2([{views:e,viewContainer:t}])}registerViews2(e){e.forEach(({views:t,viewContainer:i})=>this.addViews(t,i)),this._onViewsRegistered.fire(e)}deregisterViews(e,t){const i=this.removeViews(e,t);i.length&&this._onViewsDeregistered.fire({views:i,viewContainer:t})}moveViews(e,t){for(const i of this._views.keys())if(i!==t){const n=this.removeViews(e,i);n.length&&(this.addViews(n,t),this._onDidChangeContainer.fire({views:n,from:i,to:t}))}}getViews(e){return this._views.get(e)||[]}getView(e){for(const t of this._viewContainers){const i=(this._views.get(t)||[]).filter(n=>n.id===e)[0];if(i)return i}return null}getViewContainer(e){for(const t of this._viewContainers)if((this._views.get(t)||[]).filter(n=>n.id===e)[0])return t;return null}registerViewWelcomeContent(e,t){return this._viewWelcomeContents.add(e,t),this._onDidChangeViewWelcomeContent.fire(e),ot(()=>{this._viewWelcomeContents.delete(e,t),this._onDidChangeViewWelcomeContent.fire(e)})}registerViewWelcomeContent2(e,t){const i=new Map;for(const[n,s]of t)this._viewWelcomeContents.add(e,s),i.set(n,ot(()=>{this._viewWelcomeContents.delete(e,s),this._onDidChangeViewWelcomeContent.fire(e)}));return this._onDidChangeViewWelcomeContent.fire(e),i}getViewWelcomeContent(e){const t=[];return this._viewWelcomeContents.forEach(e,i=>t.push(i)),t.sort(Bce)}addViews(e,t){let i=this._views.get(t);i||(i=[],this._views.set(t,i),this._viewContainers.push(t));for(const n of e){if(this.getView(n.id)!==null)throw new Error(p("duplicateId","A view with id '{0}' is already registered",n.id));i.push(n)}}removeViews(e,t){const i=this._views.get(t);if(!i)return[];const n=[],s=[];for(const o of i)e.includes(o)?n.push(o):s.push(o);return n.length&&(s.length?this._views.set(t,s):(this._views.delete(t),this._viewContainers.splice(this._viewContainers.indexOf(t),1))),n}}st.add(Xo.ViewsRegistry,new Uce);const ko=re("viewsService"),to=re("viewDescriptorService");var AM;(function(r){r[r.Default=0]="Default",r[r.Expand=1]="Expand"})(AM||(AM={}));var Qj;(function(r){r[r.None=0]="None",r[r.Collapsed=1]="Collapsed",r[r.Expanded=2]="Expanded"})(Qj||(Qj={}));class PR{constructor(e,t){this.resolved=!1,this._hasResolve=!1,tu(this,e),this._hasResolve=!!t,this.resolve=async i=>{if(t&&!this.resolved){const n=await t(i);n&&(this.tooltip=this.tooltip??n.tooltip,this.command=this.command??n.command)}i.isCancellationRequested||(this.resolved=!0)}}get hasResolve(){return this._hasResolve}resetResolve(){this.resolved=!1}asTreeItem(){return{handle:this.handle,parentHandle:this.parentHandle,collapsibleState:this.collapsibleState,label:this.label,description:this.description,icon:this.icon,iconDark:this.iconDark,themeIcon:this.themeIcon,resourceUri:this.resourceUri,tooltip:this.tooltip,contextValue:this.contextValue,command:this.command,children:this.children,accessibilityInformation:this.accessibilityInformation}}}class oa extends Error{constructor(e){super(p("treeView.notRegistered","No tree view with id '{0}' registered.",e)),this.name="NoTreeViewError"}static is(e){return e.name==="NoTreeViewError"}}const _r=re("historyService");var Yj;(function(r){r[r.NONE=0]="NONE",r[r.EDITS=1]="EDITS",r[r.NAVIGATION=2]="NAVIGATION"})(Yj||(Yj={}));var Xj;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.EDITOR_GROUP=1]="EDITOR_GROUP",r[r.EDITOR=2]="EDITOR"})(Xj||(Xj={}));const Vce=new G("customExecutionSupported",!1,p("tasks.customExecutionSupported","Whether CustomExecution tasks are supported. Consider using in the when clause of a 'taskDefinition' contribution.")),qce=new G("shellExecutionSupported",!1,p("tasks.shellExecutionSupported","Whether ShellExecution tasks are supported. Consider using in the when clause of a 'taskDefinition' contribution.")),Gce=new G("processExecutionSupported",!1,p("tasks.processExecutionSupported","Whether ProcessExecution tasks are supported. Consider using in the when clause of a 'taskDefinition' contribution.")),yIe=nt.or(nt.and(qce,Gce),Vce),C3=re("taskService"),E3=re("configurationResolverService");var qi;(function(r){r.Unknown="unknown",r.Env="env",r.Config="config",r.Command="command",r.Input="input",r.ExtensionInstallFolder="extensionInstallFolder",r.WorkspaceFolder="workspaceFolder",r.Cwd="cwd",r.WorkspaceFolderBasename="workspaceFolderBasename",r.UserHome="userHome",r.LineNumber="lineNumber",r.SelectedText="selectedText",r.File="file",r.FileWorkspaceFolder="fileWorkspaceFolder",r.RelativeFile="relativeFile",r.RelativeFileDirname="relativeFileDirname",r.FileDirname="fileDirname",r.FileExtname="fileExtname",r.FileBasename="fileBasename",r.FileBasenameNoExtension="fileBasenameNoExtension",r.FileDirnameBasename="fileDirnameBasename",r.ExecPath="execPath",r.ExecInstallFolder="execInstallFolder",r.PathSeparator="pathSeparator"})(qi||(qi={}));class ps extends Error{constructor(e,t){super(t),this.variable=e}}let MM=class extends kE{constructor(e,t,i){super(zce(t,i),e,t,i)}};MM=T([v(0,Wa),v(1,Ar),v(2,oi)],MM);function zce(r,e){const t=e.getWorkspace(),i=Zh(t.folders);return i?i.uri:t.configuration?pn(t.configuration):k.from({scheme:kE.findDefaultUriScheme(r,e),authority:r.remoteAuthority,path:"/"})}const wIe="workbench.view.search",bIe="workbench.view.search",SIe="search.exclude",x3="⟪ ",D3=" characters skipped ⟫",Kce=(x3.length+D3.length+5)*2,cb=re("searchService");function hg(r){return!!r.preview}function CIe(r){return!!r.resource}function EIe(r){return!!r.message}let xIe=class{constructor(e){this.resource=e,this.results=[]}};class Y1{constructor(e,t,i,n){this.ranges=t,this.webviewIndex=n;const s=Array.isArray(t)?t:[t];if(i&&i.matchLines===1&&Qce(s)){e=hQ(e,i.matchLines);let o="",a=0,c=0;const d=Math.floor(i.charsPerLine/5),l=[];for(const u of s){const h=Math.max(u.startColumn-d,0),g=u.startColumn+i.charsPerLine;if(h>c+d+Kce){const m=x3+(h-c)+D3;o+=m+e.slice(h,g),a+=h-(c+m.length)}else o+=e.slice(c,g);l.push(new T3(0,u.startColumn-a,u.endColumn-a)),c=g}this.preview={text:o,matches:Array.isArray(this.ranges)?l:l[0]}}else{const o=Array.isArray(t)?t[0].startLineNumber:t.startLineNumber;this.preview={text:e,matches:Gy(t,a=>new k3(a.startLineNumber-o,a.startColumn,a.endLineNumber-o,a.endColumn))}}}}function Qce(r){const e=r[0].startLineNumber;for(const t of r)if(t.startLineNumber!==e||t.endLineNumber!==e)return!1;return!0}class k3{constructor(e,t,i,n){this.startLineNumber=e,this.startColumn=t,this.endLineNumber=i,this.endColumn=n}}class T3 extends k3{constructor(e,t,i){super(e,t,e,i)}}function Yce(r,e=!0){const t=r&&r.files&&r.files.exclude,i=e&&r&&r.search&&r.search.exclude;if(!t&&!i)return;if(!t||!i)return t||i;let n=Object.create(null);return n=tu(n,Gi(t)),n=tu(n,Gi(i),!0),n}function Jj(r,e){return r.excludePattern&&hS(r.excludePattern,e)?!1:r.includePattern||r.usingSearchPaths?r.includePattern&&hS(r.includePattern,e)?!0:r.usingSearchPaths?!!r.folderQueries&&r.folderQueries.some(t=>{const i=t.folder.fsPath;if(fQ(e,i)){const n=Sg(i,e);return!t.includePattern||!!hS(t.includePattern,n)}else return!1}):!1:!0}var TE;(function(r){r[r.unknownEncoding=1]="unknownEncoding",r[r.regexParseError=2]="regexParseError",r[r.globParseError=3]="globParseError",r[r.invalidLiteral=4]="invalidLiteral",r[r.rgProcessError=5]="rgProcessError",r[r.other=6]="other",r[r.canceled=7]="canceled"})(TE||(TE={}));class AR extends Error{constructor(e,t){super(e),this.code=t}}function kIe(r){const e=r.message;if(Ur(r))return new AR(e,TE.canceled);try{const t=JSON.parse(e);return new AR(t.message,t.code)}catch{return new AR(e,TE.other)}}function IE(r,e){const t={...r||{},...e||{}};return Object.keys(t).filter(i=>{const n=t[i];return typeof n=="boolean"&&n})}class I3{constructor(e,t){this._parsedIncludeExpression=null,this._excludeExpression={...e.excludePattern||{},...t.excludePattern||{}},this._parsedExcludeExpression=vd(this._excludeExpression);let i=e.includePattern;t.includePattern&&(i?i={...i,...t.includePattern}:i=t.includePattern),i&&(this._parsedIncludeExpression=vd(i))}matchesExcludesSync(e,t,i){return!!(this._parsedExcludeExpression&&this._parsedExcludeExpression(e,t,i))}includedInQuerySync(e,t,i){return!(this._parsedExcludeExpression&&this._parsedExcludeExpression(e,t,i)||this._parsedIncludeExpression&&!this._parsedIncludeExpression(e,t,i))}includedInQuery(e,t,i){const n=this._parsedExcludeExpression(e,t,i),s=()=>this._parsedIncludeExpression?!!this._parsedIncludeExpression(e,t,i):!0;return Cg(n)?n.then(o=>o?!1:s()):s()}hasSiblingExcludeClauses(){return Xce(this._excludeExpression)}}function Xce(r){for(const e in r)if(typeof r[e]!="boolean")return!0;return!1}function Jce(r){if(!r)return;let e;return t=>(e||(e=(r()||Promise.resolve([])).then(i=>i?R3(i):{})),e.then(i=>!!i[t]))}function Zce(r){if(!r)return;let e;return t=>{if(!e){const i=r();e=i?R3(i):{}}return!!e[t]}}function R3(r){const e={};for(const t of r)e[t]=!0;return e}const P3=re("requestService");class ede{constructor(e){this.original=e}toJSON(){if(!this.headers){const e=Object.create(null);for(const t in this.original)t.toLowerCase()==="authorization"||t.toLowerCase()==="proxy-authorization"?e[t]="*****":e[t]=this.original[t];this.headers=e}return this.headers}}class tde extends ne{constructor(e){super(),this.counter=0,this.logger=e.createLogger("network",{name:p("request","Network Requests"),when:pQ.isEqualTo(gC(ua.Trace)).serialize()})}async logAndRequest(e,t,i){const n=`${e} #${++this.counter}: ${t.url}`;this.logger.trace(`${n} - begin`,t.type,new ede(t.headers??{}));try{const s=await i();return this.logger.trace(`${n} - end`,t.type,s.res.statusCode,s.res.headers),s}catch(s){throw this.logger.error(`${n} - error`,t.type,UN(s)),s}}}const X1=re("editSessionIdentityService");var LM;(function(r){r[r.Complete=100]="Complete",r[r.Partial=50]="Partial",r[r.None=0]="None"})(LM||(LM={}));const Zm=re("workspaceEditingService"),A3=re("timerService"),TIe="workbench.view.extensions",M3=re("extensionsWorkbenchService"),IIe="workbench.extensions.action.toggleIgnoreExtension",RIe="workbench.extensions.action.installVSIX",PIe="_theme_",AIe="0_install",Zj="^([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$";function MIe(r){switch(r){case"win32-x64":return"Windows 64 bit";case"win32-ia32":return"Windows 32 bit";case"win32-arm64":return"Windows ARM";case"linux-x64":return"Linux 64 bit";case"linux-arm64":return"Linux ARM 64";case"linux-armhf":return"Linux ARM";case"alpine-x64":return"Alpine Linux 64 bit";case"alpine-arm64":return"Alpine ARM 64";case"darwin-x64":return"Mac";case"darwin-arm64":return"Mac Silicon";case"web":return"Web";case"universal":return"universal";case"unknown":return"unknown";case"undefined":return"undefined"}}const ide=re("extensionGalleryService");var eB;(function(r){r.Unsupported="Unsupported",r.Deprecated="Deprecated",r.Malicious="Malicious",r.Incompatible="Incompatible",r.IncompatiblePreRelease="IncompatiblePreRelease",r.IncompatibleTargetPlatform="IncompatibleTargetPlatform",r.ReleaseVersionNotFound="ReleaseVersionNotFound",r.Invalid="Invalid",r.Download="Download",r.Extract="Extract",r.Delete="Delete",r.Rename="Rename",r.CorruptZip="CorruptZip",r.IncompleteZip="IncompleteZip",r.Signature="Signature",r.Internal="Internal"})(eB||(eB={}));const L3=re("extensionManagementService"),nde=Rf(L3),LIe=re("extensionManagementServerService"),J1=Rf(nde),ev=re("extensionEnablementService"),Z1=re("tunnelService");var co;(function(r){r.Http="http",r.Https="https"})(co||(co={}));var Sl;(function(r){r.ConstantPrivate="constantPrivate",r.Private="private",r.Public="public"})(Sl||(Sl={}));var tl;(function(r){r[r.Notify=1]="Notify",r[r.OpenBrowser=2]="OpenBrowser",r[r.OpenPreview=3]="OpenPreview",r[r.Silent=4]="Silent",r[r.Ignore=5]="Ignore",r[r.OpenBrowserOnce=6]="OpenBrowserOnce"})(tl||(tl={}));function FIe(r){if(r.scheme!=="http"&&r.scheme!=="https")return;const e=/^(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d+)$/.exec(r.authority);if(e)return{address:e[1],port:+e[2]}}const e$=["localhost","127.0.0.1","0:0:0:0:0:0:0:1","::1"];function t$(r){return e$.indexOf(r)>=0}const F3=["0.0.0.0","0:0:0:0:0:0:0:0","::"];function i$(r){return F3.indexOf(r)>=0}const n$=re("workingCopyBackupService");let RE=class $c extends ne{constructor(e,t,i,n){super(),this.getExpression=e,this.shouldUpdate=t,this.contextService=i,this.configurationService=n,this._onExpressionChange=this._register(new A),this.onExpressionChange=this._onExpressionChange.event,this.mapFolderToParsedExpression=new Map,this.mapFolderToConfiguredExpression=new Map,this.updateExpressions(!1),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{this.shouldUpdate(e)&&this.updateExpressions(!0)})),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.updateExpressions(!0)))}updateExpressions(e){let t=!1;for(const o of this.contextService.getWorkspace().folders){const a=o.uri.toString(),c=this.doGetExpression(o.uri),d=this.mapFolderToConfiguredExpression.get(a);c?(!d||!xa(d.expression,c.expression))&&(t=!0,this.mapFolderToParsedExpression.set(a,vd(c.expression)),this.mapFolderToConfiguredExpression.set(a,c)):d&&(t=!0,this.mapFolderToParsedExpression.delete(a),this.mapFolderToConfiguredExpression.delete(a))}const i=new sk(this.contextService.getWorkspace().folders.map(o=>o.uri));for(const[o]of this.mapFolderToConfiguredExpression)o!==$c.NO_FOLDER&&(i.has(k.parse(o))||(this.mapFolderToParsedExpression.delete(o),this.mapFolderToConfiguredExpression.delete(o),t=!0));const n=this.doGetExpression(void 0),s=this.mapFolderToConfiguredExpression.get($c.NO_FOLDER);n?(!s||!xa(s.expression,n.expression))&&(t=!0,this.mapFolderToParsedExpression.set($c.NO_FOLDER,vd(n.expression)),this.mapFolderToConfiguredExpression.set($c.NO_FOLDER,n)):s&&(t=!0,this.mapFolderToParsedExpression.delete($c.NO_FOLDER),this.mapFolderToConfiguredExpression.delete($c.NO_FOLDER)),e&&t&&this._onExpressionChange.fire()}doGetExpression(e){const t=this.getExpression(e);if(!t)return;const i=Object.keys(t);if(i.length===0)return;let n=!1;const s=Object.create(null);for(const o of i){n||(n=Eg(o));let a=o;const c=gQ(a,!0);if(c){const d=c.toLowerCase();c!==c.toLowerCase()&&(a=`${d}${a.substring(1)}`)}s[a]=t[o]}return{expression:s,hasAbsolutePath:n}}matches(e,t){if(this.mapFolderToParsedExpression.size===0)return!1;const i=this.contextService.getWorkspaceFolder(e);let n,s;if(i&&this.mapFolderToParsedExpression.has(i.uri.toString())?(n=this.mapFolderToParsedExpression.get(i.uri.toString()),s=this.mapFolderToConfiguredExpression.get(i.uri.toString())):(n=this.mapFolderToParsedExpression.get($c.NO_FOLDER),s=this.mapFolderToConfiguredExpression.get($c.NO_FOLDER)),!n)return!1;let o;return i?o=xg(i.uri,e):o=this.uriToPath(e),typeof o=="string"&&n(o,void 0,t)?!0:o!==this.uriToPath(e)&&(s!=null&&s.hasAbsolutePath)?!!n(this.uriToPath(e),void 0,t):!1}uriToPath(e){return e.scheme===pe.file?e.fsPath:e.path}};RE.NO_FOLDER=null;RE=T([v(2,oi),v(3,We)],RE);const rde=new G("autoSaveAfterShortDelayContext",!1,!0),qr=re("filesConfigurationService");let U_=class Vu extends ne{constructor(e,t,i,n,s,o){var c,d;super(),this.configurationService=t,this.contextService=i,this.environmentService=n,this.uriIdentityService=s,this.fileService=o,this._onAutoSaveConfigurationChange=this._register(new A),this.onAutoSaveConfigurationChange=this._onAutoSaveConfigurationChange.event,this._onFilesAssociationChange=this._register(new A),this.onFilesAssociationChange=this._onFilesAssociationChange.event,this._onReadonlyConfigurationChange=this._register(new A),this.onReadonlyChange=this._onReadonlyConfigurationChange.event,this.readonlyIncludeMatcher=this._register(new bP(()=>this.createReadonlyMatcher(hq))),this.readonlyExcludeMatcher=this._register(new bP(()=>this.createReadonlyMatcher(fq))),this.sessionReadonlyOverrides=new ki(l=>this.uriIdentityService.extUri.getComparisonKey(l)),this.autoSaveAfterShortDelayContext=rde.bindTo(e);const a=t.getValue();this.currentFilesAssociationConfig=(c=a==null?void 0:a.files)==null?void 0:c.associations,this.currentHotExitConfig=((d=a==null?void 0:a.files)==null?void 0:d.hotExit)||Xr.ON_EXIT,this.onFilesConfigurationChange(a),this.registerListeners()}createReadonlyMatcher(e){const t=this._register(new RE(i=>this.configurationService.getValue(e,{resource:i}),i=>i.affectsConfiguration(e),this.contextService,this.configurationService));return this._register(t.onExpressionChange(()=>this._onReadonlyConfigurationChange.fire())),t}isReadonly(e,t){const i=this.fileService.getProvider(e.scheme);if(i&&mQ(i))return i.readOnlyMessage??Vu.READONLY_MESSAGES.providerReadonly;const n=this.sessionReadonlyOverrides.get(e);return typeof n=="boolean"?n===!0?Vu.READONLY_MESSAGES.sessionReadonly:!1:this.uriIdentityService.extUri.isEqualOrParent(e,this.environmentService.userRoamingDataHome)||this.uriIdentityService.extUri.isEqual(e,ii(this.contextService.getWorkspace().configuration))?!1:this.readonlyIncludeMatcher.value.matches(e)?this.readonlyExcludeMatcher.value.matches(e)?!1:Vu.READONLY_MESSAGES.configuredReadonly:this.configuredReadonlyFromPermissions&&(t!=null&&t.locked)?Vu.READONLY_MESSAGES.fileLocked:t!=null&&t.readonly?Vu.READONLY_MESSAGES.fileReadonly:!1}async updateReadonly(e,t){if(t==="toggle"){let i;try{i=await this.fileService.resolve(e,{resolveMetadata:!0})}catch{}t=!this.isReadonly(e,i)}t==="reset"?this.sessionReadonlyOverrides.delete(e):this.sessionReadonlyOverrides.set(e,t),this._onReadonlyConfigurationChange.fire()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration("files")&&this.onFilesConfigurationChange(this.configurationService.getValue())}))}onFilesConfigurationChange(e){var o,a,c,d,l;switch(((o=e==null?void 0:e.files)==null?void 0:o.autoSave)||Vu.DEFAULT_AUTO_SAVE_MODE){case Pn.AFTER_DELAY:this.configuredAutoSaveDelay=(a=e==null?void 0:e.files)==null?void 0:a.autoSaveDelay,this.configuredAutoSaveOnFocusChange=!1,this.configuredAutoSaveOnWindowChange=!1;break;case Pn.ON_FOCUS_CHANGE:this.configuredAutoSaveDelay=void 0,this.configuredAutoSaveOnFocusChange=!0,this.configuredAutoSaveOnWindowChange=!1;break;case Pn.ON_WINDOW_CHANGE:this.configuredAutoSaveDelay=void 0,this.configuredAutoSaveOnFocusChange=!1,this.configuredAutoSaveOnWindowChange=!0;break;default:this.configuredAutoSaveDelay=void 0,this.configuredAutoSaveOnFocusChange=!1,this.configuredAutoSaveOnWindowChange=!1;break}this.autoSaveAfterShortDelayContext.set(this.getAutoSaveMode()===1),this._onAutoSaveConfigurationChange.fire(this.getAutoSaveConfiguration());const i=(c=e==null?void 0:e.files)==null?void 0:c.associations;xa(this.currentFilesAssociationConfig,i)||(this.currentFilesAssociationConfig=i,this._onFilesAssociationChange.fire());const n=(d=e==null?void 0:e.files)==null?void 0:d.hotExit;n===Xr.OFF||n===Xr.ON_EXIT_AND_WINDOW_CLOSE?this.currentHotExitConfig=n:this.currentHotExitConfig=Xr.ON_EXIT;const s=!!((l=e==null?void 0:e.files)!=null&&l.readonlyFromPermissions);s!==!!this.configuredReadonlyFromPermissions&&(this.configuredReadonlyFromPermissions=s,this._onReadonlyConfigurationChange.fire())}getAutoSaveMode(){return this.configuredAutoSaveOnFocusChange?3:this.configuredAutoSaveOnWindowChange?4:typeof this.configuredAutoSaveDelay=="number"&&this.configuredAutoSaveDelay>=0?this.configuredAutoSaveDelay<=1e3?1:2:0}getAutoSaveConfiguration(){return{autoSaveDelay:typeof this.configuredAutoSaveDelay=="number"&&this.configuredAutoSaveDelay>=0?this.configuredAutoSaveDelay:void 0,autoSaveFocusChange:!!this.configuredAutoSaveOnFocusChange,autoSaveApplicationChange:!!this.configuredAutoSaveOnWindowChange}}async toggleAutoSave(){const e=this.configurationService.getValue("files.autoSave");let t;return[Pn.AFTER_DELAY,Pn.ON_FOCUS_CHANGE,Pn.ON_WINDOW_CHANGE].some(i=>i===e)?t=Pn.OFF:t=Pn.AFTER_DELAY,this.configurationService.updateValue("files.autoSave",t)}get isHotExitEnabled(){return this.contextService.getWorkspace().transient?!1:this.currentHotExitConfig!==Xr.OFF}get hotExitConfiguration(){return this.currentHotExitConfig}preventSaveConflicts(e,t){return this.configurationService.getValue("files.saveConflictResolution",{resource:e,overrideIdentifier:t})!=="overwriteFileOnDisk"}};U_.DEFAULT_AUTO_SAVE_MODE=ln?Pn.AFTER_DELAY:Pn.OFF;U_.READONLY_MESSAGES={providerReadonly:{value:p("providerReadonly","Editor is read-only because the file system of the file is read-only."),isTrusted:!0},sessionReadonly:{value:p({key:"sessionReadonly",comment:['Please do not translate the word "command", it is part of our internal syntax which must not change','{Locked="](command:{0})"}']},"Editor is read-only because the file was set read-only in this session. [Click here](command:{0}) to set writeable.","workbench.action.files.setActiveEditorWriteableInSession"),isTrusted:!0},configuredReadonly:{value:p({key:"configuredReadonly",comment:['Please do not translate the word "command", it is part of our internal syntax which must not change','{Locked="](command:{0})"}']},"Editor is read-only because the file was set read-only via settings. [Click here](command:{0}) to configure.",`workbench.action.openSettings?${encodeURIComponent('["files.readonly"]')}`),isTrusted:!0},fileLocked:{value:p({key:"fileLocked",comment:['Please do not translate the word "command", it is part of our internal syntax which must not change','{Locked="](command:{0})"}']},"Editor is read-only because of file permissions. [Click here](command:{0}) to set writeable anyway.","workbench.action.files.setActiveEditorWriteableInSession"),isTrusted:!0},fileReadonly:{value:p("fileReadonly","Editor is read-only because the file is read-only."),isTrusted:!0}};U_=T([v(0,It),v(1,We),v(2,oi),v(3,ls),v(4,Hi),v(5,at)],U_);class db extends ne{constructor(){super(...arguments),this._onWillDispose=this._register(new A),this.onWillDispose=this._onWillDispose.event,this.disposed=!1,this.resolved=!1}async resolve(){this.resolved=!0}isResolved(){return this.resolved}isDisposed(){return this.disposed}dispose(){this.disposed=!0,this._onWillDispose.fire(),super.dispose()}}let Ec=class O3 extends db{constructor(e,t,i,n,s){super(),this.modelService=e,this.languageService=t,this.languageDetectionService=i,this.accessibilityService=n,this.textEditorModelHandle=void 0,this.modelDisposeListener=this._register(new Hr),this.autoDetectLanguageThrottler=this._register(new ok(O3.AUTO_DETECT_LANGUAGE_THROTTLE_DELAY)),this._hasLanguageSetExplicitly=!1,s&&this.handleExistingModel(s)}handleExistingModel(e){const t=this.modelService.getModel(e);if(!t)throw new Error(`Document with resource ${e.toString(!0)} does not exist`);this.textEditorModelHandle=e,this.registerModelDisposeListener(t)}registerModelDisposeListener(e){this.modelDisposeListener.value=e.onWillDispose(()=>{this.textEditorModelHandle=void 0,this.dispose()})}get textEditorModel(){return this.textEditorModelHandle?this.modelService.getModel(this.textEditorModelHandle):null}isReadonly(){return!0}get hasLanguageSetExplicitly(){return this._hasLanguageSetExplicitly}setLanguageId(e,t){this._hasLanguageSetExplicitly=!0,this.setLanguageIdInternal(e,t)}setLanguageIdInternal(e,t){this.isResolved()&&(!e||e===this.textEditorModel.getLanguageId()||this.textEditorModel.setLanguage(this.languageService.createById(e),t))}installModelListeners(e){const t=this._register(e.onDidChangeLanguage(i=>{i.source!==Uj&&(this._hasLanguageSetExplicitly=!0,t.dispose())}))}getLanguageId(){var e;return(e=this.textEditorModel)==null?void 0:e.getLanguageId()}autoDetectLanguage(){return this.autoDetectLanguageThrottler.trigger(()=>this.doAutoDetectLanguage())}async doAutoDetectLanguage(){if(this.hasLanguageSetExplicitly||!this.textEditorModelHandle||!this.languageDetectionService.isEnabledForLanguage(this.getLanguageId()??fo))return;const e=await this.languageDetectionService.detectLanguage(this.textEditorModelHandle),t=this.getLanguageId();if(e&&e!==t&&!this.isDisposed()){this.setLanguageIdInternal(e,Uj);const i=this.languageService.getLanguageName(e);this.accessibilityService.alert(p("languageAutoDetected","Language {0} was automatically detected and set as the language mode.",i??e))}}createTextEditorModel(e,t,i){const n=this.getFirstLineText(e),s=this.getOrCreateLanguage(t,this.languageService,i,n);return this.doCreateTextEditorModel(e,s,t)}doCreateTextEditorModel(e,t,i){let n=i&&this.modelService.getModel(i);return n?this.updateTextEditorModel(e,t.languageId):(n=this.modelService.createModel(e,t,i),this.createdEditorModel=!0,this.registerModelDisposeListener(n)),this.textEditorModelHandle=n.uri,n}getFirstLineText(e){const t=e;return typeof t.getFirstLineText=="function"?t.getFirstLineText(1e3):e.getLineContent(1).substr(0,1e3)}getOrCreateLanguage(e,t,i,n){return!i||i===fo?t.createByFilepathOrFirstLine(ol(e),n):t.createById(i)}updateTextEditorModel(e,t){this.isResolved()&&(e&&this.modelService.updateModel(this.textEditorModel,e),t&&t!==fo&&this.textEditorModel.getLanguageId()!==t&&this.textEditorModel.setLanguage(this.languageService.createById(t)))}createSnapshot(){return this.textEditorModel?this.textEditorModel.createSnapshot(!0):null}isResolved(){return!!this.textEditorModelHandle}dispose(){this.modelDisposeListener.dispose(),this.textEditorModelHandle&&this.createdEditorModel&&this.modelService.destroyModel(this.textEditorModelHandle),this.textEditorModelHandle=void 0,this.createdEditorModel=!1,super.dispose()}};Ec.AUTO_DETECT_LANGUAGE_THROTTLE_DELAY=600;Ec=T([v(0,_i),v(1,ji),v(2,ab),v(3,Af)],Ec);const HT="",hr="utf8",Qc="utf8bom",bf="utf16be",Sf="utf16le",xS=[254,255],FM=[255,254],Vv=[239,187,191],sde=512,ode=512,ade=512*8,cde=512*128;class dde extends Error{constructor(e,t){super(e),this.decodeStreamErrorKind=t}}class r${static async create(e){let t;if(e!==hr)t=(await bi(()=>import("./iconv-911f8ae3.js"),[]).then(n=>n.default??n)).getDecoder(s$(e));else{const i=new TextDecoder;t={write(n){return i.decode(n,{stream:!0})},end(){return i.decode()}}}return new r$(t)}constructor(e){this.iconvLiteDecoder=e}write(e){return this.iconvLiteDecoder.write(e)}end(){return this.iconvLiteDecoder.end()}}function lde(r,e){const t=e.minBytesRequiredForDetection??e.guessEncoding?ade:ode;return new Promise((i,n)=>{const s=pq(u=>u.join("")),o=[];let a=0,c;const d=async()=>{try{const u=await _de({buffer:De.concat(o),bytesRead:a},e.guessEncoding);if(u.seemsBinary&&e.acceptTextOnly)throw new dde("Stream is binary but only text is accepted for decoding",1);u.encoding=await e.overwriteEncoding(u.encoding),c=await r$.create(u.encoding);const h=c.write(De.concat(o).buffer);s.write(h),o.length=0,a=0,i({stream:s,detected:u})}catch(u){l==null||l.dispose(),s.destroy(),n(u)}},l=VN(r,{onData:async u=>{c?s.write(c.write(u.buffer)):(o.push(u),a+=u.byteLength,a>=t&&(r.pause(),await d(),setTimeout(()=>r.resume())))},onError:u=>s.error(u),onEnd:async()=>{c||await d(),s.end(c==null?void 0:c.end())}})})}async function ude(r,e,t){const n=(await bi(()=>import("./iconv-911f8ae3.js"),[]).then(a=>a.default??a)).getEncoder(s$(e),t);let s=!1,o=!1;return{read(){if(o)return null;const a=r.read();if(typeof a!="string"){if(o=!0,!s&&(t!=null&&t.addBOM))switch(e){case hr:case Qc:return De.wrap(Uint8Array.from(Vv));case bf:return De.wrap(Uint8Array.from(xS));case Sf:return De.wrap(Uint8Array.from(FM))}const c=n.end();return c&&c.length>0?(s=!0,De.wrap(c)):null}return s=!0,De.wrap(n.write(a))}}}async function hde(r){return(await bi(()=>import("./iconv-911f8ae3.js"),[]).then(t=>t.default??t)).encodingExists(s$(r))}function s$(r){return r===Qc||r===null?hr:r}function fde(r,e){if(!r||e<xS.length)return null;const t=r.readUInt8(0),i=r.readUInt8(1);if(t===xS[0]&&i===xS[1])return bf;if(t===FM[0]&&i===FM[1])return Sf;if(e<Vv.length)return null;const n=r.readUInt8(2);return t===Vv[0]&&i===Vv[1]&&n===Vv[2]?Qc:null}const pde=["ascii","utf-16","utf-32"];async function gde(r){const e=await bi(()=>import("./jschardet-394b664e.js"),[]).then(o=>o.default??o),t=r.slice(0,cde),i=yde(t.buffer),n=e.detect(i);if(!n||!n.encoding)return null;const s=n.encoding.toLowerCase();return 0<=pde.indexOf(s)?null:vde(n.encoding)}const mde={ibm866:"cp866",big5:"cp950"};function vde(r){const e=r.replace(/[^a-zA-Z0-9]/g,"").toLowerCase();return mde[e]||e}function yde(r){let e="";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e}function _de({buffer:r,bytesRead:e},t){let i=fde(r,e),n=!1;if(i!==bf&&i!==Sf&&r){let s=!0,o=!0,a=!1;for(let c=0;c<e&&c<sde;c++){const d=c%2===1,l=r.readUInt8(c)===0;if(l&&(a=!0),s&&(d&&!l||!d&&l)&&(s=!1),o&&(d&&l||!d&&!l)&&(o=!1),l&&!s&&!o)break}a&&(s?i=Sf:o?i=bf:n=!0)}return t&&!n&&!i&&r?gde(r.slice(0,e)).then(s=>({seemsBinary:!1,encoding:s})):{seemsBinary:n,encoding:i}}const Dv={utf8:{labelLong:"UTF-8",labelShort:"UTF-8",order:1,alias:"utf8bom"},utf8bom:{labelLong:"UTF-8 with BOM",labelShort:"UTF-8 with BOM",encodeOnly:!0,order:2,alias:"utf8"},utf16le:{labelLong:"UTF-16 LE",labelShort:"UTF-16 LE",order:3},utf16be:{labelLong:"UTF-16 BE",labelShort:"UTF-16 BE",order:4},windows1252:{labelLong:"Western (Windows 1252)",labelShort:"Windows 1252",order:5},iso88591:{labelLong:"Western (ISO 8859-1)",labelShort:"ISO 8859-1",order:6},iso88593:{labelLong:"Western (ISO 8859-3)",labelShort:"ISO 8859-3",order:7},iso885915:{labelLong:"Western (ISO 8859-15)",labelShort:"ISO 8859-15",order:8},macroman:{labelLong:"Western (Mac Roman)",labelShort:"Mac Roman",order:9},cp437:{labelLong:"DOS (CP 437)",labelShort:"CP437",order:10},windows1256:{labelLong:"Arabic (Windows 1256)",labelShort:"Windows 1256",order:11},iso88596:{labelLong:"Arabic (ISO 8859-6)",labelShort:"ISO 8859-6",order:12},windows1257:{labelLong:"Baltic (Windows 1257)",labelShort:"Windows 1257",order:13},iso88594:{labelLong:"Baltic (ISO 8859-4)",labelShort:"ISO 8859-4",order:14},iso885914:{labelLong:"Celtic (ISO 8859-14)",labelShort:"ISO 8859-14",order:15},windows1250:{labelLong:"Central European (Windows 1250)",labelShort:"Windows 1250",order:16},iso88592:{labelLong:"Central European (ISO 8859-2)",labelShort:"ISO 8859-2",order:17},cp852:{labelLong:"Central European (CP 852)",labelShort:"CP 852",order:18},windows1251:{labelLong:"Cyrillic (Windows 1251)",labelShort:"Windows 1251",order:19},cp866:{labelLong:"Cyrillic (CP 866)",labelShort:"CP 866",order:20},iso88595:{labelLong:"Cyrillic (ISO 8859-5)",labelShort:"ISO 8859-5",order:21},koi8r:{labelLong:"Cyrillic (KOI8-R)",labelShort:"KOI8-R",order:22},koi8u:{labelLong:"Cyrillic (KOI8-U)",labelShort:"KOI8-U",order:23},iso885913:{labelLong:"Estonian (ISO 8859-13)",labelShort:"ISO 8859-13",order:24},windows1253:{labelLong:"Greek (Windows 1253)",labelShort:"Windows 1253",order:25},iso88597:{labelLong:"Greek (ISO 8859-7)",labelShort:"ISO 8859-7",order:26},windows1255:{labelLong:"Hebrew (Windows 1255)",labelShort:"Windows 1255",order:27},iso88598:{labelLong:"Hebrew (ISO 8859-8)",labelShort:"ISO 8859-8",order:28},iso885910:{labelLong:"Nordic (ISO 8859-10)",labelShort:"ISO 8859-10",order:29},iso885916:{labelLong:"Romanian (ISO 8859-16)",labelShort:"ISO 8859-16",order:30},windows1254:{labelLong:"Turkish (Windows 1254)",labelShort:"Windows 1254",order:31},iso88599:{labelLong:"Turkish (ISO 8859-9)",labelShort:"ISO 8859-9",order:32},windows1258:{labelLong:"Vietnamese (Windows 1258)",labelShort:"Windows 1258",order:33},gbk:{labelLong:"Simplified Chinese (GBK)",labelShort:"GBK",order:34},gb18030:{labelLong:"Simplified Chinese (GB18030)",labelShort:"GB18030",order:35},cp950:{labelLong:"Traditional Chinese (Big5)",labelShort:"Big5",order:36},big5hkscs:{labelLong:"Traditional Chinese (Big5-HKSCS)",labelShort:"Big5-HKSCS",order:37},shiftjis:{labelLong:"Japanese (Shift JIS)",labelShort:"Shift JIS",order:38},eucjp:{labelLong:"Japanese (EUC-JP)",labelShort:"EUC-JP",order:39},euckr:{labelLong:"Korean (EUC-KR)",labelShort:"EUC-KR",order:40},windows874:{labelLong:"Thai (Windows 874)",labelShort:"Windows 874",order:41},iso885911:{labelLong:"Latin/Thai (ISO 8859-11)",labelShort:"ISO 8859-11",order:42},koi8ru:{labelLong:"Cyrillic (KOI8-RU)",labelShort:"KOI8-RU",order:43},koi8t:{labelLong:"Tajik (KOI8-T)",labelShort:"KOI8-T",order:44},gb2312:{labelLong:"Simplified Chinese (GB 2312)",labelShort:"GB 2312",order:45},cp865:{labelLong:"Nordic DOS (CP 865)",labelShort:"CP 865",order:46},cp850:{labelLong:"Western European DOS (CP 850)",labelShort:"CP 850",order:47}};let cu=class qv extends Ec{get name(){return this.configuredLabelFormat==="content"&&!this.hasAssociatedFilePath&&this.cachedModelFirstLineWords?this.cachedModelFirstLineWords:this.labelService.getUriBasenameLabel(this.resource)}constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y){super(a,o,m,y),this.resource=e,this.hasAssociatedFilePath=t,this.initialValue=i,this.preferredLanguageId=n,this.preferredEncoding=s,this.workingCopyBackupService=c,this.textResourceConfigurationService=d,this.workingCopyService=l,this.textFileService=u,this.labelService=h,this.editorService=g,this._onDidChangeContent=this._register(new A),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidChangeName=this._register(new A),this.onDidChangeName=this._onDidChangeName.event,this._onDidChangeDirty=this._register(new A),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeEncoding=this._register(new A),this.onDidChangeEncoding=this._onDidChangeEncoding.event,this._onDidSave=this._register(new A),this.onDidSave=this._onDidSave.event,this._onDidRevert=this._register(new A),this.onDidRevert=this._onDidRevert.event,this.typeId=HT,this.capabilities=2,this.configuredLabelFormat="content",this.cachedModelFirstLineWords=void 0,this.dirty=this.hasAssociatedFilePath||!!this.initialValue,this._register(this.workingCopyService.registerWorkingCopy(this)),n&&this.setLanguageId(n),this.onConfigurationChange(void 0,!1),this.registerListeners()}registerListeners(){this._register(this.textResourceConfigurationService.onDidChangeConfiguration(e=>this.onConfigurationChange(e,!0)))}onConfigurationChange(e,t){if(!e||e.affectsConfiguration(this.resource,"files.encoding")){const i=this.textResourceConfigurationService.getValue(this.resource,"files.encoding");this.configuredEncoding!==i&&typeof i=="string"&&(this.configuredEncoding=i,t&&!this.preferredEncoding&&this._onDidChangeEncoding.fire())}if(!e||e.affectsConfiguration(this.resource,"workbench.editor.untitled.labelFormat")){const i=this.textResourceConfigurationService.getValue(this.resource,"workbench.editor.untitled.labelFormat");this.configuredLabelFormat!==i&&(i==="content"||i==="name")&&(this.configuredLabelFormat=i,t&&this._onDidChangeName.fire())}}setLanguageId(e,t){const i=e===qv.ACTIVE_EDITOR_LANGUAGE_ID?this.editorService.activeTextEditorLanguageId:e;this.preferredLanguageId=i,i&&super.setLanguageId(i,t)}getLanguageId(){return this.textEditorModel?this.textEditorModel.getLanguageId():this.preferredLanguageId}getEncoding(){return this.preferredEncoding||this.configuredEncoding}async setEncoding(e){const t=this.getEncoding();this.preferredEncoding=e,t!==this.preferredEncoding&&this._onDidChangeEncoding.fire()}isDirty(){return this.dirty}isModified(){return this.isDirty()}setDirty(e){this.dirty!==e&&(this.dirty=e,this._onDidChangeDirty.fire())}async save(e){const t=await this.textFileService.save(this.resource,e);return t&&this._onDidSave.fire({reason:e==null?void 0:e.reason,source:e==null?void 0:e.source}),!!t}async revert(){this.setDirty(!1),this._onDidRevert.fire(),this.dispose()}async backup(e){let t;return this.isResolved()?t=await this.textFileService.getEncodedReadable(this.resource,ii(this.createSnapshot()),{encoding:hr}):typeof this.initialValue=="string"&&(t=gq(De.fromString(this.initialValue))),{content:t}}async resolve(){let e=!1,t=!1;if(this.textEditorModel)this.updateTextEditorModel(void 0,this.preferredLanguageId);else{let n;const s=await this.workingCopyBackupService.resolve(this);s?(n=s.value,t=!0):n=jm(De.fromString(this.initialValue||""));const o=await qN(await this.textFileService.getDecodedStream(this.resource,n,{encoding:hr}));this.createTextEditorModel(o,this.resource,this.preferredLanguageId),e=!0}const i=Mi(this.textEditorModel);return this.installModelListeners(i),e&&((t||this.initialValue)&&this.updateNameFromFirstLine(i),this.setDirty(this.hasAssociatedFilePath||!!t||!!this.initialValue),(t||this.initialValue)&&this._onDidChangeContent.fire()),super.resolve()}installModelListeners(e){this._register(e.onDidChangeContent(t=>this.onModelContentChanged(e,t))),this._register(e.onDidChangeLanguage(()=>this.onConfigurationChange(void 0,!0))),super.installModelListeners(e)}onModelContentChanged(e,t){!this.hasAssociatedFilePath&&e.getLineCount()===1&&e.getLineContent(1)===""?this.setDirty(!1):this.setDirty(!0),t.changes.some(i=>(i.range.startLineNumber===1||i.range.endLineNumber===1)&&i.range.startColumn<=qv.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH)&&this.updateNameFromFirstLine(e),this._onDidChangeContent.fire(),this.autoDetectLanguage()}updateNameFromFirstLine(e){if(this.hasAssociatedFilePath)return;let t,i=e.getValueInRange({startLineNumber:1,endLineNumber:1,startColumn:1,endColumn:qv.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH+1}).trim().replace(/\s+/g," ");i=i.substr(0,vQ(i,qv.FIRST_LINE_NAME_MAX_LENGTH)[0]),i&&mq().exec(i)&&(t=i),t!==this.cachedModelFirstLineWords&&(this.cachedModelFirstLineWords=t,this._onDidChangeName.fire())}isReadonly(){return!1}};cu.FIRST_LINE_NAME_MAX_LENGTH=40;cu.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH=cu.FIRST_LINE_NAME_MAX_LENGTH*10;cu.ACTIVE_EDITOR_LANGUAGE_ID="${activeEditorLanguage}";cu=T([v(5,ji),v(6,_i),v(7,n$),v(8,Do),v(9,Od),v(10,Dn),v(11,Qi),v(12,Ke),v(13,ab),v(14,Af)],cu);const tv=re("untitledTextEditorService");let OM=class N3 extends ne{constructor(e,t){super(),this.instantiationService=e,this.configurationService=t,this._onDidChangeDirty=this._register(new A),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeEncoding=this._register(new A),this.onDidChangeEncoding=this._onDidChangeEncoding.event,this._onWillDispose=this._register(new A),this.onWillDispose=this._onWillDispose.event,this._onDidChangeLabel=this._register(new A),this.onDidChangeLabel=this._onDidChangeLabel.event,this.mapResourceToModel=new ki}get(e){return this.mapResourceToModel.get(e)}getValue(e){var t,i;return(i=(t=this.get(e))==null?void 0:t.textEditorModel)==null?void 0:i.getValue()}async resolve(e){const t=this.doCreateOrGet(e);return await t.resolve(),t}create(e){return this.doCreateOrGet(e)}doCreateOrGet(e=Object.create(null)){const t=this.massageOptions(e);return t.untitledResource&&this.mapResourceToModel.has(t.untitledResource)?this.mapResourceToModel.get(t.untitledResource):this.doCreate(t)}massageOptions(e){var i,n;const t=Object.create(null);if(e.associatedResource?(t.untitledResource=k.from({scheme:pe.untitled,authority:e.associatedResource.authority,fragment:e.associatedResource.fragment,path:e.associatedResource.path,query:e.associatedResource.query}),t.associatedResource=e.associatedResource):((i=e.untitledResource)==null?void 0:i.scheme)===pe.untitled&&(t.untitledResource=e.untitledResource),e.languageId)t.languageId=e.languageId;else if(!t.associatedResource){const s=this.configurationService.getValue();(n=s.files)!=null&&n.defaultLanguage&&(t.languageId=s.files.defaultLanguage)}return t.encoding=e.encoding,t.initialValue=e.initialValue,t}doCreate(e){let t=e.untitledResource;if(!t){let n=1;do t=k.from({scheme:pe.untitled,path:`Untitled-${n}`}),n++;while(this.mapResourceToModel.has(t))}const i=this._register(this.instantiationService.createInstance(cu,t,!!e.associatedResource,e.initialValue,e.languageId,e.encoding));return this.registerModel(i),i}registerModel(e){const t=new me;t.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire(e))),t.add(e.onDidChangeName(()=>this._onDidChangeLabel.fire(e))),t.add(e.onDidChangeEncoding(()=>this._onDidChangeEncoding.fire(e))),t.add(e.onWillDispose(()=>this._onWillDispose.fire(e))),F.once(e.onWillDispose)(()=>{this.mapResourceToModel.delete(e.resource),t.dispose()}),this.mapResourceToModel.set(e.resource,e),e.isDirty()&&this._onDidChangeDirty.fire(e)}isUntitledWithAssociatedResource(e){return e.scheme===pe.untitled&&e.path.length>1&&!N3.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX.test(e.path)}};OM.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX=/Untitled-\d+/;OM=T([v(0,Te),v(1,We)],OM);var tB;(function(r){r[r.SAVE=0]="SAVE",r[r.DONT_SAVE=1]="DONT_SAVE",r[r.CANCEL=2]="CANCEL"})(tB||(tB={}));const o$=re("elevatedFileService");class wde{isSupported(e){return!1}async writeFileElevated(e,t,i){throw new Error("Unsupported")}}const Su=re("IFileDecorationsService"),bde="Offline";class Sde extends Error{constructor(){super(bde),this.name=this.message}}function Cde(r,e){r.proxyAuthorization&&(r.headers={...r.headers||{},"Proxy-Authorization":r.proxyAuthorization});const t=new XMLHttpRequest;return new Promise((i,n)=>{t.open(r.type||"GET",r.url||"",!0,r.user,r.password),Ede(t,r),t.responseType="arraybuffer",t.onerror=s=>n(navigator.onLine?new Error(t.statusText&&"XHR failed: "+t.statusText||"XHR failed"):new Sde),t.onload=s=>{i({res:{statusCode:t.status,headers:xde(t)},stream:jm(De.wrap(new Uint8Array(t.response)))})},t.ontimeout=s=>n(new Error(`XHR timeout: ${r.timeout}ms`)),r.timeout&&(t.timeout=r.timeout),t.send(r.data),e.onCancellationRequested(()=>{t.abort(),n(Ll())})})}function Ede(r,e){if(e.headers)e:for(const t in e.headers){switch(t){case"User-Agent":case"Accept-Encoding":case"Content-Length":continue e}r.setRequestHeader(t,e.headers[t])}}function xde(r){const e=Object.create(null);for(const t of r.getAllResponseHeaders().split(/\r\n|\n|\r/g))if(t){const i=t.indexOf(":");e[t.substr(0,i).trim().toLowerCase()]=t.substr(i+1).trim()}return e}let NM=class extends tde{constructor(e,t){super(t),this.configurationService=e}async request(e,t){return e.proxyAuthorization||(e.proxyAuthorization=this.configurationService.getValue("http.proxyAuthorization")),this.logAndRequest("browser",e,()=>Cde(e,t))}async resolveProxy(e){}};NM=T([v(0,We),v(1,Is)],NM);class a${static async create(e,t){const i=new a$(e,t);return await i.resolve(),i}constructor(e,t){this.backupRoot=e,this.fileService=t,this.cache=new ki}async resolve(){try{const e=await this.fileService.resolve(this.backupRoot);e.children&&await Sn.settled(e.children.filter(t=>t.isDirectory).map(async t=>{const i=await this.fileService.resolve(t.resource);if(i.children)for(const n of i.children)n.isDirectory||this.add(n.resource)}))}catch{}}add(e,t=0,i){this.cache.set(e,{versionId:t,meta:Gi(i)})}update(e,t){const i=this.cache.get(e);i&&(i.meta=Gi(t))}count(){return this.cache.size}has(e,t,i){const n=this.cache.get(e);return!(!n||typeof t=="number"&&t!==n.versionId||i&&!xa(i,n.meta))}get(){return Array.from(this.cache.keys())}remove(e){this.cache.delete(e)}move(e,t){const i=this.cache.get(e);i&&(this.cache.delete(e),this.cache.set(t,i))}clear(){this.cache.clear()}}let sm=class Wc extends ne{constructor(e,t,i){super(),this.backupWorkspaceHome=e,this.fileService=t,this.logService=i,this.ioOperationQueues=this._register(new ak),this.model=void 0,this.initialize(e)}initialize(e){this.backupWorkspaceHome=e,this.ready=this.doInitialize()}async doInitialize(){this.model=await a$.create(this.backupWorkspaceHome,this.fileService);for(const e of this.model.get())if(Mt(e).length===32)try{const t=await this.resolveIdentifier(e,this.model);if(!t){this.logService.warn(`Backup: Unable to read target URI of backup ${e} for migration to new hash.`);continue}const i=this.toBackupResource(t);si(i,e)||(await this.fileService.move(e,i,!0),this.model.move(e,i))}catch{this.logService.error(`Backup: Unable to migrate backup ${e} to new hash.`)}return this.model}async hasBackups(){return(await this.ready).count()>0}hasBackupSync(e,t,i){if(!this.model)return!1;const n=this.toBackupResource(e);return this.model.has(n,t,i)}async backup(e,t,i,n,s){const o=await this.ready;if(s!=null&&s.isCancellationRequested)return;const a=this.toBackupResource(e);if(!o.has(a,i,n))return this.ioOperationQueues.queueFor(a).queue(async()=>{if(s!=null&&s.isCancellationRequested||o.has(a,i,n))return;let c=this.createPreamble(e,n);c.length>=Wc.PREAMBLE_MAX_LENGTH&&(c=this.createPreamble(e));const d=De.fromString(c);let l;vy(t)?l=cH(d,t):t?l=yQ(d,t):l=De.concat([d,De.fromString("")]),await this.fileService.writeFile(a,l),o.add(a,i,n)})}createPreamble(e,t){return`${e.resource.toString()}${Wc.PREAMBLE_META_SEPARATOR}${JSON.stringify({...t,typeId:e.typeId})}${Wc.PREAMBLE_END_MARKER}`}async discardBackups(e){const t=await this.ready,i=e==null?void 0:e.except;if(Array.isArray(i)&&i.length>0){const n=new ki;for(const s of i)n.set(this.toBackupResource(s),!0);await Sn.settled(t.get().map(async s=>{n.has(s)||await this.doDiscardBackup(s)}))}else await this.deleteIgnoreFileNotFound(this.backupWorkspaceHome),t.clear()}discardBackup(e,t){const i=this.toBackupResource(e);return this.doDiscardBackup(i,t)}async doDiscardBackup(e,t){const i=await this.ready;if(!(t!=null&&t.isCancellationRequested))return this.ioOperationQueues.queueFor(e).queue(async()=>{t!=null&&t.isCancellationRequested||(await this.deleteIgnoreFileNotFound(e),i.remove(e))})}async deleteIgnoreFileNotFound(e){try{await this.fileService.del(e,{recursive:!0})}catch(t){if(t.fileOperationResult!==1)throw t}}async getBackups(){const e=await this.ready,t=await Promise.all(e.get().map(i=>this.resolveIdentifier(i,e)));return fi(t)}async resolveIdentifier(e,t){const i=await this.readToMatchingString(e,Wc.PREAMBLE_END_MARKER,Wc.PREAMBLE_MAX_LENGTH);if(!i)return;const n=i.indexOf(Wc.PREAMBLE_META_SEPARATOR);let s,o;n>0?(s=i.substring(0,n),o=i.substr(n+1)):(s=i,o=void 0);const{typeId:a,meta:c}=this.parsePreambleMeta(o);return t.update(e,c),{typeId:a??HT,resource:k.parse(s)}}async readToMatchingString(e,t,i){const n=(await this.fileService.readFile(e,{length:i})).value.toString(),s=n.indexOf(t);if(s>=0)return n.substr(0,s)}async resolve(e){const t=this.toBackupResource(e),i=await this.ready;if(!i.has(t))return;const n=await this.fileService.readFileStream(t),s=await vq(n.value,1),o=De.concat(s.buffer),a=o.buffer.indexOf(Wc.PREAMBLE_END_MARKER_CHARCODE);if(a===-1){this.logService.trace(`Backup: Could not find meta end marker in ${t}. The file is probably corrupt (filesize: ${n.size}).`);return}const c=o.slice(0,a).toString();let d;const l=c.indexOf(Wc.PREAMBLE_META_SEPARATOR);l!==-1&&(d=this.parsePreambleMeta(c.substr(l+1)).meta),i.update(t,d);const u=o.slice(a+1);let h;return s.ended?h=jm(u):h=cH(u,s.stream),{value:h,meta:d}}parsePreambleMeta(e){let t,i;if(e)try{i=JSON.parse(e),t=i==null?void 0:i.typeId,typeof(i==null?void 0:i.typeId)=="string"&&(delete i.typeId,Dg(i)&&(i=void 0))}catch{}return{typeId:t,meta:i}}toBackupResource(e){return pt(this.backupWorkspaceHome,e.resource.scheme,$3(e))}joinBackups(){return this.ioOperationQueues.whenDrained()}};sm.PREAMBLE_END_MARKER=`
`;sm.PREAMBLE_END_MARKER_CHARCODE=`
`.charCodeAt(0);sm.PREAMBLE_META_SEPARATOR=" ";sm.PREAMBLE_MAX_LENGTH=1e4;sm=T([v(1,at),v(2,ze)],sm);class Dde{constructor(){this.backups=new ki}async hasBackups(){return this.backups.size>0}hasBackupSync(e,t){const i=this.toBackupResource(e);return this.backups.has(i)}async backup(e,t,i,n,s){const o=this.toBackupResource(e);this.backups.set(o,{typeId:e.typeId,content:t instanceof De?t:t?vy(t)?await yy(t):yq(t):De.fromString(""),meta:n})}async resolve(e){const t=this.toBackupResource(e),i=this.backups.get(t);if(i)return{value:jm(i.content),meta:i.meta}}async getBackups(){return Array.from(this.backups.entries()).map(([e,t])=>({typeId:t.typeId,resource:e}))}async discardBackup(e){this.backups.delete(this.toBackupResource(e))}async discardBackups(e){const t=e==null?void 0:e.except;if(Array.isArray(t)&&t.length>0){const i=new ki;for(const n of t)i.set(this.toBackupResource(n),!0);for(const n of await this.getBackups())i.has(this.toBackupResource(n))||await this.discardBackup(n)}else this.backups.clear()}toBackupResource(e){return k.from({scheme:pe.inMemory,path:$3(e)})}async joinBackups(){}}function $3(r){let e;if(r.typeId.length>0){const t=W3(r.typeId);r.resource.path?e=pt(r.resource,t):e=r.resource.with({path:t})}else e=r.resource;return kde(e)}function kde(r){const e=r.scheme===pe.file||r.scheme===pe.untitled?r.fsPath:r.toString();return W3(e)}function W3(r){return yc(r).toString(16)}let V_=class DS extends Ec{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y,_){super(s,n,g,m),this.resource=e,this.preferredEncoding=t,this.preferredLanguageId=i,this.fileService=o,this.textFileService=a,this.workingCopyBackupService=c,this.logService=d,this.workingCopyService=l,this.filesConfigurationService=u,this.labelService=h,this.pathService=y,this.extensionService=_,this._onDidChangeContent=this._register(new A),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidResolve=this._register(new A),this.onDidResolve=this._onDidResolve.event,this._onDidChangeDirty=this._register(new A),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidSaveError=this._register(new A),this.onDidSaveError=this._onDidSaveError.event,this._onDidSave=this._register(new A),this.onDidSave=this._onDidSave.event,this._onDidRevert=this._register(new A),this.onDidRevert=this._onDidRevert.event,this._onDidChangeEncoding=this._register(new A),this.onDidChangeEncoding=this._onDidChangeEncoding.event,this._onDidChangeOrphaned=this._register(new A),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this._onDidChangeReadonly=this._register(new A),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this.typeId=HT,this.capabilities=0,this.name=Yn(this.labelService.getUriLabel(this.resource)),this.resourceHasExtension=!!Yw.extname(this.resource),this.versionId=0,this.ignoreDirtyOnModelContentChange=!1,this.ignoreSaveFromSaveParticipants=!1,this.lastModelContentChangeFromUndoRedo=void 0,this.saveSequentializer=new _Q,this.dirty=!1,this.inConflictMode=!1,this.inOrphanMode=!1,this.inErrorMode=!1,this.hasEncodingSetExplicitly=!1,this._register(this.workingCopyService.registerWorkingCopy(this)),this.registerListeners()}registerListeners(){this._register(this.fileService.onDidFilesChange(e=>this.onDidFilesChange(e))),this._register(this.filesConfigurationService.onFilesAssociationChange(()=>this.onFilesAssociationChange())),this._register(this.filesConfigurationService.onReadonlyChange(()=>this._onDidChangeReadonly.fire()))}async onDidFilesChange(e){let t=!1,i;if(this.inOrphanMode?e.contains(this.resource,1)&&(i=!1,t=!0):e.contains(this.resource,2)&&(i=!0,t=!0),t&&this.inOrphanMode!==i){let n=!1;i&&(await zs(100),this.isDisposed()?n=!0:n=!await this.fileService.exists(this.resource)),this.inOrphanMode!==n&&!this.isDisposed()&&this.setOrphaned(n)}}setOrphaned(e){this.inOrphanMode!==e&&(this.inOrphanMode=e,this._onDidChangeOrphaned.fire())}onFilesAssociationChange(){if(!this.isResolved())return;const e=this.getFirstLineText(this.textEditorModel),t=this.getOrCreateLanguage(this.resource,this.languageService,this.preferredLanguageId,e);this.textEditorModel.setLanguage(t)}setLanguageId(e,t){super.setLanguageId(e,t),this.preferredLanguageId=e}async backup(e){let t;this.lastResolvedFileStat&&(t={mtime:this.lastResolvedFileStat.mtime,ctime:this.lastResolvedFileStat.ctime,size:this.lastResolvedFileStat.size,etag:this.lastResolvedFileStat.etag,orphaned:this.inOrphanMode});const i=await this.textFileService.getEncodedReadable(this.resource,ii(this.createSnapshot()),{encoding:hr});return{meta:t,content:i}}async revert(e){if(!this.isResolved())return;const t=this.dirty,i=this.doSetDirty(!1);if(!(e==null?void 0:e.soft))try{await this.forceResolveFromFile()}catch(s){if(s.fileOperationResult!==1)throw i(),s}this._onDidRevert.fire(),t&&this._onDidChangeDirty.fire()}async resolve(e){if(this.trace("resolve() - enter"),qt("code/willResolveTextFileEditorModel"),this.isDisposed()){this.trace("resolve() - exit - without resolving because model is disposed");return}if(!(e!=null&&e.contents)&&(this.dirty||this.saveSequentializer.hasPending())){this.trace("resolve() - exit - without resolving because model is dirty or being saved");return}await this.doResolve(e),qt("code/didResolveTextFileEditorModel")}async doResolve(e){if(e!=null&&e.contents)return this.resolveFromBuffer(e.contents,e);if(!(!this.isResolved()&&await this.resolveFromBackup(e)))return this.resolveFromFile(e)}async resolveFromBuffer(e,t){this.trace("resolveFromBuffer()");let i,n,s,o;try{const c=await this.fileService.stat(this.resource);i=c.mtime,n=c.ctime,s=c.size,o=c.etag,this.setOrphaned(!1)}catch(c){i=Date.now(),n=Date.now(),s=0,o=oh,this.setOrphaned(c.fileOperationResult===1)}const a=await this.textFileService.encoding.getPreferredWriteEncoding(this.resource,this.preferredEncoding);this.resolveFromContent({resource:this.resource,name:this.name,mtime:i,ctime:n,size:s,etag:o,value:e,encoding:a.encoding,readonly:!1,locked:!1},!0,t)}async resolveFromBackup(e){const t=await this.workingCopyBackupService.resolve(this);let i=hr;return t&&(i=(await this.textFileService.encoding.getPreferredWriteEncoding(this.resource,this.preferredEncoding)).encoding),!this.isResolved()?t?(await this.doResolveFromBackup(t,i,e),!0):!1:(this.trace("resolveFromBackup() - exit - without resolving because previously new model got created meanwhile"),!0)}async doResolveFromBackup(e,t,i){var n;this.trace("doResolveFromBackup()"),this.resolveFromContent({resource:this.resource,name:this.name,mtime:e.meta?e.meta.mtime:Date.now(),ctime:e.meta?e.meta.ctime:Date.now(),size:e.meta?e.meta.size:0,etag:e.meta?e.meta.etag:oh,value:await qN(await this.textFileService.getDecodedStream(this.resource,e.value,{encoding:hr})),encoding:t,readonly:!1,locked:!1},!0,i),(n=e.meta)!=null&&n.orphaned&&this.setOrphaned(!0)}async resolveFromFile(e){this.trace("resolveFromFile()");const t=e==null?void 0:e.forceReadFromFile,i=this.isResolved()||(e==null?void 0:e.allowBinary);let n;t?n=oh:this.lastResolvedFileStat&&(n=this.lastResolvedFileStat.etag);const s=this.versionId;try{const o=await this.textFileService.readStream(this.resource,{acceptTextOnly:!i,etag:n,encoding:this.preferredEncoding,limits:e==null?void 0:e.limits});if(this.setOrphaned(!1),s!==this.versionId){this.trace("resolveFromFile() - exit - without resolving because model content changed");return}return this.resolveFromContent(o,!1,e)}catch(o){const a=o.fileOperationResult;if(this.setOrphaned(a===1),this.isResolved()&&a===2){o instanceof fS&&this.updateLastResolvedFileStat(o.stat);return}if(this.isResolved()&&a===1&&!t)return;throw o}}resolveFromContent(e,t,i){if(this.trace("resolveFromContent() - enter"),this.isDisposed()){this.trace("resolveFromContent() - exit - because model is disposed");return}this.updateLastResolvedFileStat({resource:this.resource,name:e.name,mtime:e.mtime,ctime:e.ctime,size:e.size,etag:e.etag,readonly:e.readonly,locked:e.locked,isFile:!0,isDirectory:!1,isSymbolicLink:!1,children:void 0});const n=this.contentEncoding;this.contentEncoding=e.encoding,this.preferredEncoding?this.updatePreferredEncoding(this.contentEncoding):n!==this.contentEncoding&&this._onDidChangeEncoding.fire(),this.textEditorModel?this.doUpdateTextModel(e.value):this.doCreateTextModel(e.resource,e.value),this.setDirty(!!t),this._onDidResolve.fire((i==null?void 0:i.reason)??3)}doCreateTextModel(e,t){this.trace("doCreateTextModel()");const i=this.createTextEditorModel(t,e,this.preferredLanguageId);this.installModelListeners(i),this.autoDetectLanguage()}doUpdateTextModel(e){this.trace("doUpdateTextModel()"),this.ignoreDirtyOnModelContentChange=!0;try{this.updateTextEditorModel(e,this.preferredLanguageId)}finally{this.ignoreDirtyOnModelContentChange=!1}}installModelListeners(e){this._register(e.onDidChangeContent(t=>this.onModelContentChanged(e,t.isUndoing||t.isRedoing))),this._register(e.onDidChangeLanguage(()=>this.onMaybeShouldChangeEncoding())),super.installModelListeners(e)}onModelContentChanged(e,t){if(this.trace("onModelContentChanged() - enter"),this.versionId++,this.trace(`onModelContentChanged() - new versionId ${this.versionId}`),t&&(this.lastModelContentChangeFromUndoRedo=Date.now()),!this.ignoreDirtyOnModelContentChange&&!this.isReadonly())if(e.getAlternativeVersionId()===this.bufferSavedVersionId){this.trace("onModelContentChanged() - model content changed back to last saved version");const i=this.dirty;this.setDirty(!1),i&&this._onDidRevert.fire()}else this.trace("onModelContentChanged() - model content changed and marked as dirty"),this.setDirty(!0);this._onDidChangeContent.fire(),this.autoDetectLanguage()}async autoDetectLanguage(){var t;await((t=this.extensionService)==null?void 0:t.whenInstalledExtensionsRegistered());const e=this.getLanguageId();if(this.resource.scheme===this.pathService.defaultUriScheme&&(!e||e===fo)&&!this.resourceHasExtension)return super.autoDetectLanguage()}async forceResolveFromFile(){this.isDisposed()||await this.textFileService.files.resolve(this.resource,{reload:{async:!1},forceReadFromFile:!0})}isDirty(){return this.dirty}isModified(){return this.isDirty()}setDirty(e){if(!this.isResolved())return;const t=this.dirty;this.doSetDirty(e),e!==t&&this._onDidChangeDirty.fire()}doSetDirty(e){const t=this.dirty,i=this.inConflictMode,n=this.inErrorMode,s=this.bufferSavedVersionId;return e?this.dirty=!0:(this.dirty=!1,this.inConflictMode=!1,this.inErrorMode=!1,this.updateSavedVersionId()),()=>{this.dirty=t,this.inConflictMode=i,this.inErrorMode=n,this.bufferSavedVersionId=s}}async save(e=Object.create(null)){return this.isResolved()?this.isReadonly()?(this.trace("save() - ignoring request for readonly resource"),!1):(this.hasState(3)||this.hasState(5))&&(e.reason===2||e.reason===3||e.reason===4)?(this.trace("save() - ignoring auto save request for model that is in conflict or error"),!1):(this.trace("save() - enter"),await this.doSave(e),this.trace("save() - exit"),this.hasState(0)):!1}async doSave(e){typeof e.reason!="number"&&(e.reason=1);let t=this.versionId;if(this.trace(`doSave(${t}) - enter with versionId ${t}`),this.ignoreSaveFromSaveParticipants){this.trace(`doSave(${t}) - exit - refusing to save() recursively from save participant`);return}if(this.saveSequentializer.hasPending(t))return this.trace(`doSave(${t}) - exit - found a pending save for versionId ${t}`),this.saveSequentializer.pending;if(!e.force&&!this.dirty){this.trace(`doSave(${t}) - exit - because not dirty and/or versionId is different (this.isDirty: ${this.dirty}, this.versionId: ${this.versionId})`);return}if(this.saveSequentializer.hasPending())return this.trace(`doSave(${t}) - exit - because busy saving`),this.saveSequentializer.cancelPending(),this.saveSequentializer.setNext(()=>this.doSave(e));this.isResolved()&&this.textEditorModel.pushStackElement();const i=new Xt;return this.saveSequentializer.setPending(t,(async()=>{if(this.isResolved()&&!e.skipSaveParticipants)try{if(e.reason===2&&typeof this.lastModelContentChangeFromUndoRedo=="number"){const o=Date.now()-this.lastModelContentChangeFromUndoRedo;o<DS.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD&&await zs(DS.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD-o)}if(!i.token.isCancellationRequested){this.ignoreSaveFromSaveParticipants=!0;try{await this.textFileService.files.runSaveParticipants(this,{reason:e.reason??1},i.token)}finally{this.ignoreSaveFromSaveParticipants=!1}}}catch(o){this.logService.error(`[text file model] runSaveParticipants(${t}) - resulted in an error: ${o.toString()}`,this.resource.toString())}if(i.token.isCancellationRequested||(i.dispose(),this.isDisposed())||!this.isResolved())return;t=this.versionId,this.inErrorMode=!1,this.trace(`doSave(${t}) - before write()`);const n=Mi(this.lastResolvedFileStat),s=this;return this.saveSequentializer.setPending(t,(async()=>{try{const o=await this.textFileService.write(n.resource,s.createSnapshot(),{mtime:n.mtime,encoding:this.getEncoding(),etag:e.ignoreModifiedSince||!this.filesConfigurationService.preventSaveConflicts(n.resource,s.getLanguageId())?oh:n.etag,unlock:e.writeUnlock,writeElevated:e.writeElevated});this.handleSaveSuccess(o,t,e)}catch(o){this.handleSaveError(o,t,e)}})())})(),()=>i.cancel())}handleSaveSuccess(e,t,i){this.updateLastResolvedFileStat(e),t===this.versionId?(this.trace(`handleSaveSuccess(${t}) - setting dirty to false because versionId did not change`),this.setDirty(!1)):this.trace(`handleSaveSuccess(${t}) - not setting dirty to false because versionId did change meanwhile`),this.setOrphaned(!1),this._onDidSave.fire({reason:i.reason,stat:e,source:i.source})}handleSaveError(e,t,i){if((i.ignoreErrorHandler?this.logService.trace:this.logService.error).apply(this.logService,[`[text file model] handleSaveError(${t}) - exit - resulted in a save error: ${e.toString()}`,this.resource.toString()]),i.ignoreErrorHandler)throw e;this.setDirty(!0),this.inErrorMode=!0,e.fileOperationResult===3&&(this.inConflictMode=!0),this.textFileService.files.saveErrorHandler.onSaveError(e,this),this._onDidSaveError.fire()}updateSavedVersionId(){this.isResolved()&&(this.bufferSavedVersionId=this.textEditorModel.getAlternativeVersionId())}updateLastResolvedFileStat(e){const t=this.isReadonly();this.lastResolvedFileStat?this.lastResolvedFileStat.mtime<=e.mtime&&(this.lastResolvedFileStat=e):this.lastResolvedFileStat=e,this.isReadonly()!==t&&this._onDidChangeReadonly.fire()}hasState(e){switch(e){case 3:return this.inConflictMode;case 1:return this.dirty;case 5:return this.inErrorMode;case 4:return this.inOrphanMode;case 2:return this.saveSequentializer.hasPending();case 0:return!this.dirty}}async joinState(e){return this.saveSequentializer.pending}getLanguageId(){return this.textEditorModel?this.textEditorModel.getLanguageId():this.preferredLanguageId}async onMaybeShouldChangeEncoding(){if(this.hasEncodingSetExplicitly){this.trace("onMaybeShouldChangeEncoding() - ignoring because encoding was set explicitly");return}if(this.contentEncoding===Qc||this.contentEncoding===bf||this.contentEncoding===Sf){this.trace("onMaybeShouldChangeEncoding() - ignoring because content encoding has a BOM");return}const{encoding:e}=await this.textFileService.encoding.getPreferredReadEncoding(this.resource);if(typeof e!="string"||!this.isNewEncoding(e)){this.trace(`onMaybeShouldChangeEncoding() - ignoring because preferred encoding ${e} is not new`);return}if(this.isDirty()){this.trace("onMaybeShouldChangeEncoding() - ignoring because model is dirty");return}return this.logService.info(`Adjusting encoding based on configured language override to '${e}' for ${this.resource.toString(!0)}.`),this.setEncodingInternal(e,1)}setEncoding(e,t){return this.hasEncodingSetExplicitly=!0,this.setEncodingInternal(e,t)}async setEncodingInternal(e,t){if(t===0)this.updatePreferredEncoding(e),this.isDirty()||(this.versionId++,this.setDirty(!0)),this.inConflictMode||await this.save({source:DS.TEXTFILE_SAVE_ENCODING_SOURCE});else{if(!this.isNewEncoding(e))return;this.isDirty()&&!this.inConflictMode&&await this.save(),this.updatePreferredEncoding(e),await this.forceResolveFromFile()}}updatePreferredEncoding(e){this.isNewEncoding(e)&&(this.preferredEncoding=e,this._onDidChangeEncoding.fire())}isNewEncoding(e){return!(this.preferredEncoding===e||!this.preferredEncoding&&this.contentEncoding===e)}getEncoding(){return this.preferredEncoding||this.contentEncoding}trace(e){this.logService.trace(`[text file model] ${e}`,this.resource.toString())}isResolved(){return!!this.textEditorModel}isReadonly(){return this.filesConfigurationService.isReadonly(this.resource,this.lastResolvedFileStat)}dispose(){this.trace("dispose()"),this.inConflictMode=!1,this.inOrphanMode=!1,this.inErrorMode=!1,super.dispose()}};V_.TEXTFILE_SAVE_ENCODING_SOURCE=MT.registerSource("textFileEncoding.source",p("textFileCreate.source","File Encoding Changed"));V_.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD=500;V_=T([v(3,ji),v(4,_i),v(5,at),v(6,Dn),v(7,n$),v(8,ze),v(9,Od),v(10,qr),v(11,Qi),v(12,ab),v(13,Af),v(14,ta),v(15,yr)],V_);let $M=class extends ne{constructor(e,t){super(),this.progressService=e,this.logService=t,this.saveParticipants=[]}addSaveParticipant(e){const t=jN(this.saveParticipants,e);return ot(()=>t())}participate(e,t,i){const n=new Xt(i);return this.progressService.withProgress({title:p("saveParticipants","Saving '{0}'",e.name),location:15,cancellable:!0,delay:e.isDirty()?3e3:5e3},async s=>{var o,a;(o=e.textEditorModel)==null||o.pushStackElement();for(const c of this.saveParticipants){if(n.token.isCancellationRequested||!e.textEditorModel)break;try{const d=c.participate(e,t,s,n.token);await BN(d,n.token)}catch(d){this.logService.error(d)}}(a=e.textEditorModel)==null||a.pushStackElement()},()=>{n.dispose(!0)})}dispose(){this.saveParticipants.splice(0,this.saveParticipants.length)}};$M=T([v(0,kc),v(1,ze)],$M);let WM=class extends ne{get models(){return[...this.mapResourceToModel.values()]}constructor(e,t,i,n,s){super(),this.instantiationService=e,this.fileService=t,this.notificationService=i,this.workingCopyFileService=n,this.uriIdentityService=s,this._onDidCreate=this._register(new A),this.onDidCreate=this._onDidCreate.event,this._onDidResolve=this._register(new A),this.onDidResolve=this._onDidResolve.event,this._onDidRemove=this._register(new A),this.onDidRemove=this._onDidRemove.event,this._onDidChangeDirty=this._register(new A),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeReadonly=this._register(new A),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this._onDidChangeOrphaned=this._register(new A),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this._onDidSaveError=this._register(new A),this.onDidSaveError=this._onDidSaveError.event,this._onDidSave=this._register(new A),this.onDidSave=this._onDidSave.event,this._onDidRevert=this._register(new A),this.onDidRevert=this._onDidRevert.event,this._onDidChangeEncoding=this._register(new A),this.onDidChangeEncoding=this._onDidChangeEncoding.event,this.mapResourceToModel=new ki,this.mapResourceToModelListeners=new ki,this.mapResourceToDisposeListener=new ki,this.mapResourceToPendingModelResolvers=new ki,this.modelResolveQueue=this._register(new ak),this.saveErrorHandler=(()=>{const o=this.notificationService;return{onSaveError(a,c){o.error(p({key:"genericSaveError",comment:["{0} is the resource that failed to save and {1} the error message"]},"Failed to save '{0}': {1}",c.name,La(a,!1)))}}})(),this.mapCorrelationIdToModelsToRestore=new Map,this.saveParticipants=this._register(this.instantiationService.createInstance($M)),this.registerListeners()}registerListeners(){this._register(this.fileService.onDidFilesChange(e=>this.onDidFilesChange(e))),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e=>this.onDidChangeFileSystemProviderCapabilities(e))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e=>this.onDidChangeFileSystemProviderRegistrations(e))),this._register(this.workingCopyFileService.onWillRunWorkingCopyFileOperation(e=>this.onWillRunWorkingCopyFileOperation(e))),this._register(this.workingCopyFileService.onDidFailWorkingCopyFileOperation(e=>this.onDidFailWorkingCopyFileOperation(e))),this._register(this.workingCopyFileService.onDidRunWorkingCopyFileOperation(e=>this.onDidRunWorkingCopyFileOperation(e)))}onDidFilesChange(e){for(const t of this.models)t.isDirty()||e.contains(t.resource,0,1)&&this.queueModelReload(t)}onDidChangeFileSystemProviderCapabilities(e){this.queueModelReloads(e.scheme)}onDidChangeFileSystemProviderRegistrations(e){e.added&&this.queueModelReloads(e.scheme)}queueModelReloads(e){for(const t of this.models)t.isDirty()||e===t.resource.scheme&&this.queueModelReload(t)}queueModelReload(e){const t=this.modelResolveQueue.queueFor(e.resource);t.size<=1&&t.queue(async()=>{try{await this.reload(e)}catch(i){en(i)}})}onWillRunWorkingCopyFileOperation(e){if(e.operation===2||e.operation===3){const t=[];for(const{source:i,target:n}of e.files)if(i){if(this.uriIdentityService.extUri.isEqual(i,n))continue;const s=[];for(const o of this.models)this.uriIdentityService.extUri.isEqualOrParent(o.resource,i)&&s.push(o);for(const o of s){const a=o.resource;let c;this.uriIdentityService.extUri.isEqual(a,i)?c=n:c=pt(n,a.path.substr(i.path.length+1)),t.push({source:a,target:c,languageId:o.getLanguageId(),encoding:o.getEncoding(),snapshot:o.isDirty()?o.createSnapshot():void 0})}}this.mapCorrelationIdToModelsToRestore.set(e.correlationId,t)}}onDidFailWorkingCopyFileOperation(e){if(e.operation===2||e.operation===3){const t=this.mapCorrelationIdToModelsToRestore.get(e.correlationId);t&&(this.mapCorrelationIdToModelsToRestore.delete(e.correlationId),t.forEach(i=>{var n;i.snapshot&&((n=this.get(i.source))==null||n.setDirty(!0))}))}}onDidRunWorkingCopyFileOperation(e){switch(e.operation){case 0:e.waitUntil((async()=>{for(const{target:t}of e.files){const i=this.get(t);i&&!i.isDisposed()&&await i.revert()}})());break;case 2:case 3:e.waitUntil((async()=>{const t=this.mapCorrelationIdToModelsToRestore.get(e.correlationId);t&&(this.mapCorrelationIdToModelsToRestore.delete(e.correlationId),await Sn.settled(t.map(async i=>{const n=await this.resolve(i.target,{reload:{async:!1},contents:i.snapshot?_q(i.snapshot):void 0,encoding:i.encoding});i.languageId&&i.languageId!==fo&&n.getLanguageId()===fo&&Xw(i.target)!==wQ&&n.updateTextEditorModel(void 0,i.languageId)})))})());break}}get(e){return this.mapResourceToModel.get(e)}has(e){return this.mapResourceToModel.has(e)}async reload(e){await this.joinPendingResolves(e.resource),!(e.isDirty()||e.isDisposed()||!this.has(e.resource))&&await this.doResolve(e,{reload:{async:!1}})}async resolve(e,t){const i=this.joinPendingResolves(e);return i&&await i,this.doResolve(e,t)}async doResolve(e,t){let i,n;k.isUri(e)?(n=e,i=this.get(n)):(n=e.resource,i=e);let s,o=!1;if(i)t!=null&&t.contents?s=i.resolve(t):t!=null&&t.reload?t.reload.async?(s=Promise.resolve(),(async()=>{try{await i.resolve(t)}catch(a){en(a)}})()):s=i.resolve(t):s=Promise.resolve();else{o=!0;const a=i=this.instantiationService.createInstance(V_,n,t?t.encoding:void 0,t?t.languageId:void 0);s=i.resolve(t),this.registerModel(a)}this.mapResourceToPendingModelResolvers.set(n,s),this.add(n,i),o&&(this._onDidCreate.fire(i),i.isDirty()&&this._onDidChangeDirty.fire(i));try{await s}catch(a){throw o&&i.dispose(),a}finally{this.mapResourceToPendingModelResolvers.delete(n)}return t!=null&&t.languageId&&i.setLanguageId(t.languageId),o&&i.isDirty()&&this._onDidChangeDirty.fire(i),i}joinPendingResolves(e){if(this.mapResourceToPendingModelResolvers.get(e))return this.doJoinPendingResolves(e)}async doJoinPendingResolves(e){let t;for(;this.mapResourceToPendingModelResolvers.has(e);){const i=this.mapResourceToPendingModelResolvers.get(e);if(i===t)return;t=i;try{await i}catch{}}}registerModel(e){const t=new me;t.add(e.onDidResolve(i=>this._onDidResolve.fire({model:e,reason:i}))),t.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire(e))),t.add(e.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire(e))),t.add(e.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire(e))),t.add(e.onDidSaveError(()=>this._onDidSaveError.fire(e))),t.add(e.onDidSave(i=>this._onDidSave.fire({model:e,...i}))),t.add(e.onDidRevert(()=>this._onDidRevert.fire(e))),t.add(e.onDidChangeEncoding(()=>this._onDidChangeEncoding.fire(e))),this.mapResourceToModelListeners.set(e.resource,t)}add(e,t){if(this.mapResourceToModel.get(e)===t)return;const n=this.mapResourceToDisposeListener.get(e);n==null||n.dispose(),this.mapResourceToModel.set(e,t),this.mapResourceToDisposeListener.set(e,t.onWillDispose(()=>this.remove(e)))}remove(e){const t=this.mapResourceToModel.delete(e),i=this.mapResourceToDisposeListener.get(e);i&&(vt(i),this.mapResourceToDisposeListener.delete(e));const n=this.mapResourceToModelListeners.get(e);n&&(vt(n),this.mapResourceToModelListeners.delete(e)),t&&this._onDidRemove.fire(e)}addSaveParticipant(e){return this.saveParticipants.addSaveParticipant(e)}runSaveParticipants(e,t,i){return this.saveParticipants.participate(e,t,i)}canDispose(e){return e.isDisposed()||!this.mapResourceToPendingModelResolvers.has(e.resource)&&!e.isDirty()?!0:this.doCanDispose(e)}async doCanDispose(e){const t=this.joinPendingResolves(e.resource);return t?(await t,this.canDispose(e)):e.isDirty()?(await F.toPromise(e.onDidChangeDirty),this.canDispose(e)):!0}dispose(){super.dispose(),this.mapResourceToModel.clear(),this.mapResourceToPendingModelResolvers.clear(),vt(this.mapResourceToDisposeListener.values()),this.mapResourceToDisposeListener.clear(),vt(this.mapResourceToModelListeners.values()),this.mapResourceToModelListeners.clear()}};WM=T([v(0,Te),v(1,at),v(2,on),v(3,$a),v(4,Hi)],WM);const ar=re("dialogService");var il;(function(r){r[r.Confirmation=1]="Confirmation",r[r.Prompt=2]="Prompt",r[r.Input=3]="Input"})(il||(il={}));class WIe{getConfirmationButtons(e){return this.getButtons(e,il.Confirmation)}getPromptButtons(e){return this.getButtons(e,il.Prompt)}getInputButtons(e){return this.getButtons(e,il.Input)}getButtons(e,t){const i=[];switch(t){case il.Confirmation:{const n=e;n.primaryButton?i.push(n.primaryButton):i.push(p({key:"yesButton",comment:["&& denotes a mnemonic"]},"&&Yes")),n.cancelButton?i.push(n.cancelButton):i.push(p("cancelButton","Cancel"));break}case il.Prompt:{const n=e;Array.isArray(n.buttons)&&n.buttons.length>0&&i.push(...n.buttons.map(s=>s.label)),n.cancelButton&&(n.cancelButton===!0?i.push(p("cancelButton","Cancel")):typeof n.cancelButton=="string"?i.push(n.cancelButton):n.cancelButton.label?i.push(n.cancelButton.label):i.push(p("cancelButton","Cancel"))),i.length===0&&i.push(p({key:"okButton",comment:["&& denotes a mnemonic"]},"&&OK"));break}case il.Input:{const n=e;n.primaryButton?i.push(n.primaryButton):i.push(p({key:"okButton",comment:["&& denotes a mnemonic"]},"&&OK")),n.cancelButton?i.push(n.cancelButton):i.push(p("cancelButton","Cancel"));break}}return i}getDialogType(e){if(typeof e=="string")return e;if(typeof e=="number")return e===yi.Info?"info":e===yi.Error?"error":e===yi.Warning?"warning":"none"}async getPromptResult(e,t,i){var o;const n=[...e.buttons??[]];return e.cancelButton&&typeof e.cancelButton!="string"&&typeof e.cancelButton!="boolean"&&n.push(e.cancelButton),{result:await((o=n[t])==null?void 0:o.run({checkboxChecked:i})),checkboxChecked:i}}}const ia=re("fileDialogService"),qb=10;function ql(r){const e=[];return e.push(...r.slice(0,qb).map(t=>typeof t=="string"?t:Mt(t))),r.length>qb&&(r.length-qb===1?e.push(p("moreFile","...1 additional file not shown")):e.push(p("moreFiles","...{0} additional files not shown",r.length-qb))),e.push(""),e.join(`
`)}let q_=class HM extends ne{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y,_,b,E){super(),this.fileService=e,this.untitledTextEditorService=t,this.lifecycleService=i,this.instantiationService=n,this.modelService=s,this.environmentService=o,this.dialogService=a,this.fileDialogService=c,this.textResourceConfigurationService=d,this.filesConfigurationService=l,this.codeEditorService=u,this.pathService=h,this.workingCopyFileService=g,this.uriIdentityService=m,this.languageService=y,this.logService=_,this.elevatedFileService=b,this.decorationsService=E,this.files=this._register(this.instantiationService.createInstance(WM)),this.untitled=this.untitledTextEditorService,this.provideDecorations()}provideDecorations(){this.decorationsService.registerDecorationsProvider(new class extends ne{constructor(e){super(),this.files=e,this.label=p("textFileModelDecorations","Text File Model Decorations"),this._onDidChange=this._register(new A),this.onDidChange=this._onDidChange.event,this.registerListeners()}registerListeners(){this._register(this.files.onDidResolve(({model:e})=>{(e.isReadonly()||e.hasState(4))&&this._onDidChange.fire([e.resource])})),this._register(this.files.onDidRemove(e=>this._onDidChange.fire([e]))),this._register(this.files.onDidChangeReadonly(e=>this._onDidChange.fire([e.resource]))),this._register(this.files.onDidChangeOrphaned(e=>this._onDidChange.fire([e.resource])))}provideDecorations(e){const t=this.files.get(e);if(!t||t.isDisposed())return;const i=t.isReadonly(),n=t.hasState(4);if(i&&n)return{color:dH,letter:jt.lockSmall,strikethrough:!0,tooltip:p("readonlyAndDeleted","Deleted, Read-only")};if(i)return{letter:jt.lockSmall,tooltip:p("readonly","Read-only")};if(n)return{color:dH,strikethrough:!0,tooltip:p("deleted","Deleted")}}}(this.files))}get encoding(){return this._encoding||(this._encoding=this._register(this.instantiationService.createInstance(jM))),this._encoding}async read(e,t){const[i,n]=await this.doRead(e,{...t,preferUnbuffered:!0});return{...i,encoding:n.detected.encoding||hr,value:await wq(n.stream,s=>s.join(""))}}async readStream(e,t){const[i,n]=await this.doRead(e,t);return{...i,encoding:n.detected.encoding||hr,value:await qN(n.stream)}}async doRead(e,t){const i=new Xt;let n;if(t!=null&&t.preferUnbuffered){const s=await this.fileService.readFile(e,t,i.token);n={...s,value:jm(s.value)}}else n=await this.fileService.readFileStream(e,t,i.token);try{const s=await this.doGetDecodedStream(e,n.value,t);return[n,s]}catch(s){throw i.dispose(!0),s.decodeStreamErrorKind===1?new Cce(p("fileBinaryError","File seems to be binary and cannot be opened as text"),0,t):s}}async create(e,t){const i=await Promise.all(e.map(async n=>{var o;const s=await this.getEncodedReadable(n.resource,n.value);return{resource:n.resource,contents:s,overwrite:(o=n.options)==null?void 0:o.overwrite}}));return this.workingCopyFileService.create(i,_t.None,t)}async write(e,t,i){const n=await this.getEncodedReadable(e,t,i);return i!=null&&i.writeElevated&&this.elevatedFileService.isSupported(e)?this.elevatedFileService.writeFileElevated(e,n,i):this.fileService.writeFile(e,n,i)}async getEncodedReadable(e,t,i){const{encoding:n,addBOM:s}=await this.encoding.getWriteEncoding(e,i);if(n===hr&&!s)return typeof t>"u"?void 0:xce(t);t=t||"";const o=typeof t=="string"?Ece(t):t;return ude(o,n,{addBOM:s})}async getDecodedStream(e,t,i){return(await this.doGetDecodedStream(e,t,i)).stream}doGetDecodedStream(e,t,i){return lde(t,{acceptTextOnly:(i==null?void 0:i.acceptTextOnly)??!1,guessEncoding:(i==null?void 0:i.autoGuessEncoding)||this.textResourceConfigurationService.getValue(e,"files.autoGuessEncoding"),overwriteEncoding:async n=>{const{encoding:s}=await this.encoding.getPreferredReadEncoding(e,i,ii(n));return s}})}async save(e,t){if(e.scheme===pe.untitled){const i=this.untitled.get(e);if(i){let n;if(i.hasAssociatedFilePath?n=await this.suggestSavePath(e):n=await this.fileDialogService.pickFileToSave(await this.suggestSavePath(e),t==null?void 0:t.availableFileSystems),n)return this.saveAs(e,n,t)}}else{const i=this.files.get(e);if(i)return await i.save(t)?e:void 0}}async saveAs(e,t,i){if(t||(t=await this.fileDialogService.pickFileToSave(await this.suggestSavePath((i==null?void 0:i.suggestedTarget)??e),i==null?void 0:i.availableFileSystems)),!!t)return si(e,t)?this.save(e,{...i,force:!0}):this.fileService.hasProvider(e)&&this.uriIdentityService.extUri.isEqual(e,t)&&await this.fileService.exists(e)?(await this.workingCopyFileService.move([{file:{source:e,target:t}}],_t.None),await this.save(e,i)||await this.save(t,i),t):this.doSaveAs(e,t,i)}async doSaveAs(e,t,i){let n=!1;const s=this.files.get(e);if(s!=null&&s.isResolved())n=await this.doSaveAsTextFile(s,e,t,i);else if(this.fileService.hasProvider(e))await this.fileService.copy(e,t,!0),n=!0;else{const o=this.modelService.getModel(e);o&&(n=await this.doSaveAsTextFile(o,e,t,i))}if(n){try{await this.revert(e)}catch(o){this.logService.error(o)}return t}}async doSaveAsTextFile(e,t,i,n){let s;const o=e;typeof o.getEncoding=="function"&&(s=o.getEncoding());let a=!1,c=this.files.get(i);if(c!=null&&c.isResolved())a=!0;else{a=await this.fileService.exists(i),a||await this.create([{resource:i,value:""}]);try{c=await this.files.resolve(i,{encoding:s})}catch(h){if(a&&(h.textFileOperationResult===0||h.fileOperationResult===7))return await this.fileService.del(i),this.doSaveAsTextFile(e,t,i,n);throw h}}let d;if(e instanceof cu&&e.hasAssociatedFilePath&&a&&this.uriIdentityService.extUri.isEqual(i,zy(e.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme))?d=await this.confirmOverwrite(i):d=!0,!d)return!1;let l;e instanceof Ec?e.isResolved()&&(l=ii(e.textEditorModel)):l=e;let u;if(c.isResolved()&&(u=c.textEditorModel),l&&u){c.updatePreferredEncoding(s),this.modelService.updateModel(u,_q(l.createSnapshot()));const h=l.getLanguageId(),g=u.getLanguageId();h!==fo&&g===fo&&u.setLanguage(h);const m=this.codeEditorService.getTransientModelProperties(l);if(m)for(const[y,_]of m)this.codeEditorService.setTransientModelProperty(u,y,_)}return n!=null&&n.source||(n={...n,source:a?HM.TEXTFILE_SAVE_REPLACE_SOURCE:HM.TEXTFILE_SAVE_CREATE_SOURCE}),c.save(n)}async confirmOverwrite(e){const{confirmed:t}=await this.dialogService.confirm({type:"warning",message:p("confirmOverwrite","'{0}' already exists. Do you want to replace it?",Mt(e)),detail:p("irreversible","A file or folder with the name '{0}' already exists in the folder '{1}'. Replacing it will overwrite its current contents.",Mt(e),Mt(pn(e))),primaryButton:p({key:"replaceButtonLabel",comment:["&& denotes a mnemonic"]},"&&Replace")});return t}async suggestSavePath(e){if(this.fileService.hasProvider(e))return e;const t=this.environmentService.remoteAuthority,i=await this.fileDialogService.defaultFilePath();let n;if(e.scheme===pe.untitled){const s=this.untitled.get(e);if(s){if(s.hasAssociatedFilePath)return zy(e,t,this.pathService.defaultUriScheme);let o;await this.pathService.hasValidBasename(pt(i,s.name),s.name)?o=s.name:o=Mt(e);const a=s.getLanguageId();a&&a!==fo?n=this.suggestFilename(a,o):n=o}}return n||(n=Mt(e)),pt(i,n)}suggestFilename(e,t){if(!this.languageService.getLanguageName(e))return t;const n=kg(t),s=this.languageService.getExtensions(e);if(s.includes(n))return t;const o=Zh(s);if(o)return n?`${t.substring(0,t.indexOf(n))}${o}`:`${t}${o}`;const a=this.languageService.getFilenames(e);return a.includes(t)?t:Zh(a)??t}async revert(e,t){if(e.scheme===pe.untitled){const i=this.untitled.get(e);if(i)return i.revert(t)}else{const i=this.files.get(e);if(i&&(i.isDirty()||t!=null&&t.force))return i.revert(t)}}isDirty(e){const t=e.scheme===pe.untitled?this.untitled.get(e):this.files.get(e);return t?t.isDirty():!1}};q_.TEXTFILE_SAVE_CREATE_SOURCE=MT.registerSource("textFileCreate.source",p("textFileCreate.source","File Created"));q_.TEXTFILE_SAVE_REPLACE_SOURCE=MT.registerSource("textFileOverwrite.source",p("textFileOverwrite.source","File Replaced"));q_=T([v(0,at),v(1,tv),v(2,ea),v(3,Te),v(4,_i),v(5,Ar),v(6,ar),v(7,ia),v(8,Do),v(9,qr),v(10,En),v(11,ta),v(12,$a),v(13,Hi),v(14,ji),v(15,ze),v(16,o$),v(17,Su)],q_);let jM=class extends ne{get encodingOverrides(){return this._encodingOverrides}set encodingOverrides(e){this._encodingOverrides=e}constructor(e,t,i,n){super(),this.textResourceConfigurationService=e,this.environmentService=t,this.contextService=i,this.uriIdentityService=n,this._encodingOverrides=this.getDefaultEncodingOverrides(),this.registerListeners()}registerListeners(){this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.encodingOverrides=this.getDefaultEncodingOverrides()))}getDefaultEncodingOverrides(){const e=[];return e.push({parent:this.environmentService.userRoamingDataHome,encoding:hr}),e.push({extension:bQ,encoding:hr}),e.push({parent:this.environmentService.untitledWorkspacesHome,encoding:hr}),this.contextService.getWorkspace().folders.forEach(t=>{e.push({parent:pt(t.uri,".vscode"),encoding:hr})}),e}async getWriteEncoding(e,t){const{encoding:i,hasBOM:n}=await this.getPreferredWriteEncoding(e,t?t.encoding:void 0);return{encoding:i,addBOM:n}}async getPreferredWriteEncoding(e,t){const i=await this.getEncodingForResource(e,t);return{encoding:i,hasBOM:i===bf||i===Sf||i===Qc}}async getPreferredReadEncoding(e,t,i){let n;t!=null&&t.encoding?i===Qc&&t.encoding===hr?n=Qc:n=t.encoding:typeof i=="string"?n=i:this.textResourceConfigurationService.getValue(e,"files.encoding")===Qc&&(n=hr);const s=await this.getEncodingForResource(e,n);return{encoding:s,hasBOM:s===bf||s===Sf||s===Qc}}async getEncodingForResource(e,t){let i;const n=this.getEncodingOverride(e);return n?i=n:t?i=t:i=this.textResourceConfigurationService.getValue(e,"files.encoding"),i!==hr&&(!i||!await hde(i))&&(i=hr),i}getEncodingOverride(e){var t;if((t=this.encodingOverrides)!=null&&t.length){for(const i of this.encodingOverrides)if(i.parent&&this.uriIdentityService.extUri.isEqualOrParent(e,i.parent)||i.extension&&Xw(e)===`.${i.extension}`)return i.encoding}}};jM=T([v(0,Do),v(1,Ar),v(2,oi),v(3,Hi)],jM);let BM=class extends q_{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y,_,b,E){super(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y,b,_,E),this.registerListeners()}registerListeners(){this.lifecycleService.onBeforeShutdown(e=>e.veto(this.onBeforeShutdown(),"veto.textFiles"))}onBeforeShutdown(){return!!this.files.models.some(e=>e.hasState(2))}};BM=T([v(0,at),v(1,tv),v(2,ea),v(3,Te),v(4,_i),v(5,Ar),v(6,ar),v(7,ia),v(8,Do),v(9,qr),v(10,En),v(11,ta),v(12,$a),v(13,Hi),v(14,ji),v(15,o$),v(16,ze),v(17,Su)],BM);const sl=class sl{static keyOf(e){if(Array.isArray(e))return e.map(sl.keyOf).join(",");{const{color:t,letter:i}=e;return Si.isThemeIcon(i)?`${t}+${i.id}`:`${t}/${i}`}}constructor(e,t,i){this.themeService=e,this._refCounter=0,this.data=t;const n=yc(i).toString(36);this.itemColorClassName=`${sl._classNamesPrefix}-itemColor-${n}`,this.itemBadgeClassName=`${sl._classNamesPrefix}-itemBadge-${n}`,this.bubbleBadgeClassName=`${sl._classNamesPrefix}-bubbleBadge-${n}`,this.iconBadgeClassName=`${sl._classNamesPrefix}-iconBadge-${n}`}acquire(){this._refCounter+=1}release(){return--this._refCounter===0}appendCSSRules(e){Array.isArray(this.data)?this._appendForMany(this.data,e):this._appendForOne(this.data,e)}_appendForOne(e,t){const{color:i,letter:n}=e;Nu(`.${this.itemColorClassName}`,`color: ${Mu(i)};`,t),Si.isThemeIcon(n)?this._createIconCSSRule(n,i,t):n&&Nu(`.${this.itemBadgeClassName}::after`,`content: "${n}"; color: ${Mu(i)};`,t)}_appendForMany(e,t){const{color:i}=e[0];Nu(`.${this.itemColorClassName}`,`color: ${Mu(i)};`,t);const n=[];let s;for(const o of e)if(Si.isThemeIcon(o.letter)){s=o.letter;break}else o.letter&&n.push(o.letter);s?this._createIconCSSRule(s,i,t):(n.length&&Nu(`.${this.itemBadgeClassName}::after`,`content: "${n.join(", ")}"; color: ${Mu(i)};`,t),Nu(`.${this.bubbleBadgeClassName}::after`,`content: ""; color: ${Mu(i)}; font-family: codicon; font-size: 14px; margin-right: 14px; opacity: 0.4;`,t))}_createIconCSSRule(e,t,i){var a;const n=Si.getModifier(e);n&&(e=Si.modify(e,void 0));const s=Sq().getIcon(e.id);if(!s)return;const o=this.themeService.getProductIconTheme().getIcon(s);o&&Nu(`.${this.iconBadgeClassName}::after`,`content: '${o.fontCharacter}';
			color: ${e.color?Mu(e.color.id):Mu(t)};
			font-family: ${SQ(((a=o.font)==null?void 0:a.id)??"codicon")};
			font-size: 16px;
			margin-right: 14px;
			font-weight: normal;
			${n==="spin"?"animation: codicon-spin 1.5s steps(30) infinite":""};
			`,i)}removeCSSRules(e){xb(this.itemColorClassName,e),xb(this.itemBadgeClassName,e),xb(this.bubbleBadgeClassName,e),xb(this.iconBadgeClassName,e)}};mi(sl,"_classNamesPrefix","monaco-decoration");let PE=sl;class Tde{constructor(e){this._themeService=e,this._styleElement=Jw(),this._decorationRules=new Map,this._dispoables=new me}dispose(){this._dispoables.dispose(),this._styleElement.remove()}asDecoration(e,t){e.sort((l,u)=>(u.weight||0)-(l.weight||0));const i=PE.keyOf(e);let n=this._decorationRules.get(i);n||(n=new PE(this._themeService,e,i),this._decorationRules.set(i,n),n.appendCSSRules(this._styleElement)),n.acquire();const s=n.itemColorClassName;let o=n.itemBadgeClassName;const a=n.iconBadgeClassName;let c=Mf(e.filter(l=>!ga(l.tooltip)).map(l=>l.tooltip)).join(" • ");const d=e.some(l=>l.strikethrough);return t&&(o=n.bubbleBadgeClassName,c=p("bubbleTitle","Contains emphasized items")),{labelClassName:s,badgeClassName:o,iconClassName:a,strikethrough:d,tooltip:c,dispose:()=>{n!=null&&n.release()&&(this._decorationRules.delete(i),n.removeCSSRules(this._styleElement),n=void 0)}}}}class Ide{constructor(e){this._data=pc.forUris(t=>!0),this._data.fill(!0,bg(e))}affectsResource(e){return this._data.hasElementOrSubtree(e)}}class Gb{constructor(e,t){this.source=e,this.thenable=t}}function Mu(r){return r?es(r):"inherit"}let UM=class{constructor(e,t){this._onDidChangeDecorationsDelayed=new bq({merge:i=>i.flat()}),this._onDidChangeDecorations=new A,this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._provider=new rk,this._decorationStyles=new Tde(t),this._data=pc.forUris(i=>e.extUri.ignorePathCasing(i)),this._onDidChangeDecorationsDelayed.event(i=>{this._onDidChangeDecorations.fire(new Ide(i))})}dispose(){this._onDidChangeDecorations.dispose(),this._onDidChangeDecorationsDelayed.dispose()}registerDecorationsProvider(e){const t=this._provider.unshift(e);this._onDidChangeDecorations.fire({affectsResource(){return!0}});const i=()=>{const s=[];for(const[o,a]of this._data)a.delete(e)&&s.push(o);s.length>0&&this._onDidChangeDecorationsDelayed.fire(s)},n=e.onDidChange(s=>{if(!s)i();else for(const o of s){const a=this._ensureEntry(o);this._fetchData(a,o,e)}});return ot(()=>{t(),n.dispose(),i()})}_ensureEntry(e){let t=this._data.get(e);return t||(t=new Map,this._data.set(e,t)),t}getDecoration(e,t){const i=[];let n=!1;const s=this._ensureEntry(e);for(const o of this._provider){let a=s.get(o);a===void 0&&(a=this._fetchData(s,e,o)),a&&!(a instanceof Gb)&&i.push(a)}if(t){const o=this._data.findSuperstr(e);if(o)for(const a of o)for(const c of a[1].values())c&&!(c instanceof Gb)&&c.bubble&&(i.push(c),n=!0)}return i.length===0?void 0:this._decorationStyles.asDecoration(i,n)}_fetchData(e,t,i){const n=e.get(i);n instanceof Gb&&(n.source.cancel(),e.delete(i));const s=new Xt,o=i.provideDecorations(t,s.token);if(Cg(o)){const a=new Gb(s,Promise.resolve(o).then(c=>{e.get(i)===a&&this._keepItem(e,i,t,c)}).catch(c=>{!Ur(c)&&e.get(i)===a&&e.delete(i)}));return e.set(i,a),null}else return this._keepItem(e,i,t,o)}_keepItem(e,t,i,n){const s=n||null,o=e.get(t);return e.set(t,s),(s||o)&&this._onDidChangeDecorationsDelayed.fire(i),s}};UM=T([v(0,Hi),v(1,Fi)],UM);var iB;class MR{constructor(e,t,i){this.level=e,this.key=t,this.value=i,this.forward=[]}}const kv=void 0;class Ju{constructor(e,t=2**16){this.comparator=e,this[iB]="SkipList",this._level=0,this._size=0,this._maxLevel=Math.max(1,Math.log2(t)|0),this._header=new MR(this._maxLevel,kv,kv)}get size(){return this._size}clear(){this._header=new MR(this._maxLevel,kv,kv)}has(e){return!!Ju._search(this,e,this.comparator)}get(e){var t;return(t=Ju._search(this,e,this.comparator))==null?void 0:t.value}set(e,t){return Ju._insert(this,e,t,this.comparator)&&(this._size+=1),this}delete(e){const t=Ju._delete(this,e,this.comparator);return t&&(this._size-=1),t}forEach(e,t){let i=this._header.forward[0];for(;i;)e.call(t,i.value,i.key,this),i=i.forward[0]}[(iB=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}*entries(){let e=this._header.forward[0];for(;e;)yield[e.key,e.value],e=e.forward[0]}*keys(){let e=this._header.forward[0];for(;e;)yield e.key,e=e.forward[0]}*values(){let e=this._header.forward[0];for(;e;)yield e.value,e=e.forward[0]}toString(){let e="[SkipList]:",t=this._header.forward[0];for(;t;)e+=`node(${t.key}, ${t.value}, lvl:${t.level})`,t=t.forward[0];return e}static _search(e,t,i){let n=e._header;for(let s=e._level-1;s>=0;s--)for(;n.forward[s]&&i(n.forward[s].key,t)<0;)n=n.forward[s];if(n=n.forward[0],n&&i(n.key,t)===0)return n}static _insert(e,t,i,n){const s=[];let o=e._header;for(let a=e._level-1;a>=0;a--){for(;o.forward[a]&&n(o.forward[a].key,t)<0;)o=o.forward[a];s[a]=o}if(o=o.forward[0],o&&n(o.key,t)===0)return o.value=i,!1;{const a=Ju._randomLevel(e);if(a>e._level){for(let c=e._level;c<a;c++)s[c]=e._header;e._level=a}o=new MR(a,t,i);for(let c=0;c<a;c++)o.forward[c]=s[c].forward[c],s[c].forward[c]=o;return!0}}static _randomLevel(e,t=.5){let i=1;for(;Math.random()<t&&i<e._maxLevel;)i+=1;return i}static _delete(e,t,i){const n=[];let s=e._header;for(let o=e._level-1;o>=0;o--){for(;s.forward[o]&&i(s.forward[o].key,t)<0;)s=s.forward[o];n[o]=s}if(s=s.forward[0],!s||i(s.key,t)!==0)return!1;for(let o=0;o<e._level&&n[o].forward[o]===s;o++)n[o].forward[o]=s.forward[o];for(;e._level>0&&e._header.forward[e._level-1]===kv;)e._level-=1;return!0}}const jy=class jy{constructor(e){this.uri=e,this.time=jy._clock++}touch(){return this.time=jy._clock++,this}};mi(jy,"_clock",0);let AE=jy,VM=class{constructor(e){this._fileService=e,this._dispooables=new me,this._limit=2**16;const t=new Map,i=n=>{let s=t.get(n.scheme);return s===void 0&&(s=e.hasProvider(n)&&!this._fileService.hasCapability(n,1024),t.set(n.scheme,s)),s};this._dispooables.add(F.any(e.onDidChangeFileSystemProviderRegistrations,e.onDidChangeFileSystemProviderCapabilities)(n=>{t.delete(n.scheme)})),this.extUri=new GN(i),this._canonicalUris=new Ju((n,s)=>this.extUri.compare(n,s,!0),this._limit)}dispose(){this._dispooables.dispose(),this._canonicalUris.clear()}asCanonicalUri(e){this._fileService.hasProvider(e)&&(e=CQ(e));const t=this._canonicalUris.get(e);return t?t.touch().uri.with({fragment:e.fragment}):(this._canonicalUris.set(e,new AE(e)),this._checkTrim(),e)}_checkTrim(){if(this._canonicalUris.size<this._limit)return;const e=[...this._canonicalUris.entries()].sort((i,n)=>i[1].time<n[1].time?1:i[1].time>n[1].time?-1:0);AE._clock=0,this._canonicalUris.clear();const t=this._limit*.5;for(let i=0;i<t;i++)this._canonicalUris.set(e[i][0],e[i][1].touch())}};VM=T([v(0,at)],VM);const Rde=re("jsonEditingService");class Pde extends Error{constructor(e,t){super(e),this.code=t}}function Ade(r,e,t){let i,n,s,o,a;if(e){for(o=e.offset,a=o+e.length,s=o;s>0&&!ME(r,s-1);)s--;let D=a;for(;D<r.length&&!ME(r,D);)D++;n=r.substring(s,D),i=Mde(n,t)}else n=r,i=0,s=0,o=0,a=r.length;const c=Lde(t,r);let d=!1,l=0,u;t.insertSpaces?u=LR(" ",t.tabSize||4):u="	";const h=EQ(n,!1);let g=!1;function m(){return c+LR(u,i+l)}function y(){let D=h.scan();for(d=!1;D===15||D===14;)d=d||D===14,D=h.scan();return g=D===16||h.getTokenError()!==0,D}const _=[];function b(D,R,M){!g&&R<a&&M>o&&r.substring(R,M)!==D&&_.push({offset:R,length:M-R,content:D})}let E=y();if(E!==17){const D=h.getTokenOffset()+s,R=LR(u,i);b(R,s,D)}for(;E!==17;){let D=h.getTokenOffset()+h.getTokenLength()+s,R=y(),M="";for(;!d&&(R===12||R===13);){const L=h.getTokenOffset()+s;b(" ",D,L),D=h.getTokenOffset()+h.getTokenLength()+s,M=R===12?m():"",R=y()}if(R===2)E!==1&&(l--,M=m());else if(R===4)E!==3&&(l--,M=m());else{switch(E){case 3:case 1:l++,M=m();break;case 5:case 12:M=m();break;case 13:d?M=m():M=" ";break;case 6:M=" ";break;case 10:if(R===6){M="";break}case 7:case 8:case 9:case 11:case 2:case 4:R===12||R===13?M=" ":R!==5&&R!==17&&(g=!0);break;case 16:g=!0;break}d&&(R===12||R===13)&&(M=m())}const O=h.getTokenOffset()+s;b(M,D,O),E=R}return _}function LR(r,e){let t="";for(let i=0;i<e;i++)t+=r;return t}function Mde(r,e){let t=0,i=0;const n=e.tabSize||4;for(;t<r.length;){const s=r.charAt(t);if(s===" ")i++;else if(s==="	")i+=n;else break;t++}return Math.floor(i/n)}function Lde(r,e){for(let t=0;t<e.length;t++){const i=e.charAt(t);if(i==="\r")return t+1<e.length&&e.charAt(t+1)===`
`?`\r
`:"\r";if(i===`
`)return`
`}return r&&r.eol||`
`}function ME(r,e){return`\r
`.indexOf(r.charAt(e))!==-1}function Fde(r,e,t){return qc(r,e,void 0,t)}function qc(r,e,t,i,n){const s=e.slice(),a=xQ(r,[]);let c,d;for(;s.length>0&&(d=s.pop(),c=lH(a,s),c===void 0&&t!==void 0);)typeof d=="string"?t={[d]:t}:t=[t];if(c)if(c.type==="object"&&typeof d=="string"&&Array.isArray(c.children)){const l=lH(c,[d]);if(l!==void 0)if(t===void 0){if(!l.parent)throw new Error("Malformed AST");const u=c.children.indexOf(l.parent);let h,g=l.parent.offset+l.parent.length;if(u>0){const m=c.children[u-1];h=m.offset+m.length}else h=c.offset+1,c.children.length>1&&(g=c.children[1].offset);return lp(r,{offset:h,length:g-h,content:""},i)}else return lp(r,{offset:l.offset,length:l.length,content:JSON.stringify(t)},i);else{if(t===void 0)return[];const u=`${JSON.stringify(d)}: ${JSON.stringify(t)}`,h=n?n(c.children.map(m=>m.children[0].value)):c.children.length;let g;if(h>0){const m=c.children[h-1];g={offset:m.offset+m.length,length:0,content:","+u}}else c.children.length===0?g={offset:c.offset+1,length:0,content:u}:g={offset:c.offset+1,length:0,content:u+","};return lp(r,g,i)}}else if(c.type==="array"&&typeof d=="number"&&Array.isArray(c.children))if(t!==void 0){const l=`${JSON.stringify(t)}`;let u;if(c.children.length===0||d===0)u={offset:c.offset+1,length:0,content:c.children.length===0?l:l+","};else{const h=d===-1||d>c.children.length?c.children.length:d,g=c.children[h-1];u={offset:g.offset+g.length,length:0,content:","+l}}return lp(r,u,i)}else{const l=d,u=c.children[l];let h;if(c.children.length===1)h={offset:c.offset+1,length:c.length-2,content:""};else if(c.children.length-1===l){const g=c.children[l-1],m=g.offset+g.length,y=c.offset+c.length;h={offset:m,length:y-2-m,content:""}}else h={offset:u.offset,length:c.children[l+1].offset-u.offset,content:""};return lp(r,h,i)}else throw new Error(`Can not add ${typeof d!="number"?"index":"property"} to parent of type ${c.type}`);else{if(t===void 0)throw new Error("Can not delete in empty document");return lp(r,{offset:a?a.offset:0,length:a?a.length:0,content:JSON.stringify(t)},i)}}function lp(r,e,t){let i=qM(r,e),n=e.offset,s=e.offset+e.content.length;if(e.length===0||e.content.length===0){for(;n>0&&!ME(i,n-1);)n--;for(;s<i.length&&!ME(i,s);)s++}const o=Ade(i,{offset:n,length:s-n},t);for(let c=o.length-1;c>=0;c--){const d=o[c];i=qM(i,d),n=Math.min(n,d.offset),s=Math.max(s,d.offset+d.length),s+=d.content.length-d.length}const a=r.length-(i.length-s)-n;return[{offset:n,length:a,content:i.substring(n,s)}]}function qM(r,e){return r.substring(0,e.offset)+e.content+r.substring(e.offset+e.length)}function nB(r,e){const t=e.slice(0).sort((n,s)=>{const o=n.offset-s.offset;return o===0?n.length-s.length:o});let i=r.length;for(let n=t.length-1;n>=0;n--){const s=t[n];if(s.offset+s.length<=i)r=qM(r,s);else throw new Error("Overlapping edit");i=s.offset}return r}let GM=class{constructor(e,t,i){this.fileService=e,this.textModelResolverService=t,this.textFileService=i,this.queue=new Cq}write(e,t){return Promise.resolve(this.queue.queue(()=>this.doWriteConfiguration(e,t)))}async doWriteConfiguration(e,t){const i=await this.resolveAndValidate(e,!0);try{await this.writeToBuffer(i.object.textEditorModel,t)}finally{i.dispose()}}async writeToBuffer(e,t){let i=!1;for(const n of t){const s=this.getEdits(e,n)[0];i=!!s&&this.applyEditsToBuffer(s,e)}if(i)return this.textFileService.save(e.uri)}applyEditsToBuffer(e,t){const i=t.getPositionAt(e.offset),n=t.getPositionAt(e.offset+e.length),s=new qe(i.lineNumber,i.column,n.lineNumber,n.column),o=t.getValueInRange(s);if(e.content!==o){const a=o?ma.replace(s,e.content):ma.insert(i,e.content);return t.pushEditOperations([new ef(i.lineNumber,i.column,i.lineNumber,i.column)],[a],()=>[]),!0}return!1}getEdits(e,t){const{tabSize:i,insertSpaces:n}=e.getOptions(),s=e.getEOL(),{path:o,value:a}=t;if(!o.length){const c=JSON.stringify(a,null,n?" ".repeat(i):"	");return[{content:c,length:c.length,offset:0}]}return qc(e.getValue(),o,a,{tabSize:i,insertSpaces:n,eol:s})}async resolveModelReference(e){return await this.fileService.exists(e)||await this.textFileService.write(e,"{}",{encoding:"utf8"}),this.textModelResolverService.createModelReference(e)}hasParseErrors(e){const t=[];return sc(e.getValue(),t,{allowTrailingComma:!0,allowEmptyContent:!0}),t.length>0}async resolveAndValidate(e,t){const i=await this.resolveModelReference(e),n=i.object.textEditorModel;return this.hasParseErrors(n)?(i.dispose(),this.reject(0)):i}reject(e){const t=this.toErrorMessage(e);return Promise.reject(new Pde(t,e))}toErrorMessage(e){switch(e){case 0:return p("errorInvalidFile","Unable to write into the file. Please open the file to correct errors/warnings in the file and try again.")}}};GM=T([v(0,at),v(1,or),v(2,Dn)],GM);const c$=re("workspacesService");function qIe(r){return r.hasOwnProperty("workspace")}function Ode(r){return r.hasOwnProperty("folderUri")}function GIe(r){return r.hasOwnProperty("fileUri")}function Nde(r){return LE(r)||H3(r)}function LE(r){const e=r;return typeof(e==null?void 0:e.path)=="string"&&(!e.name||typeof e.name=="string")}function H3(r){const e=r;return typeof(e==null?void 0:e.uri)=="string"&&(!e.name||typeof e.name=="string")}function $de(r,e,t,i,n){if(r.scheme!==i.scheme)return{name:t,uri:r.toString(!0)};let s=e?void 0:n.relativePath(i,r);if(s!==void 0)s.length===0?s=".":wa&&(s=rB(s));else if(r.scheme===pe.file)s=r.fsPath,wa&&(s=rB(s));else if(n.isEqualAuthority(r.authority,i.authority))s=r.path;else return{name:t,uri:r.toString(!0)};return{name:t,path:s}}function rB(r){return r=Xu(r),DQ(r)||(r=kQ(r)),r}function zIe(r,e,t){const i=[],n=new Set,s=t.dirname(e);for(const o of r){let a;if(LE(o))o.path&&(a=t.resolvePath(s,o.path));else if(H3(o))try{a=k.parse(o.uri),a.path[0]!==Ho.sep&&(a=a.with({path:Ho.sep+a.path}))}catch(c){console.warn(c)}if(a){const c=t.getComparisonKey(a);if(!n.has(c)){n.add(c);const d=o.name||t.basenameOrAuthority(a);i.push(new Eq({uri:a,name:d,index:i.length},o))}}}return i}function KIe(r,e,t,i,n){const s=Wde(e,r),o=n.dirname(e),a=n.dirname(i),c=[];for(const h of s.folders){const g=LE(h)?n.resolvePath(o,h.path):k.parse(h.uri);let m;t?m=!1:m=!LE(h)||Eg(h.path),c.push($de(g,m,h.name,a,n))}const d={insertSpaces:!1,tabSize:4,eol:ck||uc?`
`:`\r
`},l=qc(r,["folders"],c,d);let u=nB(r,l);return TQ(s.remoteAuthority,IQ(i))&&(u=nB(u,Fde(u,["remoteAuthority"],d))),u}function Wde(r,e){const t=sc(e);if(t&&Array.isArray(t.folders))t.folders=t.folders.filter(i=>Nde(i));else throw new Error(`${r} looks like an invalid workspace file.`);return t}function Hde(r){return r.workspace&&typeof r.workspace=="object"&&typeof r.workspace.id=="string"&&typeof r.workspace.configPath=="string"}function jde(r){return typeof r.folderUri=="string"}function Bde(r){return typeof r.fileUri=="string"}function QIe(r,e){const t={workspaces:[],files:[]};if(r){const i=function(s,o){for(let a=0;a<s.length;a++)try{o(s[a],a)}catch(c){e.warn(`Error restoring recent entry ${JSON.stringify(s[a])}: ${c.toString()}. Skip entry.`)}},n=r;Array.isArray(n.entries)&&i(n.entries,s=>{const o=s.label,a=s.remoteAuthority;Hde(s)?t.workspaces.push({label:o,remoteAuthority:a,workspace:{id:s.workspace.id,configPath:k.parse(s.workspace.configPath)}}):jde(s)?t.workspaces.push({label:o,remoteAuthority:a,folderUri:k.parse(s.folderUri)}):Bde(s)&&t.files.push({label:o,remoteAuthority:a,fileUri:k.parse(s.fileUri)})})}return t}function YIe(r){const e={entries:[]};for(const t of r.workspaces)Ode(t)?e.entries.push({folderUri:t.folderUri.toString(),label:t.label,remoteAuthority:t.remoteAuthority}):e.entries.push({workspace:{id:t.workspace.id,configPath:t.workspace.configPath.toString()},label:t.label,remoteAuthority:t.remoteAuthority});for(const t of r.files)e.entries.push({fileUri:t.fileUri.toString(),label:t.label,remoteAuthority:t.remoteAuthority});return e}class Cf extends l3{constructor(){super(...arguments),this._onDidChangeDirty=this._register(new A),this._onDidChangeLabel=this._register(new A),this._onDidChangeCapabilities=this._register(new A),this._onWillDispose=this._register(new A),this.onDidChangeDirty=this._onDidChangeDirty.event,this.onDidChangeLabel=this._onDidChangeLabel.event,this.onDidChangeCapabilities=this._onDidChangeCapabilities.event,this.onWillDispose=this._onWillDispose.event,this.disposed=!1}get editorId(){}get capabilities(){return 2}hasCapability(e){return e===0?this.capabilities===0:(this.capabilities&e)!==0}isReadonly(){return this.hasCapability(2)}getName(){return`Editor ${this.typeId}`}getDescription(e){}getTitle(e){return this.getName()}getLabelExtraClasses(){return[]}getAriaLabel(){return this.getTitle(0)}getTelemetryDescriptor(){return{typeId:this.typeId}}isDirty(){return!1}isModified(){return this.isDirty()}isSaving(){return!1}async resolve(e){return null}async save(e,t){return this}async saveAs(e,t){return this}async revert(e,t){}async rename(e,t){}copy(){return this}matches(e){var i;if(gr(e))return this===e;const t=(i=e.options)==null?void 0:i.override;return this.editorId!==t&&t!==void 0&&this.editorId!==void 0?!1:si(this.resource,Vn.getCanonicalUri(e))}prefersEditorPane(e){return Zh(e)}toUntyped(e){}isDisposed(){return this.disposed}dispose(){this.disposed||(this.disposed=!0,this._onWillDispose.fire()),super.dispose()}}let ns=class Gv extends Cf{get typeId(){return Gv.ID}get capabilities(){let e=this.primary.capabilities;return e&=-33,this.secondary.hasCapability(16)&&(e|=16),this.secondary.hasCapability(8)&&(e|=8),e|=256,e}get resource(){if(this.hasIdenticalSides)return this.primary.resource}constructor(e,t,i,n,s){super(),this.preferredName=e,this.preferredDescription=t,this.secondary=i,this.primary=n,this.editorService=s,this.hasIdenticalSides=this.primary.matches(this.secondary),this.registerListeners()}registerListeners(){this._register(F.once(F.any(this.primary.onWillDispose,this.secondary.onWillDispose))(()=>{this.isDisposed()||this.dispose()})),this._register(this.primary.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.primary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire())),this._register(this.secondary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire())),this._register(this.primary.onDidChangeLabel(()=>this._onDidChangeLabel.fire())),this._register(this.secondary.onDidChangeLabel(()=>this._onDidChangeLabel.fire()))}getName(){const e=this.getPreferredName();return e||(this.hasIdenticalSides?this.primary.getName():p("sideBySideLabels","{0} - {1}",this.secondary.getName(),this.primary.getName()))}getPreferredName(){return this.preferredName}getDescription(e){const t=this.getPreferredDescription();return t||(this.hasIdenticalSides?this.primary.getDescription(e):super.getDescription(e))}getPreferredDescription(){return this.preferredDescription}getTitle(e){return this.hasIdenticalSides?this.primary.getTitle(e)??this.getName():super.getTitle(e)}getLabelExtraClasses(){return this.hasIdenticalSides?this.primary.getLabelExtraClasses():super.getLabelExtraClasses()}getAriaLabel(){return this.hasIdenticalSides?this.primary.getAriaLabel():super.getAriaLabel()}getTelemetryDescriptor(){return{...this.primary.getTelemetryDescriptor(),...super.getTelemetryDescriptor()}}isDirty(){return this.primary.isDirty()}isSaving(){return this.primary.isSaving()}async save(e,t){const i=await this.primary.save(e,t);return this.saveResultToEditor(i)}async saveAs(e,t){const i=await this.primary.saveAs(e,t);return this.saveResultToEditor(i)}saveResultToEditor(e){if(!e||!this.hasIdenticalSides)return e;if(this.primary.matches(e))return this;if(e instanceof Cf)return new Gv(this.preferredName,this.preferredDescription,e,e,this.editorService);if(!va(e)&&!td(e)&&!hc(e))return{primary:e,secondary:e,label:this.preferredName,description:this.preferredDescription}}revert(e,t){return this.primary.revert(e,t)}async rename(e,t){if(!this.hasIdenticalSides)return;const i=await this.primary.rename(e,t);if(i){if(gr(i.editor))return{editor:new Gv(this.preferredName,this.preferredDescription,i.editor,i.editor,this.editorService),options:{...i.options,viewState:CS(this,e,this.editorService)}};if(d3(i.editor))return{editor:{label:this.preferredName,description:this.preferredDescription,primary:i.editor,secondary:i.editor,options:{...i.options,viewState:CS(this,e,this.editorService)}}}}}isReadonly(){return this.primary.isReadonly()}toUntyped(e){const t=this.primary.toUntyped(e),i=this.secondary.toUntyped(e);if(t&&i&&!va(t)&&!va(i)&&!td(t)&&!td(i)&&!hc(t)&&!hc(i)){const n={label:this.preferredName,description:this.preferredDescription,primary:t,secondary:i};return typeof(e==null?void 0:e.preserveViewState)=="number"&&(n.options={viewState:CS(this,e.preserveViewState,this.editorService)}),n}}matches(e){return this===e?!0:u3(e)||va(e)?!1:e instanceof Gv?this.primary.matches(e.primary)&&this.secondary.matches(e.secondary):td(e)?this.primary.matches(e.primary)&&this.secondary.matches(e.secondary):!1}};ns.ID="workbench.editorinputs.sidebysideEditorInput";ns=T([v(4,Ke)],ns);class j3 extends db{get originalModel(){return this._originalModel}get modifiedModel(){return this._modifiedModel}constructor(e,t){super(),this._originalModel=e,this._modifiedModel=t}async resolve(){var e,t;await Promise.all([(e=this._originalModel)==null?void 0:e.resolve(),(t=this._modifiedModel)==null?void 0:t.resolve()])}isResolved(){var e,t;return!!((e=this.originalModel)!=null&&e.isResolved()&&((t=this.modifiedModel)!=null&&t.isResolved()))}dispose(){super.dispose()}}class B3 extends j3{get originalModel(){return this._originalModel}get modifiedModel(){return this._modifiedModel}get textDiffEditorModel(){return this._textDiffEditorModel}constructor(e,t){super(e,t),this._textDiffEditorModel=void 0,this._originalModel=e,this._modifiedModel=t,this.updateTextDiffEditorModel()}async resolve(){await super.resolve(),this.updateTextDiffEditorModel()}updateTextDiffEditorModel(){var e,t;(e=this.originalModel)!=null&&e.isResolved()&&((t=this.modifiedModel)!=null&&t.isResolved())&&(this._textDiffEditorModel?(this._textDiffEditorModel.original=this.originalModel.textEditorModel,this._textDiffEditorModel.modified=this.modifiedModel.textEditorModel):this._textDiffEditorModel={original:this.originalModel.textEditorModel,modified:this.modifiedModel.textEditorModel})}isResolved(){return!!this._textDiffEditorModel}isReadonly(){return!!this.modifiedModel&&this.modifiedModel.isReadonly()}dispose(){this._textDiffEditorModel=void 0,super.dispose()}}let Ss=class zM extends ns{get typeId(){return zM.ID}get editorId(){return this.modified.editorId===this.original.editorId?this.modified.editorId:void 0}get capabilities(){let e=super.capabilities;return this.labels.forceDescription&&(e|=64),e}constructor(e,t,i,n,s,o){super(e,t,i,n,o),this.original=i,this.modified=n,this.forceOpenAsBinary=s,this.cachedModel=void 0,this.labels=this.computeLabels()}computeLabels(){let e,t=!1;if(this.preferredName)e=this.preferredName;else{const d=this.original.getName(),l=this.modified.getName();e=p("sideBySideLabels","{0} ↔ {1}",d,l),t=d===l}let i,n,s;if(this.preferredDescription)i=this.preferredDescription,n=this.preferredDescription,s=this.preferredDescription;else{i=this.computeLabel(this.original.getDescription(0),this.modified.getDescription(0)),s=this.computeLabel(this.original.getDescription(2),this.modified.getDescription(2));const d=this.original.getDescription(1),l=this.modified.getDescription(1);if(typeof d=="string"&&typeof l=="string"&&(d||l)){const[u,h]=RQ([d,l]);n=this.computeLabel(u,h)}}const o=this.computeLabel(this.original.getTitle(0)??this.original.getName(),this.modified.getTitle(0)??this.modified.getName()," ↔ "),a=this.computeLabel(this.original.getTitle(1)??this.original.getName(),this.modified.getTitle(1)??this.modified.getName()," ↔ "),c=this.computeLabel(this.original.getTitle(2)??this.original.getName(),this.modified.getTitle(2)??this.modified.getName()," ↔ ");return{name:e,shortDescription:i,mediumDescription:n,longDescription:s,forceDescription:t,shortTitle:o,mediumTitle:a,longTitle:c}}computeLabel(e,t,i=" - "){if(!(!e||!t))return e===t?t:`${e}${i}${t}`}getName(){return this.labels.name}getDescription(e=1){switch(e){case 0:return this.labels.shortDescription;case 2:return this.labels.longDescription;case 1:default:return this.labels.mediumDescription}}getTitle(e){switch(e){case 0:return this.labels.shortTitle;case 2:return this.labels.longTitle;default:case 1:return this.labels.mediumTitle}}async resolve(e){var i;const t=await this.createModel(e);return(i=this.cachedModel)==null||i.dispose(),this.cachedModel=t,this.cachedModel}prefersEditorPane(e){return this.forceOpenAsBinary?e.find(t=>t.typeId===hce):e.find(t=>t.typeId===c3)}async createModel(e){const[t,i]=await Promise.all([this.original.resolve(e),this.modified.resolve(e)]);return i instanceof Ec&&t instanceof Ec?new B3(t,i):new j3(ii(t),ii(i))}toUntyped(e){const t=super.toUntyped(e);if(t)return{...t,modified:t.primary,original:t.secondary}}matches(e){return this===e?!0:e instanceof zM?this.modified.matches(e.modified)&&this.original.matches(e.original)&&e.forceOpenAsBinary===this.forceOpenAsBinary:va(e)?this.modified.matches(e.modified)&&this.original.matches(e.original):!1}dispose(){this.cachedModel&&(this.cachedModel.dispose(),this.cachedModel=void 0),super.dispose()}};Ss.ID="workbench.editors.diffEditorInput";Ss=T([v(5,Ke)],Ss);let KM=class extends Cf{get capabilities(){let e=32;return this.fileService.hasProvider(this.resource)?this.filesConfigurationService.isReadonly(this.resource)&&(e|=2):e|=4,e&2||(e|=128),e}get preferredResource(){return this._preferredResource}constructor(e,t,i,n,s){super(),this.resource=e,this.labelService=i,this.fileService=n,this.filesConfigurationService=s,this._name=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._preferredResource=t||e,this.registerListeners()}registerListeners(){this._register(this.labelService.onDidChangeFormatters(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e=>this.onLabelEvent(e.scheme)))}onLabelEvent(e){e===this._preferredResource.scheme&&this.updateLabel()}updateLabel(){this._name=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._onDidChangeLabel.fire()}setPreferredResource(e){si(e,this._preferredResource)||(this._preferredResource=e,this.updateLabel())}getName(){return typeof this._name!="string"&&(this._name=this.labelService.getUriBasenameLabel(this._preferredResource)),this._name}getDescription(e=1){switch(e){case 0:return this.shortDescription;case 2:return this.longDescription;case 1:default:return this.mediumDescription}}get shortDescription(){return typeof this._shortDescription!="string"&&(this._shortDescription=this.labelService.getUriBasenameLabel(pn(this._preferredResource))),this._shortDescription}get mediumDescription(){return typeof this._mediumDescription!="string"&&(this._mediumDescription=this.labelService.getUriLabel(pn(this._preferredResource),{relative:!0})),this._mediumDescription}get longDescription(){return typeof this._longDescription!="string"&&(this._longDescription=this.labelService.getUriLabel(pn(this._preferredResource))),this._longDescription}get shortTitle(){return typeof this._shortTitle!="string"&&(this._shortTitle=this.getName()),this._shortTitle}get mediumTitle(){return typeof this._mediumTitle!="string"&&(this._mediumTitle=this.labelService.getUriLabel(this._preferredResource,{relative:!0})),this._mediumTitle}get longTitle(){return typeof this._longTitle!="string"&&(this._longTitle=this.labelService.getUriLabel(this._preferredResource)),this._longTitle}getTitle(e){switch(e){case 0:return this.shortTitle;case 2:return this.longTitle;default:case 1:return this.mediumTitle}}isReadonly(){return this.filesConfigurationService.isReadonly(this.resource)}};KM=T([v(2,Qi),v(3,at),v(4,qr)],KM);let QM=class extends Ec{constructor(e,t,i,n,s){super(i,t,n,s,e)}dispose(){this.textEditorModelHandle&&this.modelService.destroyModel(this.textEditorModelHandle),super.dispose()}};QM=T([v(1,ji),v(2,_i),v(3,ab),v(4,Af)],QM);let cc=class extends KM{constructor(e,t,i,n,s,o,a){super(e,t,s,o,a),this.editorService=i,this.textFileService=n}save(e,t){return this.resource.scheme!==pe.untitled&&!this.fileService.hasProvider(this.resource)?this.saveAs(e,t):this.doSave(t,!1,e)}saveAs(e,t){return this.doSave(t,!0,e)}async doSave(e,t,i){let n;if(t?n=await this.textFileService.saveAs(this.resource,void 0,{...e,suggestedTarget:this.preferredResource}):n=await this.textFileService.save(this.resource,e),!!n)return{resource:n}}async revert(e,t){await this.textFileService.revert(this.resource,t)}};cc=T([v(2,Ke),v(3,Dn),v(4,Qi),v(5,at),v(6,qr)],cc);let du=class YM extends cc{get typeId(){return YM.ID}get editorId(){return fd.id}constructor(e,t,i,n,s,o,a,c,d,l,u){super(e,void 0,c,a,l,d,u),this.name=t,this.description=i,this.preferredLanguageId=n,this.preferredContents=s,this.textModelResolverService=o,this.cachedModel=void 0,this.modelReference=void 0}getName(){return this.name||super.getName()}setName(e){this.name!==e&&(this.name=e,this._onDidChangeLabel.fire())}getDescription(){return this.description}setDescription(e){this.description!==e&&(this.description=e,this._onDidChangeLabel.fire())}setLanguageId(e,t){var i;this.setPreferredLanguageId(e),(i=this.cachedModel)==null||i.setLanguageId(e,t)}setPreferredLanguageId(e){this.preferredLanguageId=e}setPreferredContents(e){this.preferredContents=e}async resolve(){const e=this.preferredContents,t=this.preferredLanguageId;this.preferredContents=void 0,this.preferredLanguageId=void 0,this.modelReference||(this.modelReference=this.textModelResolverService.createModelReference(this.resource));const i=await this.modelReference,n=i.object;if(!(n instanceof QM))throw i.dispose(),this.modelReference=void 0,new Error(`Unexpected model for TextResourceEditorInput: ${this.resource}`);return this.cachedModel=n,(typeof e=="string"||typeof t=="string")&&n.updateTextEditorModel(typeof e=="string"?PQ(e):void 0,t),n}matches(e){return this===e?!0:e instanceof YM?si(e.resource,this.resource):d3(e)?super.matches(e):!1}dispose(){this.modelReference&&(this.modelReference.then(e=>e.dispose()),this.modelReference=void 0),this.cachedModel=void 0,super.dispose()}};du.ID="workbench.editors.resourceEditorInput";du=T([v(5,or),v(6,Dn),v(7,Ke),v(8,at),v(9,Qi),v(10,qr)],du);let lu=class XM extends cc{get typeId(){return XM.ID}get editorId(){return fd.id}constructor(e,t,i,n,s,o,a,c){super(e.resource,void 0,n,t,i,s,c),this.model=e,this.environmentService=o,this.pathService=a,this.modelResolve=void 0,this.registerModelListeners(e)}registerModelListeners(e){this._register(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(e.onDidChangeName(()=>this._onDidChangeLabel.fire())),this._register(e.onDidRevert(()=>this.dispose()))}getName(){return this.model.name}getDescription(e=1){if(!this.model.hasAssociatedFilePath){const t=this.resource.path;return t!==this.getName()?t:void 0}return super.getDescription(e)}getTitle(e){if(!this.model.hasAssociatedFilePath){const t=this.getName(),i=this.getDescription();return i&&i!==t?`${t} • ${i}`:t}return super.getTitle(e)}isDirty(){return this.model.isDirty()}getEncoding(){return this.model.getEncoding()}setEncoding(e,t){return this.model.setEncoding(e)}setLanguageId(e,t){this.model.setLanguageId(e,t)}getLanguageId(){return this.model.getLanguageId()}async resolve(){return this.modelResolve||(this.modelResolve=this.model.resolve()),await this.modelResolve,this.model}toUntyped(e){var i;const t={resource:this.model.hasAssociatedFilePath?zy(this.model.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):this.resource,forceUntitled:!0,options:{override:this.editorId}};return typeof(e==null?void 0:e.preserveViewState)=="number"&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=this.model.isModified()?(i=this.model.textEditorModel)==null?void 0:i.getValue():void 0,t.options.viewState=CS(this,e.preserveViewState,this.editorService),typeof t.contents=="string"&&!this.model.hasAssociatedFilePath&&(t.resource=void 0)),t}matches(e){return this===e?!0:e instanceof XM?si(e.resource,this.resource):fce(e)?super.matches(e):!1}dispose(){this.modelResolve=void 0,super.dispose()}};lu.ID="workbench.editors.untitledEditorInput";lu=T([v(1,Dn),v(2,Qi),v(3,Ke),v(4,at),v(5,Ar),v(6,ta),v(7,qr)],lu);const d$=Object.freeze({id:"workbench",order:7,title:p("workbenchConfigurationTitle","Workbench"),type:"object"}),eRe=Object.freeze({id:"security",scope:1,title:p("securityConfigurationTitle","Security"),type:"object",order:7}),U3={ConfigurationMigration:"base.contributions.configuration.migration"};class Ude{constructor(){this.migrations=[],this._onDidRegisterConfigurationMigrations=new A,this.onDidRegisterConfigurationMigration=this._onDidRegisterConfigurationMigrations.event}registerConfigurationMigrations(e){this.migrations.push(...e)}}const Vde=new Ude;st.add(U3.ConfigurationMigration,Vde);const lb=re("editorResolverService"),tRe="workbench.editorAssociations",qde=st.as(ks.Configuration),Gde={...d$,properties:{"workbench.editorAssociations":{type:"object",markdownDescription:p("editor.editorAssociations",'Configure [glob patterns](https://aka.ms/vscode-glob-patterns) to editors (for example `"*.hex": "hexEditor.hexedit"`). These have precedence over the default behavior.'),additionalProperties:{type:"string"}}}};qde.registerConfiguration(Gde);var id;(function(r){r.builtin="builtin",r.option="option",r.exclusive="exclusive",r.default="default"})(id||(id={}));function FE(r){switch(r){case id.exclusive:return 5;case id.default:return 4;case id.builtin:return 3;case id.option:default:return 1}}function zde(r,e){if(new Set([pe.extension,pe.webviewPanel,pe.vscodeWorkspaceTrust,pe.vscodeSettings]).has(e.scheme))return!1;const n=typeof r=="string"&&r.indexOf(Ho.sep)>=0?`${e.scheme}:${e.path}`:Mt(e);return hS(typeof r=="string"?r.toLowerCase():r,n.toLowerCase())}const Kde=re("textEditorService");let sB=class extends ne{constructor(e,t,i,n,s){super(),this.untitledTextEditorService=e,this.instantiationService=t,this.uriIdentityService=i,this.fileService=n,this.editorResolverService=s,this.editorInputCache=new ki,this.fileEditorFactory=st.as(au.EditorFactory).getFileEditorFactory(),this.registerDefaultEditor()}registerDefaultEditor(){this._register(this.editorResolverService.registerEditor("*",{id:fd.id,label:fd.displayName,detail:fd.providerDisplayName,priority:id.builtin},{},{createEditorInput:e=>({editor:this.createTextEditor(e)}),createUntitledEditorInput:e=>({editor:this.createTextEditor(e)}),createDiffEditorInput:e=>({editor:this.createTextEditor(e)})}))}async resolveTextEditor(e){return this.createTextEditor(e)}createTextEditor(e){var n;if(hc(e))return this.createTextEditor(e.result);if(va(e)){const s=this.createTextEditor(e.original),o=this.createTextEditor(e.modified);return this.instantiationService.createInstance(Ss,e.label,e.description,s,o,void 0)}if(td(e)){const s=this.createTextEditor(e.primary),o=this.createTextEditor(e.secondary);return this.instantiationService.createInstance(ns,e.label,e.description,o,s)}const t=e;if(t.forceUntitled||!t.resource||t.resource.scheme===pe.untitled){const s={languageId:t.languageId,initialValue:t.contents,encoding:t.encoding};let o;return((n=t.resource)==null?void 0:n.scheme)===pe.untitled?o=this.untitledTextEditorService.create({untitledResource:t.resource,...s}):o=this.untitledTextEditorService.create({associatedResource:t.resource,...s}),this.createOrGetCached(o.resource,()=>{const a=this.instantiationService.createInstance(lu,o);return F.once(a.onWillDispose)(()=>o.dispose()),a})}const i=e;if(i.resource instanceof k){const s=i.label||Mt(i.resource),o=i.resource,a=this.uriIdentityService.asCanonicalUri(o);return this.createOrGetCached(a,()=>i.forceFile||this.fileService.hasProvider(a)?this.fileEditorFactory.createFileEditor(a,o,i.label,i.description,i.encoding,i.languageId,i.contents,this.instantiationService):this.instantiationService.createInstance(du,a,i.label,i.description,i.languageId,i.contents),c=>{c instanceof lu||(c instanceof du?(s&&c.setName(s),i.description&&c.setDescription(i.description),i.languageId&&c.setPreferredLanguageId(i.languageId),typeof i.contents=="string"&&c.setPreferredContents(i.contents)):(c.setPreferredResource(o),i.label&&c.setPreferredName(i.label),i.description&&c.setPreferredDescription(i.description),i.encoding&&c.setPreferredEncoding(i.encoding),i.languageId&&c.setPreferredLanguageId(i.languageId),typeof i.contents=="string"&&c.setPreferredContents(i.contents)))})}throw new Error(`ITextEditorService: Unable to create texteditor from ${JSON.stringify(e)}`)}createOrGetCached(e,t,i){let n=this.editorInputCache.get(e);return n?(i==null||i(n),n):(n=t(),this.editorInputCache.set(e,n),F.once(n.onWillDispose)(()=>this.editorInputCache.delete(e)),n)}};sB=T([v(0,tv),v(1,Te),v(2,Hi),v(3,at),v(4,lb)],sB);let OE=class kS extends ne{get startupKind(){return this._startupKind}get phase(){return this._phase}constructor(e,t){super(),this.logService=e,this.storageService=t,this._onBeforeShutdown=this._register(new A),this.onBeforeShutdown=this._onBeforeShutdown.event,this._onWillShutdown=this._register(new A),this.onWillShutdown=this._onWillShutdown.event,this._onDidShutdown=this._register(new A),this.onDidShutdown=this._onDidShutdown.event,this._onBeforeShutdownError=this._register(new A),this.onBeforeShutdownError=this._onBeforeShutdownError.event,this._onShutdownVeto=this._register(new A),this.onShutdownVeto=this._onShutdownVeto.event,this._phase=1,this.phaseWhen=new Map,this._startupKind=this.resolveStartupKind(),this.storageService.onWillSaveState(i=>{i.reason===AQ.SHUTDOWN&&this.storageService.store(kS.LAST_SHUTDOWN_REASON_KEY,this.shutdownReason,1,1)})}resolveStartupKind(){const e=this.storageService.getNumber(kS.LAST_SHUTDOWN_REASON_KEY,1);this.storageService.remove(kS.LAST_SHUTDOWN_REASON_KEY,1);let t;switch(e){case 3:t=3;break;case 4:t=4;break;default:t=1}return this.logService.trace(`[lifecycle] starting up (startup kind: ${t})`),t}set phase(e){if(e<this.phase)throw new Error("Lifecycle cannot go backwards");if(this._phase===e)return;this.logService.trace(`lifecycle: phase changed (value: ${e})`),this._phase=e,qt(`code/LifecyclePhase/${dce(e)}`);const t=this.phaseWhen.get(this._phase);t&&(t.open(),this.phaseWhen.delete(this._phase))}async when(e){if(e<=this._phase)return;let t=this.phaseWhen.get(e);t||(t=new Cs,this.phaseWhen.set(e,t)),await t.wait()}};OE.LAST_SHUTDOWN_REASON_KEY="lifecyle.lastShutdownReason";OE=T([v(0,ze),v(1,ri)],OE);const l$="text/x-code-output",V3="output",q3="Log",u$="text/x-code-log-output",h$="log",G3="log",Xn="workbench.panel.output",z3=new G("inOutput",!1),K3=new G("activeLogOutput",!1),Q3=new G("outputView.scrollLock",!1),da=re("outputService");var bs;(function(r){r[r.Append=1]="Append",r[r.Replace=2]="Replace",r[r.Clear=3]="Clear"})(bs||(bs={}));const cl={OutputChannels:"workbench.contributions.outputChannels"};class Qde{constructor(){this.channels=new Map,this._onDidRegisterChannel=new A,this.onDidRegisterChannel=this._onDidRegisterChannel.event,this._onDidRemoveChannel=new A,this.onDidRemoveChannel=this._onDidRemoveChannel.event}registerChannel(e){this.channels.has(e.id)||(this.channels.set(e.id,e),this._onDidRegisterChannel.fire(e.id))}getChannels(){const e=[];return this.channels.forEach(t=>e.push(t)),e}getChannel(e){return this.channels.get(e)}removeChannel(e){this.channels.delete(e),this._onDidRemoveChannel.fire(e)}}st.add(cl.OutputChannels,new Qde);const Y3=new G("activeOutputChannel","");let NE=class X3{constructor(e,t,i,n){this.contextService=e,this.modelService=t,this.languageConfigurationService=i,this.languageFeaturesService=n,this.disposeWorkerScheduler=new Ys(()=>this.disposeWorker(),X3.DISPOSE_WORKER_TIME),this.registerListeners(),this.updateLinkProviderWorker()}registerListeners(){this.contextService.onDidChangeWorkspaceFolders(()=>this.updateLinkProviderWorker())}updateLinkProviderWorker(){this.contextService.getWorkspace().folders.length>0?this.linkProviderRegistration||(this.linkProviderRegistration=this.languageFeaturesService.linkProvider.register([{language:q3,scheme:"*"},{language:G3,scheme:"*"}],{provideLinks:async t=>{const i=await this.provideLinks(t.uri);return i&&{links:i}}})):(vt(this.linkProviderRegistration),this.linkProviderRegistration=void 0),this.disposeWorker(),this.disposeWorkerScheduler.cancel()}getOrCreateWorker(){if(this.disposeWorkerScheduler.schedule(),!this.worker){const e={workspaceFolders:this.contextService.getWorkspace().folders.map(t=>t.uri.toString())};this.worker=MQ(this.modelService,this.languageConfigurationService,{moduleId:"vs/workbench/contrib/output/common/outputLinkComputer",createData:e,label:"outputLinkComputer"})}return this.worker}async provideLinks(e){return(await this.getOrCreateWorker().withSyncedResources([e])).computeLinks(e.toString())}disposeWorker(){this.worker&&(this.worker.dispose(),this.worker=void 0)}};NE.DISPOSE_WORKER_TIME=3*60*1e3;NE=T([v(0,oi),v(1,_i),v(2,Bm),v(3,Lf)],NE);const JM=60,ZM=JM*60,G_=ZM*24,oB=G_*7,aB=G_*30,cB=G_*365;function f$(r,e,t,i){typeof r!="number"&&(r=r.getTime());const n=Math.round((new Date().getTime()-r)/1e3);if(n<-30)return p("date.fromNow.in","in {0}",f$(new Date().getTime()+n*1e3,!1));if(!i&&n<30)return p("date.fromNow.now","now");let s;return n<JM?(s=n,e?s===1?t?p("date.fromNow.seconds.singular.ago.fullWord","{0} second ago",s):p("date.fromNow.seconds.singular.ago","{0} sec ago",s):t?p("date.fromNow.seconds.plural.ago.fullWord","{0} seconds ago",s):p("date.fromNow.seconds.plural.ago","{0} secs ago",s):s===1?t?p("date.fromNow.seconds.singular.fullWord","{0} second",s):p("date.fromNow.seconds.singular","{0} sec",s):t?p("date.fromNow.seconds.plural.fullWord","{0} seconds",s):p("date.fromNow.seconds.plural","{0} secs",s)):n<ZM?(s=Math.floor(n/JM),e?s===1?t?p("date.fromNow.minutes.singular.ago.fullWord","{0} minute ago",s):p("date.fromNow.minutes.singular.ago","{0} min ago",s):t?p("date.fromNow.minutes.plural.ago.fullWord","{0} minutes ago",s):p("date.fromNow.minutes.plural.ago","{0} mins ago",s):s===1?t?p("date.fromNow.minutes.singular.fullWord","{0} minute",s):p("date.fromNow.minutes.singular","{0} min",s):t?p("date.fromNow.minutes.plural.fullWord","{0} minutes",s):p("date.fromNow.minutes.plural","{0} mins",s)):n<G_?(s=Math.floor(n/ZM),e?s===1?t?p("date.fromNow.hours.singular.ago.fullWord","{0} hour ago",s):p("date.fromNow.hours.singular.ago","{0} hr ago",s):t?p("date.fromNow.hours.plural.ago.fullWord","{0} hours ago",s):p("date.fromNow.hours.plural.ago","{0} hrs ago",s):s===1?t?p("date.fromNow.hours.singular.fullWord","{0} hour",s):p("date.fromNow.hours.singular","{0} hr",s):t?p("date.fromNow.hours.plural.fullWord","{0} hours",s):p("date.fromNow.hours.plural","{0} hrs",s)):n<oB?(s=Math.floor(n/G_),e?s===1?p("date.fromNow.days.singular.ago","{0} day ago",s):p("date.fromNow.days.plural.ago","{0} days ago",s):s===1?p("date.fromNow.days.singular","{0} day",s):p("date.fromNow.days.plural","{0} days",s)):n<aB?(s=Math.floor(n/oB),e?s===1?t?p("date.fromNow.weeks.singular.ago.fullWord","{0} week ago",s):p("date.fromNow.weeks.singular.ago","{0} wk ago",s):t?p("date.fromNow.weeks.plural.ago.fullWord","{0} weeks ago",s):p("date.fromNow.weeks.plural.ago","{0} wks ago",s):s===1?t?p("date.fromNow.weeks.singular.fullWord","{0} week",s):p("date.fromNow.weeks.singular","{0} wk",s):t?p("date.fromNow.weeks.plural.fullWord","{0} weeks",s):p("date.fromNow.weeks.plural","{0} wks",s)):n<cB?(s=Math.floor(n/aB),e?s===1?t?p("date.fromNow.months.singular.ago.fullWord","{0} month ago",s):p("date.fromNow.months.singular.ago","{0} mo ago",s):t?p("date.fromNow.months.plural.ago.fullWord","{0} months ago",s):p("date.fromNow.months.plural.ago","{0} mos ago",s):s===1?t?p("date.fromNow.months.singular.fullWord","{0} month",s):p("date.fromNow.months.singular","{0} mo",s):t?p("date.fromNow.months.plural.fullWord","{0} months",s):p("date.fromNow.months.plural","{0} mos",s)):(s=Math.floor(n/cB),e?s===1?t?p("date.fromNow.years.singular.ago.fullWord","{0} year ago",s):p("date.fromNow.years.singular.ago","{0} yr ago",s):t?p("date.fromNow.years.plural.ago.fullWord","{0} years ago",s):p("date.fromNow.years.plural.ago","{0} yrs ago",s):s===1?t?p("date.fromNow.years.singular.fullWord","{0} year",s):p("date.fromNow.years.singular","{0} yr",s):t?p("date.fromNow.years.plural.fullWord","{0} years",s):p("date.fromNow.years.plural","{0} yrs",s))}function J3(r){return r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0")+"."+(r.getMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}class Yde extends ne{constructor(e,t,i){super(),this.file=e,this.fileService=t,this.logService=i,this._onDidContentChange=new A,this.onDidContentChange=this._onDidContentChange.event,this.watching=!1,this.syncDelayer=new ok(500)}watch(e){this.watching||(this.etag=e,this.poll(),this.logService.trace("Started polling",this.file.toString()),this.watching=!0)}poll(){const e=()=>this.doWatch().then(()=>this.poll());this.syncDelayer.trigger(e).catch(t=>{if(!Ur(t))throw t})}async doWatch(){const e=await this.fileService.stat(this.file);e.etag!==this.etag&&(this.etag=e.etag,this._onDidContentChange.fire(e.size))}unwatch(){this.watching&&(this.syncDelayer.cancel(),this.watching=!1,this.logService.trace("Stopped polling",this.file.toString()))}dispose(){this.unwatch(),super.dispose()}}let $E=class extends ne{constructor(e,t,i,n,s,o,a){super(),this.modelUri=e,this.language=t,this.file=i,this.fileService=n,this.modelService=s,this.editorWorkerService=a,this._onDispose=this._register(new A),this.onDispose=this._onDispose.event,this.etag="",this.loadModelPromise=null,this.model=null,this.modelUpdateInProgress=!1,this.modelUpdateCancellationSource=this._register(new Hr),this.appendThrottler=this._register(new ok(300)),this.startOffset=0,this.endOffset=0,this.fileHandler=this._register(new Yde(this.file,this.fileService,o)),this._register(this.fileHandler.onDidContentChange(c=>this.onDidContentChange(c))),this._register(ot(()=>this.fileHandler.unwatch()))}append(e){throw new Error("Not supported")}replace(e){throw new Error("Not supported")}clear(){this.update(bs.Clear,this.endOffset,!0)}update(e,t,i){(this.loadModelPromise?this.loadModelPromise:Promise.resolve()).then(()=>this.doUpdate(e,t,i))}loadModel(){return this.loadModelPromise=Sn.withAsyncBody(async(e,t)=>{try{let i="";if(await this.fileService.exists(this.file)){const n=await this.fileService.readFile(this.file,{position:this.startOffset});this.endOffset=this.startOffset+n.value.byteLength,this.etag=n.etag,i=n.value.toString()}else this.startOffset=0,this.endOffset=0;e(this.createModel(i))}catch(i){t(i)}}),this.loadModelPromise}createModel(e){if(this.model)this.model.setValue(e);else{this.model=this.modelService.createModel(e,this.language,this.modelUri),this.fileHandler.watch(this.etag);const t=this.model.onWillDispose(()=>{this.cancelModelUpdate(),this.fileHandler.unwatch(),this.model=null,vt(t)})}return this.model}doUpdate(e,t,i){if((e===bs.Clear||e===bs.Replace)&&(this.startOffset=this.endOffset=pr(t)?t:this.endOffset,this.cancelModelUpdate()),!this.model)return;this.modelUpdateInProgress=!0,this.modelUpdateCancellationSource.value||(this.modelUpdateCancellationSource.value=new Xt);const n=this.modelUpdateCancellationSource.value.token;e===bs.Clear?this.clearContent(this.model):e===bs.Replace?this.replacePromise=this.replaceContent(this.model,n).finally(()=>this.replacePromise=void 0):this.appendContent(this.model,i,n)}clearContent(e){this.doUpdateModel(e,[ma.delete(e.getFullModelRange())],De.fromString(""))}appendContent(e,t,i){this.appendThrottler.trigger(async()=>{if(i.isCancellationRequested)return;if(this.replacePromise){try{await this.replacePromise}catch{}if(i.isCancellationRequested)return}const n=await this.getContentToUpdate();if(i.isCancellationRequested)return;const s=e.getLineCount(),o=e.getLineMaxColumn(s),a=[ma.insert(new Us(s,o),n.toString())];this.doUpdateModel(e,a,n)},t?0:void 0).catch(n=>{if(!Ur(n))throw n})}async replaceContent(e,t){const i=await this.getContentToUpdate();if(t.isCancellationRequested)return;const n=await this.getReplaceEdits(e,i.toString());t.isCancellationRequested||this.doUpdateModel(e,n,i)}async getReplaceEdits(e,t){if(!t)return[ma.delete(e.getFullModelRange())];if(t!==e.getValue()){const i=await this.editorWorkerService.computeMoreMinimalEdits(e.uri,[{text:t.toString(),range:e.getFullModelRange()}]);if(i!=null&&i.length)return i.map(n=>ma.replace(qe.lift(n.range),n.text))}return[]}doUpdateModel(e,t,i){t.length&&e.applyEdits(t),this.endOffset=this.endOffset+i.byteLength,this.modelUpdateInProgress=!1}cancelModelUpdate(){var e;(e=this.modelUpdateCancellationSource.value)==null||e.cancel(),this.modelUpdateCancellationSource.value=void 0,this.appendThrottler.cancel(),this.replacePromise=void 0,this.modelUpdateInProgress=!1}async getContentToUpdate(){const e=await this.fileService.readFile(this.file,{position:this.endOffset});return this.etag=e.etag,e.value}onDidContentChange(e){this.model&&(this.modelUpdateInProgress||pr(e)&&this.endOffset>e&&this.update(bs.Clear,0,!0),this.update(bs.Append,void 0,!1))}isVisible(){return!!this.model}dispose(){this._onDispose.fire(),super.dispose()}};$E=T([v(3,at),v(4,_i),v(5,ze),v(6,Zw)],$E);let e0=class extends $E{constructor(e,t,i,n,s,o,a,c,d){super(t,i,n,s,o,c,d),this.logger=a.createLogger(n,{logLevel:"always",donotRotate:!0,donotUseFormatters:!0,hidden:!0}),this._offset=0}append(e){this.write(e),this.update(bs.Append,void 0,this.isVisible())}replace(e){const t=this._offset;this.write(e),this.update(bs.Replace,t,!0)}write(e){this._offset+=De.fromString(e).byteLength,this.logger.info(e),this.isVisible()&&this.logger.flush()}};e0=T([v(4,at),v(5,_i),v(6,Is),v(7,ze),v(8,Zw)],e0);let t0=class extends ne{constructor(e,t,i,n,s,o){super(),this.instantiationService=s,this.fileService=o,this._onDispose=this._register(new A),this.onDispose=this._onDispose.event,this.outputChannelModel=this.createOutputChannelModel(e,t,i,n)}async createOutputChannelModel(e,t,i,n){const s=await n,o=pt(s,`${e.replace(/[\\/:\*\?"<>\|]/g,"")}.log`);await this.fileService.createFile(o);const a=this._register(this.instantiationService.createInstance(e0,e,t,i,o));return this._register(a.onDispose(()=>this._onDispose.fire())),a}append(e){this.outputChannelModel.then(t=>t.append(e))}update(e,t,i){this.outputChannelModel.then(n=>n.update(e,t,i))}loadModel(){return this.outputChannelModel.then(e=>e.loadModel())}clear(){this.outputChannelModel.then(e=>e.clear())}replace(e){this.outputChannelModel.then(t=>t.replace(e))}};t0=T([v(4,Te),v(5,at)],t0);const p$=re("outputChannelModelService");let i0=class{constructor(e,t,i){this.fileService=e,this.instantiationService=t,this._outputDir=null,this.outputLocation=pt(i.windowLogsPath,`output_${J3(new Date).replace(/-|:|\.\d+Z$/g,"")}`)}createOutputChannelModel(e,t,i,n){return n?this.instantiationService.createInstance($E,t,i,n):this.instantiationService.createInstance(t0,e,t,i,this.outputDir)}get outputDir(){return this._outputDir||(this._outputDir=this.fileService.createFolder(this.outputLocation).then(()=>this.outputLocation)),this._outputDir}};i0=T([v(0,at),v(1,Te),v(2,Ar)],i0);const FR="output.activechannel";let n0=class extends ne{constructor(e,t,i){super(),this.outputChannelDescriptor=e,this.scrollLock=!1,this.id=e.id,this.label=e.label,this.uri=k.from({scheme:V3,path:this.id}),this.model=this._register(t.createOutputChannelModel(this.id,this.uri,e.languageId?i.createById(e.languageId):i.createByMimeType(e.log?u$:l$),e.file))}append(e){this.model.append(e)}update(e,t){this.model.update(e,t,!0)}clear(){this.model.clear()}replace(e){this.model.replace(e)}};n0=T([v(1,p$),v(2,ji)],n0);let r0=class extends ne{constructor(e,t,i,n,s,o,a){super(),this.storageService=e,this.instantiationService=t,this.logService=n,this.lifecycleService=s,this.viewsService=o,this.channels=new Map,this._onActiveOutputChannel=this._register(new A),this.onActiveOutputChannel=this._onActiveOutputChannel.event,this.activeChannelIdInStorage=this.storageService.get(FR,1,""),this.activeOutputChannelContext=Y3.bindTo(a),this.activeOutputChannelContext.set(this.activeChannelIdInStorage),this._register(this.onActiveOutputChannel(d=>this.activeOutputChannelContext.set(d))),this.activeLogOutputChannelContext=K3.bindTo(a),i.registerTextModelContentProvider(V3,this),t.createInstance(NE);const c=st.as(cl.OutputChannels);for(const d of c.getChannels())this.onDidRegisterChannel(d.id);if(this._register(c.onDidRegisterChannel(this.onDidRegisterChannel,this)),!this.activeChannel){const d=this.getChannelDescriptors();this.setActiveChannel(d&&d.length>0?this.getChannel(d[0].id):void 0)}this._register(F.filter(this.viewsService.onDidChangeViewVisibility,d=>d.id===Xn&&d.visible)(()=>{var d;this.activeChannel&&((d=this.viewsService.getActiveViewWithId(Xn))==null||d.showChannel(this.activeChannel,!0))})),this._register(this.lifecycleService.onDidShutdown(()=>this.dispose()))}provideTextContent(e){const t=this.getChannel(e.path);return t?t.model.loadModel():null}async showChannel(e,t){var s;const i=this.getChannel(e);((s=this.activeChannel)==null?void 0:s.id)!==(i==null?void 0:i.id)&&(this.setActiveChannel(i),this._onActiveOutputChannel.fire(e));const n=await this.viewsService.openView(Xn,!t);n&&i&&n.showChannel(i,!!t)}getChannel(e){return this.channels.get(e)}getChannelDescriptor(e){return st.as(cl.OutputChannels).getChannel(e)}getChannelDescriptors(){return st.as(cl.OutputChannels).getChannels()}getActiveChannel(){return this.activeChannel}async onDidRegisterChannel(e){const t=this.createChannel(e);if(this.channels.set(e,t),!this.activeChannel||this.activeChannelIdInStorage===e){this.setActiveChannel(t),this._onActiveOutputChannel.fire(e);const i=this.viewsService.getActiveViewWithId(Xn);i==null||i.showChannel(t,!0)}}createChannel(e){const t=[],i=this.instantiateChannel(e);return i.model.onDispose(()=>{if(this.activeChannel===i){const n=this.getChannelDescriptors(),s=n.length?this.getChannel(n[0].id):void 0;s&&this.viewsService.isViewVisible(Xn)?this.showChannel(s.id):this.setActiveChannel(void 0)}st.as(cl.OutputChannels).removeChannel(e),vt(t)},t),i}instantiateChannel(e){const t=st.as(cl.OutputChannels).getChannel(e);if(!t)throw this.logService.error(`Channel '${e}' is not registered yet`),new Error(`Channel '${e}' is not registered yet`);return this.instantiationService.createInstance(n0,t)}setActiveChannel(e){var t,i;this.activeChannel=e,this.activeLogOutputChannelContext.set(!!((t=e==null?void 0:e.outputChannelDescriptor)!=null&&t.file)&&((i=e==null?void 0:e.outputChannelDescriptor)==null?void 0:i.log)),this.activeChannel?this.storageService.store(FR,this.activeChannel.id,1,1):this.storageService.remove(FR,1)}};r0=T([v(0,ri),v(1,Te),v(2,or),v(3,ze),v(4,ea),v(5,ko),v(6,It)],r0);let s0=class{constructor(e,t,i){this.outputService=e,this.outputChannelModelService=t,this.languageService=i,this.channelModels=new Map}provideTextContent(e){if(e.scheme===h$){const t=this.getChannelModel(e);if(t)return t.loadModel()}return null}getChannelModel(e){const t=e.path;let i=this.channelModels.get(t);if(!i){const n=[],s=this.outputService.getChannelDescriptors().filter(({id:o})=>o===t)[0];s&&s.file&&(i=this.outputChannelModelService.createOutputChannelModel(t,e,s.languageId?this.languageService.createById(s.languageId):this.languageService.createByMimeType(s.log?u$:l$),s.file),i.onDispose(()=>vt(n),n),this.channelModels.set(t,i))}return i}};s0=T([v(0,da),v(1,p$),v(2,ji)],s0);async function Xde(r,e,t){let i=t&&t.get("storage.serviceMachineId",-1)||null;if(i)return i;try{const s=(await e.readFile(r.serviceMachineIdResource)).value.toString();i=LQ(s)?s:null}catch{i=null}if(!i){i=Nn();try{await e.writeFile(r.serviceMachineIdResource,De.fromString(i))}catch{}}return t==null||t.store("storage.serviceMachineId",i,-1,1),i}const Jde="web-extension-resource",g$=re("extensionResourceLoaderService");class Zde{constructor(e,t,i,n,s){this._fileService=e,this._storageService=t,this._productService=i,this._environmentService=n,this._configurationService=s,this._webExtensionResourceEndPoint=`${xq(i)}/${Jde}/`,i.extensionsGallery&&(this._extensionGalleryResourceUrlTemplate=i.extensionsGallery.resourceUrlTemplate,this._extensionGalleryAuthority=this._extensionGalleryResourceUrlTemplate?this._getExtensionGalleryAuthority(k.parse(this._extensionGalleryResourceUrlTemplate)):void 0)}get supportsExtensionGalleryResources(){return this._extensionGalleryResourceUrlTemplate!==void 0}getExtensionGalleryResourceURL({publisher:e,name:t,version:i,targetPlatform:n},s){if(this._extensionGalleryResourceUrlTemplate){const o=k.parse(SP(this._extensionGalleryResourceUrlTemplate,{publisher:e,name:t,version:n!==void 0&&n!=="undefined"&&n!=="unknown"&&n!=="universal"?`${i}+${n}`:i,path:"extension"}));return this._isWebExtensionResourceEndPoint(o)?o.with({scheme:FQ.getPreferredWebSchema()}):o}}isExtensionGalleryResource(e){return!!this._extensionGalleryAuthority&&this._extensionGalleryAuthority===this._getExtensionGalleryAuthority(e)}async getExtensionGalleryRequestHeaders(){const e={"X-Client-Name":`${this._productService.applicationName}${ln?"-web":""}`,"X-Client-Version":this._productService.version};return bS(this._productService,this._environmentService)&&gte(this._configurationService)===3&&(e["X-Machine-Id"]=await this._getServiceMachineId()),this._productService.commit&&(e["X-Client-Commit"]=this._productService.commit),e}_getServiceMachineId(){return this._serviceMachineIdPromise||(this._serviceMachineIdPromise=Xde(this._environmentService,this._fileService,this._storageService)),this._serviceMachineIdPromise}_getExtensionGalleryAuthority(e){if(this._isWebExtensionResourceEndPoint(e))return e.authority;const t=e.authority.indexOf(".");return t!==-1?e.authority.substring(t+1):void 0}_isWebExtensionResourceEndPoint(e){return e.path.startsWith(this._webExtensionResourceEndPoint)}}const Z3=re("hoverService"),z_="workbench.view.explorer",Qs="workbench.explorer.fileView",ele=new G("explorerViewletVisible",!0,{type:"boolean",description:p("explorerViewletVisible","True when the EXPLORER viewlet is visible.")}),m$=new G("foldersViewVisible",!0,{type:"boolean",description:p("foldersViewVisible","True when the FOLDERS view (the file tree within the explorer view container) is visible.")}),tle=new G("explorerResourceIsFolder",!1,{type:"boolean",description:p("explorerResourceIsFolder","True when the focused item in the EXPLORER is a folder.")}),e4=new G("explorerResourceReadonly",!1,{type:"boolean",description:p("explorerResourceReadonly","True when the focused item in the EXPLORER is read-only.")}),t4=e4.toNegated(),ile=new G("explorerResourceAvailableEditorIds",""),nle=new G("explorerResourceIsRoot",!1,{type:"boolean",description:p("explorerResourceIsRoot","True when the focused item in the EXPLORER is a root folder.")}),rle=new G("explorerResourceCut",!1,{type:"boolean",description:p("explorerResourceCut","True when an item in the EXPLORER has been cut for cut and paste.")}),sle=new G("explorerResourceMoveableToTrash",!1,{type:"boolean",description:p("explorerResourceMoveableToTrash","True when the focused item in the EXPLORER can be moved to trash.")}),i4=new G("filesExplorerFocus",!0,{type:"boolean",description:p("filesExplorerFocus","True when the focus is inside the EXPLORER view.")}),ole=new G("openEditorsFocus",!0,{type:"boolean",description:p("openEditorsFocus","True when the focus is inside the OPEN EDITORS view.")}),v$=new G("explorerViewletFocus",!0,{type:"boolean",description:p("explorerViewletFocus","True when the focus is inside the EXPLORER viewlet.")}),ale=new G("explorerViewletCompressedFocus",!0,{type:"boolean",description:p("explorerViewletCompressedFocus","True when the focused item in the EXPLORER view is a compact item.")}),cle=new G("explorerViewletCompressedFirstFocus",!0,{type:"boolean",description:p("explorerViewletCompressedFirstFocus","True when the focus is inside a compact item's first part in the EXPLORER view.")}),dle=new G("explorerViewletCompressedLastFocus",!0,{type:"boolean",description:p("explorerViewletCompressedLastFocus","True when the focus is inside a compact item's last part in the EXPLORER view.")}),lle=new G("viewHasSomeCollapsibleItem",!1,{type:"boolean",description:p("viewHasSomeCollapsibleItem","True when a workspace in the EXPLORER view has some collapsible root child.")}),lRe=nt.and(m$,i4,nt.not(Dq)),uRe=nt.and(m$,v$,nt.not(Dq)),hRe="workbench.editors.files.textFileEditor",fRe="workbench.editors.files.fileEditorInput",pRe="workbench.editors.files.binaryFileEditor",gRe="code-text-binary";let dB=class TS extends ne{constructor(e,t,i,n){super(),this.textFileService=e,this.fileService=t,this.languageService=i,this.modelService=n,this.fileWatcherDisposable=this._register(new Hr)}static async open(e,t,i,n,s){await n.openEditor({original:{resource:TS.resourceToTextFile(t,e)},modified:{resource:e},label:i,options:s})}static resourceToTextFile(e,t){return t.with({scheme:e,query:JSON.stringify({scheme:t.scheme,query:t.query})})}static textFileToResource(e){const{scheme:t,query:i}=JSON.parse(e.query);return e.with({scheme:t,query:i})}async provideTextContent(e){if(!e.query)return null;const t=TS.textFileToResource(e),i=await this.resolveEditorModel(e);return this.fileWatcherDisposable.value||(this.fileWatcherDisposable.value=this.fileService.onDidFilesChange(n=>{n.contains(t,0)&&this.resolveEditorModel(e,!1)}),i&&eb(i.onWillDispose)(()=>this.fileWatcherDisposable.clear())),i}async resolveEditorModel(e,t=!0){const i=TS.textFileToResource(e),n=await this.textFileService.readStream(i);let s=this.modelService.getModel(e);if(s)this.modelService.updateModel(s,n.value);else if(t){const o=this.modelService.getModel(i);let a;o?a=this.languageService.createById(o.getLanguageId()):a=this.languageService.createByFilepathOrFirstLine(i),s=this.modelService.createModel(n.value,a,e)}return s}};dB=T([v(0,Dn),v(1,at),v(2,ji),v(3,_i)],dB);class rn{constructor(e,t){this._editor=e,this._group=t,this.id=rn.COUNTER++}get editor(){return this._editor}get group(){return this._group}get groupId(){return this._group.id}getId(){return`openeditor:${this.groupId}:${this.id}`}isPreview(){return!this._group.isPinned(this.editor)}isSticky(){return this._group.isSticky(this.editor)}getResource(){return Vn.getOriginalUri(this.editor,{supportSideBySide:Ui.PRIMARY})}}rn.COUNTER=0;class ule{constructor(e){this.root=new WE;for(const[t,i]of e)for(const n of i)this.root.add(t,n)}toString(){return this.root.toString()}getAttributes(e,t){const i=e.lastIndexOf(".");return i<1?{dirname:t,basename:e,extname:""}:{dirname:t,basename:e.substring(0,i),extname:e.substring(i+1)}}nest(e,t){const i=new WE;for(const o of e){const a=this.getAttributes(o,t),c=this.root.get(o,a);for(const d of c)i.add(d,o)}const n=(o,a=new Set)=>{if(a.has(o))return[];a.add(o);const c=this.getAttributes(o,t),d=i.get(o,c);return d.length===0?[o]:d.length===1&&d[0]===o?[o]:d.flatMap(l=>n(l,a))},s=new Map;for(const o of e){let a=n(o);a.length===0&&(a=[o]);for(const c of a){let d=s.get(c);d||s.set(c,d=new Set),o!==c&&d.add(o)}}return s}}class WE{constructor(){this.value=new y$,this.map=new Map}add(e,t){if(e==="")this.value.add(e,t);else if(e[0]==="*")this.value.add(e,t);else{const i=e[0],n=e.slice(1);let s=this.map.get(i);s||this.map.set(i,s=new WE),s.add(n,t)}}get(e,t){const i=[];i.push(...this.value.get(e,t));const n=e[0],s=e.slice(1),o=this.map.get(n);return o&&i.push(...o.get(s,t)),i}toString(e=""){const t=[];return this.value.hasItems&&t.push(`* => 
`+this.value.toString(e+"  ")),t.map(i=>e+i).join(`
`)}}class y${constructor(){this.star=[],this.epsilon=[],this.map=new Map,this.hasItems=!1}add(e,t){if(this.hasItems=!0,e==="*")this.star.push(new uB(t));else if(e==="")this.epsilon.push(new uB(t));else{const i=e[e.length-1],n=e.slice(0,e.length-1);if(i==="*")throw Error("Unexpected star in SufTrie key: "+e);{let s=this.map.get(i);s||this.map.set(i,s=new y$),s.add(n,t)}}}get(e,t){const i=[];e===""&&i.push(...this.epsilon.map(a=>a.substitute(t))),this.star.length&&i.push(...this.star.map(a=>a.substitute(t,e)));const n=e[e.length-1],s=e.slice(0,e.length-1),o=this.map.get(n);return o&&i.push(...o.get(s,t)),i}toString(e=""){const t=[];return this.star.length&&t.push("* => "+this.star.join("; ")),this.epsilon.length&&t.push("ε => "+this.epsilon.join("; ")),t.map(i=>e+i).join(`
`)}}const lB=/\$[({](capture|basename|dirname|extname)[)}]/g;class uB{constructor(e){this.tokens=[],lB.lastIndex=0;let t,i=0;for(;t=lB.exec(e);){const n=e.slice(i,t.index);this.tokens.push(n);const s=t[1];switch(s){case"basename":case"dirname":case"extname":case"capture":this.tokens.push({capture:s});break;default:throw Error("unknown substitution type: "+s)}i=t.index+t[0].length}if(i!==e.length){const n=e.slice(i,e.length);this.tokens.push(n)}}substitute(e,t){return this.tokens.map(i=>{if(typeof i=="string")return i;switch(i.capture){case"basename":return e.basename;case"dirname":return e.dirname;case"extname":return e.extname;case"capture":return t||""}}).join("")}}class mRe{constructor(e,t,i,n,s){this.contextService=e,this.uriIdentityService=t,this._onDidChangeRoots=new A;const o=()=>this._roots=this.contextService.getWorkspace().folders.map(a=>new hn(a.uri,i,n,s,void 0,!0,!1,!1,!1,a.name));o(),this._listener=this.contextService.onDidChangeWorkspaceFolders(()=>{o(),this._onDidChangeRoots.fire()})}get roots(){return this._roots}get onDidChangeRoots(){return this._onDidChangeRoots.event}findAll(e){return fi(this.roots.map(t=>t.find(e)))}findClosest(e){const t=this.contextService.getWorkspaceFolder(e);if(t){const i=this.roots.find(n=>this.uriIdentityService.extUri.isEqual(n.resource,t.uri));if(i)return i.find(e)}return null}dispose(){vt(this._listener)}}class hn{constructor(e,t,i,n,s,o,a,c,d,l=Xc(e),u,h=!1){this.resource=e,this.fileService=t,this.configService=i,this.filesConfigService=n,this._parent=s,this._isDirectory=o,this._isSymbolicLink=a,this._readonly=c,this._locked=d,this._name=l,this._mtime=u,this._unknown=h,this.error=void 0,this._isExcluded=!1,this._isDirectoryResolved=!1}get isExcluded(){return this._isExcluded?!0:this._parent?this._parent.isExcluded:!1}set isExcluded(e){this._isExcluded=e}hasChildren(e){var t;return this.hasNests?((t=this.nestedChildren)==null?void 0:t.some(i=>e(i)))??!1:this.isDirectory}get hasNests(){var e;return!!((e=this.nestedChildren)!=null&&e.length)}get isDirectoryResolved(){return this._isDirectoryResolved}get isSymbolicLink(){return!!this._isSymbolicLink}get isDirectory(){return!!this._isDirectory}get isReadonly(){return this.filesConfigService.isReadonly(this.resource,{resource:this.resource,name:this.name,readonly:this._readonly,locked:this._locked})}get mtime(){return this._mtime}get name(){return this._name}get isUnknown(){return this._unknown}get parent(){return this._parent}get root(){return this._parent?this._parent.root:this}get children(){return new Map}updateName(e){var t,i;(t=this._parent)==null||t.removeChild(this),this._name=e,(i=this._parent)==null||i.addChild(this)}getId(){return this.root.resource.toString()+"::"+this.resource.toString()}toString(){return`ExplorerItem: ${this.name}`}get isRoot(){return this===this.root}static create(e,t,i,n,s,o){const a=new hn(n.resource,e,t,i,s,n.isDirectory,n.isSymbolicLink,n.readonly,n.locked,n.name,n.mtime,!n.isFile&&!n.isDirectory);if(a.isDirectory&&(a._isDirectoryResolved=!!n.children||!!o&&o.some(c=>Ff(c,a.resource)),n.children))for(let c=0,d=n.children.length;c<d;c++){const l=hn.create(e,t,i,n.children[c],a,o);a.addChild(l)}return a}static mergeLocalWithDisk(e,t){if(e.resource.toString()!==t.resource.toString())return;const i=e.isDirectory||t.isDirectory;if(!(i&&t._isDirectoryResolved&&!e._isDirectoryResolved)&&(t.resource=e.resource,t.isRoot||t.updateName(e.name),t._isDirectory=e.isDirectory,t._mtime=e.mtime,t._isDirectoryResolved=e._isDirectoryResolved,t._isSymbolicLink=e.isSymbolicLink,t.error=e.error,i&&e._isDirectoryResolved)){const n=new ki;t.children.forEach(s=>{n.set(s.resource,s)}),t.children.clear(),e.children.forEach(s=>{const o=n.get(s.resource);o?(hn.mergeLocalWithDisk(s,o),t.addChild(o),n.delete(s.resource)):t.addChild(s)}),n.forEach(s=>{s instanceof jT&&t.addChild(s)})}}addChild(e){e._parent=this,e.updateResource(!1),this.children.set(this.getPlatformAwareName(e.name),e)}getChild(e){return this.children.get(this.getPlatformAwareName(e))}fetchChildren(e){const t=this.configService.getValue({resource:this.root.resource}).explorer.fileNesting;return t.enabled&&this.nestedChildren?this.nestedChildren:(async()=>{if(!this._isDirectoryResolved){const n=e==="modified";this.error=void 0;try{const s=await this.fileService.resolve(this.resource,{resolveSingleChildDescendants:!0,resolveMetadata:n}),o=hn.create(this.fileService,this.configService,this.filesConfigService,s,this);hn.mergeLocalWithDisk(o,this)}catch(s){throw this.error=s,s}this._isDirectoryResolved=!0}const i=[];if(t.enabled){const n=[],s=[];for(const a of this.children.entries())a[1].nestedParent=void 0,a[1].isDirectory?s.push(a):n.push(a);const o=this.fileNester.nest(n.map(([a])=>a),this.getPlatformAwareName(this.name));for(const[a,c]of n){const d=o.get(a);if(d!==void 0){c.nestedChildren=[];for(const l of d.keys()){const u=Mi(this.children.get(l));c.nestedChildren.push(u),u.nestedParent=c}i.push(c)}else c.nestedChildren=void 0}for(const[a,c]of s.values())i.push(c)}else this.children.forEach(n=>{i.push(n)});return i})()}get fileNester(){if(!this.root._fileNester){const e=this.configService.getValue({resource:this.root.resource}).explorer.fileNesting,t=Object.entries(e.patterns).filter(i=>typeof i[0]=="string"&&typeof i[1]=="string"&&i[0]&&i[1]).map(([i,n])=>[this.getPlatformAwareName(i.trim()),n.split(",").map(s=>this.getPlatformAwareName(s.trim().replace(/\u200b/g,"").trim())).filter(s=>s!=="")]);this.root._fileNester=new ule(t)}return this.root._fileNester}removeChild(e){this.nestedChildren=void 0,this.children.delete(this.getPlatformAwareName(e.name))}forgetChildren(){this.children.clear(),this.nestedChildren=void 0,this._isDirectoryResolved=!1,this._fileNester=void 0}getPlatformAwareName(e){return this.fileService.hasCapability(this.resource,1024)?e:e.toLowerCase()}move(e){var t,i;(t=this.nestedParent)==null||t.removeChild(this),(i=this._parent)==null||i.removeChild(this),e.removeChild(this),e.addChild(this),this.updateResource(!0)}updateResource(e){this._parent&&(this.resource=pt(this._parent.resource,this.name)),e&&this.isDirectory&&this.children.forEach(t=>{t.updateResource(!0)})}rename(e){this.updateName(e.name),this._mtime=e.mtime,this.updateResource(!0)}find(e){const t=!this.fileService.hasCapability(e,1024);return e&&this.resource.scheme===e.scheme&&CP(this.resource.authority,e.authority)&&(t?OQ(e.path,this.resource.path):e.path.startsWith(this.resource.path))?this.findByPath(tf(e.path,Ho.sep),this.resource.path.length,t):null}findByPath(e,t,i){if(NQ(tf(this.resource.path,Ho.sep),e,i))return this;if(this.isDirectory){for(;t<e.length&&e[t]===Ho.sep;)t++;let n=e.indexOf(Ho.sep,t);n===-1&&(n=e.length);const s=e.substring(t,n),o=this.children.get(this.getPlatformAwareName(s));if(o)return o.findByPath(e,n,i)}return null}}hn.__decorator=T([xt],hn.prototype,"children",null);class jT extends hn{constructor(e,t,i,n,s){super(k.file(""),e,t,i,n,s),this._isDirectoryResolved=!0}}const mn=re("explorerService");function hle(r){const e=r.lastFocusedList;if((e==null?void 0:e.getHTMLElement())===document.activeElement){let t;if(e instanceof dk){const i=e.getFocusedElements();i.length&&(t=i[0])}else if(e instanceof kq){const i=e.getFocus();i.length&&(t=i[0])}return t}}function fle(r,e,t){if(k.isUri(r))return r;const i=hle(e);return i instanceof hn?i.resource:i instanceof rn?i.getResource():Vn.getOriginalUri(t.activeEditor,{supportSideBySide:Ui.PRIMARY})}function vRe(r,e,t,i){const n=e.lastFocusedList;if((n==null?void 0:n.getHTMLElement())===document.activeElement){if(n instanceof kq&&n.getFocus().every(o=>o instanceof hn)){const o=i.getContext(!0,!0);if(o.length)return o.map(a=>a.resource)}if(n instanceof dk){const o=fi(n.getSelectedElements().filter(l=>l instanceof rn).map(l=>l.getResource())),a=n.getFocusedElements(),c=a.length?a[0]:void 0;let d;if(k.isUri(r))d=r.toString();else if(c instanceof rn){const l=c.getResource();d=l?l.toString():void 0}if(o.some(l=>l.toString()===d))return o}}const s=fle(r,e,t);return s?[s]:[]}function yRe(r,e){const t=r.lastFocusedList;if((t==null?void 0:t.getHTMLElement())===document.activeElement&&t instanceof dk){const i=fi(t.getSelectedElements().filter(a=>a instanceof rn)),n=t.getFocusedElements(),s=n.length?n[0]:void 0;let o;return s instanceof rn&&(o=s),i.some(a=>a===o)?i:o?[o]:void 0}}const _$=re("IExtensionStorageService"),ple=/^extensionKeys\/([^.]+\..+)@(\d+\.\d+\.\d+(-.*)?)$/;let HE=class Hc extends ne{static toKey(e){return`extensionKeys/${m3(e.id)}@${e.version}`}static fromKey(e){const t=ple.exec(e);if(t&&t[1])return{id:t[1],version:t[2]}}static async removeOutdatedExtensionVersions(e,t){var s;const i=await e.getInstalled(),n=[];for(const[o,a]of Hc.readAllExtensionsWithKeysForSync(t)){const c=(s=i.find(d=>g3(d.identifier,{id:o})))==null?void 0:s.manifest.version;for(const d of a)c!==d&&n.push(Hc.toKey({id:o,version:d}))}for(const o of n)t.remove(o,0)}static readAllExtensionsWithKeysForSync(e){const t=new Map,i=e.keys(0,1);for(const n of i){const s=Hc.fromKey(n);if(s){let o=t.get(s.id.toLowerCase());o||t.set(s.id.toLowerCase(),o=[]),o.push(s.version)}}return t}constructor(e,t,i){super(),this.storageService=e,this.productService=t,this.logService=i,this._onDidChangeExtensionStorageToSync=this._register(new A),this.onDidChangeExtensionStorageToSync=this._onDidChangeExtensionStorageToSync.event,this.extensionsWithKeysForSync=Hc.readAllExtensionsWithKeysForSync(e),this._register(this.storageService.onDidChangeValue(n=>this.onDidChangeStorageValue(n)))}onDidChangeStorageValue(e){if(e.scope!==0)return;if(this.extensionsWithKeysForSync.has(e.key.toLowerCase())){this._onDidChangeExtensionStorageToSync.fire();return}const t=Hc.fromKey(e.key);if(t){if(this.storageService.get(e.key,0)===void 0)this.extensionsWithKeysForSync.delete(t.id.toLowerCase());else{let i=this.extensionsWithKeysForSync.get(t.id.toLowerCase());i||this.extensionsWithKeysForSync.set(t.id.toLowerCase(),i=[]),i.push(t.version),this._onDidChangeExtensionStorageToSync.fire()}return}}getExtensionId(e){if(Rt(e))return e;const t=e.manifest?e.manifest.publisher:e.publisher,i=e.manifest?e.manifest.name:e.name;return K1(t,i)}getExtensionState(e,t){const i=this.getExtensionId(e),n=this.getExtensionStateRaw(e,t);if(n)try{return JSON.parse(n)}catch(s){this.logService.error(`[mainThreadStorage] unexpected error parsing storage contents (extensionId: ${i}, global: ${t}): ${s}`)}}getExtensionStateRaw(e,t){const i=this.getExtensionId(e),n=this.storageService.get(i,t?0:1);return n&&(n==null?void 0:n.length)>Hc.LARGE_STATE_WARNING_THRESHOLD&&this.logService.warn(`[mainThreadStorage] large extension state detected (extensionId: ${i}, global: ${t}): ${n.length/1024}kb. Consider to use 'storageUri' or 'globalStorageUri' to store this data on disk instead.`),n}setExtensionState(e,t,i){const n=this.getExtensionId(e);t===void 0?this.storageService.remove(n,i?0:1):this.storageService.store(n,JSON.stringify(t),i?0:1,1)}setKeysForSync(e,t){this.storageService.store(Hc.toKey(e),JSON.stringify(t),0,1)}getKeysForSync(e){var s;const t=(s=this.productService.extensionSyncedKeys)==null?void 0:s[e.id.toLowerCase()],i=this.storageService.get(Hc.toKey(e),0),n=i?JSON.parse(i):void 0;return n&&t?Mf([...n,...t]):n||t}addToMigrationList(e,t){if(e!==t){const i=this.migrationList.filter(n=>!n.includes(e)&&!n.includes(t));i.push([e,t]),this.migrationList=i}}getSourceExtensionToMigrate(e){const t=this.migrationList.find(([,i])=>e===i);return t?t[0]:void 0}get migrationList(){const e=this.storageService.get("extensionStorage.migrationList",-1,"[]");try{const t=JSON.parse(e);if(Array.isArray(t))return t}catch{}return[]}set migrationList(e){e.length?this.storageService.store("extensionStorage.migrationList",JSON.stringify(e),-1,1):this.storageService.remove("extensionStorage.migrationList",-1)}};HE.LARGE_STATE_WARNING_THRESHOLD=512*1024;HE=T([v(0,ri),v(1,Rs),v(2,ze)],HE);function _Re(r){var e;return(e=r.tags.find(t=>t.startsWith("lp-")))==null?void 0:e.split("lp-")[1]}const n4=re("languagePackService");class gle{constructor(){this._renderedElements=new Map}getRenderedTreeElement(e){if(this._renderedElements.has(e))return this._renderedElements.get(e)}addRenderedTreeItemElement(e,t){this._renderedElements.set(e,t)}removeRenderedTreeItemElement(e){this._renderedElements.has(e)&&this._renderedElements.delete(e)}}const mle=re("treeViewsService"),vle=re("IEditorBreadcrumbsService");class wRe{constructor(){this._map=new Map}register(e,t){if(this._map.has(e))throw new Error(`group (${e}) has already a widget`);return this._map.set(e,t),{dispose:()=>this._map.delete(e)}}getWidget(e){return this._map.get(e)}}class ds{constructor(){}static _stub(e){return{bindTo(t){const i=new A,n=t.onDidChangeConfiguration(s=>{s.affectsConfiguration(e)&&i.fire(void 0)});return new class{constructor(){this.name=e,this.onDidChange=i.event}getValue(s){return s?t.getValue(e,s):t.getValue(e)}updateValue(s,o){return o?t.updateValue(e,s,o):t.updateValue(e,s)}dispose(){n.dispose(),i.dispose()}}}}}}ds.IsEnabled=ds._stub("breadcrumbs.enabled");ds.UseQuickPick=ds._stub("breadcrumbs.useQuickPick");ds.FilePath=ds._stub("breadcrumbs.filePath");ds.SymbolPath=ds._stub("breadcrumbs.symbolPath");ds.SymbolSortOrder=ds._stub("breadcrumbs.symbolSortOrder");ds.Icons=ds._stub("breadcrumbs.icons");ds.TitleScrollbarSizing=ds._stub("workbench.editor.titleScrollbarSizing");ds.FileExcludes=ds._stub("files.exclude");st.as(ks.Configuration).registerConfiguration({id:"breadcrumbs",title:p("title","Breadcrumb Navigation"),order:101,type:"object",properties:{"breadcrumbs.enabled":{description:p("enabled","Enable/disable navigation breadcrumbs."),type:"boolean",default:!0},"breadcrumbs.filePath":{description:p("filepath","Controls whether and how file paths are shown in the breadcrumbs view."),type:"string",default:"on",enum:["on","off","last"],enumDescriptions:[p("filepath.on","Show the file path in the breadcrumbs view."),p("filepath.off","Do not show the file path in the breadcrumbs view."),p("filepath.last","Only show the last element of the file path in the breadcrumbs view.")]},"breadcrumbs.symbolPath":{description:p("symbolpath","Controls whether and how symbols are shown in the breadcrumbs view."),type:"string",default:"on",enum:["on","off","last"],enumDescriptions:[p("symbolpath.on","Show all symbols in the breadcrumbs view."),p("symbolpath.off","Do not show symbols in the breadcrumbs view."),p("symbolpath.last","Only show the current symbol in the breadcrumbs view.")]},"breadcrumbs.symbolSortOrder":{description:p("symbolSortOrder","Controls how symbols are sorted in the breadcrumbs outline view."),type:"string",default:"position",scope:5,enum:["position","name","type"],enumDescriptions:[p("symbolSortOrder.position","Show symbol outline in file position order."),p("symbolSortOrder.name","Show symbol outline in alphabetical order."),p("symbolSortOrder.type","Show symbol outline in symbol type order.")]},"breadcrumbs.icons":{description:p("icons","Render breadcrumb items with icons."),type:"boolean",default:!0},"breadcrumbs.showFiles":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.file","When enabled breadcrumbs show `file`-symbols.")},"breadcrumbs.showModules":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.module","When enabled breadcrumbs show `module`-symbols.")},"breadcrumbs.showNamespaces":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.namespace","When enabled breadcrumbs show `namespace`-symbols.")},"breadcrumbs.showPackages":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.package","When enabled breadcrumbs show `package`-symbols.")},"breadcrumbs.showClasses":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.class","When enabled breadcrumbs show `class`-symbols.")},"breadcrumbs.showMethods":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.method","When enabled breadcrumbs show `method`-symbols.")},"breadcrumbs.showProperties":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.property","When enabled breadcrumbs show `property`-symbols.")},"breadcrumbs.showFields":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.field","When enabled breadcrumbs show `field`-symbols.")},"breadcrumbs.showConstructors":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.constructor","When enabled breadcrumbs show `constructor`-symbols.")},"breadcrumbs.showEnums":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.enum","When enabled breadcrumbs show `enum`-symbols.")},"breadcrumbs.showInterfaces":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.interface","When enabled breadcrumbs show `interface`-symbols.")},"breadcrumbs.showFunctions":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.function","When enabled breadcrumbs show `function`-symbols.")},"breadcrumbs.showVariables":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.variable","When enabled breadcrumbs show `variable`-symbols.")},"breadcrumbs.showConstants":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.constant","When enabled breadcrumbs show `constant`-symbols.")},"breadcrumbs.showStrings":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.string","When enabled breadcrumbs show `string`-symbols.")},"breadcrumbs.showNumbers":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.number","When enabled breadcrumbs show `number`-symbols.")},"breadcrumbs.showBooleans":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.boolean","When enabled breadcrumbs show `boolean`-symbols.")},"breadcrumbs.showArrays":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.array","When enabled breadcrumbs show `array`-symbols.")},"breadcrumbs.showObjects":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.object","When enabled breadcrumbs show `object`-symbols.")},"breadcrumbs.showKeys":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.key","When enabled breadcrumbs show `key`-symbols.")},"breadcrumbs.showNull":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.null","When enabled breadcrumbs show `null`-symbols.")},"breadcrumbs.showEnumMembers":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.enumMember","When enabled breadcrumbs show `enumMember`-symbols.")},"breadcrumbs.showStructs":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.struct","When enabled breadcrumbs show `struct`-symbols.")},"breadcrumbs.showEvents":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.event","When enabled breadcrumbs show `event`-symbols.")},"breadcrumbs.showOperators":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.operator","When enabled breadcrumbs show `operator`-symbols.")},"breadcrumbs.showTypeParameters":{type:"boolean",default:!0,scope:5,markdownDescription:p("filteredTypes.typeParameter","When enabled breadcrumbs show `typeParameter`-symbols.")}}});const r4=re("ISemanticSimilarityService");let o0=class s4{constructor(e){this.logService=e,this._providers=[]}isEnabled(){return this._providers.length>0}registerSemanticSimilarityProvider(e){return this._providers.push(e),{dispose:()=>{const t=this._providers.indexOf(e);t>=0&&this._providers.splice(t,1)}}}async getSimilarityScore(e,t,i){if(this._providers.length===0)throw new Error("No semantic similarity providers registered");const n=Tr.create(),s=[],o=zs(s4.DEFAULT_TIMEOUT),a=i.onCancellationRequested(()=>{a.dispose(),o.cancel()});for(const c of this._providers)s.push(cd(async d=>{try{return await c.provideSimilarityScore(e,t,d)}catch{}throw await o,new Error("Semantic similarity provider timed out")}));s.push(cd(async c=>{const d=c.onCancellationRequested(()=>{o.cancel(),d.dispose()});throw await o,new Error("Semantic similarity provider timed out")}));try{return await $Q(s)}finally{n.stop(),this.logService.trace(`[SemanticSimilarityService]: getSimilarityScore took ${n.elapsed()}ms`)}}};o0.DEFAULT_TIMEOUT=1e3*10;o0=T([v(0,ze)],o0);const yle=re("IOutlineService"),_le={Uninitialized:{type:"uninitialized"},Idle:(r,e)=>({type:"idle",updateType:r,error:e}),CheckingForUpdates:r=>({type:"checking for updates",explicit:r}),AvailableForDownload:r=>({type:"available for download",update:r}),Downloading:r=>({type:"downloading",update:r}),Downloaded:r=>({type:"downloaded",update:r}),Updating:r=>({type:"updating",update:r}),Ready:r=>({type:"ready",update:r})},wle=re("updateService"),o4=re("statusbarService");function ble(r){const e=r;return typeof(e==null?void 0:e.id)=="string"&&typeof e.alignment=="number"}function bRe(r){const e=r;return(typeof(e==null?void 0:e.primary)=="number"||ble(e==null?void 0:e.primary))&&typeof(e==null?void 0:e.secondary)=="number"}const SRe={id:"statusBar.entry.showTooltip",title:""},BT=re("terminalService"),a4=re("terminalEditorService"),c4=re("terminalGroupService"),d4=re("terminalInstanceService"),hB="terminalEditor",CRe="terminal",ERe=["workbench.action.terminal.toggleTerminal","workbench.action.terminal.new","workbench.action.togglePanel","workbench.action.terminal.focus"],xRe={BLOCK:"block",LINE:"line",UNDERLINE:"underline"},DRe="terminal.integrated",kRe=0,TRe=-5,IRe=1,RRe=1,PRe=1e3,ARe="normal",MRe="bold",LRe=["normal","bold","100","200","300","400","500","600","700","800","900"],w$=re("terminalProfileResolverService"),l4=re("terminalProfileService"),FRe=["vim","vi","nano","tmux"],ORe=["workbench.action.terminal.clearSelection","workbench.action.terminal.clear","workbench.action.terminal.copyAndClearSelection","workbench.action.terminal.copySelection","workbench.action.terminal.copySelectionAsHtml","workbench.action.terminal.copyLastCommandOutput","workbench.action.terminal.deleteToLineStart","workbench.action.terminal.deleteWordLeft","workbench.action.terminal.deleteWordRight","workbench.action.terminal.focusFind","workbench.action.terminal.hideFind","workbench.action.terminal.findNext","workbench.action.terminal.findPrevious","workbench.action.terminal.goToRecentDirectory","workbench.action.terminal.toggleFindRegex","workbench.action.terminal.toggleFindWholeWord","workbench.action.terminal.toggleFindCaseSensitive","workbench.action.terminal.focusNextPane","workbench.action.terminal.focusNext","workbench.action.terminal.focusPreviousPane","workbench.action.terminal.focusPrevious","workbench.action.terminal.focus","workbench.action.terminal.sizeToContentWidth","workbench.action.terminal.kill","workbench.action.terminal.killEditor","workbench.action.terminal.moveToEditor","workbench.action.terminal.moveToLineEnd","workbench.action.terminal.moveToLineStart","workbench.action.terminal.moveToTerminalPanel","workbench.action.terminal.newInActiveWorkspace","workbench.action.terminal.new","workbench.action.terminal.paste","workbench.action.terminal.pasteSelection","workbench.action.terminal.resizePaneDown","workbench.action.terminal.resizePaneLeft","workbench.action.terminal.resizePaneRight","workbench.action.terminal.resizePaneUp","workbench.action.terminal.runActiveFile","workbench.action.terminal.runSelectedText","workbench.action.terminal.runRecentCommand","workbench.action.terminal.scrollDown","workbench.action.terminal.scrollDownPage","workbench.action.terminal.scrollToBottom","workbench.action.terminal.scrollToNextCommand","workbench.action.terminal.scrollToPreviousCommand","workbench.action.terminal.scrollToTop","workbench.action.terminal.scrollUp","workbench.action.terminal.scrollUpPage","workbench.action.terminal.sendSequence","workbench.action.terminal.selectAll","workbench.action.terminal.selectToNextCommand","workbench.action.terminal.selectToNextLine","workbench.action.terminal.selectToPreviousCommand","workbench.action.terminal.selectToPreviousLine","workbench.action.terminal.splitInActiveWorkspace","workbench.action.terminal.split","workbench.action.terminal.toggleTerminal","workbench.action.terminal.selectPrevSuggestion","workbench.action.terminal.selectPrevPageSuggestion","workbench.action.terminal.selectNextSuggestion","workbench.action.terminal.selectNextPageSuggestion","workbench.action.terminal.acceptSelectedSuggestion","workbench.action.terminal.hideSuggestWidget","workbench.action.terminal.focusHover","editor.action.accessibilityHelp","editor.action.toggleTabFocusMode","notifications.hideList","notifications.hideToasts","workbench.action.closeQuickOpen","workbench.action.quickOpen","workbench.action.quickOpenPreviousEditor","workbench.action.showCommands","workbench.action.tasks.build","workbench.action.tasks.restartTask","workbench.action.tasks.runTask","workbench.action.tasks.reRunTask","workbench.action.tasks.showLog","workbench.action.tasks.showTasks","workbench.action.tasks.terminate","workbench.action.tasks.test","workbench.action.toggleFullScreen","workbench.action.terminal.focusAtIndex1","workbench.action.terminal.focusAtIndex2","workbench.action.terminal.focusAtIndex3","workbench.action.terminal.focusAtIndex4","workbench.action.terminal.focusAtIndex5","workbench.action.terminal.focusAtIndex6","workbench.action.terminal.focusAtIndex7","workbench.action.terminal.focusAtIndex8","workbench.action.terminal.focusAtIndex9","workbench.action.focusSecondEditorGroup","workbench.action.focusThirdEditorGroup","workbench.action.focusFourthEditorGroup","workbench.action.focusFifthEditorGroup","workbench.action.focusSixthEditorGroup","workbench.action.focusSeventhEditorGroup","workbench.action.focusEighthEditorGroup","workbench.action.focusNextPart","workbench.action.focusPreviousPart","workbench.action.nextPanelView","workbench.action.previousPanelView","workbench.action.nextSideBarView","workbench.action.previousSideBarView","workbench.action.debug.start","workbench.action.debug.stop","workbench.action.debug.run","workbench.action.debug.restart","workbench.action.debug.continue","workbench.action.debug.pause","workbench.action.debug.stepInto","workbench.action.debug.stepOut","workbench.action.debug.stepOver","workbench.action.nextEditor","workbench.action.previousEditor","workbench.action.nextEditorInGroup","workbench.action.previousEditorInGroup","workbench.action.openNextRecentlyUsedEditor","workbench.action.openPreviousRecentlyUsedEditor","workbench.action.openNextRecentlyUsedEditorInGroup","workbench.action.openPreviousRecentlyUsedEditorInGroup","workbench.action.quickOpenPreviousRecentlyUsedEditor","workbench.action.quickOpenLeastRecentlyUsedEditor","workbench.action.quickOpenPreviousRecentlyUsedEditorInGroup","workbench.action.quickOpenLeastRecentlyUsedEditorInGroup","workbench.action.focusActiveEditorGroup","workbench.action.focusFirstEditorGroup","workbench.action.focusLastEditorGroup","workbench.action.firstEditorInGroup","workbench.action.lastEditorInGroup","workbench.action.navigateUp","workbench.action.navigateDown","workbench.action.navigateRight","workbench.action.navigateLeft","workbench.action.togglePanel","workbench.action.quickOpenView","workbench.action.toggleMaximizedPanel","notification.acceptPrimaryAction","runCommands"],Sle={extensionPoint:"terminal",defaultExtensionKind:["workspace"],activationEventsGenerator:(r,e)=>{for(const t of r)for(const i of t.profiles??[])e.push(`onTerminalProfile:${i.id}`)},jsonSchema:{description:p("vscode.extension.contributes.terminal","Contributes terminal functionality."),type:"object",properties:{profiles:{type:"array",description:p("vscode.extension.contributes.terminal.profiles","Defines additional terminal profiles that the user can create."),items:{type:"object",required:["id","title"],defaultSnippets:[{body:{id:"$1",title:"$2"}}],properties:{id:{description:p("vscode.extension.contributes.terminal.profiles.id","The ID of the terminal profile provider."),type:"string"},title:{description:p("vscode.extension.contributes.terminal.profiles.title","Title for this terminal profile."),type:"string"},icon:{description:p("vscode.extension.contributes.terminal.types.icon","A codicon, URI, or light and dark URIs to associate with this terminal type."),anyOf:[{type:"string"},{type:"object",properties:{light:{description:p("vscode.extension.contributes.terminal.types.icon.light","Icon path when a light theme is used"),type:"string"},dark:{description:p("vscode.extension.contributes.terminal.types.icon.dark","Icon path when a dark theme is used"),type:"string"}}}]}}}}}}},NRe=new G("terminalTabFocusMode",!1,!0);var fB;(function(r){r[r.Api=0]="Api",r[r.Process=1]="Process",r[r.Sequence=2]="Sequence",r[r.Config=3]="Config"})(fB||(fB={}));var om;(function(r){r[r.Panel=1]="Panel",r[r.Editor=2]="Editor"})(om||(om={}));var $h;(function(r){r[r.Unknown=0]="Unknown",r[r.Shutdown=1]="Shutdown",r[r.Process=2]="Process",r[r.User=3]="User",r[r.Extension=4]="Extension"})($h||($h={}));const Cle={Backend:"workbench.contributions.terminal.processBackend"};class Ele{constructor(){this._backends=new Map}get backends(){return this._backends}registerTerminalBackend(e){const t=this._sanitizeRemoteAuthority(e.remoteAuthority);if(this._backends.has(t))throw new Error(`A terminal backend with remote authority '${t}' was already registered.`);this._backends.set(t,e)}getTerminalBackend(e){return this._backends.get(this._sanitizeRemoteAuthority(e))}_sanitizeRemoteAuthority(e){return(e==null?void 0:e.toLowerCase())??""}}st.add(Cle.Backend,new Ele);const xle=re("terminalLogService"),am=Object.freeze({authGetSessions:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authGetSessions.d.ts",authSession:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authSession.d.ts",canonicalUriProvider:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.canonicalUriProvider.d.ts",codiconDecoration:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codiconDecoration.d.ts",commentsDraftState:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentsDraftState.d.ts",contribCommentEditorActionsMenu:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentEditorActionsMenu.d.ts",contribCommentPeekContext:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentPeekContext.d.ts",contribCommentThreadAdditionalMenu:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentThreadAdditionalMenu.d.ts",contribEditSessions:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditSessions.d.ts",contribEditorContentMenu:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditorContentMenu.d.ts",contribLabelFormatterWorkspaceTooltip:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLabelFormatterWorkspaceTooltip.d.ts",contribMenuBarHome:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMenuBarHome.d.ts",contribMergeEditorMenus:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMergeEditorMenus.d.ts",contribNotebookStaticPreloads:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribNotebookStaticPreloads.d.ts",contribRemoteHelp:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribRemoteHelp.d.ts",contribShareMenu:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribShareMenu.d.ts",contribStatusBarItems:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribStatusBarItems.d.ts",contribViewsRemote:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsRemote.d.ts",contribViewsWelcome:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsWelcome.d.ts",customEditorMove:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.customEditorMove.d.ts",debugFocus:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.debugFocus.d.ts",diffCommand:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffCommand.d.ts",diffContentOptions:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffContentOptions.d.ts",documentFiltersExclusive:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentFiltersExclusive.d.ts",documentPaste:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentPaste.d.ts",dropMetadata:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.dropMetadata.d.ts",editSessionIdentityProvider:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editSessionIdentityProvider.d.ts",editorInsets:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorInsets.d.ts",envCollectionOptions:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.envCollectionOptions.d.ts",envCollectionWorkspace:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.envCollectionWorkspace.d.ts",envShellEvent:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.envShellEvent.d.ts",extensionRuntime:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionRuntime.d.ts",extensionsAny:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionsAny.d.ts",externalUriOpener:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.externalUriOpener.d.ts",fileComments:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileComments.d.ts",fileSearchProvider:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider.d.ts",findTextInFiles:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles.d.ts",formatMultipleRanges:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.formatMultipleRanges.d.ts",fsChunks:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fsChunks.d.ts",handleIssueUri:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.handleIssueUri.d.ts",idToken:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.idToken.d.ts",indentSize:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.indentSize.d.ts",inlineCompletionsAdditions:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts",interactive:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactive.d.ts",interactiveSlashCommands:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveSlashCommands.d.ts",interactiveUserActions:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveUserActions.d.ts",interactiveWindow:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveWindow.d.ts",ipc:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.ipc.d.ts",notebookCellExecutionState:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecutionState.d.ts",notebookCodeActions:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCodeActions.d.ts",notebookControllerAffinityHidden:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookControllerAffinityHidden.d.ts",notebookDeprecated:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookDeprecated.d.ts",notebookExecution:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookExecution.d.ts",notebookKernelSource:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookKernelSource.d.ts",notebookLiveShare:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookLiveShare.d.ts",notebookMessaging:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMessaging.d.ts",notebookMime:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMime.d.ts",portsAttributes:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.portsAttributes.d.ts",profileContentHandlers:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.profileContentHandlers.d.ts",quickDiffProvider:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickDiffProvider.d.ts",quickPickItemIcon:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemIcon.d.ts",quickPickItemTooltip:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemTooltip.d.ts",quickPickSortByLabel:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickSortByLabel.d.ts",readonlyMessage:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.readonlyMessage.d.ts",resolvers:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.resolvers.d.ts",saveEditor:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.saveEditor.d.ts",scmActionButton:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmActionButton.d.ts",scmSelectedProvider:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmSelectedProvider.d.ts",scmTextDocument:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmTextDocument.d.ts",scmValidation:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmValidation.d.ts",semanticSimilarity:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.semanticSimilarity.d.ts",shareProvider:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.shareProvider.d.ts",showLocal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.showLocal.d.ts",tabInputTextMerge:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputTextMerge.d.ts",taskPresentationGroup:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskPresentationGroup.d.ts",telemetry:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.telemetry.d.ts",terminalDataWriteEvent:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDataWriteEvent.d.ts",terminalDimensions:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDimensions.d.ts",terminalQuickFixProvider:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalQuickFixProvider.d.ts",testCoverage:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testCoverage.d.ts",testInvalidateResults:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testInvalidateResults.d.ts",testObserver:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testObserver.d.ts",textSearchProvider:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider.d.ts",timeline:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.timeline.d.ts",tokenInformation:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tokenInformation.d.ts",treeViewReveal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewReveal.d.ts",tunnels:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnels.d.ts",windowActivity:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.windowActivity.d.ts",workspaceTrust:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.workspaceTrust.d.ts"}),b$=st.as(lk.JSONContribution);class Dle{constructor(e,t,i){this._messageHandler=e,this._extension=t,this._extensionPointId=i}_msg(e,t){this._messageHandler({type:e,message:t,extensionId:this._extension.identifier,extensionPointId:this._extensionPointId})}error(e){this._msg(yi.Error,e)}warn(e){this._msg(yi.Warning,e)}info(e){this._msg(yi.Info,e)}}class Sy{static _toSet(e){const t=new lc;for(let i=0,n=e.length;i<n;i++)t.add(e[i].description.identifier);return t}static compute(e,t){if(!e||!e.length)return new Sy(t,[]);if(!t||!t.length)return new Sy([],e);const i=this._toSet(e),n=this._toSet(t),s=t.filter(a=>!i.has(a.description.identifier)),o=e.filter(a=>!n.has(a.description.identifier));return new Sy(s,o)}constructor(e,t){this.added=e,this.removed=t}}class kle{constructor(e,t){this.name=e,this.defaultExtensionKind=t,this._handler=null,this._users=null,this._delta=null}setHandler(e){if(this._handler!==null)throw new Error("Handler already set!");this._handler=e,this._handle()}acceptUsers(e){this._delta=Sy.compute(this._users,e),this._users=e,this._handle()}_handle(){if(!(this._handler===null||this._users===null||this._delta===null))try{this._handler(this._users,this._delta)}catch(e){en(e)}}}const Tle={type:"string",enum:["ui","workspace"],enumDescriptions:[p("ui","UI extension kind. In a remote window, such extensions are enabled only when available on the local machine."),p("workspace","Workspace extension kind. In a remote window, such extensions are enabled only when available on the remote.")]},u4="vscode://schemas/vscode-extensions",a0={properties:{engines:{type:"object",description:p("vscode.extension.engines","Engine compatibility."),properties:{vscode:{type:"string",description:p("vscode.extension.engines.vscode","For VS Code extensions, specifies the VS Code version that the extension is compatible with. Cannot be *. For example: ^0.10.5 indicates compatibility with a minimum VS Code version of 0.10.5."),default:"^1.22.0"}}},publisher:{description:p("vscode.extension.publisher","The publisher of the VS Code extension."),type:"string"},displayName:{description:p("vscode.extension.displayName","The display name for the extension used in the VS Code gallery."),type:"string"},categories:{description:p("vscode.extension.categories","The categories used by the VS Code gallery to categorize the extension."),type:"array",uniqueItems:!0,items:{oneOf:[{type:"string",enum:WQ},{type:"string",const:"Languages",deprecationMessage:p("vscode.extension.category.languages.deprecated","Use 'Programming  Languages' instead")}]}},galleryBanner:{type:"object",description:p("vscode.extension.galleryBanner","Banner used in the VS Code marketplace."),properties:{color:{description:p("vscode.extension.galleryBanner.color","The banner color on the VS Code marketplace page header."),type:"string"},theme:{description:p("vscode.extension.galleryBanner.theme","The color theme for the font used in the banner."),type:"string",enum:["dark","light"]}}},contributes:{description:p("vscode.extension.contributes","All contributions of the VS Code extension represented by this package."),type:"object",properties:{},default:{}},preview:{type:"boolean",description:p("vscode.extension.preview","Sets the extension to be flagged as a Preview in the Marketplace.")},enableProposedApi:{type:"boolean",deprecationMessage:p("vscode.extension.enableProposedApi.deprecated","Use `enabledApiProposals` instead.")},enabledApiProposals:{markdownDescription:p("vscode.extension.enabledApiProposals","Enable API proposals to try them out. Only valid **during development**. Extensions **cannot be published** with this property. For more details visit: https://code.visualstudio.com/api/advanced-topics/using-proposed-api"),type:"array",uniqueItems:!0,items:{type:"string",enum:Object.keys(am),markdownEnumDescriptions:Object.values(am)}},api:{markdownDescription:p("vscode.extension.api","Describe the API provided by this extension. For more details visit: https://code.visualstudio.com/api/advanced-topics/remote-extensions#handling-dependencies-with-remote-extensions"),type:"string",enum:["none"],enumDescriptions:[p("vscode.extension.api.none","Give up entirely the ability to export any APIs. This allows other extensions that depend on this extension to run in a separate extension host process or in a remote machine.")]},activationEvents:{description:p("vscode.extension.activationEvents","Activation events for the VS Code extension."),type:"array",items:{type:"string",defaultSnippets:[{label:"onWebviewPanel",description:p("vscode.extension.activationEvents.onWebviewPanel","An activation event emmited when a webview is loaded of a certain viewType"),body:"onWebviewPanel:viewType"},{label:"onLanguage",description:p("vscode.extension.activationEvents.onLanguage","An activation event emitted whenever a file that resolves to the specified language gets opened."),body:"onLanguage:${1:languageId}"},{label:"onCommand",description:p("vscode.extension.activationEvents.onCommand","An activation event emitted whenever the specified command gets invoked."),body:"onCommand:${2:commandId}"},{label:"onDebug",description:p("vscode.extension.activationEvents.onDebug","An activation event emitted whenever a user is about to start debugging or about to setup debug configurations."),body:"onDebug"},{label:"onDebugInitialConfigurations",description:p("vscode.extension.activationEvents.onDebugInitialConfigurations",'An activation event emitted whenever a "launch.json" needs to be created (and all provideDebugConfigurations methods need to be called).'),body:"onDebugInitialConfigurations"},{label:"onDebugDynamicConfigurations",description:p("vscode.extension.activationEvents.onDebugDynamicConfigurations",'An activation event emitted whenever a list of all debug configurations needs to be created (and all provideDebugConfigurations methods for the "dynamic" scope need to be called).'),body:"onDebugDynamicConfigurations"},{label:"onDebugResolve",description:p("vscode.extension.activationEvents.onDebugResolve","An activation event emitted whenever a debug session with the specific type is about to be launched (and a corresponding resolveDebugConfiguration method needs to be called)."),body:"onDebugResolve:${6:type}"},{label:"onDebugAdapterProtocolTracker",description:p("vscode.extension.activationEvents.onDebugAdapterProtocolTracker","An activation event emitted whenever a debug session with the specific type is about to be launched and a debug protocol tracker might be needed."),body:"onDebugAdapterProtocolTracker:${6:type}"},{label:"workspaceContains",description:p("vscode.extension.activationEvents.workspaceContains","An activation event emitted whenever a folder is opened that contains at least a file matching the specified glob pattern."),body:"workspaceContains:${4:filePattern}"},{label:"onStartupFinished",description:p("vscode.extension.activationEvents.onStartupFinished","An activation event emitted after the start-up finished (after all `*` activated extensions have finished activating)."),body:"onStartupFinished"},{label:"onTaskType",description:p("vscode.extension.activationEvents.onTaskType","An activation event emitted whenever tasks of a certain type need to be listed or resolved."),body:"onTaskType:${1:taskType}"},{label:"onFileSystem",description:p("vscode.extension.activationEvents.onFileSystem","An activation event emitted whenever a file or folder is accessed with the given scheme."),body:"onFileSystem:${1:scheme}"},{label:"onEditSession",description:p("vscode.extension.activationEvents.onEditSession","An activation event emitted whenever an edit session is accessed with the given scheme."),body:"onEditSession:${1:scheme}"},{label:"onSearch",description:p("vscode.extension.activationEvents.onSearch","An activation event emitted whenever a search is started in the folder with the given scheme."),body:"onSearch:${7:scheme}"},{label:"onView",body:"onView:${5:viewId}",description:p("vscode.extension.activationEvents.onView","An activation event emitted whenever the specified view is expanded.")},{label:"onUri",body:"onUri",description:p("vscode.extension.activationEvents.onUri","An activation event emitted whenever a system-wide Uri directed towards this extension is open.")},{label:"onOpenExternalUri",body:"onOpenExternalUri",description:p("vscode.extension.activationEvents.onOpenExternalUri","An activation event emitted whenever a external uri (such as an http or https link) is being opened.")},{label:"onCustomEditor",body:"onCustomEditor:${9:viewType}",description:p("vscode.extension.activationEvents.onCustomEditor","An activation event emitted whenever the specified custom editor becomes visible.")},{label:"onNotebook",body:"onNotebook:${1:type}",description:p("vscode.extension.activationEvents.onNotebook","An activation event emitted whenever the specified notebook document is opened.")},{label:"onAuthenticationRequest",body:"onAuthenticationRequest:${11:authenticationProviderId}",description:p("vscode.extension.activationEvents.onAuthenticationRequest","An activation event emitted whenever sessions are requested from the specified authentication provider.")},{label:"onRenderer",description:p("vscode.extension.activationEvents.onRenderer","An activation event emitted whenever a notebook output renderer is used."),body:"onRenderer:${11:rendererId}"},{label:"onTerminalProfile",body:"onTerminalProfile:${1:terminalId}",description:p("vscode.extension.activationEvents.onTerminalProfile","An activation event emitted when a specific terminal profile is launched.")},{label:"onTerminalQuickFixRequest",body:"onTerminalQuickFixRequest:${1:quickFixId}",description:p("vscode.extension.activationEvents.onTerminalQuickFixRequest","An activation event emitted when a command matches the selector associated with this ID")},{label:"onWalkthrough",body:"onWalkthrough:${1:walkthroughID}",description:p("vscode.extension.activationEvents.onWalkthrough","An activation event emitted when a specified walkthrough is opened.")},{label:"*",description:p("vscode.extension.activationEvents.star","An activation event emitted on VS Code startup. To ensure a great end user experience, please use this activation event in your extension only when no other activation events combination works in your use-case."),body:"*"}]}},badges:{type:"array",description:p("vscode.extension.badges","Array of badges to display in the sidebar of the Marketplace's extension page."),items:{type:"object",required:["url","href","description"],properties:{url:{type:"string",description:p("vscode.extension.badges.url","Badge image URL.")},href:{type:"string",description:p("vscode.extension.badges.href","Badge link.")},description:{type:"string",description:p("vscode.extension.badges.description","Badge description.")}}}},markdown:{type:"string",description:p("vscode.extension.markdown","Controls the Markdown rendering engine used in the Marketplace. Either github (default) or standard."),enum:["github","standard"],default:"github"},qna:{default:"marketplace",description:p("vscode.extension.qna","Controls the Q&A link in the Marketplace. Set to marketplace to enable the default Marketplace Q & A site. Set to a string to provide the URL of a custom Q & A site. Set to false to disable Q & A altogether."),anyOf:[{type:["string","boolean"],enum:["marketplace",!1]},{type:"string"}]},extensionDependencies:{description:p("vscode.extension.extensionDependencies","Dependencies to other extensions. The identifier of an extension is always ${publisher}.${name}. For example: vscode.csharp."),type:"array",uniqueItems:!0,items:{type:"string",pattern:Zj}},extensionPack:{description:p("vscode.extension.contributes.extensionPack","A set of extensions that can be installed together. The identifier of an extension is always ${publisher}.${name}. For example: vscode.csharp."),type:"array",uniqueItems:!0,items:{type:"string",pattern:Zj}},extensionKind:{description:p("extensionKind","Define the kind of an extension. `ui` extensions are installed and run on the local machine while `workspace` extensions run on the remote."),type:"array",items:Tle,default:["workspace"],defaultSnippets:[{body:["ui"],description:p("extensionKind.ui","Define an extension which can run only on the local machine when connected to remote window.")},{body:["workspace"],description:p("extensionKind.workspace","Define an extension which can run only on the remote machine when connected remote window.")},{body:["ui","workspace"],description:p("extensionKind.ui-workspace","Define an extension which can run on either side, with a preference towards running on the local machine.")},{body:["workspace","ui"],description:p("extensionKind.workspace-ui","Define an extension which can run on either side, with a preference towards running on the remote machine.")},{body:[],description:p("extensionKind.empty","Define an extension which cannot run in a remote context, neither on the local, nor on the remote machine.")}]},capabilities:{description:p("vscode.extension.capabilities","Declare the set of supported capabilities by the extension."),type:"object",properties:{virtualWorkspaces:{description:p("vscode.extension.capabilities.virtualWorkspaces","Declares whether the extension should be enabled in virtual workspaces. A virtual workspace is a workspace which is not backed by any on-disk resources. When false, this extension will be automatically disabled in virtual workspaces. Default is true."),type:["boolean","object"],defaultSnippets:[{label:"limited",body:{supported:"${1:limited}",description:"${2}"}},{label:"false",body:{supported:!1,description:"${2}"}}],default:(!0).valueOf,properties:{supported:{markdownDescription:p("vscode.extension.capabilities.virtualWorkspaces.supported","Declares the level of support for virtual workspaces by the extension."),type:["string","boolean"],enum:["limited",!0,!1],enumDescriptions:[p("vscode.extension.capabilities.virtualWorkspaces.supported.limited","The extension will be enabled in virtual workspaces with some functionality disabled."),p("vscode.extension.capabilities.virtualWorkspaces.supported.true","The extension will be enabled in virtual workspaces with all functionality enabled."),p("vscode.extension.capabilities.virtualWorkspaces.supported.false","The extension will not be enabled in virtual workspaces.")]},description:{type:"string",markdownDescription:p("vscode.extension.capabilities.virtualWorkspaces.description","A description of how virtual workspaces affects the extensions behavior and why it is needed. This only applies when `supported` is not `true`.")}}},untrustedWorkspaces:{description:p("vscode.extension.capabilities.untrustedWorkspaces","Declares how the extension should be handled in untrusted workspaces."),type:"object",required:["supported"],defaultSnippets:[{body:{supported:"${1:limited}",description:"${2}"}}],properties:{supported:{markdownDescription:p("vscode.extension.capabilities.untrustedWorkspaces.supported","Declares the level of support for untrusted workspaces by the extension."),type:["string","boolean"],enum:["limited",!0,!1],enumDescriptions:[p("vscode.extension.capabilities.untrustedWorkspaces.supported.limited","The extension will be enabled in untrusted workspaces with some functionality disabled."),p("vscode.extension.capabilities.untrustedWorkspaces.supported.true","The extension will be enabled in untrusted workspaces with all functionality enabled."),p("vscode.extension.capabilities.untrustedWorkspaces.supported.false","The extension will not be enabled in untrusted workspaces.")]},restrictedConfigurations:{description:p("vscode.extension.capabilities.untrustedWorkspaces.restrictedConfigurations","A list of configuration keys contributed by the extension that should not use workspace values in untrusted workspaces."),type:"array",items:{type:"string"}},description:{type:"string",markdownDescription:p("vscode.extension.capabilities.untrustedWorkspaces.description","A description of how workspace trust affects the extensions behavior and why it is needed. This only applies when `supported` is not `true`.")}}}}},sponsor:{description:p("vscode.extension.contributes.sponsor","Specify the location from where users can sponsor your extension."),type:"object",defaultSnippets:[{body:{url:"${1:https:}"}}],properties:{url:{description:p("vscode.extension.contributes.sponsor.url","URL from where users can sponsor your extension. It must be a valid URL with a HTTP or HTTPS protocol. Example value: https://github.com/sponsors/nvaccess"),type:"string"}}},scripts:{type:"object",properties:{"vscode:prepublish":{description:p("vscode.extension.scripts.prepublish","Script executed before the package is published as a VS Code extension."),type:"string"},"vscode:uninstall":{description:p("vscode.extension.scripts.uninstall","Uninstall hook for VS Code extension. Script that gets executed when the extension is completely uninstalled from VS Code which is when VS Code is restarted (shutdown and start) after the extension is uninstalled. Only Node scripts are supported."),type:"string"}}},icon:{type:"string",description:p("vscode.extension.icon","The path to a 128x128 pixel icon.")},l10n:{type:"string",description:p({key:"vscode.extension.l10n",comment:['{Locked="bundle.l10n._locale_.json"}','{Locked="vscode.l10n API"}']},"The relative path to a folder containing localization (bundle.l10n.*.json) files. Must be specified if you are using the vscode.l10n API.")}}};class Ile{constructor(){this._extensionPoints=new Map}registerExtensionPoint(e){if(this._extensionPoints.has(e.extensionPoint))throw new Error("Duplicate extension point: "+e.extensionPoint);const t=new kle(e.extensionPoint,e.defaultExtensionKind);return this._extensionPoints.set(e.extensionPoint,t),e.activationEventsGenerator&&H_.register(e.extensionPoint,e.activationEventsGenerator),a0.properties.contributes.properties[e.extensionPoint]=e.jsonSchema,b$.registerSchema(u4,a0),t}getExtensionPoints(){return Array.from(this._extensionPoints.values())}}const h4={ExtensionsRegistry:"ExtensionsRegistry"};st.add(h4.ExtensionsRegistry,new Ile);const io=st.as(h4.ExtensionsRegistry);b$.registerSchema(u4,a0);b$.registerSchema(Tce,{properties:{extensionEnabledApiProposals:{description:p("product.extensionEnabledApiProposals","API proposals that the respective extensions can freely use."),type:"object",properties:{},additionalProperties:{anyOf:[{type:"array",uniqueItems:!0,items:{type:"string",enum:Object.keys(am),markdownEnumDescriptions:Object.values(am)}}]}}}});const Rle=io.registerExtensionPoint(Sle),Ple=re("terminalContributionsService");class $Re{get terminalProfiles(){return this._terminalProfiles}constructor(){this._terminalProfiles=[],Rle.setHandler(e=>{this._terminalProfiles=e.map(t=>{var i,n;return((n=(i=t.value)==null?void 0:i.profiles)==null?void 0:n.filter(s=>Ale(s)).map(s=>({...s,extensionIdentifier:t.description.identifier.value})))||[]}).flat()})}}function Ale(r){return!r.icon||typeof r.icon=="string"||k.isUri(r.icon)||"light"in r.icon&&"dark"in r.icon&&k.isUri(r.icon.light)&&k.isUri(r.icon.dark)}const f4=re("terminalLinkProviderService"),p4=re("environmentVariableService"),g4=re("terminalQuickFixService"),Mle=re("preferencesSearchService"),WRe="settings.action.clearSearchResults",HRe="settings.action.showContextMenu",jRe="settings.action.suggestFilters",BRe=new G("inSettingsEditor",!1),URe=new G("inSettingsJSONEditor",!1),VRe=new G("inSettingsSearch",!1),qRe=new G("settingsTocRowFocus",!1),GRe=new G("settingRowFocus",!1),zRe=new G("inKeybindings",!1),KRe=new G("inKeybindingsSearch",!1),QRe=new G("keybindingFocus",!1),YRe=new G("whenFocus",!1),XRe=new G("inSettingsEditorUserTab",!1),JRe="keybindings.editor.searchKeybindings",ZRe="keybindings.editor.clearSearchResults",ePe="keybindings.editor.clearSearchHistory",tPe="keybindings.editor.recordSearchKeys",iPe="keybindings.editor.toggleSortByPrecedence",nPe="keybindings.editor.defineKeybinding",rPe="keybindings.editor.addKeybinding",sPe="keybindings.editor.defineWhenExpression",oPe="keybindings.editor.acceptWhenExpression",aPe="keybindings.editor.rejectWhenExpression",cPe="keybindings.editor.removeKeybinding",dPe="keybindings.editor.resetKeybinding",lPe="keybindings.editor.copyKeybindingEntry",uPe="keybindings.editor.copyCommandKeybindingEntry",hPe="keybindings.editor.copyCommandTitle",fPe="keybindings.editor.showConflicts",pPe="keybindings.editor.focusKeybindings",gPe="keybindings.editor.showDefaultKeybindings",mPe="keybindings.editor.showUserKeybindings",vPe="keybindings.editor.showExtensionKeybindings",yPe="modified",_Pe="ext:",wPe="feature:",bPe="id:",SPe="lang:",CPe="tag:",EPe="hasPolicy",xPe="workspaceTrust",DPe="requireTrustedWorkspace";let zb;async function kPe(r,e,t){if(zb)return zb;if((await r.getTreatment("ExtensionToggleSettings")||!e.isBuilt)&&t.extensionRecommendations&&t.commonlyUsedSettings){const n={};return Object.keys(t.extensionRecommendations).forEach(s=>{const o=t.extensionRecommendations[s];o.onSettingsEditorOpen&&(n[s]=o)}),zb={settingsEditorRecommendedExtensions:n,commonlyUsed:t.commonlyUsedSettings},zb}}const Lle=re("IUserDataSyncWorkbenchService");Tc("settings-sync-view-icon",jt.sync,p("syncViewIcon","View icon of the Settings Sync view."));const Fle="configurationSync.store";function Ole(){const r=st.as(ks.Configuration).getConfigurationProperties();return Object.keys(r).filter(e=>!!r[e].disallowSyncIgnore)}function TPe(){const r=st.as(ks.Configuration).getConfigurationProperties(),e=Object.keys(r).filter(n=>!!r[n].ignoreSync),t=Object.keys(r).filter(n=>r[n].scope===2||r[n].scope===6),i=Ole();return Mf([Fle,...e,...t,...i])}const Nle=re("IUserDataSyncEnablementService"),IPe=re("IUserDataSyncService"),$le=re("keybindingEditingService");let pB=class extends ne{constructor(e,t,i,n,s){super(),this.textModelResolverService=e,this.textFileService=t,this.fileService=i,this.configurationService=n,this.userDataProfileService=s,this.queue=new Cq}addKeybinding(e,t,i){return this.queue.queue(()=>this.doEditKeybinding(e,t,i,!0))}editKeybinding(e,t,i){return this.queue.queue(()=>this.doEditKeybinding(e,t,i,!1))}resetKeybinding(e){return this.queue.queue(()=>this.doResetKeybinding(e))}removeKeybinding(e){return this.queue.queue(()=>this.doRemoveKeybinding(e))}async doEditKeybinding(e,t,i,n){const s=await this.resolveAndValidate(),o=s.object.textEditorModel;if(n)this.updateKeybinding(e,t,i,o,-1);else{const a=sc(o.getValue()),c=this.findUserKeybindingEntryIndex(e,a);this.updateKeybinding(e,t,i,o,c),e.isDefault&&e.resolvedKeybinding&&this.removeDefaultKeybinding(e,o)}try{await this.save()}finally{s.dispose()}}doRemoveKeybinding(e){return this.resolveAndValidate().then(t=>{const i=t.object.textEditorModel;return e.isDefault?this.removeDefaultKeybinding(e,i):this.removeUserKeybinding(e,i),this.save().finally(()=>t.dispose())})}doResetKeybinding(e){return this.resolveAndValidate().then(t=>{const i=t.object.textEditorModel;return e.isDefault||(this.removeUserKeybinding(e,i),this.removeUnassignedDefaultKeybinding(e,i)),this.save().finally(()=>t.dispose())})}save(){return this.textFileService.save(this.userDataProfileService.currentProfile.keybindingsResource)}updateKeybinding(e,t,i,n,s){const{tabSize:o,insertSpaces:a}=n.getOptions(),c=n.getEOL();if(s!==-1){this.applyEditsToBuffer(qc(n.getValue(),[s,"key"],t,{tabSize:o,insertSpaces:a,eol:c})[0],n);const d=qc(n.getValue(),[s,"when"],i,{tabSize:o,insertSpaces:a,eol:c});d.length>0&&this.applyEditsToBuffer(d[0],n)}else this.applyEditsToBuffer(qc(n.getValue(),[-1],this.asObject(t,e.command,i,!1),{tabSize:o,insertSpaces:a,eol:c})[0],n)}removeUserKeybinding(e,t){const{tabSize:i,insertSpaces:n}=t.getOptions(),s=t.getEOL(),o=sc(t.getValue()),a=this.findUserKeybindingEntryIndex(e,o);a!==-1&&this.applyEditsToBuffer(qc(t.getValue(),[a],void 0,{tabSize:i,insertSpaces:n,eol:s})[0],t)}removeDefaultKeybinding(e,t){const{tabSize:i,insertSpaces:n}=t.getOptions(),s=t.getEOL(),o=e.resolvedKeybinding?e.resolvedKeybinding.getUserSettingsLabel():null;if(o){const a=this.asObject(o,e.command,e.when?e.when.serialize():void 0,!0);sc(t.getValue()).every(d=>!this.areSame(d,a))&&this.applyEditsToBuffer(qc(t.getValue(),[-1],a,{tabSize:i,insertSpaces:n,eol:s})[0],t)}}removeUnassignedDefaultKeybinding(e,t){const{tabSize:i,insertSpaces:n}=t.getOptions(),s=t.getEOL(),o=sc(t.getValue()),a=this.findUnassignedDefaultKeybindingEntryIndex(e,o).reverse();for(const c of a)this.applyEditsToBuffer(qc(t.getValue(),[c],void 0,{tabSize:i,insertSpaces:n,eol:s})[0],t)}findUserKeybindingEntryIndex(e,t){for(let i=0;i<t.length;i++){const n=t[i];if(n.command===e.command){if(!n.when&&!e.when)return i;if(n.when&&e.when){const s=nt.deserialize(n.when);if(s&&s.serialize()===e.when.serialize())return i}}}return-1}findUnassignedDefaultKeybindingEntryIndex(e,t){const i=[];for(let n=0;n<t.length;n++)t[n].command===`-${e.command}`&&i.push(n);return i}asObject(e,t,i,n){const s={key:e};return t&&(s.command=n?`-${t}`:t),i&&(s.when=i),s}areSame(e,t){if(e.command!==t.command||e.key!==t.key)return!1;const i=nt.deserialize(e.when),n=nt.deserialize(t.when);return!(i&&!n||!i&&n||i&&n&&!i.equals(n)||!xa(e.args,t.args))}applyEditsToBuffer(e,t){const i=t.getPositionAt(e.offset),n=t.getPositionAt(e.offset+e.length),s=new qe(i.lineNumber,i.column,n.lineNumber,n.column),a=t.getValueInRange(s)?ma.replace(s,e.content):ma.insert(i,e.content);t.pushEditOperations([new ef(i.lineNumber,i.column,i.lineNumber,i.column)],[a],()=>[])}resolveModelReference(){return this.fileService.exists(this.userDataProfileService.currentProfile.keybindingsResource).then(e=>{const t=this.configurationService.getValue("files",{overrideIdentifier:"json"}).eol;return(e?Promise.resolve(null):this.textFileService.write(this.userDataProfileService.currentProfile.keybindingsResource,this.getEmptyContent(t),{encoding:"utf8"})).then(()=>this.textModelResolverService.createModelReference(this.userDataProfileService.currentProfile.keybindingsResource))})}resolveAndValidate(){return this.textFileService.isDirty(this.userDataProfileService.currentProfile.keybindingsResource)?Promise.reject(new Error(p("errorKeybindingsFileDirty","Unable to write because the keybindings configuration file has unsaved changes. Please save it first and then try again."))):this.resolveModelReference().then(e=>{const t=e.object.textEditorModel,i=t.getEOL();if(t.getValue()){const n=this.parse(t);if(n.parseErrors.length)return e.dispose(),Promise.reject(new Error(p("parseErrors","Unable to write to the keybindings configuration file. Please open it to correct errors/warnings in the file and try again.")));if(n.result){if(!Array.isArray(n.result))return e.dispose(),Promise.reject(new Error(p("errorInvalidConfiguration","Unable to write to the keybindings configuration file. It has an object which is not of type Array. Please open the file to clean up and try again.")))}else{const s=i+"[]";this.applyEditsToBuffer({content:s,length:s.length,offset:t.getValue().length},t)}}else{const n=this.getEmptyContent(i);this.applyEditsToBuffer({content:n,length:n.length,offset:0},t)}return e})}parse(e){const t=[];return{result:sc(e.getValue(),t,{allowTrailingComma:!0,allowEmptyContent:!0}),parseErrors:t}}getEmptyContent(e){return"// "+p("emptyKeybindingsHeader","Place your key bindings in this file to override the defaults")+e+"[]"}};pB=T([v(0,or),v(1,Dn),v(2,at),v(3,We),v(4,NT)],pB);const qf=re("notebookService");class S${constructor(e,t,i){this.viewType=e,this.serializer=t,this.extensionData=i}}const Wle=re("searchHistoryService");let c0=class zv{constructor(e){this.storageService=e,this._onDidClearHistory=new A,this.onDidClearHistory=this._onDidClearHistory.event}clearHistory(){this.storageService.remove(zv.SEARCH_HISTORY_KEY,1),this._onDidClearHistory.fire()}load(){let e;const t=this.storageService.get(zv.SEARCH_HISTORY_KEY,1);if(t)try{e=JSON.parse(t)}catch{}return e||{}}save(e){Dg(e)?this.storageService.remove(zv.SEARCH_HISTORY_KEY,1):this.storageService.store(zv.SEARCH_HISTORY_KEY,JSON.stringify(e),1,1)}};c0.SEARCH_HISTORY_KEY="workbench.search.history";c0=T([v(0,ri)],c0);const Gf=re("replaceService");class Hle{}class IS{}function jle(){return!1}const m4="jupyter-notebook",Ble="ms-toolsai.jupyter",v4=new Map;v4.set(m4,new Map);var eq;(eq=v4.get(m4))==null||eq.set("python",{extensionIds:["ms-python.python",Ble],displayName:"Python + Jupyter"});var d0;(function(r){r[r.Preview=0]="Preview",r[r.Editing=1]="Editing"})(d0||(d0={}));function fg(r){if(!r)return;if(r.getId()===Vee)return r.getControl();if(r.input&&jle())return r.getControl().notebookEditor}class Ule{}const zf=re("INotebookEditorWidgetService");function y4(r){return"cellResults"in r}function _4(r,e){let t=-1;const i=[];let n=[];return r.forEach(o=>{o.range.startLineNumber!==t&&n.length>0&&(i.push([...n]),n=[]),n.push(o),t=o.range.endLineNumber}),n.length>0&&i.push([...n]),i.map(o=>{const a=[],c=o[0].range.startLineNumber,d=o[o.length-1].range.endLineNumber;for(let l=c;l<=d;l++)a.push(e.textBuffer.getLineContent(l));return new Y1(a.join(`
`)+`
`,o.map(l=>new qe(l.range.startLineNumber-1,l.range.startColumn-1,l.range.endLineNumber-1,l.range.endColumn-1)))})}function w4(r){return r.map(e=>e.searchPreviewInfo?new Y1(e.searchPreviewInfo.line,new qe(0,e.searchPreviewInfo.range.start,0,e.searchPreviewInfo.range.end),void 0,e.index):void 0).filter(e=>!!e)}class gB{constructor(e,t,i){this._hasParameters=!1,this._replacePattern=e;let n,s;typeof t=="boolean"?(s=t,this._regExp=i):(n=t,s=!!n.isRegExp,this._regExp=uH(n.pattern,!!n.isRegExp,{matchCase:n.isCaseSensitive,wholeWord:n.isWordMatch,multiline:n.isMultiline,global:!1,unicode:!0})),s&&this.parseReplaceString(e),this._regExp.global&&(this._regExp=uH(this._regExp.source,!0,{matchCase:!this._regExp.ignoreCase,wholeWord:!1,multiline:this._regExp.multiline,global:!1})),this._caseOpsRegExp=new RegExp(/([\s\S]*?)((?:\\[uUlL])+?|)(\$[0-9]+)([\s\S]*?)/g)}get hasParameters(){return this._hasParameters}get pattern(){return this._replacePattern}get regExp(){return this._regExp}getReplaceString(e,t){this._regExp.lastIndex=0;const i=this._regExp.exec(e);if(i){if(this.hasParameters){const n=this.replaceWithCaseOperations(e,this._regExp,this.buildReplaceString(i,t));return i[0]===e?n:n.substr(i.index,i[0].length-(e.length-n.length))}return this.buildReplaceString(i,t)}return null}replaceWithCaseOperations(e,t,i){if(!/\\[uUlL]/.test(i))return e.replace(t,i);const n=t.exec(e);if(n===null)return e.replace(t,i);let s,o="",a=0,c="";for(;(s=this._caseOpsRegExp.exec(i))!==null;){a=s.index;const d=s[0];c=d;let l=s[2];const u=s[3];if(!l){o+=d;continue}const h=n[parseInt(u.slice(1))];if(!h){o+=d;continue}const g=h.length;o+=s[1],l=l.replace(/\\/g,"");let m=0;for(;m<l.length;m++)switch(l[m]){case"U":o+=h.slice(m).toUpperCase(),m=g;break;case"u":o+=h[m].toUpperCase();break;case"L":o+=h.slice(m).toLowerCase(),m=g;break;case"l":o+=h[m].toLowerCase();break}m<g&&(o+=h.slice(m)),o+=s[4]}return o+=i.slice(a+c.length),e.replace(t,o)}buildReplaceString(e,t){return t?HQ(e,this._replacePattern):this._replacePattern}parseReplaceString(e){if(!e||e.length===0)return;let t=0,i="";for(let n=0,s=e.length;n<s;n++){const o=e.charCodeAt(n);if(o===92){if(n++,n>=s)break;const a=e.charCodeAt(n);let c=null;switch(a){case 92:c="\\";break;case 110:c=`
`;break;case 116:c="	";break}c&&(i+=e.substring(t,n-1)+c,t=n+1)}if(o===36){if(n++,n>=s)break;const a=e.charCodeAt(n);let c=null;switch(a){case 48:c="$&",this._hasParameters=!0;break;case 96:case 39:this._hasParameters=!0;break;default:{if(!this.between(a,49,57))break;if(n===e.length-1){this._hasParameters=!0;break}let d=e.charCodeAt(++n);if(!this.between(d,48,57)){this._hasParameters=!0,--n;break}if(n===e.length-1){this._hasParameters=!0;break}if(d=e.charCodeAt(++n),!this.between(d,48,57)){this._hasParameters=!0,--n;break}break}}c&&(i+=e.substring(t,n-1)+c,t=n+1)}}t!==0&&(this._replacePattern=i+e.substring(t))}between(e,t,i){return t<=e&&e<=i}}function Vle(r,e,t){const i=r[0].range.startLineNumber,n=r[r.length-1].range.endLineNumber,s=[];for(let o=i;o<=n;o++)s.push(e.getLineContent(o));return new Y1(s.join(`
`)+`
`,r.map(o=>new qe(o.range.startLineNumber-1,o.range.startColumn-1,o.range.endLineNumber-1,o.range.endColumn-1)),t)}function qle(r,e,t){let i=-1;const n=[];let s=[];return r.forEach(o=>{o.range.startLineNumber!==i&&(s=[],n.push(s)),s.push(o),i=o.range.endLineNumber}),n.map(o=>Vle(o,e,t))}function b4(r,e,t){const i=[];let n=-1;for(let s=0;s<r.length;s++){const{start:o,end:a}=mB(r[s]);if(typeof t.beforeContext=="number"&&t.beforeContext>0){const l=Math.max(n+1,o-t.beforeContext);for(let u=l;u<o;u++)i.push({text:e.getLineContent(u+1),lineNumber:u})}i.push(r[s]);const c=r[s+1],d=c?mB(c).start:Number.MAX_VALUE;if(typeof t.afterContext=="number"&&t.afterContext>0){const l=Math.min(d-1,a+t.afterContext,e.getLineCount()-1);for(let u=a+1;u<=l;u++)i.push({text:e.getLineContent(u+1),lineNumber:u})}n=a}return i}function mB(r){const e=r.ranges,t=Array.isArray(e)?e[0].startLineNumber:e.startLineNumber,i=Array.isArray(e)?e[e.length-1].endLineNumber:e.endLineNumber;return{start:t,end:i}}class Ra{constructor(e,t,i,n){this._parent=e,this._fullPreviewLines=t,this._oneLinePreviewText=t[i.startLineNumber];const s=i.startLineNumber===i.endLineNumber?i.endColumn:this._oneLinePreviewText.length;this._rangeInPreviewText=new T3(1,i.startColumn+1,s+1),this._range=new qe(n.startLineNumber+1,n.startColumn+1,n.endLineNumber+1,n.endColumn+1),this._fullPreviewRange=i,this._id=this._parent.id()+">"+this._range+this.getMatchString()}id(){return this._id}parent(){return this._parent}text(){return this._oneLinePreviewText}range(){return this._range}preview(){let e=this._oneLinePreviewText.substring(0,this._rangeInPreviewText.startColumn-1),t=this.getMatchString(),i=this._oneLinePreviewText.substring(this._rangeInPreviewText.endColumn-1);e=BQ(e,26),e=e.trimLeft();let n=Ra.MAX_PREVIEW_CHARS-e.length;return t=t.substr(0,n),n-=t.length,i=i.substr(0,n),{before:e,inside:t,after:i}}get replaceString(){const e=this.parent().parent().searchModel;if(!e.replacePattern)throw new Error("searchModel.replacePattern must be set before accessing replaceString");const t=this.fullMatchText();let i=e.replacePattern.getReplaceString(t,e.preserveCase);if(i!==null)return i;const n=t.replace(/\r\n/g,`
`);if(n!==t&&(i=e.replacePattern.getReplaceString(n,e.preserveCase),i!==null))return i;const s=this.fullMatchText(!0);if(i=e.replacePattern.getReplaceString(s,e.preserveCase),i!==null)return i;const o=s.replace(/\r\n/g,`
`);return o!==s&&(i=e.replacePattern.getReplaceString(o,e.preserveCase),i!==null)?i:e.replacePattern.pattern}fullMatchText(e=!1){let t;return e?t=this._fullPreviewLines:(t=this._fullPreviewLines.slice(this._fullPreviewRange.startLineNumber,this._fullPreviewRange.endLineNumber+1),t[t.length-1]=t[t.length-1].slice(0,this._fullPreviewRange.endColumn),t[0]=t[0].slice(this._fullPreviewRange.startColumn)),t.join(`
`)}rangeInPreview(){return{...this._fullPreviewRange,startColumn:this._fullPreviewRange.startColumn+1,endColumn:this._fullPreviewRange.endColumn+1}}fullPreviewLines(){return this._fullPreviewLines.slice(this._fullPreviewRange.startLineNumber,this._fullPreviewRange.endLineNumber+1)}getMatchString(){return this._oneLinePreviewText.substring(this._rangeInPreviewText.startColumn-1,this._rangeInPreviewText.endColumn-1)}}Ra.MAX_PREVIEW_CHARS=250;Ra.__decorator=T([xt],Ra.prototype,"preview",null);class vB{constructor(e,t,i){this._parent=e,this._cell=t,this._cellIndex=i,this._contentMatches=new Map,this._webviewMatches=new Map,this._context=new Map}get context(){return new Map(this._context)}matches(){return[...this._contentMatches.values(),...this._webviewMatches.values()]}get contentMatches(){return Array.from(this._contentMatches.values())}get webviewMatches(){return Array.from(this._webviewMatches.values())}remove(e){Array.isArray(e)||(e=[e]);for(const t of e)this._contentMatches.delete(t.id()),this._webviewMatches.delete(t.id())}addContentMatches(e){wB().forEach(i=>{this._contentMatches.set(i.id(),i)}),this.addContext(e)}addContext(e){this.cell.resolveTextModel().then(t=>{b4(e,t,this.parent.parent().query).filter(s=>!hg(s)).map(s=>({...s,lineNumber:s.lineNumber+1})).forEach(s=>{this._context.set(s.lineNumber,s.text)})})}addWebviewMatches(e){wB().forEach(i=>{this._webviewMatches.set(i.id(),i)})}get parent(){return this._parent}get id(){return this._cell.id}get cellIndex(){return this._cellIndex}get cell(){return this._cell}}class Vp extends Ra{constructor(e,t,i,n,s){super(e.parent,t,i,n),this._cellParent=e,this._id=this._parent.id()+">"+this._cellParent.cellIndex+(s?"_"+s:"")+"_"+this.notebookMatchTypeString()+this._range+this.getMatchString(),this._webviewIndex=s}parent(){return this._cellParent.parent}get cellParent(){return this._cellParent}notebookMatchTypeString(){return this.isWebviewMatch()?"webview":"content"}isWebviewMatch(){return this._webviewIndex!==void 0}get cellIndex(){return this._cellParent.cellIndex}get webviewIndex(){return this._webviewIndex}get cell(){return this._cellParent.cell}}let Vs=class RS extends ne{static getDecorationOption(e){return e?RS._CURRENT_FIND_MATCH:RS._FIND_MATCH}get context(){return new Map(this._context)}get cellContext(){const e=new Map;return this._cellMatches.forEach(t=>{e.set(t.id,t.context)}),e}constructor(e,t,i,n,s,o,a,c,d,l){super(),this._query=e,this._previewOptions=t,this._maxResults=i,this._parent=n,this.rawMatch=s,this._closestRoot=o,this.modelService=a,this.replaceService=c,this.labelService=d,this.notebookEditorService=l,this._onChange=this._register(new A),this.onChange=this._onChange.event,this._onDispose=this._register(new A),this.onDispose=this._onDispose.event,this._model=null,this._modelListener=null,this._selectedMatch=null,this._modelDecorations=[],this._context=new Map,this._notebookEditorWidget=null,this._editorWidgetListener=null,this.replaceQ=Promise.resolve(),this._resource=this.rawMatch.resource,this._textMatches=new Map,this._removedTextMatches=new Set,this._updateScheduler=new Ys(this.updateMatchesForModel.bind(this),250),this._name=new Tg(()=>d.getUriBasenameLabel(this.resource)),this._cellMatches=new Map,this._notebookUpdateScheduler=new Ys(this.updateMatchesForEditorWidget.bind(this),250),this.createMatches()}addWebviewMatchesToCell(e,t){const i=this.getCellMatch(e);i!==void 0&&i.addWebviewMatches(t)}addContentMatchesToCell(e,t){const i=this.getCellMatch(e);i!==void 0&&i.addContentMatches(t)}getCellMatch(e){return this._cellMatches.get(e)}addCellMatch(e){const t=new vB(this,e.cell,e.index);this._cellMatches.set(t.id,t),this.addWebviewMatchesToCell(e.cell.id,e.webviewResults),this.addContentMatchesToCell(e.cell.id,e.contentResults)}get closestRoot(){return this._closestRoot}hasWebviewMatches(){return this.matches().some(e=>e instanceof Vp&&e.isWebviewMatch())}createMatches(){var t;const e=this.modelService.getModel(this._resource);if(e)this.bindModel(e),this.updateMatchesForModel();else{const i=this.notebookEditorService.retrieveExistingWidgetFromURI(this.resource);i!=null&&i.value&&this.bindNotebookEditorWidget(i.value),this.rawMatch.results&&this.rawMatch.results.filter(hg).forEach(n=>{u0(n,this).forEach(s=>this.add(s))}),y4(this.rawMatch)&&((t=this.rawMatch.cellResults)==null||t.forEach(n=>this.addCellMatch(n)),this.setNotebookFindMatchDecorationsUsingCellMatches(this.cellMatches()),this._onChange.fire({forceUpdateModel:!0})),this.addContext(this.rawMatch.results)}}bindModel(e){this._model=e,this._modelListener=this._model.onDidChangeContent(()=>{this._updateScheduler.schedule()}),this._model.onWillDispose(()=>this.onModelWillDispose()),this.updateHighlights()}onModelWillDispose(){this.updateMatchesForModel(),this.unbindModel()}unbindModel(){this._model&&(this._updateScheduler.cancel(),this._model.changeDecorations(e=>{this._modelDecorations=e.deltaDecorations(this._modelDecorations,[])}),this._model=null,this._modelListener.dispose())}updateMatchesForModel(){if(!this._model)return;this._textMatches=new Map;const e=this._query.isWordMatch&&this._query.wordSeparators?this._query.wordSeparators:null,t=this._model.findMatches(this._query.pattern,this._model.getFullModelRange(),!!this._query.isRegExp,!!this._query.isCaseSensitive,e,!1,this._maxResults??Number.MAX_SAFE_INTEGER);this.updateMatches(t,!0,this._model)}async updatesMatchesForLineAfterReplace(e,t){if(!this._model)return;const i={startLineNumber:e,startColumn:this._model.getLineMinColumn(e),endLineNumber:e,endColumn:this._model.getLineMaxColumn(e)};Array.from(this._textMatches.values()).filter(a=>a.range().startLineNumber===e).forEach(a=>this._textMatches.delete(a.id()));const s=this._query.isWordMatch&&this._query.wordSeparators?this._query.wordSeparators:null,o=this._model.findMatches(this._query.pattern,i,!!this._query.isRegExp,!!this._query.isCaseSensitive,s,!1,this._maxResults??Number.MAX_SAFE_INTEGER);this.updateMatches(o,t,this._model)}updateMatches(e,t,i){const n=qle(e,i,this._previewOptions);n.forEach(s=>{u0(s,this).forEach(o=>{this._removedTextMatches.has(o.id())||(this.add(o),this.isMatchSelected(o)&&(this._selectedMatch=o))})}),this.addContext(b4(n,i,this.parent().parent().query).filter(s=>!hg(s)).map(s=>({...s,lineNumber:s.lineNumber+1}))),this._onChange.fire({forceUpdateModel:t}),this.updateHighlights()}updateHighlights(){this._model&&this._model.changeDecorations(e=>{const t=this.parent().showHighlights?this.matches().map(i=>({range:i.range(),options:RS.getDecorationOption(this.isMatchSelected(i))})):[];this._modelDecorations=e.deltaDecorations(this._modelDecorations,t)})}id(){return this.resource.toString()}parent(){return this._parent}matches(){const e=Array.from(this._cellMatches.values()).flatMap(t=>t.matches());return[...this._textMatches.values(),...e]}textMatches(){return Array.from(this._textMatches.values())}cellMatches(){return Array.from(this._cellMatches.values())}remove(e){Array.isArray(e)||(e=[e]);for(const t of e)this.removeMatch(t),this._removedTextMatches.add(t.id());this._onChange.fire({didRemove:!0})}async replace(e){return this.replaceQ=this.replaceQ.finally(async()=>{await this.replaceService.replace(e),await this.updatesMatchesForLineAfterReplace(e.range().startLineNumber,!1)})}setSelectedMatch(e){e&&(!this._textMatches.has(e.id())||this.isMatchSelected(e))||(this._selectedMatch=e,this.updateHighlights())}getSelectedMatch(){return this._selectedMatch}isMatchSelected(e){return!!this._selectedMatch&&this._selectedMatch.id()===e.id()}count(){return this.matches().length}get resource(){return this._resource}name(){return this._name.value}addContext(e){return e?e.filter(i=>!hg(i)).forEach(i=>this._context.set(i.lineNumber,i.text)):void 0}add(e,t){this._textMatches.set(e.id(),e),t&&this._onChange.fire({forceUpdateModel:!0})}removeMatch(e){var t;e instanceof Vp?(e.cellParent.remove(e),e.cellParent.matches().length===0&&this._cellMatches.delete(e.cellParent.id)):this._textMatches.delete(e.id()),this.isMatchSelected(e)?(this.setSelectedMatch(null),(t=this._findMatchDecorationModel)==null||t.clearCurrentFindMatchDecoration()):this.updateHighlights(),e instanceof Vp&&this.setNotebookFindMatchDecorationsUsingCellMatches(this.cellMatches())}async resolveFileStat(e){this._fileStat=await e.stat(this.resource).catch(()=>{})}get fileStat(){return this._fileStat}set fileStat(e){this._fileStat=e}dispose(){this.setSelectedMatch(null),this.unbindModel(),this.unbindNotebookEditorWidget(),this._onDispose.fire(),super.dispose()}hasOnlyReadOnlyMatches(){return this.matches().every(e=>e instanceof Vp&&e.isWebviewMatch())}bindNotebookEditorWidget(e){var t,i,n;this._notebookEditorWidget!==e&&(this._notebookEditorWidget=e,this._editorWidgetListener=((t=this._notebookEditorWidget.textModel)==null?void 0:t.onDidChangeContent(s=>{s.rawEvents.some(o=>o.kind===_n.ChangeCellContent||o.kind===_n.ModelChange)&&this._notebookUpdateScheduler.schedule()}))??null,(i=this._findMatchDecorationModel)==null||i.stopWebviewFind(),(n=this._findMatchDecorationModel)==null||n.dispose(),this._findMatchDecorationModel=new Hle(this._notebookEditorWidget))}unbindNotebookEditorWidget(e){var t,i,n;e&&this._notebookEditorWidget!==e||(this._notebookEditorWidget&&(this._notebookUpdateScheduler.cancel(),(t=this._editorWidgetListener)==null||t.dispose()),this._findMatchDecorationModel&&((i=this._findMatchDecorationModel)==null||i.stopWebviewFind(),(n=this._findMatchDecorationModel)==null||n.dispose(),this._findMatchDecorationModel=void 0),this._notebookEditorWidget=null)}updateNotebookMatches(e,t){var i;this._notebookEditorWidget&&(this._notebookEditorWidget.getId()!==this._lastEditorWidgetIdForUpdate&&(this._cellMatches.clear(),this._lastEditorWidgetIdForUpdate=this._notebookEditorWidget.getId()),e.forEach(n=>{let s=this._cellMatches.get(n.cell.id);s||(s=new vB(this,n.cell,n.index)),s.addContentMatches(_4(n.contentMatches,n.cell)),s.addWebviewMatches(w4(n.webviewMatches)),this._cellMatches.set(s.id,s)}),(i=this._findMatchDecorationModel)==null||i.setAllFindMatchesDecorations(e),this._onChange.fire({forceUpdateModel:t}))}setNotebookFindMatchDecorationsUsingCellMatches(e){if(!this._findMatchDecorationModel)return;const t=e.map(i=>{const n=i.webviewMatches.map(o=>({index:o.webviewIndex})),s=i.contentMatches.map(o=>new jQ(o.range(),[o.text()]));return{cell:i.cell,index:i.cellIndex,contentMatches:s,webviewMatches:n}});try{this._findMatchDecorationModel.setAllFindMatchesDecorations(t)}catch{}}async updateMatchesForEditorWidget(){var i,n,s,o;if(!this._notebookEditorWidget)return;this._textMatches=new Map;const e=this._query.isWordMatch&&this._query.wordSeparators?this._query.wordSeparators:null,t=await this._notebookEditorWidget.find(this._query.pattern,{regex:this._query.isRegExp,wholeWord:this._query.isWordMatch,caseSensitive:this._query.isCaseSensitive,wordSeparators:e??void 0,includeMarkupInput:(i=this._query.notebookInfo)==null?void 0:i.isInNotebookMarkdownInput,includeMarkupPreview:(n=this._query.notebookInfo)==null?void 0:n.isInNotebookMarkdownPreview,includeCodeInput:(s=this._query.notebookInfo)==null?void 0:s.isInNotebookCellInput,includeOutput:(o=this._query.notebookInfo)==null?void 0:o.isInNotebookCellOutput},_t.None,!1,!0);this.updateNotebookMatches(t,!0)}async showMatch(e){const t=await this.highlightCurrentFindMatchDecoration(e);this.setSelectedMatch(e),this.revealCellRange(e,t)}async highlightCurrentFindMatchDecoration(e){return this._findMatchDecorationModel?e.webviewIndex===void 0?this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInCell(e.cell,e.range()):this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInWebview(e.cell,e.webviewIndex):null}revealCellRange(e,t){this._notebookEditorWidget&&(e.webviewIndex!==void 0?this._notebookEditorWidget.getCellIndex(e.cell)!==void 0&&this._notebookEditorWidget.revealCellOffsetInCenterAsync(e.cell,t??0):(e.cell.updateEditState(d0.Editing,"focusNotebookCell"),this._notebookEditorWidget.setCellEditorSelection(e.cell,e.range()),this._notebookEditorWidget.revealRangeInCenterIfOutsideViewportAsync(e.cell,e.range())))}};Vs._CURRENT_FIND_MATCH=ba.register({description:"search-current-find-match",stickiness:1,zIndex:13,className:"currentFindMatch",overviewRuler:{color:Ky(mC),position:Qw.Center},minimap:{color:Ky(Iq),position:Tq.Inline}});Vs._FIND_MATCH=ba.register({description:"search-find-match",stickiness:1,className:"findMatch",overviewRuler:{color:Ky(mC),position:Qw.Center},minimap:{color:Ky(Iq),position:Tq.Inline}});Vs=T([v(6,_i),v(7,Gf),v(8,Qi),v(9,zf)],Vs);let ya=class S4 extends ne{constructor(e,t,i,n,s,o,a,c,d,l,u){super(),this._resource=e,this._id=t,this._index=i,this._query=n,this._parent=s,this._searchModel=o,this._closestRoot=a,this.replaceService=c,this.instantiationService=d,this.uriIdentityService=u,this._onChange=this._register(new A),this.onChange=this._onChange.event,this._onDispose=this._register(new A),this.onDispose=this._onDispose.event,this._replacingAll=!1,this._fileMatches=new ki,this._folderMatches=new ki,this._folderMatchesMap=pc.forUris(h=>this.uriIdentityService.extUri.ignorePathCasing(h)),this._unDisposedFileMatches=new ki,this._unDisposedFolderMatches=new ki,this._name=new Tg(()=>this.resource?l.getUriBasenameLabel(this.resource):"")}get searchModel(){return this._searchModel}get showHighlights(){return this._parent.showHighlights}get closestRoot(){return this._closestRoot}set replacingAll(e){this._replacingAll=e}id(){return this._id}get resource(){return this._resource}index(){return this._index}name(){return this._name.value}parent(){return this._parent}bindModel(e){const t=this._fileMatches.get(e.uri);if(t)t.bindModel(e);else{const i=this.getFolderMatch(e.uri),n=i==null?void 0:i.getDownstreamFileMatch(e.uri);n==null||n.bindModel(e)}}async bindNotebookEditorWidget(e,t){const i=this._fileMatches.get(t);if(i)i.bindNotebookEditorWidget(e),await i.updateMatchesForEditorWidget();else{const n=this.folderMatchesIterator();for(const s of n)await s.bindNotebookEditorWidget(e,t)}}unbindNotebookEditorWidget(e,t){const i=this._fileMatches.get(t);if(i)i.unbindNotebookEditorWidget(e);else{const n=this.folderMatchesIterator();for(const s of n)s.unbindNotebookEditorWidget(e,t)}}createIntermediateFolderMatch(e,t,i,n,s){const o=this.instantiationService.createInstance(K_,e,t,i,n,this,this._searchModel,s);return this.configureIntermediateMatch(o),this.doAddFolder(o),o}configureIntermediateMatch(e){const t=e.onChange(i=>this.onFolderChange(e,i));e.onDispose(()=>t.dispose())}clear(e=!1){const t=this.allDownstreamFileMatches();this.disposeMatches(),this._onChange.fire({elements:t,removed:!0,added:!1,clearingAll:e})}remove(e){Array.isArray(e)||(e=[e]);const t=SB(e);this.doRemoveFile(t)}async replace(e){return this.replaceService.replace([e]).then(()=>{this.doRemoveFile([e],!0,!0,!0)})}replaceAll(){const e=this.matches();return this.batchReplace(e)}matches(){return[...this.fileMatchesIterator(),...this.folderMatchesIterator()]}fileMatchesIterator(){return this._fileMatches.values()}folderMatchesIterator(){return this._folderMatches.values()}isEmpty(){return this.fileCount()+this.folderCount()===0}getDownstreamFileMatch(e){const t=this._fileMatches.get(e);if(t)return t;const i=this.getFolderMatch(e),n=i==null?void 0:i.getDownstreamFileMatch(e);return n||null}allDownstreamFileMatches(){let e=[];const t=this.folderMatchesIterator();for(const i of t)e=e.concat(i.allDownstreamFileMatches());return[...this.fileMatchesIterator(),...e]}fileCount(){return this._fileMatches.size}folderCount(){return this._folderMatches.size}count(){return this.fileCount()+this.folderCount()}recursiveFileCount(){return this.allDownstreamFileMatches().length}recursiveMatchCount(){return this.allDownstreamFileMatches().reduce((e,t)=>e+t.count(),0)}get query(){return this._query}addFileMatch(e,t){const i=[],n=[];e.forEach(o=>{var c;const a=this.getDownstreamFileMatch(o.resource);if(a)o.results.filter(hg).forEach(d=>{u0(d,a).forEach(l=>a.add(l))}),y4(o)&&((c=o.cellResults)==null||c.forEach(d=>{const l=a.getCellMatch(d.cell.id);l?(l.addContentMatches(d.contentResults),l.addContentMatches(d.webviewResults)):a.addCellMatch(d)})),n.push(a),a.addContext(o.results);else if(this instanceof jE||this instanceof BE){const d=this.createAndConfigureFileMatch(o);i.push(d)}});const s=[...i,...n];!t&&s.length&&this._onChange.fire({elements:s,added:!!i.length})}doAddFile(e){this._fileMatches.set(e.resource,e),this._unDisposedFileMatches.has(e.resource)&&this._unDisposedFileMatches.delete(e.resource)}hasOnlyReadOnlyMatches(){return Array.from(this._fileMatches.values()).every(e=>e.hasOnlyReadOnlyMatches())}uriHasParent(e,t){return this.uriIdentityService.extUri.isEqualOrParent(t,e)&&!this.uriIdentityService.extUri.isEqual(t,e)}isInParentChain(e){let t=this;for(;t instanceof S4;){if(t.id()===e.id())return!0;t=t.parent()}return!1}getFolderMatch(e){return this._folderMatchesMap.findSubstr(e)}doAddFolder(e){if(this instanceof K_&&!this.uriHasParent(this.resource,e.resource))throw Error(`${e.resource} does not belong as a child of ${this.resource}`);if(this.isInParentChain(e))throw Error(`${e.resource} is a parent of ${this.resource}`);this._folderMatches.set(e.resource,e),this._folderMatchesMap.set(e.resource,e),this._unDisposedFolderMatches.has(e.resource)&&this._unDisposedFolderMatches.delete(e.resource)}async batchReplace(e){const t=SB(e);await this.replaceService.replace(t),this.doRemoveFile(t,!0,!0,!0)}onFileChange(e,t=!1){let i=!1;this._fileMatches.has(e.resource)||(this.doAddFile(e),i=!0),e.count()===0&&(this.doRemoveFile([e],!1,!1),i=!1,t=!0),this._replacingAll||this._onChange.fire({elements:[e],added:i,removed:t})}onFolderChange(e,t){this._folderMatches.has(e.resource)||this.doAddFolder(e),e.isEmpty()&&(this._folderMatches.delete(e.resource),e.dispose()),this._onChange.fire(t)}doRemoveFile(e,t=!0,i=!0,n=!1){const s=[];for(const o of e)if(this._fileMatches.get(o.resource)){if(n&&o.hasWebviewMatches())continue;this._fileMatches.delete(o.resource),t?o.dispose():this._unDisposedFileMatches.set(o.resource,o),s.push(o)}else{const a=this.getFolderMatch(o.resource);if(a)a.doRemoveFile([o],t,i);else throw Error(`FileMatch ${o.resource} is not located within FolderMatch ${this.resource}`)}i&&this._onChange.fire({elements:s,removed:!0})}disposeMatches(){[...this._fileMatches.values()].forEach(e=>e.dispose()),[...this._folderMatches.values()].forEach(e=>e.disposeMatches()),[...this._unDisposedFileMatches.values()].forEach(e=>e.dispose()),[...this._unDisposedFolderMatches.values()].forEach(e=>e.disposeMatches()),this._fileMatches.clear(),this._folderMatches.clear(),this._unDisposedFileMatches.clear(),this._unDisposedFolderMatches.clear()}dispose(){this.disposeMatches(),this._onDispose.fire(),super.dispose()}};ya=T([v(7,Gf),v(8,Te),v(9,Qi),v(10,Hi)],ya);let K_=class extends ya{constructor(e,t,i,n,s,o,a,c,d,l,u){super(e,t,i,n,s,o,a,c,d,l,u)}get resource(){return this._resource}};K_=T([v(7,Gf),v(8,Te),v(9,Qi),v(10,Hi)],K_);let jE=class extends K_{constructor(e,t,i,n,s,o,a,c,d,l){super(e,t,i,n,s,o,null,a,c,d,l)}normalizedUriParent(e){return this.uriIdentityService.extUri.normalizePath(this.uriIdentityService.extUri.dirname(e))}uriEquals(e,t){return this.uriIdentityService.extUri.isEqual(e,t)}createFileMatch(e,t,i,n,s,o){const a=this.instantiationService.createInstance(Vs,e,t,i,n,s,o);n.doAddFile(a);const c=a.onChange(({didRemove:d})=>n.onFileChange(a,d));return a.onDispose(()=>c.dispose()),a}createAndConfigureFileMatch(e){if(!this.uriHasParent(this.resource,e.resource))throw Error(`${e.resource} is not a descendant of ${this.resource}`);const t=[],i=this.uriIdentityService.extUri.normalizePath(this.resource);let n=this.normalizedUriParent(e.resource);for(;!this.uriEquals(i,n);){t.unshift(n);const a=n;if(n=this.normalizedUriParent(n),this.uriEquals(a,n))throw Error(`${e.resource} is not correctly configured as a child of ${i}`)}const s=this.closestRoot??this;let o=this;for(let a=0;a<t.length;a++){let c=o.getFolderMatch(t[a]);c||(c=o.createIntermediateFolderMatch(t[a],t[a].toString(),-1,this._query,s)),o=c}return this.createFileMatch(this._query.contentPattern,this._query.previewOptions,this._query.maxResults,o,e,s)}};jE=T([v(6,Gf),v(7,Te),v(8,Qi),v(9,Hi)],jE);let BE=class extends ya{constructor(e,t,i,n,s,o,a,c,d){super(null,e,t,i,n,s,null,o,a,c,d)}createAndConfigureFileMatch(e){const t=this.instantiationService.createInstance(Vs,this._query.contentPattern,this._query.previewOptions,this._query.maxResults,this,e,null);this.doAddFile(t);const i=t.onChange(({didRemove:n})=>this.onFileChange(t,n));return t.onDispose(()=>i.dispose()),t}};BE=T([v(5,Gf),v(6,Te),v(7,Qi),v(8,Hi)],BE);let OR=-1,NR=-1;function Gle(r,e,t="default"){if(r instanceof Vs&&e instanceof ya)return 1;if(e instanceof Vs&&r instanceof ya)return-1;if(r instanceof ya&&e instanceof ya){if(OR=r.index(),NR=e.index(),OR!==-1&&NR!==-1)return OR-NR;switch(t){case"countDescending":return e.count()-r.count();case"countAscending":return r.count()-e.count();case"type":return hH(r.name(),e.name());case"fileNames":return Db(r.name(),e.name());default:return!r.resource||!e.resource?0:vC(r.resource.fsPath,e.resource.fsPath)||Db(r.name(),e.name())}}if(r instanceof Vs&&e instanceof Vs)switch(t){case"countDescending":return e.count()-r.count();case"countAscending":return r.count()-e.count();case"type":return hH(r.name(),e.name());case"fileNames":return Db(r.name(),e.name());case"modified":{const i=r.fileStat,n=e.fileStat;if(i&&n)return n.mtime-i.mtime}default:return vC(r.resource.fsPath,e.resource.fsPath)||Db(r.name(),e.name())}return r instanceof Vp&&e instanceof Vp?zle(r,e):r instanceof Ra&&e instanceof Ra?qe.compareRangesUsingStarts(r.range(),e.range()):0}function zle(r,e){return r.cellIndex===e.cellIndex?r.webviewIndex!==void 0&&e.webviewIndex!==void 0?r.webviewIndex-e.webviewIndex:r.webviewIndex===void 0&&e.webviewIndex===void 0?qe.compareRangesUsingStarts(r.range(),e.range()):r.webviewIndex!==void 0?1:-1:r.cellIndex<e.cellIndex?-1:1}function LPe(r,e,t="default"){const i=yB(r),n=yB(e);let s=i.length-1,o=n.length-1;for(;s>=0&&o>=0;){if(i[s].id()!==n[o].id())return Gle(i[s],n[o],t);s--,o--}const a=s===0,c=o===0;return a&&!c?1:!a&&c?-1:0}function yB(r){const e=[];let t=r;for(;!(t instanceof Q_);)e.push(t),t=t.parent();return e}let Q_=class extends ne{constructor(e,t,i,n,s,o){super(),this._searchModel=e,this.replaceService=t,this.instantiationService=i,this.modelService=n,this.uriIdentityService=s,this.notebookEditorService=o,this._onChange=this._register(new fC({merge:this.mergeEvents})),this.onChange=this._onChange.event,this._folderMatches=[],this._otherFilesMatch=null,this._folderMatchesMap=pc.forUris(a=>this.uriIdentityService.extUri.ignorePathCasing(a)),this._showHighlights=!1,this._query=null,this.disposePastResults=()=>{},this._isDirty=!1,this._rangeHighlightDecorations=this.instantiationService.createInstance(UE),this._register(this.modelService.onModelAdded(a=>this.onModelAdded(a))),this._register(this.notebookEditorService.onDidAddNotebookEditor(a=>{a instanceof Ule&&this.onDidAddNotebookEditorWidget(a)})),this._register(this.onChange(a=>{a.removed&&(this._isDirty=!this.isEmpty())}))}async batchReplace(e){try{this._onChange.pause(),await Promise.all(e.map(async t=>{const i=t.parent();(i instanceof ya||i instanceof Vs)&&bB(i,e)||(t instanceof Vs?await t.parent().replace(t):t instanceof Ra?await t.parent().replace(t):t instanceof ya&&await t.replaceAll())}))}finally{this._onChange.resume()}}batchRemove(e){const t=[];try{this._onChange.pause(),e.forEach(i=>{bB(i,t)||(i.parent().remove(i),t.push(i))})}finally{this._onChange.resume()}}get isDirty(){return this._isDirty}get query(){return this._query}set query(e){const t=this.folderMatches();new Promise(i=>this.disposePastResults=i).then(()=>t.forEach(i=>i.clear())).then(()=>t.forEach(i=>i.dispose())).then(()=>this._isDirty=!1),this._rangeHighlightDecorations.removeHighlightRange(),this._folderMatchesMap=pc.forUris(i=>this.uriIdentityService.extUri.ignorePathCasing(i)),e&&(this._folderMatches=(e&&e.folderQueries||[]).map(i=>i.folder).map((i,n)=>this._createBaseFolderMatch(i,i.toString(),n,e)),this._folderMatches.forEach(i=>this._folderMatchesMap.set(i.resource,i)),this._otherFilesMatch=this._createBaseFolderMatch(null,"otherFiles",this._folderMatches.length+1,e),this._query=e)}mergeEvents(e){const t={elements:[],added:!1,removed:!1};return e.forEach(i=>{i.added&&(t.added=!0),i.removed&&(t.removed=!0),t.elements=t.elements.concat(i.elements)}),t}onDidAddNotebookEditorWidget(e){var t,i;(t=this._onWillChangeModelListener)==null||t.dispose(),this._onWillChangeModelListener=e.onWillChangeModel(n=>{n&&this.onNotebookEditorWidgetRemoved(e,n==null?void 0:n.uri)}),(i=this._onDidChangeModelListener)==null||i.dispose(),this._onDidChangeModelListener=e.onDidAttachViewModel(()=>{e.hasModel()&&this.onNotebookEditorWidgetAdded(e,e.textModel.uri)})}onModelAdded(e){const t=this._folderMatchesMap.findSubstr(e.uri);t==null||t.bindModel(e)}async onNotebookEditorWidgetAdded(e,t){const i=this._folderMatchesMap.findSubstr(t);await(i==null?void 0:i.bindNotebookEditorWidget(e,t))}onNotebookEditorWidgetRemoved(e,t){const i=this._folderMatchesMap.findSubstr(t);i==null||i.unbindNotebookEditorWidget(e,t)}_createBaseFolderMatch(e,t,i,n){let s;e?s=this.instantiationService.createInstance(jE,e,t,i,n,this,this._searchModel):s=this.instantiationService.createInstance(BE,t,i,n,this,this._searchModel);const o=s.onChange(a=>this._onChange.fire(a));return s.onDispose(()=>o.dispose()),s}get searchModel(){return this._searchModel}add(e,t=!1){var s;const{byFolder:i,other:n}=this.groupFilesByFolder(e);i.forEach(o=>{if(!o.length)return;const a=this.getFolderMatch(o[0].resource);a==null||a.addFileMatch(o,t)}),(s=this._otherFilesMatch)==null||s.addFileMatch(n,t),this.disposePastResults()}clear(){this.folderMatches().forEach(e=>e.clear(!0)),this.disposeMatches(),this._folderMatches=[],this._otherFilesMatch=null}remove(e){Array.isArray(e)||(e=[e]),e.forEach(s=>{s instanceof ya&&s.clear()});const t=e.filter(s=>s instanceof Vs),{byFolder:i,other:n}=this.groupFilesByFolder(t);i.forEach(s=>{s.length&&this.getFolderMatch(s[0].resource).remove(s)}),n.length&&this.getFolderMatch(n[0].resource).remove(n)}replace(e){return this.getFolderMatch(e.resource).replace(e)}replaceAll(e){return this.replacingAll=!0,this.replaceService.replace(this.matches(),e).then(()=>{this.replacingAll=!1,this.clear()},()=>{this.replacingAll=!1})}folderMatches(){return this._otherFilesMatch?[...this._folderMatches,this._otherFilesMatch]:[...this._folderMatches]}matches(){const e=[];return this.folderMatches().forEach(t=>{e.push(t.allDownstreamFileMatches())}),[].concat(...e)}isEmpty(){return this.folderMatches().every(e=>e.isEmpty())}fileCount(){return this.folderMatches().reduce((e,t)=>e+t.recursiveFileCount(),0)}count(){return this.matches().reduce((e,t)=>e+t.count(),0)}get showHighlights(){return this._showHighlights}toggleHighlights(e){if(this._showHighlights===e)return;this._showHighlights=e;let t=null;this.matches().forEach(i=>{i.updateHighlights(),t||(t=i.getSelectedMatch())}),this._showHighlights&&t?this._rangeHighlightDecorations.highlightRange(t.parent().resource,t.range()):this._rangeHighlightDecorations.removeHighlightRange()}get rangeHighlightDecorations(){return this._rangeHighlightDecorations}getFolderMatch(e){const t=this._folderMatchesMap.findSubstr(e);return t||this._otherFilesMatch}set replacingAll(e){this.folderMatches().forEach(t=>{t.replacingAll=e})}groupFilesByFolder(e){const t=new ki,i=[];return this._folderMatches.forEach(n=>t.set(n.resource,[])),e.forEach(n=>{const s=this.getFolderMatch(n.resource);if(!s)return;const o=s.resource;o?t.get(o).push(n):i.push(n)}),{byFolder:t,other:i}}disposeMatches(){this.folderMatches().forEach(e=>e.dispose()),this._folderMatches=[],this._folderMatchesMap=pc.forUris(e=>this.uriIdentityService.extUri.ignorePathCasing(e)),this._rangeHighlightDecorations.removeHighlightRange()}dispose(){var e,t;(e=this._onWillChangeModelListener)==null||e.dispose(),(t=this._onDidChangeModelListener)==null||t.dispose(),this.disposePastResults(),this.disposeMatches(),this._rangeHighlightDecorations.dispose(),super.dispose()}};Q_=T([v(1,Gf),v(2,Te),v(3,_i),v(4,Hi),v(5,zf)],Q_);let l0=class extends ne{constructor(e,t,i,n,s,o){super(),this.searchService=e,this.telemetryService=t,this.configurationService=i,this.instantiationService=n,this.uriIdentityService=s,this.notebookEditorService=o,this._searchQuery=null,this._replaceActive=!1,this._replaceString=null,this._replacePattern=null,this._preserveCase=!1,this._startStreamDelay=Promise.resolve(),this._resultQueue=[],this._onReplaceTermChanged=this._register(new A),this.onReplaceTermChanged=this._onReplaceTermChanged.event,this.currentCancelTokenSource=null,this.searchCancelledForNewSearch=!1,this._searchResult=this.instantiationService.createInstance(Q_,this)}isReplaceActive(){return this._replaceActive}set replaceActive(e){this._replaceActive=e}get replacePattern(){return this._replacePattern}get replaceString(){return this._replaceString||""}set preserveCase(e){this._preserveCase=e}get preserveCase(){return this._preserveCase}set replaceString(e){this._replaceString=e,this._searchQuery&&(this._replacePattern=new gB(e,this._searchQuery.contentPattern)),this._onReplaceTermChanged.fire()}get searchResult(){return this._searchResult}async getLocalNotebookResults(e,t){var s,o,a,c;const i=new ki(d=>this.uriIdentityService.extUri.getComparisonKey(d));let n=!1;if(e.type===2){const d=this.notebookEditorService.retrieveAllExistingWidgets();for(const l of d){const u=l.value;if(!u||!u.viewModel)continue;const h=pr(e.maxResults)?e.maxResults+1:Number.MAX_SAFE_INTEGER;let g=await u.find(e.contentPattern.pattern,{regex:e.contentPattern.isRegExp,wholeWord:e.contentPattern.isWordMatch,caseSensitive:e.contentPattern.isCaseSensitive,includeMarkupInput:(s=e.contentPattern.notebookInfo)==null?void 0:s.isInNotebookMarkdownInput,includeMarkupPreview:(o=e.contentPattern.notebookInfo)==null?void 0:o.isInNotebookMarkdownPreview,includeCodeInput:(a=e.contentPattern.notebookInfo)==null?void 0:a.isInNotebookCellInput,includeOutput:(c=e.contentPattern.notebookInfo)==null?void 0:c.isInNotebookCellOutput},t,!1,!0);if(g.length){h&&g.length>=h&&(n=!0,g=g.slice(0,h-1));const m=g.map(_=>{const b=_4(_.contentMatches,_.cell),E=w4(_.webviewMatches);return{cell:_.cell,index:_.index,contentResults:b,webviewResults:E}}),y={resource:u.viewModel.uri,cellResults:m};i.set(u.viewModel.uri,y)}else i.set(u.viewModel.uri,null)}}return{results:i,limitHit:n}}async notebookSearch(e,t,i){const n=await this.getLocalNotebookResults(e,t);return i&&fi([...n.results.values()]).forEach(i),{completeData:{messages:[],limitHit:n.limitHit,results:fi([...n.results.values()])},scannedFiles:new sk([...n.results.keys()],s=>this.uriIdentityService.extUri.getComparisonKey(s))}}async doSearch(e,t,i,n){const s=this.currentCancelTokenSource=new Xt,o=d=>{t.fire(),this.onSearchProgress(d),n==null||n(d)},a=await this.notebookSearch(e,this.currentCancelTokenSource.token,o),c=await this.searchService.textSearch(i,this.currentCancelTokenSource.token,o,a==null?void 0:a.scannedFiles);return s.dispose(),a?{...c,...a.completeData}:c}async search(e,t){this.cancelSearch(!0),this._searchQuery=e,this.searchConfig.searchOnType||this.searchResult.clear(),this._searchResult.query=this._searchQuery;const i=new A;this._replacePattern=new gB(this.replaceString,this._searchQuery.contentPattern),this._startStreamDelay=new Promise(o=>setTimeout(o,this.searchConfig.searchOnType?150:0));const n=this.doSearch(e,i,this._searchQuery,t),s=Date.now();Promise.race([n,F.toPromise(i.event)]).finally(()=>{this.telemetryService.publicLog("searchResultsFirstRender",{duration:Date.now()-s})}),n.then(o=>this.onSearchCompleted(o,Date.now()-s),o=>this.onSearchError(o,Date.now()-s));try{return await n}finally{this.telemetryService.publicLog("searchResultsFinished",{duration:Date.now()-s})}}onSearchCompleted(e,t){if(!this._searchQuery)throw new Error("onSearchCompleted must be called after a search is started");this._searchResult.add(this._resultQueue),this._resultQueue.length=0;const i=Object.assign({},this._searchQuery.contentPattern);delete i.pattern;const n=e&&e.stats,s=this._searchQuery.folderQueries.every(c=>c.folder.scheme===pe.file),o=this._searchQuery.folderQueries.every(c=>c.folder.scheme!==pe.file),a=s?pe.file:o?"other":"mixed";return this.telemetryService.publicLog("searchResultsShown",{count:this._searchResult.count(),fileCount:this._searchResult.fileCount(),options:i,duration:t,type:n&&n.type,scheme:a,searchOnTypeEnabled:this.searchConfig.searchOnType}),e}onSearchError(e,t){Ur(e)&&(this.onSearchCompleted(this.searchCancelledForNewSearch?{exit:1,results:[],messages:[]}:null,t),this.searchCancelledForNewSearch=!1)}async onSearchProgress(e){e.resource&&(this._resultQueue.push(e),await this._startStreamDelay,this._resultQueue.length&&(this._searchResult.add(this._resultQueue,!0),this._resultQueue.length=0))}get searchConfig(){return this.configurationService.getValue("search")}cancelSearch(e=!1){return this.currentCancelTokenSource?(this.searchCancelledForNewSearch=e,this.currentCancelTokenSource.cancel(),!0):!1}dispose(){this.cancelSearch(),this.searchResult.dispose(),super.dispose()}};l0=T([v(0,cb),v(1,gi),v(2,We),v(3,Te),v(4,Hi),v(5,zf)],l0);let _B=class{constructor(e){this.instantiationService=e,this._searchModel=null}get searchModel(){return this._searchModel||(this._searchModel=this.instantiationService.createInstance(l0)),this._searchModel}};_B=T([v(0,Te)],_B);const Kle=re("searchWorkbenchService");let UE=class C4{constructor(e){this._modelService=e,this._decorationId=null,this._model=null,this._modelDisposables=new me}removeHighlightRange(){if(this._model&&this._decorationId){const e=this._decorationId;this._model.changeDecorations(t=>{t.removeDecoration(e)})}this._decorationId=null}highlightRange(e,t,i=0){let n;k.isUri(e)?n=this._modelService.getModel(e):n=e,n&&this.doHighlightRange(n,t)}doHighlightRange(e,t){this.removeHighlightRange(),e.changeDecorations(i=>{this._decorationId=i.addDecoration(t,C4._RANGE_HIGHLIGHT_DECORATION)}),this.setModel(e)}setModel(e){this._model!==e&&(this.clearModelListeners(),this._model=e,this._modelDisposables.add(this._model.onDidChangeDecorations(t=>{this.clearModelListeners(),this.removeHighlightRange(),this._model=null})),this._modelDisposables.add(this._model.onWillDispose(()=>{this.clearModelListeners(),this.removeHighlightRange(),this._model=null})))}clearModelListeners(){this._modelDisposables.clear()}dispose(){this._model&&(this.removeHighlightRange(),this._modelDisposables.dispose(),this._model=null)}};UE._RANGE_HIGHLIGHT_DECORATION=ba.register({description:"search-range-highlight",stickiness:1,className:"rangeHighlight",isWholeLine:!0});UE=T([v(0,_i)],UE);function u0(r,e){const t=r.preview.text.split(`
`);if(Array.isArray(r.ranges))return r.ranges.map((i,n)=>{const s=r.preview.matches[n];return new Ra(e,t,s,i)});{const i=r.preview.matches;return[new Ra(e,t,i,r.ranges)]}}function wB(r,e){return[]}function bB(r,e){do if(e.includes(r))return!0;while(!(r.parent()instanceof Q_)&&(r=r.parent()));return!1}function SB(r){const e=[],t=[];return r.forEach(i=>{i instanceof Vs?t.push(i):e.push(i)}),t.concat(e.map(i=>i.allDownstreamFileMatches()).flat())}const C$=re("INotebookModelResolverService"),Qle=re("workingCopyEditorService");let h0=class extends ne{constructor(e){super(),this.editorService=e,this._onDidRegisterHandler=this._register(new A),this.onDidRegisterHandler=this._onDidRegisterHandler.event,this.handlers=new Set}registerHandler(e){return this.handlers.add(e),this._onDidRegisterHandler.fire(e),ot(()=>this.handlers.delete(e))}findEditor(e){for(const t of this.editorService.getEditors(0))if(this.isOpen(e,t.editor))return t}isOpen(e,t){for(const i of this.handlers)if(i.isOpen(e,t))return!0;return!1}};h0=T([v(0,Ke)],h0);class Yle{constructor(){this.todo=[],this.add=e=>{this.todo.push(e)}}take(e,t){this.add=i=>t.createInstance(i,e),this.todo.forEach(this.add),this.todo=[]}}const Xle=new Yle,E4=re("IUserActivityService");let f0=class extends ne{constructor(e){super(),this.markInactive=this._register(new Ys(()=>{this.isActive=!1,this.changeEmitter.fire(!1)},1e4)),this.changeEmitter=this._register(new A),this.active=0,this.isActive=!0,this.onDidChangeIsActive=this.changeEmitter.event,this._register(Vy(()=>Xle.take(this,e)))}markActive(){return++this.active===1&&(this.isActive=!0,this.changeEmitter.fire(!0),this.markInactive.cancel()),ot(()=>{--this.active===0&&this.markInactive.schedule()})}};f0=T([v(0,Te)],f0);class Jle{constructor(){this._providers=new Map}registerCanonicalUriProvider(e){return this._providers.set(e.scheme,e),{dispose:()=>this._providers.delete(e.scheme)}}async provideCanonicalUri(e,t,i){const n=this._providers.get(e.scheme);if(n)return n.provideCanonicalUri(e,t,i)}}const x4=re("canonicalUriIdentityService"),E$=re("IExtensionStatusBarItemService");let VE=class{constructor(e){this._statusbarService=e,this._entries=new Map,this._onDidChange=new A,this.onDidChange=this._onDidChange.event}dispose(){this._entries.forEach(e=>e.accessor.dispose()),this._entries.clear(),this._onDidChange.dispose()}setOrUpdateEntry(e,t,i,n,s,o,a,c,d,l,u,h){let g,m;if(h)g=h.label,m=h.role;else if(g=UQ(s),o){const E=typeof o=="string"?o:o.value;g+=`, ${E}`}const y={name:n,text:s,tooltip:o,command:a,color:c,backgroundColor:d,ariaLabel:g,role:m};typeof u>"u"&&(u=0);let _=l?0:1;const b=this._entries.get(e);if(b&&(_=b.alignment,u=b.priority),b)return b.accessor.update(y),b.entry=y,1;{let E;typeof i=="string"?E={primary:u,secondary:yc(i)}:E=u;const D=this._statusbarService.addEntry(y,t,_,E);return this._entries.set(e,{accessor:D,entry:y,alignment:_,priority:u,disposable:ot(()=>{D.dispose(),this._entries.delete(e),this._onDidChange.fire({removed:e})})}),this._onDidChange.fire({added:[e,{entry:y,alignment:_,priority:u}]}),0}}unsetEntry(e){var t;(t=this._entries.get(e))==null||t.disposable.dispose(),this._entries.delete(e)}getEntries(){return this._entries.entries()}};VE=T([v(0,o4)],VE);ie(E$,VE,1);const Zle=re("WorkbenchAssignmentService"),eue=st.as(ks.Configuration);eue.registerConfiguration({...d$,properties:{"workbench.enableExperiments":{type:"boolean",description:p("workbench.enableExperiments","Fetches experiments to run from a Microsoft online service."),default:!0,scope:1,restricted:!0,tags:["usesOnlineServices"]}}});const D4=re("IChatService"),tue=re("embedderTerminalService"),x$=re("customEditorService"),jPe=new G("activeCustomEditorId","",{type:"string",description:p("context.customEditor","The viewType of the currently active custom editor.")}),BPe=new G("focusedCustomEditorIsEditable",!1);class UPe{constructor(e){this.id=e.id,this.displayName=e.displayName,this.providerDisplayName=e.providerDisplayName,this.priority=e.priority,this.selector=e.selector}matches(e){return this.selector.some(t=>t.filenamePattern&&zde(t.filenamePattern,e))}}class VPe{constructor(e){this.allEditors=Mf(e,t=>t.id)}get length(){return this.allEditors.length}get defaultEditor(){return this.allEditors.find(e=>{switch(e.priority){case id.default:case id.builtin:return this.allEditors.every(t=>t===e||iue(t,e));default:return!1}})}get bestAvailableEditor(){return Array.from(this.allEditors).sort((t,i)=>FE(t.priority)-FE(i.priority))[0]}}function iue(r,e){return FE(r.priority)<FE(e.priority)}class Rn{constructor(e,t){this.storageService=t,this.id=Rn.COMMON_PREFIX+e}getMemento(e,t){switch(e){case 1:{let i=Rn.workspaceMementos.get(this.id);return i||(i=new $R(this.id,e,t,this.storageService),Rn.workspaceMementos.set(this.id,i)),i.getMemento()}case 0:{let i=Rn.profileMementos.get(this.id);return i||(i=new $R(this.id,e,t,this.storageService),Rn.profileMementos.set(this.id,i)),i.getMemento()}case-1:{let i=Rn.applicationMementos.get(this.id);return i||(i=new $R(this.id,e,t,this.storageService),Rn.applicationMementos.set(this.id,i)),i.getMemento()}}}saveMemento(){var e,t,i;(e=Rn.workspaceMementos.get(this.id))==null||e.save(),(t=Rn.profileMementos.get(this.id))==null||t.save(),(i=Rn.applicationMementos.get(this.id))==null||i.save()}static clear(e){switch(e){case 1:Rn.workspaceMementos.clear();break;case 0:Rn.profileMementos.clear();break;case-1:Rn.applicationMementos.clear();break}}}Rn.applicationMementos=new Map;Rn.profileMementos=new Map;Rn.workspaceMementos=new Map;Rn.COMMON_PREFIX="memento/";class $R{constructor(e,t,i,n){this.id=e,this.scope=t,this.target=i,this.storageService=n,this.mementoObj=this.load()}getMemento(){return this.mementoObj}load(){const e=this.storageService.get(this.id,this.scope);if(e)try{return JSON.parse(e)}catch(t){en(`[memento]: failed to parse contents: ${t} (id: ${this.id}, scope: ${this.scope}, contents: ${e})`)}return{}}save(){Dg(this.mementoObj)?this.storageService.remove(this.id,this.scope):this.storageService.store(this.id,JSON.stringify(this.mementoObj),this.scope,this.target)}}const qPe=new G("webviewFindWidgetVisible",!1),GPe=new G("webviewFindWidgetFocused",!1),zPe=new G("webviewFindWidgetEnabled",!1),UT=re("webviewService");function KPe(r,e){return r.allowMultipleAPIAcquire===e.allowMultipleAPIAcquire&&r.allowScripts===e.allowScripts&&r.allowForms===e.allowForms&&Ds(r.localResourceRoots,e.localResourceRoots,si)&&Ds(r.portMapping,e.portMapping,(t,i)=>t.extensionHostPort===i.extensionHostPort&&t.webviewPort===i.webviewPort)&&nue(r,e)}function nue(r,e){return r.enableCommandUris===e.enableCommandUris?!0:Array.isArray(r.enableCommandUris)&&Array.isArray(e.enableCommandUris)?Ds(r.enableCommandUris,e.enableCommandUris):!1}let p0=class{constructor(e,t){this._memento=new Rn(e,t),this._state=this._memento.getMemento(-1,1)}getOrigin(e,t){const i=this._getKey(e,t),n=this._state[i];if(n&&typeof n=="string")return n;const s=Nn();return this._state[i]=s,this._memento.saveMemento(),s}_getKey(e,t){return JSON.stringify({viewType:e,key:t})}};p0=T([v(1,ri)],p0);let qE=class{constructor(e,t){this._store=new p0(e,t)}getOrigin(e,t){return this._store.getOrigin(e,t.value)}};qE=T([v(1,ri)],qE);class k4 extends Rq{constructor(e,t,i){super(t),this.id=e,this.id=e,this.memento=new Rn(this.id,i),this._register(i.onWillSaveState(()=>{this.saveState(),this.memento.saveMemento()}))}getId(){return this.id}getMemento(e,t){return this.memento.getMemento(e,t)}saveState(){}}class rue extends k4{get onDidFocus(){return this._onDidFocus||(this._onDidFocus=this.registerFocusTrackEvents().onDidFocus),this._onDidFocus.event}fireOnDidFocus(){var e;(e=this._onDidFocus)==null||e.fire()}get onDidBlur(){return this._onDidBlur||(this._onDidBlur=this.registerFocusTrackEvents().onDidBlur),this._onDidBlur.event}hasFocus(){return this._hasFocus}registerFocusTrackEvents(){const e=Mi(this.getContainer()),t=this._register(Um(e)),i=this._onDidFocus=this._register(new A);this._register(t.onDidFocus(()=>{this._hasFocus=!0,i.fire()}));const n=this._onDidBlur=this._register(new A);return this._register(t.onDidBlur(()=>{this._hasFocus=!1,n.fire()})),{onDidFocus:i,onDidBlur:n}}get telemetryService(){return this._telemetryService}constructor(e,t,i,n){super(e,i,n),this._onTitleAreaUpdate=this._register(new A),this.onTitleAreaUpdate=this._onTitleAreaUpdate.event,this._hasFocus=!1,this._telemetryService=t,this.visible=!1}getTitle(){}create(e){this.parent=e}getContainer(){return this.parent}setVisible(e){this.visible!==!!e&&(this.visible=e)}focus(){}updateStyles(){super.updateStyles()}getMenuIds(){return[]}getActions(){return[]}getSecondaryActions(){return[]}getContextMenuActions(){return[]}getActionViewItem(e){}getActionsContext(){return null}getActionRunner(){return this.actionRunner||(this.actionRunner=this._register(new tb)),this.actionRunner}updateTitleArea(){this._onTitleAreaUpdate.fire()}isVisible(){return this.visible}getControl(){}}class XPe{constructor(e,t,i,n,s,o){this.ctor=e,this.id=t,this.name=i,this.cssClass=n,this.order=s,this.requestedIndex=o}instantiate(e){return e.createInstance(this.ctor)}}class JPe extends ne{constructor(){super(...arguments),this._onDidRegister=this._register(new A),this.onDidRegister=this._onDidRegister.event,this._onDidDeregister=this._register(new A),this.onDidDeregister=this._onDidDeregister.event,this.composites=[]}registerComposite(e){this.compositeById(e.id)||(this.composites.push(e),this._onDidRegister.fire(e))}deregisterComposite(e){const t=this.compositeById(e);t&&(this.composites.splice(this.composites.indexOf(t),1),this._onDidDeregister.fire(t))}getComposite(e){return this.compositeById(e)}getComposites(){return this.composites.slice(0)}compositeById(e){return this.composites.find(t=>t.id===e)}}const qp=new Fl(220,70),CB=new Fl(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),sue={showTabs:!0,highlightModifiedTabs:!1,tabCloseButton:"right",tabSizing:"fit",tabSizingFixedMinWidth:50,tabSizingFixedMaxWidth:160,pinnedTabSizing:"normal",titleScrollbarSizing:"default",focusRecentEditorAfterClose:!0,showIcons:!0,hasIcons:!0,enablePreview:!0,openPositioning:"right",openSideBySideDirection:"right",closeEmptyGroups:!0,labelFormat:"default",splitSizing:"auto",splitOnDragAndDrop:!0,centeredLayoutFixedWidth:!1,doubleClickTabToToggleEditorGroupSizes:!0};function ZPe(r){return r.affectsConfiguration("workbench.editor")||r.affectsConfiguration("workbench.iconTheme")}function eAe(r,e){var n;const t={...sue,hasIcons:e.getFileIconTheme().hasFileIcons},i=r.getValue();if((n=i==null?void 0:i.workbench)!=null&&n.editor)if(Object.assign(t,i.workbench.editor),bn(i.workbench.editor.autoLockGroups)){t.autoLockGroups=new Set;for(const[s,o]of Object.entries(i.workbench.editor.autoLockGroups))o===!0&&t.autoLockGroups.add(s)}else t.autoLockGroups=void 0;return t}function tAe(r,e,t){var i;return!e||!r.activeEditor||e.matches(r.activeEditor)?{...t,viewState:(i=r.activeEditorPane)==null?void 0:i.getViewState()}:t||Object.create(null)}class Wh extends rue{get minimumWidth(){return qp.width}get maximumWidth(){return CB.width}get minimumHeight(){return qp.height}get maximumHeight(){return CB.height}get input(){return this._input}get options(){return this._options}get group(){return this._group}get scopedContextKeyService(){}constructor(e,t,i,n){super(e,t,i,n),this.onDidChangeSizeConstraints=F.None,this._onDidChangeControl=this._register(new A),this.onDidChangeControl=this._onDidChangeControl.event}create(e){super.create(e),this.createEditor(e)}async setInput(e,t,i,n){this._input=e,this._options=t}clearInput(){this._input=void 0,this._options=void 0}setOptions(e){this._options=e}setVisible(e,t){super.setVisible(e),this.setEditorVisible(e,t)}setEditorVisible(e,t){this._group=t}setBoundarySashes(e){}getEditorMemento(e,t,i,n=10){const s=`${this.getId()}${i}`;let o=Wh.EDITOR_MEMENTOS.get(s);return o||(o=this._register(new pg(this.getId(),i,this.getMemento(1,1),n,e,t)),Wh.EDITOR_MEMENTOS.set(s,o)),o}getViewState(){}saveState(){for(const[,e]of Wh.EDITOR_MEMENTOS)e.id===this.getId()&&e.saveState();super.saveState()}dispose(){this._input=void 0,this._options=void 0,super.dispose()}}Wh.EDITOR_MEMENTOS=new Map;class pg extends ne{constructor(e,t,i,n,s,o){super(),this.id=e,this.key=t,this.memento=i,this.limit=n,this.editorGroupService=s,this.configurationService=o,this.cleanedUp=!1,this.shareEditorState=!1,this.updateConfiguration(void 0),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.updateConfiguration(e)))}updateConfiguration(e){(!e||e.affectsConfiguration(void 0,"workbench.editor.sharedViewState"))&&(this.shareEditorState=this.configurationService.getValue(void 0,"workbench.editor.sharedViewState")===!0)}saveEditorState(e,t,i){const n=this.doGetResource(t);if(!n||!e)return;const s=this.doLoad();let o=s.get(n.toString());o||(o=Object.create(null),s.set(n.toString(),o)),o[e.id]=i,this.shareEditorState&&(o[pg.SHARED_EDITOR_STATE]=i),gr(t)&&this.clearEditorStateOnDispose(n,t)}loadEditorState(e,t){const i=this.doGetResource(t);if(!i||!e)return;const s=this.doLoad().get(i.toString());if(s){const o=s[e.id];if(o)return o;if(this.shareEditorState)return s[pg.SHARED_EDITOR_STATE]}}clearEditorState(e,t){var n;gr(e)&&((n=this.editorDisposables)==null||n.delete(e));const i=this.doGetResource(e);if(i){const s=this.doLoad();if(t){const o=s.get(i.toString());o&&(delete o[t.id],Dg(o)&&s.delete(i.toString()))}else s.delete(i.toString())}}clearEditorStateOnDispose(e,t){this.editorDisposables||(this.editorDisposables=new Map),this.editorDisposables.has(t)||this.editorDisposables.set(t,F.once(t.onWillDispose)(()=>{var i;this.clearEditorState(e),(i=this.editorDisposables)==null||i.delete(t)}))}moveEditorState(e,t,i){const n=this.doLoad(),s=[...n.keys()];for(const o of s){const a=k.parse(o);if(!i.isEqualOrParent(a,e))continue;let c;if(si(e,a))c=t;else{const l=VQ(a.path,e.path);c=pt(t,a.path.substr(l+e.path.length+1))}const d=n.get(o,0);d&&(n.delete(o),n.set(c.toString(),d))}}doGetResource(e){return gr(e)?e.resource:e}doLoad(){if(!this.cache){this.cache=new qQ(this.limit);const e=this.memento[this.key];Array.isArray(e)&&this.cache.fromJSON(e)}return this.cache}saveState(){const e=this.doLoad();this.cleanedUp||(this.cleanUp(),this.cleanedUp=!0),this.memento[this.key]=e.toJSON()}cleanUp(){const e=this.doLoad(),t=[...e.entries()];for(const[i,n]of t)for(const s of Object.keys(n)){const o=Number(s);o===pg.SHARED_EDITOR_STATE&&this.shareEditorState||this.editorGroupService.getGroup(o)||(delete n[o],Dg(n)&&e.delete(i))}}}pg.SHARED_EDITOR_STATE=-1;class oue extends ne{constructor(e){super(),this._register(Ci(window,sn.DRAG_START,()=>{var i;(i=e())==null||i.windowDidDragStart()}));const t=()=>{var i;(i=e())==null||i.windowDidDragEnd()};this._register(Ci(window,sn.DRAG_END,t)),this._register(Ci(window,sn.MOUSE_MOVE,i=>{i.buttons===0&&t()}))}}class qs extends Cf{get typeId(){return qs.typeId}get editorId(){return this.viewType}get capabilities(){return 138}get resource(){return k.from({scheme:pe.webviewPanel,path:`webview-panel/webview-${this._resourceId}`})}constructor(e,t,i){super(),this._iconManager=i,this._resourceId=Nn(),this._hasTransfered=!1,this.viewType=e.viewType,this.providedId=e.providedId,this._name=e.name,this._webview=t}dispose(){var e;this.isDisposed()||this._hasTransfered||(e=this._webview)==null||e.dispose(),super.dispose()}getName(){return this._name}getTitle(e){return this.getName()}getDescription(){}setName(e){this._name=e,this.webview.setTitle(e),this._onDidChangeLabel.fire()}get webview(){return this._webview}get extension(){return this.webview.extension}get iconPath(){return this._iconPath}set iconPath(e){this._iconPath=e,this._iconManager.setIcons(this._resourceId,e)}matches(e){return super.matches(e)||e===this}get group(){return this._group}updateGroup(e){this._group=e}transfer(e){if(!this._hasTransfered)return this._hasTransfered=!0,e._webview=this._webview,e}}qs.typeId="workbench.editors.webviewInput";const T4=re("editorDropService"),Kf=Rf(uk);function iAe(r){switch(r){case 0:return"left";case 1:return"right";case 2:return"bottom";default:return"bottom"}}const aue=new G("activeWebviewPanelId","",{type:"string",description:p("context.activeWebviewId","The viewType of the currently active webview panel.")});let g0=class I4 extends Wh{get onDidFocus(){return this._onDidFocusWebview.event}constructor(e,t,i,n,s,o,a,c,d){super(I4.ID,e,t,i),this._editorService=s,this._workbenchLayoutService=o,this._editorDropService=a,this._hostService=c,this._contextKeyService=d,this._visible=!1,this._isDisposed=!1,this._webviewVisibleDisposables=this._register(new me),this._onFocusWindowHandler=this._register(new Hr),this._onDidFocusWebview=this._register(new A),this._scopedContextKeyService=this._register(new Hr),this._register(F.any(n.onDidScroll,n.onDidAddGroup,n.onDidRemoveGroup,n.onDidMoveGroup)(()=>{this.webview&&this._visible&&this.synchronizeWebviewContainerDimensions(this.webview)}))}get webview(){return this.input instanceof qs?this.input.webview:void 0}get scopedContextKeyService(){return this._scopedContextKeyService.value}createEditor(e){const t=document.createElement("div");this._element=t,this._element.id=`webview-editor-element-${Nn()}`,e.appendChild(t),this._scopedContextKeyService.value=this._contextKeyService.createScoped(t)}dispose(){var e;this._isDisposed=!0,(e=this._element)==null||e.remove(),this._element=void 0,super.dispose()}layout(e){this._dimension=e,this.webview&&this._visible&&this.synchronizeWebviewContainerDimensions(this.webview,e)}focus(){var e;super.focus(),!this._onFocusWindowHandler.value&&!ln&&(this._onFocusWindowHandler.value=this._hostService.onDidChangeFocus(t=>{t&&this._editorService.activeEditorPane===this&&this._workbenchLayoutService.hasFocus("workbench.parts.editor")&&this.focus()})),(e=this.webview)==null||e.focus()}setEditorVisible(e,t){this._visible=e,this.input instanceof qs&&this.webview&&(e?this.claimWebview(this.input):this.webview.release(this)),super.setEditorVisible(e,t)}clearInput(){this.webview&&(this.webview.release(this),this._webviewVisibleDisposables.clear()),super.clearInput()}async setInput(e,t,i,n){if(this.input&&e.matches(this.input))return;const s=e instanceof qs&&e.webview===this.webview;this.webview&&!s&&this.webview.release(this),await super.setInput(e,t,i,n),await e.resolve(t),!(n.isCancellationRequested||this._isDisposed)&&e instanceof qs&&(this.group&&e.updateGroup(this.group.id),s||this.claimWebview(e),this._dimension&&this.layout(this._dimension))}claimWebview(e){e.webview.claim(this,this.scopedContextKeyService),this._element&&(this._element.setAttribute("aria-flowto",e.webview.container.id),GQ(e.webview.container,this._element)),this._webviewVisibleDisposables.clear(),this._webviewVisibleDisposables.add(this._editorDropService.createEditorDropTarget(e.webview.container,{containsGroup:t=>{var i;return((i=this.group)==null?void 0:i.id)===t.id}})),this._webviewVisibleDisposables.add(new oue(()=>this.webview)),this.synchronizeWebviewContainerDimensions(e.webview),this._webviewVisibleDisposables.add(this.trackFocus(e.webview))}synchronizeWebviewContainerDimensions(e,t){var n;if(!((n=this._element)!=null&&n.isConnected))return;const i=this._workbenchLayoutService.getContainer("workbench.parts.editor");e.layoutWebviewOverElement(this._element.parentElement,t,i)}trackFocus(e){const t=new me,i=Um(e.container);return t.add(i),t.add(i.onDidFocus(()=>this._onDidFocusWebview.fire())),t.add(e.onDidFocus(()=>this._onDidFocusWebview.fire())),t}};g0.ID="WebviewEditor";g0=T([v(0,gi),v(1,Fi),v(2,ri),v(3,it),v(4,Ke),v(5,Kf),v(6,T4),v(7,bu),v(8,It)],g0);let m0=class{constructor(e,t){this._lifecycleService=e,this._configService=t,this._icons=new Map,this._configService.onDidChangeConfiguration(i=>{i.affectsConfiguration("workbench.iconTheme")&&this.updateStyleSheet()})}dispose(){var e;(e=this._styleElement)==null||e.remove(),this._styleElement=void 0}get styleElement(){return this._styleElement||(this._styleElement=Jw(),this._styleElement.className="webview-icons"),this._styleElement}setIcons(e,t){t?this._icons.set(e,t):this._icons.delete(e),this.updateStyleSheet()}async updateStyleSheet(){await this._lifecycleService.when(1);const e=[];if(this._configService.getValue("workbench.iconTheme")!==null)for(const[t,i]of this._icons){const n=`.show-file-icons .webview-${t}-name-file-icon::before`;try{e.push(`.monaco-workbench.vs ${n}, .monaco-workbench.hc-light ${n} { content: ""; background-image: ${Qy(i.light)}; }`,`.monaco-workbench.vs-dark ${n}, .monaco-workbench.hc-black ${n} { content: ""; background-image: ${Qy(i.dark)}; }`)}catch{}}this.styleElement.textContent=e.join(`
`)}};m0=T([v(0,ea),v(1,We)],m0);var yp,_p;const ub=re("webviewEditorService");function GE(r,e){return r.canResolve(e)}let Ef=class extends qs{constructor(e,t,i){super(e,t,i.iconManager),this._webviewWorkbenchService=i,yp.set(this,!1),_p.set(this,void 0)}dispose(){var e;super.dispose(),(e=V(this,_p,"f"))==null||e.cancel(),rt(this,_p,void 0,"f")}async resolve(){if(!V(this,yp,"f")){rt(this,yp,!0,"f"),rt(this,_p,cd(e=>this._webviewWorkbenchService.resolveWebview(this,e)),"f");try{await V(this,_p,"f")}catch(e){if(!Ur(e))throw e}}return super.resolve()}transfer(e){if(super.transfer(e))return rt(e,yp,V(this,yp,"f"),"f"),e}};yp=new WeakMap;_p=new WeakMap;Ef.__decorator=T([xt],Ef.prototype,"resolve",null);Ef=T([v(2,ub)],Ef);class cue{constructor(){this._awaitingRevival=[]}enqueueForRestoration(e,t){const i=new Hm,n=()=>{const o=this._awaitingRevival.findIndex(a=>e===a.input);o>=0&&this._awaitingRevival.splice(o,1)},s=Da(e.webview.onDidDispose(n),t.onCancellationRequested(()=>{n(),i.cancel()}));return this._awaitingRevival.push({input:e,promise:i,disposable:s}),i.p}reviveFor(e,t){const i=this._awaitingRevival.filter(({input:n})=>GE(e,n));this._awaitingRevival=this._awaitingRevival.filter(({input:n})=>!GE(e,n));for(const{input:n,promise:s,disposable:o}of i)e.resolveWebview(n,t).then(a=>s.complete(a),a=>s.error(a)).finally(()=>{o.dispose()})}}let EB=class extends ne{constructor(e,t,i,n){super(),this._editorService=t,this._instantiationService=i,this._webviewService=n,this._revivers=new Set,this._revivalPool=new cue,this._onDidChangeActiveWebviewEditor=this._register(new A),this.onDidChangeActiveWebviewEditor=this._onDidChangeActiveWebviewEditor.event,this._activeWebviewPanelIdContext=aue.bindTo(e),this._iconManager=this._register(this._instantiationService.createInstance(m0)),this._register(t.onDidActiveEditorChange(()=>{this.updateActiveWebview()})),this._register(n.onDidChangeActiveWebview(()=>{this.updateActiveWebview()})),this.updateActiveWebview()}get iconManager(){return this._iconManager}updateActiveWebview(){const e=this._editorService.activeEditor;let t;e instanceof qs?t=e:e instanceof Ss&&(e.primary instanceof qs&&e.primary.webview===this._webviewService.activeWebview?t=e.primary:e.secondary instanceof qs&&e.secondary.webview===this._webviewService.activeWebview&&(t=e.secondary)),t?this._activeWebviewPanelIdContext.set(t.webview.providedViewType??""):this._activeWebviewPanelIdContext.reset(),t!==this._activeWebview&&(this._activeWebview=t,this._onDidChangeActiveWebviewEditor.fire(t))}openWebview(e,t,i,n){const s=this._webviewService.createWebviewOverlay(e),o=this._instantiationService.createInstance(qs,{viewType:t,name:i,providedId:e.providedViewType},s,this.iconManager);return this._editorService.openEditor(o,{pinned:!0,preserveFocus:n.preserveFocus,activation:n.preserveFocus?Yy.RESTORE:void 0},n.group),o}revealWebview(e,t,i){const n=this.findTopLevelEditorForWebview(e);this._editorService.openEditor(n,{preserveFocus:i,activation:i?Yy.RESTORE:void 0},t)}findTopLevelEditorForWebview(e){for(const t of this._editorService.editors)if(t===e||t instanceof Ss&&(e===t.primary||e===t.secondary))return t;return e}openRevivedWebview(e){const t=this._webviewService.createWebviewOverlay(e.webviewInitInfo);t.state=e.state;const i=this._instantiationService.createInstance(Ef,{viewType:e.viewType,providedId:e.webviewInitInfo.providedViewType,name:e.title},t);return i.iconPath=e.iconPath,typeof e.group=="number"&&i.updateGroup(e.group),i}registerResolver(e){this._revivers.add(e);const t=new Xt;return this._revivalPool.reviveFor(e,t.token),ot(()=>{this._revivers.delete(e),t.dispose(!0)})}shouldPersist(e){return e instanceof Ef?!0:Go.some(this._revivers.values(),t=>GE(t,e))}async tryRevive(e,t){for(const i of this._revivers.values())if(GE(i,e))return await i.resolveWebview(e,t),!0;return!1}async resolveWebview(e,t){if(!await this.tryRevive(e,t)&&!t.isCancellationRequested)return this._revivalPool.enqueueForRestoration(e,t)}setIcons(e,t){this._iconManager.setIcons(e,t)}};EB=T([v(0,It),v(1,Ke),v(2,Te),v(3,UT)],EB);const R4=re("webviewViewService");class oAe extends ne{constructor(){super(...arguments),this._resolvers=new Map,this._awaitingRevival=new Map,this._onNewResolverRegistered=this._register(new A),this.onNewResolverRegistered=this._onNewResolverRegistered.event}register(e,t){if(this._resolvers.has(e))throw new Error(`View resolver already registered for ${e}`);this._resolvers.set(e,t),this._onNewResolverRegistered.fire({viewType:e});const i=this._awaitingRevival.get(e);return i&&t.resolve(i.webview,_t.None).then(()=>{this._awaitingRevival.delete(e),i.resolve()}),ot(()=>{this._resolvers.delete(e)})}resolve(e,t,i){const n=this._resolvers.get(e);if(!n){if(this._awaitingRevival.has(e))throw new Error("View already awaiting revival");let s;const o=new Promise(a=>s=a);return this._awaitingRevival.set(e,{webview:t,resolve:s}),o}return n.resolve(t,i)}}const Cy="default",v0="workbench.externalUriOpeners",y0={type:"string",enum:[]},xB="\n- `https://microsoft.com`: Matches this specific domain using https\n- `https://microsoft.com:8080`: Matches this specific domain on this port using https\n- `https://microsoft.com:*`: Matches this specific domain on any port using https\n- `https://microsoft.com/foo`: Matches `https://microsoft.com/foo` and `https://microsoft.com/foo/bar`, but not `https://microsoft.com/foobar` or `https://microsoft.com/bar`\n- `https://*.microsoft.com`: Match all domains ending in `microsoft.com` using https\n- `microsoft.com`: Match this specific domain using either http or https\n- `*.microsoft.com`: Match all domains ending in `microsoft.com` using either http or https\n- `http://192.168.0.1`: Matches this specific IP using http\n- `http://192.168.0.*`: Matches all IP's with this prefix using http\n- `*`: Match all domains using either http or https",due={...d$,properties:{[v0]:{type:"object",markdownDescription:p("externalUriOpeners","Configure the opener to use for external URIs (http, https)."),defaultSnippets:[{body:{"example.com":"$1"}}],additionalProperties:{anyOf:[{type:"string",markdownDescription:p("externalUriOpeners.uri",`Map URI pattern to an opener id.
Example patterns: 
{0}`,xB)},{type:"string",markdownDescription:p("externalUriOpeners.uri",`Map URI pattern to an opener id.
Example patterns: 
{0}`,xB),enum:[Cy],enumDescriptions:[p("externalUriOpeners.defaultId","Open using VS Code's standard opener.")]},y0]}}}};function lue(r,e){y0.enum=r,y0.enumDescriptions=e,st.as(ks.Configuration).notifyConfigurationSchemaUpdated(due)}const uue=(r,e)=>{var o;let t=r.with({query:null,fragment:null}).toString(!0);const i=a=>a.replace(/\/+$/,"");e=i(e),t=i(t);const n=Array.from({length:t.length+1}).map(()=>Array.from({length:e.length+1}).map(()=>{}));if(/^[^./:]*:\/\//.test(e))return ec(n,t,e,0,0);const s=(o=/^(https?):\/\//.exec(t))==null?void 0:o[1];return s?ec(n,t,`${s}://${e}`,0,0):!1},ec=(r,e,t,i,n)=>{var o;if(((o=r[i])==null?void 0:o[n])!==void 0)return r[i][n];const s=[];if(i===e.length)return n===t.length;if(n===t.length)return e.slice(i)[0]==="/";if(e[i]===t[n]&&s.push(ec(r,e,t,i+1,n+1)),t[n]+t[n+1]==="*."&&(["/",":"].includes(e[i])||s.push(ec(r,e,t,i+1,n)),s.push(ec(r,e,t,i,n+2))),t[n]==="*"&&(i+1===e.length?s.push(ec(r,e,t,i+1,n+1)):s.push(ec(r,e,t,i+1,n)),s.push(ec(r,e,t,i,n+1))),t[n]+t[n+1]===":*")if(e[i]===":"){let a=i+1;do a++;while(/[0-9]/.test(e[a]));s.push(ec(r,e,t,a,n+2))}else s.push(ec(r,e,t,i,n+2));return r[i][n]=s.some(a=>a===!0)},P4=re("externalUriOpenerService");let _0=class extends ne{constructor(e,t,i,n,s){super(),this.configurationService=t,this.logService=i,this.preferencesService=n,this.quickInputService=s,this._providers=new rk,this._register(e.registerExternalOpener(this))}registerExternalOpenerProvider(e){return{dispose:this._providers.push(e)}}async getOpeners(e,t,i,n){const s=await this.getAllOpenersForUri(e);if(s.size===0)return[];if(i.preferredOpenerId){if(i.preferredOpenerId===Cy)return[];const d=s.get(i.preferredOpenerId);if(d)return[d]}const o=this.getConfiguredOpenerForUri(s,e);if(o)return o===Cy?[]:[o];const a=[];if(await Promise.all(Array.from(s.values()).map(async d=>{let l;try{l=await d.canOpen(i.sourceUri,n)}catch(u){this.logService.error(u);return}switch(l){case uv.Option:case uv.Default:case uv.Preferred:a.push({opener:d,priority:l});break}})),a.length===0)return[];const c=Zh(a.filter(d=>d.priority===uv.Preferred));return c?[c.opener]:!t&&a.every(d=>d.priority===uv.Option)?[]:a.map(d=>d.opener)}async openExternal(e,t,i){const n=typeof e=="string"?k.parse(e):e,s=await this.getOpeners(n,!1,t,i);return s.length===0?!1:s.length===1?s[0].openExternalUri(n,t,i):this.showOpenerPrompt(s,n,t,i)}async getOpener(e,t,i){const n=await this.getOpeners(e,!0,t,i);if(n.length>=1)return n[0]}async getAllOpenersForUri(e){const t=new Map;return await Promise.all(Go.map(this._providers,async i=>{for await(const n of i.getOpeners(e))t.set(n.id,n)})),t}getConfiguredOpenerForUri(e,t){const i=this.configurationService.getValue(v0)||{};for(const[n,s]of Object.entries(i))if(uue(t,n)){if(s===Cy)return"default";const o=e.get(s);if(o)return o}}async showOpenerPrompt(e,t,i,n){const s=e.map(a=>({label:a.label,opener:a}));s.push({label:ln?p("selectOpenerDefaultLabel.web","Open in new browser window"):p("selectOpenerDefaultLabel","Open in default browser"),opener:void 0},{type:"separator"},{label:p("selectOpenerConfigureTitle","Configure default opener..."),opener:"configureDefault"});const o=await this.quickInputService.pick(s,{placeHolder:p("selectOpenerPlaceHolder","How would you like to open: {0}",t.toString())});return o?typeof o.opener>"u"?!1:o.opener==="configureDefault"?(await this.preferencesService.openUserSettings({jsonEditor:!0,revealSetting:{key:v0,edit:!0}}),!0):o.opener.openExternalUri(t,i,n):!0}};_0=T([v(0,us),v(1,We),v(2,ze),v(3,Q1),v(4,ss)],_0);const A4="editor.contrib.selectionClipboard";class cm extends ne{constructor(e){super(),this._editor=e,this._altListeningMouse=!1,this._altMouseTriggered=!1,this._register(this._editor.onMouseDown(t=>{this._altListeningMouse&&(this._altMouseTriggered=!0)})),this._register(this._editor.onKeyDown(t=>{t.equals(512)&&(this._altListeningMouse||(this._altMouseTriggered=!1),this._altListeningMouse=!0)})),this._register(this._editor.onKeyUp(t=>{t.equals(512)&&(this._altMouseTriggered&&t.preventDefault(),this._altListeningMouse=!1,this._altMouseTriggered=!1)}))}}cm.ID="editor.contrib.menuPreventer";Rd(cm.ID,cm,2);class hue{constructor(e){this.isBogous=!1,this.isTrivial=!1,this.usesClipboardVariable=!1,this.usesSelectionVariable=!1,this.codeSnippet=e;const t=new zN().parse(e,!1),i=new Map;let n=0;for(const o of t.placeholders)n=Math.max(n,o.index);if(t.placeholders.length===0)this.isTrivial=!0;else if(n===0){const o=zQ(t.children);this.isTrivial=o instanceof fH&&o.isFinalTabstop}const s=[...t.children];for(;s.length>0;){const o=s.shift();if(o instanceof KQ){if(o.children.length===0&&!QQ[o.name]){const a=i.has(o.name)?i.get(o.name):++n;i.set(o.name,a);const c=new fH(a).appendChild(new YQ(o.name));t.replace(o,[c]),this.isBogous=!0}switch(o.name){case"CLIPBOARD":this.usesClipboardVariable=!0;break;case"SELECTION":case"TM_SELECTED_TEXT":this.usesSelectionVariable=!0;break}}else s.push(...o.children)}this.isBogous&&(this.codeSnippet=t.toTextmateString())}}class M4{constructor(e,t,i,n,s,o,a,c,d,l){this.isFileTemplate=e,this.scopes=t,this.name=i,this.prefix=n,this.description=s,this.body=o,this.source=a,this.snippetSource=c,this.snippetIdentifier=d,this.extensionId=l,this.prefixLow=n.toLowerCase(),this._bodyInsights=new bP(()=>new hue(this.body))}get codeSnippet(){return this._bodyInsights.value.codeSnippet}get isBogous(){return this._bodyInsights.value.isBogous}get isTrivial(){return this._bodyInsights.value.isTrivial}get needsClipboard(){return this._bodyInsights.value.usesClipboardVariable}get usesSelection(){return this._bodyInsights.value.usesSelectionVariable}}function fue(r){return bn(r)&&!!r.body}class WR{constructor(e,t,i,n,s,o){this.source=e,this.location=t,this.defaultScopes=i,this._extension=n,this._fileService=s,this._extensionResourceLoaderService=o,this.data=[],this.isGlobalSnippets=kg(t.path)===".code-snippets",this.isUserSnippets=!this._extension}select(e,t){this.isGlobalSnippets||!this.isUserSnippets?this._scopeSelect(e,t):this._filepathSelect(e,t)}_filepathSelect(e,t){e+".json"===Yn(this.location.path)&&t.push(...this.data)}_scopeSelect(e,t){for(const n of this.data){const s=n.scopes.length;if(s===0)t.push(n);else for(let o=0;o<s;o++)if(n.scopes[o]===e){t.push(n);break}}const i=e.lastIndexOf(".");i>=0&&this._scopeSelect(e.substring(0,i),t)}async _load(){return this._extension?this._extensionResourceLoaderService.readExtensionResource(this.location):(await this._fileService.readFile(this.location)).value.toString()}load(){return this._loadPromise||(this._loadPromise=Promise.resolve(this._load()).then(e=>{const t=sc(e);if(Pq(t)==="object")for(const[i,n]of Object.entries(t))if(fue(n))this._parseSnippet(i,n,this.data);else for(const[s,o]of Object.entries(n))this._parseSnippet(s,o,this.data);return this})),this._loadPromise}reset(){this._loadPromise=void 0,this.data.length=0}_parseSnippet(e,t,i){var l;let{isFileTemplate:n,prefix:s,body:o,description:a}=t;if(s||(s=""),Array.isArray(o)&&(o=o.join(`
`)),typeof o!="string")return;Array.isArray(a)&&(a=a.join(`
`));let c;this.defaultScopes?c=this.defaultScopes:typeof t.scope=="string"?c=t.scope.split(",").map(u=>u.trim()).filter(Boolean):c=[];let d;this._extension?d=this._extension.displayName||this._extension.name:this.source===2?d=p("source.workspaceSnippetGlobal","Workspace Snippet"):this.isGlobalSnippets?d=p("source.userSnippetGlobal","Global User Snippet"):d=p("source.userSnippet","User Snippet");for(const u of Go.wrap(s))i.push(new M4(!!n,c,e,u,a,o,d,this.source,this._extension?`${xg(this._extension.extensionLocation,this.location)}/${e}`:`${Yn(this.location.path)}/${e}`,(l=this._extension)==null?void 0:l.identifier))}}const dm=io.registerExtensionPoint({extensionPoint:"languages",jsonSchema:{description:p("vscode.extension.contributes.languages","Contributes language declarations."),type:"array",items:{type:"object",defaultSnippets:[{body:{id:"${1:languageId}",aliases:["${2:label}"],extensions:["${3:extension}"],configuration:"./language-configuration.json"}}],properties:{id:{description:p("vscode.extension.contributes.languages.id","ID of the language."),type:"string"},aliases:{description:p("vscode.extension.contributes.languages.aliases","Name aliases for the language."),type:"array",items:{type:"string"}},extensions:{description:p("vscode.extension.contributes.languages.extensions","File extensions associated to the language."),default:[".foo"],type:"array",items:{type:"string"}},filenames:{description:p("vscode.extension.contributes.languages.filenames","File names associated to the language."),type:"array",items:{type:"string"}},filenamePatterns:{description:p("vscode.extension.contributes.languages.filenamePatterns","File name glob patterns associated to the language."),type:"array",items:{type:"string"}},mimetypes:{description:p("vscode.extension.contributes.languages.mimetypes","Mime types associated to the language."),type:"array",items:{type:"string"}},firstLine:{description:p("vscode.extension.contributes.languages.firstLine","A regular expression matching the first line of a file of the language."),type:"string"},configuration:{description:p("vscode.extension.contributes.languages.configuration","A relative path to a file containing configuration options for the language."),type:"string",default:"./language-configuration.json"},icon:{type:"object",description:p("vscode.extension.contributes.languages.icon","A icon to use as file icon, if no icon theme provides one for the language."),properties:{light:{description:p("vscode.extension.contributes.languages.icon.light","Icon path when a light theme is used"),type:"string"},dark:{description:p("vscode.extension.contributes.languages.icon.dark","Icon path when a dark theme is used"),type:"string"}}}}}},activationEventsGenerator:(r,e)=>{for(const t of r)t.id&&t.configuration&&e.push(`onLanguage:${t.id}`)}});let DB=class extends XQ{constructor(e,t,i,n){super(i.verbose||i.isExtensionDevelopment||!i.isBuilt),this.logService=n,this._configurationService=t,this._extensionService=e,dm.setHandler(s=>{const o=[];for(let a=0,c=s.length;a<c;a++){const d=s[a];if(!Array.isArray(d.value)){d.collector.error(p("invalid","Invalid `contributes.{0}`. Expected an array.",dm.name));continue}for(let l=0,u=d.value.length;l<u;l++){const h=d.value[l];if(pue(h,d.description,d.collector)){let g;h.configuration&&(g=pt(d.description.extensionLocation,h.configuration)),o.push({id:h.id,extensions:h.extensions,filenames:h.filenames,filenamePatterns:h.filenamePatterns,firstLine:h.firstLine,aliases:h.aliases,mimetypes:h.mimetypes,configuration:g,icon:h.icon&&{light:pt(d.description.extensionLocation,h.icon.light),dark:pt(d.description.extensionLocation,h.icon.dark)}})}}}this._registry.setDynamicLanguages(o)}),this.updateMime(),this._configurationService.onDidChangeConfiguration(s=>{s.affectsConfiguration(KN)&&this.updateMime()}),this._extensionService.whenInstalledExtensionsRegistered().then(()=>{this.updateMime()}),this._register(this.onDidRequestRichLanguageFeatures(s=>{this._extensionService.activateByEvent(`onLanguage:${s}`),this._extensionService.activateByEvent("onLanguage")}))}updateMime(){var t;const e=this._configurationService.getValue();JQ(),(t=e.files)!=null&&t.associations&&Object.keys(e.files.associations).forEach(i=>{const n=e.files.associations[i];if(typeof n!="string"){this.logService.warn(`Ignoring configured 'files.associations' for '${i}' because its type is not a string but '${typeof n}'`);return}const s=this.getMimeType(n)||`text/x-${n}`;ZQ({id:n,mime:s,filepattern:i})}),this._onDidChange.fire()}};DB=T([v(0,yr),v(1,We),v(2,ls),v(3,ze)],DB);function Kb(r){return typeof r>"u"?!0:Array.isArray(r)?r.every(e=>typeof e=="string"):!1}function pue(r,e,t){return r?typeof r.id!="string"?(t.error(p("require.id","property `{0}` is mandatory and must be of type `string`","id")),!1):Kb(r.extensions)?Kb(r.filenames)?typeof r.firstLine<"u"&&typeof r.firstLine!="string"?(t.error(p("opt.firstLine","property `{0}` can be omitted and must be of type `string`","firstLine")),!1):typeof r.configuration<"u"&&typeof r.configuration!="string"?(t.error(p("opt.configuration","property `{0}` can be omitted and must be of type `string`","configuration")),!1):Kb(r.aliases)?Kb(r.mimetypes)?typeof r.icon<"u"&&(typeof r.icon!="object"||typeof r.icon.light!="string"||typeof r.icon.dark!="string")?(t.error(p("opt.icon","property `{0}` can be omitted and must be of type `object` with properties `{1}` and `{2}` of type `string`","icon","light","dark")),!1):!0:(t.error(p("opt.mimetypes","property `{0}` can be omitted and must be of type `string[]`","mimetypes")),!1):(t.error(p("opt.aliases","property `{0}` can be omitted and must be of type `string[]`","aliases")),!1):(t.error(p("opt.filenames","property `{0}` can be omitted and must be of type `string[]`","filenames")),!1):(t.error(p("opt.extensions","property `{0}` can be omitted and must be of type `string[]`","extensions")),!1):(t.error(p("invalid.empty","Empty value for `contributes.{0}`",dm.name)),!1)}const L4="_snippet.markAsUsed";Gt.registerCommand(L4,(r,...e)=>{const t=r.get($T),[i]=e;i instanceof M4&&t.updateUsageTimestamp(i)});class Kv{constructor(e,t){this.snippet=e,this.label={label:e.prefix,description:e.name},this.detail=p("detail.snippet","{0} ({1})",e.description||e.name,e.source),this.insertText=e.codeSnippet,this.extensionId=e.extensionId,this.range=t,this.sortText=`${e.snippetSource===3?"z":"a"}-${e.prefix}`,this.kind=27,this.insertTextRules=4,this.command={id:L4,title:"",arguments:[e]}}resolve(){return this.documentation=new oq().appendCodeblock("",zN.asInsertText(this.snippet.codeSnippet)),this}static compareByLabel(e,t){return Sa(e.label.label,t.label.label)}}let w0=class{constructor(e,t,i){this._languageService=e,this._snippets=t,this._languageConfigurationService=i,this._debugDisplayName="snippetCompletions"}async provideCompletionItems(e,t,i){var g;const n=new Tr,s=this._getLanguageIdAtPosition(e,t),o=this._languageConfigurationService.getLanguageConfiguration(s),a=new Set(await this._snippets.getSnippets(s)),c=e.getLineContent(t.lineNumber).toLowerCase(),d=e.getWordUntilPosition(t).word.toLowerCase(),l=[],u=t.column-1,h=((g=i.triggerCharacter)==null?void 0:g.toLowerCase())??"";e:for(const m of a){if(i.triggerKind===1&&!m.prefixLow.startsWith(h))continue e;const y=Aq(1,o.getWordDefinition(),m.prefixLow,0);if(d&&y&&!pH(d,0,d.length,m.prefixLow,0,m.prefixLow.length))continue e;const _=eY(m.prefixLow)===0?Math.max(0,e.getLineFirstNonWhitespaceColumn(t.lineNumber)-1):0;t:for(let b=Math.max(_,u-m.prefixLow.length);b<c.length;b++){if(!pH(c,b,u,m.prefixLow,0,m.prefixLow.length))continue t;const E=m.prefixLow.length-(u-b),D=tY(c,m.prefixLow,u,u+E,u-b),R=t.with(void 0,b+1);if(d&&t.equals(R))continue e;let M=D===0?t.column+E:t.column;if(u<c.length){const Z=o.getAutoClosingPairs().autoClosingPairsCloseSingleChar.get(c[u]);Z!=null&&Z.some(K=>K.open===c[R.column-1]&&m.prefix.startsWith(K.open)&&m.prefix[m.prefix.length-1]===K.close)&&M++}const O=qe.fromPositions(R,{lineNumber:t.lineNumber,column:M}),L=O.setEndPosition(t.lineNumber,t.column);l.push(new Kv(m,{replace:O,insert:L})),a.delete(m);break}}if(!h&&(/\s/.test(c[t.column-2])||!c))for(const y of a){const _=qe.fromPositions(t),b=c.indexOf(y.prefixLow,u)===u?_.setEndPosition(t.lineNumber,t.column+y.prefixLow.length):_;l.push(new Kv(y,{replace:b,insert:_}))}l.sort(Kv.compareByLabel);for(let m=0;m<l.length;m++){const y=l[m];let _=m+1;for(;_<l.length&&y.label===l[_].label;_++)l[_].label.label=p("snippetSuggest.longLabel","{0}, {1}",l[_].label.label,l[_].snippet.name);_>m+1&&(l[m].label.label=p("snippetSuggest.longLabel","{0}, {1}",l[m].label.label,l[m].snippet.name),m=_)}return{suggestions:l,duration:n.elapsed()}}resolveCompletionItem(e){return e instanceof Kv?e.resolve():e}_getLanguageIdAtPosition(e,t){e.tokenization.tokenizeIfCheap(t.lineNumber);let i=e.getLanguageIdAtPosition(t.lineNumber,t.column);return this._languageService.getLanguageName(i)||(i=e.getLanguageId()),i}};w0=T([v(0,ji),v(1,$T),v(2,Bm)],w0);var zE;(function(r){function e(t,i,n){if(ga(i.path))return t.collector.error(p("invalid.path.0","Expected string in `contributes.{0}.path`. Provided value: {1}",t.description.name,String(i.path))),null;if(ga(i.language)&&!i.path.endsWith(".code-snippets"))return t.collector.error(p("invalid.language.0","When omitting the language, the value of `contributes.{0}.path` must be a `.code-snippets`-file. Provided value: {1}",t.description.name,String(i.path))),null;if(!ga(i.language)&&!n.isRegisteredLanguageId(i.language))return t.collector.error(p("invalid.language","Unknown language in `contributes.{0}.language`. Provided value: {1}",t.description.name,String(i.language))),null;const s=t.description.extensionLocation,o=pt(s,i.path);return Ff(o,s)?{language:i.language,location:o}:(t.collector.error(p("invalid.path.1","Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",t.description.name,o.path,s.path)),null)}r.toValidSnippet=e,r.snippetsContribution={description:p("vscode.extension.contributes.snippets","Contributes snippets."),type:"array",defaultSnippets:[{body:[{language:"",path:""}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",path:"./snippets/${2:id}.json."}}],properties:{language:{description:p("vscode.extension.contributes.snippets-language","Language identifier for which this snippet is contributed to."),type:"string"},path:{description:p("vscode.extension.contributes.snippets-path","Path of the snippets file. The path is relative to the extension folder and typically starts with './snippets/'."),type:"string"}}}},r.point=io.registerExtensionPoint({extensionPoint:"snippets",deps:[dm],jsonSchema:r.snippetsContribution})})(zE||(zE={}));function gue(r,e,t){return Da(r.watch(e),r.onDidFilesChange(i=>{i.affects(e)&&t()}))}let KE=class b0{constructor(e){this._storageService=e;const t=e.get(b0._key,0,"");let i;try{i=JSON.parse(t)}catch{}this._ignored=$N(i)?new Set(i):new Set}isIgnored(e){return this._ignored.has(e)}updateIgnored(e,t){let i=!1;this._ignored.has(e)&&!t?(this._ignored.delete(e),i=!0):!this._ignored.has(e)&&t&&(this._ignored.add(e),i=!0),i&&this._storageService.store(b0._key,JSON.stringify(Array.from(this._ignored)),0,0)}};KE._key="snippets.ignoredSnippets";KE=T([v(0,ri)],KE);let QE=class S0{constructor(e){this._storageService=e;const t=e.get(S0._key,0,"");let i;try{i=JSON.parse(t)}catch{i=[]}this._usages=Array.isArray(i)?new Map(i):new Map}getUsageTimestamp(e){return this._usages.get(e)}updateUsageTimestamp(e){this._usages.delete(e),this._usages.set(e,Date.now());const t=[...this._usages].slice(-100);this._storageService.store(S0._key,JSON.stringify(t),0,0)}};QE._key="snippets.usageTimestamps";QE=T([v(0,ri)],QE);let kB=class{constructor(e,t,i,n,s,o,a,c,d,l,u){this._environmentService=e,this._userDataProfileService=t,this._contextService=i,this._languageService=n,this._logService=s,this._fileService=o,this._textfileService=a,this._extensionResourceLoaderService=c,this._disposables=new me,this._pendingWork=[],this._files=new ki,this._pendingWork.push(Promise.resolve(d.when(3).then(()=>{this._initExtensionSnippets(),this._initUserSnippets(),this._initWorkspaceSnippets()}))),iY(new w0(this._languageService,this,u)),this._enablement=l.createInstance(KE),this._usageTimestamps=l.createInstance(QE)}dispose(){this._disposables.dispose()}isEnabled(e){return!this._enablement.isIgnored(e.snippetIdentifier)}updateEnablement(e,t){this._enablement.updateIgnored(e.snippetIdentifier,!t)}updateUsageTimestamp(e){this._usageTimestamps.updateUsageTimestamp(e.snippetIdentifier)}_joinSnippets(){const e=this._pendingWork.slice(0);return this._pendingWork.length=0,Promise.all(e)}async getSnippetFiles(){return await this._joinSnippets(),this._files.values()}async getSnippets(e,t){await this._joinSnippets();const i=[],n=[];if(e){if(this._languageService.isRegisteredLanguageId(e))for(const s of this._files.values())n.push(s.load().then(o=>o.select(e,i)).catch(o=>this._logService.error(o,s.location.toString())))}else for(const s of this._files.values())n.push(s.load().then(o=>nY(i,i.length,o.data)).catch(o=>this._logService.error(o,s.location.toString())));return await Promise.all(n),this._filterAndSortSnippets(i,t)}getSnippetsSync(e,t){const i=[];if(this._languageService.isRegisteredLanguageId(e))for(const n of this._files.values())n.load().catch(s=>{}),n.select(e,i);return this._filterAndSortSnippets(i,t)}_filterAndSortSnippets(e,t){const i=[];for(const n of e)!n.prefix&&!(t!=null&&t.includeNoPrefixSnippets)||!this.isEnabled(n)&&!(t!=null&&t.includeDisabledSnippets)||typeof(t==null?void 0:t.fileTemplateSnippets)=="boolean"&&t.fileTemplateSnippets!==n.isFileTemplate||i.push(n);return i.sort((n,s)=>{let o=0;if(!(t!=null&&t.noRecencySort)){const a=this._usageTimestamps.getUsageTimestamp(n.snippetIdentifier)??-1;o=(this._usageTimestamps.getUsageTimestamp(s.snippetIdentifier)??-1)-a}return o===0&&(o=this._compareSnippet(n,s)),o})}_compareSnippet(e,t){return e.snippetSource<t.snippetSource?-1:e.snippetSource>t.snippetSource?1:e.source<t.source?-1:e.source>t.source||e.name>t.name?1:e.name<t.name?-1:0}_initExtensionSnippets(){zE.point.setHandler(e=>{for(const[t,i]of this._files)i.source===3&&this._files.delete(t);for(const t of e)for(const i of t.value){const n=zE.toValidSnippet(t,i,this._languageService);if(!n)continue;const s=this._files.get(n.location);if(s)s.defaultScopes?s.defaultScopes.push(n.language):s.defaultScopes=[];else{const o=new WR(3,n.location,n.language?[n.language]:void 0,t.description,this._fileService,this._extensionResourceLoaderService);this._files.set(o.location,o),this._environmentService.isExtensionDevelopment&&o.load().then(a=>{a.data.some(c=>c.isBogous)&&t.collector.warn(p("badVariableUse","One or more snippets from the extension '{0}' very likely confuse snippet-variables and snippet-placeholders (see https://code.visualstudio.com/docs/editor/userdefinedsnippets#_snippet-syntax for more details)",t.description.name))},a=>{t.collector.warn(p("badFile",'The snippet file "{0}" could not be read.',o.location.toString()))})}}})}_initWorkspaceSnippets(){const e=new me,t=()=>{e.clear(),this._pendingWork.push(this._initWorkspaceFolderSnippets(this._contextService.getWorkspace(),e))};this._disposables.add(e),this._disposables.add(this._contextService.onDidChangeWorkspaceFolders(t)),this._disposables.add(this._contextService.onDidChangeWorkbenchState(t)),t()}async _initWorkspaceFolderSnippets(e,t){const i=e.folders.map(async n=>{const s=n.toResource(".vscode");await this._fileService.exists(s)?this._initFolderSnippets(2,s,t):t.add(this._fileService.onDidFilesChange(a=>{a.contains(s,1)&&this._initFolderSnippets(2,s,t)}))});await Promise.all(i)}async _initUserSnippets(){const e=new me,t=async()=>{e.clear();const i=this._userDataProfileService.currentProfile.snippetsHome;await this._fileService.createFolder(i),await this._initFolderSnippets(1,i,e)};this._disposables.add(e),this._disposables.add(this._userDataProfileService.onDidChangeCurrentProfile(i=>i.join((async()=>{this._pendingWork.push(t())})()))),await t()}_initFolderSnippets(e,t,i){const n=new me,s=async()=>{if(n.clear(),!!await this._fileService.exists(t))try{const o=await this._fileService.resolve(t);for(const a of o.children||[])n.add(this._addSnippetFile(a.resource,e))}catch(o){this._logService.error(`Failed snippets from folder '${t.toString()}'`,o)}};return i.add(this._textfileService.files.onDidSave(o=>{Ff(o.model.resource,t)&&s()})),i.add(gue(this._fileService,t,s)),i.add(n),s()}_addSnippetFile(e,t){const i=Xw(e);if(t===1&&i===".json"){const n=Mt(e).replace(/\.json/,"");this._files.set(e,new WR(t,e,[n],void 0,this._fileService,this._extensionResourceLoaderService))}else i===".code-snippets"&&this._files.set(e,new WR(t,e,void 0,void 0,this._fileService,this._extensionResourceLoaderService));return{dispose:()=>this._files.delete(e)}}};kB=T([v(0,ls),v(1,NT),v(2,oi),v(3,ji),v(4,ze),v(5,at),v(6,Dn),v(7,g$),v(8,ea),v(9,Te),v(10,Bm)],kB);function mue(r,e){const i=r.getLineContent(e.lineNumber).substr(0,e.column-1),n=Math.max(0,i.length-100);for(let s=i.length-1;s>=n;s--){const o=i.charAt(s);if(/\s/.test(o))return i.substr(s+1)}return n===0?i:""}let Pa=class C0{static get(e){return e.getContribution(C0.ID)}constructor(e,t,i,n,s){this._editor=e,this._snippetService=t,this._clipboardService=i,this._languageFeaturesService=n,this._activeSnippets=[],this._hasSnippets=C0.ContextKey.bindTo(s),this._configListener=this._editor.onDidChangeConfiguration(o=>{o.hasChanged(120)&&this._update()}),this._update()}dispose(){var e;this._configListener.dispose(),(e=this._selectionListener)==null||e.dispose()}_update(){var t;const e=this._editor.getOption(120)==="onlySnippets";this._enabled!==e&&(this._enabled=e,this._enabled?(this._selectionListener=this._editor.onDidChangeCursorSelection(i=>this._updateSnippets()),this._editor.getModel()&&this._updateSnippets()):(t=this._selectionListener)==null||t.dispose())}_updateSnippets(){var o;if(this._activeSnippets=[],(o=this._completionProvider)==null||o.dispose(),!this._editor.hasModel())return;const e=this._editor.getSelection(),t=this._editor.getModel();t.tokenization.tokenizeIfCheap(e.positionLineNumber);const i=t.getLanguageIdAtPosition(e.positionLineNumber,e.positionColumn),n=this._snippetService.getSnippetsSync(i);if(!n){this._hasSnippets.set(!1);return}if(qe.isEmpty(e)){const a=mue(t,e.getPosition());if(a)for(const c of n)a.endsWith(c.prefix)&&this._activeSnippets.push(c)}else if(!qe.spansMultipleLines(e)&&t.getValueLengthInRange(e)<=100){const a=t.getValueInRange(e);if(a)for(const c of n)a===c.prefix&&this._activeSnippets.push(c)}const s=this._activeSnippets.length;if(s===0)this._hasSnippets.set(!1);else if(s===1)this._hasSnippets.set(!0);else{this._hasSnippets.set(!0),this._completionProvider={_debugDisplayName:"tabCompletion",dispose:()=>{a.dispose()},provideCompletionItems:(c,d)=>c!==t||!e.containsPosition(d)?void 0:{suggestions:this._activeSnippets.map(u=>{const h=qe.fromPositions(d.delta(0,-u.prefix.length),d);return new Kv(u,h)})}};const a=this._languageFeaturesService.completionProvider.register({language:t.getLanguageId(),pattern:t.uri.fsPath,scheme:t.uri.scheme},this._completionProvider)}}async performSnippetCompletions(){var e;if(this._editor.hasModel())if(this._activeSnippets.length===1){const[t]=this._activeSnippets;let i;if(t.needsClipboard){const n=new Mq(this._editor,5);if(i=await this._clipboardService.readText(),!n.validate(this._editor))return}(e=nf.get(this._editor))==null||e.insert(t.codeSnippet,{overwriteBefore:t.prefix.length,overwriteAfter:0,clipboardText:i})}else this._activeSnippets.length>1&&this._completionProvider&&oY(this._editor,this._completionProvider)}};Pa.ID="editor.tabCompletionController";Pa.ContextKey=new G("hasSnippetCompletions",void 0);Pa=T([v(1,$T),v(2,Vm),v(3,Lf),v(4,It)],Pa);Rd(Pa.ID,Pa,0);const vue=rY.bindToContribution(Pa.get);sY(new vue({id:"insertSnippet",precondition:Pa.ContextKey,handler:r=>r.performSnippetCompletions(),kbOpts:{weight:100,kbExpr:nt.and(vo.editorTextFocus,vo.tabDoesNotMoveFocus,nf.InSnippetMode.toNegated()),primary:2}}));function yue(r){return{wordWrap:"on",overviewRulerLanes:0,glyphMargin:!1,lineNumbers:"off",folding:!1,selectOnLineNumbers:!1,hideCursorInOverviewRuler:!0,selectionHighlight:!1,scrollbar:{horizontal:"hidden"},lineDecorationsWidth:0,overviewRulerBorder:!1,scrollBeyondLastLine:!1,renderLineHighlight:"none",fixedOverflowWidgets:!0,acceptSuggestionOnEnter:"smart",dragAndDrop:!1,revealHorizontalRightPadding:5,minimap:{enabled:!1},guides:{indentation:!1},accessibilitySupport:r.getValue("editor.accessibilitySupport"),cursorBlinking:r.getValue("editor.cursorBlinking")}}function uAe(){return{isSimpleWidget:!0,contributions:hk.getSomeEditorContributions([cm.ID,A4,EP.ID,xP.ID,nf.ID,Pa.ID])}}const _ue=re("accessibleViewService"),wue=new G("accessibilityHelpIsShown",!1,!0);let E0=class extends ne{get editorWidget(){return this._editorWidget}constructor(e,t,i,n,s,o){super(),this._openerService=e,this._instantiationService=t,this._configurationService=i,this._modelService=n,this._contextViewService=s,this._contextKeyService=o,this._accessiblityHelpIsShown=wue.bindTo(this._contextKeyService),this._editorContainer=document.createElement("div"),this._editorContainer.classList.add("accessible-view");const a={contributions:hk.getSomeEditorContributions([aY.ID,A4,"editor.contrib.selectionAnchorController"])},c={...yue(this._configurationService),lineDecorationsWidth:6,dragAndDrop:!0,cursorWidth:1,wrappingStrategy:"advanced",wrappingIndent:"none",padding:{top:2,bottom:2},quickSuggestions:!1,renderWhitespace:"none",dropIntoEditor:{enabled:!0},readOnly:!0};this._editorWidget=this._register(this._instantiationService.createInstance(QN,this._editorContainer,c,a))}show(e){const t={getAnchor:()=>this._editorContainer,render:i=>this._render(e,i),onHide:()=>{e.options.type==="helpMenu"&&this._accessiblityHelpIsShown.reset()}};this._contextViewService.showContextView(t),e.options.type==="helpMenu"&&this._accessiblityHelpIsShown.set(!0)}_render(e,t){const i=`accessibility.verbosity.${e.id}`,n=this._configurationService.getValue(i),s=e.options.readMoreUrl?p("openDoc",`
Press H now to open a browser window with more information related to accessibility.
`):"",o=e.options.type==="helpMenu"&&n?p("disable-help-hint","\nTo disable the `accessibility.verbosity` hint for this feature, press D now.\n"):`
`,a=e.provideContent()+s+o+p("exit-tip","Exit this menu via the Escape key.");this._getTextModel(k.from({path:`accessible-view-${e.id}`,scheme:"accessible-view",fragment:a})).then(d=>{!d||(this._editorWidget.setModel(d),!this._editorWidget.getDomNode())||(e.options.language&&d.setLanguage(e.options.language),t.appendChild(this._editorContainer),this._editorWidget.updateOptions({ariaLabel:e.options.ariaLabel}),this._editorWidget.focus())});const c=new me;return c.add(this._editorWidget.onKeyUp(d=>{var l;d.keyCode===9?(this._contextViewService.hideContextView(),setTimeout(()=>e.onClose(),100)):d.keyCode===34&&this._configurationService.getValue(i)&&this._configurationService.updateValue(i,!1),d.stopPropagation(),(l=e.onKeyDown)==null||l.call(e,d)})),c.add(this._editorWidget.onKeyDown(d=>{if(d.keyCode===38&&e.options.readMoreUrl){const l=e.options.readMoreUrl;alert(cY.openingDocs),this._openerService.open(k.parse(l)),d.preventDefault(),d.stopPropagation()}})),c.add(this._editorWidget.onDidBlurEditorText(()=>this._contextViewService.hideContextView())),c.add(this._editorWidget.onDidContentSizeChange(()=>this._layout())),c}_layout(){const e=window.innerWidth,t=e*.6;this._editorWidget.layout({width:t,height:this._editorWidget.getContentHeight()});const i=Math.round((e-t)/2);this._editorContainer.style.left=`${i}px`}async _getTextModel(e){const t=this._modelService.getModel(e);return t&&!t.isDisposed()?t:this._modelService.createModel(e.fragment,null,e,!1)}};E0=T([v(0,us),v(1,Te),v(2,We),v(3,_i),v(4,fk),v(5,It)],E0);let TB=class extends ne{constructor(e){super(),this._instantiationService=e,this._providers=new Map}registerProvider(e){return this._providers.set(e.id,e),ot(()=>{this._providers.delete(e.id)})}show(e){this._accessibleView||(this._accessibleView=this._register(this._instantiationService.createInstance(E0)));const t=this._providers.get(e);if(!t)throw new Error(`No accessible view provider with id: ${e}`);return this._accessibleView.show(t),this._accessibleView}};TB=T([v(0,Te)],TB);const bue="extensions.supportUntrustedWorkspaces",hb=re("extensionManifestPropertiesService");let x0=class extends ne{constructor(e,t,i,n){super(),this.productService=e,this.configurationService=t,this.workspaceTrustEnablementService=i,this.logService=n,this._extensionPointExtensionKindsMap=null,this._productExtensionKindsMap=null,this._configuredExtensionKindsMap=null,this._productVirtualWorkspaceSupportMap=null,this._configuredVirtualWorkspaceSupportMap=null,this._configuredExtensionWorkspaceTrustRequestMap=new Ln;const s=t.inspect(bue).userValue||{};for(const o of Object.keys(s))this._configuredExtensionWorkspaceTrustRequestMap.set(o,s[o]);if(this._productExtensionWorkspaceTrustRequestMap=new Map,e.extensionUntrustedWorkspaceSupport)for(const o of Object.keys(e.extensionUntrustedWorkspaceSupport))this._productExtensionWorkspaceTrustRequestMap.set(o,e.extensionUntrustedWorkspaceSupport[o])}prefersExecuteOnUI(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="ui"}prefersExecuteOnWorkspace(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="workspace"}prefersExecuteOnWeb(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="web"}canExecuteOnUI(e){return this.getExtensionKind(e).some(i=>i==="ui")}canExecuteOnWorkspace(e){return this.getExtensionKind(e).some(i=>i==="workspace")}canExecuteOnWeb(e){return this.getExtensionKind(e).some(i=>i==="web")}getExtensionKind(e){const t=this.deduceExtensionKind(e),i=this.getConfiguredExtensionKind(e);if(i&&i.length>0){const n=[];for(const s of i)s!=="-web"&&n.push(s);return i.includes("-web")&&!n.length&&(n.push("ui"),n.push("workspace")),ln&&!i.includes("-web")&&!i.includes("web")&&t.includes("web")&&n.push("web"),n}return t}getUserConfiguredExtensionKind(e){if(this._configuredExtensionKindsMap===null){const i=new Ln,n=this.configurationService.getValue("remote.extensionKind")||{};for(const s of Object.keys(n))i.set(s,n[s]);this._configuredExtensionKindsMap=i}const t=this._configuredExtensionKindsMap.get(e.id);return t?this.toArray(t):void 0}getExtensionUntrustedWorkspaceSupportType(e){var n,s;if(!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()||!e.main)return!0;const t=this.getConfiguredExtensionWorkspaceTrustRequest(e),i=this.getProductExtensionWorkspaceTrustRequest(e);return t!==void 0?t:(i==null?void 0:i.override)!==void 0?i.override:((s=(n=e.capabilities)==null?void 0:n.untrustedWorkspaces)==null?void 0:s.supported)!==void 0?e.capabilities.untrustedWorkspaces.supported:(i==null?void 0:i.default)!==void 0?i.default:!1}getExtensionVirtualWorkspaceSupportType(e){var s;const t=this.getConfiguredVirtualWorkspaceSupport(e);if(t!==void 0)return t;const i=this.getProductVirtualWorkspaceSupport(e);if((i==null?void 0:i.override)!==void 0)return i.override;const n=(s=e.capabilities)==null?void 0:s.virtualWorkspaces;if(DP(n))return n;if(n){const o=n.supported;if(DP(o)||o==="limited")return o}return(i==null?void 0:i.default)!==void 0?i.default:!0}deduceExtensionKind(e){if(e.main)return e.browser?ln?["workspace","web"]:["workspace"]:["workspace"];if(e.browser)return["web"];let t=[...dY];if((Pr(e.extensionPack)||Pr(e.extensionDependencies))&&(t=ln?["workspace","web"]:["workspace"]),e.contributes)for(const i of Object.keys(e.contributes)){const n=this.getSupportedExtensionKindsForExtensionPoint(i);n.length&&(t=t.filter(s=>n.includes(s)))}return t.length||this.logService.warn("Cannot deduce extensionKind for extension",Xd(e.publisher,e.name)),t}getSupportedExtensionKindsForExtensionPoint(e){if(this._extensionPointExtensionKindsMap===null){const i=new Map;io.getExtensionPoints().forEach(n=>i.set(n.name,n.defaultExtensionKind||[])),this._extensionPointExtensionKindsMap=i}let t=this._extensionPointExtensionKindsMap.get(e);return t||(t=this.productService.extensionPointExtensionKind?this.productService.extensionPointExtensionKind[e]:void 0,t)?t:ln?["workspace","web"]:["workspace"]}getConfiguredExtensionKind(e){const t={id:Xd(e.publisher,e.name)};let i=this.getUserConfiguredExtensionKind(t);return typeof i<"u"?this.toArray(i):(i=this.getProductExtensionKind(e),typeof i<"u"?i:(i=e.extensionKind,typeof i<"u"?(i=this.toArray(i),i.filter(n=>["ui","workspace"].includes(n))):null))}getProductExtensionKind(e){if(this._productExtensionKindsMap===null){const i=new Ln;if(this.productService.extensionKind)for(const n of Object.keys(this.productService.extensionKind))i.set(n,this.productService.extensionKind[n]);this._productExtensionKindsMap=i}const t=Xd(e.publisher,e.name);return this._productExtensionKindsMap.get(t)}getProductVirtualWorkspaceSupport(e){if(this._productVirtualWorkspaceSupportMap===null){const i=new Ln;if(this.productService.extensionVirtualWorkspacesSupport)for(const n of Object.keys(this.productService.extensionVirtualWorkspacesSupport))i.set(n,this.productService.extensionVirtualWorkspacesSupport[n]);this._productVirtualWorkspaceSupportMap=i}const t=Xd(e.publisher,e.name);return this._productVirtualWorkspaceSupportMap.get(t)}getConfiguredVirtualWorkspaceSupport(e){if(this._configuredVirtualWorkspaceSupportMap===null){const i=new Ln,n=this.configurationService.getValue("extensions.supportVirtualWorkspaces")||{};for(const s of Object.keys(n))n[s]!==void 0&&i.set(s,n[s]);this._configuredVirtualWorkspaceSupportMap=i}const t=Xd(e.publisher,e.name);return this._configuredVirtualWorkspaceSupportMap.get(t)}getConfiguredExtensionWorkspaceTrustRequest(e){const t=Xd(e.publisher,e.name),i=this._configuredExtensionWorkspaceTrustRequestMap.get(t);if(i&&(i.version===void 0||i.version===e.version))return i.supported}getProductExtensionWorkspaceTrustRequest(e){const t=Xd(e.publisher,e.name);return this._productExtensionWorkspaceTrustRequestMap.get(t)}toArray(e){return Array.isArray(e)?e:e==="ui"?["ui","workspace"]:[e]}};x0=T([v(0,Rs),v(1,We),v(2,Lq),v(3,ze)],x0);const D$=re("IRemoteExtensionsScannerService");class Sue extends ne{constructor(){super(...arguments),this.handlers=new Set}open(e,t){const i=[...this.handlers.values()];return lY(i.map(n=>()=>n.handleURL(e,t)),void 0,!1).then(n=>n||!1)}registerHandler(e){return this.handlers.add(e),ot(()=>this.handlers.delete(e))}}const IB=/^([^.]+\..+):(.+)$/,Cu=Rf(ls);class Be{get remoteAuthority(){return this.options.remoteAuthority}get expectsResolverExtension(){var e;return!!((e=this.options.remoteAuthority)!=null&&e.includes("+"))&&!this.options.webSocketFactory}get isBuilt(){return!!this.productService.commit}get logLevel(){var t,i,n;const e=(t=this.payload)==null?void 0:t.get("logLevel");return e?e.split(",").find(s=>!IB.test(s)):((i=this.options.developmentOptions)==null?void 0:i.logLevel)!==void 0?gC((n=this.options.developmentOptions)==null?void 0:n.logLevel):void 0}get extensionLogLevel(){var t,i,n;const e=(t=this.payload)==null?void 0:t.get("logLevel");if(e){const s=[];for(const o of e.split(",")){const a=IB.exec(o);a&&a[1]&&a[2]&&s.push([a[1],a[2]])}return s.length?s:void 0}return((i=this.options.developmentOptions)==null?void 0:i.extensionLogLevel)!==void 0?(n=this.options.developmentOptions)==null?void 0:n.extensionLogLevel.map(([s,o])=>[s,gC(o)]):void 0}get profDurationMarkers(){var t;const e=(t=this.payload)==null?void 0:t.get("profDurationMarkers");if(e){const i=[];for(const n of e.split(","))i.push(n);return i.length===2?i:void 0}}get windowLogsPath(){return this.logsHome}get logFile(){return pt(this.windowLogsPath,"window.log")}get userRoamingDataHome(){return k.file("/User").with({scheme:pe.vscodeUserData})}get argvResource(){return pt(this.userRoamingDataHome,"argv.json")}get cacheHome(){return pt(this.userRoamingDataHome,"caches")}get workspaceStorageHome(){return pt(this.userRoamingDataHome,"workspaceStorage")}get localHistoryHome(){return pt(this.userRoamingDataHome,"History")}get stateResource(){return pt(this.userRoamingDataHome,"State","storage.json")}get userDataSyncHome(){return pt(this.userRoamingDataHome,"sync",this.workspaceId)}get sync(){}get keyboardLayoutResource(){return pt(this.userRoamingDataHome,"keyboardLayout.json")}get untitledWorkspacesHome(){return pt(this.userRoamingDataHome,"Workspaces")}get serviceMachineIdResource(){return pt(this.userRoamingDataHome,"machineid")}get extHostLogsPath(){return pt(this.logsHome,"exthost")}get extHostTelemetryLogFile(){return pt(this.extHostLogsPath,"extensionTelemetry.log")}get debugExtensionHost(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.params}get isExtensionDevelopment(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.isExtensionDevelopment}get extensionDevelopmentLocationURI(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionDevelopmentLocationURI}get extensionDevelopmentLocationKind(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionDevelopmentKind}get extensionTestsLocationURI(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionTestsLocationURI}get extensionEnabledProposedApi(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionEnabledProposedApi}get debugRenderer(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.debugRenderer}get enableSmokeTestDriver(){var e;return(e=this.options.developmentOptions)==null?void 0:e.enableSmokeTestDriver}get disableExtensions(){var e;return((e=this.payload)==null?void 0:e.get("disableExtensions"))==="true"}get enableExtensions(){return this.options.enabledExtensions}get webviewExternalEndpoint(){var i;const e=this.options.webviewEndpoint||this.productService.webviewContentExternalBaseUrlTemplate||"https://{{uuid}}.vscode-cdn.net/{{quality}}/{{commit}}/out/vs/workbench/contrib/webview/browser/pre/",t=(i=this.payload)==null?void 0:i.get("webviewExternalEndpointCommit");return e.replace("{{commit}}",t??this.productService.commit??"ef65ac1ba57f57f2a3961bfe94aa20481caca4c6").replace("{{quality}}",(t?"insider":this.productService.quality)??"insider")}get extensionTelemetryLogResource(){return pt(this.logsHome,"extensionTelemetry.log")}get disableTelemetry(){return!1}get verbose(){var e;return((e=this.payload)==null?void 0:e.get("verbose"))==="true"}get logExtensionHostCommunication(){var e;return((e=this.payload)==null?void 0:e.get("logExtensionHostCommunication"))==="true"}get skipReleaseNotes(){var e;return((e=this.payload)==null?void 0:e.get("skipReleaseNotes"))==="true"}get skipWelcome(){var e;return((e=this.payload)==null?void 0:e.get("skipWelcome"))==="true"}get disableWorkspaceTrust(){return!this.options.enableWorkspaceTrust}get lastActiveProfile(){var e;return(e=this.payload)==null?void 0:e.get("lastActiveProfile")}constructor(e,t,i,n){if(this.workspaceId=e,this.logsHome=t,this.options=i,this.productService=n,this.extensionHostDebugEnvironment=void 0,this.editSessionId=this.options.editSessionId,i.workspaceProvider&&Array.isArray(i.workspaceProvider.payload))try{this.payload=new Map(i.workspaceProvider.payload)}catch(s){en(s)}}resolveExtensionHostDebugEnvironment(){var i;const e={params:{port:null,break:!1},debugRenderer:!1,isExtensionDevelopment:!1,extensionDevelopmentLocationURI:void 0,extensionDevelopmentKind:void 0};if(this.payload)for(const[n,s]of this.payload)switch(n){case"extensionDevelopmentPath":e.extensionDevelopmentLocationURI||(e.extensionDevelopmentLocationURI=[]),e.extensionDevelopmentLocationURI.push(k.parse(s)),e.isExtensionDevelopment=!0;break;case"extensionDevelopmentKind":e.extensionDevelopmentKind=[s];break;case"extensionTestsPath":e.extensionTestsLocationURI=k.parse(s);break;case"debugRenderer":e.debugRenderer=s==="true";break;case"debugId":e.params.debugId=s;break;case"inspect-brk-extensions":e.params.port=parseInt(s),e.params.break=!0;break;case"inspect-extensions":e.params.port=parseInt(s);break;case"enableProposedApi":e.extensionEnabledProposedApi=[];break}const t=this.options.developmentOptions;return t&&!e.isExtensionDevelopment&&((i=t.extensions)!=null&&i.length&&(e.extensionDevelopmentLocationURI=t.extensions.map(n=>k.revive(n)),e.isExtensionDevelopment=!0),t.extensionTestsPath&&(e.extensionTestsLocationURI=k.revive(t.extensionTestsPath))),e}get filesToOpenOrCreate(){if(this.payload){const e=this.payload.get("openFile");if(e){const t=k.parse(e);if(this.payload.has("gotoLineMode")){const i=uY(t.path);return[{fileUri:t.with({path:i.path}),options:{selection:kP(i.line)?void 0:{startLineNumber:i.line,startColumn:i.column||1}}}]}return[{fileUri:t}]}}}get filesToDiff(){if(this.payload){const e=this.payload.get("diffFilePrimary"),t=this.payload.get("diffFileSecondary");if(e&&t)return[{fileUri:k.parse(t)},{fileUri:k.parse(e)}]}}get filesToMerge(){if(this.payload){const e=this.payload.get("mergeFile1"),t=this.payload.get("mergeFile2"),i=this.payload.get("mergeFileBase"),n=this.payload.get("mergeFileResult");if(e&&t&&i&&n)return[{fileUri:k.parse(e)},{fileUri:k.parse(t)},{fileUri:k.parse(i)},{fileUri:k.parse(n)}]}}}Be.__decorator=T([xt],Be.prototype,"remoteAuthority",null);Be.__decorator=T([xt],Be.prototype,"expectsResolverExtension",null);Be.__decorator=T([xt],Be.prototype,"isBuilt",null);Be.__decorator=T([xt],Be.prototype,"logLevel",null);Be.__decorator=T([xt],Be.prototype,"windowLogsPath",null);Be.__decorator=T([xt],Be.prototype,"logFile",null);Be.__decorator=T([xt],Be.prototype,"userRoamingDataHome",null);Be.__decorator=T([xt],Be.prototype,"argvResource",null);Be.__decorator=T([xt],Be.prototype,"cacheHome",null);Be.__decorator=T([xt],Be.prototype,"workspaceStorageHome",null);Be.__decorator=T([xt],Be.prototype,"localHistoryHome",null);Be.__decorator=T([xt],Be.prototype,"stateResource",null);Be.__decorator=T([xt],Be.prototype,"userDataSyncHome",null);Be.__decorator=T([xt],Be.prototype,"sync",null);Be.__decorator=T([xt],Be.prototype,"keyboardLayoutResource",null);Be.__decorator=T([xt],Be.prototype,"untitledWorkspacesHome",null);Be.__decorator=T([xt],Be.prototype,"serviceMachineIdResource",null);Be.__decorator=T([xt],Be.prototype,"extHostLogsPath",null);Be.__decorator=T([xt],Be.prototype,"extHostTelemetryLogFile",null);Be.__decorator=T([xt],Be.prototype,"debugExtensionHost",null);Be.__decorator=T([xt],Be.prototype,"isExtensionDevelopment",null);Be.__decorator=T([xt],Be.prototype,"extensionDevelopmentLocationURI",null);Be.__decorator=T([xt],Be.prototype,"extensionDevelopmentLocationKind",null);Be.__decorator=T([xt],Be.prototype,"extensionTestsLocationURI",null);Be.__decorator=T([xt],Be.prototype,"extensionEnabledProposedApi",null);Be.__decorator=T([xt],Be.prototype,"debugRenderer",null);Be.__decorator=T([xt],Be.prototype,"enableSmokeTestDriver",null);Be.__decorator=T([xt],Be.prototype,"disableExtensions",null);Be.__decorator=T([xt],Be.prototype,"enableExtensions",null);Be.__decorator=T([xt],Be.prototype,"webviewExternalEndpoint",null);Be.__decorator=T([xt],Be.prototype,"extensionTelemetryLogResource",null);Be.__decorator=T([xt],Be.prototype,"disableTelemetry",null);Be.__decorator=T([xt],Be.prototype,"verbose",null);Be.__decorator=T([xt],Be.prototype,"logExtensionHostCommunication",null);Be.__decorator=T([xt],Be.prototype,"skipReleaseNotes",null);Be.__decorator=T([xt],Be.prototype,"skipWelcome",null);Be.__decorator=T([xt],Be.prototype,"disableWorkspaceTrust",null);Be.__decorator=T([xt],Be.prototype,"lastActiveProfile",null);Be.__decorator=T([xt],Be.prototype,"filesToOpenOrCreate",null);Be.__decorator=T([xt],Be.prototype,"filesToDiff",null);Be.__decorator=T([xt],Be.prototype,"filesToMerge",null);class Cue{constructor(e,t){this.urlService=e,this.productService=t}async open(e,t){return t!=null&&t.openExternal||!Xy(e,this.productService.urlProtocol)?!1:(typeof e=="string"&&(e=k.parse(e)),this.urlService.open(e,{trusted:!0}))}}let D0=class extends Sue{constructor(e,t,i){var n;super(),this.provider=(n=e.options)==null?void 0:n.urlCallbackProvider,this.provider&&this._register(this.provider.onCallback(s=>this.open(s,{trusted:!0}))),this._register(t.registerOpener(new Cue(this,i)))}create(e){return this.provider?this.provider.create(e):k.parse("unsupported://")}};D0=T([v(0,Cu),v(1,us),v(2,Rs)],D0);const k$=re("urlService"),T$=re("credentialsService"),I$=re("remoteSocketFactoryService"),VT=re("quickDiff"),mAe="workbench.view.scm",F4=re("scm"),O4=re("scmView"),N4=re("downloadService"),RB="extensionUrlHandler.confirmedExtensions";function Eue(r){return/^[a-z0-9][a-z0-9\-]*\.[a-z0-9][a-z0-9\-]*$/i.test(r)}class xue{get extensions(){const e=this.storageService.get(RB,0,"[]");try{return JSON.parse(e)}catch{return[]}}constructor(e){this.storageService=e}has(e){return this.extensions.indexOf(e)>-1}add(e){this.set([...this.extensions,e])}set(e){this.storageService.store(RB,JSON.stringify(e),0,1)}}const $4=re("extensionUrlHandler");let YE=class wp{static get cache(){wp.disposable.dispose();const e=wp._cache;return wp._cache=[],e}constructor(e){wp.disposable=e.registerHandler(this)}async handleURL(e,t){return Eue(e.authority)?(wp._cache.push([e,t]),!0):!1}};YE._cache=[];YE=T([v(0,k$)],YE);const Due=st.as(Js.Workbench);Due.registerWorkbenchContribution(YE,2);class kue extends Le{constructor(){super({id:"workbench.extensions.action.manageAuthorizedExtensionURIs",title:{value:p("manage","Manage Authorized Extension URIs..."),original:"Manage Authorized Extension URIs..."},category:{value:p("extensions","Extensions"),original:"Extensions"},menu:{id:Ee.CommandPalette,when:Fq.toNegated()}})}async run(e){const t=e.get(ri),i=e.get(ss),n=new xue(t),s=n.extensions.map(a=>({label:a,picked:!0}));if(s.length===0){await i.pick([{label:p("no","There are currently no authorized extension URIs.")}]);return}const o=await i.pick(s,{canPickMany:!0});o&&n.set(o.map(a=>a.label))}}Nt(kue);const Nd=re("commentService"),W4=re("notebookCellStatusBarService"),H4=re("INotebookKernelService"),j4=re("INotebookRendererMessagingService"),R$=re("IInteractiveDocumentService"),B4=re("IInlineChatService");Ee.for("inlineChatWidget");Ee.for("inlineChatWidget.markdownMessage");Ee.for("inlineChatWidget.status");Ee.for("inlineChatWidget.feedback");Ee.for("inlineChatWidget.undo");ee("inlineChat.background",{dark:jo,light:jo,hcDark:jo,hcLight:jo},p("inlineChat.background","Background color of the interactive editor widget"));ee("inlineChat.border",{dark:ll,light:ll,hcDark:ll,hcLight:ll},p("inlineChat.border","Border color of the interactive editor widget"));ee("inlineChat.shadow",{dark:kb,light:kb,hcDark:kb,hcLight:kb},p("inlineChat.shadow","Shadow color of the interactive editor widget"));ee("inlineChat.regionHighlight",{dark:ul,light:ul,hcDark:ul,hcLight:ul},p("inlineChat.regionHighlight","Background highlighting of the current interactive region. Must be transparent."),!0);ee("inlineChatInput.border",{dark:ll,light:ll,hcDark:ll,hcLight:ll},p("inlineChatInput.border","Border color of the interactive editor input"));ee("inlineChatInput.focusBorder",{dark:hl,light:hl,hcDark:hl,hcLight:hl},p("inlineChatInput.focusBorder","Border color of the interactive editor input when focused"));ee("inlineChatInput.placeholderForeground",{dark:Tb,light:Tb,hcDark:Tb,hcLight:Tb},p("inlineChatInput.placeholderForeground","Foreground color of the interactive editor input placeholder"));ee("inlineChatInput.background",{dark:Ib,light:Ib,hcDark:Ib,hcLight:Ib},p("inlineChatInput.background","Background color of the interactive editor input"));ee("inlineChatDiff.inserted",{dark:Xe(Rb,.5),light:Xe(Rb,.5),hcDark:Xe(Rb,.5),hcLight:Xe(Rb,.5)},p("inlineChatDiff.inserted","Background color of inserted text in the interactive editor input"));ee("inlineChatrDiff.removed",{dark:Xe(Pb,.5),light:Xe(Pb,.5),hcDark:Xe(Pb,.5),hcLight:Xe(Pb,.5)},p("inlineChatDiff.removed","Background color of removed text in the interactive editor input"));st.as(U3.ConfigurationMigration).registerConfigurationMigrations([{key:"interactiveEditor.editMode",migrateFn:r=>[["inlineChat.mode",{value:r}]]}]);st.as(ks.Configuration).registerConfiguration({id:"editor",properties:{"inlineChat.mode":{description:p("mode","Configure if changes crafted in the interactive editor are applied directly to the document or are previewed first."),default:"livePreview",type:"string",enum:["livePreview","preview","live"],markdownEnumDescriptions:[p("mode.livePreview","Changes are applied directly to the document and are highlighted visually via inline or side-by-side diffs. Ending a session will keep the changes."),p("mode.preview","Changes are previewed only and need to be accepted via the apply button. Ending a session will discard the changes."),p("mode.live","Changes are applied directly to the document but can be highlighted via inline diffs. Ending a session will keep the changes.")]}}});const U4=re("chatWidgetService"),V4=re("remoteExplorerService"),HR="remote.tunnels.toRestore",jR="remote.autoForwardPorts",PB="remote.autoForwardPortsSource",AB="output";var Hh;(function(r){r.Other="Other",r.User="User",r.AutoForwardEnd="AutoForwardEnd"})(Hh||(Hh={}));var la;(function(r){r[r.User=0]="User",r[r.Auto=1]="Auto",r[r.Extension=2]="Extension"})(la||(la={}));const BR={source:la.User,description:p("tunnel.source.user","User Forwarded")};function ys(r,e){return r+":"+e}function Tue(r){var t;const e=r.match(/^([a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*:)?([0-9]+)$/);if(e)return{host:((t=e[1])==null?void 0:t.substring(0,e[1].length-1))||"localhost",port:Number(e[2])}}function MB(r,e,t){const i=r.get(ys(e,t));if(i)return i;if(t$(e))for(const n of e$){const s=ys(n,t);if(r.has(s))return r.get(s)}else if(i$(e))for(const n of F3){const s=ys(n,t);if(r.has(s))return r.get(s)}}function gs(r,e,t){const i=MB(r,e,t);if(i)return i;const n=i$(e)?"localhost":t$(e)?"0.0.0.0":void 0;if(n)return MB(r,n,t)}var nl;(function(r){r.Notify="notify",r.OpenBrowser="openBrowser",r.OpenBrowserOnce="openBrowserOnce",r.OpenPreview="openPreview",r.Silent="silent",r.Ignore="ignore"})(nl||(nl={}));class Lr extends ne{constructor(e){super(),this.configurationService=e,this.portsAttributes=[],this._onDidChangeAttributes=new A,this.onDidChangeAttributes=this._onDidChangeAttributes.event,this._register(e.onDidChangeConfiguration(t=>{(t.affectsConfiguration(Lr.SETTING)||t.affectsConfiguration(Lr.DEFAULTS))&&this.updateAttributes()})),this.updateAttributes()}updateAttributes(){this.portsAttributes=this.readSetting(),this._onDidChangeAttributes.fire()}getAttributes(e,t,i){let n=this.findNextIndex(e,t,i,this.portsAttributes,0);const s={label:void 0,onAutoForward:void 0,elevateIfNeeded:void 0,requireLocalPort:void 0,protocol:void 0};for(;n>=0;){const o=this.portsAttributes[n];o.key===e?(s.onAutoForward=o.onAutoForward??s.onAutoForward,s.elevateIfNeeded=o.elevateIfNeeded!==void 0?o.elevateIfNeeded:s.elevateIfNeeded,s.label=o.label??s.label,s.requireLocalPort=o.requireLocalPort,s.protocol=o.protocol):(s.onAutoForward=s.onAutoForward??o.onAutoForward,s.elevateIfNeeded=s.elevateIfNeeded!==void 0?s.elevateIfNeeded:o.elevateIfNeeded,s.label=s.label??o.label,s.requireLocalPort=s.requireLocalPort!==void 0?s.requireLocalPort:void 0,s.protocol=s.protocol??o.protocol),n=this.findNextIndex(e,t,i,this.portsAttributes,n+1)}return s.onAutoForward!==void 0||s.elevateIfNeeded!==void 0||s.label!==void 0||s.requireLocalPort!==void 0||s.protocol!==void 0?s:this.getOtherAttributes()}hasStartEnd(e){return e.start!==void 0&&e.end!==void 0}hasHostAndPort(e){return e.host!==void 0&&e.port!==void 0&&Rt(e.host)&&pr(e.port)}findNextIndex(e,t,i,n,s){if(s>=n.length)return-1;const o=!t$(t)&&!i$(t),c=n.slice(s).findIndex(d=>pr(d.key)?o?!1:d.key===e:this.hasStartEnd(d.key)?o?!1:e>=d.key.start&&e<=d.key.end:this.hasHostAndPort(d.key)?e===d.key.port&&t===d.key.host:i?d.key.test(i):!1);return c>=0?c+s:-1}readSetting(){const e=this.configurationService.getValue(Lr.SETTING);if(!e||!bn(e))return[];const t=[];for(const n in e){if(n===void 0)continue;const s=e[n];let o;if(Number(n))o=Number(n);else if(Rt(n))if(Lr.RANGE.test(n)){const a=n.match(Lr.RANGE);o={start:Number(a[1]),end:Number(a[2])}}else if(Lr.HOST_AND_PORT.test(n)){const a=n.match(Lr.HOST_AND_PORT);o={host:a[1],port:Number(a[2])}}else{let a;try{a=RegExp(n)}catch{}a&&(o=a)}o&&t.push({key:o,elevateIfNeeded:s.elevateIfNeeded,onAutoForward:s.onAutoForward,label:s.label,requireLocalPort:s.requireLocalPort,protocol:s.protocol})}const i=this.configurationService.getValue(Lr.DEFAULTS);return i&&(this.defaultPortAttributes={elevateIfNeeded:i.elevateIfNeeded,label:i.label,onAutoForward:i.onAutoForward,requireLocalPort:i.requireLocalPort,protocol:i.protocol}),this.sortAttributes(t)}sortAttributes(e){function t(i,n){return pr(i.key)?i.key:n.hasStartEnd(i.key)?i.key.start:n.hasHostAndPort(i.key)?i.key.port:Number.MAX_VALUE}return e.sort((i,n)=>t(i,this)-t(n,this))}getOtherAttributes(){return this.defaultPortAttributes}static providedActionToAction(e){switch(e){case tl.Notify:return nl.Notify;case tl.OpenBrowser:return nl.OpenBrowser;case tl.OpenBrowserOnce:return nl.OpenBrowserOnce;case tl.OpenPreview:return nl.OpenPreview;case tl.Silent:return nl.Silent;case tl.Ignore:return nl.Ignore;default:return}}async addAttributes(e,t,i){const s=this.configurationService.inspect(Lr.SETTING).userRemoteValue;let o;!s||!bn(s)?o={}:o=Gi(s),o[`${e}`]||(o[`${e}`]={});for(const a in t)o[`${e}`][a]=t[a];return this.configurationService.updateValue(Lr.SETTING,o,i)}}Lr.SETTING="remote.portsAttributes";Lr.DEFAULTS="remote.otherPortsAttributes";Lr.RANGE=/^(\d+)\-(\d+)$/;Lr.HOST_AND_PORT=/^([a-z0-9\-]+):(\d{1,5})$/;const Iue=10*1e3;let XE=class extends ne{constructor(e,t,i,n,s,o,a,c){super(),this.tunnelService=e,this.storageService=t,this.configurationService=i,this.environmentService=n,this.remoteAuthorityResolverService=s,this.workspaceContextService=o,this.logService=a,this.dialogService=c,this.inProgress=new Map,this._onForwardPort=new A,this.onForwardPort=this._onForwardPort.event,this._onClosePort=new A,this.onClosePort=this._onClosePort.event,this._onPortName=new A,this.onPortName=this._onPortName.event,this._onCandidatesChanged=new A,this.onCandidatesChanged=this._onCandidatesChanged.event,this._onEnvironmentTunnelsSet=new A,this.onEnvironmentTunnelsSet=this._onEnvironmentTunnelsSet.event,this._environmentTunnelsSet=!1,this.unrestoredExtensionTunnels=new Map,this.sessionCachedProperties=new Map,this.portAttributesProviders=[],this.mismatchCooldown=new Date,this.configPortsAttributes=new Lr(i),this.tunnelRestoreValue=this.getTunnelRestoreValue(),this._register(this.configPortsAttributes.onDidChangeAttributes(this.updateAttributes,this)),this.forwarded=new Map,this.remoteTunnels=new Map,this.tunnelService.tunnels.then(async d=>{var u;const l=await this.getAttributes(d.map(h=>({port:h.tunnelRemotePort,host:h.tunnelRemoteHost})));for(const h of d)if(h.localAddress){const g=ys(h.tunnelRemoteHost,h.tunnelRemotePort),m=gs(this._candidates??new Map,h.tunnelRemoteHost,h.tunnelRemotePort);this.forwarded.set(g,{remotePort:h.tunnelRemotePort,remoteHost:h.tunnelRemoteHost,localAddress:h.localAddress,protocol:((u=l==null?void 0:l.get(h.tunnelRemotePort))==null?void 0:u.protocol)??co.Http,localUri:await this.makeLocalUri(h.localAddress,l==null?void 0:l.get(h.tunnelRemotePort)),localPort:h.tunnelLocalPort,runningProcess:m==null?void 0:m.detail,hasRunningProcess:!!m,pid:m==null?void 0:m.pid,privacy:h.privacy,source:BR}),this.remoteTunnels.set(g,h)}}),this.detected=new Map,this._register(this.tunnelService.onTunnelOpened(async d=>{var u;const l=ys(d.tunnelRemoteHost,d.tunnelRemotePort);if(!gs(this.forwarded,d.tunnelRemoteHost,d.tunnelRemotePort)&&!gs(this.detected,d.tunnelRemoteHost,d.tunnelRemotePort)&&!gs(this.inProgress,d.tunnelRemoteHost,d.tunnelRemotePort)&&d.localAddress){const h=gs(this._candidates??new Map,d.tunnelRemoteHost,d.tunnelRemotePort),g=(u=await this.getAttributes([{port:d.tunnelRemotePort,host:d.tunnelRemoteHost}]))==null?void 0:u.get(d.tunnelRemotePort);this.forwarded.set(l,{remoteHost:d.tunnelRemoteHost,remotePort:d.tunnelRemotePort,localAddress:d.localAddress,protocol:(g==null?void 0:g.protocol)??co.Http,localUri:await this.makeLocalUri(d.localAddress,g),localPort:d.tunnelLocalPort,closeable:!0,runningProcess:h==null?void 0:h.detail,hasRunningProcess:!!h,pid:h==null?void 0:h.pid,privacy:d.privacy,source:BR})}await this.storeForwarded(),this.remoteTunnels.set(l,d),this._onForwardPort.fire(this.forwarded.get(l))})),this._register(this.tunnelService.onTunnelClosed(d=>this.onTunnelClosed(d,Hh.Other)))}async onTunnelClosed(e,t){const i=ys(e.host,e.port);this.forwarded.has(i)&&(this.forwarded.delete(i),await this.storeForwarded(),this._onClosePort.fire(e))}makeLocalUri(e,t){if(e.startsWith("http"))return k.parse(e);const i=(t==null?void 0:t.protocol)??"http";return k.parse(`${i}://${e}`)}async getStorageKey(){const e=this.workspaceContextService.getWorkspace(),t=e.configuration?yc(e.configuration.path):e.folders.length>0?yc(e.folders[0].uri.path):void 0;if(t===void 0){this.logService.debug("Could not get workspace hash for forwarded ports storage key.");return}return`${HR}.${this.environmentService.remoteAuthority}.${t}`}async getTunnelRestoreValue(){const e=this.storageService.get(HR,1);if(e)return this.storageService.remove(HR,1),await this.storeForwarded(),e;const t=await this.getStorageKey();if(t)return this.storageService.get(t,0)}async restoreForwarded(){if(this.configurationService.getValue("remote.restoreForwardedPorts")){const e=await this.tunnelRestoreValue;if(e&&e!==this.knownPortsRestoreValue){const t=JSON.parse(e)??[];this.logService.trace(`ForwardedPorts: (TunnelModel) restoring ports ${t.map(i=>i.remotePort).join(", ")}`);for(const i of t){const n=gs(this.detected,i.remoteHost,i.remotePort);i.source.source===la.User&&!n||i.source.source===la.Extension&&n?await this.forward({remote:{host:i.remoteHost,port:i.remotePort},local:i.localPort,name:i.name,privacy:i.privacy,elevateIfNeeded:!0}):i.source.source===la.Extension&&!n&&this.unrestoredExtensionTunnels.set(ys(i.remoteHost,i.remotePort),i)}}}if(!this.restoreListener){const e=await this.getStorageKey();this.restoreListener=this._register(this.storageService.onDidChangeValue(async t=>{t.key===e&&(this.tunnelRestoreValue=Promise.resolve(this.storageService.get(e,0)),await this.restoreForwarded())}))}}async storeForwarded(){if(this.configurationService.getValue("remote.restoreForwardedPorts")){const e=JSON.stringify(Array.from(this.forwarded.values()).filter(t=>t.source.source!==la.Auto));if(e!==this.knownPortsRestoreValue){this.knownPortsRestoreValue=e;const t=await this.getStorageKey();t&&this.storageService.store(t,this.knownPortsRestoreValue,0,0)}}}async showPortMismatchModalIfNeeded(e,t,i){if(!e.tunnelLocalPort||!(i!=null&&i.requireLocalPort)||e.tunnelLocalPort===t)return;const n=new Date;if(this.mismatchCooldown.getTime()+Iue>n.getTime())return;this.mismatchCooldown=n;const s=p("remote.localPortMismatch.single",`Local port {0} could not be used for forwarding to remote port {1}.

This usually happens when there is already another process using local port {0}.

Port number {2} has been used instead.`,t,e.tunnelRemotePort,e.tunnelLocalPort);return this.dialogService.info(s)}async forward(e,t){var s;const i=gs(this.forwarded,e.remote.host,e.remote.port);t=t??(t!==null?(s=await this.getAttributes([e.remote]))==null?void 0:s.get(e.remote.port):void 0);const n=e.local!==void 0?e.local:e.remote.port;if(i)return this.mergeAttributesIntoExistingTunnel(i,e,t);{const o=this.environmentService.remoteAuthority,a=o?{getAddress:async()=>(await this.remoteAuthorityResolverService.resolveAuthority(o)).authority}:void 0,c=ys(e.remote.host,e.remote.port);this.inProgress.set(c,!0),e=this.mergeCachedAndUnrestoredProperties(c,e);const d=await this.tunnelService.openTunnel(a,e.remote.host,e.remote.port,void 0,n,e.elevateIfNeeded?e.elevateIfNeeded:t==null?void 0:t.elevateIfNeeded,e.privacy,t==null?void 0:t.protocol);if(d&&d.localAddress){const l=gs(this._candidates??new Map,e.remote.host,e.remote.port),u=d.protocol?d.protocol===co.Https?co.Https:co.Http:(t==null?void 0:t.protocol)??co.Http,h={remoteHost:d.tunnelRemoteHost,remotePort:d.tunnelRemotePort,localPort:d.tunnelLocalPort,name:(t==null?void 0:t.label)??e.name,closeable:!0,localAddress:d.localAddress,protocol:u,localUri:await this.makeLocalUri(d.localAddress,t),runningProcess:l==null?void 0:l.detail,hasRunningProcess:!!l,pid:l==null?void 0:l.pid,source:e.source??BR,privacy:d.privacy};return this.forwarded.set(c,h),this.remoteTunnels.set(c,d),this.inProgress.delete(c),await this.storeForwarded(),await this.showPortMismatchModalIfNeeded(d,n,t),this._onForwardPort.fire(h),d}this.inProgress.delete(c)}}mergeCachedAndUnrestoredProperties(e,t){const i=this.unrestoredExtensionTunnels.has(e)?this.unrestoredExtensionTunnels:this.sessionCachedProperties.has(e)?this.sessionCachedProperties:void 0;if(i){const n=i.get(e);i.delete(e),n&&(t.name=n.name??t.name,t.local=("local"in n?n.local:"localPort"in n?n.localPort:void 0)??t.local,t.privacy=n.privacy??t.privacy)}return t}async mergeAttributesIntoExistingTunnel(e,t,i){const n=(i==null?void 0:i.label)??t.name;let s;(function(a){a[a.None=0]="None",a[a.Fire=1]="Fire",a[a.Reopen=2]="Reopen"})(s||(s={}));let o=s.None;switch(n!==e.name&&(e.name=n,o=s.Fire),(i!=null&&i.protocol||e.protocol!==co.Http)&&(i==null?void 0:i.protocol)!==e.protocol&&(t.source=e.source,o=s.Reopen),t.privacy&&e.privacy!==t.privacy&&(o=s.Reopen),o){case s.Fire:{this._onForwardPort.fire();break}case s.Reopen:await this.close(e.remoteHost,e.remotePort,Hh.User),await this.forward(t,i)}return gs(this.remoteTunnels,t.remote.host,t.remote.port)}async name(e,t,i){const n=gs(this.forwarded,e,t),s=ys(e,t);if(n){n.name=i,await this.storeForwarded(),this._onPortName.fire({host:e,port:t});return}else this.detected.has(s)&&(this.detected.get(s).name=i,this._onPortName.fire({host:e,port:t}))}async close(e,t,i){const n=ys(e,t),s=this.forwarded.get(n);return i===Hh.AutoForwardEnd&&s&&s.source.source===la.Auto&&this.sessionCachedProperties.set(n,{local:s.localPort,name:s.name,privacy:s.privacy}),await this.tunnelService.closeTunnel(e,t),this.onTunnelClosed({host:e,port:t},i)}address(e,t){var n;const i=ys(e,t);return(n=this.forwarded.get(i)||this.detected.get(i))==null?void 0:n.localAddress}get environmentTunnelsSet(){return this._environmentTunnelsSet}addEnvironmentTunnels(e){if(e)for(const t of e){const i=gs(this._candidates??new Map,t.remoteAddress.host,t.remoteAddress.port),n=typeof t.localAddress=="string"?t.localAddress:ys(t.localAddress.host,t.localAddress.port);this.detected.set(ys(t.remoteAddress.host,t.remoteAddress.port),{remoteHost:t.remoteAddress.host,remotePort:t.remoteAddress.port,localAddress:n,protocol:co.Http,localUri:this.makeLocalUri(n),closeable:!1,runningProcess:i==null?void 0:i.detail,hasRunningProcess:!!i,pid:i==null?void 0:i.pid,privacy:Sl.ConstantPrivate,source:{source:la.Extension,description:p("tunnel.staticallyForwarded","Statically Forwarded")}}),this.tunnelService.setEnvironmentTunnel(t.remoteAddress.host,t.remoteAddress.port,n,Sl.ConstantPrivate,co.Http)}this._environmentTunnelsSet=!0,this._onEnvironmentTunnelsSet.fire(),this._onForwardPort.fire()}setCandidateFilter(e){this._candidateFilter=e}async setCandidates(e){let t=e;this._candidateFilter&&(t=await this._candidateFilter(e));const i=this.updateInResponseToCandidates(t);this.logService.trace(`ForwardedPorts: (TunnelModel) removed candidates ${Array.from(i.values()).map(n=>n.port).join(", ")}`),this._onCandidatesChanged.fire(i)}updateInResponseToCandidates(e){const t=this._candidates??new Map,i=new Map;return this._candidates=i,e.forEach(n=>{const s=ys(n.host,n.port);i.set(s,{host:n.host,port:n.port,detail:n.detail,pid:n.pid}),t.has(s)&&t.delete(s);const o=gs(this.forwarded,n.host,n.port);o&&(o.runningProcess=n.detail,o.hasRunningProcess=!0,o.pid=n.pid)}),t.forEach((n,s)=>{const o=Tue(s);if(!o)return;const a=gs(this.forwarded,o.host,o.port);a&&(a.runningProcess=void 0,a.hasRunningProcess=!1,a.pid=void 0);const c=gs(this.detected,o.host,o.port);c&&(c.runningProcess=void 0,c.hasRunningProcess=!1,c.pid=void 0)}),t}get candidates(){return this._candidates?Array.from(this._candidates.values()):[]}get candidatesOrUndefined(){return this._candidates?this.candidates:void 0}async updateAttributes(){const e=Array.from(this.forwarded.values()),t=await this.getAttributes(e.map(i=>({port:i.remotePort,host:i.remoteHost})),!1);if(t)for(const i of e){const n=t.get(i.remotePort);(n!=null&&n.protocol||i.protocol!==co.Http)&&(n==null?void 0:n.protocol)!==i.protocol&&await this.forward({remote:{host:i.remoteHost,port:i.remotePort},local:i.localPort,name:i.name,source:i.source},n),n&&n.label&&n.label!==i.name&&await this.name(i.remoteHost,i.remotePort,n.label)}}async getAttributes(e,t=!0){const i=new Map,n=new Map;e.forEach(d=>{var u;const l=gs(this._candidates??new Map,e$[0],d.port)??d;if(l){i.set(d.port,l);const h=Rue(l)?l.pid:void 0;n.has(h)||n.set(h,[]),(u=n.get(h))==null||u.push(d.port)}});const s=new Map;if(e.forEach(d=>{var u;const l=this.configPortsAttributes.getAttributes(d.port,d.host,(u=i.get(d.port))==null?void 0:u.detail);l&&s.set(d.port,l)}),this.portAttributesProviders.length===0||!t)return s.size>0?s:void 0;const o=await Promise.all(qy(this.portAttributesProviders.map(d=>Array.from(n.entries()).map(l=>{const u=l[1],h=i.get(u[0]);return d.providePortAttributes(u,h==null?void 0:h.pid,h==null?void 0:h.detail,new Xt().token)})))),a=new Map;if(o.forEach(d=>d.forEach(l=>{l&&a.set(l.port,l)})),!s&&!a)return;const c=new Map;return e.forEach(d=>{const l=s.get(d.port),u=a.get(d.port);c.set(d.port,{elevateIfNeeded:l==null?void 0:l.elevateIfNeeded,label:l==null?void 0:l.label,onAutoForward:(l==null?void 0:l.onAutoForward)??Lr.providedActionToAction(u==null?void 0:u.autoForwardAction),requireLocalPort:l==null?void 0:l.requireLocalPort,protocol:l==null?void 0:l.protocol})}),c}addAttributesProvider(e){this.portAttributesProviders.push(e)}};XE.__decorator=T([pk(1e3)],XE.prototype,"storeForwarded",null);XE=T([v(0,Z1),v(1,ri),v(2,We),v(3,Ar),v(4,wu),v(5,oi),v(6,ze),v(7,ar)],XE);function Rue(r){return r&&"host"in r&&typeof r.host=="string"&&"port"in r&&typeof r.port=="number"&&(!("detail"in r)||typeof r.detail=="string")&&(!("pid"in r)||typeof r.pid=="string")}const q4=re("IAuthenticationService"),Pue="timeline",G4=re(Pue),z4=re("testService"),K4=re("secretStorageService"),Q4=re("shareService"),Y4=re("workbenchIssueService");var k0;(function(r){r[r.cell=0]="cell",r[r.notebook=1]="notebook"})(k0||(k0={}));const X4=re("INotebookExecutionStateService"),J4=re("IChatContributionService"),Z4=re("testProfileService"),e5=re("encryptionService"),t5=re("testResultService"),Aue="diagnosticsService",Mue=re(Aue);class Lue{async getPerformanceInfo(e,t){return{}}async getSystemInfo(e,t){return{processArgs:"nullProcessArgs",gpuStatus:"nullGpuStatus",screenReader:"nullScreenReader",remoteData:[],os:"nullOs",memory:"nullMemory",vmHint:"nullVmHint"}}async getDiagnostics(e,t){return""}async getWorkspaceFileExtensions(e){return{extensions:[]}}async reportWorkspaceStats(e){}}function w(){throw new Error("unsupported")}function Fue(r){let e=null;return(...t)=>(e==null&&(e=r(...t)),e)}function yAe(r){return new Proxy(r,{construct:Fue((e,t)=>Reflect.construct(r,t))})}class Oue extends XN{constructor(){super(ua.Info,k.file("logs.log"))}doCreateLogger(){return new gY}}ie(Is,Oue,0);ie(Ke,class{constructor(){this._serviceBrand=void 0,this.onDidActiveEditorChange=F.None,this.onDidVisibleEditorsChange=F.None,this.onDidEditorsChange=F.None,this.onDidCloseEditor=F.None,this.activeEditorPane=void 0,this.activeEditor=void 0,this.activeTextEditorLanguageId=void 0,this.visibleEditorPanes=[],this.visibleEditors=[],this.visibleTextEditorControls=[],this.editors=[],this.count=0,this.getEditors=()=>[],this.openEditor=w,this.openEditors=w,this.replaceEditors=async()=>{},this.isOpened=()=>!1,this.isVisible=()=>!1,this.closeEditor=async()=>{},this.closeEditors=async()=>{},this.findEditors=()=>[],this.save=async()=>({success:!1,editors:[]}),this.saveAll=async()=>({success:!1,editors:[]}),this.revert=async()=>!1,this.revertAll=async()=>!1}get activeTextEditorControl(){return ka.get(En).getFocusedCodeEditor()??void 0}},0);ie(Jm,class{constructor(){this._serviceBrand=void 0,this.onDidPaneCompositeOpen=F.None,this.onDidPaneCompositeClose=F.None,this.openPaneComposite=async()=>{},this.getActivePaneComposite=()=>{},this.getPaneComposite=()=>{},this.getPaneComposites=()=>[],this.getPinnedPaneCompositeIds=()=>[],this.getVisiblePaneCompositeIds=()=>[],this.getProgressIndicator=()=>{},this.hideActivePaneComposite=()=>{},this.getLastActivePaneCompositeId=w,this.showActivity=()=>ne.None}},0);ie(Hi,VM,1);ie(Dn,BM,0);ie(at,class{constructor(){this._serviceBrand=void 0,this.onDidChangeFileSystemProviderRegistrations=F.None,this.onDidChangeFileSystemProviderCapabilities=F.None,this.onWillActivateFileSystemProvider=F.None,this.registerProvider=w,this.getProvider=function(){},this.activateProvider=async()=>{},this.canHandleResource=async()=>!1,this.hasProvider=()=>!1,this.hasCapability=()=>!1,this.listCapabilities=()=>[],this.onDidFilesChange=F.None,this.onDidRunOperation=F.None,this.resolve=w,this.resolveAll=w,this.stat=w,this.exists=async()=>!1,this.readFile=w,this.readFileStream=w,this.writeFile=w,this.move=w,this.canMove=w,this.copy=w,this.canCopy=w,this.cloneFile=w,this.createFile=w,this.canCreateFile=w,this.createFolder=w,this.del=w,this.canDelete=w,this.onDidWatchError=F.None,this.watch=w}dispose(){}},0);class Nue{constructor(){this.onDidModelChange=F.None,this.onWillDispose=F.None,this.onDidActiveEditorChange=F.None,this.onWillCloseEditor=F.None,this.onDidCloseEditor=F.None,this.onWillMoveEditor=F.None,this.onWillOpenEditor=F.None,this.id=0,this.index=0,this.label="main",this.ariaLabel="main",this.activeEditorPane=void 0,this.activeEditor=null,this.previewEditor=null,this.count=0,this.isEmpty=!1,this.isLocked=!1,this.stickyCount=0,this.editors=[],this.getEditors=w,this.findEditors=w,this.getEditorByIndex=w,this.getIndexOfEditor=w,this.openEditor=w,this.openEditors=w,this.isPinned=w,this.isSticky=w,this.isActive=w,this.contains=w,this.moveEditor=w,this.moveEditors=w,this.copyEditor=w,this.copyEditors=w,this.closeEditor=w,this.closeEditors=w,this.closeAllEditors=w,this.replaceEditors=w,this.pinEditor=w,this.stickEditor=w,this.unstickEditor=w,this.lock=w,this.isFirst=()=>!0,this.isLast=()=>!0}get scopedContextKeyService(){return ka.get(It)}focus(){}}const LB=new Nue;ie(it,class{constructor(){this._serviceBrand=void 0,this.getLayout=w,this.onDidChangeActiveGroup=F.None,this.onDidAddGroup=F.None,this.onDidRemoveGroup=F.None,this.onDidMoveGroup=F.None,this.onDidActivateGroup=F.None,this.onDidLayout=F.None,this.onDidScroll=F.None,this.onDidChangeGroupIndex=F.None,this.onDidChangeGroupLocked=F.None,this.activeGroup=LB,this.groups=[LB],this.count=0,this.orientation=0,this.isReady=!1,this.whenReady=Promise.resolve(),this.whenRestored=Promise.resolve(),this.hasRestorableState=!1,this.getGroups=()=>[],this.getGroup=()=>{},this.activateGroup=w,this.getSize=w,this.setSize=w,this.arrangeGroups=w,this.applyLayout=w,this.centerLayout=w,this.isLayoutCentered=()=>!1,this.setGroupOrientation=w,this.findGroup=()=>{},this.addGroup=w,this.removeGroup=w,this.moveGroup=w,this.mergeGroup=w,this.mergeAllGroups=w,this.copyGroup=w,this.onDidChangeEditorPartOptions=F.None,this.enforcePartOptions=w}get contentDimension(){return w()}get sideGroup(){return w()}get partOptions(){return w()}},0);ie($a,IM,0);ie(ta,MM,1);ie(Rs,class{constructor(){this._serviceBrand=void 0,this.version="1.80.0",this.commit="660393deaaa6d1996740ff4880f1bad43768c814",this.nameShort="Code - OSS Dev",this.nameLong="Code - OSS Dev",this.applicationName="code-oss",this.dataFolderName=".vscode-oss",this.urlProtocol="code-oss",this.reportIssueUrl="https://github.com/microsoft/vscode/issues/new",this.licenseName="MIT",this.licenseUrl="https://github.com/microsoft/vscode/blob/main/LICENSE.txt",this.serverApplicationName="code-server-oss"}},0);ie(p3,class{constructor(){this._provider=new YN,this.onDidChange=this._provider.onDidChange}addStatus(e){return this._provider.register(e.selector,e)}getLanguageStatus(e){return this._provider.ordered(e).sort((t,i)=>{let n=i.severity-t.severity;return n===0&&(n=Sa(t.source,i.source)),n===0&&(n=Sa(t.id,i.id)),n})}},0);const FB=Um(window),$ue=new gk(window.document,"visibilitychange"),Wue=F.latch(F.any(F.map(FB.onDidFocus,()=>document.hasFocus()),F.map(FB.onDidBlur,()=>document.hasFocus()),F.map($ue.event,()=>document.hasFocus())));ie(bu,class{constructor(){this.onDidChangeFocus=Wue,this.openWindow=w,this.restart=w,this.reload=w,this.close=w}get hasFocus(){return document.hasFocus()}async hadLastFocus(){return!0}async focus(){window.focus()}async toggleFullScreen(){document.fullscreenEnabled?await document.body.requestFullscreen():await document.exitFullscreen()}},0);ie(ea,class extends OE{constructor(){super(...arguments),this.shutdown=w}},0);ie(ab,class{isEnabledForLanguage(){return!1}async detectLanguage(){}},0);ie(yr,Lce,0);ie(y3,class{constructor(){this.onDidChangeKeyboardLayout=F.None,this.getRawKeyboardMapping=()=>null,this.getCurrentKeyboardLayout=()=>null,this.getAllKeyboardLayouts=()=>[],this.getKeyboardMapper=()=>new $ce(!1,dc),this.validateCurrentKeyboardMapping=()=>{}}},1);ie(OT,class{async requiresInitialization(){return!1}async whenInitializationFinished(){}async initializeRequiredResources(){}async initializeInstalledExtensions(){}async initializeOtherResources(){}},0);ie(Oce,Fce,0);ie(Q1,class{constructor(){this.userSettingsResource=Ey.settingsResource,this.workspaceSettingsResource=null,this.getFolderSettingsResource=w,this.createPreferencesEditorModel=w,this.resolveModel=w,this.createSettings2EditorModel=w,this.openRawDefaultSettings=w,this.openSettings=w,this.openUserSettings=w,this.openRemoteSettings=w,this.openWorkspaceSettings=w,this.openFolderSettings=w,this.openGlobalKeybindingSettings=w,this.openDefaultKeybindingsFile=w,this.getEditableSettingsURI=w,this.createSplitJsonEditorInput=w,this.openApplicationSettings=w,this.openLanguageSpecificSettings=w}},0);ie(w3,class{constructor(){this.onDidEncounterLanguage=F.None,this.createGrammar=w,this.startDebugMode=w}},0);const Ey={id:"default",isDefault:!0,name:"default",location:k.from({scheme:"user",path:"/profile.json"}),globalStorageHome:k.from({scheme:"user",path:"/globalStorage"}),settingsResource:k.from({scheme:"user",path:"/settings.json"}),keybindingsResource:k.from({scheme:"user",path:"/keybindings.json"}),tasksResource:k.from({scheme:"user",path:"/tasks.json"}),snippetsHome:k.from({scheme:"user",path:"/snippets"}),extensionsResource:k.from({scheme:"user",path:"/extensions.json"}),cacheHome:k.from({scheme:"cache",path:"/"})};ie(Pf,class{constructor(){this.onDidResetWorkspaces=F.None,this.isEnabled=()=>!1,this.createNamedProfile=w,this.createTransientProfile=w,this.resetWorkspaces=w,this.cleanUp=w,this.cleanUpTransientProfiles=w,this.defaultProfile=Ey,this.onDidChangeProfiles=F.None,this.profiles=[Ey],this.createProfile=w,this.updateProfile=w,this.setProfileForWorkspace=w,this.getProfile=()=>Ey,this.removeProfile=w}get profilesHome(){return w()}},0);let T0=class extends PM{constructor(e){super(Ey,e)}};T0=T([v(0,Pf)],T0);ie(NT,T0,0);ie(hY,class{constructor(){this.updatePolicyDefinitions=w,this.onDidChange=F.None,this.registerPolicyDefinitions=w,this.getPolicyValue=()=>{},this.serialize=()=>{}}},0);ie($T,class{constructor(){this.getSnippetFiles=w,this.isEnabled=w,this.updateEnablement=w,this.updateUsageTimestamp=w,this.getSnippets=async()=>[],this.getSnippetsSync=w}},0);const Hue={getSession:()=>{},getSessions:()=>[],getBreakpoints:()=>[],areBreakpointsActivated:()=>!1,getFunctionBreakpoints:()=>[],getDataBreakpoints:()=>[],getExceptionBreakpoints:()=>[],getExceptionBreakpointsForSession:()=>[],getInstructionBreakpoints:()=>[],getWatchExpressions:()=>[],onDidChangeBreakpoints:F.None,onDidChangeCallStack:F.None,onDidChangeWatchExpressions:F.None,fetchCallstack:w,getId:w};class jue{constructor(){this.getId=w,this.focusedSession=void 0,this.focusedThread=void 0,this.focusedStackFrame=void 0,this.getSelectedExpression=w,this.setSelectedExpression=w,this.updateViews=w,this.isMultiSessionView=w,this.onDidFocusSession=F.None,this.onDidFocusStackFrame=F.None,this.onDidSelectExpression=F.None,this.onDidEvaluateLazyExpression=F.None,this.onWillUpdateViews=F.None,this.onDidFocusThread=F.None,this.evaluateLazyExpression=w}}class Bue{constructor(){this.onDidRegisterDebugger=F.None,this.hasEnabledDebuggers=()=>!1,this.getDebugAdapterDescriptor=w,this.getDebuggerLabel=w,this.someDebuggerInterestedInLanguage=()=>!1,this.getDebugger=()=>{},this.activateDebuggers=w,this.registerDebugAdapterFactory=()=>ne.None,this.createDebugAdapter=w,this.registerDebugAdapterDescriptorFactory=w,this.unregisterDebugAdapterDescriptorFactory=w,this.substituteVariables=w,this.runInTerminal=w,this.getEnabledDebugger=w,this.guessDebugger=w,this.onDidDebuggersExtPointRead=F.None}}ie(wz,class{constructor(){this.onDidChangeState=F.None,this.onDidNewSession=F.None,this.onWillNewSession=F.None,this.onDidEndSession=F.None,this.getConfigurationManager=w,this.getAdapterManager=()=>new Bue,this.focusStackFrame=w,this.canSetBreakpointsIn=w,this.addBreakpoints=w,this.updateBreakpoints=w,this.enableOrDisableBreakpoints=w,this.setBreakpointsActivated=w,this.removeBreakpoints=w,this.addFunctionBreakpoint=w,this.updateFunctionBreakpoint=w,this.removeFunctionBreakpoints=w,this.addDataBreakpoint=w,this.removeDataBreakpoints=w,this.addInstructionBreakpoint=w,this.removeInstructionBreakpoints=w,this.setExceptionBreakpointCondition=w,this.setExceptionBreakpointsForSession=w,this.sendAllBreakpoints=w,this.addWatchExpression=w,this.renameWatchExpression=w,this.moveWatchExpression=w,this.removeWatchExpressions=w,this.startDebugging=w,this.restartSession=w,this.stopSession=w,this.sourceIsNotAvailable=w,this.getModel=()=>Hue,this.getViewModel=()=>new jue,this.runTo=w}get state(){return w()}},0);ie(P3,NM,0);ie(Oq,class{constructor(){this.onDidInitiateOpenFilesTrustRequest=F.None,this.onDidInitiateWorkspaceTrustRequest=F.None,this.onDidInitiateWorkspaceTrustRequestOnStartup=F.None,this.completeOpenFilesTrustRequest=w,this.requestOpenFilesTrust=async()=>1,this.cancelWorkspaceTrustRequest=w,this.completeWorkspaceTrustRequest=w,this.requestWorkspaceTrust=async()=>!0,this.requestWorkspaceTrustOnStartup=()=>null}},0);ie(b3,class{constructor(){this.showViewContainerActivity=()=>ne.None,this.showViewActivity=()=>ne.None,this.showAccountsActivity=()=>ne.None,this.showGlobalActivity=()=>ne.None}},0);ie(S3,class{constructor(){this.reload=w,this.onReload=F.None,this.close=w,this.onClose=F.None,this.attachSession=w,this.onAttachSession=F.None,this.terminateSession=w,this.onTerminateSession=F.None,this.openExtensionDevelopmentHostWindow=w}},0);ie(ko,class{constructor(){this.onDidChangeViewContainerVisibility=F.None,this.isViewContainerVisible=()=>!1,this.openViewContainer=w,this.closeViewContainer=w,this.getVisibleViewContainer=w,this.getActiveViewPaneContainerWithId=()=>null,this.onDidChangeViewVisibility=F.None,this.isViewVisible=()=>!1,this.openView=async()=>null,this.closeView=w,this.getActiveViewWithId=()=>null,this.getViewWithId=()=>null,this.getViewProgressIndicator=()=>{}}},0);ie(to,class{constructor(){this.viewContainers=[],this.onDidChangeViewContainers=F.None,this.getDefaultViewContainer=()=>{},this.getViewContainerById=()=>null,this.isViewContainerRemovedPermanently=w,this.getDefaultViewContainerLocation=()=>null,this.getViewContainerLocation=()=>null,this.getViewContainersByLocation=w,this.getViewContainerModel=()=>({onDidChangeAllViewDescriptors:F.None,visibleViewDescriptors:[]}),this.onDidChangeContainerLocation=F.None,this.moveViewContainerToLocation=w,this.getViewContainerBadgeEnablementState=w,this.setViewContainerBadgeEnablementState=w,this.getViewDescriptorById=()=>null,this.getViewContainerByViewId=()=>null,this.getDefaultContainerById=()=>null,this.getViewLocationById=()=>null,this.onDidChangeContainer=F.None,this.moveViewsToContainer=w,this.onDidChangeLocation=F.None,this.moveViewToLocation=()=>null,this.reset=()=>null}},0);ie(_r,class{constructor(){this.goForward=w,this.goBack=w,this.goPrevious=w,this.goLast=w,this.reopenLastClosedEditor=w,this.getHistory=()=>[],this.removeFromHistory=w,this.getLastActiveWorkspaceRoot=()=>{},this.getLastActiveFile=()=>{},this.openNextRecentlyUsedEditor=w,this.openPreviouslyUsedEditor=w,this.clear=w,this.clearRecentlyOpened=w}},0);ie(C3,class{constructor(){this.onDidStateChange=F.None,this.supportsMultipleTaskExecutions=!1,this.configureAction=w,this.run=w,this.inTerminal=()=>!1,this.getActiveTasks=async()=>[],this.getBusyTasks=w,this.terminate=w,this.tasks=w,this.taskTypes=w,this.getWorkspaceTasks=w,this.getSavedTasks=w,this.removeRecentlyUsedTask=w,this.getTask=w,this.tryResolveTask=w,this.createSorter=w,this.getTaskDescription=w,this.customize=w,this.openConfig=w,this.registerTaskProvider=w,this.registerTaskSystem=()=>{},this.onDidChangeTaskSystemInfo=F.None,this.hasTaskSystemInfo=!1,this.registerSupportedExecutions=()=>{},this.extensionCallbackTaskComplete=w}},0);ie(E3,class{constructor(){this.resolveWithEnvironment=w,this.resolveAsync=w,this.resolveAnyAsync=w,this.resolveAnyMap=w,this.resolveWithInteractionReplace=w,this.resolveWithInteraction=w,this.contributeVariable=w}},0);ie(Wa,class{constructor(){this.getConnection=()=>null,this.getEnvironment=async()=>null,this.getRawEnvironment=async()=>null,this.getExtensionHostExitInfo=async()=>null,this.getRoundTripTime=async()=>{},this.whenExtensionsReady=async()=>{},this.scanExtensions=async()=>[],this.scanSingleExtension=async()=>null,this.getDiagnosticInfo=async()=>{},this.updateTelemetryLevel=async()=>{},this.logTelemetry=async()=>{},this.flushTelemetry=async()=>{}}},0);ie(fY,fte,0);let I0=class{constructor(e){this.modelService=e,this.registerSearchResultProvider=w}async textSearch(){return{results:[],messages:[]}}async fileSearch(){return{results:this.modelService.getModels().map(e=>({resource:e.uri})),messages:[]}}async clearCache(){}};I0=T([v(0,_i)],I0);ie(cb,I0,0);ie(X1,class{constructor(){this.registerEditSessionIdentityProvider=w,this.getEditSessionIdentifier=w,this.provideEditSessionIdentityMatch=w,this.addEditSessionIdentityCreateParticipant=()=>new me,this.onWillCreateEditSessionIdentity=w}},0);ie(Zm,class{constructor(){this.addFolders=w,this.removeFolders=w,this.updateFolders=w,this.enterWorkspace=w,this.createAndEnterWorkspace=w,this.saveAndEnterWorkspace=w,this.copyWorkspaceSettings=w,this.pickNewWorkspacePath=w}},0);ie(A3,class{constructor(){this.whenReady=w,this.setPerformanceMarks=()=>{},this.getPerformanceMarks=w,this.getDuration=w}get perfBaseline(){return w()}get startupMetrics(){return w()}},0);ie(M3,class{constructor(){this.whenInitialized=Promise.resolve(),this.onChange=F.None,this.onReset=F.None,this.preferPreReleases=!1,this.local=[],this.installed=[],this.outdated=[],this.queryLocal=w,this.queryGallery=w,this.getExtensions=w,this.canInstall=w,this.install=w,this.installInServer=w,this.uninstall=w,this.installVersion=w,this.reinstall=w,this.canSetLanguage=w,this.setLanguage=w,this.setEnablement=w,this.pinExtension=w,this.open=w,this.checkForUpdates=w,this.getExtensionStatus=w,this.isExtensionIgnoredToSync=w,this.toggleExtensionIgnoredToSync=w}},0);ie(ev,class{constructor(){this.onEnablementChanged=F.None,this.getEnablementState=()=>8,this.getEnablementStates=e=>e.map(()=>8),this.getDependenciesEnablementStates=()=>[],this.canChangeEnablement=()=>!1,this.canChangeWorkspaceEnablement=()=>!1,this.isEnabled=()=>!0,this.isEnabledEnablementState=()=>!0,this.isDisabledGlobally=()=>!1,this.setEnablement=w,this.updateExtensionsEnablementsWhenWorkspaceTrustChanges=w}},0);ie(Z1,class{constructor(){this.tunnels=Promise.resolve([]),this.canChangePrivacy=!1,this.privacyOptions=[],this.onTunnelOpened=F.None,this.onTunnelClosed=F.None,this.canElevate=!1,this.hasTunnelProvider=!1,this.onAddedTunnelProvider=F.None,this.canTunnel=()=>!1,this.openTunnel=w,this.getExistingTunnel=async()=>{},this.setEnvironmentTunnel=w,this.closeTunnel=w,this.setTunnelProvider=w,this.setTunnelFeatures=w,this.isPortPrivileged=()=>!1}},0);ie(qr,U_,0);ie(tv,class{constructor(){this.isUntitledWithAssociatedResource=()=>!1,this.onDidChangeDirty=F.None,this.onDidChangeEncoding=F.None,this.onDidChangeLabel=F.None,this.onWillDispose=F.None,this.create=w,this.get=()=>{},this.getValue=()=>{},this.resolve=w}},0);ie(n$,Dde,0);ie(Od,Dce,0);ie(Su,UM,0);ie(o$,wde,0);ie(ia,class{constructor(){this.preferredHome=w,this.defaultFilePath=w,this.defaultFolderPath=w,this.defaultWorkspacePath=w,this.pickFileFolderAndOpen=w,this.pickFileAndOpen=w,this.pickFolderAndOpen=w,this.pickWorkspaceAndOpen=w,this.pickFileToSave=w,this.showSaveDialog=w,this.showSaveConfirm=w,this.showOpenDialog=w}},0);ie(Rde,GM,1);ie(c$,class{constructor(){this.enterWorkspace=w,this.createUntitledWorkspace=w,this.deleteUntitledWorkspace=w,this.getWorkspaceIdentifier=w,this.onDidChangeRecentlyOpened=F.None,this.addRecentlyOpened=w,this.removeRecentlyOpened=w,this.clearRecentlyOpened=w,this.getRecentlyOpened=w,this.getDirtyWorkspaces=w}},1);ie(Kde,class{constructor(){this.createTextEditor=w,this.resolveTextEditor=w}},0);ie(lb,class{constructor(){this.getAssociationsForResource=w,this.updateUserAssociations=w,this.onDidChangeEditorRegistrations=F.None,this.bufferChangeEvents=w,this.resolveEditor=w,this.getEditors=()=>[]}registerEditor(){return{dispose:()=>{}}}},0);ie(da,r0,1);ie(p$,i0,1);let R0=class extends Zde{constructor(e,t,i,n,s){super(e,t,i,n,s)}async readExtensionResource(e){return(await this._fileService.readFile(e)).value.toString()}};R0=T([v(0,at),v(1,ri),v(2,Rs),v(3,ls),v(4,We)],R0);ie(g$,R0,0);ie(Z3,class{constructor(){this.showHover=w,this.hideHover=w}},0);ie(mn,class{constructor(){this.roots=[],this.getContext=w,this.hasViewFocus=w,this.setEditable=w,this.getEditable=w,this.getEditableData=w,this.isEditable=w,this.findClosest=w,this.findClosestRoot=w,this.refresh=w,this.setToCopy=w,this.isCut=w,this.applyBulkEdit=w,this.select=w,this.registerView=w}get sortOrderConfiguration(){return w()}},1);ie(_$,HE,1);ie(n4,class{async getAvailableLanguages(){return[]}async getInstalledLanguages(){return[]}async getBuiltInExtensionTranslationsUri(){}},1);ie(pY,Nq,1);ie(mle,gle,1);ie(vle,class{constructor(){this.register=w,this.getWidget=()=>{}}},0);ie(r4,class{constructor(){this.isEnabled=()=>!1,this.getSimilarityScore=w,this.registerSemanticSimilarityProvider=w}},1);ie(yle,class{constructor(){this.onDidChange=F.None,this.canCreateOutline=()=>!1,this.createOutline=async()=>{},this.registerOutlineCreator=w}},0);ie(wle,class{constructor(){this.onStateChange=F.None,this.state=_le.Uninitialized,this.checkForUpdates=w,this.downloadUpdate=w,this.applyUpdate=w,this.quitAndInstall=w,this.isLatestVersion=w,this._applySpecificUpdate=w}},0);ie(o4,class{constructor(){this.onDidChangeEntryVisibility=F.None,this.addEntry=w,this.isEntryVisible=w,this.updateEntryVisibility=w,this.focus=w,this.focusNextEntry=w,this.focusPreviousEntry=w,this.isEntryFocused=w,this.overrideStyle=w}},0);ie(ide,class{constructor(){this.isEnabled=()=>!1,this.query=w,this.getExtensions=w,this.isExtensionCompatible=w,this.getCompatibleExtension=w,this.getAllCompatibleVersions=w,this.download=w,this.downloadSignatureArchive=w,this.reportStatistic=w,this.getReadme=w,this.getManifest=w,this.getChangelog=w,this.getCoreTranslation=w,this.getExtensionsControlManifest=w}},0);ie(BT,class{constructor(){this.detachedXterms=[],this.restoredGroupCount=0,this.createDetachedXterm=w,this.instances=[],this.revealActiveTerminal=w,this.isProcessSupportRegistered=!1,this.connectionState=1,this.defaultLocation=om.Panel,this.onDidChangeActiveGroup=F.None,this.onDidDisposeGroup=F.None,this.onDidCreateInstance=F.None,this.onDidReceiveProcessId=F.None,this.onDidChangeInstanceDimensions=F.None,this.onDidMaximumDimensionsChange=F.None,this.onDidRequestStartExtensionTerminal=F.None,this.onDidChangeInstanceTitle=F.None,this.onDidChangeInstanceIcon=F.None,this.onDidChangeInstanceColor=F.None,this.onDidChangeInstancePrimaryStatus=F.None,this.onDidInputInstanceData=F.None,this.onDidRegisterProcessSupport=F.None,this.onDidChangeConnectionState=F.None,this.createTerminal=w,this.getInstanceFromId=w,this.getInstanceFromIndex=w,this.getReconnectedTerminals=w,this.getActiveOrCreateInstance=w,this.moveToEditor=w,this.moveToTerminalView=w,this.getPrimaryBackend=w,this.refreshActiveGroup=w,this.registerProcessSupport=()=>{},this.showProfileQuickPick=w,this.setContainers=w,this.requestStartExtensionTerminal=w,this.isAttachedToTerminal=w,this.getEditableData=w,this.setEditable=w,this.isEditable=w,this.safeDisposeTerminal=w,this.getDefaultInstanceHost=w,this.getInstanceHost=w,this.resolveLocation=w,this.setNativeDelegate=w,this.toggleEscapeSequenceLogging=w,this.getEditingTerminal=w,this.setEditingTerminal=w,this.activeInstance=void 0,this.onDidDisposeInstance=F.None,this.onDidFocusInstance=F.None,this.onDidChangeActiveInstance=F.None,this.onDidChangeInstances=F.None,this.onDidChangeInstanceCapability=F.None,this.setActiveInstance=w,this.focusActiveInstance=w,this.getInstanceFromResource=w}get whenConnected(){return(async()=>{w()})()}get configHelper(){return w()}},1);ie(a4,class{constructor(){this.instances=[],this.openEditor=w,this.detachActiveEditorInstance=w,this.detachInstance=w,this.splitInstance=w,this.revealActiveEditor=w,this.resolveResource=w,this.reviveInput=w,this.getInputFromResource=w,this.activeInstance=void 0,this.onDidDisposeInstance=F.None,this.onDidFocusInstance=F.None,this.onDidChangeActiveInstance=F.None,this.onDidChangeInstances=F.None,this.onDidChangeInstanceCapability=F.None,this.setActiveInstance=w,this.focusActiveInstance=w,this.getInstanceFromResource=w}},1);ie(c4,class{constructor(){this.instances=[],this.groups=[],this.activeGroup=void 0,this.activeGroupIndex=0,this.onDidChangeActiveGroup=F.None,this.onDidDisposeGroup=F.None,this.onDidChangeGroups=F.None,this.onDidShow=F.None,this.onDidChangePanelOrientation=F.None,this.createGroup=w,this.getGroupForInstance=w,this.moveGroup=w,this.moveGroupToEnd=w,this.moveInstance=w,this.unsplitInstance=w,this.joinInstances=w,this.instanceIsSplit=w,this.getGroupLabels=w,this.setActiveGroupByIndex=w,this.setActiveGroupToNext=w,this.setActiveGroupToPrevious=w,this.setActiveInstanceByIndex=w,this.setContainer=w,this.showPanel=w,this.hidePanel=w,this.focusTabs=w,this.focusHover=w,this.showTabs=w,this.updateVisibility=w,this.onDidDisposeInstance=F.None,this.onDidFocusInstance=F.None,this.onDidChangeActiveInstance=F.None,this.onDidChangeInstances=F.None,this.onDidChangeInstanceCapability=F.None,this.setActiveInstance=w,this.focusActiveInstance=w,this.getInstanceFromResource=w}},1);ie(d4,class{constructor(){this.getRegisteredBackends=()=>[].values(),this.onDidCreateInstance=F.None,this.convertProfileToShellLaunchConfig=w,this.createInstance=w,this.getBackend=w,this.didRegisterBackend=w}},1);ie(l4,class{constructor(){this.availableProfiles=[],this.contributedProfiles=[],this.profilesReady=Promise.resolve(),this.getPlatformKey=w,this.refreshAvailableProfiles=w,this.getDefaultProfileName=()=>{},this.getDefaultProfile=()=>{},this.onDidChangeAvailableProfiles=F.None,this.getContributedDefaultProfile=w,this.registerContributedProfile=w,this.getContributedProfileProvider=w,this.registerTerminalProfileProvider=w}},1);ie(xle,class{constructor(){this.onDidChangeLogLevel=F.None,this.getLevel=w,this.setLevel=w,this.trace=w,this.debug=w,this.info=w,this.warn=w,this.error=w,this.flush=w,this.dispose=w}},1);ie(f4,class{constructor(){this.linkProviders=new Set([]),this.onDidAddLinkProvider=F.None,this.onDidRemoveLinkProvider=F.None,this.registerLinkProvider=w}},1);ie(Ple,class{constructor(){this.terminalProfiles=[]}},1);ie(w$,class{constructor(){this.resolveIcon=w,this.resolveShellLaunchConfig=w,this.getDefaultProfile=async()=>({profileName:"bash",path:"/bin/bash",isDefault:!0}),this.getDefaultShell=w,this.getDefaultShellArgs=w,this.getDefaultIcon=w,this.getEnvironment=w,this.createProfileFromShellAndShellArgs=w}},1);ie(p4,class{constructor(){this.collections=new Map,this.onDidChangeCollections=F.None,this.set=w,this.delete=w}get mergedCollection(){return w()}},1);ie(g4,class{constructor(){this.onDidRegisterProvider=F.None,this.onDidRegisterCommandSelector=F.None,this.onDidUnregisterProvider=F.None,this.extensionQuickFixes=Promise.resolve([]),this.providers=new Map,this.registerQuickFixProvider=w,this.registerCommandSelector=w}},1);ie(L3,class{constructor(){this.installGalleryExtensions=w,this.onInstallExtension=F.None,this.onDidInstallExtensions=F.None,this.onUninstallExtension=F.None,this.onDidUninstallExtension=F.None,this.onDidUpdateExtensionMetadata=F.None,this.zip=w,this.unzip=w,this.getManifest=w,this.install=w,this.canInstall=w,this.installFromGallery=w,this.installFromLocation=w,this.installExtensionsFromProfile=w,this.uninstall=w,this.reinstallFromGallery=w,this.getInstalled=async()=>[],this.getExtensionsControlManifest=w,this.copyExtensions=w,this.updateMetadata=w,this.download=w,this.registerParticipant=w,this.getTargetPlatform=w,this.cleanUp=w}},1);ie(Lle,class{constructor(){this.enabled=!1,this.authenticationProviders=[],this.all=[],this.current=void 0,this.accountStatus="uninitialized",this.onDidChangeAccountStatus=F.None,this.turnOn=w,this.turnoff=w,this.signIn=w,this.resetSyncedData=w,this.showSyncActivity=w,this.syncNow=w,this.synchroniseUserDataSyncStoreType=w,this.showConflicts=w,this.accept=w}},1);ie(Nle,class{constructor(){this.onDidChangeEnablement=F.None,this.isEnabled=()=>!1,this.canToggleEnablement=()=>!1,this.setEnablement=w,this.onDidChangeResourceEnablement=F.None,this.isResourceEnabled=()=>!1,this.setResourceEnablement=w,this.getResourceSyncStateVersion=()=>{}}},1);ie($le,class{constructor(){this.addKeybinding=w,this.editKeybinding=w,this.removeKeybinding=w,this.resetKeybinding=w}},1);ie(Mle,class{constructor(){this.getLocalSearchProvider=w,this.getRemoteSearchProvider=w}},1);ie(qf,class{constructor(){this.canResolve=async()=>!1,this.onAddViewType=F.None,this.onWillRemoveViewType=F.None,this.onDidChangeOutputRenderers=F.None,this.onWillAddNotebookDocument=F.None,this.onDidAddNotebookDocument=F.None,this.onWillRemoveNotebookDocument=F.None,this.onDidRemoveNotebookDocument=F.None,this.registerNotebookSerializer=w,this.withNotebookDataProvider=w,this.getOutputMimeTypeInfo=w,this.getViewTypeProvider=()=>{},this.getRendererInfo=()=>{},this.getRenderers=()=>[],this.getStaticPreloads=w,this.updateMimePreferredRenderer=w,this.saveMimeDisplayOrder=w,this.createNotebookTextModel=w,this.getNotebookTextModel=()=>{},this.getNotebookTextModels=w,this.listNotebookDocuments=()=>[],this.registerContributedNotebookType=w,this.getContributedNotebookType=w,this.getContributedNotebookTypes=()=>[],this.getNotebookProviderResourceRoots=()=>[],this.setToCopy=w,this.getToCopy=w,this.clearEditorCache=w}},1);ie(Gf,class{constructor(){this.replace=w,this.openReplacePreview=w,this.updateReplacePreview=w}},1);ie(Wle,class{constructor(){this.onDidClearHistory=F.None,this.clearHistory=w,this.load=w,this.save=w}},1);ie(zf,class{constructor(){this.retrieveWidget=w,this.retrieveExistingWidgetFromURI=()=>{},this.retrieveAllExistingWidgets=()=>[],this.onDidAddNotebookEditor=F.None,this.onDidRemoveNotebookEditor=F.None,this.addNotebookEditor=w,this.removeNotebookEditor=w,this.getNotebookEditor=()=>{},this.listNotebookEditors=()=>[]}},1);ie(Kle,class{get searchModel(){return w()}},1);ie(C$,class{constructor(){this.onDidSaveNotebook=F.None,this.onDidChangeDirty=F.None,this.onWillFailWithConflict=F.None,this.isDirty=w,this.resolve=w}},1);ie(Qle,h0,1);ie(E4,f0,1);ie(x4,Jle,1);ie(E$,VE,1);ie(Zle,class{constructor(){this.getCurrentExperiments=async()=>[],this.getTreatment=async()=>{}}},1);ie(D4,class{constructor(){this.transferredSessionId=void 0,this.transferChatSession=w,this.registerProvider=w,this.registerSlashCommandProvider=w,this.getProviderInfos=()=>[],this.startSession=w,this.getSession=()=>{},this.getOrRestoreSession=()=>{},this.loadSessionFromContent=()=>{},this.sendRequest=w,this.removeRequest=w,this.cancelCurrentRequestForSession=w,this.getSlashCommands=w,this.clearSession=w,this.addRequest=w,this.addCompleteRequest=w,this.sendRequestToProvider=w,this.getHistory=()=>[],this.removeHistoryEntry=w,this.onDidPerformUserAction=F.None,this.notifyUserAction=w}},1);ie(tue,class{constructor(){this.onDidCreateTerminal=F.None,this.createTerminal=w}},1);ie(x$,class{constructor(){this.getCustomEditor=w,this.getAllCustomEditors=w,this.getContributedCustomEditors=w,this.getUserConfiguredCustomEditors=w,this.registerCustomEditorCapabilities=w,this.getCustomEditorCapabilities=w}get models(){return w()}},1);ie(UT,class{constructor(){this.webviews=[],this.onDidChangeActiveWebview=F.None,this.createWebviewElement=w,this.createWebviewOverlay=w}},1);ie(R4,class{constructor(){this.onNewResolverRegistered=F.None,this.register=w,this.resolve=w}},1);ie(ub,class{constructor(){this.onDidChangeActiveWebviewEditor=F.None,this.openWebview=w,this.openRevivedWebview=w,this.revealWebview=w,this.registerResolver=()=>ne.None,this.shouldPersist=w,this.resolveWebview=w}get iconManager(){return w()}},1);ie(T4,class{constructor(){this.createEditorDropTarget=w}},1);ie(wu,class{constructor(){this.onDidChangeConnectionData=F.None,this.resolveAuthority=w,this.getConnectionData=w,this.getCanonicalURI=w,this._clearResolvedAuthority=w,this._setResolvedAuthority=w,this._setResolvedAuthorityError=w,this._setAuthorityConnectionToken=w,this._setCanonicalURIProvider=w}},1);ie(P4,_0,1);ie(_ue,class{constructor(){this.show=w,this.registerProvider=w}},1);ie(J1,class{constructor(){this.onInstallExtension=F.None,this.onDidInstallExtensions=F.None,this.onUninstallExtension=F.None,this.onDidUninstallExtension=F.None,this.onDidChangeProfile=F.None,this.installVSIX=w,this.installFromLocation=w,this.updateFromGallery=w,this.onDidUpdateExtensionMetadata=F.None,this.zip=w,this.unzip=w,this.getManifest=w,this.install=w,this.canInstall=w,this.installFromGallery=w,this.installGalleryExtensions=w,this.installExtensionsFromProfile=w,this.uninstall=w,this.reinstallFromGallery=w,this.getInstalled=w,this.getExtensionsControlManifest=w,this.copyExtensions=w,this.updateMetadata=w,this.download=w,this.registerParticipant=w,this.getTargetPlatform=w,this.cleanUp=w}},1);ie(hb,class{constructor(){this.prefersExecuteOnUI=w,this.prefersExecuteOnWorkspace=w,this.prefersExecuteOnWeb=w,this.canExecuteOnUI=w,this.canExecuteOnWorkspace=w,this.canExecuteOnWeb=w,this.getExtensionKind=w,this.getUserConfiguredExtensionKind=w,this.getExtensionUntrustedWorkspaceSupportType=w,this.getExtensionVirtualWorkspaceSupportType=w}},1);ie(Lq,class{isWorkspaceTrustEnabled(){return!1}},1);ie(D$,class{whenExtensionsReady(){throw new Error("Method not implemented.")}async scanExtensions(){return[]}async scanSingleExtension(){return null}},1);ie(k$,D0,1);ie(T$,class{constructor(){this.onDidChangePassword=F.None,this.getSecretStoragePrefix=async()=>"code-oss",this.getPassword=w,this.setPassword=w,this.deletePassword=w,this.findPassword=w,this.findCredentials=w}},1);ie(I$,class{constructor(){this.register=w,this.connect=w}},1);ie(VT,class{constructor(){this.onDidChangeQuickDiffProviders=F.None,this.addQuickDiffProvider=w,this.getQuickDiffs=w}},1);ie(F4,class{constructor(){this.onDidAddRepository=F.None,this.onDidRemoveRepository=F.None,this.repositories=[],this.repositoryCount=0,this.registerSCMProvider=w,this.getRepository=w}},1);ie(N4,class{constructor(){this.download=w}},1);ie($4,class{constructor(){this.registerExtensionHandler=w,this.unregisterExtensionHandler=w}},1);ie(Nd,class{constructor(){this.onDidSetResourceCommentInfos=F.None,this.onDidSetAllCommentThreads=F.None,this.onDidUpdateCommentThreads=F.None,this.onDidUpdateNotebookCommentThreads=F.None,this.onDidChangeActiveCommentThread=F.None,this.onDidChangeCurrentCommentThread=F.None,this.onDidUpdateCommentingRanges=F.None,this.onDidChangeActiveCommentingRange=F.None,this.onDidSetDataProvider=F.None,this.onDidDeleteDataProvider=F.None,this.onDidChangeCommentingEnabled=F.None,this.isCommentingEnabled=!1,this.setDocumentComments=w,this.setWorkspaceComments=w,this.removeWorkspaceComments=w,this.registerCommentController=w,this.unregisterCommentController=()=>{},this.getCommentController=w,this.createCommentThreadTemplate=w,this.updateCommentThreadTemplate=w,this.getCommentMenus=w,this.updateComments=w,this.updateNotebookComments=w,this.disposeCommentThread=w,this.getDocumentComments=w,this.getNotebookComments=w,this.updateCommentingRanges=w,this.hasReactionHandler=w,this.toggleReaction=w,this.setActiveCommentThread=w,this.setCurrentCommentThread=w,this.enableCommenting=w}},1);ie(W4,class{constructor(){this.onDidChangeProviders=F.None,this.onDidChangeItems=F.None,this.registerCellStatusBarItemProvider=w,this.getStatusBarItemsForCell=w}},1);ie(H4,class{constructor(){this.onDidAddKernel=F.None,this.onDidRemoveKernel=F.None,this.onDidChangeSelectedNotebooks=F.None,this.onDidChangeNotebookAffinity=F.None,this.registerKernel=w,this.getMatchingKernel=w,this.getSelectedOrSuggestedKernel=w,this.selectKernelForNotebook=w,this.preselectKernelForNotebook=w,this.updateKernelNotebookAffinity=w,this.onDidChangeKernelDetectionTasks=F.None,this.registerNotebookKernelDetectionTask=w,this.getKernelDetectionTasks=w,this.onDidChangeSourceActions=F.None,this.getSourceActions=w,this.getRunningSourceActions=w,this.registerKernelSourceActionProvider=w,this.getKernelSourceActions2=w}},1);ie(j4,class{constructor(){this.onShouldPostMessage=F.None,this.prepare=w,this.getScoped=w,this.receiveMessage=w}},1);ie(R$,class{constructor(){this.onWillAddInteractiveDocument=F.None,this.onWillRemoveInteractiveDocument=F.None,this.willCreateInteractiveDocument=w,this.willRemoveInteractiveDocument=w}},1);ie(B4,class{constructor(){this.addProvider=w,this.getAllProvider=()=>[]}},1);ie(U4,class{constructor(){this.lastFocusedWidget=void 0,this.revealViewForProvider=w,this.getWidgetByInputUri=w}},1);ie(V4,class{constructor(){this.onDidChangeTargetType=F.None,this.targetType=[],this.onDidChangeEditable=F.None,this.setEditable=w,this.getEditableData=w,this.forward=w,this.close=w,this.setTunnelInformation=w,this.setCandidateFilter=w,this.onFoundNewCandidates=w,this.restore=w,this.enablePortsFeatures=w,this.onEnabledPortsFeatures=F.None,this.portsFeaturesEnabled=!1,this.namedProcesses=new Map}get tunnelModel(){return w()}},1);ie(q4,class{constructor(){this.isAuthenticationProviderRegistered=()=>!1,this.getProviderIds=()=>[],this.registerAuthenticationProvider=w,this.unregisterAuthenticationProvider=w,this.isAccessAllowed=()=>!1,this.updateAllowedExtension=w,this.updateSessionPreference=w,this.getSessionPreference=()=>{},this.removeSessionPreference=w,this.showGetSessionPrompt=w,this.selectSession=w,this.requestSessionAccess=w,this.completeSessionAccessRequest=w,this.requestNewSession=w,this.sessionsUpdate=w,this.onDidRegisterAuthenticationProvider=F.None,this.onDidUnregisterAuthenticationProvider=F.None,this.onDidChangeSessions=F.None,this.declaredProviders=[],this.onDidChangeDeclaredProviders=F.None,this.getSessions=async()=>[],this.getLabel=w,this.supportsMultipleAccounts=()=>!1,this.createSession=w,this.removeSession=w,this.manageTrustedExtensionsForAccount=w,this.removeAccountSessions=w}},1);ie(G4,class{constructor(){this.onDidChangeProviders=F.None,this.onDidChangeTimeline=F.None,this.onDidChangeUri=F.None,this.registerTimelineProvider=w,this.unregisterTimelineProvider=w,this.getSources=()=>[],this.getTimeline=w,this.setUri=w}},1);ie(z4,class{constructor(){this.onDidCancelTestRun=F.None,this.onWillProcessDiff=F.None,this.onDidProcessDiff=F.None,this.registerTestController=w,this.getTestController=()=>{},this.refreshTests=w,this.cancelRefreshTests=w,this.startContinuousRun=w,this.runTests=w,this.runResolvedTests=w,this.syncTests=w,this.cancelTestRun=w,this.publishDiff=w}get excluded(){return w()}get collection(){return w()}get showInlineOutput(){return w()}},1);ie(K4,class{constructor(){this.onDidChangeSecret=F.None,this.type="in-memory",this.get=async()=>{},this.set=w,this.delete=w}},1);ie(Q4,class{constructor(){this.registerShareProvider=w,this.getShareActions=()=>[],this.provideShare=async()=>{}}},1);ie(_3,class{constructor(){this.registerProfileContentHandler=w,this.unregisterProfileContentHandler=w,this.exportProfile=w,this.importProfile=w,this.showProfileContents=w,this.createFromCurrentProfile=w,this.createTroubleshootProfile=w,this.setProfile=w}},1);ie(Y4,class{constructor(){this.openReporter=w,this.openProcessExplorer=w,this.registerIssueUriRequestHandler=w}},1);ie(O4,class{constructor(){this.repositories=[],this.onDidChangeRepositories=F.None,this.visibleRepositories=[],this.onDidChangeVisibleRepositories=F.None,this.isVisible=()=>!1,this.toggleVisibility=w,this.toggleSortKey=w,this.focusedRepository=void 0,this.onDidFocusRepository=F.None,this.focus=w}get menus(){return w()}},1);ie(X4,class{constructor(){this.onDidChangeExecution=F.None,this.onDidChangeLastRunFailState=F.None,this.forceCancelNotebookExecutions=w,this.getCellExecutionsForNotebook=w,this.getCellExecutionsByHandleForNotebook=w,this.getCellExecution=w,this.createCellExecution=w,this.getExecution=w,this.createExecution=w,this.getLastFailedCellForNotebook=w}},1);ie(J4,class{constructor(){this.registeredProviders=[],this.getViewIdForProvider=w}},1);ie(Z4,class{constructor(){this.onDidChange=F.None,this.addProfile=w,this.updateProfile=w,this.removeProfile=w,this.capabilitiesForTest=w,this.configure=w,this.all=()=>[],this.getGroupDefaultProfiles=()=>[],this.setGroupDefaultProfiles=w,this.getControllerProfiles=()=>[]}},1);ie(e5,class{constructor(){this.setUsePlainTextEncryption=w,this.getKeyStorageProvider=w,this.encrypt=w,this.decrypt=w,this.isEncryptionAvailable=w}},1);ie(t5,class{constructor(){this.onResultsChanged=F.None,this.onTestChanged=F.None,this.results=[],this.clear=w,this.createLiveResult=w,this.push=w,this.getResult=()=>{},this.getStateById=()=>{}}},1);ie(OT,class{constructor(){this.requiresInitialization=async()=>!1,this.whenInitializationFinished=async()=>{},this.initializeRequiredResources=async()=>{},this.initializeInstalledExtensions=async()=>{},this.initializeOtherResources=async()=>{}}},1);ie(Mue,Lue,1);let Y_=class{constructor(e,t){this.container=e,this.paneCompositeService=t,this.onDidChangeFullscreen=F.None,this.parts=new Map,this.hiddenParts=new Set,this._onDidChangePartVisibility=new A,this.onDidChangePartVisibility=this._onDidChangePartVisibility.event,this.offset={top:0,quickPickTop:0},this._onDidLayout=new A,this.onDidLayout=this._onDidLayout.event,window.addEventListener("resize",()=>this.layout()),this.layout()}getMaximumEditorDimensions(){return new Fl(1/0,1/0)}isPanelMaximized(){return!1}getPanelPosition(){return 2}hasFocus(e){const t=document.activeElement;if(t==null)return!1;const i=this.getContainer(e);return i!=null&&mY(t,i)}getContainer(e){if(this.parts.get(e)!=null)return this.getPart(e).getContainer()}getPart(e){const t=this.parts.get(e);if(t==null)throw new Error(`Unknown part ${e}`);return t}setPartHidden(e,t){e?this.hiddenParts.add(t):this.hiddenParts.delete(t),this._onDidChangePartVisibility.fire();const i={"workbench.parts.sidebar":0,"workbench.parts.auxiliarybar":2,"workbench.parts.panel":1}[t];i!=null&&(this.paneCompositeService.getActivePaneComposite(i)!=null&&e&&this.paneCompositeService.hideActivePaneComposite(i),this.paneCompositeService.getPartByLocation!=null&&this.paneCompositeService.getPartByLocation(i).setVisible(!e)),setTimeout(()=>{this.setPartHidden(!1,t)})}isVisible(e){return!this.hiddenParts.has(e)}getSideBarPosition(){return 0}registerPart(e){this.parts.set(e.getId(),e)}isRestored(){return!0}get dimension(){return this._dimension}layout(){this._dimension=TP(window.document.body),this._onDidLayout.fire(this._dimension)}get hasContainer(){return!0}focus(){var e;(e=ka.get(En).getFocusedCodeEditor())==null||e.focus()}};Y_=T([v(1,Jm)],Y_);function i5(r=document.body){const e=wa?"windows":ck?"linux":"mac",t=fi(["monaco-workbench",e,"web",vY?"chromium":yY?"firefox":_Y?"safari":void 0]);return r.classList.add(...t),document.body.classList.add(e),document.body.classList.add("web"),{[uk.toString()]:new er(Y_,[r]),[Kf.toString()]:new er(Y_,[r])}}const Uue=Object.freeze(Object.defineProperty({__proto__:null,get LayoutService(){return Y_},default:i5},Symbol.toStringTag,{value:"Module"}));let JE=class extends Be{constructor(e){super("default",k.from({scheme:"logs",path:"/"}),{},e)}};JE=T([v(0,Rs)],JE);function n5(){return{[ls.toString()]:new er(JE,[]),[Cu.toString()]:new er(JE,[])}}const Vue=Object.freeze(Object.defineProperty({__proto__:null,default:n5},Symbol.toStringTag,{value:"Module"}));function que(r,e){if(r.length===0)return Promise.resolve(!1);const t=[];let i=!1;for(const n of r){if(n===!0)return Promise.resolve(!0);Cg(n)&&t.push(n.then(s=>{s&&(i=!0)},s=>{e(s),i=!0}))}return Sn.settled(t).then(()=>i)}class Gue{constructor(e){this.removedDueToLooping=e}}class Gl{static isHostExtension(e,t,i){if(t.getExtensionDescription(e))return!1;const n=i.getExtensionDescription(e);return n?!!((n.main||n.browser)&&n.api==="none"):!1}constructor(e,t){this._activationEventsReader=e,this._onDidChange=new A,this.onDidChange=this._onDidChange.event,this._extensionDescriptions=t,this._initialize()}_initialize(){this._extensionDescriptions.sort(Xue),this._extensionsMap=new Ln,this._extensionsArr=[],this._activationMap=new Map;for(const e of this._extensionDescriptions){if(this._extensionsMap.has(e.identifier)){console.error("Extension `"+e.identifier.value+"` is already registered");continue}this._extensionsMap.set(e.identifier,e),this._extensionsArr.push(e);const t=this._activationEventsReader.readActivationEvents(e);if(Array.isArray(t))for(let i of t)i==="onUri"&&(i=`onUri:${fn.toKey(e.identifier)}`),this._activationMap.has(i)||this._activationMap.set(i,[]),this._activationMap.get(i).push(e)}}set(e){this._extensionDescriptions=e,this._initialize(),this._onDidChange.fire(void 0)}deltaExtensions(e,t){this._extensionDescriptions=OB(this._extensionDescriptions,t),this._extensionDescriptions=this._extensionDescriptions.concat(e);const i=Gl._findLoopingExtensions(this._extensionDescriptions);return this._extensionDescriptions=OB(this._extensionDescriptions,i.map(n=>n.identifier)),this._initialize(),this._onDidChange.fire(void 0),new Gue(i)}static _findLoopingExtensions(e){const t=new class{constructor(){this._arcs=new Map,this._nodesSet=new Set,this._nodesArr=[]}addNode(a){this._nodesSet.has(a)||(this._nodesSet.add(a),this._nodesArr.push(a))}addArc(a,c){this.addNode(a),this.addNode(c),this._arcs.has(a)?this._arcs.get(a).push(c):this._arcs.set(a,[c])}getArcs(a){return this._arcs.has(a)?this._arcs.get(a):[]}hasOnlyGoodArcs(a,c){const d=t.getArcs(a);for(let l=0;l<d.length;l++)if(!c.has(d[l]))return!1;return!0}getNodes(){return this._nodesArr}},i=new Ln;for(const a of e)if(i.set(a.identifier,a),a.extensionDependencies)for(const c of a.extensionDependencies)t.addArc(fn.toKey(a.identifier),fn.toKey(c));const n=new Set;t.getNodes().filter(a=>t.getArcs(a).length===0).forEach(a=>n.add(a));const s=t.getNodes().filter(a=>!n.has(a));let o;do{o=!1;for(let a=0;a<s.length;a++){const c=s[a];t.hasOnlyGoodArcs(c,n)&&(s.splice(a,1),a--,n.add(c),o=!0)}}while(o);return s.map(a=>i.get(a))}containsActivationEvent(e){return this._activationMap.has(e)}containsExtension(e){return this._extensionsMap.has(e)}getExtensionDescriptionsForActivationEvent(e){const t=this._activationMap.get(e);return t?t.slice(0):[]}getAllExtensionDescriptions(){return this._extensionsArr.slice(0)}getExtensionDescription(e){const t=this._extensionsMap.get(e);return t||void 0}getExtensionDescriptionByUUID(e){for(const t of this._extensionsArr)if(t.uuid===e)return t}getExtensionDescriptionByIdOrUUID(e,t){return this.getExtensionDescription(e)??(t?this.getExtensionDescriptionByUUID(t):void 0)}}class zue{constructor(e){this._lock=new Yue,this._actual=new Gl(e,[])}async acquireLock(e){const t=await this._lock.acquire(e);return new Kue(this,t)}deltaExtensions(e,t,i){if(!e.isAcquiredFor(this))throw new Error("Lock is not held");return this._actual.deltaExtensions(t,i)}containsActivationEvent(e){return this._actual.containsActivationEvent(e)}containsExtension(e){return this._actual.containsExtension(e)}getExtensionDescriptionsForActivationEvent(e){return this._actual.getExtensionDescriptionsForActivationEvent(e)}getAllExtensionDescriptions(){return this._actual.getAllExtensionDescriptions()}getExtensionDescription(e){return this._actual.getExtensionDescription(e)}getExtensionDescriptionByUUID(e){return this._actual.getExtensionDescriptionByUUID(e)}getExtensionDescriptionByIdOrUUID(e,t){return this._actual.getExtensionDescriptionByIdOrUUID(e,t)}}class Kue extends ne{constructor(e,t){super(),this._registry=e,this._isDisposed=!1,this._register(t)}isAcquiredFor(e){return!this._isDisposed&&this._registry===e}}class Que{constructor(e){this.name=e,this.promise=new Promise((t,i)=>{this._resolve=t})}resolve(e){this._resolve(e)}}class Yue{constructor(){this._pendingCustomers=[],this._isLocked=!1}async acquire(e){const t=new Que(e);return this._pendingCustomers.push(t),this._advance(),t.promise}_advance(){if(this._isLocked||this._pendingCustomers.length===0)return;const e=this._pendingCustomers.shift();this._isLocked=!0;let t=!0;const i=setTimeout(()=>{t&&console.warn(`The customer named ${e.name} has been holding on to the lock for 30s. This might be a problem.`)},30*1e3),n=()=>{t&&(clearTimeout(i),t=!1,this._isLocked=!1,this._advance())};e.resolve(ot(n))}}function Xue(r,e){const t=r.isBuiltin?0:r.isUnderDevelopment?2:1,i=e.isBuiltin?0:e.isUnderDevelopment?2:1;if(t!==i)return t-i;const n=Ho.basename(r.extensionLocation.path),s=Ho.basename(e.extensionLocation.path);return n<s?-1:n>s?1:0}function OB(r,e){const t=new lc(e);return r.filter(i=>!t.has(i.identifier))}function P$(r){const e=r.isExtensionDevelopment;let t=!0;const i=r.extensionDevelopmentLocationURI;if(i)for(const a of i)a.scheme!==pe.file&&(t=!1);const n=t&&typeof r.debugExtensionHost.port=="number",s=t&&!!r.debugExtensionHost.break,o=e&&!!r.extensionTestsLocationURI&&!r.debugExtensionHost.debugId;return{isExtensionDevHost:e,isExtensionDevDebug:n,isExtensionDevDebugBrk:s,isExtensionDevTestFromCli:o}}var P0;(function(r){r[r.LocalProcess=1]="LocalProcess",r[r.LocalWebWorker=2]="LocalWebWorker",r[r.Remote=3]="Remote"})(P0||(P0={}));function pa(r){if(r===null)return"None";switch(r){case 1:return"LocalProcess";case 2:return"LocalWebWorker";case 3:return"Remote"}}function Jue(r){switch(r){case 0:return"None";case 1:return"Local";case 2:return"Remote"}}function Zue(r,e,t,i){const n=NB(r,t),s=NB(e,t),o=new Map,a=d=>{if(o.has(d.key))return;const l=n.get(d.key)||null,u=s.get(d.key)||null,h=new the(l,u);o.set(h.key,h)};n.forEach(d=>a(d)),s.forEach(d=>a(d));const c=new Map;return o.forEach(d=>{const l=!!d.local,u=!!d.remote,h=!!(d.local&&d.local.isUnderDevelopment),g=!!(d.remote&&d.remote.isUnderDevelopment);let m=0;h&&!g?m=1:g&&!h&&(m=2),c.set(d.key,i(d.identifier,d.kind,l,u,m))}),c}function NB(r,e){const t=new Map;return r.forEach(i=>{const n=new ehe(i,e(i));t.set(n.key,n)}),t}class ehe{constructor(e,t){this.desc=e,this.kind=t}get key(){return fn.toKey(this.desc.identifier)}get isUnderDevelopment(){return this.desc.isUnderDevelopment}}class the{constructor(e,t){this.local=e,this.remote=t}get key(){return this.local?this.local.key:this.remote.key}get identifier(){return this.local?this.local.desc.identifier:this.remote.desc.identifier}get kind(){return this.local?this.local.kind:this.remote.kind}}function gt(r){return function(e){lm.INSTANCE.registerNamedCustomer(r,e)}}function Eu(r){lm.INSTANCE.registerCustomer(r)}var ZE;(function(r){function e(){return lm.INSTANCE.getNamedCustomers()}r.getNamedCustomers=e;function t(){return lm.INSTANCE.getCustomers()}r.getCustomers=t})(ZE||(ZE={}));class lm{constructor(){this._namedCustomers=[],this._customers=[]}registerNamedCustomer(e,t){const i=[e,t];this._namedCustomers.push(i)}getNamedCustomers(){return this._namedCustomers}registerCustomer(e){this._customers.push(e)}getCustomers(){return this._customers}}lm.INSTANCE=new lm;function r5(r,e,t,i){if(!r||i>200)return null;if(typeof r=="object"){if(r.$mid===1)return t?k.revive(e.transformIncoming(r)):e.transformIncoming(r);if(r instanceof De)return null;for(const n in r)if(Object.hasOwnProperty.call(r,n)){const s=r5(r[n],e,t,i+1);s!==null&&(r[n]=s)}}return null}function Tv(r,e){const t=r5(r,e,!1,0);return t===null?r:t}class s5{constructor(){this._actual=null,this._actualOk=null,this._actualErr=null,this._hasValue=!1,this._value=null,this._hasErr=!1,this._err=null}get[Symbol.toStringTag](){return this.toString()}_ensureActual(){return this._actual||(this._actual=new Promise((e,t)=>{this._actualOk=e,this._actualErr=t,this._hasValue&&this._actualOk(this._value),this._hasErr&&this._actualErr(this._err)})),this._actual}resolveOk(e){this._hasValue||this._hasErr||(this._hasValue=!0,this._value=e,this._actual&&this._actualOk(e))}resolveErr(e){this._hasValue||this._hasErr||(this._hasErr=!0,this._err=e,this._actual?this._actualErr(e):en(e))}then(e,t){return this._ensureActual().then(e,t)}catch(e){return this._ensureActual().then(void 0,e)}finally(e){return this._ensureActual().finally(e)}}class ihe extends s5{constructor(){super(),this._hasErr=!0,this._err=new yh}}class fb{constructor(e){this._proxyIdentifierBrand=void 0,this.sid=e,this.nid=++fb.count}}fb.count=0;const o5=[];function he(r){const e=new fb(r);return o5[e.nid]=e,e}function Qb(r){return o5[r].sid}class rs{constructor(e){this.value=e}}var a5;function A0(r,e){try{return JSON.stringify(r,e)}catch{return"null"}}const A$="$$ref$$",nhe={[A$]:-1};function $B(r,e=null,t=!1){const i=[];return{jsonString:(t?A0:JSON.stringify)(r,(s,o)=>{if(typeof o>"u")return nhe;if(typeof o=="object"){if(o instanceof De){const a=i.push(o)-1;return{[A$]:a}}if(e)return e(s,o)}return o}),referencedBuffers:i}}function c5(r,e,t){return JSON.parse(r,(i,n)=>{if(n){const s=n[A$];if(typeof s=="number")return e[s];if(t&&n.$mid===1)return t.transformIncoming(n)}return n})}function WB(r,e){return JSON.stringify(r,e)}function rhe(r){return r?(e,t)=>t&&t.$mid===1?r.transformOutgoing(t):t:null}const she=()=>{},ohe=Symbol.for("rpcProtocol"),ahe=Symbol.for("rpcProxy");class um extends ne{constructor(e,t=null,i=null){super(),this[a5]=!0,this._onDidChangeResponsiveState=this._register(new A),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._protocol=e,this._logger=t,this._uriTransformer=i,this._uriReplacer=rhe(this._uriTransformer),this._isDisposed=!1,this._locals=[],this._proxies=[];for(let n=0,s=fb.count;n<s;n++)this._locals[n]=null,this._proxies[n]=null;this._lastMessageId=0,this._cancelInvokedHandlers=Object.create(null),this._pendingRPCReplies={},this._responsiveState=0,this._unacknowledgedCount=0,this._unresponsiveTime=0,this._asyncCheckUresponsive=this._register(new Ys(()=>this._checkUnresponsive(),1e3)),this._protocol.onMessage(n=>this._receiveOneMessage(n))}dispose(){this._isDisposed=!0,Object.keys(this._pendingRPCReplies).forEach(e=>{this._pendingRPCReplies[e].resolveErr(Ll())})}drain(){return typeof this._protocol.drain=="function"?this._protocol.drain():Promise.resolve()}_onWillSendRequest(e){this._unacknowledgedCount===0&&(this._unresponsiveTime=Date.now()+um.UNRESPONSIVE_TIME),this._unacknowledgedCount++,this._asyncCheckUresponsive.isScheduled()||this._asyncCheckUresponsive.schedule()}_onDidReceiveAcknowledge(e){this._unresponsiveTime=Date.now()+um.UNRESPONSIVE_TIME,this._unacknowledgedCount--,this._unacknowledgedCount===0&&this._asyncCheckUresponsive.cancel(),this._setResponsiveState(0)}_checkUnresponsive(){this._unacknowledgedCount!==0&&(Date.now()>this._unresponsiveTime?this._setResponsiveState(1):this._asyncCheckUresponsive.schedule())}_setResponsiveState(e){this._responsiveState!==e&&(this._responsiveState=e,this._onDidChangeResponsiveState.fire(this._responsiveState))}get responsiveState(){return this._responsiveState}transformIncomingURIs(e){return this._uriTransformer?Tv(e,this._uriTransformer):e}getProxy(e){const{nid:t,sid:i}=e;return this._proxies[t]||(this._proxies[t]=this._createProxy(t,i)),this._proxies[t]}_createProxy(e,t){const i={get:(n,s)=>(typeof s=="string"&&!n[s]&&s.charCodeAt(0)===36&&(n[s]=(...o)=>this._remoteCall(e,s,o)),s===ahe?t:n[s])};return new Proxy(Object.create(null),i)}set(e,t){return this._locals[e.nid]=t,t}assertRegistered(e){for(let t=0,i=e.length;t<i;t++){const n=e[t];if(!this._locals[n.nid])throw new Error(`Missing proxy instance ${n.sid}`)}}_receiveOneMessage(e){var o;if(this._isDisposed)return;const t=e.byteLength,i=an.read(e,0),n=i.readUInt8(),s=i.readUInt32();switch(n){case 1:case 2:{let{rpcId:a,method:c,args:d}=ao.deserializeRequestJSONArgs(i);this._uriTransformer&&(d=Tv(d,this._uriTransformer)),this._receiveRequest(t,s,a,c,d,n===2);break}case 3:case 4:{let{rpcId:a,method:c,args:d}=ao.deserializeRequestMixedArgs(i);this._uriTransformer&&(d=Tv(d,this._uriTransformer)),this._receiveRequest(t,s,a,c,d,n===4);break}case 5:{(o=this._logger)==null||o.logIncoming(t,s,0,"ack"),this._onDidReceiveAcknowledge(s);break}case 6:{this._receiveCancel(t,s);break}case 7:{this._receiveReply(t,s,void 0);break}case 9:{let a=ao.deserializeReplyOKJSON(i);this._uriTransformer&&(a=Tv(a,this._uriTransformer)),this._receiveReply(t,s,a);break}case 10:{const a=ao.deserializeReplyOKJSONWithBuffers(i,this._uriTransformer);this._receiveReply(t,s,a);break}case 8:{const a=ao.deserializeReplyOKVSBuffer(i);this._receiveReply(t,s,a);break}case 11:{let a=ao.deserializeReplyErrError(i);this._uriTransformer&&(a=Tv(a,this._uriTransformer)),this._receiveReplyErr(t,s,a);break}case 12:{this._receiveReplyErr(t,s,void 0);break}default:console.error("received unexpected message"),console.error(e)}}_receiveRequest(e,t,i,n,s,o){var u,h;(u=this._logger)==null||u.logIncoming(e,t,1,`receiveRequest ${Qb(i)}.${n}(`,s);const a=String(t);let c,d;if(o){const g=new Xt;s.push(g.token),c=this._invokeHandler(i,n,s),d=()=>g.cancel()}else c=this._invokeHandler(i,n,s),d=she;this._cancelInvokedHandlers[a]=d;const l=ao.serializeAcknowledged(t);(h=this._logger)==null||h.logOutgoing(l.byteLength,t,1,"ack"),this._protocol.send(l),c.then(g=>{var y;delete this._cancelInvokedHandlers[a];const m=ao.serializeReplyOK(t,g,this._uriReplacer);(y=this._logger)==null||y.logOutgoing(m.byteLength,t,1,"reply:",g),this._protocol.send(m)},g=>{var y;delete this._cancelInvokedHandlers[a];const m=ao.serializeReplyErr(t,g);(y=this._logger)==null||y.logOutgoing(m.byteLength,t,1,"replyErr:",g),this._protocol.send(m)})}_receiveCancel(e,t){var n,s,o;(n=this._logger)==null||n.logIncoming(e,t,1,"receiveCancel");const i=String(t);(o=(s=this._cancelInvokedHandlers)[i])==null||o.call(s)}_receiveReply(e,t,i){var o;(o=this._logger)==null||o.logIncoming(e,t,0,"receiveReply:",i);const n=String(t);if(!this._pendingRPCReplies.hasOwnProperty(n))return;const s=this._pendingRPCReplies[n];delete this._pendingRPCReplies[n],s.resolveOk(i)}_receiveReplyErr(e,t,i){var a;(a=this._logger)==null||a.logIncoming(e,t,0,"receiveReplyErr:",i);const n=String(t);if(!this._pendingRPCReplies.hasOwnProperty(n))return;const s=this._pendingRPCReplies[n];delete this._pendingRPCReplies[n];let o;i&&(i.$isError?(o=new Error,o.name=i.name,o.message=i.message,o.stack=i.stack):o=i),s.resolveErr(o)}_invokeHandler(e,t,i){try{return Promise.resolve(this._doInvokeHandler(e,t,i))}catch(n){return Promise.reject(n)}}_doInvokeHandler(e,t,i){const n=this._locals[e];if(!n)throw new Error("Unknown actor "+Qb(e));const s=n[t];if(typeof s!="function")throw new Error("Unknown method "+t+" on actor "+Qb(e));return s.apply(n,i)}_remoteCall(e,t,i){var l;if(this._isDisposed)return new ihe;let n=null;if(i.length>0&&_t.isCancellationToken(i[i.length-1])&&(n=i.pop()),n&&n.isCancellationRequested)return Promise.reject(Ll());const s=ao.serializeRequestArguments(i,this._uriReplacer),o=++this._lastMessageId,a=String(o),c=new s5;n&&n.onCancellationRequested(()=>{var h;const u=ao.serializeCancel(o);(h=this._logger)==null||h.logOutgoing(u.byteLength,o,0,"cancel"),this._protocol.send(ao.serializeCancel(o))}),this._pendingRPCReplies[a]=c,this._onWillSendRequest(o);const d=ao.serializeRequest(o,e,t,s,!!n);return(l=this._logger)==null||l.logOutgoing(d.byteLength,o,0,`request: ${Qb(e)}.${t}(`,i),this._protocol.send(d),c}}a5=ohe;um.UNRESPONSIVE_TIME=3*1e3;const By=class By{static alloc(e,t,i){const n=new By(De.alloc(i+1+4),0);return n.writeUInt8(e),n.writeUInt32(t),n}static read(e,t){return new By(e,t)}get buffer(){return this._buff}constructor(e,t){this._buff=e,this._offset=t}static sizeUInt8(){return 1}writeUInt8(e){this._buff.writeUInt8(e,this._offset),this._offset+=1}readUInt8(){const e=this._buff.readUInt8(this._offset);return this._offset+=1,e}writeUInt32(e){this._buff.writeUInt32BE(e,this._offset),this._offset+=4}readUInt32(){const e=this._buff.readUInt32BE(this._offset);return this._offset+=4,e}static sizeShortString(e){return 1+e.byteLength}writeShortString(e){this._buff.writeUInt8(e.byteLength,this._offset),this._offset+=1,this._buff.set(e,this._offset),this._offset+=e.byteLength}readShortString(){const e=this._buff.readUInt8(this._offset);this._offset+=1;const i=this._buff.slice(this._offset,this._offset+e).toString();return this._offset+=e,i}static sizeLongString(e){return 4+e.byteLength}writeLongString(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}readLongString(){const e=this._buff.readUInt32BE(this._offset);this._offset+=4;const i=this._buff.slice(this._offset,this._offset+e).toString();return this._offset+=e,i}writeBuffer(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}static sizeVSBuffer(e){return 4+e.byteLength}writeVSBuffer(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}readVSBuffer(){const e=this._buff.readUInt32BE(this._offset);this._offset+=4;const t=this._buff.slice(this._offset,this._offset+e);return this._offset+=e,t}static sizeMixedArray(e){let t=0;t+=1;for(let i=0,n=e.length;i<n;i++){const s=e[i];switch(t+=1,s.type){case 1:t+=this.sizeLongString(s.value);break;case 2:t+=this.sizeVSBuffer(s.value);break;case 3:t+=this.sizeUInt32,t+=this.sizeLongString(s.value);for(let o=0;o<s.buffers.length;++o)t+=this.sizeVSBuffer(s.buffers[o]);break}}return t}writeMixedArray(e){this._buff.writeUInt8(e.length,this._offset),this._offset+=1;for(let t=0,i=e.length;t<i;t++){const n=e[t];switch(n.type){case 1:this.writeUInt8(1),this.writeLongString(n.value);break;case 2:this.writeUInt8(2),this.writeVSBuffer(n.value);break;case 3:this.writeUInt8(3),this.writeUInt32(n.buffers.length),this.writeLongString(n.value);for(let s=0;s<n.buffers.length;++s)this.writeBuffer(n.buffers[s]);break;case 4:this.writeUInt8(4);break}}}readMixedArray(){const e=this._buff.readUInt8(this._offset);this._offset+=1;const t=new Array(e);for(let i=0;i<e;i++)switch(this.readUInt8()){case 1:t[i]=this.readLongString();break;case 2:t[i]=this.readVSBuffer();break;case 3:{const s=this.readUInt32(),o=this.readLongString(),a=[];for(let c=0;c<s;++c)a.push(this.readVSBuffer());t[i]=new rs(c5(o,a,null));break}case 4:t[i]=void 0;break}return t}};mi(By,"sizeUInt32",4);let an=By;class ao{static _useMixedArgSerialization(e){for(let t=0,i=e.length;t<i;t++)if(e[t]instanceof De||e[t]instanceof rs||typeof e[t]>"u")return!0;return!1}static serializeRequestArguments(e,t){if(this._useMixedArgSerialization(e)){const i=[];for(let n=0,s=e.length;n<s;n++){const o=e[n];if(o instanceof De)i[n]={type:2,value:o};else if(typeof o>"u")i[n]={type:4};else if(o instanceof rs){const{jsonString:a,referencedBuffers:c}=$B(o.value,t);i[n]={type:3,value:De.fromString(a),buffers:c}}else i[n]={type:1,value:De.fromString(WB(o,t))}}return{type:1,args:i}}return{type:0,args:WB(e,t)}}static serializeRequest(e,t,i,n,s){switch(n.type){case 0:return this._requestJSONArgs(e,t,i,n.args,s);case 1:return this._requestMixedArgs(e,t,i,n.args,s)}}static _requestJSONArgs(e,t,i,n,s){const o=De.fromString(i),a=De.fromString(n);let c=0;c+=an.sizeUInt8(),c+=an.sizeShortString(o),c+=an.sizeLongString(a);const d=an.alloc(s?2:1,e,c);return d.writeUInt8(t),d.writeShortString(o),d.writeLongString(a),d.buffer}static deserializeRequestJSONArgs(e){const t=e.readUInt8(),i=e.readShortString(),n=e.readLongString();return{rpcId:t,method:i,args:JSON.parse(n)}}static _requestMixedArgs(e,t,i,n,s){const o=De.fromString(i);let a=0;a+=an.sizeUInt8(),a+=an.sizeShortString(o),a+=an.sizeMixedArray(n);const c=an.alloc(s?4:3,e,a);return c.writeUInt8(t),c.writeShortString(o),c.writeMixedArray(n),c.buffer}static deserializeRequestMixedArgs(e){const t=e.readUInt8(),i=e.readShortString(),n=e.readMixedArray(),s=new Array(n.length);for(let o=0,a=n.length;o<a;o++){const c=n[o];typeof c=="string"?s[o]=JSON.parse(c):s[o]=c}return{rpcId:t,method:i,args:s}}static serializeAcknowledged(e){return an.alloc(5,e,0).buffer}static serializeCancel(e){return an.alloc(6,e,0).buffer}static serializeReplyOK(e,t,i){if(typeof t>"u")return this._serializeReplyOKEmpty(e);if(t instanceof De)return this._serializeReplyOKVSBuffer(e,t);if(t instanceof rs){const{jsonString:n,referencedBuffers:s}=$B(t.value,i,!0);return this._serializeReplyOKJSONWithBuffers(e,n,s)}else return this._serializeReplyOKJSON(e,A0(t,i))}static _serializeReplyOKEmpty(e){return an.alloc(7,e,0).buffer}static _serializeReplyOKVSBuffer(e,t){let i=0;i+=an.sizeVSBuffer(t);const n=an.alloc(8,e,i);return n.writeVSBuffer(t),n.buffer}static deserializeReplyOKVSBuffer(e){return e.readVSBuffer()}static _serializeReplyOKJSON(e,t){const i=De.fromString(t);let n=0;n+=an.sizeLongString(i);const s=an.alloc(9,e,n);return s.writeLongString(i),s.buffer}static _serializeReplyOKJSONWithBuffers(e,t,i){const n=De.fromString(t);let s=0;s+=an.sizeUInt32,s+=an.sizeLongString(n);for(const a of i)s+=an.sizeVSBuffer(a);const o=an.alloc(10,e,s);o.writeUInt32(i.length),o.writeLongString(n);for(const a of i)o.writeBuffer(a);return o.buffer}static deserializeReplyOKJSON(e){const t=e.readLongString();return JSON.parse(t)}static deserializeReplyOKJSONWithBuffers(e,t){const i=e.readUInt32(),n=e.readLongString(),s=[];for(let o=0;o<i;++o)s.push(e.readVSBuffer());return new rs(c5(n,s,t))}static serializeReplyErr(e,t){const i=t?A0(yC(t),null):void 0;if(typeof i!="string")return this._serializeReplyErrEmpty(e);const n=De.fromString(i);let s=0;s+=an.sizeLongString(n);const o=an.alloc(11,e,s);return o.writeLongString(n),o.buffer}static deserializeReplyErrError(e){const t=e.readLongString();return JSON.parse(t)}static _serializeReplyErrEmpty(e){return an.alloc(12,e,0).buffer}}function che(r,e,t,i){return e.startup===3&&t.length===0?r.createInstance(L0,e,i):r.createInstance(ex,e,t,i)}let ex=class M0 extends ne{get kind(){return this._extensionHost.runningLocation.kind}get startup(){return this._extensionHost.startup}constructor(e,t,i,n,s,o,a){super(),this._internalExtensionService=i,this._instantiationService=n,this._environmentService=s,this._telemetryService=o,this._logService=a,this._onDidChangeResponsiveState=this._register(new A),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._hasStarted=!1,this._cachedActivationEvents=new Map,this._resolvedActivationEvents=new Set,this._rpcProtocol=null,this._customers=[],this._extensionHost=e,this.onDidExit=this._extensionHost.onExit;const c={time:Date.now(),action:"starting",kind:pa(this.kind)};this._telemetryService.publicLog2("extensionHostStartup",c),this._proxy=this._extensionHost.start().then(d=>{this._hasStarted=!0;const l={time:Date.now(),action:"success",kind:pa(this.kind)};return this._telemetryService.publicLog2("extensionHostStartup",l),this._createExtensionHostCustomers(this.kind,d)},d=>{this._logService.error(`Error received from starting extension host (kind: ${pa(this.kind)})`),this._logService.error(d);const l={time:Date.now(),action:"error",kind:pa(this.kind)};return d&&d.name&&(l.errorName=d.name),d&&d.message&&(l.errorMessage=d.message),d&&d.stack&&(l.errorStack=d.stack),this._telemetryService.publicLog2("extensionHostStartup",l),null}),this._proxy.then(()=>{t.forEach(d=>this.activateByEvent(d,0)),this._register(hhe({measure:()=>this.measure()}))})}dispose(){this._extensionHost&&this._extensionHost.dispose(),this._rpcProtocol&&this._rpcProtocol.dispose();for(let e=0,t=this._customers.length;e<t;e++){const i=this._customers[e];try{i.dispose()}catch(n){en(n)}}this._proxy=null,super.dispose()}async measure(){const e=await this._proxy;if(!e)return null;const t=await this._measureLatency(e),i=await this._measureDown(e),n=await this._measureUp(e);return{remoteAuthority:this._extensionHost.remoteAuthority,latency:t,down:i,up:n}}async ready(){await this._proxy}async _measureLatency(e){let i=0;for(let n=0;n<10;n++){const s=Tr.create();await e.test_latency(n),s.stop(),i+=s.elapsed()}return i/10}static _convert(e,t){return e*1e3*8/t}async _measureUp(e){const i=De.alloc(10485760),n=Math.ceil(Math.random()*256);for(let o=0;o<i.byteLength;o++)i.writeUInt8(o,n);const s=Tr.create();return await e.test_up(i),s.stop(),M0._convert(10485760,s.elapsed())}async _measureDown(e){const i=Tr.create();return await e.test_down(10485760),i.stop(),M0._convert(10485760,i.elapsed())}_createExtensionHostCustomers(e,t){let i=null;this._environmentService.logExtensionHostCommunication?i=new uhe(e):tx.isEnabled()&&(i=new tx(this._telemetryService)),this._rpcProtocol=new um(t,i),this._register(this._rpcProtocol.onDidChangeResponsiveState(c=>this._onDidChangeResponsiveState.fire(c)));let n=null;const s={remoteAuthority:this._extensionHost.remoteAuthority,extensionHostKind:this.kind,getProxy:c=>this._rpcProtocol.getProxy(c),set:(c,d)=>this._rpcProtocol.set(c,d),dispose:()=>this._rpcProtocol.dispose(),assertRegistered:c=>this._rpcProtocol.assertRegistered(c),drain:()=>this._rpcProtocol.drain(),internalExtensionService:this._internalExtensionService,_setExtensionHostProxy:c=>{n=c},_setAllMainProxyIdentifiers:c=>{}},o=ZE.getNamedCustomers();for(let c=0,d=o.length;c<d;c++){const[l,u]=o[c];try{const h=this._instantiationService.createInstance(u,s);this._customers.push(h),this._rpcProtocol.set(l,h)}catch(h){this._logService.error(`Cannot instantiate named customer: '${l.sid}'`),this._logService.error(h),en(h)}}const a=ZE.getCustomers();for(const c of a)try{const d=this._instantiationService.createInstance(c,s);this._customers.push(d)}catch(d){this._logService.error(d),en(d)}if(!n)throw new Error("Missing IExtensionHostProxy!");return n}async activate(e,t){const i=await this._proxy;return i?i.activate(e,t):!1}activateByEvent(e,t){return t===1&&!this._hasStarted?Promise.resolve():(this._cachedActivationEvents.has(e)||this._cachedActivationEvents.set(e,this._activateByEvent(e,t)),this._cachedActivationEvents.get(e))}activationEventIsDone(e){return this._resolvedActivationEvents.has(e)}async _activateByEvent(e,t){if(!this._proxy)return;const i=await this._proxy;i&&(await i.activateByEvent(e,t),this._resolvedActivationEvents.add(e))}async getInspectPort(e){if(this._extensionHost){e&&await this._extensionHost.enableInspectPort();const t=this._extensionHost.getInspectPort();if(t)return t}return 0}async resolveAuthority(e,t){const i=Tr.create(!1),n=()=>`[${pa(this._extensionHost.runningLocation.kind)}${this._extensionHost.runningLocation.affinity}][resolveAuthority(${NC(e)},${t})][${i.elapsed()}ms] `,s=d=>this._logService.info(`${n()}${d}`),o=(d,l=void 0)=>this._logService.error(`${n()}${d}`,l);s("obtaining proxy...");const a=await this._proxy;if(!a)return o("no proxy"),{type:"error",error:{message:"Cannot resolve authority",code:$r.Unknown,detail:void 0}};s("invoking...");const c=new $q;try{c.cancelAndSet(()=>s("waiting..."),1e3);const d=await a.resolveAuthority(e,t);return c.dispose(),d.type==="ok"?s(`returned ${d.value.authority.connectTo}`):o("returned an error",d.error),d}catch(d){return c.dispose(),o("returned an error",d),{type:"error",error:{message:d.message,code:$r.Unknown,detail:d}}}}async getCanonicalURI(e,t){const i=await this._proxy;if(!i)throw new Error("Cannot resolve canonical URI");return i.getCanonicalURI(e,t)}async start(e,t){const i=await this._proxy;if(!i)return;const n=this._extensionHost.extensions.set(e,t);return i.startExtensionHost(n)}async extensionTestsExecute(){const e=await this._proxy;if(!e)throw new Error("Could not obtain Extension Host Proxy");return e.extensionTestsExecute()}representsRunningLocation(e){return this._extensionHost.runningLocation.equals(e)}async deltaExtensions(e){const t=await this._proxy;if(t)return this._extensionHost.extensions.delta(e),t.deltaExtensions(e)}containsExtension(e){return this._extensionHost.extensions.containsExtension(e)}async setRemoteEnvironment(e){const t=await this._proxy;if(t)return t.setRemoteEnvironment(e)}};ex=T([v(3,Te),v(4,Ar),v(5,gi),v(6,ze)],ex);let L0=class extends ne{get kind(){return this._extensionHost.runningLocation.kind}get startup(){return this._extensionHost.startup}constructor(e,t,i,n){super(),this._internalExtensionService=t,this._instantiationService=i,this._logService=n,this._onDidChangeResponsiveState=this._register(new A),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._extensionHost=e,this.onDidExit=e.onExit,this._startCalled=new Cs,this._actual=null,this._lazyStartExtensions=null}_createActual(e){return this._logService.info(`Creating lazy extension host: ${e}`),this._actual=this._register(this._instantiationService.createInstance(ex,this._extensionHost,[],this._internalExtensionService)),this._register(this._actual.onDidChangeResponsiveState(t=>this._onDidChangeResponsiveState.fire(t))),this._actual}async _getOrCreateActualAndStart(e){if(this._actual)return this._actual;const t=this._createActual(e);return await t.start([],[]),t}async ready(){await this._startCalled.wait(),this._actual&&await this._actual.ready()}representsRunningLocation(e){return this._extensionHost.runningLocation.equals(e)}async deltaExtensions(e){if(await this._startCalled.wait(),this._actual)return this._actual.deltaExtensions(e);if(this._lazyStartExtensions.delta(e),e.myToAdd.length>0){const t=this._createActual(`contains ${e.myToAdd.length} new extension(s) (installed or enabled): ${e.myToAdd.map(s=>s.value)}`),{toAdd:i,myToAdd:n}=this._lazyStartExtensions.toDelta();t.start(i,n);return}}containsExtension(e){return this._extensionHost.extensions.containsExtension(e)}async activate(e,t){return await this._startCalled.wait(),this._actual?this._actual.activate(e,t):!1}async activateByEvent(e,t){if(t===1)return this._actual?this._actual.activateByEvent(e,t):void 0;if(await this._startCalled.wait(),this._actual)return this._actual.activateByEvent(e,t)}activationEventIsDone(e){return this._startCalled.isOpen()?this._actual?this._actual.activationEventIsDone(e):!0:!1}async getInspectPort(e){return await this._startCalled.wait(),this._actual?this._actual.getInspectPort(e):0}async resolveAuthority(e,t){return await this._startCalled.wait(),this._actual?this._actual.resolveAuthority(e,t):{type:"error",error:{message:"Cannot resolve authority",code:$r.Unknown,detail:void 0}}}async getCanonicalURI(e,t){if(await this._startCalled.wait(),this._actual)return this._actual.getCanonicalURI(e,t);throw new Error("Cannot resolve canonical URI")}async start(e,t){if(t.length>0){const n=this._createActual(`contains ${t.length} extension(s): ${t.map(s=>s.value)}.`).start(e,t);return this._startCalled.open(),n}this._lazyStartExtensions=new FT,this._lazyStartExtensions.set(e,t),this._startCalled.open()}async extensionTestsExecute(){return await this._startCalled.wait(),(await this._getOrCreateActualAndStart("execute tests.")).extensionTestsExecute()}async setRemoteEnvironment(e){if(await this._startCalled.wait(),this._actual)return this._actual.setRemoteEnvironment(e)}};L0=T([v(2,Te),v(3,ze)],L0);const dhe=[["#2977B1","#FC802D","#34A13A","#D3282F","#9366BA"],["#8B564C","#E177C0","#7F7F7F","#BBBE3D","#2EBECD"]];function HB(r){if(Array.isArray(r))return r;if(r&&typeof r=="object"&&typeof r.toString=="function"){const e=r.toString();if(e!=="[object Object]")return e}return r}function lhe(r){return Array.isArray(r)?r.map(HB):HB(r)}class uhe{constructor(e){this._kind=e,this._totalIncoming=0,this._totalOutgoing=0}_log(e,t,i,n,s,o,a){a=lhe(a);const c=dhe[s],d=c[n%c.length];let l=[`%c[${pa(this._kind)}][${e}]%c[${String(t).padStart(7)}]%c[len: ${String(i).padStart(5)}]%c${String(n).padStart(5)} - ${o}`,"color: darkgreen","color: grey","color: grey",`color: ${d}`];/\($/.test(o)?(l=l.concat(a),l.push(")")):l.push(a),console.log.apply(console,l)}logIncoming(e,t,i,n,s){this._totalIncoming+=e,this._log("Ext → Win",this._totalIncoming,e,t,i,n,s)}logOutgoing(e,t,i,n,s){this._totalOutgoing+=e,this._log("Win → Ext",this._totalOutgoing,e,t,i,n,s)}}let tx=class{static isEnabled(){return Math.trunc(Math.random()*1e3)<.5}constructor(e){this._telemetryService=e,this._pendingRequests=new Map}logIncoming(e,t,i,n){if(i===0&&/^receiveReply(Err)?:/.test(n)){const s=this._pendingRequests.get(t)??"unknown_reply";this._pendingRequests.delete(t),this._telemetryService.publicLog2("extensionhost.incoming",{type:`${n} ${s}`,length:e})}i===1&&/^receiveRequest /.test(n)&&this._telemetryService.publicLog2("extensionhost.incoming",{type:`${n}`,length:e})}logOutgoing(e,t,i,n){i===0&&n.startsWith("request: ")&&(this._pendingRequests.set(t,n),this._telemetryService.publicLog2("extensionhost.outgoing",{type:n,length:e}))}};tx=T([v(0,gi)],tx);const Qv=[];function hhe(r){return Qv.push(r),{dispose:()=>{for(let e=0;e<Qv.length;e++)if(Qv[e]===r){Qv.splice(e,1);return}}}}function fhe(){return Qv.slice(0)}Nt(class PS extends Le{constructor(){super({id:"editor.action.measureExtHostLatency",title:{value:p("measureExtHostLatency","Measure Extension Host Latency"),original:"Measure Extension Host Latency"},category:ye.Developer,f1:!0})}async run(e){const t=e.get(Ke),i=await Promise.all(fhe().map(n=>n.measure()));t.openEditor({resource:void 0,contents:i.map(PS._print).join(`

`),options:{pinned:!0}})}static _print(e){return e?`${e.remoteAuthority?`Authority: ${e.remoteAuthority}
`:""}Roundtrip latency: ${e.latency.toFixed(3)}ms
Up: ${PS._printSpeed(e.up)}
Down: ${PS._printSpeed(e.down)}
`:""}static _printSpeed(e){return e<=1024?`${e} bps`:e<1024*1024?`${(e/1024).toFixed(1)} kbps`:`${(e/1024/1024).toFixed(1)} Mbps`}});class ix{constructor(e){this.affinity=e,this.kind=1}equals(e){return this.kind===e.kind&&this.affinity===e.affinity}asString(){return this.affinity===0?"LocalProcess":`LocalProcess${this.affinity}`}}class F0{constructor(e){this.affinity=e,this.kind=2}equals(e){return this.kind===e.kind&&this.affinity===e.affinity}asString(){return this.affinity===0?"LocalWebWorker":`LocalWebWorker${this.affinity}`}}class nx{constructor(){this.kind=3,this.affinity=0}equals(e){return this.kind===e.kind}asString(){return"Remote"}}let O0=class{get maxLocalProcessAffinity(){return this._maxLocalProcessAffinity}get maxLocalWebWorkerAffinity(){return this._maxLocalWebWorkerAffinity}constructor(e,t,i,n,s,o){this._registry=e,this._extensionHostKindPicker=t,this._environmentService=i,this._configurationService=n,this._logService=s,this._extensionManifestPropertiesService=o,this._runningLocation=new Ln,this._maxLocalProcessAffinity=0,this._maxLocalWebWorkerAffinity=0}set(e,t){this._runningLocation.set(e,t)}readExtensionKinds(e){return e.isUnderDevelopment&&this._environmentService.extensionDevelopmentKind?this._environmentService.extensionDevelopmentKind:this._extensionManifestPropertiesService.getExtensionKind(e)}getRunningLocation(e){return this._runningLocation.get(e)||null}filterByRunningLocation(e,t){return AS(e,this._runningLocation,i=>t.equals(i))}filterByExtensionHostKind(e,t){return AS(e,this._runningLocation,i=>i.kind===t)}filterByExtensionHostManager(e,t){return AS(e,this._runningLocation,i=>t.representsRunningLocation(i))}_computeAffinity(e,t,i){const n=new Ln;for(const u of e)(u.main||u.browser)&&n.set(u.identifier,u);for(const u of this._registry.getAllExtensionDescriptions())if(u.main||u.browser){const h=this._runningLocation.get(u.identifier);h&&h.kind===t&&n.set(u.identifier,u)}const s=new Ln;let o=0;for(const[u,h]of n)s.set(h.identifier,++o);const a=(u,h)=>{for(const[g,m]of s)m===u&&s.set(g,h)};for(const[u,h]of n){if(!h.extensionDependencies)continue;const g=s.get(h.identifier);for(const m of h.extensionDependencies){const y=s.get(m);y&&y!==g&&a(y,g)}}const c=new Map;let d=0;for(const[u,h]of n){const g=this._runningLocation.get(h.identifier);if(g){const m=s.get(h.identifier);c.set(m,g.affinity),d=Math.max(d,g.affinity)}}if(!this._environmentService.isExtensionDevelopment){const u=this._configurationService.getValue("extensions.experimental.affinity")||{},h=Object.keys(u),g=new Map;for(const m of h){const y=u[m];if(typeof y!="number"||y<=0||Math.floor(y)!==y){this._logService.info(`Ignoring configured affinity for '${m}' because the value is not a positive integer.`);continue}const _=s.get(m);if(!_)continue;const b=c.get(_);if(b){g.set(y,b);continue}const E=g.get(y);if(E){c.set(_,E);continue}if(!i){this._logService.info(`Ignoring configured affinity for '${m}' because extension host(s) are already running. Reload window.`);continue}const D=++d;g.set(y,D),c.set(_,D)}}const l=new Ln;for(const u of e){const h=s.get(u.identifier)||0,g=c.get(h)||0;l.set(u.identifier,g)}if(d>0&&i)for(let u=1;u<=d;u++){const h=[];for(const g of e)l.get(g.identifier)===u&&h.push(g.identifier);this._logService.info(`Placing extension(s) ${h.map(g=>g.value).join(", ")} on a separate extension host.`)}return{affinities:l,maxAffinity:d}}computeRunningLocation(e,t,i){return this._doComputeRunningLocation(this._runningLocation,e,t,i).runningLocation}_doComputeRunningLocation(e,t,i,n){t=t.filter(m=>!e.has(m.identifier)),i=i.filter(m=>!e.has(m.identifier));const s=Zue(t,i,m=>this.readExtensionKinds(m),(m,y,_,b,E)=>this._extensionHostKindPicker.pickExtensionHostKind(m,y,_,b,E)),o=new Ln;for(const m of t)o.set(m.identifier,m);for(const m of i)o.set(m.identifier,m);const a=new Ln,c=[],d=[];for(const[m,y]of s){let _=null;if(y===1){const b=o.get(m);b&&c.push(b)}else if(y===2){const b=o.get(m);b&&d.push(b)}else y===3&&(_=new nx);a.set(m,_)}const{affinities:l,maxAffinity:u}=this._computeAffinity(c,1,n);for(const m of c){const y=l.get(m.identifier)||0;a.set(m.identifier,new ix(y))}const{affinities:h,maxAffinity:g}=this._computeAffinity(d,2,n);for(const m of d){const y=h.get(m.identifier)||0;a.set(m.identifier,new F0(y))}for(const[m,y]of e)y&&a.set(m,y);return{runningLocation:a,maxLocalProcessAffinity:u,maxLocalWebWorkerAffinity:g}}initializeRunningLocation(e,t){const{runningLocation:i,maxLocalProcessAffinity:n,maxLocalWebWorkerAffinity:s}=this._doComputeRunningLocation(this._runningLocation,e,t,!0);this._runningLocation=i,this._maxLocalProcessAffinity=n,this._maxLocalWebWorkerAffinity=s}deltaExtensions(e,t){const i=new Ln;for(const n of t){const s=n;i.set(s,this._runningLocation.get(s)||null),this._runningLocation.delete(s)}return this._updateRunningLocationForAddedExtensions(e),i}_updateRunningLocationForAddedExtensions(e){const t=[],i=[];for(const o of e){const a=this.readExtensionKinds(o),c=o.extensionLocation.scheme===pe.vscodeRemote,d=this._extensionHostKindPicker.pickExtensionHostKind(o.identifier,a,!c,c,0);let l=null;d===1?t.push(o):d===2?i.push(o):d===3&&(l=new nx),this._runningLocation.set(o.identifier,l)}const{affinities:n}=this._computeAffinity(t,1,!1);for(const o of t){const a=n.get(o.identifier)||0;this._runningLocation.set(o.identifier,new ix(a))}const{affinities:s}=this._computeAffinity(i,2,!1);for(const o of i){const a=s.get(o.identifier)||0;this._runningLocation.set(o.identifier,new F0(a))}}};O0=T([v(2,Ar),v(3,We),v(4,ze),v(5,hb)],O0);function AS(r,e,t){return r.filter(i=>{const n=e.get(i.identifier);return n&&t(n)})}function phe(r,e,t){return r.filter(i=>{const n=e.get(i);return n&&t(n)})}let rx=class{constructor(e,t,i,n,s){this.configurationService=e,this.workspaceContextService=t,this.editorGroupsService=i,this.logService=n,this.pathService=s}text(e,t,i={}){e=this.getContentPattern(e,i);const n=this.configurationService.getValue(),s=t&&t.some(a=>!this.configurationService.getValue({resource:a}).search.useRipgrep);return{...this.commonQuery(t==null?void 0:t.map(IP),i),type:2,contentPattern:e,previewOptions:i.previewOptions,maxFileSize:i.maxFileSize,usePCRE2:n.search.usePCRE2||s||!1,beforeContext:i.beforeContext,afterContext:i.afterContext,userDisabledExcludesAndIgnoreFiles:i.disregardExcludeSettings&&i.disregardIgnoreFiles}}getContentPattern(e,t){var s,o,a,c;const i=this.configurationService.getValue();e.isRegExp&&(e.pattern=e.pattern.replace(/\r?\n/g,"\\n"));const n={...e,wordSeparators:i.editor.wordSeparators};return this.isCaseSensitive(e,t)&&(n.isCaseSensitive=!0),this.isMultiline(e)&&(n.isMultiline=!0),(s=t.notebookSearchConfig)!=null&&s.includeMarkupInput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookMarkdownInput=t.notebookSearchConfig.includeMarkupInput),(o=t.notebookSearchConfig)!=null&&o.includeMarkupPreview&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookMarkdownPreview=t.notebookSearchConfig.includeMarkupPreview),(a=t.notebookSearchConfig)!=null&&a.includeCodeInput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookCellInput=t.notebookSearchConfig.includeCodeInput),(c=t.notebookSearchConfig)!=null&&c.includeOutput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookCellOutput=t.notebookSearchConfig.includeOutput),n}file(e,t={}){return{...this.commonQuery(e,t),type:1,filePattern:t.filePattern?t.filePattern.trim():t.filePattern,exists:t.exists,sortByScore:t.sortByScore,cacheKey:t.cacheKey}}handleIncludeExclude(e,t){return e?(e=Array.isArray(e)?e.map(MS):MS(e),t?this.parseSearchPaths(e):{pattern:UR(...Array.isArray(e)?e:[e])}):{}}commonQuery(e=[],t={}){const i=this.handleIncludeExclude(t.includePattern,t.expandPatterns),n=this.handleIncludeExclude(t.excludePattern,t.expandPatterns),s=e.length>1,o=(i.searchPaths&&i.searchPaths.length?i.searchPaths.map(d=>this.getFolderQueryForSearchPath(d,t,n)):e.map(d=>this.getFolderQueryForRoot(d,t,n,s))).filter(d=>!!d),a={_reason:t._reason,folderQueries:o,usingSearchPaths:!!(i.searchPaths&&i.searchPaths.length),extraFileResources:t.extraFileResources,excludePattern:n.pattern,includePattern:i.pattern,onlyOpenEditors:t.onlyOpenEditors,maxResults:t.maxResults};if(t.onlyOpenEditors){const d=fi(qy(this.editorGroupsService.groups.map(h=>h.editors.map(g=>g.resource))));this.logService.trace("QueryBuilder#commonQuery - openEditor URIs",JSON.stringify(d));const l=d.filter(h=>Jj(a,h.fsPath)),u=this.commonQueryFromFileList(l);return this.logService.trace("QueryBuilder#commonQuery - openEditor Query",JSON.stringify(u)),{...a,...u}}const c=t.extraFileResources&&t.extraFileResources.filter(d=>Jj(a,d.fsPath));return a.extraFileResources=c&&c.length?c:void 0,a}commonQueryFromFileList(e){const t=[],i=new ki,n={};let s=!1;return e.forEach(o=>{var c;if(o.scheme===pe.walkThrough)return;if(Wq(o)){const d=((c=this.workspaceContextService.getWorkspaceFolder(o))==null?void 0:c.uri)??o.with({path:_h(o.fsPath)});let l=i.get(d);l||(s=!0,l={folder:d,includePattern:{}},t.push(l),i.set(d,l));const u=Sg(d.fsPath,o.fsPath);Mi(l.includePattern)[u.replace(/\\/g,"/")]=!0}else o.fsPath&&(s=!0,n[o.fsPath]=!0)}),{folderQueries:t,includePattern:n,usingSearchPaths:!0,excludePattern:s?void 0:{"**/*":!0}}}isCaseSensitive(e,t){if(t.isSmartCase){if(e.isRegExp){if(gH(e.pattern,!0))return!0}else if(gH(e.pattern))return!0}return!!e.isCaseSensitive}isMultiline(e){return e.isMultiline||e.isRegExp&&wY(e.pattern)||e.pattern.indexOf(`
`)>=0?!0:!!e.isMultiline}parseSearchPaths(e){const t=u=>Eg(u)||/^\.\.?([\/\\]|$)/.test(u),n=(Array.isArray(e)?e:mhe(e)).map(u=>{const h=this.pathService.resolvedUserHome;return h?bY(u,h.scheme===pe.file?h.fsPath:h.path):u}),s=SY(n,u=>t(u)?"searchPaths":"exprSegments"),o=(s.exprSegments||[]).map(u=>tf(u,"/")).map(u=>tf(u,"\\")).map(u=>(u[0]==="."&&(u="*"+u),vhe(u))),a={},c=this.expandSearchPathPatterns(s.searchPaths||[]);c&&c.length&&(a.searchPaths=c);const d=qy(o),l=UR(...d);return l&&(a.pattern=l),a}getExcludesForFolder(e,t){return t.disregardExcludeSettings?void 0:Yce(e,!t.disregardSearchExcludeSettings)}expandSearchPathPatterns(e){if(!e||!e.length)return[];const t=e.flatMap(n=>{let{pathPortion:s,globPortion:o}=ghe(n);return o&&(o=VR(o)),this.expandOneSearchPath(s).flatMap(c=>this.resolveOneSearchPathPattern(c,o))}),i=new Map;return t.forEach(n=>{const s=n.searchPath.toString(),o=i.get(s);o?n.pattern&&(o.pattern=o.pattern||{},o.pattern[n.pattern]=!0):i.set(s,{searchPath:n.searchPath,pattern:n.pattern?UR(n.pattern):void 0})}),Array.from(i.values())}expandOneSearchPath(e){if(Eg(e)){const t=this.workspaceContextService.getWorkspace().folders;return t[0]&&t[0].uri.scheme!==pe.file?[{searchPath:t[0].uri.with({path:e})}]:[{searchPath:k.file(_C(e))}]}if(this.workspaceContextService.getWorkbenchState()===2){const t=this.workspaceContextService.getWorkspace().folders[0].uri;if(e=MS(e),e.startsWith("../")||e===".."){const n=Ho.resolve(t.path,e);return[{searchPath:t.with({path:n})}]}const i=VR(e);return[{searchPath:t,pattern:i}]}else{if(e==="./"||e===".\\")return[];{const t=e.replace(/^\.[\/\\]/,""),n=this.workspaceContextService.getWorkspace().folders.map(s=>{const o=t.match(new RegExp(`^${Hq(s.name)}(?:/(.*)|$)`));return o?{match:o,folder:s}:null}).filter(Op);if(n.length)return n.map(s=>{const o=s.match[1];return{searchPath:s.folder.uri,pattern:o&&VR(o)}});{const s=e.match(/\.[\/\\](.+)[\/\\]?/),o=s?s[1]:e,a=p("search.noWorkspaceWithName","Workspace folder does not exist: {0}",o);throw new Error(a)}}}}resolveOneSearchPathPattern(e,t){const i=e.pattern&&t?`${e.pattern}/${t}`:e.pattern||t,n=[{searchPath:e.searchPath,pattern:i}];return i&&!i.endsWith("**")&&n.push({searchPath:e.searchPath,pattern:i+"/**"}),n}getFolderQueryForSearchPath(e,t,i){const n=this.getFolderQueryForRoot(IP(e.searchPath),t,i,!1);return n?{...n,includePattern:e.pattern}:null}getFolderQueryForRoot(e,t,i,n){let s;const o=k.isUri(e)?e:e.uri;if(i.searchPaths){const u=i.searchPaths.filter(h=>si(h.searchPath,o))[0];if(u&&!u.pattern)return null;u&&(s=u.pattern)}const a=this.configurationService.getValue({resource:o}),d={...this.getExcludesForFolder(a,t)||{},...s||{}},l=k.isUri(e)?Mt(e):e.name;return{folder:o,folderName:n?l:void 0,excludePattern:Object.keys(d).length>0?d:void 0,fileEncoding:a.files&&a.files.encoding,disregardIgnoreFiles:typeof t.disregardIgnoreFiles=="boolean"?t.disregardIgnoreFiles:!a.search.useIgnoreFiles,disregardGlobalIgnoreFiles:typeof t.disregardGlobalIgnoreFiles=="boolean"?t.disregardGlobalIgnoreFiles:!a.search.useGlobalIgnoreFiles,disregardParentIgnoreFiles:typeof t.disregardParentIgnoreFiles=="boolean"?t.disregardParentIgnoreFiles:!a.search.useParentIgnoreFiles,ignoreSymlinks:typeof t.ignoreSymlinks=="boolean"?t.ignoreSymlinks:!a.search.followSymlinks}}};rx=T([v(0,We),v(1,oi),v(2,it),v(3,ze),v(4,ta)],rx);function ghe(r){const e=r.match(/[\*\{\}\(\)\[\]\?]/);if(e){const t=e.index,i=r.substr(0,t).match(/[/|\\][^/\\]*$/);if(i){let n=r.substr(0,i.index);return n.match(/[/\\]/)||(n+="/"),{pathPortion:n,globPortion:r.substr((i.index||0)+1)}}}return{pathPortion:r}}function UR(...r){return r.length?r.reduce((e,t)=>(e[t]=!0,e),Object.create(null)):void 0}function mhe(r){return CY(r,",").map(e=>e.trim()).filter(e=>!!e.length)}function vhe(r){return[`**/${r}/**`,`**/${r}`].map(t=>t.replace(/\*\*\/\*\*/g,"**"))}function MS(r){return r.replace(/\\/g,"/")}function VR(r){return MS(r).replace(/^\.\//,"").replace(/\/+$/g,"")}function yhe(r){return r.replace(/([?*[\]])/g,"[$1]")}function R0e(r,e){r=Mf(r,n=>n.toString());const t=[],i=e.getWorkspace();return r&&r.forEach(n=>{let s;if(e.getWorkbenchState()===2)s=xg(i.folders[0].uri,n),s&&s!=="."&&(s="./"+s);else{const o=e.getWorkspaceFolder(n);if(o){const a=o.name;if(i.folders.filter(d=>d.name===a).length===1){const d=xg(o.uri,n);d===""?s=`./${o.name}`:s=`./${o.name}/${d}`}else s=n.fsPath}}s&&t.push(yhe(s))}),t}const _he=7e3;function d5(r,e){const t=e.activationEvents;if(!t)return Promise.resolve(void 0);const i=[],n=[];for(const l of t)if(/^workspaceContains:/.test(l)){const u=l.substr(18);u.indexOf("*")>=0||u.indexOf("?")>=0||r.forceUsingSearch?n.push(u):i.push(u)}if(i.length===0&&n.length===0)return Promise.resolve(void 0);let s;const o=new Promise((l,u)=>{s=l}),a=l=>s({activationEvent:l}),c=Promise.all(i.map(l=>whe(r,l,a))).then(()=>{}),d=bhe(r,e.identifier,n,a);return Promise.all([c,d]).then(()=>{s(void 0)}),o}async function whe(r,e,t){for(const i of r.folders)if(await r.exists(pt(k.revive(i),e))){t(`workspaceContains:${e}`);return}}async function bhe(r,e,t,i){if(t.length===0)return Promise.resolve(void 0);const n=new Xt,s=r.checkExists(r.folders,t,n.token),o=setTimeout(async()=>{n.cancel(),r.logService.info(`Not activating extension '${e.value}': Timed out while searching for 'workspaceContains' pattern ${t.join(",")}`)},_he);let a=!1;try{a=await s}catch(c){Ur(c)||en(c)}n.dispose(),clearTimeout(o),a&&i(`workspaceContains:${t.join(",")}`)}function l5(r,e,t,i){const n=r.get(Te),s=r.get(cb),a=n.createInstance(rx).file(e.map(c=>IP(k.revive(c))),{_reason:"checkExists",includePattern:t,exists:!0});return s.fileSearch(a,i).then(c=>!!c.limitHit,c=>Ur(c)?!1:Promise.reject(c))}const qR=Object.hasOwnProperty,She=Promise.resolve(void 0);let N0=class u5 extends ne{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y,_,b,E,D,R){super(),this._extensionsProposedApi=e,this._extensionHostFactory=t,this._extensionHostKindPicker=i,this._instantiationService=n,this._notificationService=s,this._environmentService=o,this._telemetryService=a,this._extensionEnablementService=c,this._fileService=d,this._productService=l,this._extensionManagementService=u,this._contextService=h,this._configurationService=g,this._extensionManifestPropertiesService=m,this._logService=y,this._remoteAgentService=_,this._remoteExtensionsScannerService=b,this._lifecycleService=E,this._remoteAuthorityResolverService=D,this._dialogService=R,this._onDidRegisterExtensions=this._register(new A),this.onDidRegisterExtensions=this._onDidRegisterExtensions.event,this._onDidChangeExtensionsStatus=this._register(new A),this.onDidChangeExtensionsStatus=this._onDidChangeExtensionsStatus.event,this._onDidChangeExtensions=this._register(new A({leakWarningThreshold:400})),this.onDidChangeExtensions=this._onDidChangeExtensions.event,this._onWillActivateByEvent=this._register(new A),this.onWillActivateByEvent=this._onWillActivateByEvent.event,this._onDidChangeResponsiveChange=this._register(new A),this.onDidChangeResponsiveChange=this._onDidChangeResponsiveChange.event,this._onWillStop=this._register(new A),this.onWillStop=this._onWillStop.event,this._activationEventReader=new khe,this._registry=new zue(this._activationEventReader),this._installedExtensionsReady=new Cs,this._extensionStatus=new Ln,this._allRequestedActivateEvents=new Set,this._remoteCrashTracker=new hm,this._deltaExtensionsQueue=[],this._inHandleDeltaExtensions=!1,this._extensionHostManagers=[],this._resolveAuthorityAttempt=0,this._register(this._fileService.onWillActivateFileSystemProvider(M=>{M.scheme!==pe.vscodeRemote&&M.join(this.activateByEvent(`onFileSystem:${M.scheme}`))})),this._runningLocations=new O0(this._registry,this._extensionHostKindPicker,this._environmentService,this._configurationService,this._logService,this._extensionManifestPropertiesService),this._register(this._extensionEnablementService.onEnablementChanged(M=>{const O=[],L=[];for(const W of M)this._safeInvokeIsEnabled(W)?O.push(W):L.push(W);this._handleDeltaExtensions(new Yv(O,L))})),this._register(this._extensionManagementService.onDidChangeProfile(({added:M,removed:O})=>{(M.length||O.length)&&this._handleDeltaExtensions(new Yv(M,O))})),this._register(this._extensionManagementService.onDidInstallExtensions(M=>{const O=[];for(const{local:L,operation:W}of M)L&&W!==4&&this._safeInvokeIsEnabled(L)&&O.push(L);O.length&&this._handleDeltaExtensions(new Yv(O,[]))})),this._register(this._extensionManagementService.onDidUninstallExtension(M=>{M.error||this._handleDeltaExtensions(new Yv([],[M.identifier.id]))})),this._register(this._lifecycleService.onDidShutdown(()=>{const M=this._remoteAgentService.getConnection();M==null||M.dispose(),this._doStopExtensionHosts()}))}_getExtensionHostManagers(e){return this._extensionHostManagers.filter(t=>t.kind===e)}_getExtensionHostManagerByRunningLocation(e){for(const t of this._extensionHostManagers)if(t.representsRunningLocation(e))return t;return null}async _handleDeltaExtensions(e){if(this._deltaExtensionsQueue.push(e),this._inHandleDeltaExtensions)return;let t=null;try{for(this._inHandleDeltaExtensions=!0,await this._installedExtensionsReady.wait(),t=await this._registry.acquireLock("handleDeltaExtensions");this._deltaExtensionsQueue.length>0;){const i=this._deltaExtensionsQueue.shift();await this._deltaExtensions(t,i.toAdd,i.toRemove)}}finally{this._inHandleDeltaExtensions=!1,t==null||t.dispose()}}async _deltaExtensions(e,t,i){let n=[];for(let a=0,c=i.length;a<c;a++){const d=i[a],l=typeof d=="string"?d:d.identifier.id,u=typeof d=="string"?null:d,h=this._registry.getExtensionDescription(l);h&&(u&&h.extensionLocation.scheme!==u.location.scheme||this.canRemoveExtension(h)&&n.push(h))}const s=[];for(let a=0,c=t.length;a<c;a++){const d=t[a],l=await this._scanSingleExtension(d);l&&this._canAddExtension(l,n)&&s.push(l)}if(s.length===0&&n.length===0)return;const o=this._registry.deltaExtensions(e,s,n.map(a=>a.identifier));this._onDidChangeExtensions.fire({added:s,removed:n}),n=n.concat(o.removedDueToLooping),o.removedDueToLooping.length>0&&this._notificationService.notify({severity:wn.Error,message:p("looping","The following extensions contain dependency loops and have been disabled: {0}",o.removedDueToLooping.map(a=>`'${a.identifier.value}'`).join(", "))}),this._doHandleExtensionPoints([].concat(s).concat(n)),await this._updateExtensionsOnExtHosts(s,n.map(a=>a.identifier));for(let a=0;a<s.length;a++)this._activateAddedExtensionIfNeeded(s[a])}async _updateExtensionsOnExtHosts(e,t){const i=this._runningLocations.deltaExtensions(e,t),n=this._extensionHostManagers.map(s=>this._updateExtensionsOnExtHost(s,e,t,i));await Promise.all(n)}async _updateExtensionsOnExtHost(e,t,i,n){const s=this._runningLocations.filterByExtensionHostManager(t,e),o=phe(i,n,c=>e.representsRunningLocation(c)),a=H_.createActivationEventsMap(t);await e.deltaExtensions({toRemove:i,toAdd:t,addActivationEvents:a,myToRemove:o,myToAdd:s.map(c=>c.identifier)})}canAddExtension(e){return this._canAddExtension(e,[])}_canAddExtension(e,t){if(this._registry.getExtensionDescriptionByIdOrUUID(e.identifier,e.id)&&!t.some(c=>fn.equals(e.identifier,c.identifier)))return!1;const n=this._runningLocations.readExtensionKinds(e),s=e.extensionLocation.scheme===pe.vscodeRemote;return this._extensionHostKindPicker.pickExtensionHostKind(e.identifier,n,!s,s,0)!==null}canRemoveExtension(e){var i;const t=this._registry.getExtensionDescription(e.identifier);return!(!t||(i=this._extensionStatus.get(t.identifier))!=null&&i.activationStarted)}async _activateAddedExtensionIfNeeded(e){let t=!1,i=null,n=!1;const s=this._activationEventReader.readActivationEvents(e);for(let o of s){if(o==="onUri"&&(o=`onUri:${fn.toKey(e.identifier)}`),this._allRequestedActivateEvents.has(o)){t=!0,i=o;break}if(o==="*"){t=!0,i=o;break}if(/^workspaceContains/.test(o)&&(n=!0),o==="onStartupFinished"){t=!0,i=o;break}}if(t)await Promise.all(this._extensionHostManagers.map(o=>o.activate(e.identifier,{startup:!1,extensionId:e.identifier,activationEvent:i}))).then(()=>{});else if(n){const o=await this._contextService.getCompleteWorkspace(),a=!!this._environmentService.remoteAuthority,c={logService:this._logService,folders:o.folders.map(l=>l.uri),forceUsingSearch:a,exists:l=>this._fileService.exists(l),checkExists:(l,u,h)=>this._instantiationService.invokeFunction(g=>l5(g,l,u,h))},d=await d5(c,e);if(!d)return;await Promise.all(this._extensionHostManagers.map(l=>l.activate(e.identifier,{startup:!1,extensionId:e.identifier,activationEvent:d.activationEvent}))).then(()=>{})}}async _initialize(){qt("code/willLoadExtensions"),this._startExtensionHostsIfNecessary(!0,[]);const e=await this._registry.acquireLock("_initialize");try{const t=await this._resolveExtensions();this._processExtensions(e,t);const i=this._registry.getAllExtensionDescriptions();for(const n of this._extensionHostManagers)if(n.startup!==1){const s=this._runningLocations.filterByExtensionHostManager(i,n);n.start(i,s.map(o=>o.identifier))}}finally{e.dispose()}this._releaseBarrier(),qt("code/didLoadExtensions"),await this._handleExtensionTests()}_processExtensions(e,t){const{allowRemoteExtensionsInLocalWebWorker:i,hasLocalProcess:n}=t,s=$0(this._extensionEnablementService,this._extensionsProposedApi,t.local,!1);let o=$0(this._extensionEnablementService,this._extensionsProposedApi,t.remote,!1);this._runningLocations.initializeRunningLocation(s,o),this._startExtensionHostsIfNecessary(!0,[]);const a=i?this._runningLocations.filterByExtensionHostKind(o,2):[],c=n?this._runningLocations.filterByExtensionHostKind(s,1):[],d=this._runningLocations.filterByExtensionHostKind(s,2);o=this._runningLocations.filterByExtensionHostKind(o,3);for(const h of a)xhe(d,h.identifier)||d.push(h);const l=o.concat(c).concat(d),u=this._registry.deltaExtensions(e,l,[]);u.removedDueToLooping.length>0&&this._notificationService.notify({severity:wn.Error,message:p("looping","The following extensions contain dependency loops and have been disabled: {0}",u.removedDueToLooping.map(h=>`'${h.identifier.value}'`).join(", "))}),this._doHandleExtensionPoints(this._registry.getAllExtensionDescriptions())}async _handleExtensionTests(){if(!this._environmentService.isExtensionDevelopment||!this._environmentService.extensionTestsLocationURI)return;const e=this.findTestExtensionHost(this._environmentService.extensionTestsLocationURI);if(!e){const i=p("extensionTestError","No extension host found that can launch the test runner at {0}.",this._environmentService.extensionTestsLocationURI.toString());console.error(i),this._notificationService.error(i);return}let t;try{t=await e.extensionTestsExecute()}catch(i){console.error(i),t=1}this._onExtensionHostExit(t)}findTestExtensionHost(e){let t=null;for(const i of this._registry.getAllExtensionDescriptions())if(Ff(e,i.extensionLocation)){t=this._runningLocations.getRunningLocation(i.identifier);break}return t===null&&(e.scheme===pe.vscodeRemote?t=new nx:t=new ix(0)),t!==null?this._getExtensionHostManagerByRunningLocation(t):null}_releaseBarrier(){this._installedExtensionsReady.open(),this._onDidRegisterExtensions.fire(void 0),this._onDidChangeExtensionsStatus.fire(this._registry.getAllExtensionDescriptions().map(e=>e.identifier))}async _resolveAuthorityInitial(e){for(let i=1;;i++)try{return this._resolveAuthorityWithLogging(e)}catch(n){if(Eh.isNoResolverFound(n)||Eh.isNotAvailable(n)||i>=5)throw n}}async _resolveAuthorityAgain(){const e=this._environmentService.remoteAuthority;if(e){this._remoteAuthorityResolverService._clearResolvedAuthority(e);try{const t=await this._resolveAuthorityWithLogging(e);this._remoteAuthorityResolverService._setResolvedAuthority(t.authority,t.options)}catch(t){this._remoteAuthorityResolverService._setResolvedAuthorityError(e,t)}}}async _resolveAuthorityWithLogging(e){const t=NC(e),i=Tr.create(!1);this._logService.info(`Invoking resolveAuthority(${t})...`);try{qt(`code/willResolveAuthority/${t}`);const n=await this._resolveAuthority(e);return qt(`code/didResolveAuthorityOK/${t}`),this._logService.info(`resolveAuthority(${t}) returned '${n.authority.connectTo}' after ${i.elapsed()} ms`),n}catch(n){throw qt(`code/didResolveAuthorityError/${t}`),this._logService.error(`resolveAuthority(${t}) returned an error after ${i.elapsed()} ms`,n),n}}async _resolveAuthorityOnExtensionHosts(e,t){const i=this._getExtensionHostManagers(e);if(i.length===0)throw new Error("Cannot resolve authority");this._resolveAuthorityAttempt++;const n=await Promise.all(i.map(o=>o.resolveAuthority(t,this._resolveAuthorityAttempt)));let s=null;for(const o of n){if(o.type==="ok")return o.value;if(!s){s=o;continue}const a=s.error.code===$r.Unknown,c=o.error.code===$r.Unknown;a&&!c&&(s=o)}throw new Eh(s.error.message,s.error.code,s.error.detail)}stopExtensionHosts(e){return this._doStopExtensionHostsWithVeto(e)}_doStopExtensionHosts(){const e=[];for(const t of this._extensionStatus.values())t.activationStarted&&e.push(t.id);for(let t=this._extensionHostManagers.length-1;t>=0;t--)this._extensionHostManagers[t].dispose();this._extensionHostManagers=[];for(const t of this._extensionStatus.values())t.clearRuntimeStatus();e.length>0&&this._onDidChangeExtensionsStatus.fire(e)}async _doStopExtensionHostsWithVeto(e){const t=[],i=new Set;this._onWillStop.fire({reason:e,veto(s,o){t.push(s),typeof s=="boolean"?s===!0&&i.add(o):s.then(a=>{a&&i.add(o)}).catch(a=>{i.add(p("extensionStopVetoError","{0} (Error: {1})",o,La(a)))})}});const n=await que(t,s=>this._logService.error(s));if(!n)this._doStopExtensionHosts();else{const s=Array.from(i);this._logService.warn(`Extension host was not stopped because of veto (stop reason: ${e}, veto reason: ${s.join(", ")})`),await this._dialogService.warn(p("extensionStopVetoMessage","The following operation was blocked: {0}",e),s.length===1?p("extensionStopVetoDetailsOne","The reason for blocking the operation: {0}",s[0]):p("extensionStopVetoDetailsMany",`The reasons for blocking the operation:
- {0}`,s.join(`
 -`)))}return!n}_startExtensionHostsIfNecessary(e,t){const i=[];for(let n=0;n<=this._runningLocations.maxLocalProcessAffinity;n++)i.push(new ix(n));for(let n=0;n<=this._runningLocations.maxLocalWebWorkerAffinity;n++)i.push(new F0(n));i.push(new nx);for(const n of i){if(this._getExtensionHostManagerByRunningLocation(n))continue;const s=this._createExtensionHostManager(n,e,t);s&&this._extensionHostManagers.push(s)}}_createExtensionHostManager(e,t,i){const n=this._extensionHostFactory.createExtensionHost(this._runningLocations,e,t);if(!n)return null;const s=this._doCreateExtensionHostManager(n,i);return s.onDidExit(([o,a])=>this._onExtensionHostCrashOrExit(s,o,a)),s.onDidChangeResponsiveState(o=>{this._onDidChangeResponsiveChange.fire({extensionHostKind:s.kind,isResponsive:o===0,getInspectPort:a=>s.getInspectPort(a)})}),s}_doCreateExtensionHostManager(e,t){return che(this._instantiationService,e,t,this._acquireInternalAPI(e))}_onExtensionHostCrashOrExit(e,t,i){if(!P$(this._environmentService).isExtensionDevHost){this._onExtensionHostCrashed(e,t,i);return}this._onExtensionHostExit(t)}_onExtensionHostCrashed(e,t,i){if(console.error(`Extension host (${pa(e.kind)}) terminated unexpectedly. Code: ${t}, Signal: ${i}`),e.kind===1)this._doStopExtensionHosts();else if(e.kind===3){i&&this._onRemoteExtensionHostCrashed(e,i);for(let n=0;n<this._extensionHostManagers.length;n++)if(this._extensionHostManagers[n]===e){this._extensionHostManagers[n].dispose(),this._extensionHostManagers.splice(n,1);break}}}_getExtensionHostExitInfoWithTimeout(e){return new Promise((t,i)=>{const n=setTimeout(()=>{i(new Error("getExtensionHostExitInfo timed out"))},2e3);this._remoteAgentService.getExtensionHostExitInfo(e).then(s=>{clearTimeout(n),t(s)},i)})}async _onRemoteExtensionHostCrashed(e,t){try{const i=await this._getExtensionHostExitInfoWithTimeout(t);i&&this._logService.error(`Extension host (${pa(e.kind)}) terminated unexpectedly with code ${i.code}.`),this._logExtensionHostCrash(e),this._remoteCrashTracker.registerCrash(),this._remoteCrashTracker.shouldAutomaticallyRestart()?(this._logService.info("Automatically restarting the remote extension host."),this._notificationService.status(p("extensionService.autoRestart","The remote extension host terminated unexpectedly. Restarting..."),{hideAfter:5e3}),this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()))):this._notificationService.prompt(wn.Error,p("extensionService.crash","Remote Extension host terminated unexpectedly 3 times within the last 5 minutes."),[{label:p("restart","Restart Remote Extension Host"),run:()=>{this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()))}}])}catch{}}_logExtensionHostCrash(e){const t=[];for(const i of this._extensionStatus.values())i.activationStarted&&e.containsExtension(i.id)&&t.push(i.id);t.length>0?this._logService.error(`Extension host (${pa(e.kind)}) terminated unexpectedly. The following extensions were running: ${t.map(i=>i.value).join(", ")}`):this._logService.error(`Extension host (${pa(e.kind)}) terminated unexpectedly. No extensions were activated.`)}async startExtensionHosts(){this._doStopExtensionHosts();const e=await this._registry.acquireLock("startExtensionHosts");try{this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()));const t=this._getExtensionHostManagers(1);await Promise.all(t.map(i=>i.ready()))}finally{e.dispose()}}activateByEvent(e,t=0){return this._installedExtensionsReady.isOpen()?(this._allRequestedActivateEvents.add(e),this._registry.containsActivationEvent(e)?this._activateByEvent(e,t):She):(this._allRequestedActivateEvents.add(e),t===1?this._activateByEvent(e,t):this._installedExtensionsReady.wait().then(()=>this._activateByEvent(e,t)))}_activateByEvent(e,t){const i=Promise.all(this._extensionHostManagers.map(n=>n.activateByEvent(e,t))).then(()=>{});return this._onWillActivateByEvent.fire({event:e,activation:i}),i}activationEventIsDone(e){return this._installedExtensionsReady.isOpen()?this._registry.containsActivationEvent(e)?this._extensionHostManagers.every(t=>t.activationEventIsDone(e)):!0:!1}whenInstalledExtensionsRegistered(){return this._installedExtensionsReady.wait()}get extensions(){return this._registry.getAllExtensionDescriptions()}_getExtensions(){return this._installedExtensionsReady.wait().then(()=>this.extensions)}getExtension(e){return this._installedExtensionsReady.wait().then(()=>this._registry.getExtensionDescription(e))}readExtensionPointContributions(e){return this._installedExtensionsReady.wait().then(()=>{const t=this._registry.getAllExtensionDescriptions(),i=[];for(const n of t)n.contributes&&qR.call(n.contributes,e.name)&&i.push(new Pce(n,n.contributes[e.name]));return i})}getExtensionsStatus(){const e=Object.create(null);if(this._registry){const t=this._registry.getAllExtensionDescriptions();for(const i of t){const n=this._extensionStatus.get(i.identifier);e[i.identifier.value]={id:i.identifier,messages:(n==null?void 0:n.messages)??[],activationStarted:(n==null?void 0:n.activationStarted)??!1,activationTimes:(n==null?void 0:n.activationTimes)??void 0,runtimeErrors:(n==null?void 0:n.runtimeErrors)??[],runningLocation:this._runningLocations.getRunningLocation(i.identifier)}}}return e}async getInspectPorts(e,t){return(await Promise.all(this._getExtensionHostManagers(e).map(n=>n.getInspectPort(t)))).filter(n=>!!n)}async setRemoteEnvironment(e){await this._extensionHostManagers.map(t=>t.setRemoteEnvironment(e))}_safeInvokeIsEnabled(e){try{return this._extensionEnablementService.isEnabled(e)}catch{return!1}}_doHandleExtensionPoints(e){const t=Object.create(null);for(const o of e)if(o.contributes)for(const a in o.contributes)qR.call(o.contributes,a)&&(t[a]=!0);const i=o=>this._handleExtensionPointMessage(o),n=this._registry.getAllExtensionDescriptions(),s=io.getExtensionPoints();qt("code/willHandleExtensionPoints");for(const o of s)t[o.name]&&(qt(`code/willHandleExtensionPoint/${o.name}`),u5._handleExtensionPoint(o,n,i),qt(`code/didHandleExtensionPoint/${o.name}`));qt("code/didHandleExtensionPoints")}_getOrCreateExtensionStatus(e){return this._extensionStatus.has(e)||this._extensionStatus.set(e,new Dhe(e)),this._extensionStatus.get(e)}_handleExtensionPointMessage(e){this._getOrCreateExtensionStatus(e.extensionId).addMessage(e);const i=this._registry.getExtensionDescription(e.extensionId),n=`[${e.extensionId.value}]: ${e.message}`;if(e.type===wn.Error?(i&&i.isUnderDevelopment&&this._notificationService.notify({severity:wn.Error,message:n}),this._logService.error(n)):e.type===wn.Warning?(i&&i.isUnderDevelopment&&this._notificationService.notify({severity:wn.Warning,message:n}),this._logService.warn(n)):this._logService.info(n),e.extensionId&&this._environmentService.isBuilt&&!this._environmentService.isExtensionDevelopment){const{type:s,extensionId:o,extensionPointId:a,message:c}=e;this._telemetryService.publicLog2("extensionsMessage",{type:s,extensionId:o.value,extensionPointId:a,message:c})}}static _handleExtensionPoint(e,t,i){const n=[];for(const s of t)s.contributes&&qR.call(s.contributes,e.name)&&n.push({description:s,value:s.contributes[e.name],collector:new Dle(i,s,e.name)});e.acceptUsers(n)}_acquireInternalAPI(e){return{_activateById:(t,i)=>this._activateById(t,i),_onWillActivateExtension:t=>this._onWillActivateExtension(t,e.runningLocation),_onDidActivateExtension:(t,i,n,s,o)=>this._onDidActivateExtension(t,i,n,s,o),_onDidActivateExtensionError:(t,i)=>this._onDidActivateExtensionError(t,i),_onExtensionRuntimeError:(t,i)=>this._onExtensionRuntimeError(t,i)}}async _activateById(e,t){if(!(await Promise.all(this._extensionHostManagers.map(s=>s.activate(e,t)))).some(s=>s))throw new Error(`Unknown extension ${e.value}`)}_onWillActivateExtension(e,t){this._runningLocations.set(e,t),this._getOrCreateExtensionStatus(e).onWillActivate()}_onDidActivateExtension(e,t,i,n,s){this._getOrCreateExtensionStatus(e).setActivationTimes(new Rce(t,i,n,s)),this._onDidChangeExtensionsStatus.fire([e])}_onDidActivateExtensionError(e,t){this._telemetryService.publicLog2("extensionActivationError",{extensionId:e.value,error:t.message})}_onExtensionRuntimeError(e,t){this._getOrCreateExtensionStatus(e).addRuntimeError(t),this._onDidChangeExtensionsStatus.fire([e])}};N0=T([v(3,Te),v(4,on),v(5,Ar),v(6,gi),v(7,ev),v(8,at),v(9,Rs),v(10,J1),v(11,oi),v(12,We),v(13,hb),v(14,ze),v(15,Wa),v(16,D$),v(17,ea),v(18,wu),v(19,ar)],N0);class Che{constructor(e,t,i,n){this.local=e,this.remote=t,this.hasLocalProcess=i,this.allowRemoteExtensionsInLocalWebWorker=n}}class Yv{constructor(e,t){this.toAdd=e,this.toRemove=t}}function $0(r,e,t,i){return Ehe(r,t,i)}function Ehe(r,e,t){const i=[],n=[],s=[];for(const a of e)a.isUnderDevelopment?i.push(a):(n.push(a),s.push(Ace(a)));const o=r.getEnablementStates(s,t?{trusted:!0}:void 0);for(let a=0;a<o.length;a++)r.isEnabledEnablementState(o[a])&&i.push(n[a]);return i}function xhe(r,e){for(const t of r)if(fn.equals(t.identifier,e))return!0;return!1}class Dhe{get messages(){return this._messages}get activationTimes(){return this._activationTimes}get runtimeErrors(){return this._runtimeErrors}get activationStarted(){return this._activationStarted}constructor(e){this.id=e,this._messages=[],this._activationTimes=null,this._runtimeErrors=[],this._activationStarted=!1}clearRuntimeStatus(){this._activationStarted=!1,this._activationTimes=null,this._runtimeErrors=[]}addMessage(e){this._messages.push(e)}setActivationTimes(e){this._activationTimes=e}addRuntimeError(e){this._runtimeErrors.push(e)}onWillActivate(){this._activationStarted=!0}}class hm{constructor(){this._recentCrashes=[]}_removeOldCrashes(){const e=Date.now()-hm._TIME_LIMIT;for(;this._recentCrashes.length>0&&this._recentCrashes[0].timestamp<e;)this._recentCrashes.shift()}registerCrash(){this._removeOldCrashes(),this._recentCrashes.push({timestamp:Date.now()})}shouldAutomaticallyRestart(){return this._removeOldCrashes(),this._recentCrashes.length<hm._CRASH_LIMIT}}hm._TIME_LIMIT=5*60*1e3;hm._CRASH_LIMIT=3;class khe{readActivationEvents(e){return H_.readActivationEvents(e)}}let W0=class{constructor(e,t,i){if(this._logService=e,this._environmentService=t,this._envEnabledExtensions=new Set((t.extensionEnabledProposedApi??[]).map(n=>fn.toKey(n))),this._envEnablesProposedApiForAll=!t.isBuilt||t.isExtensionDevelopment&&i.quality!=="stable"||this._envEnabledExtensions.size===0&&Array.isArray(t.extensionEnabledProposedApi),this._productEnabledExtensions=new Map,i.extensionEnabledApiProposals)for(const[n,s]of Object.entries(i.extensionEnabledApiProposals)){const o=fn.toKey(n),a=s.filter(c=>am[c]?!0:(e.warn(`Via 'product.json#extensionEnabledApiProposals' extension '${o}' wants API proposal '${c}' but that proposal DOES NOT EXIST. Likely, the proposal has been finalized (check 'vscode.d.ts') or was abandoned.`),!1));this._productEnabledExtensions.set(o,a)}}updateEnabledApiProposals(e){for(const t of e)this.doUpdateEnabledApiProposals(t)}doUpdateEnabledApiProposals(e){var n;const t=e,i=fn.toKey(e.identifier);if(Pr(t.enabledApiProposals)&&(t.enabledApiProposals=t.enabledApiProposals.filter(s=>{const o=!!am[s];return o||this._logService.error(`Extension '${i}' wants API proposal '${s}' but that proposal DOES NOT EXIST. Likely, the proposal has been finalized (check 'vscode.d.ts') or was abandoned.`),o})),this._productEnabledExtensions.has(i)){const s=this._productEnabledExtensions.get(i),o=new Set(s),a=new Set(t.enabledApiProposals),c=new Set([...a].filter(d=>!o.has(d)));c.size>0&&(this._logService.error(`Extension '${i}' appears in product.json but enables LESS API proposals than the extension wants.
package.json (LOSES): ${[...a].join(", ")}
product.json (WINS): ${[...o].join(", ")}`),this._environmentService.isExtensionDevelopment&&(this._logService.error(`Proceeding with EXTRA proposals (${[...c].join(", ")}) because extension is in development mode. Still, this EXTENSION WILL BE BROKEN unless product.json is updated.`),s.push(...c))),t.enabledApiProposals=s;return}this._envEnablesProposedApiForAll||this._envEnabledExtensions.has(i)||!t.isBuiltin&&Pr(t.enabledApiProposals)&&(this._logService.error(`Extension '${t.identifier.value} CANNOT USE these API proposals '${((n=t.enabledApiProposals)==null?void 0:n.join(", "))||"*"}'. You MUST start in extension development mode or use the --enable-proposed-api command line flag`),t.enabledApiProposals=[])}};W0=T([v(0,ze),v(1,Ar),v(2,Rs)],W0);async function The(r,e){if(!crypto.subtle)throw new Error("'crypto.subtle' is not available so webviews will not work. This is likely because the editor is not running in a secure context (https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts).");const t=JSON.stringify({parentOrigin:r,salt:e}),n=new TextEncoder().encode(t),s=await crypto.subtle.digest("sha-256",n);return Ihe(s)}function Ihe(r){const t=Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("");return BigInt(`0x${t}`).toString(32).padStart(52,"0")}let sx=class extends ne{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g){super(),this.runningLocation=e,this.startup=t,this._initDataProvider=i,this._telemetryService=n,this._contextService=s,this._labelService=o,this._logService=a,this._loggerService=c,this._environmentService=d,this._userDataProfilesService=l,this._productService=u,this._layoutService=h,this._storageService=g,this.remoteAuthority=null,this.extensions=new FT,this._onDidExit=this._register(new A),this.onExit=this._onDidExit.event,this._isTerminating=!1,this._protocolPromise=null,this._protocol=null,this._extensionHostLogsLocation=pt(this._environmentService.extHostLogsPath,"webWorker")}async _getWebWorkerExtensionHostIframeSrc(){const e=new URLSearchParams;this._environmentService.debugExtensionHost&&this._environmentService.debugRenderer&&e.set("debugged","1"),EY.addSearchParam(e,!0,!0);const t=`?${e.toString()}`,i="vs/workbench/services/extensions/worker/webWorkerExtensionHostIframe.html";if(ln){const s=this._productService.webEndpointUrlTemplate,o=this._productService.commit,a=this._productService.quality;if(s&&o&&a){const c="webWorkerExtensionHostIframeStableOriginUUID";let d=this._storageService.get(c,1);typeof d>"u"&&(d=Nn(),this._storageService.store(c,d,1,1));const l=await The(window.origin,d),u=s.replace("{{uuid}}",`v--${l}`).replace("{{commit}}",o).replace("{{quality}}",a),h=new URL(`${u}/out/${i}${t}`);return h.searchParams.set("parentOrigin",window.origin),h.searchParams.set("salt",d),h.toString()}}return`${wh.asBrowserUri(i).toString(!0)}${t}`}async start(){return this._protocolPromise||(this._protocolPromise=this._startInsideIframe(),this._protocolPromise.then(e=>this._protocol=e)),this._protocolPromise}async _startInsideIframe(){var m;const e=await this._getWebWorkerExtensionHostIframeSrc(),t=this._register(new A),i=document.createElement("iframe");i.setAttribute("class","web-worker-ext-host-iframe"),i.setAttribute("sandbox","allow-scripts allow-same-origin"),i.setAttribute("allow","usb; serial; hid; cross-origin-isolated;"),i.setAttribute("aria-hidden","true"),i.style.display="none";const n=Nn();i.setAttribute("src",`${e}&vscodeWebWorkerExtHostId=${n}`);const s=new Cs;let o,a=null,c=!1,d=null;const l=(y,_)=>{a=_,c=!0,en(a),clearTimeout(d),this._onDidExit.fire([81,a.message]),s.open()},u=y=>{o=y,clearTimeout(d),s.open()};if(d=setTimeout(()=>{console.warn("The Web Worker Extension Host did not start in 60s, that might be a problem.")},6e4),this._register(Ci(window,"message",y=>{if(y.source!==i.contentWindow||y.data.vscodeWebWorkerExtHostId!==n)return;if(y.data.error){const{name:b,message:E,stack:D}=y.data.error,R=new Error;return R.message=E,R.name=b,R.stack=D,l(81,R)}const{data:_}=y.data;if(s.isOpen()||!(_ instanceof MessagePort)){console.warn("UNEXPECTED message",y);const b=new Error("UNEXPECTED message");return l(81,b)}u(_)})),this._layoutService.container.appendChild(i),this._register(ot(()=>i.remove())),await s.wait(),c)throw a;const h=((m=this._environmentService.options)==null?void 0:m.messagePorts)??new Map;i.contentWindow.postMessage({type:"vscode.init",data:h},"*",[...h.values()]),o.onmessage=y=>{const{data:_}=y;if(!(_ instanceof ArrayBuffer)){console.warn("UNKNOWN data received",_),this._onDidExit.fire([77,"UNKNOWN data received"]);return}t.fire(De.wrap(new Uint8Array(_,0,_.byteLength)))};const g={onMessage:t.event,send:y=>{const _=y.buffer.buffer.slice(y.buffer.byteOffset,y.buffer.byteOffset+y.buffer.byteLength);o.postMessage(_,[_])}};return this._performHandshake(g)}async _performHandshake(e){if(await F.toPromise(F.filter(e.onMessage,t=>fE(t,1))),this._isTerminating)throw Ll();if(e.send(De.fromString(JSON.stringify(await this._createExtHostInitData()))),this._isTerminating)throw Ll();if(await F.toPromise(F.filter(e.onMessage,t=>fE(t,0))),this._isTerminating)throw Ll();return e}dispose(){var e;this._isTerminating||(this._isTerminating=!0,(e=this._protocol)==null||e.send(bz(2)),super.dispose())}getInspectPort(){}enableInspectPort(){return Promise.resolve(!1)}async _createExtHostInitData(){var o;const e=await this._initDataProvider.getInitData(),t=this._contextService.getWorkspace(),i=this.extensions.set(e.allExtensions,e.myExtensions),n=(o=this._productService.extensionsGallery)==null?void 0:o.nlsBaseUrl;let s;return n&&this._productService.commit&&!wC.isDefaultVariant()&&(s=k.joinPath(k.parse(n),this._productService.commit,this._productService.version,wC.value())),{commit:this._productService.commit,version:this._productService.version,quality:this._productService.quality,parentPid:0,environment:{isExtensionDevelopmentDebug:this._environmentService.debugRenderer,appName:this._productService.nameLong,appHost:this._productService.embedderIdentifier??(ln?"web":"desktop"),appUriScheme:this._productService.urlProtocol,appLanguage:Ig,extensionTelemetryLogResource:this._environmentService.extHostTelemetryLogFile,isExtensionTelemetryLoggingOnly:M1(this._productService,this._environmentService),extensionDevelopmentLocationURI:this._environmentService.extensionDevelopmentLocationURI,extensionTestsLocationURI:this._environmentService.extensionTestsLocationURI,globalStorageHome:this._userDataProfilesService.defaultProfile.globalStorageHome,workspaceStorageHome:this._environmentService.workspaceStorageHome,extensionLogLevel:this._environmentService.extensionLogLevel},workspace:this._contextService.getWorkbenchState()===1?void 0:{configuration:t.configuration||void 0,id:t.id,name:this._labelService.getWorkspaceLabel(t),transient:t.transient},consoleForward:{includeStack:!1,logNative:this._environmentService.debugRenderer},allExtensions:i.toAdd,activationEvents:i.addActivationEvents,myExtensions:i.myToAdd,nlsBaseUrl:s,telemetryInfo:{sessionId:this._telemetryService.sessionId,machineId:this._telemetryService.machineId,firstSessionDate:this._telemetryService.firstSessionDate,msftInternal:this._telemetryService.msftInternal},logLevel:this._logService.getLevel(),loggers:[...this._loggerService.getRegisteredLoggers()],logsLocation:this._extensionHostLogsLocation,autoStart:this.startup===1,remote:{authority:this._environmentService.remoteAuthority,connectionData:null,isRemote:!1},uiKind:ln?Yo.Web:Yo.Desktop}}};sx=T([v(3,gi),v(4,oi),v(5,Qi),v(6,ze),v(7,Is),v(8,Cu),v(9,Pf),v(10,Rs),v(11,uk),v(12,ri)],sx);var H0;(function(r){r.enableDiagnostics=!1,r.records=[];const e=new WeakMap;let t=0;function i(s,o){if(!e.has(s)){const a=String(++t);e.set(s,a)}return e.get(s)}function n(s,o,a,c){if(!r.enableDiagnostics)return;const d=i(s);if(c instanceof De||c instanceof Uint8Array||c instanceof ArrayBuffer||ArrayBuffer.isView(c)){const l=De.alloc(c.byteLength);l.set(c),r.records.push({timestamp:Date.now(),id:d,label:o,type:a,buff:l})}else r.records.push({timestamp:Date.now(),id:d,label:o,type:a,data:c})}r.traceSocketEvent=n})(H0||(H0={}));let GR=null;function Jd(){return GR||(GR=De.alloc(0)),GR}class Rhe{get byteLength(){return this._totalLength}constructor(){this._chunks=[],this._totalLength=0}acceptChunk(e){this._chunks.push(e),this._totalLength+=e.byteLength}read(e){return this._read(e,!0)}peek(e){return this._read(e,!1)}_read(e,t){if(e===0)return Jd();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const o=this._chunks[0];return t&&(this._chunks.shift(),this._totalLength-=e),o}if(this._chunks[0].byteLength>e){const o=this._chunks[0].slice(0,e);return t&&(this._chunks[0]=this._chunks[0].slice(e),this._totalLength-=e),o}const i=De.alloc(e);let n=0,s=0;for(;e>0;){const o=this._chunks[s];if(o.byteLength>e){const a=o.slice(0,e);i.set(a,n),n+=e,t&&(this._chunks[s]=o.slice(e),this._totalLength-=e),e-=e}else i.set(o,n),n+=o.byteLength,t?(this._chunks.shift(),this._totalLength-=o.byteLength):s++,e-=o.byteLength}return i}}function h5(r){switch(r){case 0:return"None";case 1:return"Regular";case 2:return"Control";case 3:return"Ack";case 5:return"Disconnect";case 6:return"ReplayRequest";case 7:return"PauseWriting";case 8:return"ResumeWriting";case 9:return"KeepAlive"}}class Ya{constructor(e,t,i,n){this.type=e,this.id=t,this.ack=i,this.data=n,this.writtenTime=0}get size(){return this.data.byteLength}}class jB extends ne{constructor(e){super(),this._onMessage=this._register(new A),this.onMessage=this._onMessage.event,this._state={readHead:!0,readLen:13,messageType:0,id:0,ack:0},this._socket=e,this._isDisposed=!1,this._incomingData=new Rhe,this._register(this._socket.onData(t=>this.acceptChunk(t))),this.lastReadTime=Date.now()}acceptChunk(e){if(!(!e||e.byteLength===0))for(this.lastReadTime=Date.now(),this._incomingData.acceptChunk(e);this._incomingData.byteLength>=this._state.readLen;){const t=this._incomingData.read(this._state.readLen);if(this._state.readHead)this._state.readHead=!1,this._state.readLen=t.readUInt32BE(9),this._state.messageType=t.readUInt8(0),this._state.id=t.readUInt32BE(1),this._state.ack=t.readUInt32BE(5),this._socket.traceSocketEvent("protocolHeaderRead",{messageType:h5(this._state.messageType),id:this._state.id,ack:this._state.ack,messageSize:this._state.readLen});else{const i=this._state.messageType,n=this._state.id,s=this._state.ack;if(this._state.readHead=!0,this._state.readLen=13,this._state.messageType=0,this._state.id=0,this._state.ack=0,this._socket.traceSocketEvent("protocolMessageRead",t),this._onMessage.fire(new Ya(i,n,s,t)),this._isDisposed)break}}}readEntireBuffer(){return this._incomingData.read(this._incomingData.byteLength)}dispose(){this._isDisposed=!0,super.dispose()}}class BB{constructor(e){this._writeNowTimeout=null,this._isDisposed=!1,this._isPaused=!1,this._socket=e,this._data=[],this._totalLength=0,this.lastWriteTime=0}dispose(){try{this.flush()}catch{}this._isDisposed=!0}drain(){return this.flush(),this._socket.drain()}flush(){this._writeNow()}pause(){this._isPaused=!0}resume(){this._isPaused=!1,this._scheduleWriting()}write(e){if(this._isDisposed)return;e.writtenTime=Date.now(),this.lastWriteTime=Date.now();const t=De.alloc(13);t.writeUInt8(e.type,0),t.writeUInt32BE(e.id,1),t.writeUInt32BE(e.ack,5),t.writeUInt32BE(e.data.byteLength,9),this._socket.traceSocketEvent("protocolHeaderWrite",{messageType:h5(e.type),id:e.id,ack:e.ack,messageSize:e.data.byteLength}),this._socket.traceSocketEvent("protocolMessageWrite",e.data),this._writeSoon(t,e.data)}_bufferAdd(e,t){const i=this._totalLength===0;return this._data.push(e,t),this._totalLength+=e.byteLength+t.byteLength,i}_bufferTake(){const e=De.concat(this._data,this._totalLength);return this._data.length=0,this._totalLength=0,e}_writeSoon(e,t){this._bufferAdd(e,t)&&this._scheduleWriting()}_scheduleWriting(){this._writeNowTimeout||(this._writeNowTimeout=setTimeout(()=>{this._writeNowTimeout=null,this._writeNow()}))}_writeNow(){if(this._totalLength===0||this._isPaused)return;const e=this._bufferTake();this._socket.traceSocketEvent("protocolWrite",{byteLength:e.byteLength}),this._socket.write(e)}}class Zu{constructor(){this._hasListeners=!1,this._isDeliveringMessages=!1,this._bufferedMessages=[],this._emitter=new A({onWillAddFirstListener:()=>{this._hasListeners=!0,queueMicrotask(()=>this._deliverMessages())},onDidRemoveLastListener:()=>{this._hasListeners=!1}}),this.event=this._emitter.event}_deliverMessages(){if(!this._isDeliveringMessages){for(this._isDeliveringMessages=!0;this._hasListeners&&this._bufferedMessages.length>0;)this._emitter.fire(this._bufferedMessages.shift());this._isDeliveringMessages=!1}}fire(e){this._hasListeners?this._bufferedMessages.length>0?this._bufferedMessages.push(e):this._emitter.fire(e):this._bufferedMessages.push(e)}flushBuffer(){this._bufferedMessages=[]}}class Phe{constructor(e){this.data=e,this.next=null}}class Ahe{constructor(){this._first=null,this._last=null}length(){let e=0,t=this._first;for(;t;)t=t.next,e++;return e}peek(){return this._first?this._first.data:null}toArray(){const e=[];let t=0,i=this._first;for(;i;)e[t++]=i.data,i=i.next;return e}pop(){if(this._first){if(this._first===this._last){this._first=null,this._last=null;return}this._first=this._first.next}}push(e){const t=new Phe(e);if(!this._first){this._first=t,this._last=t;return}this._last.next=t,this._last=t}}const Oo=class Oo{static getInstance(){return Oo._INSTANCE||(Oo._INSTANCE=new Oo),Oo._INSTANCE}constructor(){this.lastRuns=[];const e=Date.now();for(let t=0;t<Oo._HISTORY_LENGTH;t++)this.lastRuns[t]=e-1e3*t;setInterval(()=>{for(let t=Oo._HISTORY_LENGTH;t>=1;t--)this.lastRuns[t]=this.lastRuns[t-1];this.lastRuns[0]=Date.now()},1e3)}load(){const e=Date.now(),t=(1+Oo._HISTORY_LENGTH)*1e3;let i=0;for(let n=0;n<Oo._HISTORY_LENGTH;n++)e-this.lastRuns[n]<=t&&i++;return 1-i/Oo._HISTORY_LENGTH}hasHighLoad(){return this.load()>=.5}};mi(Oo,"_HISTORY_LENGTH",10);let ox=Oo;ox._INSTANCE=null;class Mhe{get unacknowledgedCount(){return this._outgoingMsgId-this._outgoingAckId}constructor(e){this._onControlMessage=new Zu,this.onControlMessage=this._onControlMessage.event,this._onMessage=new Zu,this.onMessage=this._onMessage.event,this._onDidDispose=new Zu,this.onDidDispose=this._onDidDispose.event,this._onSocketClose=new Zu,this.onSocketClose=this._onSocketClose.event,this._onSocketTimeout=new Zu,this.onSocketTimeout=this._onSocketTimeout.event,this._loadEstimator=e.loadEstimator??ox.getInstance(),this._shouldSendKeepAlive=e.sendKeepAlive??!0,this._isReconnecting=!1,this._outgoingUnackMsg=new Ahe,this._outgoingMsgId=0,this._outgoingAckId=0,this._outgoingAckTimeout=null,this._incomingMsgId=0,this._incomingAckId=0,this._incomingMsgLastTime=0,this._incomingAckTimeout=null,this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socketDisposables=new me,this._socket=e.socket,this._socketWriter=this._socketDisposables.add(new BB(this._socket)),this._socketReader=this._socketDisposables.add(new jB(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(t=>this._receiveMessage(t))),this._socketDisposables.add(this._socket.onClose(t=>this._onSocketClose.fire(t))),e.initialChunk&&this._socketReader.acceptChunk(e.initialChunk),this._shouldSendKeepAlive?this._keepAliveInterval=setInterval(()=>{this._sendKeepAlive()},5e3):this._keepAliveInterval=null}dispose(){this._outgoingAckTimeout&&(clearTimeout(this._outgoingAckTimeout),this._outgoingAckTimeout=null),this._incomingAckTimeout&&(clearTimeout(this._incomingAckTimeout),this._incomingAckTimeout=null),this._keepAliveInterval&&(clearInterval(this._keepAliveInterval),this._keepAliveInterval=null),this._socketDisposables.dispose()}drain(){return this._socketWriter.drain()}sendDisconnect(){const e=new Ya(5,0,0,Jd());this._socketWriter.write(e),this._socketWriter.flush()}sendPause(){const e=new Ya(7,0,0,Jd());this._socketWriter.write(e)}sendResume(){const e=new Ya(8,0,0,Jd());this._socketWriter.write(e)}pauseSocketWriting(){this._socketWriter.pause()}getSocket(){return this._socket}getMillisSinceLastIncomingData(){return Date.now()-this._socketReader.lastReadTime}beginAcceptReconnection(e,t){this._isReconnecting=!0,this._socketDisposables.dispose(),this._socketDisposables=new me,this._onControlMessage.flushBuffer(),this._onSocketClose.flushBuffer(),this._onSocketTimeout.flushBuffer(),this._socket.dispose(),this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socket=e,this._socketWriter=this._socketDisposables.add(new BB(this._socket)),this._socketReader=this._socketDisposables.add(new jB(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(i=>this._receiveMessage(i))),this._socketDisposables.add(this._socket.onClose(i=>this._onSocketClose.fire(i))),this._socketReader.acceptChunk(t)}endAcceptReconnection(){this._isReconnecting=!1,this._incomingAckId=this._incomingMsgId;const e=new Ya(3,0,this._incomingAckId,Jd());this._socketWriter.write(e);const t=this._outgoingUnackMsg.toArray();for(let i=0,n=t.length;i<n;i++)this._socketWriter.write(t[i]);this._recvAckCheck()}acceptDisconnect(){this._onDidDispose.fire()}_receiveMessage(e){if(e.ack>this._outgoingAckId){this._outgoingAckId=e.ack;do{const t=this._outgoingUnackMsg.peek();if(t&&t.id<=e.ack)this._outgoingUnackMsg.pop();else break}while(!0)}switch(e.type){case 0:break;case 1:{if(e.id>this._incomingMsgId)if(e.id!==this._incomingMsgId+1){const t=Date.now();t-this._lastReplayRequestTime>1e4&&(this._lastReplayRequestTime=t,this._socketWriter.write(new Ya(6,0,0,Jd())))}else this._incomingMsgId=e.id,this._incomingMsgLastTime=Date.now(),this._sendAckCheck(),this._onMessage.fire(e.data);break}case 2:{this._onControlMessage.fire(e.data);break}case 3:break;case 5:{this._onDidDispose.fire();break}case 6:{const t=this._outgoingUnackMsg.toArray();for(let i=0,n=t.length;i<n;i++)this._socketWriter.write(t[i]);this._recvAckCheck();break}case 7:{this._socketWriter.pause();break}case 8:{this._socketWriter.resume();break}}}readEntireBuffer(){return this._socketReader.readEntireBuffer()}flush(){this._socketWriter.flush()}send(e){const t=++this._outgoingMsgId;this._incomingAckId=this._incomingMsgId;const i=new Ya(1,t,this._incomingAckId,e);this._outgoingUnackMsg.push(i),this._isReconnecting||(this._socketWriter.write(i),this._recvAckCheck())}sendControl(e){const t=new Ya(2,0,0,e);this._socketWriter.write(t)}_sendAckCheck(){if(this._incomingMsgId<=this._incomingAckId||this._incomingAckTimeout)return;const e=Date.now()-this._incomingMsgLastTime;if(e>=2e3){this._sendAck();return}this._incomingAckTimeout=setTimeout(()=>{this._incomingAckTimeout=null,this._sendAckCheck()},2e3-e+5)}_recvAckCheck(){if(this._outgoingMsgId<=this._outgoingAckId||this._outgoingAckTimeout||this._isReconnecting)return;const e=this._outgoingUnackMsg.peek(),t=Date.now()-e.writtenTime,i=Date.now()-this._socketReader.lastReadTime,n=Date.now()-this._lastSocketTimeoutTime;if(t>=2e4&&i>=2e4&&n>=2e4&&!this._loadEstimator.hasHighLoad()){this._lastSocketTimeoutTime=Date.now(),this._onSocketTimeout.fire({unacknowledgedMsgCount:this._outgoingUnackMsg.length(),timeSinceOldestUnacknowledgedMsg:t,timeSinceLastReceivedSomeData:i});return}const s=Math.max(2e4-t,2e4-i,2e4-n,500);this._outgoingAckTimeout=setTimeout(()=>{this._outgoingAckTimeout=null,this._recvAckCheck()},s)}_sendAck(){if(this._incomingMsgId<=this._incomingAckId)return;this._incomingAckId=this._incomingMsgId;const e=new Ya(3,0,this._incomingAckId,Jd());this._socketWriter.write(e)}_sendKeepAlive(){this._incomingAckId=this._incomingMsgId;const e=new Ya(9,0,this._incomingAckId,Jd());this._socketWriter.write(e)}}const Lhe=30*1e3;function j0(r){switch(r){case 1:return"Management";case 2:return"ExtensionHost";case 3:return"Tunnel"}}function f5(r){const e=new Xt;return setTimeout(()=>e.cancel(),r),e.token}function Fhe(r,e){if(r.isCancellationRequested||e.isCancellationRequested)return _t.Cancelled;const t=new Xt;return r.onCancellationRequested(()=>t.cancel()),e.onCancellationRequested(()=>t.cancel()),t.token}class qT{get didTimeout(){return this._state==="timedout"}constructor(e){this._state="pending",this._disposables=new me,this.promise=new Promise((t,i)=>{this._resolvePromise=t,this._rejectPromise=i}),e.isCancellationRequested?this._timeout():this._disposables.add(e.onCancellationRequested(()=>this._timeout()))}registerDisposable(e){this._state==="pending"?this._disposables.add(e):e.dispose()}_timeout(){this._state==="pending"&&(this._disposables.dispose(),this._state="timedout",this._rejectPromise(this._createTimeoutError()))}_createTimeoutError(){const e=new Error("Time limit reached");return e.code="ETIMEDOUT",e.syscall="connect",e}resolve(e){this._state==="pending"&&(this._disposables.dispose(),this._state="resolved",this._resolvePromise(e))}reject(e){this._state==="pending"&&(this._disposables.dispose(),this._state="rejected",this._rejectPromise(e))}}function Ohe(r,e){const t=new qT(e);return t.registerDisposable(r.onControlMessage(i=>{const n=JSON.parse(i.toString()),s=m5(n);s?t.reject(s):t.resolve(n)})),t.promise}function Nhe(r,e,t,i,n,s,o,a){const c=new qT(a),d=Tr.create(!1);return r.info(`Creating a socket (${o})...`),qt(`code/willCreateSocket/${s}`),e.connect(t,i,n,o).then(l=>{c.didTimeout?(qt(`code/didCreateSocketError/${s}`),r.info(`Creating a socket (${o}) finished after ${d.elapsed()} ms, but this is too late and has timed out already.`),l==null||l.dispose()):(qt(`code/didCreateSocketOK/${s}`),r.info(`Creating a socket (${o}) was successful after ${d.elapsed()} ms.`),c.resolve(l))},l=>{qt(`code/didCreateSocketError/${s}`),r.info(`Creating a socket (${o}) returned an error after ${d.elapsed()} ms.`),r.error(l),c.reject(l)}),c.promise}function zR(r,e){const t=new qT(e);return r.then(i=>{t.didTimeout||t.resolve(i)},i=>{t.didTimeout||t.reject(i)}),t.promise}async function $he(r,e,t,i){const n=v5(r,e);r.logService.trace(`${n} 1/6. invoking socketFactory.connect().`);let s;try{s=await Nhe(r.logService,r.remoteSocketFactoryService,r.connectTo,xq(r),`reconnectionToken=${r.reconnectionToken}&reconnection=${r.reconnectionProtocol?"true":"false"}`,j0(e),`renderer-${j0(e)}-${r.reconnectionToken}`,i)}catch(l){throw r.logService.error(`${n} socketFactory.connect() failed or timed out. Error:`),r.logService.error(l),l}r.logService.trace(`${n} 2/6. socketFactory.connect() was successful.`);let o,a;r.reconnectionProtocol?(r.reconnectionProtocol.beginAcceptReconnection(s,null),o=r.reconnectionProtocol,a=!1):(o=new Mhe({socket:s}),a=!0),r.logService.trace(`${n} 3/6. sending AuthRequest control message.`);const c=await zR(r.signService.createNewMessage(Nn()),i),d={type:"auth",auth:r.connectionToken||"00000000000000000000",data:c.data};o.sendControl(De.fromString(JSON.stringify(d)));try{const l=await Ohe(o,Fhe(i,f5(1e4)));if(l.type!=="sign"||typeof l.data!="string"){const m=new Error("Unexpected handshake message");throw m.code="VSCODE_CONNECTION_ERROR",m}if(r.logService.trace(`${n} 4/6. received SignRequest control message.`),!await zR(r.signService.validate(c,l.signedData),i)){const m=new Error("Refused to connect to unsupported server");throw m.code="VSCODE_CONNECTION_ERROR",m}const h=await zR(r.signService.sign(l.data),i),g={type:"connectionType",commit:r.commit,signedData:h,desiredConnectionType:e};return t&&(g.args=t),r.logService.trace(`${n} 5/6. sending ConnectionTypeRequest control message.`),o.sendControl(De.fromString(JSON.stringify(g))),{protocol:o,ownsProtocol:a}}catch(l){throw l&&l.code==="ETIMEDOUT"&&(r.logService.error(`${n} the handshake timed out. Error:`),r.logService.error(l)),l&&l.code==="VSCODE_CONNECTION_ERROR"&&(r.logService.error(`${n} received error control message when negotiating connection. Error:`),r.logService.error(l)),a&&M$(o),l}}async function Whe(r,e,t,i){const n=Date.now(),s=v5(r,e),{protocol:o,ownsProtocol:a}=await $he(r,e,t,i),c=new qT(i);return c.registerDisposable(o.onControlMessage(d=>{var h;const l=JSON.parse(d.toString()),u=m5(l);u?(r.logService.error(`${s} received error control message when negotiating connection. Error:`),r.logService.error(u),a&&M$(o),c.reject(u)):((h=r.reconnectionProtocol)==null||h.endAcceptReconnection(),r.logService.trace(`${s} 6/6. handshake finished, connection is up and running after ${Yhe(n)}!`),c.resolve({protocol:o,firstMessage:l}))})),c.promise}async function p5(r,e,t){const{protocol:i,firstMessage:n}=await Whe(r,2,e,t),s=n&&n.debugPort;return{protocol:i,debugPort:s}}async function g5(r,e,t){const{connectTo:i,connectionToken:n}=await r.addressProvider.getAddress();return{commit:r.commit,quality:r.quality,connectTo:i,connectionToken:n,reconnectionToken:e,reconnectionProtocol:t,remoteSocketFactoryService:r.remoteSocketFactoryService,signService:r.signService,logService:r.logService}}async function Hhe(r,e){return jhe(r,async t=>{const{protocol:i,debugPort:n}=await p5(t,e,_t.None);return new zhe(r,e,t.reconnectionToken,i,n)})}async function jhe(r,e){for(let i=1;;i++)try{const n=Nn(),s=await g5(r,n,null);return await e(s)}catch(n){if(i<5)r.logService.error(`[remote-connection][attempt ${i}] An error occurred in initial connection! Will retry... Error:`),r.logService.error(n);else throw r.logService.error(`[remote-connection][attempt ${i}]  An error occurred in initial connection! It will be treated as a permanent error. Error:`),r.logService.error(n),Zr.triggerPermanentFailure(0,0,Eh.isHandled(n)),n}}function Bhe(r){return cd(e=>new Promise((t,i)=>{const n=setTimeout(t,r*1e3);e.onCancellationRequested(()=>{clearTimeout(n),t()})}))}class Uhe{constructor(e,t){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.type=0}}class Vhe{constructor(e,t,i,n){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.durationSeconds=i,this.cancellableTimer=n,this.type=1}skipWait(){this.cancellableTimer.cancel()}}class qhe{constructor(e,t,i){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.type=2}}class UB{constructor(e,t,i){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.type=4}}class Ghe{constructor(e,t,i,n){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.handled=n,this.type=3}}class Zr extends ne{static triggerPermanentFailure(e,t,i){this._permanentFailure=!0,this._permanentFailureMillisSinceLastIncomingData=e,this._permanentFailureAttempt=t,this._permanentFailureHandled=i,this._instances.forEach(n=>n._gotoPermanentFailure(this._permanentFailureMillisSinceLastIncomingData,this._permanentFailureAttempt,this._permanentFailureHandled))}static debugTriggerReconnection(){this._instances.forEach(e=>e._beginReconnecting())}static debugPauseSocketWriting(){this._instances.forEach(e=>e._pauseSocketWriting())}get _isPermanentFailure(){return this._permanentFailure||Zr._permanentFailure}constructor(e,t,i,n,s){super(),this._connectionType=e,this._options=t,this.reconnectionToken=i,this.protocol=n,this._reconnectionFailureIsFatal=s,this._onDidStateChange=this._register(new A),this.onDidStateChange=this._onDidStateChange.event,this._permanentFailure=!1,this._isReconnecting=!1,this._isDisposed=!1,this._onDidStateChange.fire(new UB(this.reconnectionToken,0,0)),this._register(n.onSocketClose(o=>{const a=LS(this._connectionType,this.reconnectionToken,!0);o?o.type===0?(this._options.logService.info(`${a} received socket close event (hadError: ${o.hadError}).`),o.error&&this._options.logService.error(o.error)):(this._options.logService.info(`${a} received socket close event (wasClean: ${o.wasClean}, code: ${o.code}, reason: ${o.reason}).`),o.event&&this._options.logService.error(o.event)):this._options.logService.info(`${a} received socket close event.`),this._beginReconnecting()})),this._register(n.onSocketTimeout(o=>{const a=LS(this._connectionType,this.reconnectionToken,!0);this._options.logService.info(`${a} received socket timeout event (unacknowledgedMsgCount: ${o.unacknowledgedMsgCount}, timeSinceOldestUnacknowledgedMsg: ${o.timeSinceOldestUnacknowledgedMsg}, timeSinceLastReceivedSomeData: ${o.timeSinceLastReceivedSomeData}).`),this._beginReconnecting()})),Zr._instances.push(this),this._register(ot(()=>{const o=Zr._instances.indexOf(this);o>=0&&Zr._instances.splice(o,1)})),this._isPermanentFailure&&this._gotoPermanentFailure(Zr._permanentFailureMillisSinceLastIncomingData,Zr._permanentFailureAttempt,Zr._permanentFailureHandled)}dispose(){super.dispose(),this._isDisposed=!0}async _beginReconnecting(){if(!this._isReconnecting)try{this._isReconnecting=!0,await this._runReconnectingLoop()}finally{this._isReconnecting=!1}}async _runReconnectingLoop(){if(this._isPermanentFailure||this._isDisposed)return;const e=LS(this._connectionType,this.reconnectionToken,!0);this._options.logService.info(`${e} starting reconnecting loop. You can get more information with the trace log level.`),this._onDidStateChange.fire(new Uhe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData()));const t=[0,5,5,10,10,10,10,10,30];let i=-1;do{i++;const n=i<t.length?t[i]:t[t.length-1];try{if(n>0){const o=Bhe(n);this._onDidStateChange.fire(new Vhe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),n,o)),this._options.logService.info(`${e} waiting for ${n} seconds before reconnecting...`);try{await o}catch{}}if(this._isPermanentFailure){this._options.logService.error(`${e} permanent failure occurred while running the reconnecting loop.`);break}this._onDidStateChange.fire(new qhe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),i+1)),this._options.logService.info(`${e} resolving connection...`);const s=await g5(this._options,this.reconnectionToken,this.protocol);this._options.logService.info(`${e} connecting to ${s.connectTo}...`),await this._reconnect(s,f5(Lhe)),this._options.logService.info(`${e} reconnected!`),this._onDidStateChange.fire(new UB(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),i+1));break}catch(s){if(s.code==="VSCODE_CONNECTION_ERROR"){this._options.logService.error(`${e} A permanent error occurred in the reconnecting loop! Will give up now! Error:`),this._options.logService.error(s),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}if(i>360){this._options.logService.error(`${e} An error occurred while reconnecting, but it will be treated as a permanent error because the reconnection grace time has expired! Will give up now! Error:`),this._options.logService.error(s),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}if(Eh.isTemporarilyNotAvailable(s)){this._options.logService.info(`${e} A temporarily not available error occurred while trying to reconnect, will try again...`),this._options.logService.trace(s);continue}if((s.code==="ETIMEDOUT"||s.code==="ENETUNREACH"||s.code==="ECONNREFUSED"||s.code==="ECONNRESET")&&s.syscall==="connect"){this._options.logService.info(`${e} A network error occurred while trying to reconnect, will try again...`),this._options.logService.trace(s);continue}if(Ur(s)){this._options.logService.info(`${e} A promise cancelation error occurred while trying to reconnect, will try again...`),this._options.logService.trace(s);continue}if(s instanceof Eh){this._options.logService.error(`${e} A RemoteAuthorityResolverError occurred while trying to reconnect. Will give up now! Error:`),this._options.logService.error(s),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,Eh.isHandled(s));break}this._options.logService.error(`${e} An unknown error occurred while trying to reconnect, since this is an unknown case, it will be treated as a permanent error! Will give up now! Error:`),this._options.logService.error(s),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}}while(!this._isPermanentFailure&&!this._isDisposed)}_onReconnectionPermanentFailure(e,t,i){this._reconnectionFailureIsFatal?Zr.triggerPermanentFailure(e,t,i):this._gotoPermanentFailure(e,t,i)}_gotoPermanentFailure(e,t,i){this._onDidStateChange.fire(new Ghe(this.reconnectionToken,e,t,i)),M$(this.protocol)}_pauseSocketWriting(){this.protocol.pauseSocketWriting()}}Zr._permanentFailure=!1;Zr._permanentFailureMillisSinceLastIncomingData=0;Zr._permanentFailureAttempt=0;Zr._permanentFailureHandled=!1;Zr._instances=[];class zhe extends Zr{constructor(e,t,i,n,s){super(2,e,i,n,!1),this._startArguments=t,this.debugPort=s}async _reconnect(e,t){await p5(e,this._startArguments,t)}}function M$(r){try{r.acceptDisconnect();const e=r.getSocket();r.dispose(),e.dispose()}catch(e){en(e)}}function m5(r){if(r&&r.type==="error"){const e=new Error(`Connection error: ${r.reason}`);return e.code="VSCODE_CONNECTION_ERROR",e}return null}function Khe(r,e){for(;r.length<e;)r+=" ";return r}function Qhe(r,e){return`[remote-connection][${Khe(j0(r),13)}][${e.substr(0,5)}…]`}function LS(r,e,t){return`${Qhe(r,e)}[${t?"reconnect":"initial"}]`}function v5(r,e){return`${LS(e,r.reconnectionToken,!!r.reconnectionProtocol)}[${r.connectTo}]`}function Yhe(r){return`${Date.now()-r} ms`}const Xhe="signService",Jhe=re(Xhe);let B0=class extends ne{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g){super(),this.runningLocation=e,this._initDataProvider=t,this.remoteSocketFactoryService=i,this._contextService=n,this._environmentService=s,this._telemetryService=o,this._logService=a,this._loggerService=c,this._labelService=d,this.remoteAuthorityResolverService=l,this._extensionHostDebugService=u,this._productService=h,this._signService=g,this.startup=1,this.extensions=new FT,this._onExit=this._register(new A),this.onExit=this._onExit.event,this.remoteAuthority=this._initDataProvider.remoteAuthority,this._protocol=null,this._hasLostConnection=!1,this._terminating=!1;const m=P$(this._environmentService);this._isExtensionDevHost=m.isExtensionDevHost}start(){const e={commit:this._productService.commit,quality:this._productService.quality,addressProvider:{getAddress:async()=>{const{authority:t}=await this.remoteAuthorityResolverService.resolveAuthority(this._initDataProvider.remoteAuthority);return{connectTo:t.connectTo,connectionToken:t.connectionToken}}},remoteSocketFactoryService:this.remoteSocketFactoryService,signService:this._signService,logService:this._logService,ipcLogger:null};return this.remoteAuthorityResolverService.resolveAuthority(this._initDataProvider.remoteAuthority).then(t=>{var o;const i={language:Ig,debugId:this._environmentService.debugExtensionHost.debugId,break:this._environmentService.debugExtensionHost.break,port:this._environmentService.debugExtensionHost.port,env:{...this._environmentService.debugExtensionHost.env,...(o=t.options)==null?void 0:o.extensionHostEnv}},n=this._environmentService.extensionDevelopmentLocationURI;let s=!0;return n&&n.length>0&&n[0].scheme===pe.file&&(s=!1),s||(i.break=!1),Hhe(e,i).then(a=>{this._register(a);const{protocol:c,debugPort:d,reconnectionToken:l}=a,u=typeof d=="number";return s&&this._environmentService.isExtensionDevelopment&&this._environmentService.debugExtensionHost.debugId&&d&&this._extensionHostDebugService.attachSession(this._environmentService.debugExtensionHost.debugId,d,this._initDataProvider.remoteAuthority),c.onDidDispose(()=>{this._onExtHostConnectionLost(l)}),c.onSocketClose(()=>{this._isExtensionDevHost&&this._onExtHostConnectionLost(l)}),new Promise((h,g)=>{const m=setTimeout(()=>{g("The remote extension host took longer than 60s to send its ready message.")},6e4),y=c.onMessage(_=>{if(fE(_,1)){this._createExtHostInitData(u).then(b=>{c.send(De.fromString(JSON.stringify(b)))});return}if(fE(_,0)){clearTimeout(m),y.dispose(),this._protocol=c,h(c);return}console.error("received unexpected message during handshake phase from the extension host: ",_)})})})})}_onExtHostConnectionLost(e){this._hasLostConnection||(this._hasLostConnection=!0,this._isExtensionDevHost&&this._environmentService.debugExtensionHost.debugId&&this._extensionHostDebugService.close(this._environmentService.debugExtensionHost.debugId),!this._terminating&&this._onExit.fire([0,e]))}async _createExtHostInitData(e){const t=await this._initDataProvider.getInitData(),i=this._contextService.getWorkspace(),n=this.extensions.set(t.allExtensions,t.myExtensions);return{commit:this._productService.commit,version:this._productService.version,quality:this._productService.quality,parentPid:t.pid,environment:{isExtensionDevelopmentDebug:e,appRoot:t.appRoot,appName:this._productService.nameLong,appHost:this._productService.embedderIdentifier||"desktop",appUriScheme:this._productService.urlProtocol,extensionTelemetryLogResource:this._environmentService.extHostTelemetryLogFile,isExtensionTelemetryLoggingOnly:M1(this._productService,this._environmentService),appLanguage:Ig,extensionDevelopmentLocationURI:this._environmentService.extensionDevelopmentLocationURI,extensionTestsLocationURI:this._environmentService.extensionTestsLocationURI,globalStorageHome:t.globalStorageHome,workspaceStorageHome:t.workspaceStorageHome,extensionLogLevel:this._environmentService.extensionLogLevel},workspace:this._contextService.getWorkbenchState()===1?null:{configuration:i.configuration,id:i.id,name:this._labelService.getWorkspaceLabel(i),transient:i.transient},remote:{isRemote:!0,authority:this._initDataProvider.remoteAuthority,connectionData:t.connectionData},consoleForward:{includeStack:!1,logNative:!!this._environmentService.debugExtensionHost.debugId},allExtensions:n.toAdd,activationEvents:n.addActivationEvents,myExtensions:n.myToAdd,telemetryInfo:{sessionId:this._telemetryService.sessionId,machineId:this._telemetryService.machineId,firstSessionDate:this._telemetryService.firstSessionDate,msftInternal:this._telemetryService.msftInternal},logLevel:this._logService.getLevel(),loggers:[...this._loggerService.getRegisteredLoggers()],logsLocation:t.extensionHostLogsPath,autoStart:this.startup===1,uiKind:ln?Yo.Web:Yo.Desktop}}getInspectPort(){}enableInspectPort(){return Promise.resolve(!1)}dispose(){if(super.dispose(),this._terminating=!0,this._protocol){const e=this._protocol.getSocket();this._protocol.send(bz(2)),this._protocol.sendDisconnect(),this._protocol.dispose(),e.end(),this._protocol=null}}};B0=T([v(2,I$),v(3,oi),v(4,Ar),v(5,gi),v(6,ze),v(7,Is),v(8,Qi),v(9,wu),v(10,S3),v(11,Rs),v(12,Jhe)],B0);let U0=class{constructor(e,t,i,n,s,o,a){this._extensionsProposedApi=e,this._scanWebExtensions=t,this._getExtensions=i,this._instantiationService=n,this._remoteAgentService=s,this._remoteAuthorityResolverService=o,this._extensionEnablementService=a}createExtensionHost(e,t,i){switch(t.kind){case 1:return null;case 2:{const n=i?2:1;return this._instantiationService.createInstance(sx,t,n,this._createLocalExtensionHostDataProvider(e,t,i))}case 3:{const n=this._remoteAgentService.getConnection();return n?this._instantiationService.createInstance(B0,t,this._createRemoteExtensionHostDataProvider(e,n.remoteAuthority)):null}}}_createLocalExtensionHostDataProvider(e,t,i){return{getInitData:async()=>{if(i){const n=$0(this._extensionEnablementService,this._extensionsProposedApi,await this._scanWebExtensions(),!0),s=e.computeRunningLocation(n,[],!1),o=AS(n,s,a=>t.equals(a));return{allExtensions:n,myExtensions:o.map(a=>a.identifier)}}else{const n=await this._getExtensions(),s=e.filterByRunningLocation(n,t);return{allExtensions:n,myExtensions:s.map(o=>o.identifier)}}}}}_createRemoteExtensionHostDataProvider(e,t){return{remoteAuthority:t,getInitData:async()=>{const i=await this._getExtensions(),n=await this._remoteAgentService.getEnvironment();if(!n)throw new Error("Cannot provide init data for remote extension host!");const s=e.filterByExtensionHostKind(i,3);return{connectionData:this._remoteAuthorityResolverService.getConnectionData(t),pid:n.pid,appRoot:n.appRoot,extensionHostLogsPath:n.extensionHostLogsPath,globalStorageHome:n.globalStorageHome,workspaceStorageHome:n.workspaceStorageHome,allExtensions:i,myExtensions:s.map(a=>a.identifier)}}}}};U0=T([v(3,Te),v(4,Wa),v(5,wu),v(6,ev)],U0);let V0=class y5{constructor(e){this._logService=e}pickExtensionHostKind(e,t,i,n,s){const o=y5.pickRunningLocation(t,i,n,s);return this._logService.trace(`pickRunningLocation for ${e.value}, extension kinds: [${t.join(", ")}], isInstalledLocally: ${i}, isInstalledRemotely: ${n}, preference: ${Jue(s)} => ${pa(o)}`),o}static pickRunningLocation(e,t,i,n){const s=[];let o=!1;for(const a of e){if(a==="ui"&&i){if(n===2)return 3;o=!0}if(a==="workspace"&&i){if(n===0||n===2)return 3;s.push(3)}if(a==="web"&&(t||i)){if(n===0||n===1)return 2;s.push(2)}}return o&&s.push(3),s.length>0?s[0]:null}};V0=T([v(0,ze)],V0);class Zhe{constructor(){this.capabilities=2048+2+1024,this.onDidChangeCapabilities=F.None,this.onDidChangeFile=F.None}async readFile(e){try{const t=await fetch(e.toString(!0));if(t.status===200)return new Uint8Array(await t.arrayBuffer());throw An(t.statusText,lt.Unknown)}catch(t){throw An(t,lt.Unknown)}}async stat(e){return{type:Or.File,size:0,mtime:0,ctime:0}}watch(){return ne.None}writeFile(e,t,i){throw new al}readdir(e){throw new al}mkdir(e){throw new al}delete(e,t){throw new al}rename(e,t,i){throw new al}}var Gp;(function(r){r[r.Default=0]="Default",r[r.InCenter=1]="InCenter",r[r.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",r[r.AtTop=3]="AtTop"})(Gp||(Gp={}));var zp;(function(r){r[r.Default=0]="Default",r[r.InCenter=1]="InCenter",r[r.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",r[r.AtTop=3]="AtTop"})(zp||(zp={}));var X_;(function(r){r[r.None=0]="None",r[r.Process=1]="Process",r[r.Output=2]="Output"})(X_||(X_={}));const ce={MainThreadAuthentication:he("MainThreadAuthentication"),MainThreadBulkEdits:he("MainThreadBulkEdits"),MainThreadClipboard:he("MainThreadClipboard"),MainThreadCommands:he("MainThreadCommands"),MainThreadComments:he("MainThreadComments"),MainThreadConfiguration:he("MainThreadConfiguration"),MainThreadConsole:he("MainThreadConsole"),MainThreadDebugService:he("MainThreadDebugService"),MainThreadDecorations:he("MainThreadDecorations"),MainThreadDiagnostics:he("MainThreadDiagnostics"),MainThreadDialogs:he("MainThreadDiaglogs"),MainThreadDocuments:he("MainThreadDocuments"),MainThreadDocumentContentProviders:he("MainThreadDocumentContentProviders"),MainThreadTextEditors:he("MainThreadTextEditors"),MainThreadEditorInsets:he("MainThreadEditorInsets"),MainThreadEditorTabs:he("MainThreadEditorTabs"),MainThreadErrors:he("MainThreadErrors"),MainThreadTreeViews:he("MainThreadTreeViews"),MainThreadDownloadService:he("MainThreadDownloadService"),MainThreadKeytar:he("MainThreadKeytar"),MainThreadLanguageFeatures:he("MainThreadLanguageFeatures"),MainThreadLanguages:he("MainThreadLanguages"),MainThreadLogger:he("MainThreadLogger"),MainThreadMessageService:he("MainThreadMessageService"),MainThreadOutputService:he("MainThreadOutputService"),MainThreadProgress:he("MainThreadProgress"),MainThreadQuickDiff:he("MainThreadQuickDiff"),MainThreadQuickOpen:he("MainThreadQuickOpen"),MainThreadStatusBar:he("MainThreadStatusBar"),MainThreadSecretState:he("MainThreadSecretState"),MainThreadStorage:he("MainThreadStorage"),MainThreadTelemetry:he("MainThreadTelemetry"),MainThreadTerminalService:he("MainThreadTerminalService"),MainThreadWebviews:he("MainThreadWebviews"),MainThreadWebviewPanels:he("MainThreadWebviewPanels"),MainThreadWebviewViews:he("MainThreadWebviewViews"),MainThreadCustomEditors:he("MainThreadCustomEditors"),MainThreadUrls:he("MainThreadUrls"),MainThreadUriOpeners:he("MainThreadUriOpeners"),MainThreadProfileContentHandlers:he("MainThreadProfileContentHandlers"),MainThreadWorkspace:he("MainThreadWorkspace"),MainThreadFileSystem:he("MainThreadFileSystem"),MainThreadExtensionService:he("MainThreadExtensionService"),MainThreadSCM:he("MainThreadSCM"),MainThreadSearch:he("MainThreadSearch"),MainThreadShare:he("MainThreadShare"),MainThreadTask:he("MainThreadTask"),MainThreadWindow:he("MainThreadWindow"),MainThreadLabelService:he("MainThreadLabelService"),MainThreadNotebook:he("MainThreadNotebook"),MainThreadNotebookDocuments:he("MainThreadNotebookDocumentsShape"),MainThreadNotebookEditors:he("MainThreadNotebookEditorsShape"),MainThreadNotebookKernels:he("MainThreadNotebookKernels"),MainThreadNotebookRenderers:he("MainThreadNotebookRenderers"),MainThreadInteractive:he("MainThreadInteractive"),MainThreadChat:he("MainThreadChat"),MainThreadInlineChat:he("MainThreadInlineChatShape"),MainThreadTheming:he("MainThreadTheming"),MainThreadTunnelService:he("MainThreadTunnelService"),MainThreadManagedSockets:he("MainThreadManagedSockets"),MainThreadTimeline:he("MainThreadTimeline"),MainThreadTesting:he("MainThreadTesting"),MainThreadLocalization:he("MainThreadLocalizationShape"),MainThreadSemanticSimilarity:he("MainThreadSemanticSimilarity"),MainThreadIssueReporter:he("MainThreadIssueReporter")},fe={ExtHostCommands:he("ExtHostCommands"),ExtHostConfiguration:he("ExtHostConfiguration"),ExtHostDiagnostics:he("ExtHostDiagnostics"),ExtHostDebugService:he("ExtHostDebugService"),ExtHostDecorations:he("ExtHostDecorations"),ExtHostDocumentsAndEditors:he("ExtHostDocumentsAndEditors"),ExtHostDocuments:he("ExtHostDocuments"),ExtHostDocumentContentProviders:he("ExtHostDocumentContentProviders"),ExtHostDocumentSaveParticipant:he("ExtHostDocumentSaveParticipant"),ExtHostEditors:he("ExtHostEditors"),ExtHostTreeViews:he("ExtHostTreeViews"),ExtHostFileSystem:he("ExtHostFileSystem"),ExtHostFileSystemInfo:he("ExtHostFileSystemInfo"),ExtHostFileSystemEventService:he("ExtHostFileSystemEventService"),ExtHostLanguages:he("ExtHostLanguages"),ExtHostLanguageFeatures:he("ExtHostLanguageFeatures"),ExtHostQuickOpen:he("ExtHostQuickOpen"),ExtHostQuickDiff:he("ExtHostQuickDiff"),ExtHostStatusBar:he("ExtHostStatusBar"),ExtHostShare:he("ExtHostShare"),ExtHostExtensionService:he("ExtHostExtensionService"),ExtHostLogLevelServiceShape:he("ExtHostLogLevelServiceShape"),ExtHostTerminalService:he("ExtHostTerminalService"),ExtHostSCM:he("ExtHostSCM"),ExtHostSearch:he("ExtHostSearch"),ExtHostTask:he("ExtHostTask"),ExtHostWorkspace:he("ExtHostWorkspace"),ExtHostWindow:he("ExtHostWindow"),ExtHostWebviews:he("ExtHostWebviews"),ExtHostWebviewPanels:he("ExtHostWebviewPanels"),ExtHostCustomEditors:he("ExtHostCustomEditors"),ExtHostWebviewViews:he("ExtHostWebviewViews"),ExtHostEditorInsets:he("ExtHostEditorInsets"),ExtHostEditorTabs:he("ExtHostEditorTabs"),ExtHostProgress:he("ExtHostProgress"),ExtHostComments:he("ExtHostComments"),ExtHostSecretState:he("ExtHostSecretState"),ExtHostStorage:he("ExtHostStorage"),ExtHostUrls:he("ExtHostUrls"),ExtHostUriOpeners:he("ExtHostUriOpeners"),ExtHostProfileContentHandlers:he("ExtHostProfileContentHandlers"),ExtHostOutputService:he("ExtHostOutputService"),ExtHosLabelService:he("ExtHostLabelService"),ExtHostNotebook:he("ExtHostNotebook"),ExtHostNotebookDocuments:he("ExtHostNotebookDocuments"),ExtHostNotebookEditors:he("ExtHostNotebookEditors"),ExtHostNotebookKernels:he("ExtHostNotebookKernels"),ExtHostNotebookRenderers:he("ExtHostNotebookRenderers"),ExtHostNotebookDocumentSaveParticipant:he("ExtHostNotebookDocumentSaveParticipant"),ExtHostInteractive:he("ExtHostInteractive"),ExtHostInlineChat:he("ExtHostInlineChatShape"),ExtHostChat:he("ExtHostChat"),ExtHostSemanticSimilarity:he("ExtHostSemanticSimilarity"),ExtHostTheming:he("ExtHostTheming"),ExtHostTunnelService:he("ExtHostTunnelService"),ExtHostManagedSockets:he("ExtHostManagedSockets"),ExtHostAuthentication:he("ExtHostAuthentication"),ExtHostTimeline:he("ExtHostTimeline"),ExtHostTesting:he("ExtHostTesting"),ExtHostTelemetry:he("ExtHostTelemetry"),ExtHostLocalization:he("ExtHostLocalization"),ExtHostIssueReporter:he("ExtHostIssueReporter")};class efe{constructor(){this._systemSchemes=new Set(Object.keys(pe)),this._providerInfo=new Map,this.extUri=new GN(e=>{const t=this._providerInfo.get(e.scheme);return!(t===void 0||t&1024)})}$acceptProviderInfos(e,t){t===null?this._providerInfo.delete(e.scheme):this._providerInfo.set(e.scheme,t)}isFreeScheme(e){return!this._providerInfo.has(e)&&!this._systemSchemes.has(e)}getCapabilities(e){return this._providerInfo.get(e)}}const iv=re("IExtHostFileSystemInfo"),Gr=re("IExtHostInitDataService"),Ii=re("IExtHostRpcService");class tfe{constructor(e){this.getProxy=e.getProxy.bind(e),this.set=e.set.bind(e),this.dispose=e.dispose.bind(e),this.assertRegistered=e.assertRegistered.bind(e),this.drain=e.drain.bind(e)}}class Et{static fromExtHostTestItem(e,t,i=e.parent){if(e._isRoot)return new Et([t]);const n=[e.id];for(let s=i;s&&s.id!==t;s=s.parent)n.push(s.id);return n.push(t),new Et(n.reverse())}static isRoot(e){return!e.includes("\0")}static root(e){const t=e.indexOf("\0");return t===-1?e:e.slice(0,t)}static fromString(e){return new Et(e.split("\0"))}static join(e,t){return new Et([...e.path,t])}static joinToString(e,t){return e.toString()+"\0"+t}static parentId(e){const t=e.lastIndexOf("\0");return t===-1?void 0:e.slice(0,t)}static localId(e){const t=e.lastIndexOf("\0");return t===-1?e:e.slice(t+1)}static isChild(e,t){return t.startsWith(e)&&t[e.length]==="\0"}static compare(e,t){return e===t?0:Et.isChild(e,t)?2:Et.isChild(t,e)?3:1}constructor(e,t=e.length){if(this.path=e,this.viewEnd=t,e.length===0||t<1)throw new Error("cannot create test with empty path")}get parentId(){return this.viewEnd>1?new Et(this.path,this.viewEnd-1):void 0}get localId(){return this.path[this.viewEnd-1]}get controllerId(){return this.path[0]}get isRoot(){return this.viewEnd===1}*idsFromRoot(){for(let e=1;e<=this.viewEnd;e++)yield new Et(this.path,e)}*idsToRoot(){for(let e=this.viewEnd;e>0;e--)yield new Et(this.path,e)}compare(e){if(typeof e=="string")return Et.compare(this.toString(),e);for(let t=0;t<e.viewEnd&&t<this.viewEnd;t++)if(e.path[t]!==this.path[t])return 1;return e.viewEnd>this.viewEnd?2:e.viewEnd<this.viewEnd?3:0}toJSON(){return this.toString()}toString(){if(!this.stringifed){this.stringifed=this.path[0];for(let e=1;e<this.viewEnd;e++)this.stringifed+="\0",this.stringifed+=this.path[e]}return this.stringifed}}const ife=r=>"runId"in r;var fm;(function(r){r.serialize=e=>({range:e.range.toJSON(),uri:e.uri.toJSON()}),r.deserialize=e=>({range:qe.lift(e.range),uri:k.revive(e.uri)})})(fm||(fm={}));var ax;(function(r){r.serialize=e=>({message:e.message,type:0,expected:e.expected,actual:e.actual,location:e.location&&fm.serialize(e.location)}),r.deserialize=e=>({message:e.message,type:0,expected:e.expected,actual:e.actual,location:e.location&&fm.deserialize(e.location)})})(ax||(ax={}));const nfe=(r,e)=>`${e?"s":"e"}${r}`;var cx;(function(r){r.serialize=e=>({message:e.message,type:1,offset:e.offset,length:e.length,location:e.location&&fm.serialize(e.location)}),r.deserialize=e=>({message:e.message,type:1,offset:e.offset,length:e.length,location:e.location&&fm.deserialize(e.location)})})(cx||(cx={}));var J_;(function(r){r.serialize=e=>e.type===0?ax.serialize(e):cx.serialize(e),r.deserialize=e=>e.type===0?ax.deserialize(e):cx.deserialize(e)})(J_||(J_={}));var xy;(function(r){r.serializeWithoutMessages=e=>({state:e.state,duration:e.duration,messages:[]}),r.serialize=e=>({state:e.state,duration:e.duration,messages:e.messages.map(J_.serialize)}),r.deserialize=e=>({state:e.state,duration:e.duration,messages:e.messages.map(J_.deserialize)})})(xy||(xy={}));const _5="\0",FS=(r,e)=>r+_5+e,w5=r=>{const e=r.indexOf(_5);return{ctrlId:r.slice(0,e),tagId:r.slice(e+1)}};var Z_;(function(r){r.serialize=e=>{var t,i;return{extId:e.extId,label:e.label,tags:e.tags,busy:e.busy,children:void 0,uri:(t=e.uri)==null?void 0:t.toJSON(),range:((i=e.range)==null?void 0:i.toJSON())||null,description:e.description,error:e.error,sortText:e.sortText}},r.deserialize=e=>({extId:e.extId,label:e.label,tags:e.tags,busy:e.busy,children:void 0,uri:e.uri?k.revive(e.uri):void 0,range:e.range?qe.lift(e.range):null,description:e.description,error:e.error,sortText:e.sortText})})(Z_||(Z_={}));var zl;(function(r){r.serialize=e=>({expand:e.expand,item:Z_.serialize(e.item)}),r.deserialize=e=>({controllerId:Et.root(e.item.extId),expand:e.expand,item:Z_.deserialize(e.item)})})(zl||(zl={}));var ew;(function(r){r.serialize=e=>{var i,n;let t;return e.item&&(t={},e.item.label!==void 0&&(t.label=e.item.label),e.item.tags!==void 0&&(t.tags=e.item.tags),e.item.busy!==void 0&&(t.busy=e.item.busy),e.item.uri!==void 0&&(t.uri=(i=e.item.uri)==null?void 0:i.toJSON()),e.item.range!==void 0&&(t.range=(n=e.item.range)==null?void 0:n.toJSON()),e.item.description!==void 0&&(t.description=e.item.description),e.item.error!==void 0&&(t.error=e.item.error),e.item.sortText!==void 0&&(t.sortText=e.item.sortText)),{extId:e.extId,expand:e.expand,item:t}},r.deserialize=e=>{let t;return e.item&&(t={},e.item.label!==void 0&&(t.label=e.item.label),e.item.tags!==void 0&&(t.tags=e.item.tags),e.item.busy!==void 0&&(t.busy=e.item.busy),e.item.range!==void 0&&(t.range=e.item.range?qe.lift(e.item.range):null),e.item.description!==void 0&&(t.description=e.item.description),e.item.error!==void 0&&(t.error=e.item.error),e.item.sortText!==void 0&&(t.sortText=e.item.sortText)),{extId:e.extId,expand:e.expand,item:t}}})(ew||(ew={}));const q0=(r,e)=>{e.expand!==void 0&&(r.expand=e.expand),e.item!==void 0&&(r.item=r.item?Object.assign(r.item,e.item):e.item)};var dx;(function(r){r.serializeWithoutMessages=e=>({...zl.serialize(e),ownComputedState:e.ownComputedState,computedState:e.computedState,tasks:e.tasks.map(xy.serializeWithoutMessages)}),r.serialize=e=>({...zl.serialize(e),ownComputedState:e.ownComputedState,computedState:e.computedState,tasks:e.tasks.map(xy.serialize)}),r.deserialize=e=>({...zl.deserialize(e),ownComputedState:e.ownComputedState,computedState:e.computedState,tasks:e.tasks.map(xy.deserialize),retired:!0})})(dx||(dx={}));var pm;(function(r){r.deserialize=e=>e.op===0?{op:e.op,item:zl.deserialize(e.item)}:e.op===1?{op:e.op,item:ew.deserialize(e.item)}:e.op===2?{op:e.op,uri:k.revive(e.uri),docv:e.docv}:e,r.serialize=e=>e.op===0?{op:e.op,item:zl.serialize(e.item)}:e.op===1?{op:e.op,item:ew.serialize(e.item)}:e})(pm||(pm={}));class rfe{constructor(){this._tags=new Map,this.items=new Map,this.roots=new Set,this.busyControllerCount=0,this.pendingRootCount=0,this.tags=this._tags}apply(e){var i;const t=this.createChangeCollector();for(const n of e)switch(n.op){case 0:this.add(zl.deserialize(n.item),t);break;case 1:this.update(ew.deserialize(n.item),t);break;case 3:this.remove(n.itemId,t);break;case 5:this.retireTest(n.itemId);break;case 4:this.updatePendingRoots(n.amount);break;case 6:this._tags.set(n.tag.id,n.tag);break;case 7:this._tags.delete(n.id);break}(i=t.complete)==null||i.call(t)}add(e,t){var s,o;const i=(s=Et.parentId(e.item.extId))==null?void 0:s.toString();let n;if(!i)n=this.createItem(e),this.roots.add(n),this.items.set(e.item.extId,n);else if(this.items.has(i)){const a=this.items.get(i);a.children.add(e.item.extId),n=this.createItem(e,a),this.items.set(e.item.extId,n)}else{console.error(`Test with unknown parent ID: ${JSON.stringify(e)}`);return}return(o=t.add)==null||o.call(t,n),e.expand===2&&this.busyControllerCount++,n}update(e,t){var n;const i=this.items.get(e.extId);if(i)return e.expand!==void 0&&(i.expand===2&&this.busyControllerCount--,e.expand===2&&this.busyControllerCount++),q0(i,e),(n=t.update)==null||n.call(t,i),i}remove(e,t){var o,a;const i=this.items.get(e);if(!i)return;const n=(o=Et.parentId(i.item.extId))==null?void 0:o.toString();n?this.items.get(n).children.delete(i.item.extId):this.roots.delete(i);const s=[[e]];for(;s.length;)for(const c of s.pop()){const d=this.items.get(c);d&&(s.push(d.children),this.items.delete(c),(a=t.remove)==null||a.call(t,d,d!==i),d.expand===2&&this.busyControllerCount--)}}retireTest(e){}updatePendingRoots(e){this.pendingRootCount+=e}createChangeCollector(){return{}}}const Iv=(r,e)=>r===e,sfe={range:(r,e)=>r===e?!0:!r||!e?!1:r.equalsRange(e),busy:Iv,label:Iv,description:Iv,error:Iv,sortText:Iv,tags:(r,e)=>!(r.length!==e.length||r.some(t=>!e.includes(t)))},ofe=Object.entries(sfe),afe=(r,e)=>{let t;for(const[i,n]of ofe)n(r[i],e[i])||(t?t[i]=e[i]:t={[i]:e[i]});return t};class cfe extends ne{get root(){return this.options.root}constructor(e){super(),this.options=e,this.debounceSendDiff=this._register(new Ys(()=>this.flushDiff(),200)),this.diffOpEmitter=this._register(new A),this.tree=new Map,this.tags=new Map,this.diff=[],this.onDidGenerateDiff=this.diffOpEmitter.event,this.root.canResolveChildren=!0,this.upsertItem(this.root,void 0)}set resolveHandler(e){this._resolveHandler=e;for(const t of this.tree.values())this.updateExpandability(t)}get resolveHandler(){return this._resolveHandler}collectDiff(){const e=this.diff;return this.diff=[],e}pushDiff(e){switch(e.op){case 2:{for(const t of this.diff)if(t.op===2&&t.uri===e.uri){t.docv=e.docv;return}break}case 1:{const t=this.diff[this.diff.length-1];if(t){if(t.op===1&&t.item.extId===e.item.extId){q0(t.item,e.item);return}if(t.op===0&&t.item.item.extId===e.item.extId){q0(t.item,e.item);return}}break}}this.diff.push(e),this.debounceSendDiff.isScheduled()||this.debounceSendDiff.schedule()}expand(e,t){var n;const i=this.tree.get(e);if(i){if((i.expandLevels===void 0||t>i.expandLevels)&&(i.expandLevels=t),i.expand===1){const s=this.resolveChildren(i);return s.isOpen()?this.expandChildren(i,t-1):s.wait().then(()=>this.expandChildren(i,t-1))}else if(i.expand===3)return((n=i.resolveBarrier)==null?void 0:n.isOpen())===!1?i.resolveBarrier.wait().then(()=>this.expandChildren(i,t-1)):this.expandChildren(i,t-1)}}dispose(){for(const e of this.tree.values())this.options.getApiFor(e.actual).listener=void 0;this.tree.clear(),this.diff=[],super.dispose()}onTestItemEvent(e,t){switch(t.op){case 3:this.removeItem(Et.joinToString(e.fullId,t.id));break;case 0:this.upsertItem(t.item,e);break;case 5:for(const i of t.ops)this.onTestItemEvent(e,i);break;case 1:this.diffTagRefs(t.new,t.old,e.fullId.toString());break;case 2:this.updateExpandability(e);break;case 4:this.pushDiff({op:1,item:{extId:e.fullId.toString(),item:t.update}});break;case 6:this.documentSynced(e.actual.uri);break;default:xY()}}documentSynced(e){e&&this.pushDiff({op:2,uri:e,docv:this.options.getDocumentVersion(e)})}upsertItem(e,t){var d,l;const i=Et.fromExtHostTestItem(e,this.root.id,t==null?void 0:t.actual),n=this.options.getApiFor(e);n.parent&&n.parent!==(t==null?void 0:t.actual)&&this.options.getChildren(n.parent).delete(e.id);let s=this.tree.get(i.toString());if(!s){s={fullId:i,actual:e,expandLevels:t!=null&&t.expandLevels?t.expandLevels-1:void 0,expand:0},e.tags.forEach(this.incrementTagRefs,this),this.tree.set(s.fullId.toString(),s),this.setItemParent(e,t),this.pushDiff({op:0,item:{controllerId:this.options.controllerId,expand:s.expand,item:this.options.toITestItem(e)}}),this.connectItemAndChildren(e,s,t);return}if(s.actual===e){this.connectItem(e,s,t);return}if(((d=s.actual.uri)==null?void 0:d.toString())!==((l=e.uri)==null?void 0:l.toString()))return this.removeItem(i.toString()),this.upsertItem(e,t);const o=this.options.getChildren(s.actual),a=s.actual,c=afe(this.options.toITestItem(a),this.options.toITestItem(e));this.options.getApiFor(a).listener=void 0,s.actual=e,s.expand=0,c&&(c.hasOwnProperty("tags")&&(this.diffTagRefs(e.tags,a.tags,i.toString()),delete c.tags),this.onTestItemEvent(s,{op:4,update:c})),this.connectItemAndChildren(e,s,t);for(const[u,h]of o)this.options.getChildren(e).get(h.id)||this.removeItem(Et.joinToString(i,h.id));this.documentSynced(s.actual.uri)}diffTagRefs(e,t,i){const n=new Set(t.map(s=>s.id));for(const s of e)n.delete(s.id)||this.incrementTagRefs(s);this.pushDiff({op:1,item:{extId:i,item:{tags:e.map(s=>FS(this.options.controllerId,s.id))}}}),n.forEach(this.decrementTagRefs,this)}incrementTagRefs(e){const t=this.tags.get(e.id);t?t.refCount++:(this.tags.set(e.id,{refCount:1}),this.pushDiff({op:6,tag:{id:FS(this.options.controllerId,e.id)}}))}decrementTagRefs(e){const t=this.tags.get(e);t&&!--t.refCount&&(this.tags.delete(e),this.pushDiff({op:7,id:FS(this.options.controllerId,e)}))}setItemParent(e,t){this.options.getApiFor(e).parent=t&&t.actual!==this.root?t.actual:void 0}connectItem(e,t,i){this.setItemParent(e,i);const n=this.options.getApiFor(e);n.parent=i==null?void 0:i.actual,n.listener=s=>this.onTestItemEvent(t,s),this.updateExpandability(t)}connectItemAndChildren(e,t,i){this.connectItem(e,t,i);for(const[n,s]of this.options.getChildren(e))this.upsertItem(s,t)}updateExpandability(e){let t;this._resolveHandler?e.resolveBarrier?t=e.resolveBarrier.isOpen()?3:2:t=e.actual.canResolveChildren?1:0:t=0,t!==e.expand&&(e.expand=t,this.pushDiff({op:1,item:{extId:e.fullId.toString(),expand:t}}),t===1&&e.expandLevels!==void 0&&this.resolveChildren(e))}expandChildren(e,t){if(t<0)return;const i=[];for(const[n,s]of this.options.getChildren(e.actual)){const o=this.expand(Et.joinToString(e.fullId,s.id),t);Cg(o)&&i.push(o)}if(i.length)return Promise.all(i).then(()=>{})}resolveChildren(e){if(e.resolveBarrier)return e.resolveBarrier;if(!this._resolveHandler){const s=new Cs;return s.open(),s}e.expand=2,this.pushExpandStateUpdate(e);const t=e.resolveBarrier=new Cs,i=s=>{console.error(`Unhandled error in resolveHandler of test controller "${this.options.controllerId}"`,s)};let n;try{n=this._resolveHandler(e.actual===this.root?void 0:e.actual)}catch(s){i(s)}return Cg(n)?n.catch(i).then(()=>{t.open(),this.updateExpandability(e)}):(t.open(),this.updateExpandability(e)),e.resolveBarrier}pushExpandStateUpdate(e){this.pushDiff({op:1,item:{extId:e.fullId.toString(),expand:e.expand}})}removeItem(e){const t=this.tree.get(e);if(!t)throw new Error("attempting to remove non-existent child");this.pushDiff({op:3,itemId:e});const i=[t];for(;i.length;){const n=i.pop();if(n){this.options.getApiFor(n.actual).listener=void 0;for(const s of n.actual.tags)this.decrementTagRefs(s.id);this.tree.delete(n.fullId.toString());for(const[s,o]of this.options.getChildren(n.actual))i.push(this.tree.get(Et.joinToString(n.fullId,o.id)))}}}flushDiff(){const e=this.collectDiff();e.length&&this.diffOpEmitter.fire(e)}}class dfe extends Error{constructor(e){super(`Attempted to insert a duplicate test item ID ${e}`)}}class lx extends Error{constructor(e){super(`TestItem with ID "${e}" is invalid. Make sure to create it from the createTestItem method.`)}}class lfe extends Error{constructor(e,t,i){super(`TestItem with ID "${e}" is from controller "${t}" and cannot be added as a child of an item from controller "${i}".`)}}const ufe=(r,e,t)=>{let i=new Map;return{get size(){return i.size},forEach(n,s){for(const o of i.values())n.call(s,o,this)},[Symbol.iterator](){return i.entries()},replace(n){var c;const s=new Map,o=new Set(i.keys()),a={op:5,ops:[]};for(const d of n){if(!(d instanceof t))throw new lx(d.id);const l=e(d).controllerId;if(l!==r.controllerId)throw new lfe(d.id,l,r.controllerId);if(s.has(d.id))throw new dfe(d.id);s.set(d.id,d),o.delete(d.id),a.ops.push({op:0,item:d})}for(const d of o.keys())a.ops.push({op:3,id:d});(c=r.listener)==null||c.call(r,a),i=s},add(n){var s;if(!(n instanceof t))throw new lx(n.id);i.set(n.id,n),(s=r.listener)==null||s.call(r,{op:0,item:n})},delete(n){var s;i.delete(n)&&((s=r.listener)==null||s.call(r,{op:3,id:n}))},get(n){return i.get(n)},toJSON(){return Array.from(i.values())}}},b5=new WeakMap,hfe=(r,e)=>{const t={controllerId:e};return b5.set(r,t),t},GT=r=>{const e=b5.get(r);if(!e)throw new lx((r==null?void 0:r.id)||"<unknown>");return e};var Aa;(function(r){function e(i){const{selectionStartLineNumber:n,selectionStartColumn:s,positionLineNumber:o,positionColumn:a}=i,c=new At(n-1,s-1),d=new At(o-1,a-1);return new wd(c,d)}r.to=e;function t(i){const{anchor:n,active:s}=i;return{selectionStartLineNumber:n.line+1,selectionStartColumn:n.character+1,positionLineNumber:s.line+1,positionColumn:s.character+1}}r.from=t})(Aa||(Aa={}));var ge;(function(r){function e(i){if(!i)return;const{start:n,end:s}=i;return{startLineNumber:n.line+1,startColumn:n.character+1,endLineNumber:s.line+1,endColumn:s.character+1}}r.from=e;function t(i){if(!i)return;const{startLineNumber:n,startColumn:s,endLineNumber:o,endColumn:a}=i;return new Tt(n-1,s-1,o-1,a-1)}r.to=t})(ge||(ge={}));var G0;(function(r){function e(t){switch(t){case 1:return bl.Comment;case 0:return bl.Other;case 3:return bl.RegEx;case 2:return bl.String}}r.to=e})(G0||(G0={}));var Wi;(function(r){function e(i){return new At(i.lineNumber-1,i.column-1)}r.to=e;function t(i){return{lineNumber:i.line+1,column:i.character+1}}r.from=t})(Wi||(Wi={}));var gm;(function(r){function e(n,s,o){return fi(bg(n).map(a=>t(a,s,o)))}r.from=e;function t(n,s,o){if(typeof n=="string")return{$serialized:!0,language:n,isBuiltin:o==null?void 0:o.isBuiltin};if(n)return{$serialized:!0,language:n.language,scheme:i(n.scheme,s),pattern:lo.from(n.pattern)??void 0,exclusive:n.exclusive,notebookType:n.notebookType,isBuiltin:o==null?void 0:o.isBuiltin}}function i(n,s){return s&&typeof n=="string"?s.transformOutgoingScheme(n):n}})(gm||(gm={}));var ux;(function(r){function e(i){switch(i){case vl.Unnecessary:return 1;case vl.Deprecated:return 2}}r.from=e;function t(i){switch(i){case 1:return vl.Unnecessary;case 2:return vl.Deprecated;default:return}}r.to=t})(ux||(ux={}));var mm;(function(r){function e(i){let n;return i.code&&(Rt(i.code)||pr(i.code)?n=String(i.code):n={value:String(i.code.value),target:i.code.target}),{...ge.from(i.range),message:i.message,source:i.source,code:n,severity:fx.from(i.severity),relatedInformation:i.relatedInformation&&i.relatedInformation.map(hx.from),tags:Array.isArray(i.tags)?fi(i.tags.map(ux.from)):void 0}}r.from=e;function t(i){var s;const n=new o_(ge.to(i),i.message,fx.to(i.severity));return n.source=i.source,n.code=Rt(i.code)?i.code:(s=i.code)==null?void 0:s.value,n.relatedInformation=i.relatedInformation&&i.relatedInformation.map(hx.to),n.tags=i.tags&&fi(i.tags.map(ux.to)),n}r.to=t})(mm||(mm={}));var hx;(function(r){function e(i){return{...ge.from(i.location.range),message:i.message,resource:i.location.uri}}r.from=e;function t(i){return new Fg(new wo(i.resource,ge.to(i)),i.message)}r.to=t})(hx||(hx={}));var fx;(function(r){function e(i){switch(i){case ur.Error:return Ka.Error;case ur.Warning:return Ka.Warning;case ur.Information:return Ka.Info;case ur.Hint:return Ka.Hint}return Ka.Error}r.from=e;function t(i){switch(i){case Ka.Info:return ur.Information;case Ka.Warning:return ur.Warning;case Ka.Error:return ur.Error;case Ka.Hint:return ur.Hint;default:return ur.Error}}r.to=t})(fx||(fx={}));var Hn;(function(r){function e(i){return typeof i=="number"&&i>=Bg.One?i-1:i===Bg.Beside?Ed:Vl}r.from=e;function t(i){if(typeof i=="number"&&i>=0)return i+1;throw new Error("invalid 'EditorGroupColumn'")}r.to=t})(Hn||(Hn={}));function ffe(r){return typeof r.range<"u"}function S5(r){return r.length===0?!0:!!ffe(r[0])}var zi;(function(r){function e(a){return a.map(r.from)}r.fromMany=e;function t(a){return a&&typeof a=="object"&&typeof a.language=="string"&&typeof a.value=="string"}function i(a){let c;if(t(a)){const{language:h,value:g}=a;c={value:"```"+h+`
`+g+"\n```\n"}}else Ia.isMarkdownString(a)?c={value:a.value,isTrusted:a.isTrusted,supportThemeIcons:a.supportThemeIcons,supportHtml:a.supportHtml,baseUri:a.baseUri}:typeof a=="string"?c={value:a}:c={value:""};const d=Object.create(null);c.uris=d;const l=h=>{try{let g=k.parse(h,!0);g=g.with({query:n(g.query,d)}),d[h]=g}catch{}return""},u=new mH.Renderer;return u.link=l,u.image=h=>typeof h=="string"?l(DY(h).href):"",mH(c.value,{renderer:u}),c}r.from=i;function n(a,c){if(!a)return a;let d;try{d=TY(a)}catch{}if(!d)return a;let l=!1;return d=hC(d,u=>{if(k.isUri(u)){const h=`__uri_${Math.random().toString(16).slice(2,8)}`;return c[h]=u,l=!0,h}else return}),l?JSON.stringify(d):a}function s(a){const c=new Ia(a.value,a.supportThemeIcons);return c.isTrusted=a.isTrusted,c.supportHtml=a.supportHtml,c.baseUri=a.baseUri?k.from(a.baseUri):void 0,c}r.to=s;function o(a){if(a)return typeof a=="string"?a:r.from(a)}r.fromStrict=o})(zi||(zi={}));function pfe(r){return S5(r)?r.map(e=>({range:ge.from(e.range),hoverMessage:Array.isArray(e.hoverMessage)?zi.fromMany(e.hoverMessage):e.hoverMessage?zi.from(e.hoverMessage):void 0,renderOptions:e.renderOptions})):r.map(e=>({range:ge.from(e)}))}function zT(r){return typeof r>"u"?r:typeof r=="string"?k.file(r):r}var vm;(function(r){function e(t){return typeof t>"u"?t:{contentText:t.contentText,contentIconPath:t.contentIconPath?zT(t.contentIconPath):void 0,border:t.border,borderColor:t.borderColor,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,color:t.color,backgroundColor:t.backgroundColor,margin:t.margin,width:t.width,height:t.height}}r.from=e})(vm||(vm={}));var px;(function(r){function e(t){return typeof t>"u"?t:{backgroundColor:t.backgroundColor,outline:t.outline,outlineColor:t.outlineColor,outlineStyle:t.outlineStyle,outlineWidth:t.outlineWidth,border:t.border,borderColor:t.borderColor,borderRadius:t.borderRadius,borderSpacing:t.borderSpacing,borderStyle:t.borderStyle,borderWidth:t.borderWidth,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,cursor:t.cursor,color:t.color,opacity:t.opacity,letterSpacing:t.letterSpacing,gutterIconPath:t.gutterIconPath?zT(t.gutterIconPath):void 0,gutterIconSize:t.gutterIconSize,overviewRulerColor:t.overviewRulerColor,before:t.before?vm.from(t.before):void 0,after:t.after?vm.from(t.after):void 0}}r.from=e})(px||(px={}));var z0;(function(r){function e(t){if(typeof t>"u")return t;switch(t){case yl.OpenOpen:return 0;case yl.ClosedClosed:return 1;case yl.OpenClosed:return 2;case yl.ClosedOpen:return 3}}r.from=e})(z0||(z0={}));var K0;(function(r){function e(t){return{isWholeLine:t.isWholeLine,rangeBehavior:t.rangeBehavior?z0.from(t.rangeBehavior):void 0,overviewRulerLane:t.overviewRulerLane,light:t.light?px.from(t.light):void 0,dark:t.dark?px.from(t.dark):void 0,backgroundColor:t.backgroundColor,outline:t.outline,outlineColor:t.outlineColor,outlineStyle:t.outlineStyle,outlineWidth:t.outlineWidth,border:t.border,borderColor:t.borderColor,borderRadius:t.borderRadius,borderSpacing:t.borderSpacing,borderStyle:t.borderStyle,borderWidth:t.borderWidth,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,cursor:t.cursor,color:t.color,opacity:t.opacity,letterSpacing:t.letterSpacing,gutterIconPath:t.gutterIconPath?zT(t.gutterIconPath):void 0,gutterIconSize:t.gutterIconSize,overviewRulerColor:t.overviewRulerColor,before:t.before?vm.from(t.before):void 0,after:t.after?vm.from(t.after):void 0}}r.from=e})(K0||(K0={}));var fr;(function(r){function e(i){return{text:i.newText,eol:i.newEol&&wm.from(i.newEol),range:ge.from(i.range)}}r.from=e;function t(i){const n=new bd(ge.to(i.range),i.text);return n.newEol=typeof i.eol>"u"?void 0:wm.to(i.eol),n}r.to=t})(fr||(fr={}));var bo;(function(r){function e(i,n){var o;const s={edits:[]};if(i instanceof Sd){const a=new sk;for(const c of i._allEntries())c._type===1&&k.isUri(c.to)&&c.from===void 0&&a.add(c.to);for(const c of i._allEntries())if(c._type===1){let d;(o=c.options)!=null&&o.contents&&(ArrayBuffer.isView(c.options.contents)?d={type:"base64",value:NN(De.wrap(c.options.contents))}:d={type:"dataTransferItem",id:c.options.contents._itemId}),s.edits.push({oldResource:c.from,newResource:c.to,options:{...c.options,contents:d},metadata:c.metadata})}else c._type===2?s.edits.push({resource:c.uri,textEdit:fr.from(c.edit),versionId:a.has(c.uri)||n==null?void 0:n.getTextDocumentVersion(c.uri),metadata:c.metadata}):c._type===6?s.edits.push({resource:c.uri,textEdit:{range:ge.from(c.range),text:c.edit.value,insertAsSnippet:!0},versionId:a.has(c.uri)||n==null?void 0:n.getTextDocumentVersion(c.uri),metadata:c.metadata}):c._type===3?s.edits.push({metadata:c.metadata,resource:c.uri,cellEdit:c.edit,notebookMetadata:c.notebookMetadata,notebookVersionId:n==null?void 0:n.getNotebookDocumentVersion(c.uri)}):c._type===5&&s.edits.push({metadata:c.metadata,resource:c.uri,notebookVersionId:n==null?void 0:n.getNotebookDocumentVersion(c.uri),cellEdit:{editType:1,index:c.index,count:c.count,cells:c.cells.map(sw.from)}})}return s}r.from=e;function t(i){const n=new Sd,s=new ki;for(const o of i.edits)if(o.textEdit){const a=o,c=k.revive(a.resource),d=ge.to(a.textEdit.range),l=a.textEdit.text,u=a.textEdit.insertAsSnippet;let h;u?h=Pk.replace(d,new ru(l)):h=bd.replace(d,l);const g=s.get(c);g?g.push(h):s.set(c,[h])}else n.renameFile(k.revive(o.oldResource),k.revive(o.newResource),o.options);for(const[o,a]of s)n.set(o,a);return n}r.to=t})(bo||(bo={}));var Jo;(function(r){const e=Object.create(null);e[Ai.File]=0,e[Ai.Module]=1,e[Ai.Namespace]=2,e[Ai.Package]=3,e[Ai.Class]=4,e[Ai.Method]=5,e[Ai.Property]=6,e[Ai.Field]=7,e[Ai.Constructor]=8,e[Ai.Enum]=9,e[Ai.Interface]=10,e[Ai.Function]=11,e[Ai.Variable]=12,e[Ai.Constant]=13,e[Ai.String]=14,e[Ai.Number]=15,e[Ai.Boolean]=16,e[Ai.Array]=17,e[Ai.Object]=18,e[Ai.Key]=19,e[Ai.Null]=20,e[Ai.EnumMember]=21,e[Ai.Struct]=22,e[Ai.Event]=23,e[Ai.Operator]=24,e[Ai.TypeParameter]=25;function t(n){return typeof e[n]=="number"?e[n]:6}r.from=t;function i(n){for(const s in e)if(e[s]===n)return Number(s);return Ai.Property}r.to=i})(Jo||(Jo={}));var xd;(function(r){function e(i){switch(i){case Ng.Deprecated:return 1}}r.from=e;function t(i){switch(i){case 1:return Ng.Deprecated}}r.to=t})(xd||(xd={}));var tw;(function(r){function e(i){return{name:i.name,kind:Jo.from(i.kind),tags:i.tags&&i.tags.map(xd.from),containerName:i.containerName,location:So.from(i.location)}}r.from=e;function t(i){const n=new $g(i.name,Jo.to(i.kind),i.containerName,So.to(i.location));return n.tags=i.tags&&i.tags.map(xd.to),n}r.to=t})(tw||(tw={}));var Q0;(function(r){function e(i){var s;const n={name:i.name||"!!MISSING: name!!",detail:i.detail,range:ge.from(i.range),selectionRange:ge.from(i.selectionRange),kind:Jo.from(i.kind),tags:((s=i.tags)==null?void 0:s.map(xd.from))??[]};return i.children&&(n.children=i.children.map(e)),n}r.from=e;function t(i){const n=new Wg(i.name,i.detail,Jo.to(i.kind),ge.to(i.range),ge.to(i.selectionRange));return Pr(i.tags)&&(n.tags=i.tags.map(xd.to)),i.children&&(n.children=i.children.map(t)),n}r.to=t})(Q0||(Q0={}));var xf;(function(r){function e(i){const n=new Ak(Jo.to(i.kind),i.name,i.detail||"",k.revive(i.uri),ge.to(i.range),ge.to(i.selectionRange));return n._sessionId=i._sessionId,n._itemId=i._itemId,n}r.to=e;function t(i,n,s){var o;if(n=n??i._sessionId,s=s??i._itemId,n===void 0||s===void 0)throw new Error("invalid item");return{_sessionId:n,_itemId:s,name:i.name,detail:i.detail,kind:Jo.from(i.kind),uri:i.uri,range:ge.from(i.range),selectionRange:ge.from(i.selectionRange),tags:(o=i.tags)==null?void 0:o.map(xd.from)}}r.from=t})(xf||(xf={}));var Y0;(function(r){function e(t){return new k1(xf.to(t.from),t.fromRanges.map(i=>ge.to(i)))}r.to=e})(Y0||(Y0={}));var X0;(function(r){function e(t){return new T1(xf.to(t.to),t.fromRanges.map(i=>ge.to(i)))}r.to=e})(X0||(X0={}));var So;(function(r){function e(i){return{range:i.range&&ge.from(i.range),uri:i.uri}}r.from=e;function t(i){return new wo(k.revive(i.uri),ge.to(i.range))}r.to=t})(So||(So={}));var iw;(function(r){function e(i){const n=i,s=i;return{originSelectionRange:n.originSelectionRange?ge.from(n.originSelectionRange):void 0,uri:n.targetUri?n.targetUri:s.uri,range:ge.from(n.targetRange?n.targetRange:s.range),targetSelectionRange:n.targetSelectionRange?ge.from(n.targetSelectionRange):void 0}}r.from=e;function t(i){return{targetUri:k.revive(i.uri),targetRange:ge.to(i.range),targetSelectionRange:i.targetSelectionRange?ge.to(i.targetSelectionRange):void 0,originSelectionRange:i.originSelectionRange?ge.to(i.originSelectionRange):void 0}}r.to=t})(iw||(iw={}));var gx;(function(r){function e(i){return{range:ge.from(i.range),contents:zi.fromMany(i.contents)}}r.from=e;function t(i){return new a_(i.contents.map(zi.to),ge.to(i.range))}r.to=t})(gx||(gx={}));var J0;(function(r){function e(i){return{range:ge.from(i.range),expression:i.expression}}r.from=e;function t(i){return new C_(ge.to(i.range),i.expression)}r.to=t})(J0||(J0={}));var mx;(function(r){function e(i){if(i instanceof E_)return{type:"text",range:ge.from(i.range),text:i.text};if(i instanceof x_)return{type:"variable",range:ge.from(i.range),variableName:i.variableName,caseSensitiveLookup:i.caseSensitiveLookup};if(i instanceof D_)return{type:"expression",range:ge.from(i.range),expression:i.expression};throw new Error("Unknown 'InlineValue' type")}r.from=e;function t(i){switch(i.type){case"text":return{range:ge.to(i.range),text:i.text};case"variable":return{range:ge.to(i.range),variableName:i.variableName,caseSensitiveLookup:i.caseSensitiveLookup};case"expression":return{range:ge.to(i.range),expression:i.expression}}}r.to=t})(mx||(mx={}));var Z0;(function(r){function e(i){return{frameId:i.frameId,stoppedLocation:ge.from(i.stoppedLocation)}}r.from=e;function t(i){return new sA(i.frameId,ge.to(i.stoppedLocation))}r.to=t})(Z0||(Z0={}));var vx;(function(r){function e(i){return{range:ge.from(i.range),kind:i.kind}}r.from=e;function t(i){return new c_(ge.to(i.range),i.kind)}r.to=t})(vx||(vx={}));var eL;(function(r){function e(t){switch(t){case 1:return kh.TriggerCharacter;case 2:return kh.TriggerForIncompleteCompletions;case 0:default:return kh.Invoke}}r.to=e})(eL||(eL={}));var tL;(function(r){function e(t){return{triggerKind:eL.to(t.triggerKind),triggerCharacter:t.triggerCharacter}}r.to=e})(tL||(tL={}));var yx;(function(r){function e(i){switch(i){case jg.Deprecated:return 1}}r.from=e;function t(i){switch(i){case 1:return jg.Deprecated}}r.to=t})(yx||(yx={}));var ym;(function(r){const e=new Map([[ht.Method,0],[ht.Function,1],[ht.Constructor,2],[ht.Field,3],[ht.Variable,4],[ht.Class,5],[ht.Interface,7],[ht.Struct,6],[ht.Module,8],[ht.Property,9],[ht.Unit,12],[ht.Value,13],[ht.Constant,14],[ht.Enum,15],[ht.EnumMember,16],[ht.Keyword,17],[ht.Snippet,27],[ht.Text,18],[ht.Color,19],[ht.File,20],[ht.Reference,21],[ht.Folder,23],[ht.Event,10],[ht.Operator,11],[ht.TypeParameter,24],[ht.Issue,26],[ht.User,25]]);function t(s){return e.get(s)??9}r.from=t;const i=new Map([[0,ht.Method],[1,ht.Function],[2,ht.Constructor],[3,ht.Field],[4,ht.Variable],[5,ht.Class],[7,ht.Interface],[6,ht.Struct],[8,ht.Module],[9,ht.Property],[12,ht.Unit],[13,ht.Value],[14,ht.Constant],[15,ht.Enum],[16,ht.EnumMember],[17,ht.Keyword],[27,ht.Snippet],[18,ht.Text],[19,ht.Color],[20,ht.File],[21,ht.Reference],[23,ht.Folder],[10,ht.Event],[11,ht.Operator],[24,ht.TypeParameter],[25,ht.User],[26,ht.Issue]]);function n(s){return i.get(s)??ht.Property}r.to=n})(ym||(ym={}));var iL;(function(r){function e(t,i){var s;const n=new f_(t.label);return n.insertText=t.insertText,n.kind=ym.to(t.kind),n.tags=(s=t.tags)==null?void 0:s.map(yx.to),n.detail=t.detail,n.documentation=qm(t.documentation)?zi.to(t.documentation):t.documentation,n.sortText=t.sortText,n.filterText=t.filterText,n.preselect=t.preselect,n.commitCharacters=t.commitCharacters,qe.isIRange(t.range)?n.range=ge.to(t.range):typeof t.range=="object"&&(n.range={inserting:ge.to(t.range.insert),replacing:ge.to(t.range.replace)}),n.keepWhitespace=typeof t.insertTextRules>"u"?!1:!!(t.insertTextRules&1),typeof t.insertTextRules<"u"&&t.insertTextRules&4?n.insertText=new ru(t.insertText):(n.insertText=t.insertText,n.textEdit=n.range instanceof Tt?new bd(n.range,n.insertText):void 0),t.additionalTextEdits&&t.additionalTextEdits.length>0&&(n.additionalTextEdits=t.additionalTextEdits.map(o=>fr.to(o))),n.command=i&&t.command?i.fromInternal(t.command):void 0,n}r.to=e})(iL||(iL={}));var _x;(function(r){function e(i){if(typeof i.label!="string"&&!Array.isArray(i.label))throw new TypeError("Invalid label");return{label:i.label,documentation:zi.fromStrict(i.documentation)}}r.from=e;function t(i){return{label:i.label,documentation:qm(i.documentation)?zi.to(i.documentation):i.documentation}}r.to=t})(_x||(_x={}));var wx;(function(r){function e(i){return{label:i.label,documentation:zi.fromStrict(i.documentation),parameters:Array.isArray(i.parameters)?i.parameters.map(_x.from):[],activeParameter:i.activeParameter}}r.from=e;function t(i){return{label:i.label,documentation:qm(i.documentation)?zi.to(i.documentation):i.documentation,parameters:Array.isArray(i.parameters)?i.parameters.map(_x.to):[],activeParameter:i.activeParameter}}r.to=t})(wx||(wx={}));var nw;(function(r){function e(i){return{activeSignature:i.activeSignature,activeParameter:i.activeParameter,signatures:Array.isArray(i.signatures)?i.signatures.map(wx.from):[]}}r.from=e;function t(i){return{activeSignature:i.activeSignature,activeParameter:i.activeParameter,signatures:Array.isArray(i.signatures)?i.signatures.map(wx.to):[]}}r.to=t})(nw||(nw={}));var nL;(function(r){function e(t,i){const n=new h_(Wi.to(i.position),typeof i.label=="string"?i.label:i.label.map(rL.to.bind(void 0,t)),i.kind&&bx.to(i.kind));return n.textEdits=i.textEdits&&i.textEdits.map(fr.to),n.tooltip=qm(i.tooltip)?zi.to(i.tooltip):i.tooltip,n.paddingLeft=i.paddingLeft,n.paddingRight=i.paddingRight,n}r.to=e})(nL||(nL={}));var rL;(function(r){function e(t,i){const n=new u_(i.label);return n.tooltip=qm(i.tooltip)?zi.to(i.tooltip):i.tooltip,kY.is(i.command)&&(n.command=t.fromInternal(i.command)),i.location&&(n.location=So.to(i.location)),n}r.to=e})(rL||(rL={}));var bx;(function(r){function e(i){return i}r.from=e;function t(i){return i}r.to=t})(bx||(bx={}));var jh;(function(r){function e(i){return{range:ge.from(i.range),url:i.target,tooltip:i.tooltip}}r.from=e;function t(i){let n;if(i.url)try{n=typeof i.url=="string"?k.parse(i.url,!0):k.revive(i.url)}catch{}return new g_(ge.to(i.range),n)}r.to=t})(jh||(jh={}));var Sx;(function(r){function e(i){const n=new v_(i.label);return i.textEdit&&(n.textEdit=fr.to(i.textEdit)),i.additionalTextEdits&&(n.additionalTextEdits=i.additionalTextEdits.map(s=>fr.to(s))),n}r.to=e;function t(i){return{label:i.label,textEdit:i.textEdit?fr.from(i.textEdit):void 0,additionalTextEdits:i.additionalTextEdits?i.additionalTextEdits.map(n=>fr.from(n)):void 0}}r.from=t})(Sx||(Sx={}));var _m;(function(r){function e(i){return new pf(i[0],i[1],i[2],i[3])}r.to=e;function t(i){return[i.red,i.green,i.blue,i.alpha]}r.from=t})(_m||(_m={}));var sL;(function(r){function e(i){return{range:ge.from(i.range)}}r.from=e;function t(i){return new Hg(ge.to(i.range))}r.to=t})(sL||(sL={}));var Cx;(function(r){function e(t){switch(t){case 2:return Th.AfterDelay;case 1:return Th.Manual;case 3:case 4:return Th.FocusOut}}r.to=e})(Cx||(Cx={}));var gg;(function(r){function e(i){switch(i){case ic.Off:return 0;case ic.Relative:return 2;case ic.On:default:return 1}}r.from=e;function t(i){switch(i){case 0:return ic.Off;case 2:return ic.Relative;case 1:default:return ic.On}}r.to=t})(gg||(gg={}));var wm;(function(r){function e(i){if(i===Bo.CRLF)return 1;if(i===Bo.LF)return 0}r.from=e;function t(i){if(i===1)return Bo.CRLF;if(i===0)return Bo.LF}r.to=t})(wm||(wm={}));var oL;(function(r){function e(t){if(typeof t=="object")return t.viewId;switch(t){case Wl.SourceControl:return 3;case Wl.Window:return 10;case Wl.Notification:return 15}throw new Error("Unknown 'ProgressLocation'")}r.from=e})(oL||(oL={}));var Ex;(function(r){function e(i){const n={start:i.start+1,end:i.end+1};return i.kind&&(n.kind=xx.from(i.kind)),n}r.from=e;function t(i){const n={start:i.start-1,end:i.end-1};return i.kind&&(n.kind=xx.to(i.kind)),n}r.to=t})(Ex||(Ex={}));var xx;(function(r){function e(i){if(i)switch(i){case nc.Comment:return tp.Comment;case nc.Imports:return tp.Imports;case nc.Region:return tp.Region}}r.from=e;function t(i){if(i)switch(i.value){case tp.Comment.value:return nc.Comment;case tp.Imports.value:return nc.Imports;case tp.Region.value:return nc.Region}}r.to=t})(xx||(xx={}));var Dy;(function(r){function e(t){if(t)return{pinned:typeof t.preview=="boolean"?!t.preview:void 0,inactive:t.background,preserveFocus:t.preserveFocus,selection:typeof t.selection=="object"?ge.from(t.selection):void 0,override:typeof t.override=="boolean"?fd.id:void 0}}r.from=e})(Dy||(Dy={}));var lo;(function(r){function e(s){return s instanceof Rh?s.toJSON():typeof s=="string"?s:t(s)||i(s)?new Rh(s.baseUri??s.base,s.pattern).toJSON():s}r.from=e;function t(s){const o=s;return o?k.isUri(o.baseUri)&&typeof o.pattern=="string":!1}function i(s){const o=s;return o?typeof o.base=="string"&&typeof o.pattern=="string":!1}function n(s){return typeof s=="string"?s:new Rh(k.revive(s.baseUri),s.pattern)}r.to=n})(lo||(lo={}));var aL;(function(r){function e(t){if(t){if(Array.isArray(t))return t.map(e);if(typeof t=="string")return t;{const i=t;return{language:i.language,scheme:i.scheme,pattern:lo.from(i.pattern),exclusive:i.exclusive,notebookType:i.notebookType}}}else return}r.from=e})(aL||(aL={}));var mc;(function(r){function e(i){return{start:i.start,end:i.end}}r.from=e;function t(i){return new Zc(i.start,i.end)}r.to=t})(mc||(mc={}));var bm;(function(r){function e(i){return{timing:typeof i.runStartTime=="number"&&typeof i.runEndTime=="number"?{startTime:i.runStartTime,endTime:i.runEndTime}:void 0,executionOrder:i.executionOrder,success:i.lastRunSuccess}}r.to=e;function t(i){var n,s;return{lastRunSuccess:i.success,runStartTime:(n=i.timing)==null?void 0:n.startTime,runEndTime:(s=i.timing)==null?void 0:s.endTime,executionOrder:i.executionOrder}}r.from=t})(bm||(bm={}));var cL;(function(r){function e(t){if(t===_y.Unconfirmed)return Yg.Pending;if(t===_y.Pending)return;if(t===_y.Executing)return Yg.Executing;throw new Error(`Unknown state: ${t}`)}r.to=e})(cL||(cL={}));var rw;(function(r){function e(i){switch(i){case dh.Markup:return jp.Markup;case dh.Code:default:return jp.Code}}r.from=e;function t(i){switch(i){case jp.Markup:return dh.Markup;case jp.Code:default:return dh.Code}}r.to=t})(rw||(rw={}));var eh;(function(r){function e(i){const n={metadata:i.metadata??Object.create(null),cells:[]};for(const s of i.cells)Lk.validate(s),n.cells.push(sw.from(s));return n}r.from=e;function t(i){const n=new gz(i.cells.map(sw.to));return Dg(i.metadata)||(n.metadata=i.metadata),n}r.to=t})(eh||(eh={}));var sw;(function(r){function e(i){return{cellKind:rw.from(i.kind),language:i.languageId,mime:i.mime,source:i.value,metadata:i.metadata,internalMetadata:bm.from(i.executionSummary??{}),outputs:i.outputs?i.outputs.map(uu.from):[]}}r.from=e;function t(i){return new Lk(rw.to(i.cellKind),i.source,i.language,i.mime,i.outputs?i.outputs.map(uu.to):void 0,i.metadata,i.internalMetadata?bm.to(i.internalMetadata):void 0)}r.to=t})(sw||(sw={}));var Sm;(function(r){function e(i){return{mime:i.mime,valueBytes:De.wrap(i.data)}}r.from=e;function t(i){return new R1(i.valueBytes.buffer,i.mime)}r.to=t})(Sm||(Sm={}));var uu;(function(r){function e(i){return{outputId:i.id,items:i.items.map(Sm.from),metadata:i.metadata}}r.from=e;function t(i){const n=i.items.map(Sm.to);return new aE(n,i.outputId,i.metadata)}r.to=t})(uu||(uu={}));var Dx;(function(r){function e(n){return i(n)?{include:ii(lo.from(n.include)),exclude:ii(lo.from(n.exclude))}:ii(lo.from(n))}r.from=e;function t(n){return i(n)?{include:lo.to(n.include),exclude:lo.to(n.exclude)}:lo.to(n)}r.to=t;function i(n){const s=n;return s?!Wo(s.include)&&!Wo(s.exclude):!1}})(Dx||(Dx={}));var dL;(function(r){function e(t,i,n){const s=typeof t.command=="string"?{title:"",command:t.command}:t.command;return{alignment:t.alignment===cE.Left?1:2,command:i.toInternal(s,n),text:t.text,tooltip:t.tooltip,accessibilityInformation:t.accessibilityInformation,priority:t.priority}}r.from=e})(dL||(dL={}));var lL;(function(r){function e(t,i,n){const s=typeof t.command=="string"?{title:"",command:t.command}:t.command;return{command:i.toInternal(s,n),label:t.label,description:t.description,detail:t.detail,documentation:t.documentation}}r.from=e})(lL||(lL={}));var uL;(function(r){function e(t){return{transientOutputs:(t==null?void 0:t.transientOutputs)??!1,transientCellMetadata:(t==null?void 0:t.transientCellMetadata)??{},transientDocumentMetadata:(t==null?void 0:t.transientDocumentMetadata)??{},cellContentMetadata:(t==null?void 0:t.cellContentMetadata)??{}}}r.from=e})(uL||(uL={}));var kx;(function(r){function e(i){return{uri:i.uri,provides:i.provides}}r.from=e;function t(i){return new mz(k.revive(i.uri),i.provides)}r.to=t})(kx||(kx={}));var ow;(function(r){function e(i){return{message:zi.fromStrict(i.message)||"",type:0,expected:i.expectedOutput,actual:i.actualOutput,location:i.location&&{range:ge.from(i.location.range),uri:i.location.uri}}}r.from=e;function t(i){const n=new I_(typeof i.message=="string"?i.message:zi.to(i.message));return n.actualOutput=i.actual,n.expectedOutput=i.expected,n.location=i.location?So.to(i.location):void 0,n}r.to=t})(ow||(ow={}));var Ma;(function(r){r.namespace=FS,r.denamespace=w5})(Ma||(Ma={}));var hu;(function(r){function e(i){const n=GT(i).controllerId;return{extId:Et.fromExtHostTestItem(i,n).toString(),label:i.label,uri:k.revive(i.uri),busy:i.busy,tags:i.tags.map(s=>Ma.namespace(n,s.id)),range:qe.lift(ge.from(i.range)),description:i.description||null,sortText:i.sortText||null,error:i.error&&zi.fromStrict(i.error)||null}}r.from=e;function t(i){return{parent:void 0,error:void 0,id:Et.fromString(i.extId).localId,label:i.label,uri:k.revive(i.uri),tags:(i.tags||[]).map(n=>{const{tagId:s}=Ma.denamespace(n);return new Jg(s)}),children:{add:()=>{},delete:()=>{},forEach:()=>{},*[Symbol.iterator](){},get:()=>{},replace:()=>{},size:0},range:ge.to(i.range||void 0),canResolveChildren:!1,busy:i.busy,description:i.description||void 0,sortText:i.sortText||void 0}}r.toPlain=t})(hu||(hu={}));(function(r){function e(i){return{id:i.id}}r.from=e;function t(i){return new Jg(i.id)}r.to=t})(Ma||(Ma={}));var hL;(function(r){const e=(i,n)=>{const s=[];for(const[a,c]of n)Et.compare(c.item.extId,a)===2&&(n.delete(a),s.push(c));const o={...hu.toPlain(i.item),parent:void 0,taskStates:i.tasks.map(a=>({state:a.state,duration:a.duration,messages:a.messages.filter(c=>c.type===0).map(ow.to)})),children:s.map(a=>e(a,n))};for(const a of o.children)a.parent=o;return o};function t(i){const n=[],s=new Map;for(const o of i.items){s.set(o.item.extId,o);const a=Et.root(o.item.extId);i.request.targets.some(c=>c.controllerId===a&&c.testIds.includes(o.item.extId))&&n.push(o)}return{completedAt:i.completedAt,results:n.map(o=>e(o,s))}}r.to=t})(hL||(hL={}));var Tx;(function(r){function e(s){return{covered:s.covered,total:s.covered}}function t(s){return"line"in s?Wi.from(s):ge.from(s)}function i(s){return"branches"in s?{count:s.executionCount,location:t(s.location),type:1,branches:s.branches.length?s.branches.map(o=>({count:o.executionCount,location:o.location&&t(o.location)})):void 0}:{type:0,count:s.executionCount,location:t(s.location)}}r.fromDetailed=i;function n(s){var o;return{uri:s.uri,statement:e(s.statementCoverage),branch:s.branchCoverage&&e(s.branchCoverage),function:s.functionCoverage&&e(s.functionCoverage),details:(o=s.detailedCoverage)==null?void 0:o.map(i)}}r.fromFile=n})(Tx||(Tx={}));var fL;(function(r){function e(t){switch(t){case 1:return uf.Invoke;case 2:return uf.Automatic}}r.to=e})(fL||(fL={}));var Bh;(function(r){function e(i){const n=new Fk(Jo.to(i.kind),i.name,i.detail||"",k.revive(i.uri),ge.to(i.range),ge.to(i.selectionRange));return n._sessionId=i._sessionId,n._itemId=i._itemId,n}r.to=e;function t(i,n,s){var o;if(n=n??i._sessionId,s=s??i._itemId,n===void 0||s===void 0)throw new Error("invalid item");return{_sessionId:n,_itemId:s,kind:Jo.from(i.kind),name:i.name,detail:i.detail??"",uri:i.uri,range:ge.from(i.range),selectionRange:ge.from(i.selectionRange),tags:(o=i.tags)==null?void 0:o.map(xd.from)}}r.from=t})(Bh||(Bh={}));var Ix;(function(r){function e(t){if(t)return{value:t.value,tooltip:t.tooltip}}r.from=e})(Ix||(Ix={}));var Rx;(function(r){function e(s,o,a){const c=o.fileData;return c?new ste(new ote(c.name,k.revive(c.uri),c.id,eb(()=>a(c.id)))):s===wg.uriList&&o.uriListData?new YC(n(o.uriListData)):new YC(o.asString)}r.to=e;async function t(s,o){const a=await o.asString();if(s===wg.uriList)return{asString:a,fileData:void 0,uriListData:i(a)};const c=o.asFile();return{asString:a,fileData:c?{name:c.name,uri:c.uri,id:c._itemId??c.id}:void 0}}r.from=t;function i(s){return Jy.split(s).map(o=>{if(o.startsWith("#"))return o;try{return k.parse(o)}catch{}return o})}function n(s){return Jy.create(s.map(o=>typeof o=="string"?o:k.revive(o)))}})(Rx||(Rx={}));var Qo;(function(r){function e(i,n){const s=i.items.map(([o,a])=>[o,Rx.to(o,a,n)]);return new Vg(s)}r.toDataTransfer=e;async function t(i){const n={items:[]},s=[];for(const[o,a]of i)s.push((async()=>{n.items.push([o,await Rx.from(o,a)])})());return await Promise.all(s),n}r.from=t})(Qo||(Qo={}));var mg;(function(r){function e(i){return{message:i.message,metadata:i.metadata,title:i.title,tooltip:i.tooltip}}r.to=e;function t(i){return{kind:"reply",message:i.message,metadata:i.metadata,title:i.title,tooltip:i.tooltip}}r.from=t})(mg||(mg={}));var pL;(function(r){function e(t){return typeof t=="string"?{title:t,message:t,kind:"reply"}:"commandId"in t?{kind:"command",title:t.title??"",commandId:t.commandId??"",args:t.args}:mg.from(t)}r.from=e})(pL||(pL={}));const KT=re("IURITransformerService");class gfe{constructor(e){e?(this.transformIncoming=e.transformIncoming.bind(e),this.transformOutgoing=e.transformOutgoing.bind(e),this.transformOutgoingURI=e.transformOutgoingURI.bind(e),this.transformOutgoingScheme=e.transformOutgoingScheme.bind(e)):(this.transformIncoming=t=>t,this.transformOutgoing=t=>t,this.transformOutgoingURI=t=>t,this.transformOutgoingScheme=t=>t)}}function aw(r,e,t){return new GN(i=>L$(i,t)).isEqual(r,e)}function mfe(r,e,t){return aw(r.uri,e.uri,t)?0:Sa(r.uri.toString(),e.uri.toString())}function vfe(r,e,t){return r.index!==e.index?r.index<e.index?-1:1:aw(r.uri,e.uri,t)?Sa(r.name,e.name):Sa(r.uri.toString(),e.uri.toString())}function C5(r,e,t,i){const n=r.slice(0).sort((o,a)=>t(o,a,i)),s=e.slice(0).sort((o,a)=>t(o,a,i));return RY(n,s,(o,a)=>t(o,a,i))}function L$(r,e){const t=e.getCapabilities(r.scheme);return!(t&&t&1024)}class vg extends PY{static toExtHostWorkspace(e,t,i,n){if(!e)return{workspace:null,added:[],removed:[]};const{id:s,name:o,folders:a,configuration:c,transient:d,isUntitled:l}=e,u=[],h=t;t?a.forEach((_,b)=>{const E=k.revive(_.uri),D=vg._findFolder(i||t,E,n);D?(D.name=_.name,D.index=_.index,u.push(D)):u.push({uri:E,name:_.name,index:b})}):u.push(...a.map(({uri:_,name:b,index:E})=>({uri:k.revive(_),name:b,index:E}))),u.sort((_,b)=>_.index<b.index?-1:1);const g=new vg(s,o,u,!!d,c?k.revive(c):null,!!l,_=>L$(_,n)),{added:m,removed:y}=C5(h?h.workspaceFolders:[],g.workspaceFolders,mfe,n);return{workspace:g,added:m,removed:y}}static _findFolder(e,t,i){for(let n=0;n<e.folders.length;n++){const s=e.workspaceFolders[n];if(aw(s.uri,t,i))return s}}constructor(e,t,i,n,s,o,a){super(e,i.map(c=>new Eq(c)),n,s,a),this._name=t,this._isUntitled=o,this._workspaceFolders=[],this._structure=pc.forUris(a),i.forEach(c=>{this._workspaceFolders.push(c),this._structure.set(c.uri,c)})}get name(){return this._name}get isUntitled(){return this._isUntitled}get workspaceFolders(){return this._workspaceFolders.slice(0)}getWorkspaceFolder(e,t){return t&&this._structure.get(e)&&(e=pn(e)),this._structure.findSubstr(e)}resolveWorkspaceFolder(e){return this._structure.get(e)}}let gL=class{constructor(e,t,i,n,s){this._onDidChangeWorkspace=new A,this.onDidChangeWorkspace=this._onDidChangeWorkspace.event,this._onDidGrantWorkspaceTrust=new A,this.onDidGrantWorkspaceTrust=this._onDidGrantWorkspaceTrust.event,this._activeSearchCallbacks=[],this._trusted=!1,this._editSessionIdentityProviders=new Map,this._providerHandlePool=0,this._onWillCreateEditSessionIdentityEvent=new Ml,this._canonicalUriProviders=new Map,this._logService=n,this._extHostFileSystemInfo=i,this._uriTransformerService=s,this._requestIdProvider=new IY,this._barrier=new Cs,this._proxy=e.getProxy(ce.MainThreadWorkspace),this._messageService=e.getProxy(ce.MainThreadMessageService);const o=t.workspace;this._confirmedWorkspace=o?new vg(o.id,o.name,[],!!o.transient,o.configuration?k.revive(o.configuration):null,!!o.isUntitled,a=>L$(a,i)):void 0}$initializeWorkspace(e,t){this._trusted=t,this.$acceptWorkspaceData(e),this._barrier.open()}waitForInitializeCall(){return this._barrier.wait()}get workspace(){return this._actualWorkspace}get name(){return this._actualWorkspace?this._actualWorkspace.name:void 0}get workspaceFile(){if(this._actualWorkspace&&this._actualWorkspace.configuration)return this._actualWorkspace.isUntitled?k.from({scheme:pe.untitled,path:Mt(pn(this._actualWorkspace.configuration))}):this._actualWorkspace.configuration}get _actualWorkspace(){return this._unconfirmedWorkspace||this._confirmedWorkspace}getWorkspaceFolders(){if(this._actualWorkspace)return this._actualWorkspace.workspaceFolders.slice(0)}async getWorkspaceFolders2(){if(await this._barrier.wait(),!!this._actualWorkspace)return this._actualWorkspace.workspaceFolders.slice(0)}updateWorkspaceFolders(e,t,i,...n){const s=[];if(Array.isArray(n)&&n.forEach(l=>{k.isUri(l.uri)&&!s.some(u=>aw(u.uri,l.uri,this._extHostFileSystemInfo))&&s.push({uri:l.uri,name:l.name||Xc(l.uri)})}),this._unconfirmedWorkspace||[t,i].some(l=>typeof l!="number"||l<0)||i===0&&s.length===0)return!1;const o=this._actualWorkspace?this._actualWorkspace.workspaceFolders:[];if(t+i>o.length)return!1;const a=o.slice(0);a.splice(t,i,...s.map(l=>({uri:l.uri,name:l.name||Xc(l.uri),index:void 0})));for(let l=0;l<a.length;l++){const u=a[l];if(a.some((h,g)=>g!==l&&aw(u.uri,h.uri,this._extHostFileSystemInfo)))return!1}a.forEach((l,u)=>l.index=u);const{added:c,removed:d}=C5(o,a,vfe,this._extHostFileSystemInfo);if(c.length===0&&d.length===0)return!1;if(this._proxy){const l=e.displayName||e.name;this._proxy.$updateWorkspaceFolders(l,t,i,s).then(void 0,u=>{this._unconfirmedWorkspace=void 0;const h={source:{identifier:e.identifier,label:e.displayName||e.name}};this._messageService.$showMessage(wn.Error,p("updateerror","Extension '{0}' failed to update workspace folders: {1}",l,u.toString()),h,[])})}return this.trySetWorkspaceFolders(a),!0}getWorkspaceFolder(e,t){if(this._actualWorkspace)return this._actualWorkspace.getWorkspaceFolder(e,t)}async getWorkspaceFolder2(e,t){if(await this._barrier.wait(),!!this._actualWorkspace)return this._actualWorkspace.getWorkspaceFolder(e,t)}async resolveWorkspaceFolder(e){if(await this._barrier.wait(),!!this._actualWorkspace)return this._actualWorkspace.resolveWorkspaceFolder(e)}getPath(){if(!this._actualWorkspace)return;const{folders:e}=this._actualWorkspace;if(e.length!==0)return e[0].uri.fsPath}getRelativePath(e,t){let i,n="";if(typeof e=="string"?(i=k.file(e),n=e):typeof e<"u"&&(i=e,n=e.fsPath),!i)return n;const s=this.getWorkspaceFolder(i,!0);if(!s)return n;typeof t>"u"&&this._actualWorkspace&&(t=this._actualWorkspace.folders.length>1);let o=xg(s.uri,i);return t&&s.name&&(o=`${s.name}/${o}`),o}trySetWorkspaceFolders(e){this._actualWorkspace&&(this._unconfirmedWorkspace=vg.toExtHostWorkspace({id:this._actualWorkspace.id,name:this._actualWorkspace.name,configuration:this._actualWorkspace.configuration,folders:e,isUntitled:this._actualWorkspace.isUntitled},this._actualWorkspace,void 0,this._extHostFileSystemInfo).workspace||void 0)}$acceptWorkspaceData(e){const{workspace:t,added:i,removed:n}=vg.toExtHostWorkspace(e,this._confirmedWorkspace,this._unconfirmedWorkspace,this._extHostFileSystemInfo);this._confirmedWorkspace=t||void 0,this._unconfirmedWorkspace=void 0,this._onDidChangeWorkspace.fire(Object.freeze({added:i,removed:n}))}findFiles(e,t,i,n,s=_t.None){this._logService.trace(`extHostWorkspace#findFiles: fileSearch, extension: ${n.value}, entryPoint: findFiles`);let o;if(t===null?o=!1:t&&(typeof t=="string"?o=t:o=t.pattern),s&&s.isCancellationRequested)return Promise.resolve([]);const{includePattern:a,folder:c}=VB(lo.from(e));return this._proxy.$startFileSearch(ol(a),ol(c),ol(o),ol(i),s).then(d=>Array.isArray(d)?d.map(l=>k.revive(l)):[])}async findTextInFiles(e,t,i,n,s=_t.None){this._logService.trace(`extHostWorkspace#findTextInFiles: textSearch, extension: ${n.value}, entryPoint: findTextInFiles`);const o=this._requestIdProvider.getNext(),a=typeof t.previewOptions>"u"?{matchLines:100,charsPerLine:1e4}:t.previewOptions,{includePattern:c,folder:d}=VB(lo.from(t.include)),l=typeof t.exclude=="string"?t.exclude:t.exclude?t.exclude.pattern:void 0,u={ignoreSymlinks:typeof t.followSymlinks=="boolean"?!t.followSymlinks:void 0,disregardIgnoreFiles:typeof t.useIgnoreFiles=="boolean"?!t.useIgnoreFiles:void 0,disregardGlobalIgnoreFiles:typeof t.useGlobalIgnoreFiles=="boolean"?!t.useGlobalIgnoreFiles:void 0,disregardParentIgnoreFiles:typeof t.useParentIgnoreFiles=="boolean"?!t.useParentIgnoreFiles:void 0,disregardExcludeSettings:typeof t.useDefaultExcludes=="boolean"?!t.useDefaultExcludes:!0,fileEncoding:t.encoding,maxResults:t.maxResults,previewOptions:a,afterContext:t.afterContext,beforeContext:t.beforeContext,includePattern:c,excludePattern:l};if(this._activeSearchCallbacks[o]=h=>{const g=k.revive(h.resource);h.results.forEach(m=>{hg(m)?i({uri:g,preview:{text:m.preview.text,matches:Gy(m.preview.matches,y=>new Tt(y.startLineNumber,y.startColumn,y.endLineNumber,y.endColumn))},ranges:Gy(m.ranges,y=>new Tt(y.startLineNumber,y.startColumn,y.endLineNumber,y.endColumn))}):i({uri:g,text:m.text,lineNumber:m.lineNumber})})},s.isCancellationRequested)return{};try{const h=await this._proxy.$startTextSearch(e,ol(d),u,o,s);return delete this._activeSearchCallbacks[o],h||{}}catch(h){throw delete this._activeSearchCallbacks[o],h}}$handleTextSearchResult(e,t){var i,n;(n=(i=this._activeSearchCallbacks)[t])==null||n.call(i,e)}async save(e){const t=await this._proxy.$save(e,{saveAs:!1});return k.revive(t)}async saveAs(e){const t=await this._proxy.$save(e,{saveAs:!0});return k.revive(t)}saveAll(e){return this._proxy.$saveAll(e)}resolveProxy(e){return this._proxy.$resolveProxy(e)}get trusted(){return this._trusted}requestWorkspaceTrust(e){return this._proxy.$requestWorkspaceTrust(e)}$onDidGrantWorkspaceTrust(){this._trusted||(this._trusted=!0,this._onDidGrantWorkspaceTrust.fire())}registerEditSessionIdentityProvider(e,t){if(this._editSessionIdentityProviders.has(e))throw new Error(`A provider has already been registered for scheme ${e}`);this._editSessionIdentityProviders.set(e,t);const i=this._uriTransformerService.transformOutgoingScheme(e),n=this._providerHandlePool++;return this._proxy.$registerEditSessionIdentityProvider(n,i),ot(()=>{this._editSessionIdentityProviders.delete(e),this._proxy.$unregisterEditSessionIdentityProvider(n)})}async $getEditSessionIdentifier(e,t){this._logService.info("Getting edit session identifier for workspaceFolder",e);const i=await this.resolveWorkspaceFolder(k.revive(e));if(!i){this._logService.warn("Unable to resolve workspace folder");return}this._logService.info("Invoking #provideEditSessionIdentity for workspaceFolder",i);const n=this._editSessionIdentityProviders.get(i.uri.scheme);if(this._logService.info(`Provider for scheme ${i.uri.scheme} is defined: `,!!n),!n)return;const s=await n.provideEditSessionIdentity(i,t);if(this._logService.info("Provider returned edit session identifier: ",s),!!s)return s}async $provideEditSessionIdentityMatch(e,t,i,n){var c;this._logService.info("Getting edit session identifier for workspaceFolder",e);const s=await this.resolveWorkspaceFolder(k.revive(e));if(!s){this._logService.warn("Unable to resolve workspace folder");return}this._logService.info("Invoking #provideEditSessionIdentity for workspaceFolder",s);const o=this._editSessionIdentityProviders.get(s.uri.scheme);if(this._logService.info(`Provider for scheme ${s.uri.scheme} is defined: `,!!o),!o)return;const a=await((c=o.provideEditSessionIdentityMatch)==null?void 0:c.call(o,t,i,n));if(this._logService.info("Provider returned edit session identifier match result: ",a),!!a)return a}getOnWillCreateEditSessionIdentityEvent(e){return(t,i,n)=>{const s=function(a){t.call(i,a)};return s.extension=e,this._onWillCreateEditSessionIdentityEvent.event(s,void 0,n)}}async $onWillCreateEditSessionIdentity(e,t,i){const n=await this.resolveWorkspaceFolder(k.revive(e));if(n===void 0)throw new Error("Unable to resolve workspace folder");await this._onWillCreateEditSessionIdentityEvent.fireAsync({workspaceFolder:n},t,async(s,o)=>{const a=Date.now();await Promise.resolve(s),Date.now()-a>i&&this._logService.warn("SLOW edit session create-participant",o.extension.identifier)}),t.isCancellationRequested}registerCanonicalUriProvider(e,t){if(this._canonicalUriProviders.has(e))throw new Error(`A provider has already been registered for scheme ${e}`);this._canonicalUriProviders.set(e,t);const i=this._uriTransformerService.transformOutgoingScheme(e),n=this._providerHandlePool++;return this._proxy.$registerCanonicalUriProvider(n,i),ot(()=>{this._canonicalUriProviders.delete(e),this._proxy.$unregisterCanonicalUriProvider(n)})}async provideCanonicalUri(e,t,i){var o;const n=this._canonicalUriProviders.get(e.scheme);if(!n)return;const s=await((o=n.provideCanonicalUri)==null?void 0:o.call(n,k.revive(e),t,i));if(s)return s}async $provideCanonicalUri(e,t,i){return this.provideCanonicalUri(k.revive(e),{targetScheme:t},i)}};gL=T([v(0,Ii),v(1,Gr),v(2,iv),v(3,ze),v(4,KT)],gL);const $d=re("IExtHostWorkspace");function VB(r){let e,t;return r&&(typeof r=="string"?e=r:(e=r.pattern,t=k.revive(r.baseUri))),{includePattern:e,folder:t}}function Rv(r,e){if(e){const t=e.split(".");let i=r;for(let n=0;i&&n<t.length;n++)i=i[t[n]];return i}}function yfe(r){return r instanceof k}function _fe(r){return r&&r.uri instanceof k&&r.languageId&&typeof r.languageId=="string"}function wfe(r){return r&&!r.uri&&r.languageId&&typeof r.languageId=="string"}function bfe(r){return r&&r.uri instanceof k&&(!r.name||typeof r.name=="string")&&(!r.index||typeof r.index=="number")}function qB(r){if(yfe(r))return{resource:r};if(_fe(r))return{resource:r.uri,overrideIdentifier:r.languageId};if(wfe(r))return{overrideIdentifier:r.languageId};if(bfe(r))return{resource:r.uri};if(r===null)return{resource:null}}let mL=class{constructor(e,t,i){this._proxy=e.getProxy(ce.MainThreadConfiguration),this._extHostWorkspace=t,this._logService=i,this._barrier=new Cs,this._actual=null}getConfigProvider(){return this._barrier.wait().then(e=>this._actual)}$initializeConfiguration(e){this._actual=new Sfe(this._proxy,this._extHostWorkspace,e,this._logService),this._barrier.open()}$acceptConfigurationChanged(e,t){this.getConfigProvider().then(i=>i.$acceptConfigurationChanged(e,t))}};mL=T([v(0,Ii),v(1,$d),v(2,ze)],mL);class Sfe{constructor(e,t,i,n){this._onDidChangeConfiguration=new A,this._proxy=e,this._logService=n,this._extHostWorkspace=t,this._configuration=vH.parse(i),this._configurationScopes=this._toMap(i.configurationScopes)}get onDidChangeConfiguration(){return this._onDidChangeConfiguration&&this._onDidChangeConfiguration.event}$acceptConfigurationChanged(e,t){const i={data:this._configuration.toData(),workspace:this._extHostWorkspace.workspace};this._configuration=vH.parse(e),this._configurationScopes=this._toMap(e.configurationScopes),this._onDidChangeConfiguration.fire(this._toConfigurationChangeEvent(t,i))}getConfiguration(e,t,i){const n=qB(t)||{},s=this._toReadonlyValue(e?Rv(this._configuration.getValue(void 0,n,this._extHostWorkspace.workspace),e):this._configuration.getValue(void 0,n,this._extHostWorkspace.workspace));e&&this._validateConfigurationAccess(e,n,i==null?void 0:i.identifier);function o(c){if(c==null)return null;if(typeof c=="boolean")return c?2:5;switch(c){case Ih.Global:return 2;case Ih.Workspace:return 5;case Ih.WorkspaceFolder:return 6}}const a={has(c){return typeof Rv(s,c)<"u"},get:(c,d)=>{this._validateConfigurationAccess(e?`${e}.${c}`:c,n,i==null?void 0:i.identifier);let l=Rv(s,c);if(typeof l>"u")l=d;else{let u;const h=(g,m)=>{if(bn(g)){let y;const _=()=>{u=u||Gi(s),y=y||Rv(u,m)};return new Proxy(g,{get:(b,E)=>{if(typeof E=="string"&&E.toLowerCase()==="tojson")return _(),()=>y;if(u)return y=y||Rv(u,m),y[E];const D=b[E];return typeof E=="string"?h(D,`${m}.${E}`):D},set:(b,E,D)=>(_(),y&&(y[E]=D),!0),deleteProperty:(b,E)=>(_(),y&&delete y[E],!0),defineProperty:(b,E,D)=>(_(),y&&Object.defineProperty(y,E,D),!0)})}return Array.isArray(g)?Gi(g):g};l=h(l,c)}return l},update:(c,d,l,u)=>{c=e?`${e}.${c}`:c;const h=o(l);return d!==void 0?this._proxy.$updateConfigurationOption(h,c,d,n,u):this._proxy.$removeConfigurationOption(h,c,n,u)},inspect:c=>{var l,u,h,g,m,y,_,b,E,D,R;c=e?`${e}.${c}`:c;const d=this._configuration.inspect(c,n,this._extHostWorkspace.workspace);if(d)return{key:c,defaultValue:Gi(((l=d.policy)==null?void 0:l.value)??((u=d.default)==null?void 0:u.value)),globalValue:Gi(((h=d.user)==null?void 0:h.value)??((g=d.application)==null?void 0:g.value)),workspaceValue:Gi((m=d.workspace)==null?void 0:m.value),workspaceFolderValue:Gi((y=d.workspaceFolder)==null?void 0:y.value),defaultLanguageValue:Gi((_=d.default)==null?void 0:_.override),globalLanguageValue:Gi(((b=d.user)==null?void 0:b.override)??((E=d.application)==null?void 0:E.override)),workspaceLanguageValue:Gi((D=d.workspace)==null?void 0:D.override),workspaceFolderLanguageValue:Gi((R=d.workspaceFolder)==null?void 0:R.override),languageIds:Gi(d.overrideIdentifiers)}}};return typeof s=="object"&&tu(a,s,!1),Object.freeze(a)}_toReadonlyValue(e){const t=i=>bn(i)?new Proxy(i,{get:(n,s)=>t(n[s]),set:(n,s,o)=>{throw new Error(`TypeError: Cannot assign to read only property '${String(s)}' of object`)},deleteProperty:(n,s)=>{throw new Error(`TypeError: Cannot delete read only property '${String(s)}' of object`)},defineProperty:(n,s)=>{throw new Error(`TypeError: Cannot define property '${String(s)}' for a readonly object`)},setPrototypeOf:n=>{throw new Error("TypeError: Cannot set prototype for a readonly object")},isExtensible:()=>!1,preventExtensions:()=>!0}):i;return t(e)}_validateConfigurationAccess(e,t,i){const n=AY.test(e)?4:this._configurationScopes.get(e),s=i?`[${i.value}] `:"";if(n===4){typeof(t==null?void 0:t.resource)>"u"&&this._logService.warn(`${s}Accessing a resource scoped configuration without providing a resource is not expected. To get the effective value for '${e}', provide the URI of a resource or 'null' for any resource.`);return}if(n===3){t!=null&&t.resource&&this._logService.warn(`${s}Accessing a window scoped configuration for a resource is not expected. To associate '${e}' to a resource, define its scope to 'resource' in configuration contributions in 'package.json'.`);return}}_toConfigurationChangeEvent(e,t){const i=new MY(e,t,this._configuration,this._extHostWorkspace.workspace);return Object.freeze({affectsConfiguration:(n,s)=>i.affectsConfiguration(n,qB(s))})}_toMap(e){return e.reduce((t,i)=>(t.set(i[0],i[1]),t),new Map)}}const Wd=re("IExtHostConfiguration");class Cm{constructor(e,t,i,n){this.startup=e,this.codeLoadingTime=t,this.activateCallTime=i,this.activateResolvedTime=n}}Cm.NONE=new Cm(!1,-1,-1,-1);class GB{constructor(e){this._startup=e,this._codeLoadingStart=-1,this._codeLoadingStop=-1,this._activateCallStart=-1,this._activateCallStop=-1,this._activateResolveStart=-1,this._activateResolveStop=-1}_delta(e,t){return e===-1||t===-1?-1:t-e}build(){return new Cm(this._startup,this._delta(this._codeLoadingStart,this._codeLoadingStop),this._delta(this._activateCallStart,this._activateCallStop),this._delta(this._activateResolveStart,this._activateResolveStop))}codeLoadingStart(){this._codeLoadingStart=Date.now()}codeLoadingStop(){this._codeLoadingStop=Date.now()}activateCallStart(){this._activateCallStart=Date.now()}activateCallStop(){this._activateCallStop=Date.now()}activateResolveStart(){this._activateResolveStart=Date.now()}activateResolveStop(){this._activateResolveStop=Date.now()}}class QT{constructor(e,t,i,n,s,o){this.activationFailed=e,this.activationFailedError=t,this.activationTimes=i,this.module=n,this.exports=s,this.subscriptions=o}}class Cfe extends QT{constructor(e){super(!1,null,e,{activate:void 0,deactivate:void 0},void 0,[])}}class Efe extends QT{constructor(){super(!1,null,Cm.NONE,{activate:void 0,deactivate:void 0},void 0,[])}}class Px extends QT{constructor(e){super(!0,e,Cm.NONE,{activate:void 0,deactivate:void 0},void 0,[])}}let vL=class{constructor(e,t,i,n){this._logService=n,this._registry=e,this._globalRegistry=t,this._host=i,this._operations=new Ln,this._alreadyActivatedEvents=Object.create(null)}dispose(){for(const[e,t]of this._operations)t.dispose()}async waitForActivatingExtensions(){const e=[];for(const[t,i]of this._operations)e.push(i.wait());await Promise.all(e)}isActivated(e){const t=this._operations.get(e);return!!(t&&t.value)}getActivatedExtension(e){const t=this._operations.get(e);if(!t||!t.value)throw new Error(`Extension '${e.value}' is not known or not activated`);return t.value}async activateByEvent(e,t){if(this._alreadyActivatedEvents[e])return;const i=this._registry.getExtensionDescriptionsForActivationEvent(e);await this._activateExtensions(i.map(n=>({id:n.identifier,reason:{startup:t,extensionId:n.identifier,activationEvent:e}}))),this._alreadyActivatedEvents[e]=!0}activateById(e,t){const i=this._registry.getExtensionDescription(e);if(!i)throw new Error(`Extension '${e}' is not known`);return this._activateExtensions([{id:i.identifier,reason:t}])}async _activateExtensions(e){const t=e.filter(i=>!this.isActivated(i.id)).map(i=>this._handleActivationRequest(i));await Promise.all(t.map(i=>i.wait()))}_handleActivationRequest(e){if(this._operations.has(e.id))return this._operations.get(e.id);if(this._isHostExtension(e.id))return this._createAndSaveOperation(e,null,[],null);const t=this._registry.getExtensionDescription(e.id);if(!t){const s=new Error(`Cannot activate unknown extension '${e.id.value}'`),o=this._createAndSaveOperation(e,null,[],new Px(s));return this._host.onExtensionActivationError(e.id,s,new Vj(e.id.value)),o}const i=[],n=typeof t.extensionDependencies>"u"?[]:t.extensionDependencies;for(const s of n){if(this._isResolvedExtension(s))continue;const o=this._operations.get(s);if(o){i.push(o);continue}if(this._isHostExtension(s)){i.push(this._handleActivationRequest({id:this._globalRegistry.getExtensionDescription(s).identifier,reason:e.reason}));continue}const a=this._registry.getExtensionDescription(s);if(a){if(!a.main&&!a.browser)continue;i.push(this._handleActivationRequest({id:a.identifier,reason:e.reason}));continue}const c=t.displayName||t.identifier.value,d=new Error(`Cannot activate the '${c}' extension because it depends on unknown extension '${s}'`),l=this._createAndSaveOperation(e,t.displayName,[],new Px(d));return this._host.onExtensionActivationError(t.identifier,d,new Vj(s)),l}return this._createAndSaveOperation(e,t.displayName,i,null)}_createAndSaveOperation(e,t,i,n){const s=new yL(e.id,t,e.reason,i,n,this._host,this._logService);return this._operations.set(e.id,s),s}_isHostExtension(e){return Gl.isHostExtension(e,this._registry,this._globalRegistry)}_isResolvedExtension(e){const t=this._globalRegistry.getExtensionDescription(e);return t?!t.main&&!t.browser:!1}};vL=T([v(3,ze)],vL);let yL=class{get value(){return this._value}get friendlyName(){return this._displayName||this._id.value}constructor(e,t,i,n,s,o,a){this._id=e,this._displayName=t,this._reason=i,this._deps=n,this._value=s,this._host=o,this._logService=a,this._barrier=new Cs,this._isDisposed=!1,this._initialize()}dispose(){this._isDisposed=!0}wait(){return this._barrier.wait()}async _initialize(){await this._waitForDepsThenActivate(),this._barrier.open()}async _waitForDepsThenActivate(){if(!this._value){for(;this._deps.length>0;){for(let e=0;e<this._deps.length;e++){const t=this._deps[e];if(t.value&&!t.value.activationFailed){this._deps.splice(e,1),e--;continue}if(t.value&&t.value.activationFailed){const i=new Error(`Cannot activate the '${this.friendlyName}' extension because its dependency '${t.friendlyName}' failed to activate`);i.detail=t.value.activationFailedError,this._value=new Px(i),this._host.onExtensionActivationError(this._id,i,null);return}}this._deps.length>0&&await Promise.race(this._deps.map(e=>e.wait()))}await this._activate()}}async _activate(){try{this._value=await this._host.actualActivateExtension(this._id,this._reason)}catch(e){const t=new Error;if(e&&e.name&&(t.name=e.name),e&&e.message?t.message=`Activating extension '${this._id.value}' failed: ${e.message}.`:t.message=`Activating extension '${this._id.value}' failed: ${e}.`,e&&e.stack&&(t.stack=e.stack),this._value=new Px(t),this._isDisposed&&Ur(e))return;this._host.onExtensionActivationError(this._id,t,null),this._logService.error(`Activating extension ${this._id.value} failed due to an error:`),this._logService.error(e)}}};yL=T([v(6,ze)],yL);class E5{constructor(e,t){this._logService=t,this._onDidChangeStorage=new A,this.onDidChangeStorage=this._onDidChangeStorage.event,this._proxy=e.getProxy(ce.MainThreadStorage)}registerExtensionStorageKeysToSync(e,t){this._proxy.$registerExtensionStorageKeysToSync(e,t)}async initializeExtensionStorage(e,t,i){const n=await this._proxy.$initializeExtensionStorage(e,t);let s;return n&&(s=this.safeParseValue(e,t,n)),s||i}setValue(e,t,i){return this._proxy.$setValue(e,t,i)}$acceptValue(e,t,i){const n=this.safeParseValue(e,t,i);n&&this._onDidChangeStorage.fire({shared:e,key:t,value:n})}safeParseValue(e,t,i){try{return JSON.parse(i)}catch(n){this._logService.error(`[extHostStorage] unexpected error parsing storage contents (extensionId: ${t}, global: ${e}): ${n}`)}}}const F$=re("IExtHostStorage");class x5{constructor(e,t,i){this._deferredPromises=new Map,this._id=e,this._shared=t,this._storage=i,this._init=this._storage.initializeExtensionStorage(this._shared,this._id,Object.create(null)).then(n=>(this._value=n,this)),this._storageListener=this._storage.onDidChangeStorage(n=>{n.shared===this._shared&&n.key===this._id&&(this._value=n.value)}),this._scheduler=new Ys(()=>{const n=this._deferredPromises;this._deferredPromises=new Map,(async()=>{try{await this._storage.setValue(this._shared,this._id,this._value);for(const s of n.values())s.complete()}catch(s){for(const o of n.values())o.error(s)}})()},0)}keys(){return Object.entries(this._value??{}).filter(([,e])=>e!==void 0).map(([e])=>e)}get whenReady(){return this._init}get(e,t){let i=this._value[e];return typeof i>"u"&&(i=t),i}update(e,t){this._value[e]=t;const i=this._deferredPromises.get(e);if(i!==void 0)return i.p;const n=new Hm;return this._deferredPromises.set(e,n),this._scheduler.isScheduled()||this._scheduler.schedule(),n.p}dispose(){this._storageListener.dispose()}}class xfe extends x5{setKeysForSync(e){this._storage.registerExtensionStorageKeysToSync({id:this._id,version:this._extension.version},e)}constructor(e,t){super(e.identifier.value,!0,t),this._extension=e}}let _L=class jc{constructor(e,t){this._fileSystemProvider=new Map,this._writeQueue=new ak,this._proxy=e.getProxy(ce.MainThreadFileSystem);const i=this;this.value=Object.freeze({async stat(n){try{let s;const o=i._fileSystemProvider.get(n.scheme);return o?(await i._proxy.$ensureActivation(n.scheme),s=await o.impl.stat(n)):s=await i._proxy.$stat(n),{type:s.type,ctime:s.ctime,mtime:s.mtime,size:s.size,permissions:s.permissions===ad.Readonly?1:void 0}}catch(s){jc._handleError(s)}},async readDirectory(n){try{const s=i._fileSystemProvider.get(n.scheme);return s?(await i._proxy.$ensureActivation(n.scheme),(await s.impl.readDirectory(n)).slice()):await i._proxy.$readdir(n)}catch(s){return jc._handleError(s)}},async createDirectory(n){try{const s=i._fileSystemProvider.get(n.scheme);return s&&!s.isReadonly?(await i._proxy.$ensureActivation(n.scheme),await i.mkdirp(s.impl,s.extUri,n)):await i._proxy.$mkdir(n)}catch(s){return jc._handleError(s)}},async readFile(n){try{const s=i._fileSystemProvider.get(n.scheme);return s?(await i._proxy.$ensureActivation(n.scheme),(await s.impl.readFile(n)).slice()):(await i._proxy.$readFile(n)).buffer}catch(s){return jc._handleError(s)}},async writeFile(n,s){try{const o=i._fileSystemProvider.get(n.scheme);return o&&!o.isReadonly?(await i._proxy.$ensureActivation(n.scheme),await i.mkdirp(o.impl,o.extUri,o.extUri.dirname(n)),await i._writeQueue.queueFor(n).queue(()=>Promise.resolve(o.impl.writeFile(n,s,{create:!0,overwrite:!0})))):await i._proxy.$writeFile(n,De.wrap(s))}catch(o){return jc._handleError(o)}},async delete(n,s){try{const o=i._fileSystemProvider.get(n.scheme);return o&&!o.isReadonly?(await i._proxy.$ensureActivation(n.scheme),await o.impl.delete(n,{recursive:!1,...s})):await i._proxy.$delete(n,{recursive:!1,useTrash:!1,atomic:!1,...s})}catch(o){return jc._handleError(o)}},async rename(n,s,o){try{return await i._proxy.$rename(n,s,{overwrite:!1,...o})}catch(a){return jc._handleError(a)}},async copy(n,s,o){try{return await i._proxy.$copy(n,s,{overwrite:!1,...o})}catch(a){return jc._handleError(a)}},isWritableFileSystem(n){const s=t.getCapabilities(n);if(typeof s=="number")return!(s&2048)}})}async mkdirp(e,t,i){const n=[];for(;!t.isEqual(i,t.dirname(i));)try{if(!((await e.stat(i)).type&Or.Directory))throw In.FileExists(`Unable to create folder '${i.scheme===pe.file?i.fsPath:i.toString(!0)}' that already exists but is not a directory`);break}catch(s){if(bh(s)!==lt.FileNotFound)throw s;n.push(t.basename(i)),i=t.dirname(i)}for(let s=n.length-1;s>=0;s--){i=t.joinPath(i,n[s]);try{await e.createDirectory(i)}catch(o){if(bh(o)!==lt.FileExists)throw o}}}static _handleError(e){if(e instanceof In)throw e;if(e instanceof Zy)switch(e.code){case lt.FileExists:throw In.FileExists(e.message);case lt.FileNotFound:throw In.FileNotFound(e.message);case lt.FileNotADirectory:throw In.FileNotADirectory(e.message);case lt.FileIsADirectory:throw In.FileIsADirectory(e.message);case lt.NoPermissions:throw In.NoPermissions(e.message);case lt.Unavailable:throw In.Unavailable(e.message);default:throw new In(e.message,e.name)}if(!(e instanceof Error))throw new In(String(e));if(e.name==="ENOPRO"||e.message.includes("ENOPRO"))throw In.Unavailable(e.message);switch(e.name){case lt.FileExists:throw In.FileExists(e.message);case lt.FileNotFound:throw In.FileNotFound(e.message);case lt.FileNotADirectory:throw In.FileNotADirectory(e.message);case lt.FileIsADirectory:throw In.FileIsADirectory(e.message);case lt.NoPermissions:throw In.NoPermissions(e.message);case lt.Unavailable:throw In.Unavailable(e.message);default:throw new In(e.message,e.name)}}addFileSystemProvider(e,t,i){return this._fileSystemProvider.set(e,{impl:t,extUri:i!=null&&i.isCaseSensitive?Yw:bC,isReadonly:!!(i!=null&&i.isReadonly)}),ot(()=>this._fileSystemProvider.delete(e))}};_L=T([v(0,Ii),v(1,iv)],_L);const YT=re("IExtHostConsumerFileSystem"),O$=re("IExtensionStoragePaths");let wL=class{constructor(e,t,i){this._logService=t,this._extHostFileSystem=i,this._workspace=e.workspace??void 0,this._environment=e.environment,this.whenReady=this._getOrCreateWorkspaceStoragePath().then(n=>this._value=n)}async _getWorkspaceStorageURI(e){return k.joinPath(this._environment.workspaceStorageHome,e)}async _getOrCreateWorkspaceStoragePath(){var i;if(!this._workspace)return Promise.resolve(void 0);const e=this._workspace.id,t=await this._getWorkspaceStorageURI(e);try{return await this._extHostFileSystem.value.stat(t),this._logService.trace("[ExtHostStorage] storage dir already exists",t),t}catch{}try{return this._logService.trace("[ExtHostStorage] creating dir and metadata-file",t),await this._extHostFileSystem.value.createDirectory(t),await this._extHostFileSystem.value.writeFile(k.joinPath(t,"meta.json"),new TextEncoder().encode(JSON.stringify({id:this._workspace.id,configuration:(i=k.revive(this._workspace.configuration))==null?void 0:i.toString(),name:this._workspace.name},void 0,2))),t}catch(n){this._logService.error("[ExtHostStorage]",n);return}}workspaceValue(e){if(this._value)return k.joinPath(this._value,e.identifier.value)}globalValue(e){return k.joinPath(this._environment.globalStorageHome,e.identifier.value.toLowerCase())}onWillDeactivateAll(){}};wL=T([v(0,Gr),v(1,ze),v(2,YT)],wL);var bL;(function(r){function e(i){return{remoteAddress:i.remoteAddress,localAddress:i.localAddress,public:!!i.public,privacy:i.privacy??(i.public?Sl.Public:Sl.Private),protocol:i.protocol}}r.fromApiTunnel=e;function t(i){return{remoteAddress:{host:i.tunnelRemoteHost,port:i.tunnelRemotePort},localAddress:i.localAddress,public:i.privacy!==Sl.ConstantPrivate&&i.privacy!==Sl.ConstantPrivate,privacy:i.privacy,protocol:i.protocol}}r.fromServiceTunnel=t})(bL||(bL={}));const N$=re("IExtHostTunnelService");let SL=class{constructor(e){this.onDidChangeTunnels=new A().event}async $applyCandidateFilter(e){return e}async openTunnel(e,t){}async getTunnels(){return[]}async setTunnelFactory(e){return{dispose:()=>{}}}registerPortsAttributesProvider(e,t){return{dispose:()=>{}}}async $providePortAttributes(e,t,i,n,s){return[]}async $forwardPort(e,t){}async $closeTunnel(e){}async $onDidTunnelsChange(){}async $registerCandidateFinder(){}};SL=T([v(0,Ii)],SL);function $$(r){return[...r.entries()]}function D5(r){return r?[...r.entries()]:[]}function k5(r){return new Map(r)}function T5(r){return new Map(r??[])}function j0e(r){return Array.from(r.entries()).map(e=>[e[0],$$(e[1].map),D5(e[1].descriptionMap)])}function B0e(r){return new Map(r.map(e=>[e[0],{map:k5(e[1]),descriptionMap:T5(e[2])}]))}class I5{constructor(e){this._callback=e,this._terminalBufferMap=new Map}dispose(){for(const e of this._terminalBufferMap.values())e.dispose()}startBuffering(e,t,i=5){const n=t(s=>{const o=typeof s=="string"?s:s.data;let a=this._terminalBufferMap.get(e);if(a){a.data.push(o);return}const c=setTimeout(()=>this.flushBuffer(e),i);a={data:[o],timeoutId:c,dispose:()=>{clearTimeout(c),this.flushBuffer(e),n.dispose()}},this._terminalBufferMap.set(e,a)});return n}stopBuffering(e){const t=this._terminalBufferMap.get(e);t==null||t.dispose()}flushBuffer(e){const t=this._terminalBufferMap.get(e);t&&(this._terminalBufferMap.delete(e),this._callback(e,t.data.join("")))}}const pb=re("IExtHostTerminalService");class zB{constructor(e,t,i,n){this._proxy=e,this._id=t,this._creationOptions=i,this._name=n,this._disposed=!1,this._state={isInteractedWith:!1},this.isOpen=!1,this._creationOptions=Object.freeze(this._creationOptions),this._pidPromise=new Promise(o=>this._pidPromiseComplete=o);const s=this;this.value={get name(){return s._name||""},get processId(){return s._pidPromise},get creationOptions(){return s._creationOptions},get exitStatus(){return s._exitStatus},get state(){return s._state},sendText(o,a=!0){s._checkDisposed(),s._proxy.$sendText(s._id,o,a)},show(o){s._checkDisposed(),s._proxy.$show(s._id,o)},hide(){s._checkDisposed(),s._proxy.$hide(s._id)},dispose(){s._disposed||(s._disposed=!0,s._proxy.$dispose(s._id))},get dimensions(){if(!(s._cols===void 0||s._rows===void 0))return{columns:s._cols,rows:s._rows}}}}async create(e,t){if(typeof this._id!="string")throw new Error("Terminal has already been created");await this._proxy.$createTerminal(this._id,{name:e.name,shellPath:ii(e.shellPath),shellArgs:ii(e.shellArgs),cwd:ii(e.cwd),env:ii(e.env),icon:ii(R5(e.iconPath)),color:RP.isThemeColor(e.color)?e.color.id:void 0,initialText:ii(e.message),strictEnv:ii(e.strictEnv),hideFromUser:ii(e.hideFromUser),isFeatureTerminal:ii(t==null?void 0:t.isFeatureTerminal),isExtensionOwnedTerminal:!0,useShellEnvironment:ii(t==null?void 0:t.useShellEnvironment),location:(t==null?void 0:t.location)||this._serializeParentTerminal(e.location,t==null?void 0:t.resolvedExtHostIdentifier),isTransient:ii(e.isTransient)})}async createExtensionTerminal(e,t,i,n){if(typeof this._id!="string")throw new Error("Terminal has already been created");if(await this._proxy.$createTerminal(this._id,{name:this._name,isExtensionCustomPtyTerminal:!0,icon:i,color:RP.isThemeColor(n)?n.id:void 0,location:this._serializeParentTerminal(e,t),isTransient:!0}),typeof this._id=="string")throw new Error("Terminal creation failed");return this._id}_serializeParentTerminal(e,t){return typeof e=="object"?"parentTerminal"in e&&e.parentTerminal&&t?{parentTerminal:t}:"viewColumn"in e?{viewColumn:Hn.from(e.viewColumn),preserveFocus:e.preserveFocus}:void 0:e}_checkDisposed(){if(this._disposed)throw new Error("Terminal has already been disposed")}set name(e){this._name=e}setExitStatus(e,t){this._exitStatus=Object.freeze({code:e,reason:t})}setDimensions(e,t){return e===this._cols&&t===this._rows||e===0||t===0?!1:(this._cols=e,this._rows=t,!0)}setInteractedWith(){return this._state.isInteractedWith?!1:(this._state={isInteractedWith:!0},!0)}_setProcessId(e){this._pidPromiseComplete?(this._pidPromiseComplete(e),this._pidPromiseComplete=void 0):this._pidPromise.then(t=>{t!==e&&(this._pidPromise=Promise.resolve(e))})}}class KR{get onProcessReady(){return this._onProcessReady.event}constructor(e){this._pty=e,this.id=0,this.shouldPersist=!1,this._onProcessData=new A,this.onProcessData=this._onProcessData.event,this._onProcessReady=new A,this._onDidChangeProperty=new A,this.onDidChangeProperty=this._onDidChangeProperty.event,this._onProcessExit=new A,this.onProcessExit=this._onProcessExit.event}refreshProperty(e){throw new Error(`refreshProperty is not suppported in extension owned terminals. property: ${e}`)}updateProperty(e,t){throw new Error(`updateProperty is not suppported in extension owned terminals. property: ${e}, value: ${t}`)}async start(){}shutdown(){this._pty.close()}input(e){var t,i;(i=(t=this._pty).handleInput)==null||i.call(t,e)}resize(e,t){var i,n;(n=(i=this._pty).setDimensions)==null||n.call(i,{columns:e,rows:t})}clearBuffer(){}async processBinary(e){}acknowledgeDataEvent(e){}async setUnicodeVersion(e){}getInitialCwd(){return Promise.resolve("")}getCwd(){return Promise.resolve("")}getLatency(){return Promise.resolve(0)}startSendingEvents(e){var t,i,n,s,o,a,c,d;this._pty.onDidWrite(l=>this._onProcessData.fire(l)),(i=(t=this._pty).onDidClose)==null||i.call(t,(l=void 0)=>{this._onProcessExit.fire(l===void 0?void 0:l)}),(s=(n=this._pty).onDidOverrideDimensions)==null||s.call(n,l=>{l&&this._onDidChangeProperty.fire({type:"overrideDimensions",value:{cols:l.columns,rows:l.rows}})}),(a=(o=this._pty).onDidChangeName)==null||a.call(o,l=>{this._onDidChangeProperty.fire({type:"title",value:l})}),this._pty.open(e||void 0),e&&((d=(c=this._pty).setDimensions)==null||d.call(c,e)),this._onProcessReady.fire({pid:-1,cwd:"",windowsPty:void 0})}}let Dfe=1,CL=class extends ne{get activeTerminal(){var e;return(e=this._activeTerminal)==null?void 0:e.value}get terminals(){return this._terminals.map(e=>e.value)}get onDidWriteTerminalData(){return this._onDidWriteTerminalData.event}constructor(e,t){super(),this._terminals=[],this._terminalProcesses=new Map,this._terminalProcessDisposables={},this._extensionTerminalAwaitingStart={},this._getTerminalPromises={},this._environmentVariableCollections=new Map,this._linkProviders=new Set,this._profileProviders=new Map,this._quickFixProviders=new Map,this._terminalLinkCache=new Map,this._terminalLinkCancellationSource=new Map,this._onDidCloseTerminal=new A,this.onDidCloseTerminal=this._onDidCloseTerminal.event,this._onDidOpenTerminal=new A,this.onDidOpenTerminal=this._onDidOpenTerminal.event,this._onDidChangeActiveTerminal=new A,this.onDidChangeActiveTerminal=this._onDidChangeActiveTerminal.event,this._onDidChangeTerminalDimensions=new A,this.onDidChangeTerminalDimensions=this._onDidChangeTerminalDimensions.event,this._onDidChangeTerminalState=new A,this.onDidChangeTerminalState=this._onDidChangeTerminalState.event,this._onDidChangeShell=new A,this.onDidChangeShell=this._onDidChangeShell.event,this._proxy=t.getProxy(ce.MainThreadTerminalService),this._bufferer=new I5(this._proxy.$sendProcessData),this._onDidWriteTerminalData=new A({onWillAddFirstListener:()=>this._proxy.$startSendingDataEvents(),onDidRemoveLastListener:()=>this._proxy.$stopSendingDataEvents()}),this._proxy.$registerProcessSupport(e),this._register({dispose:()=>{for(const[i,n]of this._terminalProcesses)n.shutdown(!0)}})}getDefaultShell(e){const t=e?this._defaultAutomationProfile:this._defaultProfile;return(t==null?void 0:t.path)||""}getDefaultShellArgs(e){const t=e?this._defaultAutomationProfile:this._defaultProfile;return(t==null?void 0:t.args)||[]}createExtensionTerminal(e,t){const i=new zB(this._proxy,Nn(),e,e.name),n=new KR(e.pty);return i.createExtensionTerminal(e.location,this._serializeParentTerminal(e,t).resolvedExtHostIdentifier,R5(e.iconPath),Tfe(e.color)).then(s=>{const o=this._setupExtHostProcessListeners(s,n);this._terminalProcessDisposables[s]=o}),this._terminals.push(i),i.value}_serializeParentTerminal(e,t){if(t=t||{},e.location&&typeof e.location=="object"&&"parentTerminal"in e.location){const i=e.location.parentTerminal;if(i){const n=this._terminals.find(s=>s.value===i);n&&(t.resolvedExtHostIdentifier=n._id)}}else e.location&&typeof e.location!="object"?t.location=e.location:t.location&&typeof t.location=="object"&&"splitActiveTerminal"in t.location&&(t.location={splitActiveTerminal:!0});return t}attachPtyToTerminal(e,t){if(!this._getTerminalById(e))throw new Error(`Cannot resolve terminal with id ${e} for virtual process`);const n=new KR(t),s=this._setupExtHostProcessListeners(e,n);this._terminalProcessDisposables[e]=s}async $acceptActiveTerminalChanged(e){const t=this._activeTerminal;if(e===null){this._activeTerminal=void 0,t!==this._activeTerminal&&this._onDidChangeActiveTerminal.fire(this._activeTerminal);return}const i=this._getTerminalById(e);i&&(this._activeTerminal=i,t!==this._activeTerminal&&this._onDidChangeActiveTerminal.fire(this._activeTerminal.value))}async $acceptTerminalProcessData(e,t){const i=this._getTerminalById(e);i&&this._onDidWriteTerminalData.fire({terminal:i.value,data:t})}async $acceptTerminalDimensions(e,t,i){const n=this._getTerminalById(e);n&&n.setDimensions(t,i)&&this._onDidChangeTerminalDimensions.fire({terminal:n.value,dimensions:n.value.dimensions})}async $acceptTerminalMaximumDimensions(e,t,i){var n;(n=this._terminalProcesses.get(e))==null||n.resize(t,i)}async $acceptTerminalTitleChange(e,t){const i=this._getTerminalById(e);i&&(i.name=t)}async $acceptTerminalClosed(e,t,i){const n=this._getTerminalObjectIndexById(this._terminals,e);if(n!==null){const s=this._terminals.splice(n,1)[0];s.setExitStatus(t,i),this._onDidCloseTerminal.fire(s.value)}}$acceptTerminalOpened(e,t,i,n){if(t){const a=this._getTerminalObjectIndexById(this._terminals,t);if(a!==null){this._terminals[a]._id=e,this._onDidOpenTerminal.fire(this.terminals[a]),this._terminals[a].isOpen=!0;return}}const s={name:n.name,shellPath:n.executable,shellArgs:n.args,cwd:typeof n.cwd=="string"?n.cwd:k.revive(n.cwd),env:n.env,hideFromUser:n.hideFromUser},o=new zB(this._proxy,e,s,i);this._terminals.push(o),this._onDidOpenTerminal.fire(o.value),o.isOpen=!0}async $acceptTerminalProcessId(e,t){const i=this._getTerminalById(e);i==null||i._setProcessId(t)}async $startExtensionTerminal(e,t){const i=this._getTerminalById(e);if(!i)return{message:p("launchFail.idMissingOnExtHost","Could not find the terminal with id {0} on the extension host",e)};i.isOpen||await new Promise(s=>{const o=this.onDidOpenTerminal(async a=>{a===i.value&&(o.dispose(),s())})});const n=this._terminalProcesses.get(e);n?n.startSendingEvents(t):this._extensionTerminalAwaitingStart[e]={initialDimensions:t}}_setupExtHostProcessListeners(e,t){const i=new me;i.add(t.onProcessReady(s=>this._proxy.$sendProcessReady(e,s.pid,s.cwd,s.windowsPty))),i.add(t.onDidChangeProperty(s=>this._proxy.$sendProcessProperty(e,s))),this._bufferer.startBuffering(e,t.onProcessData),i.add(t.onProcessExit(s=>this._onProcessExit(e,s))),this._terminalProcesses.set(e,t);const n=this._extensionTerminalAwaitingStart[e];return n&&t instanceof KR&&(t.startSendingEvents(n.initialDimensions),delete this._extensionTerminalAwaitingStart[e]),i}$acceptProcessAckDataEvent(e,t){var i;(i=this._terminalProcesses.get(e))==null||i.acknowledgeDataEvent(t)}$acceptProcessInput(e,t){var i;(i=this._terminalProcesses.get(e))==null||i.input(t)}$acceptTerminalInteraction(e){const t=this._getTerminalById(e);t!=null&&t.setInteractedWith()&&this._onDidChangeTerminalState.fire(t.value)}$acceptProcessResize(e,t,i){var n;try{(n=this._terminalProcesses.get(e))==null||n.resize(t,i)}catch(s){if(s.code!=="EPIPE"&&s.code!=="ERR_IPC_CHANNEL_CLOSED")throw s}}$acceptProcessShutdown(e,t){var i;(i=this._terminalProcesses.get(e))==null||i.shutdown(t)}$acceptProcessRequestInitialCwd(e){var t;(t=this._terminalProcesses.get(e))==null||t.getInitialCwd().then(i=>this._proxy.$sendProcessProperty(e,{type:"initialCwd",value:i}))}$acceptProcessRequestCwd(e){var t;(t=this._terminalProcesses.get(e))==null||t.getCwd().then(i=>this._proxy.$sendProcessProperty(e,{type:"cwd",value:i}))}$acceptProcessRequestLatency(e){return Promise.resolve(e)}registerLinkProvider(e){return this._linkProviders.add(e),this._linkProviders.size===1&&this._proxy.$startLinkProvider(),new Yt(()=>{this._linkProviders.delete(e),this._linkProviders.size===0&&this._proxy.$stopLinkProvider()})}registerProfileProvider(e,t,i){if(this._profileProviders.has(t))throw new Error(`Terminal profile provider "${t}" already registered`);return this._profileProviders.set(t,i),this._proxy.$registerProfileProvider(t,e.identifier.value),new Yt(()=>{this._profileProviders.delete(t),this._proxy.$unregisterProfileProvider(t)})}registerTerminalQuickFixProvider(e,t,i){if(this._quickFixProviders.has(e))throw new Error(`Terminal quick fix provider "${e}" is already registered`);return this._quickFixProviders.set(e,i),this._proxy.$registerQuickFixProvider(e,t),new Yt(()=>{this._quickFixProviders.delete(e),this._proxy.$unregisterQuickFixProvider(e)})}async $provideTerminalQuickFixes(e,t){const i=new Xt().token;if(i.isCancellationRequested)return;const n=this._quickFixProviders.get(e);if(!n)return;const s=await n.provideTerminalQuickFixes(t,i);if(s!==null)return s}async $createContributedProfileTerminal(e,t){var s;const i=new Xt().token;let n=await((s=this._profileProviders.get(e))==null?void 0:s.provideTerminalProfile(i));if(!i.isCancellationRequested){if(n&&!("options"in n)&&(n={options:n}),!n||!("options"in n))throw new Error(`No terminal profile options provided for id "${e}"`);if("pty"in n.options){this.createExtensionTerminal(n.options,t);return}this.createTerminalFromOptions(n.options,t)}}async $provideLinks(e,t){const i=this._getTerminalById(e);if(!i)return[];this._terminalLinkCache.delete(e);const n=this._terminalLinkCancellationSource.get(e);n==null||n.dispose(!0);const s=new Xt;this._terminalLinkCancellationSource.set(e,s);const o=[],a={terminal:i.value,line:t},c=[];for(const u of this._linkProviders)c.push(Sn.withAsyncBody(async h=>{s.token.onCancellationRequested(()=>h({provider:u,links:[]}));const g=await u.provideTerminalLinks(a,s.token)||[];s.token.isCancellationRequested||h({provider:u,links:g})}));const d=await Promise.all(c);if(s.token.isCancellationRequested)return[];const l=new Map;for(const u of d)u&&u.links.length>0&&o.push(...u.links.map(h=>{const g={id:Dfe++,startIndex:h.startIndex,length:h.length,label:h.tooltip};return l.set(g.id,{provider:u.provider,link:h}),g}));return this._terminalLinkCache.set(e,l),o}$activateLink(e,t){var n;const i=(n=this._terminalLinkCache.get(e))==null?void 0:n.get(t);i&&i.provider.handleTerminalLink(i.link)}_onProcessExit(e,t){this._bufferer.stopBuffering(e),this._terminalProcesses.delete(e),delete this._extensionTerminalAwaitingStart[e];const i=this._terminalProcessDisposables[e];i&&(i.dispose(),delete this._terminalProcessDisposables[e]),this._proxy.$sendProcessExit(e,t)}_getTerminalById(e){return this._getTerminalObjectById(this._terminals,e)}_getTerminalObjectById(e,t){const i=this._getTerminalObjectIndexById(e,t);return i!==null?e[i]:null}_getTerminalObjectIndexById(e,t){const i=e.findIndex(n=>n._id===t);return i===-1?null:i}getEnvironmentVariableCollection(e){let t=this._environmentVariableCollections.get(e.identifier.value);return t||(t=new KB(e),this._setEnvironmentVariableCollection(e.identifier.value,t)),t.getScopedEnvironmentVariableCollection(void 0)}_syncEnvironmentVariableCollection(e,t){const i=$$(t.map),n=D5(t.descriptionMap);this._proxy.$setEnvironmentVariableCollection(e,t.persistent,i.length===0?void 0:i,n)}$initEnvironmentVariableCollections(e){e.forEach(t=>{const i=t[0],n=new KB(void 0,t[1]);this._setEnvironmentVariableCollection(i,n)})}$acceptDefaultProfile(e,t){const i=this._defaultProfile;this._defaultProfile=e,this._defaultAutomationProfile=t,(i==null?void 0:i.path)!==e.path&&this._onDidChangeShell.fire(e.path)}_setEnvironmentVariableCollection(e,t){this._environmentVariableCollections.set(e,t),t.onDidChangeCollection(()=>{this._syncEnvironmentVariableCollection(e,t)})}};CL=T([v(1,Ii)],CL);class KB{get persistent(){return this._persistent}set persistent(e){this._persistent=e,this._onDidChangeCollection.fire()}get onDidChangeCollection(){return this._onDidChangeCollection&&this._onDidChangeCollection.event}constructor(e,t){this._extension=e,this.map=new Map,this.scopedCollections=new Map,this.descriptionMap=new Map,this._persistent=!0,this._onDidChangeCollection=new A,this.map=new Map(t)}getScopedEnvironmentVariableCollection(e){this._extension&&e&&He(this._extension,"envCollectionWorkspace");const t=this.getScopeKey(e);let i=this.scopedCollections.get(t);return i||(i=new kfe(this,e),this.scopedCollections.set(t,i),i.onDidChangeCollection(()=>this._onDidChangeCollection.fire())),i}replace(e,t,i,n){this._extension&&i&&He(this._extension,"envCollectionOptions"),this._setIfDiffers(e,{value:t,type:xh.Replace,options:i??{},scope:n})}append(e,t,i,n){this._extension&&i&&He(this._extension,"envCollectionOptions"),this._setIfDiffers(e,{value:t,type:xh.Append,options:i??{},scope:n})}prepend(e,t,i,n){this._extension&&i&&He(this._extension,"envCollectionOptions"),this._setIfDiffers(e,{value:t,type:xh.Prepend,options:i??{},scope:n})}_setIfDiffers(e,t){var s,o,a,c,d,l;if(t.options&&t.options.applyAtProcessCreation===!1&&!t.options.applyAtShellIntegration)throw new Error("EnvironmentVariableMutatorOptions must apply at either process creation or shell integration");const i=this.getKey(e,t.scope),n=this.map.get(i);if(!n||n.value!==t.value||n.type!==t.type||((s=n.options)==null?void 0:s.applyAtProcessCreation)!==(t.options.applyAtProcessCreation??!0)||((o=n.options)==null?void 0:o.applyAtShellIntegration)!==(t.options.applyAtShellIntegration??!1)||((c=(a=n.scope)==null?void 0:a.workspaceFolder)==null?void 0:c.index)!==((l=(d=t.scope)==null?void 0:d.workspaceFolder)==null?void 0:l.index)){const u=this.getKey(e,t.scope),h={variable:e,...t,options:{applyAtProcessCreation:t.options.applyAtProcessCreation??!0,applyAtShellIntegration:t.options.applyAtShellIntegration??!1}};this.map.set(u,h),this._onDidChangeCollection.fire()}}get(e,t){const i=this.getKey(e,t),n=this.map.get(i);return n?QB(n):void 0}getKey(e,t){const i=this.getScopeKey(t);return i.length?`${e}:::${i}`:e}getScopeKey(e){return this.getWorkspaceKey(e==null?void 0:e.workspaceFolder)??""}getWorkspaceKey(e){return e?e.uri.toString():void 0}getVariableMap(e){const t=new Map;for(const[i,n]of this.map)this.getScopeKey(n.scope)===this.getScopeKey(e)&&t.set(i,QB(n));return t}delete(e,t){const i=this.getKey(e,t);this.map.delete(i),this._onDidChangeCollection.fire()}clear(e){var t,i;if(e!=null&&e.workspaceFolder){for(const[n,s]of this.map)((i=(t=s.scope)==null?void 0:t.workspaceFolder)==null?void 0:i.index)===e.workspaceFolder.index&&this.map.delete(n);this.clearDescription(e)}else this.map.clear(),this.descriptionMap.clear();this._onDidChangeCollection.fire()}setDescription(e,t){const i=this.getScopeKey(t),n=this.descriptionMap.get(i);if(!n||n.description!==e){let s;typeof e=="string"?s=e:s=e==null?void 0:e.value.split(`

`)[0];const o={description:s,scope:t};this.descriptionMap.set(i,o),this._onDidChangeCollection.fire()}}getDescription(e){var i;const t=this.getScopeKey(e);return(i=this.descriptionMap.get(t))==null?void 0:i.description}clearDescription(e){const t=this.getScopeKey(e);this.descriptionMap.delete(t)}}class kfe{get persistent(){return this.collection.persistent}set persistent(e){this.collection.persistent=e}get onDidChangeCollection(){return this._onDidChangeCollection&&this._onDidChangeCollection.event}constructor(e,t){this.collection=e,this.scope=t,this._onDidChangeCollection=new A}getScopedEnvironmentVariableCollection(e){return this.collection.getScopedEnvironmentVariableCollection(e)}replace(e,t,i){this.collection.replace(e,t,i,this.scope)}append(e,t,i){this.collection.append(e,t,i,this.scope)}prepend(e,t,i){this.collection.prepend(e,t,i,this.scope)}get(e){return this.collection.get(e,this.scope)}forEach(e,t){this.collection.getVariableMap(this.scope).forEach((i,n)=>e.call(t,n,i,this),this.scope)}[Symbol.iterator](){return this.collection.getVariableMap(this.scope).entries()}delete(e){this.collection.delete(e,this.scope),this._onDidChangeCollection.fire(void 0)}clear(){this.collection.clear(this.scope)}set description(e){this.collection.setDescription(e,this.scope)}get description(){return this.collection.getDescription(this.scope)}}let EL=class extends CL{constructor(e){super(!1,e)}createTerminal(e,t,i){throw new al}createTerminalFromOptions(e,t){throw new al}};EL=T([v(0,Ii)],EL);function R5(r){if(!(!r||typeof r=="string"))return"id"in r?{id:r.id,color:r.color}:r}function Tfe(r){return RP.isThemeColor(r)?r:void 0}function QB(r){const e={...r};return delete e.scope,e.options=e.options??void 0,delete e.variable,e}class P5{constructor(e){this._onDidChangePassword=new A,this.onDidChangePassword=this._onDidChangePassword.event,this._proxy=e.getProxy(ce.MainThreadSecretState)}async $onDidChangePassword(e){this._onDidChangePassword.fire(e)}get(e,t){return this._proxy.$getPassword(e,t)}store(e,t,i){return this._proxy.$setPassword(e,t,i)}delete(e,t){return this._proxy.$deletePassword(e,t)}}const W$=re("IExtHostSecretState");var qu;class Ife{constructor(e,t){qu.set(this,void 0),this._onDidChange=new A,this.onDidChange=this._onDidChange.event,this._id=fn.toKey(e.identifier),rt(this,qu,t,"f"),V(this,qu,"f").onDidChangePassword(i=>{i.extensionId===this._id&&this._onDidChange.fire({key:i.key})})}get(e){return V(this,qu,"f").get(this._id,e)}store(e,t){return V(this,qu,"f").store(this._id,e,t)}delete(e){return V(this,qu,"f").delete(this._id,e)}}qu=new WeakMap;let xL=class{constructor(e,t,i){this.logService=i,this.bundleCache=new Map,this._proxy=t.getProxy(ce.MainThreadLocalization),this.currentLanguage=e.environment.appLanguage,this.isDefaultLanguage=this.currentLanguage===LY}getMessage(e,t){var c;const{message:i,args:n,comment:s}=t;if(this.isDefaultLanguage)return SP(i,n??{});let o=i;s&&s.length>0&&(o+=`/${Array.isArray(s)?s.join(""):s}`);const a=(c=this.bundleCache.get(e))==null?void 0:c.contents[o];return a||this.logService.warn(`Using default string since no string found in i18n bundle that has the key: ${o}`),SP(a??i,n??{})}getBundle(e){var t;return(t=this.bundleCache.get(e))==null?void 0:t.contents}getBundleUri(e){var t;return(t=this.bundleCache.get(e))==null?void 0:t.uri}async initializeLocalizedMessages(e){var n;if(this.isDefaultLanguage||!e.l10n&&!e.isBuiltin||this.bundleCache.has(e.identifier.value))return;let t;const i=await this.getBundleLocation(e);if(!i){this.logService.error(`No bundle location found for extension ${e.identifier.value}`);return}try{const s=await this._proxy.$fetchBundleContents(i),o=JSON.parse(s);t=e.isBuiltin?(n=o.contents)==null?void 0:n.bundle:o}catch(s){this.logService.error(`Failed to load translations for ${e.identifier.value} from ${i}: ${s.message}`);return}t&&this.bundleCache.set(e.identifier.value,{contents:t,uri:i})}async getBundleLocation(e){if(e.isBuiltin){const t=await this._proxy.$fetchBuiltInBundleUri(e.identifier.value,this.currentLanguage);return k.revive(t)}return e.l10n?k.joinPath(e.extensionLocation,e.l10n,`bundle.l10n.${this.currentLanguage}.json`):void 0}};xL=T([v(0,Gr),v(1,Ii),v(2,ze)],xL);const H$=re("IExtHostLocalizationService"),j$=re("IExtHostManagedSockets");let DL=class{constructor(e){this._remoteSocketIdCounter=0,this._factory=null,this._managedRemoteSockets=new Map,this._proxy=e.getProxy(ce.MainThreadManagedSockets)}setFactory(e,t){for(const i of this._managedRemoteSockets.values())i.dispose();this._factory&&this._proxy.$unregisterSocketFactory(this._factory.socketFactoryId),this._factory=new Rfe(e,t),this._proxy.$registerSocketFactory(this._factory.socketFactoryId)}async $openRemoteSocket(e){if(!this._factory||this._factory.socketFactoryId!==e)throw new Error(`No socket factory with id ${e}`);const t=++this._remoteSocketIdCounter,i=await this._factory.makeConnection(),n=new me;return this._managedRemoteSockets.set(t,new Pfe(t,i,n)),n.add(ot(()=>this._managedRemoteSockets.delete(t))),n.add(i.onDidEnd(()=>{this._proxy.$onDidManagedSocketEnd(t),n.dispose()})),n.add(i.onDidClose(s=>{this._proxy.$onDidManagedSocketClose(t,(s==null?void 0:s.stack)??(s==null?void 0:s.message)),n.dispose()})),n.add(i.onDidReceiveMessage(s=>this._proxy.$onDidManagedSocketHaveData(t,De.wrap(s)))),t}$remoteSocketWrite(e,t){var i;(i=this._managedRemoteSockets.get(e))==null||i.actual.send(t.buffer)}$remoteSocketEnd(e){const t=this._managedRemoteSockets.get(e);t&&(t.actual.end(),t.dispose())}async $remoteSocketDrain(e){var t,i,n;await((n=(t=this._managedRemoteSockets.get(e))==null?void 0:(i=t.actual).drain)==null?void 0:n.call(i))}};DL=T([v(0,Ii)],DL);class Rfe{constructor(e,t){this.socketFactoryId=e,this.makeConnection=t}}let Pfe=class extends ne{constructor(e,t,i){super(),this.socketId=e,this.actual=t,this._register(i)}};var bp,OS,Sp;const A5=re("IHostUtils");let kL=class M5 extends ne{constructor(e,t,i,n,s,o,a,c,d,l,u,h){super(),this._extHostManagedSockets=h,this._onDidChangeRemoteConnectionData=this._register(new A),this.onDidChangeRemoteConnectionData=this._onDidChangeRemoteConnectionData.event,this._isTerminating=!1,this._hostUtils=t,this._extHostContext=i,this._initData=a,this._extHostWorkspace=n,this._extHostConfiguration=s,this._logService=o,this._extHostTunnelService=d,this._extHostTerminalService=l,this._extHostLocalizationService=u,this._mainThreadWorkspaceProxy=this._extHostContext.getProxy(ce.MainThreadWorkspace),this._mainThreadTelemetryProxy=this._extHostContext.getProxy(ce.MainThreadTelemetry),this._mainThreadExtensionsProxy=this._extHostContext.getProxy(ce.MainThreadExtensionService),this._almostReadyToRunExtensions=new Cs,this._readyToStartExtensionHost=new Cs,this._readyToRunExtensions=new Cs,this._eagerExtensionsActivated=new Cs,this._activationEventsReader=new Mfe(this._initData.activationEvents),this._globalRegistry=new Gl(this._activationEventsReader,this._initData.allExtensions);const g=new lc(this._initData.myExtensions);this._myRegistry=new Gl(this._activationEventsReader,L5(this._globalRegistry,g)),this._storage=new E5(this._extHostContext,this._logService),this._secretState=new P5(this._extHostContext),this._storagePath=c,this._instaService=e.createChild(new Of([F$,this._storage],[W$,this._secretState])),this._activator=this._register(new vL(this._myRegistry,this._globalRegistry,{onExtensionActivationError:(m,y,_)=>{this._mainThreadExtensionsProxy.$onExtensionActivationError(m,yC(y),_)},actualActivateExtension:async(m,y)=>{if(Gl.isHostExtension(m,this._myRegistry,this._globalRegistry))return await this._mainThreadExtensionsProxy.$activateExtension(m,y),new Efe;const _=this._myRegistry.getExtensionDescription(m);return this._activateExtension(_,y)}},this._logService)),this._extensionPathIndex=null,this._resolvers=Object.create(null),this._started=!1,this._remoteConnectionData=this._initData.remote.connectionData}getRemoteConnectionData(){return this._remoteConnectionData}async initialize(){try{await this._beforeAlmostReadyToRunExtensions(),this._almostReadyToRunExtensions.open(),await this._extHostWorkspace.waitForInitializeCall(),qt("code/extHost/ready"),this._readyToStartExtensionHost.open(),this._initData.autoStart&&this._startExtensionHost()}catch(e){en(e)}}async _deactivateAll(){this._storagePath.onWillDeactivateAll();let e=[];try{e=this._myRegistry.getAllExtensionDescriptions().map(s=>s.identifier).filter(s=>this.isActivated(s)).map(s=>this._deactivate(s))}catch{}await Promise.all(e)}terminate(e,t=0){if(this._isTerminating)return;this._isTerminating=!0,this._logService.info(`Extension host terminating: ${e}`),this._logService.flush(),this._extHostTerminalService.dispose(),this._activator.dispose(),SC&&PP(n=>{this._logService.error(n)}),this._extHostContext.dispose();const i=this._deactivateAll();Promise.race([zs(5e3),i]).finally(()=>{this._hostUtils.pid?this._logService.info(`Extension host with pid ${this._hostUtils.pid} exiting with code ${t}`):this._logService.info(`Extension host exiting with code ${t}`),this._logService.flush(),this._logService.dispose(),this._hostUtils.exit(t)})}isActivated(e){return this._readyToRunExtensions.isOpen()?this._activator.isActivated(e):!1}async getExtension(e){const t=await this._mainThreadExtensionsProxy.$getExtension(e);return t&&{...t,identifier:new fn(t.identifier.value),extensionLocation:k.revive(t.extensionLocation)}}_activateByEvent(e,t){return this._activator.activateByEvent(e,t)}_activateById(e,t){return this._activator.activateById(e,t)}activateByIdWithErrors(e,t){return this._activateById(e,t).then(()=>{const i=this._activator.getActivatedExtension(e);if(i.activationFailed)return Promise.reject(i.activationFailedError)})}getExtensionRegistry(){return this._readyToRunExtensions.wait().then(e=>this._myRegistry)}getExtensionExports(e){if(this._readyToRunExtensions.isOpen())return this._activator.getActivatedExtension(e).exports;try{return this._activator.getActivatedExtension(e).exports}catch{return null}}async _realPathExtensionUri(e){if(e.scheme!==pe.file)return e;const t=await this._hostUtils.realpath(e.fsPath);return k.file(t)}async getExtensionPathIndex(){return this._extensionPathIndex||(this._extensionPathIndex=this._createExtensionPathIndex(this._myRegistry.getAllExtensionDescriptions()).then(e=>new Afe(e))),this._extensionPathIndex}async _createExtensionPathIndex(e){const t=pc.forUris(i=>NY.ignorePathCasing(i));return await Promise.all(e.map(async i=>{if(this._getEntryPoint(i)){const n=await this._realPathExtensionUri(i.extensionLocation);t.set(n,i)}})),t}_deactivate(e){let t=Promise.resolve(void 0);if(!this._readyToRunExtensions.isOpen()||!this._activator.isActivated(e))return t;const i=this._activator.getActivatedExtension(e);if(!i)return t;try{typeof i.module.deactivate=="function"&&(t=Promise.resolve(i.module.deactivate()).then(void 0,n=>(this._logService.error(n),Promise.resolve(void 0))))}catch(n){this._logService.error(`An error occurred when deactivating the extension '${e.value}':`),this._logService.error(n)}try{vt(i.subscriptions)}catch(n){this._logService.error(`An error occurred when deactivating the subscriptions for extension '${e.value}':`),this._logService.error(n)}return t}async _activateExtension(e,t){return this._initData.remote.isRemote?this._mainThreadExtensionsProxy.$onWillActivateExtension(e.identifier):await this._mainThreadExtensionsProxy.$onWillActivateExtension(e.identifier),this._doActivateExtension(e,t).then(i=>{const n=i.activationTimes;return this._mainThreadExtensionsProxy.$onDidActivateExtension(e.identifier,n.codeLoadingTime,n.activateCallTime,n.activateResolvedTime,t),this._logExtensionActivationTimes(e,t,"success",n),i},i=>{throw this._logExtensionActivationTimes(e,t,"failure"),i})}_logExtensionActivationTimes(e,t,i,n){const s=XB(e,t);this._mainThreadTelemetryProxy.$publicLog2("extensionActivationTimes",{...s,...n||{},outcome:i})}_doActivateExtension(e,t){const i=XB(e,t);this._mainThreadTelemetryProxy.$publicLog2("activatePlugin",i);const n=this._getEntryPoint(e);if(!n)return Promise.resolve(new Cfe(Cm.NONE));this._logService.info(`ExtensionService#_doActivateExtension ${e.identifier.value}, startup: ${t.startup}, activationEvent: '${t.activationEvent}'${e.identifier.value!==t.extensionId.value?`, root cause: ${t.extensionId.value}`:""}`),this._logService.flush();const s=new GB(t.startup);return Promise.all([this._loadCommonJSModule(e,pt(e.extensionLocation,n),s),this._loadExtensionContext(e)]).then(o=>(qt(`code/extHost/willActivateExtension/${e.identifier.value}`),M5._callActivate(this._logService,e.identifier,o[0],o[1],s))).then(o=>(qt(`code/extHost/didActivateExtension/${e.identifier.value}`),o))}_loadExtensionContext(e){const t=new xfe(e,this._storage),i=new x5(e.identifier.value,!1,this._storage),n=new Ife(e,this._secretState),s=e.isUnderDevelopment?this._initData.environment.extensionTestsLocationURI?Mh.Test:Mh.Development:Mh.Production,o=this._initData.remote.isRemote?jl.Workspace:jl.UI;return this._logService.trace(`ExtensionService#loadExtensionContext ${e.identifier.value}`),Promise.all([t.whenReady,i.whenReady,this._storagePath.whenReady]).then(()=>{var u;const a=this;let c,d;const l=ts(e,"ipc")?(u=this._initData.messagePorts)==null?void 0:u.get(fn.toKey(e.identifier)):void 0;return Object.freeze({globalState:t,workspaceState:i,secrets:n,subscriptions:[],get extensionUri(){return e.extensionLocation},get extensionPath(){return e.extensionLocation.fsPath},asAbsolutePath(h){return yH(e.extensionLocation.fsPath,h)},get storagePath(){var h;return(h=a._storagePath.workspaceValue(e))==null?void 0:h.fsPath},get globalStoragePath(){return a._storagePath.globalValue(e).fsPath},get logPath(){return yH(a._initData.logsLocation.fsPath,e.identifier.value)},get logUri(){return k.joinPath(a._initData.logsLocation,e.identifier.value)},get storageUri(){return a._storagePath.workspaceValue(e)},get globalStorageUri(){return a._storagePath.globalValue(e)},get extensionMode(){return s},get extension(){return c===void 0&&(c=new Xv(a,e.identifier,e,o,!1)),c},get extensionRuntime(){return He(e,"extensionRuntime"),a.extensionRuntime},get environmentVariableCollection(){return a._extHostTerminalService.getEnvironmentVariableCollection(e)},get messagePassingProtocol(){if(!d){if(!l)return;const h=F.buffer(F.fromDOMEventEmitter(l,"message",g=>g.data));l.start(),d={onDidReceiveMessage:h,postMessage:l.postMessage.bind(l)}}return d}})})}static _callActivate(e,t,i,n,s){return i=i||{activate:void 0,deactivate:void 0},this._callActivateOptional(e,t,i,n,s).then(o=>new QT(!1,null,s.build(),i,o,n.subscriptions))}static _callActivateOptional(e,t,i,n,s){if(typeof i.activate=="function")try{s.activateCallStart(),e.trace(`ExtensionService#_callActivateOptional ${t.value}`);const o=typeof global=="object"?global:self,a=i.activate.apply(o,[n]);return s.activateCallStop(),s.activateResolveStart(),Promise.resolve(a).then(c=>(s.activateResolveStop(),c))}catch(o){return Promise.reject(o)}else return Promise.resolve(i)}_activateOneStartupFinished(e,t){this._activateById(e.identifier,{startup:!1,extensionId:e.identifier,activationEvent:t}).then(void 0,i=>{this._logService.error(i)})}_activateAllStartupFinishedDeferred(e,t=0){const n=Date.now();FY(()=>{for(let s=t;s<e.length;s+=1){const o=e[s];for(const a of o.activationEvents??[])if(a==="onStartupFinished")if(Date.now()-n>50){this._activateAllStartupFinishedDeferred(e,s);break}else this._activateOneStartupFinished(o,a)}})}_activateAllStartupFinished(){this._mainThreadExtensionsProxy.$setPerformanceMarks(OY()),this._extHostConfiguration.getConfigProvider().then(e=>{const t=e.getConfiguration("extensions.experimental").get("deferredStartupFinishedActivation"),i=this._myRegistry.getAllExtensionDescriptions();if(t)this._activateAllStartupFinishedDeferred(i);else for(const n of i)if(n.activationEvents)for(const s of n.activationEvents)s==="onStartupFinished"&&this._activateOneStartupFinished(n,s)})}_handleEagerExtensions(){const e=this._activateByEvent("*",!0).then(void 0,o=>{this._logService.error(o)});this._register(this._extHostWorkspace.onDidChangeWorkspace(o=>this._handleWorkspaceContainsEagerExtensions(o.added)));const t=this._extHostWorkspace.workspace?this._extHostWorkspace.workspace.folders:[],i=this._handleWorkspaceContainsEagerExtensions(t),n=this._handleRemoteResolverEagerExtensions(),s=Promise.all([n,e,i]).then(()=>{});return Promise.race([s,zs(1e4)]).then(()=>{this._activateAllStartupFinished()}),s}_handleWorkspaceContainsEagerExtensions(e){return e.length===0?Promise.resolve(void 0):Promise.all(this._myRegistry.getAllExtensionDescriptions().map(t=>this._handleWorkspaceContainsEagerExtension(e,t))).then(()=>{})}async _handleWorkspaceContainsEagerExtension(e,t){if(this.isActivated(t.identifier))return;const i=!this._initData.remote.isRemote&&!!this._initData.remote.authority,n={logService:this._logService,folders:e.map(o=>o.uri),forceUsingSearch:i,exists:o=>this._hostUtils.exists(o.fsPath),checkExists:(o,a,c)=>this._mainThreadWorkspaceProxy.$checkExists(o,a,c)},s=await d5(n,t);if(s)return this._activateById(t.identifier,{startup:!0,extensionId:t.identifier,activationEvent:s.activationEvent}).then(void 0,o=>this._logService.error(o))}async _handleRemoteResolverEagerExtensions(){if(this._initData.remote.authority)return this._activateByEvent(`onResolveRemoteAuthority:${this._initData.remote.authority}`,!1)}async $extensionTestsExecute(){await this._eagerExtensionsActivated.wait();try{return await this._doHandleExtensionTests()}catch(e){throw console.error(e),e}}async _doHandleExtensionTests(){const{extensionDevelopmentLocationURI:e,extensionTestsLocationURI:t}=this._initData.environment;if(!e||!t)throw new Error(p("extensionTestError1","Cannot load test runner."));const i=await this._loadCommonJSModule(null,t,new GB(!1));if(!i||typeof i.run!="function")throw new Error(p("extensionTestError","Path {0} does not point to a valid extension test runner.",t.toString()));return new Promise((n,s)=>{const o=(d,l)=>{d?s(d):n(typeof l=="number"&&l>0?1:0)},a=jq(t),c=i.run(a,o);c&&c.then&&c.then(()=>{n(0)}).catch(d=>{s(d instanceof Error&&d.stack?d.stack:String(d))})})}_startExtensionHost(){if(this._started)throw new Error("Extension host is already started!");return this._started=!0,this._readyToStartExtensionHost.wait().then(()=>this._readyToRunExtensions.open()).then(()=>Promise.race([this._activator.waitForActivatingExtensions(),zs(1e3)])).then(()=>this._handleEagerExtensions()).then(()=>{this._eagerExtensionsActivated.open(),this._logService.info("Eager extensions activated")})}registerRemoteAuthorityResolver(e,t){return this._resolvers[e]=t,ot(()=>{delete this._resolvers[e]})}async getRemoteExecServer(e){var i;const{resolver:t}=await this._activateAndGetResolver(e);return(i=t==null?void 0:t.resolveExecServer)==null?void 0:i.call(t,e,{resolveAttempt:0})}async _activateAndGetResolver(e){const t=e.indexOf("+");if(t===-1)throw new Error("Not an authority that can be resolved!");const i=e.substr(0,t);return await this._almostReadyToRunExtensions.wait(),await this._activateByEvent(`onResolveRemoteAuthority:${i}`,!1),{authorityPrefix:i,resolver:this._resolvers[i]}}async $resolveAuthority(e,t){var _;const i=Tr.create(!1),n=()=>`[resolveAuthority(${NC(e)},${t})][${i.elapsed()}ms] `,s=b=>this._logService.info(`${n()}${b}`),o=(b,E=void 0)=>this._logService.error(`${n()}${b}`,E),a=b=>{if(b instanceof $l)return{type:"error",error:{code:b._code,message:b._message,detail:b._detail}};throw b},c=e.split(/@|%40/g).reverse();s(`activating remote resolvers ${c.join(" -> ")}`);let d;try{d=await Promise.all(c.map(async b=>{s("activating resolver...");const{resolver:E,authorityPrefix:D}=await this._activateAndGetResolver(b);if(!E)throw o("no resolver"),new $l(`No remote extension installed to resolve ${D}.`,$r.NoResolverFound);return{resolver:E,authorityPrefix:D,remoteAuthority:b}}))}catch(b){return a(b)}const l=new $q;l.cancelAndSet(()=>s("waiting..."),1e3);let u,h;for(const[b,{authorityPrefix:E,resolver:D,remoteAuthority:R}]of d.entries())try{if(b===d.length-1)s("invoking final resolve()..."),qt(`code/extHost/willResolveAuthority/${E}`),u=await D.resolve(R,{resolveAttempt:t,execServer:h}),qt(`code/extHost/didResolveAuthorityOK/${E}`),s("setting tunnel factory..."),this._register(await this._extHostTunnelService.setTunnelFactory(D));else{if(s(`invoking resolveExecServer() for ${R}`),qt(`code/extHost/willResolveExecServer/${E}`),h=await((_=D.resolveExecServer)==null?void 0:_.call(D,R,{resolveAttempt:t,execServer:h})),!h)throw new $l(`Exec server was not available for ${R}`,$r.NoResolverFound);qt(`code/extHost/didResolveExecServerOK/${E}`)}}catch(M){return qt(`code/extHost/didResolveAuthorityError/${E}`),o("returned an error",M),l.dispose(),a(M)}l.dispose();const g={environmentTunnels:u.environmentTunnels,features:u.tunnelFeatures},m={extensionHostEnv:u.extensionHostEnv,isTrusted:u.isTrusted,authenticationSession:u.authenticationSessionForInitializingExtensions?{id:u.authenticationSessionForInitializingExtensions.id,providerId:u.authenticationSessionForInitializingExtensions.providerId}:void 0};s(`returned ${eA.isManagedResolvedAuthority(u)?"managed authority":`${u.host}:${u.port}`}`);let y;if(eA.isManagedResolvedAuthority(u)){const b=t;this._extHostManagedSockets.setFactory(b,u.makeConnection),y={authority:e,connectTo:new nz(b),connectionToken:u.connectionToken}}else y={authority:e,connectTo:new rz(u.host,u.port),connectionToken:u.connectionToken};return{type:"ok",value:{authority:y,options:m,tunnelInformation:g}}}async $getCanonicalURI(e,t){this._logService.info(`$getCanonicalURI invoked for authority (${NC(e)})`);const{resolver:i}=await this._activateAndGetResolver(e);if(!i)return null;const n=k.revive(t);if(typeof i.getCanonicalURI>"u")return n;const s=await Nr(()=>i.getCanonicalURI(n));return s||n}$startExtensionHost(e){e.toAdd.forEach(n=>n.extensionLocation=k.revive(n.extensionLocation));const{globalRegistry:t,myExtensions:i}=YB(this._activationEventsReader,this._globalRegistry,this._myRegistry,e);return this._globalRegistry.set(t.getAllExtensionDescriptions()),this._myRegistry.set(i),this._startExtensionHost()}$activateByEvent(e,t){return t===1?this._activateByEvent(e,!1):this._readyToRunExtensions.wait().then(i=>this._activateByEvent(e,!1))}async $activate(e,t){return await this._readyToRunExtensions.wait(),this._myRegistry.getExtensionDescription(e)?(await this._activateById(e,t),!0):!1}async $deltaExtensions(e){e.toAdd.forEach(o=>o.extensionLocation=k.revive(o.extensionLocation));const{globalRegistry:t,myExtensions:i}=YB(this._activationEventsReader,this._globalRegistry,this._myRegistry,e),n=await this._createExtensionPathIndex(i);return(await this.getExtensionPathIndex()).setSearchTree(n),this._globalRegistry.set(t.getAllExtensionDescriptions()),this._myRegistry.set(i),Promise.resolve(void 0)}async $test_latency(e){return e}async $test_up(e){return e.byteLength}async $test_down(e){const t=De.alloc(e),i=Math.random()%256;for(let n=0;n<e;n++)t.writeUInt8(i,n);return t}async $updateRemoteConnectionData(e){this._remoteConnectionData=e,this._onDidChangeRemoteConnectionData.fire()}};kL=T([v(0,Te),v(1,A5),v(2,Ii),v(3,$d),v(4,Wd),v(5,ze),v(6,Gr),v(7,O$),v(8,N$),v(9,pb),v(10,H$),v(11,j$)],kL);function YB(r,e,t,i){r.addActivationEvents(i.addActivationEvents);const n=new Gl(r,e.getAllExtensionDescriptions());n.deltaExtensions(i.toAdd,i.toRemove);const s=new lc(t.getAllExtensionDescriptions().map(a=>a.identifier));for(const a of i.myToRemove)s.delete(a);for(const a of i.myToAdd)s.add(a);const o=L5(n,s);return{globalRegistry:n,myExtensions:o}}function XB(r,e){return{id:r.identifier.value,name:r.name,extensionVersion:r.version,publisherDisplayName:r.publisher,activationEvents:r.activationEvents?r.activationEvents.join(","):null,isBuiltin:r.isBuiltin,reason:e.activationEvent,reasonId:e.extensionId.value}}const xu=re("IExtHostExtensionService");class Xv{constructor(e,t,i,n,s){bp.set(this,void 0),OS.set(this,void 0),Sp.set(this,void 0),rt(this,bp,e,"f"),rt(this,OS,t,"f"),rt(this,Sp,i.identifier,"f"),this.id=i.identifier.value,this.extensionUri=i.extensionLocation,this.extensionPath=_C(jq(i.extensionLocation)),this.packageJSON=i,this.extensionKind=n,this.isFromDifferentExtensionHost=s}get isActive(){return V(this,bp,"f").isActivated(V(this,Sp,"f"))}get exports(){if(!(this.packageJSON.api==="none"||this.isFromDifferentExtensionHost))return V(this,bp,"f").getExtensionExports(V(this,Sp,"f"))}async activate(){if(this.isFromDifferentExtensionHost)throw new Error("Cannot activate foreign extension");return await V(this,bp,"f").activateByIdWithErrors(V(this,Sp,"f"),{startup:!1,extensionId:V(this,OS,"f"),activationEvent:"api"}),this.exports}}bp=new WeakMap,OS=new WeakMap,Sp=new WeakMap;function L5(r,e){return r.getAllExtensionDescriptions().filter(t=>e.has(t.identifier))}class Afe{constructor(e){this._searchTree=e}setSearchTree(e){this._searchTree=e}findSubstr(e){return this._searchTree.findSubstr(e)}forEach(e){return this._searchTree.forEach(e)}}class Mfe{constructor(e){this._map=new Ln,this.addActivationEvents(e)}readActivationEvents(e){return this._map.get(e.identifier)}addActivationEvents(e){for(const t of Object.keys(e))this._map.set(t,e[t])}}const Lu=(r,e,t,i)=>{let n=e;return{enumerable:!0,configurable:!1,get(){return n},set(s){var o;if(!t(n,s)){const a=n;n=s,(o=r.listener)==null||o.call(r,i(s,a))}}}},up=(r,e)=>r===e,zd={range:(r,e)=>r===e?!0:!r||!e?!1:r.isEqual(e),label:up,description:up,sortText:up,busy:up,error:up,canResolveChildren:up,tags:(r,e)=>!(r.length!==e.length||r.some(t=>!e.find(i=>t.id===i.id)))},hp=r=>e=>({op:4,update:r(e)}),Lfe=(r,e)=>({range:(()=>{let t;const i=hp(n=>({range:qe.lift(ge.from(n))}));return{enumerable:!0,configurable:!1,get(){return t},set(n){var s,o;(s=r.listener)==null||s.call(r,{op:6}),zd.range(t,n)||(t=n,(o=r.listener)==null||o.call(r,i(n)))}}})(),label:Lu(r,e,zd.label,hp(t=>({label:t}))),description:Lu(r,void 0,zd.description,hp(t=>({description:t}))),sortText:Lu(r,void 0,zd.sortText,hp(t=>({sortText:t}))),canResolveChildren:Lu(r,!1,zd.canResolveChildren,t=>({op:2,state:t})),busy:Lu(r,!1,zd.busy,hp(t=>({busy:t}))),error:Lu(r,void 0,zd.error,hp(t=>({error:zi.fromStrict(t)||null}))),tags:Lu(r,[],zd.tags,(t,i)=>({op:1,new:t.map(Ma.from),old:i.map(Ma.from)}))}),Ffe=r=>{const e=Et.fromString(r.extId),t=new Qf(e.controllerId,e.localId,r.label,k.revive(r.uri)||void 0);return t.range=ge.to(r.range||void 0),t.description=r.description||void 0,t.sortText=r.sortText||void 0,t.tags=r.tags.map(i=>Ma.to({id:w5(i).tagId})),t},Ofe=r=>{let e;for(const t of r.tests){const i=Ffe(t.item);GT(i).parent=e,e=i}return e};class Qf{constructor(e,t,i,n){if(t.includes("\0"))throw new Error(`Test IDs may not include the ${JSON.stringify(t)} symbol`);const s=hfe(this,e);Object.defineProperties(this,{id:{value:t,enumerable:!0,writable:!1},uri:{value:n,enumerable:!0,writable:!1},parent:{enumerable:!1,get(){return s.parent instanceof B$?void 0:s.parent}},children:{value:ufe(s,GT,Qf),enumerable:!0,writable:!1},...Lfe(s,i)})}}class B$ extends Qf{constructor(e,t){super(e,e,t,void 0),this._isRoot=!0}}class Nfe extends cfe{constructor(e,t,i){super({controllerId:e,getDocumentVersion:n=>{var s;return n&&((s=i.getDocument(n))==null?void 0:s.version)},getApiFor:GT,getChildren:n=>n.children,root:new B$(e,t),toITestItem:hu.from})}}let TL=class extends ne{constructor(e,t){super(),this.initData=e,this.loggerService=t,this._onDidChangeTelemetryEnabled=this._register(new A),this.onDidChangeTelemetryEnabled=this._onDidChangeTelemetryEnabled.event,this._onDidChangeTelemetryConfiguration=this._register(new A),this.onDidChangeTelemetryConfiguration=this._onDidChangeTelemetryConfiguration.event,this._productConfig={usage:!0,error:!0},this._level=0,this._telemetryIsSupported=!1,this._inLoggingOnlyMode=!1,this._telemetryLoggers=new Map,this.extHostTelemetryLogFile=k.revive(this.initData.environment.extensionTelemetryLogResource),this._inLoggingOnlyMode=this.initData.environment.isExtensionTelemetryLoggingOnly,this._outputLogger=t.createLogger(this.extHostTelemetryLogFile,{id:pte,name:p("extensionTelemetryLog","Extension Telemetry{0}",this._inLoggingOnlyMode?" (Not Sent)":""),hidden:!0}),this._register(t.onDidChangeLogLevel(i=>{Bq(i)&&this.updateLoggerVisibility()})),this._outputLogger.info("Below are logs for extension telemetry events sent to the telemetry output channel API once the log level is set to trace."),this._outputLogger.info("===========================================================")}updateLoggerVisibility(){this.loggerService.setVisibility(this.extHostTelemetryLogFile,this._telemetryIsSupported&&this.loggerService.getLogLevel()===ua.Trace)}getTelemetryConfiguration(){return this._level===3}getTelemetryDetails(){return{isCrashEnabled:this._level>=1,isErrorsEnabled:this._productConfig.error?this._level>=2:!1,isUsageEnabled:this._productConfig.usage?this._level>=3:!1}}instantiateLogger(e,t,i){const n=this.getTelemetryDetails(),s=new F5(t,i,e,this._outputLogger,this._inLoggingOnlyMode,this.getBuiltInCommonProperties(e),{isUsageEnabled:n.isUsageEnabled,isErrorsEnabled:n.isErrorsEnabled}),o=this._telemetryLoggers.get(e.identifier.value)??[];return this._telemetryLoggers.set(e.identifier.value,[...o,s]),s.apiTelemetryLogger}$initializeTelemetryLevel(e,t,i){this._level=e,this._telemetryIsSupported=t,this._productConfig=i??{usage:!0,error:!0},this.updateLoggerVisibility()}getBuiltInCommonProperties(e){const t=Object.create(null);switch(t["common.extname"]=`${e.publisher}.${e.name}`,t["common.extversion"]=e.version,t["common.vscodemachineid"]=this.initData.telemetryInfo.machineId,t["common.vscodesessionid"]=this.initData.telemetryInfo.sessionId,t["common.vscodeversion"]=this.initData.version,t["common.isnewappinstall"]=O5(this.initData.telemetryInfo.firstSessionDate),t["common.product"]=this.initData.environment.appHost,this.initData.uiKind){case Yo.Web:t["common.uikind"]="web";break;case Yo.Desktop:t["common.uikind"]="desktop";break;default:t["common.uikind"]="unknown"}return t["common.remotename"]=WN(vte(this.initData.remote.authority)),t}$onDidChangeTelemetryLevel(e){this._oldTelemetryEnablement=this.getTelemetryConfiguration(),this._level=e;const t=this.getTelemetryDetails();this._telemetryLoggers.forEach((i,n)=>{const s=i.filter(o=>!o.isDisposed);s.length===0?this._telemetryLoggers.delete(n):this._telemetryLoggers.set(n,s)}),this._telemetryLoggers.forEach(i=>{for(const n of i)n.updateTelemetryEnablements(t.isUsageEnabled,t.isErrorsEnabled)}),this._oldTelemetryEnablement!==this.getTelemetryConfiguration()&&this._onDidChangeTelemetryEnabled.fire(this.getTelemetryConfiguration()),this._onDidChangeTelemetryConfiguration.fire(this.getTelemetryDetails()),this.updateLoggerVisibility()}onExtensionError(e,t){const i=this._telemetryLoggers.get(e.value),n=i==null?void 0:i.filter(o=>!o.isDisposed);if(!n)return this._telemetryLoggers.delete(e.value),!1;let s=!1;for(const o of n)o.ignoreUnhandledExtHostErrors||(o.logError(t),s=!0);return s}};TL=T([v(0,Gr),v(1,Is)],TL);class F5{static validateSender(e){if(typeof e!="object")throw new TypeError("TelemetrySender argument is invalid");if(typeof e.sendEventData!="function")throw new TypeError("TelemetrySender.sendEventData must be a function");if(typeof e.sendErrorData!="function")throw new TypeError("TelemetrySender.sendErrorData must be a function");if(typeof e.flush<"u"&&typeof e.flush!="function")throw new TypeError("TelemetrySender.flush must be a function or undefined")}constructor(e,t,i,n,s,o,a){this._extension=i,this._logger=n,this._inLoggingOnlyMode=s,this._commonProperties=o,this._onDidChangeEnableStates=new A,this.ignoreUnhandledExtHostErrors=(t==null?void 0:t.ignoreUnhandledErrors)??!1,this._ignoreBuiltinCommonProperties=(t==null?void 0:t.ignoreBuiltInCommonProperties)??!1,this._additionalCommonProperties=t==null?void 0:t.additionalCommonProperties,this._sender=e,this._telemetryEnablements={isUsageEnabled:a.isUsageEnabled,isErrorsEnabled:a.isErrorsEnabled}}updateTelemetryEnablements(e,t){this._apiObject&&(this._telemetryEnablements={isUsageEnabled:e,isErrorsEnabled:t},this._onDidChangeEnableStates.fire(this._apiObject))}mixInCommonPropsAndCleanData(e){let t="properties"in e?e.properties??{}:e;return t=wte(t,[]),this._additionalCommonProperties&&(t=tu(t,this._additionalCommonProperties)),this._ignoreBuiltinCommonProperties||(t=tu(t,this._commonProperties)),"properties"in e?e.properties=t:e=t,e}logEvent(e,t){var i;this._sender&&(this._extension.publisher==="vscode"?e=this._extension.name+"/"+e:e=this._extension.identifier.value+"/"+e,t=this.mixInCommonPropsAndCleanData(t||{}),this._inLoggingOnlyMode||(i=this._sender)==null||i.sendEventData(e,t),this._logger.trace(e,t))}logUsage(e,t){this._telemetryEnablements.isUsageEnabled&&this.logEvent(e,t)}logError(e,t){!this._telemetryEnablements.isErrorsEnabled||!this._sender||(typeof e=="string"?this.logEvent(e,t):this._sender.sendErrorData(e,t))}get apiTelemetryLogger(){if(!this._apiObject){const e=this,t={logUsage:e.logUsage.bind(e),get isUsageEnabled(){return e._telemetryEnablements.isUsageEnabled},get isErrorsEnabled(){return e._telemetryEnablements.isErrorsEnabled},logError:e.logError.bind(e),dispose:e.dispose.bind(e),onDidChangeEnableStates:e._onDidChangeEnableStates.event.bind(e)};this._apiObject=Object.freeze(t)}return this._apiObject}get isDisposed(){return!this._sender}dispose(){var e;if((e=this._sender)!=null&&e.flush){let t=this._sender;this._sender=void 0,Promise.resolve(t.flush()).then(t=void 0),this._apiObject=void 0}else this._sender=void 0}}function O5(r){const e=Date.now()-new Date(r).getTime();return isNaN(e)?!1:e<1e3*60*60*24}const XT=re("IExtHostTelemetry");var Zd,NS,$S;let IL=class{constructor(e,t,i){Zd.set(this,void 0),this._commands=new Map,this._apiCommands=new Map,NS.set(this,void 0),$S.set(this,void 0),rt(this,Zd,e.getProxy(ce.MainThreadCommands),"f"),this._logService=t,rt(this,$S,i,"f"),rt(this,NS,e.getProxy(ce.MainThreadTelemetry),"f"),this.converter=new $fe(this,n=>{const s=this._apiCommands.get(n);return(s==null?void 0:s.result)===wt.Void?s:void 0},t),this._argumentProcessors=[{processArgument(n){return Ta(n)}},{processArgument(n){return hC(n,function(s){if(qe.isIRange(s))return ge.to(s);if(Us.isIPosition(s))return Wi.to(s);if(qe.isIRange(s.range)&&k.isUri(s.uri))return So.to(s);if(s instanceof De)return s.buffer.buffer;if(!Array.isArray(s))return s})}}]}registerArgumentProcessor(e){this._argumentProcessors.push(e)}registerApiCommand(e){const t=this.registerCommand(!1,e.id,async(...i)=>{const n=e.args.map((o,a)=>{if(!o.validate(i[a]))throw new Error(`Invalid argument '${o.name}' when running '${e.id}', received: ${i[a]}`);return o.convert(i[a])}),s=await this.executeCommand(e.internalId,...n);return e.result.convert(s,i,this.converter)},void 0,{description:e.description,args:e.args,returns:e.result.description});return this._apiCommands.set(e.id,e),new Yt(()=>{t.dispose(),this._apiCommands.delete(e.id)})}registerCommand(e,t,i,n,s,o){if(this._logService.trace("ExtHostCommands#registerCommand",t),!t.trim().length)throw new Error("invalid id");if(this._commands.has(t))throw new Error(`command '${t}' already exists`);return this._commands.set(t,{callback:i,thisArg:n,description:s,extension:o}),e&&V(this,Zd,"f").$registerCommand(t),new Yt(()=>{this._commands.delete(t)&&e&&V(this,Zd,"f").$unregisterCommand(t)})}executeCommand(e,...t){return this._logService.trace("ExtHostCommands#executeCommand",e),this._doExecuteCommand(e,t,!0)}async _doExecuteCommand(e,t,i){if(this._commands.has(e))return V(this,Zd,"f").$fireCommandActivationEvent(e),this._executeContributedCommand(e,t,!1);{let n=!1;const s=hC(t,function(o){if(o instanceof At)return Wi.from(o);if(o instanceof Tt)return ge.from(o);if(o instanceof wo)return So.from(o);if(Zc.isNotebookRange(o))return mc.from(o);if(o instanceof ArrayBuffer)return n=!0,De.wrap(new Uint8Array(o));if(o instanceof Uint8Array)return n=!0,De.wrap(o);if(o instanceof De)return n=!0,o;if(!Array.isArray(o))return o});try{const o=await V(this,Zd,"f").$executeCommand(e,n?new rs(s):s,i);return Ta(o)}catch(o){if(o instanceof Error&&o.message==="$executeCommand:retry")return this._doExecuteCommand(e,t,!1);throw o}}}async _executeContributedCommand(e,t,i){var d,l,u;const n=this._commands.get(e);if(!n)throw new Error("Unknown command");const{callback:s,thisArg:o,description:a}=n;if(a)for(let h=0;h<a.args.length;h++)try{$Y(t[h],a.args[h].constraint)}catch{throw new Error(`Running the contributed command: '${e}' failed. Illegal argument '${a.args[h].name}' - ${a.args[h].description}`)}const c=Tr.create();try{return await s.apply(o,t)}catch(h){if(e===this.converter.delegatingCommandId){const g=this.converter.getActualCommand(...t);g&&(e=g.command)}if(this._logService.error(h,e,(d=n.extension)==null?void 0:d.identifier),!i)throw h;if((l=n.extension)!=null&&l.identifier){const g=V(this,$S,"f").onExtensionError(n.extension.identifier,h);this._logService.trace("forwarded error to extension?",g,(u=n.extension)==null?void 0:u.identifier)}throw new class extends Error{constructor(){var m,y;super(La(h)),this.id=e,this.source=((m=n.extension)==null?void 0:m.displayName)??((y=n.extension)==null?void 0:y.name)}}}finally{this._reportTelemetry(n,e,c.elapsed())}}_reportTelemetry(e,t,i){e.extension&&V(this,NS,"f").$publicLog2("Extension:ActionExecuted",{extensionId:e.extension.identifier.value,id:new jk(t),duration:i})}$executeContributedCommand(e,...t){this._logService.trace("ExtHostCommands#$executeContributedCommand",e);const i=this._commands.get(e);return i?(t=t.map(n=>this._argumentProcessors.reduce((s,o)=>{var a;return o.processArgument(s,(a=i.extension)==null?void 0:a.identifier)},n)),this._executeContributedCommand(e,t,!0)):Promise.reject(new Error(`Contributed command '${e}' does not exist.`))}getCommands(e=!1){return this._logService.trace("ExtHostCommands#getCommands",e),V(this,Zd,"f").$getCommands().then(t=>(e&&(t=t.filter(i=>i[0]!=="_")),t))}$getContributedCommandHandlerDescriptions(){const e=Object.create(null);for(const[t,i]of this._commands){const{description:n}=i;n&&(e[t]=n)}return Promise.resolve(e)}};Zd=new WeakMap;NS=new WeakMap;$S=new WeakMap;IL=T([v(0,Ii),v(1,ze),v(2,XT)],IL);const N5=re("IExtHostCommands");class $fe{constructor(e,t,i){this._commands=e,this._lookupApiCommand=t,this._logService=i,this.delegatingCommandId=`__vsc${Date.now().toString(36)}`,this._cache=new Map,this._cachIdPool=0,this._commands.registerCommand(!0,this.delegatingCommandId,this._executeConvertedCommand,this)}toInternal(e,t){if(!e)return;const i={$ident:void 0,id:e.command,title:e.title,tooltip:e.tooltip};if(!e.command)return i;const n=this._lookupApiCommand(e.command);if(n)i.id=n.internalId,i.arguments=n.args.map((s,o)=>s.convert(e.arguments&&e.arguments[o]));else if(Pr(e.arguments)){const s=`${e.command}/${++this._cachIdPool}`;this._cache.set(s,e),t.add(ot(()=>{this._cache.delete(s),this._logService.trace("CommandsConverter#DISPOSE",s)})),i.$ident=s,i.id=this.delegatingCommandId,i.arguments=[s],this._logService.trace("CommandsConverter#CREATE",e.command,s)}return i}fromInternal(e){return typeof e.$ident=="string"?this._cache.get(e.$ident):{command:e.id,title:e.title,arguments:e.arguments}}getActualCommand(...e){return this._cache.get(e[0])}_executeConvertedCommand(...e){const t=this.getActualCommand(...e);return this._logService.trace("CommandsConverter#EXECUTE",e[0],t?t.command:"MISSING"),t?this._commands.executeCommand(t.command,...t.arguments||[]):Promise.reject(`Actual command not found, wanted to execute ${e[0]}`)}}class we{constructor(e,t,i,n){this.name=e,this.description=t,this.validate=i,this.convert=n}optional(){return new we(this.name,`(optional) ${this.description}`,e=>e==null||this.validate(e),e=>e===void 0?void 0:e===null?null:this.convert(e))}with(e,t){return new we(e??this.name,t??this.description,this.validate,this.convert)}}we.Uri=new we("uri","Uri of a text document",r=>k.isUri(r),r=>r);we.Position=new we("position","A position in a text document",r=>At.isPosition(r),Wi.from);we.Range=new we("range","A range in a text document",r=>Tt.isRange(r),ge.from);we.Selection=new we("selection","A selection in a text document",r=>wd.isSelection(r),Aa.from);we.Number=new we("number","",r=>typeof r=="number",r=>r);we.String=new we("string","",r=>typeof r=="string",r=>r);we.CallHierarchyItem=new we("item","A call hierarchy item",r=>r instanceof Ak,xf.from);we.TypeHierarchyItem=new we("item","A type hierarchy item",r=>r instanceof Fk,Bh.from);we.TestItem=new we("testItem","A VS Code TestItem",r=>r instanceof Qf,hu.from);class wt{constructor(e,t){this.description=e,this.convert=t}}wt.Void=new wt("no result",r=>r);class Ct{constructor(e,t,i,n,s){this.id=e,this.internalId=t,this.description=i,this.args=n,this.result=s}}const Wfe=[new Ct("vscode.executeDocumentHighlights","_executeDocumentHighlights","Execute document highlight provider.",[we.Uri,we.Position],new wt("A promise that resolves to an array of DocumentHighlight-instances.",Fc(vx.to))),new Ct("vscode.executeDocumentSymbolProvider","_executeDocumentSymbolProvider","Execute document symbol provider.",[we.Uri],new wt("A promise that resolves to an array of SymbolInformation and DocumentSymbol instances.",(r,e)=>{if(JN(r))return;class t extends $g{static to(n){const s=new t(n.name,Jo.to(n.kind),n.containerName||"",new wo(e[0],ge.to(n.range)));return s.detail=n.detail,s.range=s.location.range,s.selectionRange=ge.to(n.selectionRange),s.children=n.children?n.children.map(t.to):[],s}}return r.map(t.to)})),new Ct("vscode.executeFormatDocumentProvider","_executeFormatDocumentProvider","Execute document format provider.",[we.Uri,new we("options","Formatting options",r=>!0,r=>r)],new wt("A promise that resolves to an array of TextEdits.",Fc(fr.to))),new Ct("vscode.executeFormatRangeProvider","_executeFormatRangeProvider","Execute range format provider.",[we.Uri,we.Range,new we("options","Formatting options",r=>!0,r=>r)],new wt("A promise that resolves to an array of TextEdits.",Fc(fr.to))),new Ct("vscode.executeFormatOnTypeProvider","_executeFormatOnTypeProvider","Execute format on type provider.",[we.Uri,we.Position,new we("ch","Trigger character",r=>typeof r=="string",r=>r),new we("options","Formatting options",r=>!0,r=>r)],new wt("A promise that resolves to an array of TextEdits.",Fc(fr.to))),new Ct("vscode.executeDefinitionProvider","_executeDefinitionProvider","Execute all definition providers.",[we.Uri,we.Position],new wt("A promise that resolves to an array of Location or LocationLink instances.",Yb)),new Ct("vscode.executeTypeDefinitionProvider","_executeTypeDefinitionProvider","Execute all type definition providers.",[we.Uri,we.Position],new wt("A promise that resolves to an array of Location or LocationLink instances.",Yb)),new Ct("vscode.executeDeclarationProvider","_executeDeclarationProvider","Execute all declaration providers.",[we.Uri,we.Position],new wt("A promise that resolves to an array of Location or LocationLink instances.",Yb)),new Ct("vscode.executeImplementationProvider","_executeImplementationProvider","Execute all implementation providers.",[we.Uri,we.Position],new wt("A promise that resolves to an array of Location or LocationLink instances.",Yb)),new Ct("vscode.executeReferenceProvider","_executeReferenceProvider","Execute all reference providers.",[we.Uri,we.Position],new wt("A promise that resolves to an array of Location-instances.",Fc(So.to))),new Ct("vscode.executeHoverProvider","_executeHoverProvider","Execute all hover providers.",[we.Uri,we.Position],new wt("A promise that resolves to an array of Hover-instances.",Fc(gx.to))),new Ct("vscode.executeSelectionRangeProvider","_executeSelectionRangeProvider","Execute selection range provider.",[we.Uri,new we("position","A position in a text document",r=>Array.isArray(r)&&r.every(e=>At.isPosition(e)),r=>r.map(Wi.from))],new wt("A promise that resolves to an array of ranges.",r=>r.map(e=>{let t;for(const i of e.reverse())t=new Hg(ge.to(i),t);return t}))),new Ct("vscode.executeWorkspaceSymbolProvider","_executeWorkspaceSymbolProvider","Execute all workspace symbol providers.",[we.String.with("query","Search string")],new wt("A promise that resolves to an array of SymbolInformation-instances.",r=>r.map(tw.to))),new Ct("vscode.prepareCallHierarchy","_executePrepareCallHierarchy","Prepare call hierarchy at a position inside a document",[we.Uri,we.Position],new wt("A promise that resolves to an array of CallHierarchyItem-instances",r=>r.map(xf.to))),new Ct("vscode.provideIncomingCalls","_executeProvideIncomingCalls","Compute incoming calls for an item",[we.CallHierarchyItem],new wt("A promise that resolves to an array of CallHierarchyIncomingCall-instances",r=>r.map(Y0.to))),new Ct("vscode.provideOutgoingCalls","_executeProvideOutgoingCalls","Compute outgoing calls for an item",[we.CallHierarchyItem],new wt("A promise that resolves to an array of CallHierarchyOutgoingCall-instances",r=>r.map(X0.to))),new Ct("vscode.prepareRename","_executePrepareRename","Execute the prepareRename of rename provider.",[we.Uri,we.Position],new wt("A promise that resolves to a range and placeholder text.",r=>{if(r)return{range:ge.to(r.range),placeholder:r.text}})),new Ct("vscode.executeDocumentRenameProvider","_executeDocumentRenameProvider","Execute rename provider.",[we.Uri,we.Position,we.String.with("newName","The new symbol name")],new wt("A promise that resolves to a WorkspaceEdit.",r=>{if(r){if(r.rejectReason)throw new Error(r.rejectReason);return bo.to(r)}})),new Ct("vscode.executeLinkProvider","_executeLinkProvider","Execute document link provider.",[we.Uri,we.Number.with("linkResolveCount","Number of links that should be resolved, only when links are unresolved.").optional()],new wt("A promise that resolves to an array of DocumentLink-instances.",r=>r.map(jh.to))),new Ct("vscode.provideDocumentSemanticTokensLegend","_provideDocumentSemanticTokensLegend","Provide semantic tokens legend for a document",[we.Uri],new wt("A promise that resolves to SemanticTokensLegend.",r=>{if(r)return new rE(r.tokenTypes,r.tokenModifiers)})),new Ct("vscode.provideDocumentSemanticTokens","_provideDocumentSemanticTokens","Provide semantic tokens for a document",[we.Uri],new wt("A promise that resolves to SemanticTokens.",r=>{if(!r)return;const e=CC(r);if(e.type==="full")return new yf(e.data,void 0)})),new Ct("vscode.provideDocumentRangeSemanticTokensLegend","_provideDocumentRangeSemanticTokensLegend","Provide semantic tokens legend for a document range",[we.Uri,we.Range.optional()],new wt("A promise that resolves to SemanticTokensLegend.",r=>{if(r)return new rE(r.tokenTypes,r.tokenModifiers)})),new Ct("vscode.provideDocumentRangeSemanticTokens","_provideDocumentRangeSemanticTokens","Provide semantic tokens for a document range",[we.Uri,we.Range],new wt("A promise that resolves to SemanticTokens.",r=>{if(!r)return;const e=CC(r);if(e.type==="full")return new yf(e.data,void 0)})),new Ct("vscode.executeCompletionItemProvider","_executeCompletionItemProvider","Execute completion item provider.",[we.Uri,we.Position,we.String.with("triggerCharacter","Trigger completion when the user types the character, like `,` or `(`").optional(),we.Number.with("itemResolveCount","Number of completions to resolve (too large numbers slow down completions)").optional()],new wt("A promise that resolves to a CompletionList-instance.",(r,e,t)=>{if(!r)return new hf([]);const i=r.suggestions.map(n=>iL.to(n,t));return new hf(i,r.incomplete)})),new Ct("vscode.executeSignatureHelpProvider","_executeSignatureHelpProvider","Execute signature help provider.",[we.Uri,we.Position,we.String.with("triggerCharacter","Trigger signature help when the user types the character, like `,` or `(`").optional()],new wt("A promise that resolves to SignatureHelp.",r=>{if(r)return nw.to(r)})),new Ct("vscode.executeCodeLensProvider","_executeCodeLensProvider","Execute code lens provider.",[we.Uri,we.Number.with("itemResolveCount","Number of lenses that should be resolved and returned. Will only return resolved lenses, will impact performance)").optional()],new wt("A promise that resolves to an array of CodeLens-instances.",(r,e,t)=>Fc(i=>new l_(ge.to(i.range),i.command&&t.fromInternal(i.command)))(r))),new Ct("vscode.executeCodeActionProvider","_executeCodeActionProvider","Execute code action provider.",[we.Uri,new we("rangeOrSelection","Range in a text document. Some refactoring provider requires Selection object.",r=>Tt.isRange(r),r=>wd.isSelection(r)?Aa.from(r):ge.from(r)),we.String.with("kind","Code action kind to return code actions for").optional(),we.Number.with("itemResolveCount","Number of code actions to resolve (too large numbers slow down code actions)").optional()],new wt("A promise that resolves to an array of Command-instances.",(r,e,t)=>Fc(i=>{if(i._isSynthetic){if(!i.command)throw new Error("Synthetic code actions must have a command");return t.fromInternal(i.command)}else{const n=new d_(i.title,i.kind?new $i(i.kind):void 0);return i.edit&&(n.edit=bo.to(i.edit)),i.command&&(n.command=t.fromInternal(i.command)),n.isPreferred=i.isPreferred,n}})(r))),new Ct("vscode.executeDocumentColorProvider","_executeDocumentColorProvider","Execute document color provider.",[we.Uri],new wt("A promise that resolves to an array of ColorInformation objects.",r=>r?r.map(e=>new m_(ge.to(e.range),_m.to(e.color))):[])),new Ct("vscode.executeColorPresentationProvider","_executeColorPresentationProvider","Execute color presentation provider.",[new we("color","The color to show and insert",r=>r instanceof pf,_m.from),new we("context","Context object with uri and range",r=>!0,r=>({uri:r.uri,range:ge.from(r.range)}))],new wt("A promise that resolves to an array of ColorPresentation objects.",r=>r?r.map(Sx.to):[])),new Ct("vscode.executeInlayHintProvider","_executeInlayHintProvider","Execute inlay hints provider",[we.Uri,we.Range],new wt("A promise that resolves to an array of Inlay objects",(r,e,t)=>r.map(nL.to.bind(void 0,t)))),new Ct("vscode.executeFoldingRangeProvider","_executeFoldingRangeProvider","Execute folding range provider",[we.Uri],new wt("A promise that resolves to an array of FoldingRange objects",(r,e)=>{if(r)return r.map(Ex.to)})),new Ct("vscode.resolveNotebookContentProviders","_resolveNotebookContentProvider","Resolve Notebook Content Providers",[],new wt("A promise that resolves to an array of NotebookContentProvider static info objects.",Fc(r=>({viewType:r.viewType,displayName:r.displayName,options:{transientOutputs:r.options.transientOutputs,transientCellMetadata:r.options.transientCellMetadata,transientDocumentMetadata:r.options.transientDocumentMetadata},filenamePattern:r.filenamePattern.map(e=>Dx.to(e))})))),new Ct("vscode.executeInlineValueProvider","_executeInlineValueProvider","Execute inline value provider",[we.Uri,we.Range],new wt("A promise that resolves to an array of InlineValue objects",r=>r.map(mx.to))),new Ct("vscode.open","_workbench.open","Opens the provided resource in the editor. Can be a text or binary file, or an http(s) URL. If you need more control over the options for opening a text file, use vscode.window.showTextDocument instead.",[new we("uriOrString","Uri-instance or string (only http/https)",r=>k.isUri(r)||typeof r=="string"&&WY(r,pe.http,pe.https),r=>r),new we("columnOrOptions","Either the column in which to open or editor options, see vscode.TextDocumentShowOptions",r=>r===void 0||typeof r=="number"||typeof r=="object",r=>r&&(typeof r=="number"?[Hn.from(r),void 0]:[Hn.from(r.viewColumn),Dy.from(r)])).optional(),we.String.with("label","").optional()],wt.Void),new Ct("vscode.openWith","_workbench.openWith","Opens the provided resource with a specific editor.",[we.Uri.with("resource","Resource to open"),we.String.with("viewId","Custom editor view id or 'default' to use VS Code's default editor"),new we("columnOrOptions","Either the column in which to open or editor options, see vscode.TextDocumentShowOptions",r=>r===void 0||typeof r=="number"||typeof r=="object",r=>r&&(typeof r=="number"?[Hn.from(r),void 0]:[Hn.from(r.viewColumn),Dy.from(r)])).optional()],wt.Void),new Ct("vscode.diff","_workbench.diff","Opens the provided resources in the diff editor to compare their contents.",[we.Uri.with("left","Left-hand side resource of the diff editor"),we.Uri.with("right","Right-hand side resource of the diff editor"),we.String.with("title","Human readable title for the diff editor").optional(),new we("columnOrOptions","Either the column in which to open or editor options, see vscode.TextDocumentShowOptions",r=>r===void 0||typeof r=="object",r=>r&&[Hn.from(r.viewColumn),Dy.from(r)]).optional()],wt.Void),new Ct("vscode.prepareTypeHierarchy","_executePrepareTypeHierarchy","Prepare type hierarchy at a position inside a document",[we.Uri,we.Position],new wt("A promise that resolves to an array of TypeHierarchyItem-instances",r=>r.map(Bh.to))),new Ct("vscode.provideSupertypes","_executeProvideSupertypes","Compute supertypes for an item",[we.TypeHierarchyItem],new wt("A promise that resolves to an array of TypeHierarchyItem-instances",r=>r.map(Bh.to))),new Ct("vscode.provideSubtypes","_executeProvideSubtypes","Compute subtypes for an item",[we.TypeHierarchyItem],new wt("A promise that resolves to an array of TypeHierarchyItem-instances",r=>r.map(Bh.to))),new Ct("vscode.revealTestInExplorer","_revealTestInExplorer","Reveals a test instance in the explorer",[we.TestItem],wt.Void),new Ct("vscode.experimental.editSession.continue","_workbench.editSessions.actions.continueEditSession","Continue the current edit session in a different workspace",[we.Uri.with("workspaceUri","The target workspace to continue the current edit session in")],wt.Void),new Ct("setContext","_setContext","Set a custom context key value that can be used in when clauses.",[we.String.with("name","The context key name"),new we("value","The context key value",()=>!0,r=>r)],wt.Void)];class Hfe{static register(e){Wfe.forEach(e.registerApiCommand,e),this._registerValidateWhenClausesCommand(e)}static _registerValidateWhenClausesCommand(e){e.registerCommand(!1,"_validateWhenClauses",jY)}}function Fc(r){return e=>{if(Array.isArray(e))return e.map(r)}}function Yb(r){if(!Array.isArray(r))return;const e=[];for(const t of r)HY(t)?e.push(iw.to(t)):e.push(So.to(t));return e}class jfe{constructor(e){const t=e.getProxy(ce.MainThreadClipboard);this.value=Object.freeze({readText(){return t.$readText()},writeText(i){return t.$writeText(i)}})}}function Bfe(r,e,t){const i=r.getProxy(ce.MainThreadComments),h=class h{constructor(){this._commentControllers=new Map,this._commentControllersByExtension=new Ln,e.registerArgumentProcessor({processArgument:y=>{if(y&&y.$mid===6){const _=this._commentControllers.get(y.handle);return _?_.value:y}else if(y&&y.$mid===7){const _=this._commentControllers.get(y.commentControlHandle);if(!_)return y;const b=_.getCommentThread(y.commentThreadHandle);return b?b.value:y}else if(y&&(y.$mid===9||y.$mid===8)){const _=this._commentControllers.get(y.thread.commentControlHandle);if(!_)return y;const b=_.getCommentThread(y.thread.commentThreadHandle);return b?y.$mid===8?b.value:{thread:b.value,text:y.text}:y}else if(y&&y.$mid===10){const _=this._commentControllers.get(y.thread.commentControlHandle);if(!_)return y;const b=_.getCommentThread(y.thread.commentThreadHandle);if(!b)return y;const E=y.commentUniqueId,D=b.getCommentByUniqueId(E);return D||y}else if(y&&y.$mid===11){const _=this._commentControllers.get(y.thread.commentControlHandle);if(!_)return y;const b=_.getCommentThread(y.thread.commentThreadHandle);if(!b)return y;const E=y.text,D=y.commentUniqueId,R=b.getCommentByUniqueId(D);return R?(typeof R.body=="string"?R.body=E:R.body=new Ia(E),R):y}return y}})}createCommentController(y,_,b){const E=h.handlePool++,D=new o(y,E,_,b);this._commentControllers.set(D.handle,D);const R=this._commentControllersByExtension.get(y.identifier)||[];return R.push(D),this._commentControllersByExtension.set(y.identifier,R),D.value}$createCommentThreadTemplate(y,_,b){const E=this._commentControllers.get(y);E&&E.$createCommentThreadTemplate(_,b)}async $updateCommentThreadTemplate(y,_,b){const E=this._commentControllers.get(y);E&&E.$updateCommentThreadTemplate(_,b)}$deleteCommentThread(y,_){const b=this._commentControllers.get(y);b==null||b.$deleteCommentThread(_)}$provideCommentingRanges(y,_,b){const E=this._commentControllers.get(y);if(!E||!E.commentingRangeProvider)return Promise.resolve(void 0);const D=t.getDocument(k.revive(_));return Nr(async()=>{const R=await E.commentingRangeProvider.provideCommentingRanges(D,b);let M;return Array.isArray(R)?M={ranges:R,fileComments:!1}:R?M={ranges:R.ranges||[],fileComments:R.fileComments||!1}:M=ii(R),M}).then(R=>{let M;return R&&(M={ranges:R.ranges.map(O=>ge.from(O)),fileComments:R.fileComments}),M})}$toggleReaction(y,_,b,E,D){const R=this._commentControllers.get(y);return!R||!R.reactionHandler?Promise.resolve(void 0):Nr(()=>{const M=R.getCommentThread(_);if(M){const O=M.getCommentByUniqueId(E.uniqueIdInThread);if(R!==void 0&&O&&R.reactionHandler)return R.reactionHandler(O,d(D))}return Promise.resolve(void 0)})}};mi(h,"handlePool",0);let n=h;const g=class g{set threadId(y){this._id=y}get threadId(){return this._id}get id(){return this._id}get resource(){return this._uri}get uri(){return this._uri}set range(y){(y===void 0!=(this._range===void 0)||!y||!this._range||!y.isEqual(this._range))&&(this._range=y,this.modifications.range=y,this._onDidUpdateCommentThread.fire())}get range(){return this._range}set canReply(y){this._canReply!==y&&(this._canReply=y,this.modifications.canReply=y,this._onDidUpdateCommentThread.fire())}get canReply(){return this._canReply}get label(){return this._label}set label(y){this._label=y,this.modifications.label=y,this._onDidUpdateCommentThread.fire()}get contextValue(){return this._contextValue}set contextValue(y){this._contextValue=y,this.modifications.contextValue=y,this._onDidUpdateCommentThread.fire()}get comments(){return this._comments}set comments(y){this._comments=y,this.modifications.comments=y,this._onDidUpdateCommentThread.fire()}get collapsibleState(){return this._collapseState}set collapsibleState(y){this._collapseState=y,this.modifications.collapsibleState=y,this._onDidUpdateCommentThread.fire()}get state(){return this._state}set state(y){this._state=y,this.modifications.state=y,this._onDidUpdateCommentThread.fire()}get isDisposed(){return this._isDiposed}constructor(y,_,b,E,D,R,M,O){this._commentControllerHandle=_,this._id=b,this._uri=E,this._range=D,this._comments=R,this.extensionDescription=M,this._isTemplate=O,this.handle=g._handlePool++,this.commentHandle=0,this.modifications=Object.create(null),this._onDidUpdateCommentThread=new A,this.onDidUpdateCommentThread=this._onDidUpdateCommentThread.event,this._canReply=!0,this._commentsMap=new Map,this._acceptInputDisposables=new Hr,this._acceptInputDisposables.value=new me,this._id===void 0&&(this._id=`${y}.${this.handle}`),i.$createCommentThread(_,this.handle,this._id,this._uri,ge.from(this._range),M.identifier,this._isTemplate),this._localDisposables=[],this._isDiposed=!1,this._localDisposables.push(this.onDidUpdateCommentThread(()=>{this.eventuallyUpdateCommentThread()})),this.comments=R,this._localDisposables.push({dispose:()=>{i.$deleteCommentThread(_,this.handle)}});const L=this;this.value={get uri(){return L.uri},get range(){return L.range},set range(W){L.range=W},get comments(){return L.comments},set comments(W){L.comments=W},get collapsibleState(){return L.collapsibleState},set collapsibleState(W){L.collapsibleState=W},get canReply(){return L.canReply},set canReply(W){L.canReply=W},get contextValue(){return L.contextValue},set contextValue(W){L.contextValue=W},get label(){return L.label},set label(W){L.label=W},get state(){return L.state},set state(W){L.state=W},dispose:()=>{L.dispose()}}}updateIsTemplate(){this._isTemplate&&(this._isTemplate=!1,this.modifications.isTemplate=!1)}eventuallyUpdateCommentThread(){if(this._isDiposed)return;this.updateIsTemplate(),this._acceptInputDisposables.value||(this._acceptInputDisposables.value=new me);const y=b=>Object.prototype.hasOwnProperty.call(this.modifications,b),_={};y("range")&&(_.range=ge.from(this._range)),y("label")&&(_.label=this.label),y("contextValue")&&(_.contextValue=this.contextValue??null),y("comments")&&(_.comments=this._comments.map(b=>a(this,b,this._commentsMap,this.extensionDescription))),y("collapsibleState")&&(_.collapseState=l(this._collapseState)),y("canReply")&&(_.canReply=this.canReply),y("state")&&(_.state=u(this._state)),y("isTemplate")&&(_.isTemplate=this._isTemplate),this.modifications={},i.$updateCommentThread(this._commentControllerHandle,this.handle,this._id,this._uri,_)}getCommentByUniqueId(y){for(const _ of this._commentsMap){const b=_[0],E=_[1];if(y===E)return b}}dispose(){this._isDiposed=!0,this._acceptInputDisposables.dispose(),this._localDisposables.forEach(y=>y.dispose())}};mi(g,"_handlePool",0);let s=g;T([pk(100)],s.prototype,"eventuallyUpdateCommentThread",null);class o{get id(){return this._id}get label(){return this._label}get handle(){return this._handle}get commentingRangeProvider(){return this._commentingRangeProvider}set commentingRangeProvider(y){this._commentingRangeProvider=y,i.$updateCommentingRanges(this.handle)}get reactionHandler(){return this._reactionHandler}set reactionHandler(y){this._reactionHandler=y,i.$updateCommentControllerFeatures(this.handle,{reactionHandler:!!y})}get options(){return this._options}set options(y){this._options=y,i.$updateCommentControllerFeatures(this.handle,{options:this._options})}constructor(y,_,b,E){this._extension=y,this._handle=_,this._id=b,this._label=E,this._threads=new Map,i.$registerCommentController(this.handle,b,E);const D=this;this.value=Object.freeze({id:D.id,label:D.label,get options(){return D.options},set options(R){D.options=R},get commentingRangeProvider(){return D.commentingRangeProvider},set commentingRangeProvider(R){D.commentingRangeProvider=R},get reactionHandler(){return D.reactionHandler},set reactionHandler(R){D.reactionHandler=R},createCommentThread(R,M,O){return D.createCommentThread(R,M,O).value},dispose:()=>{D.dispose()}}),this._localDisposables=[],this._localDisposables.push({dispose:()=>{i.$unregisterCommentController(this.handle)}})}createCommentThread(y,_,b){_===void 0&&He(this._extension,"fileComments");const E=new s(this.id,this.handle,void 0,y,_,b,this._extension,!1);return this._threads.set(E.handle,E),E}$createCommentThreadTemplate(y,_){const b=new s(this.id,this.handle,void 0,k.revive(y),ge.to(_),[],this._extension,!0);return b.collapsibleState=Kn.Expanded,this._threads.set(b.handle,b),b}$updateCommentThreadTemplate(y,_){const b=this._threads.get(y);b&&(b.range=ge.to(_))}$deleteCommentThread(y){const _=this._threads.get(y);_==null||_.dispose(),this._threads.delete(y)}getCommentThread(y){return this._threads.get(y)}dispose(){this._threads.forEach(y=>{y.dispose()}),this._localDisposables.forEach(y=>y.dispose())}}function a(m,y,_,b){var D;let E=_.get(y);return E||(E=++m.commentHandle,_.set(y,E)),y.state!==void 0&&He(b,"commentsDraftState"),{mode:y.mode,contextValue:y.contextValue,uniqueIdInThread:E,body:typeof y.body=="string"?y.body:zi.from(y.body),userName:y.author.name,userIconPath:y.author.iconPath,label:y.label,commentReactions:y.reactions?y.reactions.map(R=>c(R)):void 0,state:y.state,timestamp:(D=y.timestamp)==null?void 0:D.toJSON()}}function c(m){return{label:m.label,iconPath:m.iconPath?zT(m.iconPath):void 0,count:m.count,hasReacted:m.authorHasReacted}}function d(m){return{label:m.label||"",count:m.count||0,iconPath:m.iconPath?k.revive(m.iconPath):"",authorHasReacted:m.hasReacted||!1}}function l(m){if(m!==void 0)switch(m){case Kg.Expanded:return Kn.Expanded;case Kg.Collapsed:return Kn.Collapsed}return Kn.Collapsed}function u(m){if(m!==void 0)switch(m){case k_.Unresolved:return Ks.Unresolved;case k_.Resolved:return Ks.Resolved}return Ks.Unresolved}return new n}var Kd,Fu,Er;class Ax{constructor(e,t,i,n,s,o,a){this._name=e,this._owner=t,this._maxDiagnosticsPerFile=i,this._modelVersionIdProvider=n,Kd.set(this,void 0),Fu.set(this,void 0),Er.set(this,void 0),this._isDisposed=!1,rt(this,Er,new ki(c=>s.getComparisonKey(c)),"f"),rt(this,Kd,o,"f"),rt(this,Fu,a,"f")}dispose(){var e;this._isDisposed||(V(this,Fu,"f").fire([...V(this,Er,"f").keys()]),(e=V(this,Kd,"f"))==null||e.$clear(this._owner),V(this,Er,"f").clear(),this._isDisposed=!0)}get name(){return this._checkDisposed(),this._name}set(e,t){if(!e){this.clear();return}this._checkDisposed();let i=[];if(k.isUri(e)){if(!t){this.delete(e);return}V(this,Er,"f").set(e,t.slice()),i=[e]}else if(Array.isArray(e)){i=[];let s;e=[...e].sort(Ax._compareIndexedTuplesByUri);for(const o of e){const[a,c]=o;if((!s||a.toString()!==s.toString())&&(s&&V(this,Er,"f").get(s).length===0&&V(this,Er,"f").delete(s),s=a,i.push(a),V(this,Er,"f").set(a,[])),c){const d=V(this,Er,"f").get(a);d==null||d.push(...c)}else{const d=V(this,Er,"f").get(a);d&&(d.length=0)}}}if(V(this,Fu,"f").fire(i),!V(this,Kd,"f"))return;const n=[];for(const s of i){let o=[];const a=V(this,Er,"f").get(s);if(a)if(a.length>this._maxDiagnosticsPerFile){o=[];const c=[ur.Error,ur.Warning,ur.Information,ur.Hint];e:for(let d=0;d<4;d++)for(const l of a)if(l.severity===c[d]&&o.push({...mm.from(l),modelVersionId:this._modelVersionIdProvider(s)})===this._maxDiagnosticsPerFile)break e;o.push({severity:Ka.Info,message:p({key:"limitHit",comment:["amount of errors/warning skipped due to limits"]},"Not showing {0} further errors and warnings.",a.length-this._maxDiagnosticsPerFile),startLineNumber:o[o.length-1].startLineNumber,startColumn:o[o.length-1].startColumn,endLineNumber:o[o.length-1].endLineNumber,endColumn:o[o.length-1].endColumn})}else o=a.map(c=>({...mm.from(c),modelVersionId:this._modelVersionIdProvider(s)}));n.push([s,o])}V(this,Kd,"f").$changeMany(this._owner,n)}delete(e){var t;this._checkDisposed(),V(this,Fu,"f").fire([e]),V(this,Er,"f").delete(e),(t=V(this,Kd,"f"))==null||t.$changeMany(this._owner,[[e,void 0]])}clear(){var e;this._checkDisposed(),V(this,Fu,"f").fire([...V(this,Er,"f").keys()]),V(this,Er,"f").clear(),(e=V(this,Kd,"f"))==null||e.$clear(this._owner)}forEach(e,t){this._checkDisposed();for(const[i,n]of this)e.call(t,i,n,this)}*[(Kd=new WeakMap,Fu=new WeakMap,Er=new WeakMap,Symbol.iterator)](){this._checkDisposed();for(const e of V(this,Er,"f").keys())yield[e,this.get(e)]}get(e){this._checkDisposed();const t=V(this,Er,"f").get(e);return Array.isArray(t)?Object.freeze(t.slice(0)):[]}has(e){return this._checkDisposed(),Array.isArray(V(this,Er,"f").get(e))}_checkDisposed(){if(this._isDisposed)throw new Error("illegal state - object is disposed")}static _compareIndexedTuplesByUri(e,t){return e[0].toString()<t[0].toString()?-1:e[0].toString()>t[0].toString()?1:0}}let cw=class Cp{static _mapper(e){const t=new ki;for(const i of e)t.set(i,i);return{uris:Object.freeze(Array.from(t.values()))}}constructor(e,t,i,n){this._logService=t,this._fileSystemInfoService=i,this._extHostDocumentsAndEditors=n,this._collections=new Map,this._onDidChangeDiagnostics=new bq({merge:s=>s.flat(),delay:50}),this.onDidChangeDiagnostics=F.map(this._onDidChangeDiagnostics.event,Cp._mapper),this._proxy=e.getProxy(ce.MainThreadDiagnostics)}createDiagnosticCollection(e,t){const{_collections:i,_proxy:n,_onDidChangeDiagnostics:s,_logService:o,_fileSystemInfoService:a,_extHostDocumentsAndEditors:c}=this,d=new class{$changeMany(h,g){n.$changeMany(h,g),o.trace("[DiagnosticCollection] change many (extension, owner, uris)",e.value,h,g.length===0?"CLEARING":g)}$clear(h){n.$clear(h),o.trace("[DiagnosticCollection] remove all (extension, owner)",e.value,h)}dispose(){n.dispose()}};let l;if(!t)t="_generated_diagnostic_collection_name_#"+Cp._idPool++,l=t;else if(!i.has(t))l=t;else{this._logService.warn(`DiagnosticCollection with name '${t}' does already exist.`);do l=t+Cp._idPool++;while(i.has(l))}return new class extends Ax{constructor(){super(t,l,Cp._maxDiagnosticsPerFile,h=>{var g;return(g=c.getDocument(h))==null?void 0:g.version},a.extUri,d,s),i.set(l,this)}dispose(){super.dispose(),i.delete(l)}}}getDiagnostics(e){if(e)return this._getDiagnostics(e);{const t=new Map,i=[];for(const n of this._collections.values())n.forEach((s,o)=>{let a=t.get(s.toString());typeof a>"u"&&(a=i.length,t.set(s.toString(),a),i.push([s,[]])),i[a][1]=i[a][1].concat(...o)});return i}}_getDiagnostics(e){let t=[];for(const i of this._collections.values())i.has(e)&&(t=t.concat(i.get(e)));return t}$acceptMarkersChange(e){if(!this._mirrorCollection){const t="_generated_mirror",i=new Ax(t,t,Cp._maxDiagnosticsPerFile,n=>{},this._fileSystemInfoService.extUri,void 0,this._onDidChangeDiagnostics);this._collections.set(t,i),this._mirrorCollection=i}for(const[t,i]of e)this._mirrorCollection.set(k.revive(t),i.map(mm.to))}};cw._idPool=0;cw._maxDiagnosticsPerFile=1e3;cw=T([v(1,ze),v(2,iv)],cw);class Ufe{constructor(e){this._proxy=e.getProxy(ce.MainThreadDialogs)}showOpenDialog(e,t){return t!=null&&t.allowUIResources&&He(e,"showLocal"),this._proxy.$showOpenDialog(t).then(i=>i?i.map(n=>k.revive(n)):void 0)}showSaveDialog(e){return this._proxy.$showSaveDialog(e).then(t=>t?k.revive(t):void 0)}}class JT{constructor(e,t,i){this._documentsAndEditors=t,this._logService=i,this._documentContentProviders=new Map,this._proxy=e.getProxy(ce.MainThreadDocumentContentProviders)}registerTextDocumentContentProvider(e,t){if(Object.keys(pe).indexOf(e)>=0)throw new Error(`scheme '${e}' already registered`);const i=JT._handlePool++;this._documentContentProviders.set(i,t),this._proxy.$registerTextContentProvider(i,e);let n;return typeof t.onDidChange=="function"&&(n=t.onDidChange(s=>{if(s.scheme!==e){this._logService.warn(`Provider for scheme '${e}' is firing event for schema '${s.scheme}' which will be IGNORED`);return}this._documentsAndEditors.getDocument(s)&&this.$provideTextDocumentContent(i,s).then(o=>{if(!o&&typeof o!="string")return;const a=this._documentsAndEditors.getDocument(s);if(!a)return;const c=Uq(o);if(!a.equalLines(c))return this._proxy.$onVirtualDocumentChange(s,o)},en)})),new Yt(()=>{this._documentContentProviders.delete(i)&&this._proxy.$unregisterTextContentProvider(i),n&&(n.dispose(),n=void 0)})}$provideTextDocumentContent(e,t){const i=this._documentContentProviders.get(e);return i?Promise.resolve(i.provideTextDocumentContent(k.revive(t),_t.None)):Promise.reject(new Error(`unsupported uri-scheme: ${t.scheme}`))}}JT._handlePool=0;class Vfe{constructor(e,t,i,n={timeout:1500,errors:3}){this._logService=e,this._documents=t,this._mainThreadBulkEdits=i,this._thresholds=n,this._callbacks=new rk,this._badListeners=new WeakMap}dispose(){this._callbacks.clear()}getOnWillSaveTextDocumentEvent(e){return(t,i,n)=>{const o={dispose:this._callbacks.push([t,i,e])};return Array.isArray(n)&&n.push(o),o}}async $participateInSave(e,t){const i=k.revive(e);let n=!1;const s=setTimeout(()=>n=!0,this._thresholds.timeout),o=[];try{for(const a of[...this._callbacks]){if(n)break;const c=this._documents.getDocument(i),d=await this._deliverEventAsyncAndBlameBadListeners(a,{document:c,reason:Cx.to(t)});o.push(d)}}finally{clearTimeout(s)}return o}_deliverEventAsyncAndBlameBadListeners([e,t,i],n){const s=this._badListeners.get(e);return typeof s=="number"&&s>this._thresholds.errors?Promise.resolve(!1):this._deliverEventAsync(i,e,t,n).then(()=>!0,o=>{if(this._logService.error(`onWillSaveTextDocument-listener from extension '${i.identifier.value}' threw ERROR`),this._logService.error(o),!(o instanceof Error)||o.message!=="concurrent_edits"){const a=this._badListeners.get(e);this._badListeners.set(e,a?a+1:1),typeof a=="number"&&a>this._thresholds.errors&&this._logService.info(`onWillSaveTextDocument-listener from extension '${i.identifier.value}' will now be IGNORED because of timeouts and/or errors`)}return!1})}_deliverEventAsync(e,t,i,n){const s=[],o=Date.now(),{document:a,reason:c}=n,{version:d}=a,l=Object.freeze({document:a,reason:c,waitUntil(u){if(Object.isFrozen(s))throw BY("waitUntil can not be called async");s.push(Promise.resolve(u))}});try{t.apply(i,[l])}catch(u){return Promise.reject(u)}return new Promise((u,h)=>{const g=setTimeout(()=>h(new Error("timeout")),this._thresholds.timeout);return Promise.all(s).then(m=>{this._logService.debug(`onWillSaveTextDocument-listener from extension '${e.identifier.value}' finished after ${Date.now()-o}ms`),clearTimeout(g),u(m)}).catch(m=>{clearTimeout(g),h(m)})}).then(u=>{const h={edits:[]};for(const g of u)if(Array.isArray(g)&&g.every(m=>m instanceof bd))for(const{newText:m,newEol:y,range:_}of g)h.edits.push({resource:a.uri,versionId:void 0,textEdit:{range:_&&ge.from(_),text:m,eol:y&&wm.from(y)}});if(h.edits.length!==0)return d===a.version?this._mainThreadBulkEdits.$tryApplyWorkspaceEdit(h):Promise.reject(new Error("concurrent_edits"))})}}const RL=new Map;function qfe(r,e){e?RL.set(r,e):RL.delete(r)}function Gfe(r){return RL.get(r)}class zfe extends UY{constructor(e,t,i,n,s,o,a,c){super(t,i,n,s),this._proxy=e,this._languageId=o,this._isDirty=a,this.notebook=c,this._isDisposed=!1}dispose(){ha(!this._isDisposed),this._isDisposed=!0,this._isDirty=!1}equalLines(e){return Ds(this._lines,e)}get document(){if(!this._document){const e=this;this._document={get uri(){return e._uri},get fileName(){return e._uri.fsPath},get isUntitled(){return e._uri.scheme===pe.untitled},get languageId(){return e._languageId},get version(){return e._versionId},get isClosed(){return e._isDisposed},get isDirty(){return e._isDirty},save(){return e._save()},getText(t){return t?e._getTextInRange(t):e.getText()},get eol(){return e._eol===`
`?Bo.LF:Bo.CRLF},get lineCount(){return e._lines.length},lineAt(t){return e._lineAt(t)},offsetAt(t){return e._offsetAt(t)},positionAt(t){return e._positionAt(t)},validateRange(t){return e._validateRange(t)},validatePosition(t){return e._validatePosition(t)},getWordRangeAtPosition(t,i){return e._getWordRangeAtPosition(t,i)}}}return Object.freeze(this._document)}_acceptLanguageId(e){ha(!this._isDisposed),this._languageId=e}_acceptIsDirty(e){ha(!this._isDisposed),this._isDirty=e}_save(){return this._isDisposed?Promise.reject(new Error("Document has been closed")):this._proxy.$trySaveDocument(this._uri)}_getTextInRange(e){const t=this._validateRange(e);if(t.isEmpty)return"";if(t.isSingleLine)return this._lines[t.start.line].substring(t.start.character,t.end.character);const i=this._eol,n=t.start.line,s=t.end.line,o=[];o.push(this._lines[n].substring(t.start.character));for(let a=n+1;a<s;a++)o.push(this._lines[a]);return o.push(this._lines[s].substring(0,t.end.character)),o.join(i)}_lineAt(e){let t;if(e instanceof At?t=e.line:typeof e=="number"&&(t=e),typeof t!="number"||t<0||t>=this._lines.length||Math.floor(t)!==t)throw new Error("Illegal value for `line`");return new Kfe(t,this._lines[t],t===this._lines.length-1)}_offsetAt(e){return e=this._validatePosition(e),this._ensureLineStarts(),this._lineStarts.getPrefixSum(e.line-1)+e.character}_positionAt(e){e=Math.floor(e),e=Math.max(0,e),this._ensureLineStarts();const t=this._lineStarts.getIndexOf(e),i=this._lines[t.index].length;return new At(t.index,Math.min(t.remainder,i))}_validateRange(e){if(!(e instanceof Tt))throw new Error("Invalid argument");const t=this._validatePosition(e.start),i=this._validatePosition(e.end);return t===e.start&&i===e.end?e:new Tt(t.line,t.character,i.line,i.character)}_validatePosition(e){if(!(e instanceof At))throw new Error("Invalid argument");if(this._lines.length===0)return e.with(0,0);let{line:t,character:i}=e,n=!1;if(t<0)t=0,i=0,n=!0;else if(t>=this._lines.length)t=this._lines.length-1,i=this._lines[t].length,n=!0;else{const s=this._lines[t].length;i<0?(i=0,n=!0):i>s&&(i=s,n=!0)}return n?new At(t,i):e}_getWordRangeAtPosition(e,t){const i=this._validatePosition(e);if(!t)t=Gfe(this._languageId);else if(Vq(t))throw new Error(`[getWordRangeAtPosition]: ignoring custom regexp '${t.source}' because it matches the empty string.`);const n=Aq(i.character+1,mq(t),this._lines[i.line],0);if(n)return new Tt(i.line,n.startColumn-1,i.line,n.endColumn-1)}}class Kfe{constructor(e,t,i){this._line=e,this._text=t,this._isLastLine=i}get lineNumber(){return this._line}get text(){return this._text}get range(){return new Tt(this._line,0,this._line,this._text.length)}get rangeIncludingLineBreak(){return this._isLastLine?this.range:new Tt(this._line,0,this._line+1,0)}get firstNonWhitespaceCharacterIndex(){return/^(\s*)/.exec(this._text)[1].length}get isEmptyOrWhitespace(){return this.firstNonWhitespaceCharacterIndex===this._text.length}}class Qfe{constructor(e,t){this._onDidAddDocument=new A({onListenerError:Fn}),this._onDidRemoveDocument=new A({onListenerError:Fn}),this._onDidChangeDocument=new A({onListenerError:Fn}),this._onDidSaveDocument=new A({onListenerError:Fn}),this.onDidAddDocument=this._onDidAddDocument.event,this.onDidRemoveDocument=this._onDidRemoveDocument.event,this.onDidChangeDocument=this._onDidChangeDocument.event,this.onDidSaveDocument=this._onDidSaveDocument.event,this._toDispose=new me,this._documentLoader=new Map,this._proxy=e.getProxy(ce.MainThreadDocuments),this._documentsAndEditors=t,this._documentsAndEditors.onDidRemoveDocuments(i=>{for(const n of i)this._onDidRemoveDocument.fire(n.document)},void 0,this._toDispose),this._documentsAndEditors.onDidAddDocuments(i=>{for(const n of i)this._onDidAddDocument.fire(n.document)},void 0,this._toDispose)}dispose(){this._toDispose.dispose()}getAllDocumentData(){return[...this._documentsAndEditors.allDocuments()]}getDocumentData(e){if(!e)return;const t=this._documentsAndEditors.getDocument(e);if(t)return t}getDocument(e){const t=this.getDocumentData(e);if(!(t!=null&&t.document))throw new Error(`Unable to retrieve document from URI '${e}'`);return t.document}ensureDocumentData(e){const t=this._documentsAndEditors.getDocument(e);if(t)return Promise.resolve(t);let i=this._documentLoader.get(e.toString());return i||(i=this._proxy.$tryOpenDocument(e).then(n=>{this._documentLoader.delete(e.toString());const s=k.revive(n);return Mi(this._documentsAndEditors.getDocument(s))},n=>(this._documentLoader.delete(e.toString()),Promise.reject(n))),this._documentLoader.set(e.toString(),i)),i}createDocumentData(e){return this._proxy.$tryCreateDocument(e).then(t=>k.revive(t))}$acceptModelLanguageChanged(e,t){const i=k.revive(e),n=this._documentsAndEditors.getDocument(i);if(!n)throw new Error("unknown document");this._onDidRemoveDocument.fire(n.document),n._acceptLanguageId(t),this._onDidAddDocument.fire(n.document)}$acceptModelSaved(e){const t=k.revive(e),i=this._documentsAndEditors.getDocument(t);if(!i)throw new Error("unknown document");this.$acceptDirtyStateChanged(e,!1),this._onDidSaveDocument.fire(i.document)}$acceptDirtyStateChanged(e,t){const i=k.revive(e),n=this._documentsAndEditors.getDocument(i);if(!n)throw new Error("unknown document");n._acceptIsDirty(t),this._onDidChangeDocument.fire({document:n.document,contentChanges:[],reason:void 0})}$acceptModelChanged(e,t,i){const n=k.revive(e),s=this._documentsAndEditors.getDocument(n);if(!s)throw new Error("unknown document");s._acceptIsDirty(i),s.onEvents(t);let o;t.isUndoing?o=Ug.Undo:t.isRedoing&&(o=Ug.Redo),this._onDidChangeDocument.fire(qq({document:s.document,contentChanges:t.changes.map(a=>({range:ge.to(a.range),rangeOffset:a.rangeOffset,rangeLength:a.rangeLength,text:a.text})),reason:o}))}setWordDefinitionFor(e,t){qfe(e,t)}}class ZT{constructor(e,t,i){const n=ZT._Keys.nextId();e.$registerTextEditorDecorationType(t.identifier,n,K0.from(i)),this.value=Object.freeze({key:n,dispose(){e.$removeTextEditorDecorationType(n)}})}}ZT._Keys=new ZN("TextEditorDecorationType");class Yfe{constructor(e,t){this._collectedEdits=[],this._setEndOfLine=void 0,this._finalized=!1,this._document=e,this._documentVersionId=e.version,this._undoStopBefore=t.undoStopBefore,this._undoStopAfter=t.undoStopAfter}finalize(){return this._finalized=!0,{documentVersionId:this._documentVersionId,edits:this._collectedEdits,setEndOfLine:this._setEndOfLine,undoStopBefore:this._undoStopBefore,undoStopAfter:this._undoStopAfter}}_throwIfFinalized(){if(this._finalized)throw new Error("Edit is only valid while callback runs")}replace(e,t){this._throwIfFinalized();let i=null;if(e instanceof At)i=new Tt(e,e);else if(e instanceof Tt)i=e;else throw new Error("Unrecognized location");this._pushEdit(i,t,!1)}insert(e,t){this._throwIfFinalized(),this._pushEdit(new Tt(e,e),t,!0)}delete(e){this._throwIfFinalized();let t=null;if(e instanceof Tt)t=e;else throw new Error("Unrecognized location");this._pushEdit(t,null,!0)}_pushEdit(e,t,i){const n=this._document.validateRange(e);this._collectedEdits.push({range:n,text:t,forceMoveMarkers:i})}setEndOfLine(e){if(this._throwIfFinalized(),e!==Bo.LF&&e!==Bo.CRLF)throw $t("endOfLine");this._setEndOfLine=e}}class Xfe{constructor(e,t,i,n){this._proxy=e,this._id=t,this._accept(i),this._logService=n;const s=this;this.value={get tabSize(){return s._tabSize},set tabSize(o){s._setTabSize(o)},get indentSize(){return s._indentSize},set indentSize(o){s._setIndentSize(o)},get insertSpaces(){return s._insertSpaces},set insertSpaces(o){s._setInsertSpaces(o)},get cursorStyle(){return s._cursorStyle},set cursorStyle(o){s._setCursorStyle(o)},get lineNumbers(){return s._lineNumbers},set lineNumbers(o){s._setLineNumbers(o)}}}_accept(e){this._tabSize=e.tabSize,this._indentSize=e.indentSize,this._insertSpaces=e.insertSpaces,this._cursorStyle=e.cursorStyle,this._lineNumbers=gg.to(e.lineNumbers)}_validateTabSize(e){if(e==="auto")return"auto";if(typeof e=="number"){const t=Math.floor(e);return t>0?t:null}if(typeof e=="string"){const t=parseInt(e,10);return isNaN(t)?null:t>0?t:null}return null}_setTabSize(e){const t=this._validateTabSize(e);if(t!==null){if(typeof t=="number"){if(this._tabSize===t)return;this._tabSize=t}this._warnOnError("setTabSize",this._proxy.$trySetOptions(this._id,{tabSize:t}))}}_validateIndentSize(e){if(e==="tabSize")return"tabSize";if(typeof e=="number"){const t=Math.floor(e);return t>0?t:null}if(typeof e=="string"){const t=parseInt(e,10);return isNaN(t)?null:t>0?t:null}return null}_setIndentSize(e){const t=this._validateIndentSize(e);if(t!==null){if(typeof t=="number"){if(this._indentSize===t)return;this._indentSize=t}this._warnOnError("setIndentSize",this._proxy.$trySetOptions(this._id,{indentSize:t}))}}_validateInsertSpaces(e){return e==="auto"?"auto":e==="false"?!1:!!e}_setInsertSpaces(e){const t=this._validateInsertSpaces(e);if(typeof t=="boolean"){if(this._insertSpaces===t)return;this._insertSpaces=t}this._warnOnError("setInsertSpaces",this._proxy.$trySetOptions(this._id,{insertSpaces:t}))}_setCursorStyle(e){this._cursorStyle!==e&&(this._cursorStyle=e,this._warnOnError("setCursorStyle",this._proxy.$trySetOptions(this._id,{cursorStyle:e})))}_setLineNumbers(e){this._lineNumbers!==e&&(this._lineNumbers=e,this._warnOnError("setLineNumbers",this._proxy.$trySetOptions(this._id,{lineNumbers:gg.from(e)})))}assign(e){const t={};let i=!1;if(typeof e.tabSize<"u"){const n=this._validateTabSize(e.tabSize);n==="auto"?(i=!0,t.tabSize=n):typeof n=="number"&&this._tabSize!==n&&(this._tabSize=n,i=!0,t.tabSize=n)}if(typeof e.indentSize<"u"){const n=this._validateIndentSize(e.indentSize);n==="tabSize"?(i=!0,t.indentSize=n):typeof n=="number"&&this._indentSize!==n&&(this._indentSize=n,i=!0,t.indentSize=n)}if(typeof e.insertSpaces<"u"){const n=this._validateInsertSpaces(e.insertSpaces);n==="auto"?(i=!0,t.insertSpaces=n):this._insertSpaces!==n&&(this._insertSpaces=n,i=!0,t.insertSpaces=n)}typeof e.cursorStyle<"u"&&this._cursorStyle!==e.cursorStyle&&(this._cursorStyle=e.cursorStyle,i=!0,t.cursorStyle=e.cursorStyle),typeof e.lineNumbers<"u"&&this._lineNumbers!==e.lineNumbers&&(this._lineNumbers=e.lineNumbers,i=!0,t.lineNumbers=gg.from(e.lineNumbers)),i&&this._warnOnError("setOptions",this._proxy.$trySetOptions(this._id,t))}_warnOnError(e,t){t.catch(i=>{this._logService.warn(`ExtHostTextEditorOptions '${e}' failed:'`),this._logService.warn(i)})}}class Jfe{constructor(e,t,i,n,s,o,a,c){this.id=e,this._proxy=t,this._logService=i,this._disposed=!1,this._hasDecorationsForKey=new Set,this._selections=s,this._options=new Xfe(this._proxy,this.id,o,i),this._visibleRanges=a,this._viewColumn=c;const d=this;this.value=Object.freeze({get document(){return n.value},set document(l){throw ah("document")},get selection(){return d._selections&&d._selections[0]},set selection(l){if(!(l instanceof wd))throw $t("selection");d._selections=[l],d._trySetSelection()},get selections(){return d._selections},set selections(l){if(!Array.isArray(l)||l.some(u=>!(u instanceof wd)))throw $t("selections");d._selections=l,d._trySetSelection()},get visibleRanges(){return d._visibleRanges},set visibleRanges(l){throw ah("visibleRanges")},get options(){return d._options.value},set options(l){d._disposed||d._options.assign(l)},get viewColumn(){return d._viewColumn},set viewColumn(l){throw ah("viewColumn")},edit(l,u={undoStopBefore:!0,undoStopAfter:!0}){if(d._disposed)return Promise.reject(new Error("TextEditor#edit not possible on closed editors"));const h=new Yfe(n.value,u);return l(h),d._applyEdit(h)},insertSnippet(l,u,h={undoStopBefore:!0,undoStopAfter:!0}){if(d._disposed)return Promise.reject(new Error("TextEditor#insertSnippet not possible on closed editors"));let g;if(!u||Array.isArray(u)&&u.length===0)g=d._selections.map(m=>ge.from(m));else if(u instanceof At){const{lineNumber:m,column:y}=Wi.from(u);g=[{startLineNumber:m,startColumn:y,endLineNumber:m,endColumn:y}]}else if(u instanceof Tt)g=[ge.from(u)];else{g=[];for(const m of u)if(m instanceof Tt)g.push(ge.from(m));else{const{lineNumber:y,column:_}=Wi.from(m);g.push({startLineNumber:y,startColumn:_,endLineNumber:y,endColumn:_})}}return t.$tryInsertSnippet(e,n.value.version,l.value,g,h)},setDecorations(l,u){const h=u.length===0;h&&!d._hasDecorationsForKey.has(l.key)||(h?d._hasDecorationsForKey.delete(l.key):d._hasDecorationsForKey.add(l.key),d._runOnProxy(()=>{if(S5(u))return t.$trySetDecorations(e,l.key,pfe(u));{const g=new Array(4*u.length);for(let m=0,y=u.length;m<y;m++){const _=u[m];g[4*m]=_.start.line+1,g[4*m+1]=_.start.character+1,g[4*m+2]=_.end.line+1,g[4*m+3]=_.end.character+1}return t.$trySetDecorationsFast(e,l.key,g)}}))},revealRange(l,u){d._runOnProxy(()=>t.$tryRevealRange(e,ge.from(l),u||p_.Default))},show(l){t.$tryShowEditor(e,Hn.from(l))},hide(){t.$tryHideEditor(e)}})}dispose(){ha(!this._disposed),this._disposed=!0}_acceptOptions(e){ha(!this._disposed),this._options._accept(e)}_acceptVisibleRanges(e){ha(!this._disposed),this._visibleRanges=e}_acceptViewColumn(e){ha(!this._disposed),this._viewColumn=e}_acceptSelections(e){ha(!this._disposed),this._selections=e}async _trySetSelection(){const e=this._selections.map(Aa.from);return await this._runOnProxy(()=>this._proxy.$trySetSelections(this.id,e)),this.value}_applyEdit(e){const t=e.finalize();if(t.edits.length===0&&!t.setEndOfLine)return Promise.resolve(!0);const i=t.edits.map(s=>s.range);i.sort((s,o)=>s.end.line===o.end.line?s.end.character===o.end.character?s.start.line===o.start.line?s.start.character-o.start.character:s.start.line-o.start.line:s.end.character-o.end.character:s.end.line-o.end.line);for(let s=0,o=i.length-1;s<o;s++){const a=i[s].end;if(i[s+1].start.isBefore(a))return Promise.reject(new Error("Overlapping ranges are not allowed!"))}const n=t.edits.map(s=>({range:ge.from(s.range),text:s.text,forceMoveMarkers:s.forceMoveMarkers}));return this._proxy.$tryApplyEdits(this.id,t.documentVersionId,n,{setEndOfLine:typeof t.setEndOfLine=="number"?wm.from(t.setEndOfLine):void 0,undoStopBefore:t.undoStopBefore,undoStopAfter:t.undoStopAfter})}_runOnProxy(e){return this._disposed?(this._logService.warn("TextEditor is closed/disposed"),Promise.resolve(void 0)):e().then(()=>this,t=>(t instanceof Error&&t.name==="DISPOSED"||this._logService.warn(t),null))}}class Zfe{constructor(e){this.value=e,this._count=0}ref(){this._count++}unref(){return--this._count===0}}let PL=class{constructor(e,t){this._extHostRpc=e,this._logService=t,this._activeEditorId=null,this._editors=new Map,this._documents=new ki,this._onDidAddDocuments=new A,this._onDidRemoveDocuments=new A,this._onDidChangeVisibleTextEditors=new A,this._onDidChangeActiveTextEditor=new A,this.onDidAddDocuments=this._onDidAddDocuments.event,this.onDidRemoveDocuments=this._onDidRemoveDocuments.event,this.onDidChangeVisibleTextEditors=this._onDidChangeVisibleTextEditors.event,this.onDidChangeActiveTextEditor=this._onDidChangeActiveTextEditor.event}$acceptDocumentsAndEditorsDelta(e){this.acceptDocumentsAndEditorsDelta(e)}acceptDocumentsAndEditorsDelta(e){const t=[],i=[],n=[];if(e.removedDocuments)for(const s of e.removedDocuments){const o=k.revive(s),a=this._documents.get(o);a!=null&&a.unref()&&(this._documents.delete(o),t.push(a.value))}if(e.addedDocuments)for(const s of e.addedDocuments){const o=k.revive(s.uri);let a=this._documents.get(o);if(a&&o.scheme!==pe.vscodeNotebookCell&&o.scheme!==pe.vscodeInteractiveInput)throw new Error(`document '${o} already exists!'`);a||(a=new Zfe(new zfe(this._extHostRpc.getProxy(ce.MainThreadDocuments),o,s.lines,s.EOL,s.versionId,s.languageId,s.isDirty,s.notebook)),this._documents.set(o,a),i.push(a.value)),a.ref()}if(e.removedEditors)for(const s of e.removedEditors){const o=this._editors.get(s);this._editors.delete(s),o&&n.push(o)}if(e.addedEditors)for(const s of e.addedEditors){const o=k.revive(s.documentUri);ha(this._documents.has(o),`document '${o}' does not exist`),ha(!this._editors.has(s.id),`editor '${s.id}' already exists!`);const a=this._documents.get(o).value,c=new Jfe(s.id,this._extHostRpc.getProxy(ce.MainThreadTextEditors),this._logService,new Tg(()=>a.document),s.selections.map(Aa.to),s.options,s.visibleRanges.map(d=>ge.to(d)),typeof s.editorPosition=="number"?Hn.to(s.editorPosition):void 0);this._editors.set(s.id,c)}e.newActiveEditor!==void 0&&(ha(e.newActiveEditor===null||this._editors.has(e.newActiveEditor),`active editor '${e.newActiveEditor}' does not exist`),this._activeEditorId=e.newActiveEditor),vt(t),vt(n),e.removedDocuments&&this._onDidRemoveDocuments.fire(t),e.addedDocuments&&this._onDidAddDocuments.fire(i),(e.removedEditors||e.addedEditors)&&this._onDidChangeVisibleTextEditors.fire(this.allEditors().map(s=>s.value)),e.newActiveEditor!==void 0&&this._onDidChangeActiveTextEditor.fire(this.activeEditor())}getDocument(e){var t;return(t=this._documents.get(e))==null?void 0:t.value}allDocuments(){return Go.map(this._documents.values(),e=>e.value)}getEditor(e){return this._editors.get(e)}activeEditor(e){if(!this._activeEditorId)return;const t=this._editors.get(this._activeEditorId);return e?t:t==null?void 0:t.value}allEditors(){return[...this._editors.values()]}};PL=T([v(0,Ii),v(1,ze)],PL);const gb=re("IExtHostDocumentsAndEditors");class epe{constructor(){this._schemes=[]}add(e){this._stateMachine=void 0,this._schemes.push(e)}delete(e){const t=this._schemes.indexOf(e);t>=0&&(this._schemes.splice(t,1),this._stateMachine=void 0)}_initStateMachine(){if(!this._stateMachine){const e=this._schemes.sort(),t=[];let i,n,s=14,o=14;for(const a of e){let c=i?GY(i,a):0;for(c===0?n=1:n=o;c<a.length;c++)c+1===a.length?(s=o,o=9):o+=1,t.push([n,a.toUpperCase().charCodeAt(c),o]),t.push([n,a.toLowerCase().charCodeAt(c),o]),n=o;i=a,o=s}t.push([9,58,10]),t.push([10,47,12]),this._stateMachine=new VY(t)}}provideDocumentLinks(e){this._initStateMachine();const t=[],i=qY.computeLinks({getLineContent(n){return e.lineAt(n-1).text},getLineCount(){return e.lineCount}},this._stateMachine);for(const n of i){const s=jh.to(n);s.target&&t.push(s)}return t}}class Mx{constructor(e,t){this._extHostLanguageFeatures=t,this._linkProvider=new epe,this._fsProvider=new Map,this._registeredSchemes=new Set,this._watches=new Map,this._handlePool=0,this._proxy=e.getProxy(ce.MainThreadFileSystem)}dispose(){var e;(e=this._linkProviderRegistration)==null||e.dispose()}registerFileSystemProvider(e,t,i,n={}){if(Mx._validateFileSystemProvider(i),this._registeredSchemes.has(t))throw new Error(`a provider for the scheme '${t}' is already registered`);this._linkProviderRegistration||(this._linkProviderRegistration=this._extHostLanguageFeatures.registerDocumentLinkProvider(e,"*",this._linkProvider));const s=this._handlePool++;this._linkProvider.add(t),this._registeredSchemes.add(t),this._fsProvider.set(s,i);let o=2;n.isCaseSensitive&&(o+=1024),n.isReadonly&&(o+=2048),typeof i.copy=="function"&&(o+=8),typeof i.open=="function"&&typeof i.close=="function"&&typeof i.read=="function"&&typeof i.write=="function"&&(He(e,"fsChunks"),o+=4);let a;n.isReadonly&&qm(n.isReadonly)&&(He(e,"readonlyMessage"),a={value:n.isReadonly.value,isTrusted:n.isReadonly.isTrusted,supportThemeIcons:n.isReadonly.supportThemeIcons,supportHtml:n.isReadonly.supportHtml,baseUri:n.isReadonly.baseUri,uris:n.isReadonly.uris}),this._proxy.$registerFileSystemProvider(s,t,o,a).catch(d=>{console.error(`FAILED to register filesystem provider of ${e.identifier.value}-extension for the scheme ${t}`),console.error(d)});const c=i.onDidChangeFile(d=>{const l=[];for(const u of d){const{uri:h,type:g}=u;if(h.scheme!==t)continue;let m;switch(g){case Ph.Changed:m=0;break;case Ph.Created:m=1;break;case Ph.Deleted:m=2;break;default:throw new Error("Unknown FileChangeType")}l.push({resource:h,type:m})}this._proxy.$onFileSystemChange(s,l)});return ot(()=>{c.dispose(),this._linkProvider.delete(t),this._registeredSchemes.delete(t),this._fsProvider.delete(s),this._proxy.$unregisterProvider(s)})}static _validateFileSystemProvider(e){if(!e)throw new Error("MISSING provider");if(typeof e.watch!="function")throw new Error("Provider does NOT implement watch");if(typeof e.stat!="function")throw new Error("Provider does NOT implement stat");if(typeof e.readDirectory!="function")throw new Error("Provider does NOT implement readDirectory");if(typeof e.createDirectory!="function")throw new Error("Provider does NOT implement createDirectory");if(typeof e.readFile!="function")throw new Error("Provider does NOT implement readFile");if(typeof e.writeFile!="function")throw new Error("Provider does NOT implement writeFile");if(typeof e.delete!="function")throw new Error("Provider does NOT implement delete");if(typeof e.rename!="function")throw new Error("Provider does NOT implement rename")}static _asIStat(e){const{type:t,ctime:i,mtime:n,size:s,permissions:o}=e;return{type:t,ctime:i,mtime:n,size:s,permissions:o}}$stat(e,t){return Promise.resolve(this._getFsProvider(e).stat(k.revive(t))).then(i=>Mx._asIStat(i))}$readdir(e,t){return Promise.resolve(this._getFsProvider(e).readDirectory(k.revive(t)))}$readFile(e,t){return Promise.resolve(this._getFsProvider(e).readFile(k.revive(t))).then(i=>De.wrap(i))}$writeFile(e,t,i,n){return Promise.resolve(this._getFsProvider(e).writeFile(k.revive(t),i.buffer,n))}$delete(e,t,i){return Promise.resolve(this._getFsProvider(e).delete(k.revive(t),i))}$rename(e,t,i,n){return Promise.resolve(this._getFsProvider(e).rename(k.revive(t),k.revive(i),n))}$copy(e,t,i,n){const s=this._getFsProvider(e);if(!s.copy)throw new Error('FileSystemProvider does not implement "copy"');return Promise.resolve(s.copy(k.revive(t),k.revive(i),n))}$mkdir(e,t){return Promise.resolve(this._getFsProvider(e).createDirectory(k.revive(t)))}$watch(e,t,i,n){const s=this._getFsProvider(e).watch(k.revive(i),n);this._watches.set(t,s)}$unwatch(e,t){const i=this._watches.get(t);i&&(i.dispose(),this._watches.delete(t))}$open(e,t,i){const n=this._getFsProvider(e);if(!n.open)throw new Error('FileSystemProvider does not implement "open"');return Promise.resolve(n.open(k.revive(t),i))}$close(e,t){const i=this._getFsProvider(e);if(!i.close)throw new Error('FileSystemProvider does not implement "close"');return Promise.resolve(i.close(t))}$read(e,t,i,n){const s=this._getFsProvider(e);if(!s.read)throw new Error('FileSystemProvider does not implement "read"');const o=De.alloc(n);return Promise.resolve(s.read(t,i,o.buffer,0,n)).then(a=>o.slice(0,a))}$write(e,t,i,n){const s=this._getFsProvider(e);if(!s.write)throw new Error('FileSystemProvider does not implement "write"');return Promise.resolve(s.write(t,i,n.buffer,0,n.byteLength))}_getFsProvider(e){const t=this._fsProvider.get(e);if(!t){const i=new Error;throw i.name="ENOPRO",i.message="no provider",i}return t}}class tpe{get ignoreCreateEvents(){return!!(this._config&1)}get ignoreChangeEvents(){return!!(this._config&2)}get ignoreDeleteEvents(){return!!(this._config&4)}constructor(e,t,i,n,s,o,a,c){this._onDidCreate=new A,this._onDidChange=new A,this._onDidDelete=new A;const d=this.ensureWatching(e,i,s);this._config=0,o&&(this._config+=1),a&&(this._config+=2),c&&(this._config+=4);const l=vd(s),u=typeof s=="string",h=n(g=>{if(!o)for(const m of g.created){const y=k.revive(m);l(y.fsPath)&&(!u||t.getWorkspaceFolder(y))&&this._onDidCreate.fire(y)}if(!a)for(const m of g.changed){const y=k.revive(m);l(y.fsPath)&&(!u||t.getWorkspaceFolder(y))&&this._onDidChange.fire(y)}if(!c)for(const m of g.deleted){const y=k.revive(m);l(y.fsPath)&&(!u||t.getWorkspaceFolder(y))&&this._onDidDelete.fire(y)}});this._disposable=Yt.from(d,this._onDidCreate,this._onDidChange,this._onDidDelete,h)}ensureWatching(e,t,i){const n=Yt.from();if(typeof i=="string")return n;const s=e.getProxy(ce.MainThreadFileSystem);let o=!1;(i.pattern.includes(e1)||i.pattern.includes(zY))&&(o=!0);const a=Math.random();return s.$watch(t.identifier.value,a,i.baseUri,{recursive:o,excludes:[]}),Yt.from({dispose:()=>s.$unwatch(a)})}dispose(){this._disposable.dispose()}get onDidCreate(){return this._onDidCreate.event}get onDidChange(){return this._onDidChange.event}get onDidDelete(){return this._onDidDelete.event}}class ipe{constructor(e,t,i){this._mainContext=e,this._logService=t,this._extHostDocumentsAndEditors=i,this._onFileSystemEvent=new A,this._onDidRenameFile=new A,this._onDidCreateFile=new A,this._onDidDeleteFile=new A,this._onWillRenameFile=new Ml,this._onWillCreateFile=new Ml,this._onWillDeleteFile=new Ml,this.onDidRenameFile=this._onDidRenameFile.event,this.onDidCreateFile=this._onDidCreateFile.event,this.onDidDeleteFile=this._onDidDeleteFile.event}createFileSystemWatcher(e,t,i,n,s,o){return new tpe(this._mainContext,e,t,this._onFileSystemEvent.event,lo.from(i),n,s,o)}$onFileEvent(e){this._onFileSystemEvent.fire(e)}$onDidRunFileOperation(e,t){switch(e){case 2:this._onDidRenameFile.fire(Object.freeze({files:t.map(i=>({oldUri:k.revive(i.source),newUri:k.revive(i.target)}))}));break;case 1:this._onDidDeleteFile.fire(Object.freeze({files:t.map(i=>k.revive(i.target))}));break;case 0:case 3:this._onDidCreateFile.fire(Object.freeze({files:t.map(i=>k.revive(i.target))}));break}}getOnWillRenameFileEvent(e){return this._createWillExecuteEvent(e,this._onWillRenameFile)}getOnWillCreateFileEvent(e){return this._createWillExecuteEvent(e,this._onWillCreateFile)}getOnWillDeleteFileEvent(e){return this._createWillExecuteEvent(e,this._onWillDeleteFile)}_createWillExecuteEvent(e,t){return(i,n,s)=>{const o=function(c){i.call(n,c)};return o.extension=e,t.event(o,void 0,s)}}async $onWillRunFileOperation(e,t,i,n){switch(e){case 2:return await this._fireWillEvent(this._onWillRenameFile,{files:t.map(s=>({oldUri:k.revive(s.source),newUri:k.revive(s.target)}))},i,n);case 1:return await this._fireWillEvent(this._onWillDeleteFile,{files:t.map(s=>k.revive(s.target))},i,n);case 0:case 3:return await this._fireWillEvent(this._onWillCreateFile,{files:t.map(s=>k.revive(s.target))},i,n)}}async _fireWillEvent(e,t,i,n){const s=new Set,o=[];if(await e.fireAsync(t,n,async(c,d)=>{const l=Date.now(),u=await Promise.resolve(c);u instanceof Sd&&(o.push([d.extension,u]),s.add(d.extension.displayName??d.extension.identifier.value)),Date.now()-l>i&&this._logService.warn("SLOW file-participant",d.extension.identifier)}),n.isCancellationRequested||o.length===0)return;const a={edits:[]};for(const[,c]of o){const{edits:d}=bo.from(c,{getTextDocumentVersion:l=>{var u;return(u=this._extHostDocumentsAndEditors.getDocument(l))==null?void 0:u.version},getNotebookDocumentVersion:()=>{}});a.edits=a.edits.concat(d)}return{edit:a,extensionNames:Array.from(s)}}}class To{constructor(e){this.id=e,this._data=new Map,this._idPool=1}add(e){const t=this._idPool++;return this._data.set(t,e),this.logDebugInfo(),t}get(e,t){return this._data.has(e)?this._data.get(e)[t]:void 0}delete(e){this._data.delete(e),this.logDebugInfo()}logDebugInfo(){To.enableDebugLogging&&console.log(`${this.id} cache size - ${this._data.size}`)}}To.enableDebugLogging=!1;class Lx{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentSymbols(e,t){const i=this._documents.getDocument(e),n=await this._provider.provideDocumentSymbols(i,t);if(!JN(n))return n[0]instanceof Wg?n.map(Q0.from):Lx._asDocumentSymbolTree(n)}static _asDocumentSymbolTree(e){var n,s;e=e.slice(0).sort((o,a)=>{let c=o.location.range.start.compareTo(a.location.range.start);return c===0&&(c=a.location.range.end.compareTo(o.location.range.end)),c});const t=[],i=[];for(const o of e){const a={name:o.name||"!!MISSING: name!!",kind:Jo.from(o.kind),tags:((n=o.tags)==null?void 0:n.map(xd.from))||[],detail:"",containerName:o.containerName,range:ge.from(o.location.range),selectionRange:ge.from(o.location.range),children:[]};for(;;){if(i.length===0){i.push(a),t.push(a);break}const c=i[i.length-1];if(qe.containsRange(c.range,a.range)&&!qe.equalsRange(c.range,a.range)){(s=c.children)==null||s.push(a),i.push(a);break}i.pop()}}return t}}class uh{constructor(e,t,i){this._documents=e,this._commands=t,this._provider=i,this._cache=new To("CodeLens"),this._disposables=new Map}async provideCodeLenses(e,t){const i=this._documents.getDocument(e),n=await this._provider.provideCodeLenses(i,t);if(!n||t.isCancellationRequested)return;const s=this._cache.add(n),o=new me;this._disposables.set(s,o);const a={cacheId:s,lenses:[]};for(let c=0;c<n.length;c++)a.lenses.push({cacheId:[s,c],range:ge.from(n[c].range),command:this._commands.toInternal(n[c].command,o)});return a}async resolveCodeLens(e,t){const i=e.cacheId&&this._cache.get(...e.cacheId);if(!i)return;let n;if(typeof this._provider.resolveCodeLens!="function"||i.isResolved?n=i:n=await this._provider.resolveCodeLens(i,t),n||(n=i),t.isCancellationRequested)return;const s=e.cacheId&&this._disposables.get(e.cacheId[0]);if(s)return e.command=this._commands.toInternal(n.command??uh._badCmd,s),e}releaseCodeLenses(e){var t;(t=this._disposables.get(e))==null||t.dispose(),this._disposables.delete(e),this._cache.delete(e)}}uh._badCmd={command:"missing",title:"!!MISSING: command!!"};function eI(r){return Array.isArray(r)?r.map(iw.from):r?[iw.from(r)]:[]}class JB{constructor(e,t){this._documents=e,this._provider=t}async provideDefinition(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.provideDefinition(n,s,i);return eI(o)}}class ZB{constructor(e,t){this._documents=e,this._provider=t}async provideDeclaration(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.provideDeclaration(n,s,i);return eI(o)}}class eU{constructor(e,t){this._documents=e,this._provider=t}async provideImplementation(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.provideImplementation(n,s,i);return eI(o)}}class tU{constructor(e,t){this._documents=e,this._provider=t}async provideTypeDefinition(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.provideTypeDefinition(n,s,i);return eI(o)}}class iU{constructor(e,t){this._documents=e,this._provider=t}async provideHover(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.provideHover(n,s,i);if(!(!o||JN(o.contents)))return o.range||(o.range=n.getWordRangeAtPosition(s)),o.range||(o.range=new Tt(s,s)),gx.from(o)}}class nU{constructor(e,t){this._documents=e,this._provider=t}async provideEvaluatableExpression(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.provideEvaluatableExpression(n,s,i);if(o)return J0.from(o)}}class rU{constructor(e,t){this._documents=e,this._provider=t}async provideInlineValues(e,t,i,n){const s=this._documents.getDocument(e),o=await this._provider.provideInlineValues(s,ge.to(t),Z0.to(i),n);if(Array.isArray(o))return o.map(a=>mx.from(a))}}class sU{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentHighlights(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.provideDocumentHighlights(n,s,i);if(Array.isArray(o))return o.map(vx.from)}}class oU{constructor(e,t){this._documents=e,this._provider=t}async provideLinkedEditingRanges(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.provideLinkedEditingRanges(n,s,i);if(o&&Array.isArray(o.ranges))return{ranges:fi(o.ranges.map(ge.from)),wordPattern:o.wordPattern}}}class aU{constructor(e,t){this._documents=e,this._provider=t}async provideReferences(e,t,i,n){const s=this._documents.getDocument(e),o=Wi.to(t),a=await this._provider.provideReferences(s,o,i,n);if(Array.isArray(a))return a.map(So.from)}}const ng=class ng{constructor(e,t,i,n,s,o,a){this._documents=e,this._commands=t,this._diagnostics=i,this._provider=n,this._logService=s,this._extension=o,this._apiDeprecation=a,this._cache=new To("CodeAction"),this._disposables=new Map,this.nbKind=new $i("notebook")}async provideCodeActions(e,t,i,n){var g;const s=this._documents.getDocument(e),o=ef.isISelection(t)?Aa.to(t):ge.to(t),a=[];for(const m of this._diagnostics.getDiagnostics(e))if(o.intersection(m.range)&&a.push(m)>ng._maxCodeActionsPerFile)break;const c={diagnostics:a,only:i.only?new $i(i.only):void 0,triggerKind:fL.to(i.trigger)},d=await this._provider.provideCodeActions(s,o,c,n);if(!Pr(d)||n.isCancellationRequested)return;const l=this._cache.add(d),u=new me;this._disposables.set(l,u);const h=[];for(let m=0;m<d.length;m++){const y=d[m];if(y)if(ng._isCommand(y))this._apiDeprecation.report("CodeActionProvider.provideCodeActions - return commands",this._extension,"Return 'CodeAction' instances instead."),h.push({_isSynthetic:!0,title:y.title,command:this._commands.toInternal(y,u)});else{if(c.triggerKind!==uf.Invoke&&y.kind&&this.nbKind.contains(y.kind))continue;c.only&&(y.kind?c.only.contains(y.kind)||this._logService.warn(`${this._extension.identifier.value} - Code actions of kind '${c.only.value} 'requested but returned code action is of kind '${y.kind.value}'. Code action will be dropped. Please check 'CodeActionContext.only' to only return requested code actions.`):this._logService.warn(`${this._extension.identifier.value} - Code actions of kind '${c.only.value} 'requested but returned code action does not have a 'kind'. Code action will be dropped. Please set 'CodeAction.kind'.`)),h.push({cacheId:[l,m],title:y.title,command:y.command&&this._commands.toInternal(y.command,u),diagnostics:y.diagnostics&&y.diagnostics.map(mm.from),edit:y.edit&&bo.from(y.edit,void 0),kind:y.kind&&y.kind.value,isPreferred:y.isPreferred,disabled:(g=y.disabled)==null?void 0:g.reason})}}return{cacheId:l,actions:h}}async resolveCodeAction(e,t){const[i,n]=e,s=this._cache.get(i,n);if(!s||ng._isCommand(s))return{};if(!this._provider.resolveCodeAction)return{};const o=await this._provider.resolveCodeAction(s,t)??s;let a;o.edit&&(a=bo.from(o.edit,void 0));let c;if(o.command){const d=this._disposables.get(i);d&&(c=this._commands.toInternal(o.command,d))}return{edit:a,command:c}}releaseCodeActions(e){var t;(t=this._disposables.get(e))==null||t.dispose(),this._disposables.delete(e),this._cache.delete(e)}static _isCommand(e){return typeof e.command=="string"&&typeof e.title=="string"}};mi(ng,"_maxCodeActionsPerFile",1e3);let Kp=ng;class QR{constructor(e,t,i,n,s){this._proxy=e,this._documents=t,this._provider=i,this._handle=n,this._extension=s}async prepareDocumentPaste(e,t,i,n){if(!this._provider.prepareDocumentPaste)return;const s=this._documents.getDocument(e),o=t.map(d=>ge.to(d)),a=Qo.toDataTransfer(i,()=>{throw new QY});if(await this._provider.prepareDocumentPaste(s,o,a,n),n.isCancellationRequested)return;const c=Array.from(a).filter(([,d])=>!(d instanceof YC));return Qo.from(c)}async providePasteEdits(e,t,i,n,s){if(!this._provider.provideDocumentPasteEdits)return;const o=this._documents.getDocument(t),a=i.map(l=>ge.to(l)),c=Qo.toDataTransfer(n,async l=>(await this._proxy.$resolvePasteFileData(this._handle,e,l)).buffer),d=await this._provider.provideDocumentPasteEdits(o,a,c,s);if(d)return{id:d.id?this._extension.identifier.value+"."+d.id:this._extension.identifier.value,label:d.label??p("defaultPasteLabel","Paste using '{0}' extension",this._extension.displayName||this._extension.name),detail:this._extension.displayName||this._extension.name,priority:d.priority??0,insertText:typeof d.insertText=="string"?d.insertText:{snippet:d.insertText.value},additionalEdit:d.additionalEdit?bo.from(d.additionalEdit,void 0):void 0}}}class cU{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentFormattingEdits(e,t,i){const n=this._documents.getDocument(e),s=await this._provider.provideDocumentFormattingEdits(n,t,i);if(Array.isArray(s))return s.map(fr.from)}}class YR{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentRangeFormattingEdits(e,t,i,n){const s=this._documents.getDocument(e),o=ge.to(t),a=await this._provider.provideDocumentRangeFormattingEdits(s,o,i,n);if(Array.isArray(a))return a.map(fr.from)}async provideDocumentRangesFormattingEdits(e,t,i,n){yo(typeof this._provider.provideDocumentRangesFormattingEdits=="function","INVALID invocation of `provideDocumentRangesFormattingEdits`");const s=this._documents.getDocument(e),o=t.map(ge.to),a=await this._provider.provideDocumentRangesFormattingEdits(s,o,i,n);if(Array.isArray(a))return a.map(fr.from)}}class dU{constructor(e,t){this._documents=e,this._provider=t,this.autoFormatTriggerCharacters=[]}async provideOnTypeFormattingEdits(e,t,i,n,s){const o=this._documents.getDocument(e),a=Wi.to(t),c=await this._provider.provideOnTypeFormattingEdits(o,a,i,n,s);if(Array.isArray(c))return c.map(fr.from)}}class Xb{constructor(e,t){this._provider=e,this._logService=t,this._cache=new To("WorkspaceSymbols")}async provideWorkspaceSymbols(e,t){const i=await this._provider.provideWorkspaceSymbols(e,t);if(!Pr(i))return{symbols:[]};const n=this._cache.add(i),s={cacheId:n,symbols:[]};for(let o=0;o<i.length;o++){const a=i[o];if(!a||!a.name){this._logService.warn("INVALID SymbolInformation",a);continue}s.symbols.push({...tw.from(a),cacheId:[n,o]})}return s}async resolveWorkspaceSymbol(e,t){if(typeof this._provider.resolveWorkspaceSymbol!="function"||!e.cacheId)return e;const i=this._cache.get(...e.cacheId);if(i){const n=await this._provider.resolveWorkspaceSymbol(i,t);return n&&tu(e,tw.from(n),!0)}}releaseWorkspaceSymbols(e){this._cache.delete(e)}}class hh{static supportsResolving(e){return typeof e.prepareRename=="function"}constructor(e,t,i){this._documents=e,this._provider=t,this._logService=i}async provideRenameEdits(e,t,i,n){const s=this._documents.getDocument(e),o=Wi.to(t);try{const a=await this._provider.provideRenameEdits(s,o,i,n);return a?bo.from(a):void 0}catch(a){const c=hh._asMessage(a);return c?{rejectReason:c,edits:void 0}:Promise.reject(a)}}async resolveRenameLocation(e,t,i){if(typeof this._provider.prepareRename!="function")return Promise.resolve(void 0);const n=this._documents.getDocument(e),s=Wi.to(t);try{const o=await this._provider.prepareRename(n,s,i);let a,c;if(Tt.isRange(o)?(a=o,c=n.getText(o)):bn(o)&&(a=o.range,c=o.placeholder),!a||!c)return;if(a.start.line>s.line||a.end.line<s.line){this._logService.warn("INVALID rename location: position line must be within range start/end lines");return}return{range:ge.from(a),text:c}}catch(o){const a=hh._asMessage(o);return a?{rejectReason:a,range:void 0,text:void 0}:Promise.reject(o)}}static _asMessage(e){return typeof e=="string"?e:e instanceof Error&&typeof e.message=="string"?e.message:void 0}}class XR{constructor(e,t){this.resultId=e,this.tokens=t}}class $s{constructor(e,t){this._documents=e,this._provider=t,this._nextResultId=1,this._previousResults=new Map}async provideDocumentSemanticTokens(e,t,i){const n=this._documents.getDocument(e),s=t!==0?this._previousResults.get(t):null;let o=typeof(s==null?void 0:s.resultId)=="string"&&typeof this._provider.provideDocumentSemanticTokensEdits=="function"?await this._provider.provideDocumentSemanticTokensEdits(n,s.resultId,i):await this._provider.provideDocumentSemanticTokens(n,i);return s&&this._previousResults.delete(t),o?(o=$s._fixProvidedSemanticTokens(o),this._send($s._convertToEdits(s,o),o)):null}async releaseDocumentSemanticColoring(e){this._previousResults.delete(e)}static _fixProvidedSemanticTokens(e){return $s._isSemanticTokens(e)?$s._isCorrectSemanticTokens(e)?e:new yf(new Uint32Array(e.data),e.resultId):$s._isSemanticTokensEdits(e)?$s._isCorrectSemanticTokensEdits(e)?e:new wy(e.edits.map(t=>new I1(t.start,t.deleteCount,t.data?new Uint32Array(t.data):t.data)),e.resultId):e}static _isSemanticTokens(e){return e&&!!e.data}static _isCorrectSemanticTokens(e){return e.data instanceof Uint32Array}static _isSemanticTokensEdits(e){return e&&Array.isArray(e.edits)}static _isCorrectSemanticTokensEdits(e){for(const t of e.edits)if(!(t.data instanceof Uint32Array))return!1;return!0}static _convertToEdits(e,t){if(!$s._isSemanticTokens(t)||!e||!e.tokens)return t;const i=e.tokens,n=i.length,s=t.data,o=s.length;let a=0;const c=Math.min(n,o);for(;a<c&&i[a]===s[a];)a++;if(a===n&&a===o)return new wy([],t.resultId);let d=0;const l=c-a;for(;d<l&&i[n-d-1]===s[o-d-1];)d++;return new wy([{start:a,deleteCount:n-a-d,data:s.subarray(a,o-d)}],t.resultId)}_send(e,t){if($s._isSemanticTokens(e)){const i=this._nextResultId++;return this._previousResults.set(i,new XR(e.resultId,e.data)),AP({id:i,type:"full",data:e.data})}if($s._isSemanticTokensEdits(e)){const i=this._nextResultId++;return $s._isSemanticTokens(t)?this._previousResults.set(i,new XR(t.resultId,t.data)):this._previousResults.set(i,new XR(e.resultId)),AP({id:i,type:"delta",deltas:(e.edits||[]).map(n=>({start:n.start,deleteCount:n.deleteCount,data:n.data}))})}return null}}class lU{constructor(e,t){this._documents=e,this._provider=t}async provideDocumentRangeSemanticTokens(e,t,i){const n=this._documents.getDocument(e),s=await this._provider.provideDocumentRangeSemanticTokens(n,ge.to(t),i);return s?this._send(s):null}_send(e){return AP({id:0,type:"full",data:e.data})}}class th{static supportsResolving(e){return typeof e.resolveCompletionItem=="function"}constructor(e,t,i,n,s){this._documents=e,this._commands=t,this._provider=i,this._apiDeprecation=n,this._extension=s,this._cache=new To("CompletionItem"),this._disposables=new Map}async provideCompletionItems(e,t,i,n){const s=this._documents.getDocument(e),o=Wi.to(t),a=s.getWordRangeAtPosition(o)||new Tt(o,o),c=a.with({end:o}),d=new Tr,l=await this._provider.provideCompletionItems(s,o,n,tL.to(i));if(!l||n.isCancellationRequested)return;const u=Array.isArray(l)?new hf(l):l,h=th.supportsResolving(this._provider)?this._cache.add(u.items):this._cache.add([]),g=new me;this._disposables.set(h,g);const m=[],y={x:h,b:m,a:{replace:ge.from(a),insert:ge.from(c)},c:u.isIncomplete||void 0,d:d.elapsed()};for(let _=0;_<u.items.length;_++){const b=u.items[_],E=this._convertCompletionItem(b,[h,_],c,a);m.push(E)}return y}async resolveCompletionItem(e,t){if(typeof this._provider.resolveCompletionItem!="function")return;const i=this._cache.get(...e);if(!i)return;const n=this._convertCompletionItem(i,e),s=await this._provider.resolveCompletionItem(i,t);if(!s)return;const o=this._convertCompletionItem(s,e);return(n.h!==o.h||n.i!==o.i)&&this._apiDeprecation.report("CompletionItem.insertText",this._extension,"extension MAY NOT change 'insertText' of a CompletionItem during resolve"),(n.n!==o.n||n.o!==o.o||!xa(n.p,o.p))&&this._apiDeprecation.report("CompletionItem.command",this._extension,"extension MAY NOT change 'command' of a CompletionItem during resolve"),{...n,d:o.d,c:o.c,l:o.l,h:o.h,i:o.i,n:o.n,o:o.o,p:o.p}}releaseCompletionItems(e){var t;(t=this._disposables.get(e))==null||t.dispose(),this._disposables.delete(e),this._cache.delete(e)}_convertCompletionItem(e,t,i,n){var d;const s=this._disposables.get(t[0]);if(!s)throw Error("DisposableStore is missing...");const o=this._commands.toInternal(e.command,s),a={x:t,a:e.label,b:e.kind!==void 0?ym.from(e.kind):void 0,m:e.tags&&e.tags.map(yx.from),c:e.detail,d:typeof e.documentation>"u"?void 0:zi.fromStrict(e.documentation),e:e.sortText!==e.label?e.sortText:void 0,f:e.filterText!==e.label?e.filterText:void 0,g:e.preselect||void 0,i:e.keepWhitespace?1:0,k:(d=e.commitCharacters)==null?void 0:d.join(""),l:e.additionalTextEdits&&e.additionalTextEdits.map(fr.from),n:o==null?void 0:o.$ident,o:o==null?void 0:o.id,p:o!=null&&o.$ident||o==null?void 0:o.arguments};e.textEdit?(this._apiDeprecation.report("CompletionItem.textEdit",this._extension,"Use 'CompletionItem.insertText' and 'CompletionItem.range' instead."),a.h=e.textEdit.newText):typeof e.insertText=="string"?a.h=e.insertText:e.insertText instanceof ru&&(a.h=e.insertText.value,a.i|=4);let c;return e.textEdit?c=e.textEdit.range:e.range&&(c=e.range),Tt.isRange(c)?a.j=ge.from(c):c&&(!(i!=null&&i.isEqual(c.inserting))||!(n!=null&&n.isEqual(c.replacing)))&&(a.j={insert:ge.from(c.inserting),replace:ge.from(c.replacing)}),a}}class Jv{async provideInlineCompletions(e,t,i,n){}disposeCompletions(e){}handleDidShowCompletionItem(e,t,i){}handlePartialAccept(e,t,i){}}class npe extends Jv{constructor(e,t,i,n){super(),this._extension=e,this._documents=t,this._provider=i,this._commands=n,this._references=new rpe,this._isAdditionsProposedApiEnabled=ts(this._extension,"inlineCompletionsAdditions"),this.languageTriggerKindToVSCodeTriggerKind={[_H.Automatic]:zg.Automatic,[_H.Explicit]:zg.Invoke}}get supportsHandleEvents(){return ts(this._extension,"inlineCompletionsAdditions")&&(typeof this._provider.handleDidShowCompletionItem=="function"||typeof this._provider.handleDidPartiallyAcceptCompletionItem=="function")}async provideInlineCompletions(e,t,i,n){const s=this._documents.getDocument(e),o=Wi.to(t),a=await this._provider.provideInlineCompletionItems(s,o,{selectedCompletionInfo:i.selectedSuggestionInfo?{range:ge.to(i.selectedSuggestionInfo.range),text:i.selectedSuggestionInfo.text}:void 0,triggerKind:this.languageTriggerKindToVSCodeTriggerKind[i.triggerKind]},n);if(!a||n.isCancellationRequested)return;const c=Array.isArray(a)?a:a.items,d=this._isAdditionsProposedApiEnabled?Array.isArray(a)?[]:a.commands||[]:[],l=this._isAdditionsProposedApiEnabled&&!Array.isArray(a)?a.suppressSuggestions:void 0,u=this._isAdditionsProposedApiEnabled&&!Array.isArray(a)?a.enableForwardStability:void 0;let h;return{pid:this._references.createReferenceId({dispose(){h==null||h.dispose()},items:c}),items:c.map((m,y)=>{let _;m.command&&(h||(h=new me),_=this._commands.toInternal(m.command,h));const b=m.insertText;return{insertText:typeof b=="string"?b:{snippet:b.value},filterText:m.filterText,range:m.range?ge.from(m.range):void 0,command:_,idx:y,completeBracketPairs:this._isAdditionsProposedApiEnabled?m.completeBracketPairs:!1}}),commands:d.map(m=>(h||(h=new me),this._commands.toInternal(m,h))),suppressSuggestions:l,enableForwardStability:u}}disposeCompletions(e){const t=this._references.disposeReferenceId(e);t==null||t.dispose()}handleDidShowCompletionItem(e,t,i){var s;const n=(s=this._references.get(e))==null?void 0:s.items[t];n&&this._provider.handleDidShowCompletionItem&&this._isAdditionsProposedApiEnabled&&this._provider.handleDidShowCompletionItem(n,i)}handlePartialAccept(e,t,i){var s;const n=(s=this._references.get(e))==null?void 0:s.items[t];n&&this._provider.handleDidPartiallyAcceptCompletionItem&&this._isAdditionsProposedApiEnabled&&this._provider.handleDidPartiallyAcceptCompletionItem(n,i)}}class rpe{constructor(){this._references=new Map,this._idPool=1}createReferenceId(e){const t=this._idPool++;return this._references.set(t,e),t}disposeReferenceId(e){const t=this._references.get(e);return this._references.delete(e),t}get(e){return this._references.get(e)}}class JR{constructor(e,t){this._documents=e,this._provider=t,this._cache=new To("SignatureHelp")}async provideSignatureHelp(e,t,i,n){const s=this._documents.getDocument(e),o=Wi.to(t),a=this.reviveContext(i),c=await this._provider.provideSignatureHelp(s,o,n,a);if(c){const d=this._cache.add([c]);return{...nw.from(c),id:d}}}reviveContext(e){let t;if(e.activeSignatureHelp){const i=nw.to(e.activeSignatureHelp),n=this._cache.get(e.activeSignatureHelp.id,0);n?(t=n,t.activeSignature=i.activeSignature,t.activeParameter=i.activeParameter):t=i}return{...e,activeSignatureHelp:t}}releaseSignatureHelp(e){this._cache.delete(e)}}class Jb{constructor(e,t,i,n,s){this._documents=e,this._commands=t,this._provider=i,this._logService=n,this._extension=s,this._cache=new To("InlayHints"),this._disposables=new Map}async provideInlayHints(e,t,i){const n=this._documents.getDocument(e),s=ge.to(t),o=await this._provider.provideInlayHints(n,s,i);if(!Array.isArray(o)||o.length===0){this._logService.trace(`[InlayHints] NO inlay hints from '${this._extension.identifier.value}' for ${t}`);return}if(i.isCancellationRequested)return;const a=this._cache.add(o);this._disposables.set(a,new me);const c={hints:[],cacheId:a};for(let d=0;d<o.length;d++)this._isValidInlayHint(o[d],s)&&c.hints.push(this._convertInlayHint(o[d],[a,d]));return this._logService.trace(`[InlayHints] ${c.hints.length} inlay hints from '${this._extension.identifier.value}' for ${t}`),c}async resolveInlayHint(e,t){if(typeof this._provider.resolveInlayHint!="function")return;const i=this._cache.get(...e);if(!i)return;const n=await this._provider.resolveInlayHint(i,t);if(n&&this._isValidInlayHint(n))return this._convertInlayHint(n,e)}releaseHints(e){var t;(t=this._disposables.get(e))==null||t.dispose(),this._disposables.delete(e),this._cache.delete(e)}_isValidInlayHint(e,t){return e.label.length===0||Array.isArray(e.label)&&e.label.every(i=>i.value.length===0)?(console.log("INVALID inlay hint, empty label",e),!1):!(t&&!t.contains(e.position))}_convertInlayHint(e,t){const i=this._disposables.get(t[0]);if(!i)throw Error("DisposableStore is missing...");const n={label:"",cacheId:t,tooltip:zi.fromStrict(e.tooltip),position:Wi.from(e.position),textEdits:e.textEdits&&e.textEdits.map(fr.from),kind:e.kind&&bx.from(e.kind),paddingLeft:e.paddingLeft,paddingRight:e.paddingRight};return typeof e.label=="string"?n.label=e.label:n.label=e.label.map(s=>{const o={label:s.value};return o.tooltip=zi.fromStrict(s.tooltip),wo.isLocation(s.location)&&(o.location=So.from(s.location)),s.command&&(o.command=this._commands.toInternal(s.command,i)),o}),n}}class Cl{constructor(e,t){this._documents=e,this._provider=t,this._cache=new To("DocumentLink")}async provideLinks(e,t){const i=this._documents.getDocument(e),n=await this._provider.provideDocumentLinks(i,t);if(!(!Array.isArray(n)||n.length===0)&&!t.isCancellationRequested){if(typeof this._provider.resolveDocumentLink!="function")return{links:n.filter(Cl._validateLink).map(jh.from)};{const s=this._cache.add(n),o={links:[],cacheId:s};for(let a=0;a<n.length;a++){if(!Cl._validateLink(n[a]))continue;const c=jh.from(n[a]);c.cacheId=[s,a],o.links.push(c)}return o}}}static _validateLink(e){return e.target&&e.target.path.length>5e4?(console.warn("DROPPING link because it is too long"),!1):!0}async resolveLink(e,t){if(typeof this._provider.resolveDocumentLink!="function")return;const i=this._cache.get(...e);if(!i)return;const n=await this._provider.resolveDocumentLink(i,t);if(!(!n||!Cl._validateLink(n)))return jh.from(n)}releaseLinks(e){this._cache.delete(e)}}class ZR{constructor(e,t){this._documents=e,this._provider=t}async provideColors(e,t){const i=this._documents.getDocument(e),n=await this._provider.provideDocumentColors(i,t);return Array.isArray(n)?n.map(o=>({color:_m.from(o.color),range:ge.from(o.range)})):[]}async provideColorPresentations(e,t,i){const n=this._documents.getDocument(e),s=ge.to(t.range),o=_m.to(t.color),a=await this._provider.provideColorPresentations(o,{document:n,range:s},i);if(Array.isArray(a))return a.map(Sx.from)}}class uU{constructor(e,t){this._documents=e,this._provider=t}async provideFoldingRanges(e,t,i){const n=this._documents.getDocument(e),s=await this._provider.provideFoldingRanges(n,t,i);if(Array.isArray(s))return s.map(Ex.from)}}class hU{constructor(e,t,i){this._documents=e,this._provider=t,this._logService=i}async provideSelectionRanges(e,t,i){const n=this._documents.getDocument(e),s=t.map(Wi.to),o=await this._provider.provideSelectionRanges(n,s,i);if(!Pr(o))return[];if(o.length!==s.length)return this._logService.warn("BAD selection ranges, provider must return ranges for each position"),[];const a=[];for(let c=0;c<s.length;c++){const d=[];a.push(d);let l=s[c],u=o[c];for(;;){if(!u.range.contains(l))throw new Error("INVALID selection range, must contain the previous range");if(d.push(sL.from(u)),!u.parent)break;l=u.range,u=u.parent}}return a}}class Pv{constructor(e,t){this._documents=e,this._provider=t,this._idPool=new ZN(""),this._cache=new Map}async prepareSession(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.prepareCallHierarchy(n,s,i);if(!o)return;const a=this._idPool.nextId();return this._cache.set(a,new Map),Array.isArray(o)?o.map(c=>this._cacheAndConvertItem(a,c)):[this._cacheAndConvertItem(a,o)]}async provideCallsTo(e,t,i){const n=this._itemFromCache(e,t);if(!n)throw new Error("missing call hierarchy item");const s=await this._provider.provideCallHierarchyIncomingCalls(n,i);if(s)return s.map(o=>({from:this._cacheAndConvertItem(e,o.from),fromRanges:o.fromRanges.map(a=>ge.from(a))}))}async provideCallsFrom(e,t,i){const n=this._itemFromCache(e,t);if(!n)throw new Error("missing call hierarchy item");const s=await this._provider.provideCallHierarchyOutgoingCalls(n,i);if(s)return s.map(o=>({to:this._cacheAndConvertItem(e,o.to),fromRanges:o.fromRanges.map(a=>ge.from(a))}))}releaseSession(e){this._cache.delete(e)}_cacheAndConvertItem(e,t){const i=this._cache.get(e),n=xf.from(t,e,i.size.toString(36));return i.set(n._itemId,t),n}_itemFromCache(e,t){const i=this._cache.get(e);return i==null?void 0:i.get(t)}}class Av{constructor(e,t){this._documents=e,this._provider=t,this._idPool=new ZN(""),this._cache=new Map}async prepareSession(e,t,i){const n=this._documents.getDocument(e),s=Wi.to(t),o=await this._provider.prepareTypeHierarchy(n,s,i);if(!o)return;const a=this._idPool.nextId();return this._cache.set(a,new Map),Array.isArray(o)?o.map(c=>this._cacheAndConvertItem(a,c)):[this._cacheAndConvertItem(a,o)]}async provideSupertypes(e,t,i){const n=this._itemFromCache(e,t);if(!n)throw new Error("missing type hierarchy item");const s=await this._provider.provideTypeHierarchySupertypes(n,i);if(s)return s.map(o=>this._cacheAndConvertItem(e,o))}async provideSubtypes(e,t,i){const n=this._itemFromCache(e,t);if(!n)throw new Error("missing type hierarchy item");const s=await this._provider.provideTypeHierarchySubtypes(n,i);if(s)return s.map(o=>this._cacheAndConvertItem(e,o))}releaseSession(e){this._cache.delete(e)}_cacheAndConvertItem(e,t){const i=this._cache.get(e),n=Bh.from(t,e,i.size.toString(36));return i.set(n._itemId,t),n}_itemFromCache(e,t){const i=this._cache.get(e);return i==null?void 0:i.get(t)}}class fU{constructor(e,t,i,n,s){this._proxy=e,this._documents=t,this._provider=i,this._handle=n,this._extension=s}async provideDocumentOnDropEdits(e,t,i,n,s){const o=this._documents.getDocument(t),a=Wi.to(i),c=Qo.toDataTransfer(n,async l=>(await this._proxy.$resolveDocumentOnDropFileData(this._handle,e,l)).buffer),d=await this._provider.provideDocumentDropEdits(o,a,c,s);if(d)return{id:d.id?this._extension.identifier.value+"."+d.id:this._extension.identifier.value,label:d.label??p("defaultDropLabel","Drop using '{0}' extension",this._extension.displayName||this._extension.name),priority:d.priority??0,insertText:typeof d.insertText=="string"?d.insertText:{snippet:d.insertText.value},additionalEdit:d.additionalEdit?bo.from(d.additionalEdit,void 0):void 0}}}class Mv{constructor(e,t){this.adapter=e,this.extension=t}}class dr{constructor(e,t,i,n,s,o,a,c){this._uriTransformer=t,this._documents=i,this._commands=n,this._diagnostics=s,this._logService=o,this._apiDeprecation=a,this._extensionTelemetry=c,this._adapter=new Map,this._proxy=e.getProxy(ce.MainThreadLanguageFeatures)}_transformDocumentSelector(e,t){return gm.from(e,this._uriTransformer,t)}_createDisposable(e){return new Yt(()=>{this._adapter.delete(e),this._proxy.$unregister(e)})}_nextHandle(){return dr._handlePool++}async _withAdapter(e,t,i,n,s,o=!1){const a=this._adapter.get(e);if(!a||!(a.adapter instanceof t))return n;const c=Date.now();o||this._logService.trace(`[${a.extension.identifier.value}] INVOKE provider '${i.toString().replace(/[\r\n]/g,"")}'`);const d=i(a.adapter,a.extension);return Promise.resolve(d).catch(l=>{Ur(l)||(this._logService.error(`[${a.extension.identifier.value}] provider FAILED`),this._logService.error(l),this._extensionTelemetry.onExtensionError(a.extension.identifier,l))}).finally(()=>{o||this._logService.trace(`[${a.extension.identifier.value}] provider DONE after ${Date.now()-c}ms`)}),_t.isCancellationToken(s)?mk(d,s):d}_addNewAdapter(e,t){const i=this._nextHandle();return this._adapter.set(i,new Mv(e,t)),i}static _extLabel(e){return e.displayName||e.name}registerDocumentSymbolProvider(e,t,i,n){const s=this._addNewAdapter(new Lx(this._documents,i),e),o=n&&n.label||dr._extLabel(e);return this._proxy.$registerDocumentSymbolProvider(s,this._transformDocumentSelector(t,e),o),this._createDisposable(s)}$provideDocumentSymbols(e,t,i){return this._withAdapter(e,Lx,n=>n.provideDocumentSymbols(k.revive(t),i),void 0,i)}registerCodeLensProvider(e,t,i){const n=this._nextHandle(),s=typeof i.onDidChangeCodeLenses=="function"?this._nextHandle():void 0;this._adapter.set(n,new Mv(new uh(this._documents,this._commands.converter,i),e)),this._proxy.$registerCodeLensSupport(n,this._transformDocumentSelector(t,e),s);let o=this._createDisposable(n);if(s!==void 0){const a=i.onDidChangeCodeLenses(c=>this._proxy.$emitCodeLensEvent(s));o=Yt.from(o,a)}return o}$provideCodeLenses(e,t,i){return this._withAdapter(e,uh,n=>n.provideCodeLenses(k.revive(t),i),void 0,i)}$resolveCodeLens(e,t,i){return this._withAdapter(e,uh,n=>n.resolveCodeLens(t,i),void 0,void 0)}$releaseCodeLenses(e,t){this._withAdapter(e,uh,i=>Promise.resolve(i.releaseCodeLenses(t)),void 0,void 0)}registerDefinitionProvider(e,t,i){const n=this._addNewAdapter(new JB(this._documents,i),e);return this._proxy.$registerDefinitionSupport(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideDefinition(e,t,i,n){return this._withAdapter(e,JB,s=>s.provideDefinition(k.revive(t),i,n),[],n)}registerDeclarationProvider(e,t,i){const n=this._addNewAdapter(new ZB(this._documents,i),e);return this._proxy.$registerDeclarationSupport(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideDeclaration(e,t,i,n){return this._withAdapter(e,ZB,s=>s.provideDeclaration(k.revive(t),i,n),[],n)}registerImplementationProvider(e,t,i){const n=this._addNewAdapter(new eU(this._documents,i),e);return this._proxy.$registerImplementationSupport(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideImplementation(e,t,i,n){return this._withAdapter(e,eU,s=>s.provideImplementation(k.revive(t),i,n),[],n)}registerTypeDefinitionProvider(e,t,i){const n=this._addNewAdapter(new tU(this._documents,i),e);return this._proxy.$registerTypeDefinitionSupport(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideTypeDefinition(e,t,i,n){return this._withAdapter(e,tU,s=>s.provideTypeDefinition(k.revive(t),i,n),[],n)}registerHoverProvider(e,t,i,n){const s=this._addNewAdapter(new iU(this._documents,i),e);return this._proxy.$registerHoverProvider(s,this._transformDocumentSelector(t,e)),this._createDisposable(s)}$provideHover(e,t,i,n){return this._withAdapter(e,iU,s=>s.provideHover(k.revive(t),i,n),void 0,n)}registerEvaluatableExpressionProvider(e,t,i,n){const s=this._addNewAdapter(new nU(this._documents,i),e);return this._proxy.$registerEvaluatableExpressionProvider(s,this._transformDocumentSelector(t,e)),this._createDisposable(s)}$provideEvaluatableExpression(e,t,i,n){return this._withAdapter(e,nU,s=>s.provideEvaluatableExpression(k.revive(t),i,n),void 0,n)}registerInlineValuesProvider(e,t,i,n){const s=typeof i.onDidChangeInlineValues=="function"?this._nextHandle():void 0,o=this._addNewAdapter(new rU(this._documents,i),e);this._proxy.$registerInlineValuesProvider(o,this._transformDocumentSelector(t,e),s);let a=this._createDisposable(o);if(s!==void 0){const c=i.onDidChangeInlineValues(d=>this._proxy.$emitInlineValuesEvent(s));a=Yt.from(a,c)}return a}$provideInlineValues(e,t,i,n,s){return this._withAdapter(e,rU,o=>o.provideInlineValues(k.revive(t),i,n,s),void 0,s)}registerDocumentHighlightProvider(e,t,i){const n=this._addNewAdapter(new sU(this._documents,i),e);return this._proxy.$registerDocumentHighlightProvider(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideDocumentHighlights(e,t,i,n){return this._withAdapter(e,sU,s=>s.provideDocumentHighlights(k.revive(t),i,n),void 0,n)}registerLinkedEditingRangeProvider(e,t,i){const n=this._addNewAdapter(new oU(this._documents,i),e);return this._proxy.$registerLinkedEditingRangeProvider(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideLinkedEditingRanges(e,t,i,n){return this._withAdapter(e,oU,async s=>{const o=await s.provideLinkedEditingRanges(k.revive(t),i,n);if(o)return{ranges:o.ranges,wordPattern:o.wordPattern?dr._serializeRegExp(o.wordPattern):void 0}},void 0,n)}registerReferenceProvider(e,t,i){const n=this._addNewAdapter(new aU(this._documents,i),e);return this._proxy.$registerReferenceSupport(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideReferences(e,t,i,n,s){return this._withAdapter(e,aU,o=>o.provideReferences(k.revive(t),i,n,s),void 0,s)}registerCodeActionProvider(e,t,i,n){var a,c;const s=new me,o=this._addNewAdapter(new Kp(this._documents,this._commands.converter,this._diagnostics,i,this._logService,e,this._apiDeprecation),e);return this._proxy.$registerQuickFixSupport(o,this._transformDocumentSelector(t,e),{providedKinds:(a=n==null?void 0:n.providedCodeActionKinds)==null?void 0:a.map(d=>d.value),documentation:(c=n==null?void 0:n.documentation)==null?void 0:c.map(d=>({kind:d.kind.value,command:this._commands.converter.toInternal(d.command,s)}))},dr._extLabel(e),!!i.resolveCodeAction),s.add(this._createDisposable(o)),s}$provideCodeActions(e,t,i,n,s){return this._withAdapter(e,Kp,o=>o.provideCodeActions(k.revive(t),i,n,s),void 0,s)}$resolveCodeAction(e,t,i){return this._withAdapter(e,Kp,n=>n.resolveCodeAction(t,i),{},void 0)}$releaseCodeActions(e,t){this._withAdapter(e,Kp,i=>Promise.resolve(i.releaseCodeActions(t)),void 0,void 0)}registerDocumentFormattingEditProvider(e,t,i){const n=this._addNewAdapter(new cU(this._documents,i),e);return this._proxy.$registerDocumentFormattingSupport(n,this._transformDocumentSelector(t,e),e.identifier,e.displayName||e.name),this._createDisposable(n)}$provideDocumentFormattingEdits(e,t,i,n){return this._withAdapter(e,cU,s=>s.provideDocumentFormattingEdits(k.revive(t),i,n),void 0,n)}registerDocumentRangeFormattingEditProvider(e,t,i){const n=typeof i.provideDocumentRangesFormattingEdits=="function";n&&He(e,"formatMultipleRanges");const s=this._addNewAdapter(new YR(this._documents,i),e);return this._proxy.$registerRangeFormattingSupport(s,this._transformDocumentSelector(t,e),e.identifier,e.displayName||e.name,n),this._createDisposable(s)}$provideDocumentRangeFormattingEdits(e,t,i,n,s){return this._withAdapter(e,YR,o=>o.provideDocumentRangeFormattingEdits(k.revive(t),i,n,s),void 0,s)}$provideDocumentRangesFormattingEdits(e,t,i,n,s){return this._withAdapter(e,YR,o=>o.provideDocumentRangesFormattingEdits(k.revive(t),i,n,s),void 0,s)}registerOnTypeFormattingEditProvider(e,t,i,n){const s=this._addNewAdapter(new dU(this._documents,i),e);return this._proxy.$registerOnTypeFormattingSupport(s,this._transformDocumentSelector(t,e),n,e.identifier),this._createDisposable(s)}$provideOnTypeFormattingEdits(e,t,i,n,s,o){return this._withAdapter(e,dU,a=>a.provideOnTypeFormattingEdits(k.revive(t),i,n,s,o),void 0,o)}registerWorkspaceSymbolProvider(e,t){const i=this._addNewAdapter(new Xb(t,this._logService),e);return this._proxy.$registerNavigateTypeSupport(i,typeof t.resolveWorkspaceSymbol=="function"),this._createDisposable(i)}$provideWorkspaceSymbols(e,t,i){return this._withAdapter(e,Xb,n=>n.provideWorkspaceSymbols(t,i),{symbols:[]},i)}$resolveWorkspaceSymbol(e,t,i){return this._withAdapter(e,Xb,n=>n.resolveWorkspaceSymbol(t,i),void 0,void 0)}$releaseWorkspaceSymbols(e,t){this._withAdapter(e,Xb,i=>i.releaseWorkspaceSymbols(t),void 0,void 0)}registerRenameProvider(e,t,i){const n=this._addNewAdapter(new hh(this._documents,i,this._logService),e);return this._proxy.$registerRenameSupport(n,this._transformDocumentSelector(t,e),hh.supportsResolving(i)),this._createDisposable(n)}$provideRenameEdits(e,t,i,n,s){return this._withAdapter(e,hh,o=>o.provideRenameEdits(k.revive(t),i,n,s),void 0,s)}$resolveRenameLocation(e,t,i,n){return this._withAdapter(e,hh,s=>s.resolveRenameLocation(k.revive(t),i,n),void 0,n)}registerDocumentSemanticTokensProvider(e,t,i,n){const s=this._addNewAdapter(new $s(this._documents,i),e),o=typeof i.onDidChangeSemanticTokens=="function"?this._nextHandle():void 0;this._proxy.$registerDocumentSemanticTokensProvider(s,this._transformDocumentSelector(t,e),n,o);let a=this._createDisposable(s);if(o){const c=i.onDidChangeSemanticTokens(d=>this._proxy.$emitDocumentSemanticTokensEvent(o));a=Yt.from(a,c)}return a}$provideDocumentSemanticTokens(e,t,i,n){return this._withAdapter(e,$s,s=>s.provideDocumentSemanticTokens(k.revive(t),i,n),null,n)}$releaseDocumentSemanticTokens(e,t){this._withAdapter(e,$s,i=>i.releaseDocumentSemanticColoring(t),void 0,void 0)}registerDocumentRangeSemanticTokensProvider(e,t,i,n){const s=this._addNewAdapter(new lU(this._documents,i),e);return this._proxy.$registerDocumentRangeSemanticTokensProvider(s,this._transformDocumentSelector(t,e),n),this._createDisposable(s)}$provideDocumentRangeSemanticTokens(e,t,i,n){return this._withAdapter(e,lU,s=>s.provideDocumentRangeSemanticTokens(k.revive(t),i,n),null,n)}registerCompletionItemProvider(e,t,i,n){const s=this._addNewAdapter(new th(this._documents,this._commands.converter,i,this._apiDeprecation,e),e);return this._proxy.$registerCompletionsProvider(s,this._transformDocumentSelector(t,e),n,th.supportsResolving(i),e.identifier),this._createDisposable(s)}$provideCompletionItems(e,t,i,n,s){return this._withAdapter(e,th,o=>o.provideCompletionItems(k.revive(t),i,n,s),void 0,s)}$resolveCompletionItem(e,t,i){return this._withAdapter(e,th,n=>n.resolveCompletionItem(t,i),void 0,i)}$releaseCompletionItems(e,t){this._withAdapter(e,th,i=>i.releaseCompletionItems(t),void 0,void 0)}registerInlineCompletionsProvider(e,t,i){const n=new npe(e,this._documents,i,this._commands.converter),s=this._addNewAdapter(n,e);return this._proxy.$registerInlineCompletionsSupport(s,this._transformDocumentSelector(t,e),n.supportsHandleEvents),this._createDisposable(s)}$provideInlineCompletions(e,t,i,n,s){return this._withAdapter(e,Jv,o=>o.provideInlineCompletions(k.revive(t),i,n,s),void 0,s)}$handleInlineCompletionDidShow(e,t,i,n){this._withAdapter(e,Jv,async s=>{s.handleDidShowCompletionItem(t,i,n)},void 0,void 0)}$handleInlineCompletionPartialAccept(e,t,i,n){this._withAdapter(e,Jv,async s=>{s.handlePartialAccept(t,i,n)},void 0,void 0)}$freeInlineCompletionsList(e,t){this._withAdapter(e,Jv,async i=>{i.disposeCompletions(t)},void 0,void 0)}registerSignatureHelpProvider(e,t,i,n){const s=Array.isArray(n)?{triggerCharacters:n,retriggerCharacters:[]}:n,o=this._addNewAdapter(new JR(this._documents,i),e);return this._proxy.$registerSignatureHelpProvider(o,this._transformDocumentSelector(t,e),s),this._createDisposable(o)}$provideSignatureHelp(e,t,i,n,s){return this._withAdapter(e,JR,o=>o.provideSignatureHelp(k.revive(t),i,n,s),void 0,s)}$releaseSignatureHelp(e,t){this._withAdapter(e,JR,i=>i.releaseSignatureHelp(t),void 0,void 0)}registerInlayHintsProvider(e,t,i){const n=typeof i.onDidChangeInlayHints=="function"?this._nextHandle():void 0,s=this._addNewAdapter(new Jb(this._documents,this._commands.converter,i,this._logService,e),e);this._proxy.$registerInlayHintsProvider(s,this._transformDocumentSelector(t,e),typeof i.resolveInlayHint=="function",n,dr._extLabel(e));let o=this._createDisposable(s);if(n!==void 0){const a=i.onDidChangeInlayHints(c=>this._proxy.$emitInlayHintsEvent(n));o=Yt.from(o,a)}return o}$provideInlayHints(e,t,i,n){return this._withAdapter(e,Jb,s=>s.provideInlayHints(k.revive(t),i,n),void 0,n)}$resolveInlayHint(e,t,i){return this._withAdapter(e,Jb,n=>n.resolveInlayHint(t,i),void 0,i)}$releaseInlayHints(e,t){this._withAdapter(e,Jb,i=>i.releaseHints(t),void 0,void 0)}registerDocumentLinkProvider(e,t,i){const n=this._addNewAdapter(new Cl(this._documents,i),e);return this._proxy.$registerDocumentLinkProvider(n,this._transformDocumentSelector(t,e),typeof i.resolveDocumentLink=="function"),this._createDisposable(n)}$provideDocumentLinks(e,t,i){return this._withAdapter(e,Cl,n=>n.provideLinks(k.revive(t),i),void 0,i,t.scheme==="output")}$resolveDocumentLink(e,t,i){return this._withAdapter(e,Cl,n=>n.resolveLink(t,i),void 0,void 0,!0)}$releaseDocumentLinks(e,t){this._withAdapter(e,Cl,i=>i.releaseLinks(t),void 0,void 0,!0)}registerColorProvider(e,t,i){const n=this._addNewAdapter(new ZR(this._documents,i),e);return this._proxy.$registerDocumentColorProvider(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideDocumentColors(e,t,i){return this._withAdapter(e,ZR,n=>n.provideColors(k.revive(t),i),[],i)}$provideColorPresentations(e,t,i,n){return this._withAdapter(e,ZR,s=>s.provideColorPresentations(k.revive(t),i,n),void 0,n)}registerFoldingRangeProvider(e,t,i){const n=this._nextHandle(),s=typeof i.onDidChangeFoldingRanges=="function"?this._nextHandle():void 0;this._adapter.set(n,new Mv(new uU(this._documents,i),e)),this._proxy.$registerFoldingRangeProvider(n,this._transformDocumentSelector(t,e),e.identifier,s);let o=this._createDisposable(n);if(s!==void 0){const a=i.onDidChangeFoldingRanges(()=>this._proxy.$emitFoldingRangeEvent(s));o=Yt.from(o,a)}return o}$provideFoldingRanges(e,t,i,n){return this._withAdapter(e,uU,s=>s.provideFoldingRanges(k.revive(t),i,n),void 0,n)}registerSelectionRangeProvider(e,t,i){const n=this._addNewAdapter(new hU(this._documents,i,this._logService),e);return this._proxy.$registerSelectionRangeProvider(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$provideSelectionRanges(e,t,i,n){return this._withAdapter(e,hU,s=>s.provideSelectionRanges(k.revive(t),i,n),[],n)}registerCallHierarchyProvider(e,t,i){const n=this._addNewAdapter(new Pv(this._documents,i),e);return this._proxy.$registerCallHierarchyProvider(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$prepareCallHierarchy(e,t,i,n){return this._withAdapter(e,Pv,s=>Promise.resolve(s.prepareSession(k.revive(t),i,n)),void 0,n)}$provideCallHierarchyIncomingCalls(e,t,i,n){return this._withAdapter(e,Pv,s=>s.provideCallsTo(t,i,n),void 0,n)}$provideCallHierarchyOutgoingCalls(e,t,i,n){return this._withAdapter(e,Pv,s=>s.provideCallsFrom(t,i,n),void 0,n)}$releaseCallHierarchy(e,t){this._withAdapter(e,Pv,i=>Promise.resolve(i.releaseSession(t)),void 0,void 0)}registerTypeHierarchyProvider(e,t,i){const n=this._addNewAdapter(new Av(this._documents,i),e);return this._proxy.$registerTypeHierarchyProvider(n,this._transformDocumentSelector(t,e)),this._createDisposable(n)}$prepareTypeHierarchy(e,t,i,n){return this._withAdapter(e,Av,s=>Promise.resolve(s.prepareSession(k.revive(t),i,n)),void 0,n)}$provideTypeHierarchySupertypes(e,t,i,n){return this._withAdapter(e,Av,s=>s.provideSupertypes(t,i,n),void 0,n)}$provideTypeHierarchySubtypes(e,t,i,n){return this._withAdapter(e,Av,s=>s.provideSubtypes(t,i,n),void 0,n)}$releaseTypeHierarchy(e,t){this._withAdapter(e,Av,i=>Promise.resolve(i.releaseSession(t)),void 0,void 0)}registerDocumentOnDropEditProvider(e,t,i,n){const s=this._nextHandle();return this._adapter.set(s,new Mv(new fU(this._proxy,this._documents,i,s,e),e)),this._proxy.$registerDocumentOnDropEditProvider(s,this._transformDocumentSelector(t,e),ts(e,"dropMetadata")?n:void 0),this._createDisposable(s)}$provideDocumentOnDropEdits(e,t,i,n,s,o){return this._withAdapter(e,fU,a=>Promise.resolve(a.provideDocumentOnDropEdits(t,k.revive(i),n,s,o)),void 0,void 0)}registerDocumentPasteEditProvider(e,t,i,n){const s=this._nextHandle();return this._adapter.set(s,new Mv(new QR(this._proxy,this._documents,i,s,e),e)),this._proxy.$registerPasteEditProvider(s,this._transformDocumentSelector(t,e),{supportsCopy:!!i.prepareDocumentPaste,supportsPaste:!!i.provideDocumentPasteEdits,copyMimeTypes:n.copyMimeTypes,pasteMimeTypes:n.pasteMimeTypes}),this._createDisposable(s)}$prepareDocumentPaste(e,t,i,n,s){return this._withAdapter(e,QR,o=>o.prepareDocumentPaste(k.revive(t),i,n,s),void 0,s)}$providePasteEdits(e,t,i,n,s,o){return this._withAdapter(e,QR,a=>a.providePasteEdits(t,k.revive(i),n,s,o),void 0,o)}static _serializeRegExp(e){return{pattern:e.source,flags:KY(e)}}static _serializeIndentationRule(e){return{decreaseIndentPattern:dr._serializeRegExp(e.decreaseIndentPattern),increaseIndentPattern:dr._serializeRegExp(e.increaseIndentPattern),indentNextLinePattern:e.indentNextLinePattern?dr._serializeRegExp(e.indentNextLinePattern):void 0,unIndentedLinePattern:e.unIndentedLinePattern?dr._serializeRegExp(e.unIndentedLinePattern):void 0}}static _serializeOnEnterRule(e){return{beforeText:dr._serializeRegExp(e.beforeText),afterText:e.afterText?dr._serializeRegExp(e.afterText):void 0,previousLineText:e.previousLineText?dr._serializeRegExp(e.previousLineText):void 0,action:e.action}}static _serializeOnEnterRules(e){return e.map(dr._serializeOnEnterRule)}setLanguageConfiguration(e,t,i){const{wordPattern:n}=i;if(n&&Vq(n))throw new Error(`Invalid language configuration: wordPattern '${n}' is not allowed to match the empty string.`);n?this._documents.setWordDefinitionFor(t,n):this._documents.setWordDefinitionFor(t,void 0),i.__electricCharacterSupport&&this._apiDeprecation.report("LanguageConfiguration.__electricCharacterSupport",e,"Do not use."),i.__characterPairSupport&&this._apiDeprecation.report("LanguageConfiguration.__characterPairSupport",e,"Do not use.");const s=this._nextHandle(),o={comments:i.comments,brackets:i.brackets,wordPattern:i.wordPattern?dr._serializeRegExp(i.wordPattern):void 0,indentationRules:i.indentationRules?dr._serializeIndentationRule(i.indentationRules):void 0,onEnterRules:i.onEnterRules?dr._serializeOnEnterRules(i.onEnterRules):void 0,__electricCharacterSupport:i.__electricCharacterSupport,__characterPairSupport:i.__characterPairSupport};return this._proxy.$setLanguageConfiguration(s,t,o),this._createDisposable(s)}$setWordDefinitions(e){for(const t of e)this._documents.setWordDefinitionFor(t.languageId,new RegExp(t.regexSource,t.regexFlags))}}dr._handlePool=0;class spe{constructor(e,t,i,n){this._documents=t,this._commands=i,this._uriTransformer=n,this._languageIds=[],this._handlePool=0,this._ids=new Set,this._proxy=e.getProxy(ce.MainThreadLanguages)}$acceptLanguageIds(e){this._languageIds=e}async getLanguages(){return this._languageIds.slice(0)}async changeLanguage(e,t){await this._proxy.$changeLanguage(e,t);const i=this._documents.getDocumentData(e);if(!i)throw new Error(`document '${e.toString()}' NOT found`);return i.document}async tokenAtPosition(e,t){const i=e.version,n=Wi.from(t),s=await this._proxy.$tokensAtPosition(e.uri,n),o={type:bl.Other,range:e.getWordRangeAtPosition(t)??new Tt(t.line,t.character,t.line,t.character)};if(!s)return o;const a={range:ge.to(s.range),type:G0.to(s.type)};return!a.range.contains(t)||i!==e.version?o:a}createLanguageStatusItem(e,t,i){const n=this._handlePool++,s=this._proxy,o=this._ids,a=`${e.identifier.value}/${t}`;if(o.has(a))throw new Error(`LanguageStatusItem with id '${t}' ALREADY exists`);o.add(a);const c={selector:i,id:t,name:e.displayName??e.name,severity:Dh.Information,command:void 0,text:"",detail:"",busy:!1};let d;const l=new me,u=()=>{d==null||d.dispose(),d=YY(()=>{l.clear(),this._proxy.$setLanguageStatus(n,{id:a,name:c.name??e.displayName??e.name,source:e.displayName??e.name,selector:gm.from(c.selector,this._uriTransformer),label:c.text,detail:c.detail??"",severity:c.severity===Dh.Error?yi.Error:c.severity===Dh.Warning?yi.Warning:yi.Info,command:c.command&&this._commands.toInternal(c.command,l),accessibilityInfo:c.accessibilityInformation,busy:c.busy})},0)},h={dispose(){l.dispose(),d==null||d.dispose(),s.$removeLanguageStatus(n),o.delete(a)},get id(){return c.id},get name(){return c.name},set name(g){c.name=g,u()},get selector(){return c.selector},set selector(g){c.selector=g,u()},get text(){return c.text},set text(g){c.text=g,u()},get detail(){return c.detail},set detail(g){c.detail=g,u()},get severity(){return c.severity},set severity(g){c.severity=g,u()},get accessibilityInformation(){return c.accessibilityInformation},set accessibilityInformation(g){c.accessibilityInformation=g,u()},get command(){return c.command},set command(g){c.command=g,u()},get busy(){return c.busy},set busy(g){c.busy=g,u()}};return u(),h}}function ope(r){return r&&r.title}let AL=class{constructor(e,t){this._logService=t,this._proxy=e.getProxy(ce.MainThreadMessageService)}showMessage(e,t,i,n,s){const o={source:{identifier:e.identifier,label:e.displayName||e.name}};let a;typeof n=="string"||ope(n)?a=[n,...s]:(o.modal=n==null?void 0:n.modal,o.useCustom=n==null?void 0:n.useCustom,o.detail=n==null?void 0:n.detail,a=s),o.useCustom&&He(e,"resolvers");const c=[];for(let d=0;d<a.length;d++){const l=a[d];if(typeof l=="string")c.push({title:l,handle:d,isCloseAffordance:!1});else if(typeof l=="object"){const{title:u,isCloseAffordance:h}=l;c.push({title:u,isCloseAffordance:!!h,handle:d})}else this._logService.warn("Invalid message item:",l)}return this._proxy.$showMessage(t,i,o,c).then(d=>{if(typeof d=="number")return a[d]})}};AL=T([v(1,ze)],AL);class $5 extends vk{get disposed(){return this._disposed}constructor(e,t,i,n,s){super(),this.id=e,this.name=t,this.logger=i,this.proxy=n,this.extension=s,this.offset=0,this._disposed=!1,this.visible=!1,this.setLevel(i.getLevel()),this._register(i.onDidChangeLogLevel(o=>this.setLevel(o)))}get logLevel(){return this.getLevel()}appendLine(e){this.append(e+`
`)}append(e){this.info(e)}clear(){const e=this.offset;this.logger.flush(),this.proxy.$update(this.id,bs.Clear,e)}replace(e){const t=this.offset;this.info(e),this.proxy.$update(this.id,bs.Replace,t),this.visible&&this.logger.flush()}show(e,t){this.logger.flush(),this.proxy.$reveal(this.id,!!(typeof e=="boolean"?e:t))}hide(){this.proxy.$close(this.id)}log(e,t){this.offset+=De.fromString(t).byteLength,EC(this.logger,e,t),this.visible&&(this.logger.flush(),this.proxy.$update(this.id,bs.Append))}dispose(){super.dispose(),this._disposed||(this.proxy.$dispose(this.id),this._disposed=!0)}}class ape extends $5{appendLine(e){this.append(e)}}let ML=class{constructor(e,t,i,n,s,o){this.initData=t,this.extHostFileSystem=i,this.extHostFileSystemInfo=n,this.loggerService=s,this.logService=o,this.extensionLogDirectoryPromise=new Map,this.namePool=1,this.channels=new Map,this.visibleChannelId=null,this.proxy=e.getProxy(ce.MainThreadOutputService),this.outputsLocation=this.extHostFileSystemInfo.extUri.joinPath(t.logsLocation,`output_logging_${J3(new Date).replace(/-|:|\.\d+Z$/g,"")}`)}$setVisibleChannel(e){this.visibleChannelId=e;for(const[t,i]of this.channels)i.visible=t===this.visibleChannelId}createOutputChannel(e,t,i){var d,l;if(e=e.trim(),!e)throw new Error("illegal argument `name`. must not be falsy");const n=typeof t=="object"&&t.log,s=Rt(t)?t:void 0;if(Rt(s)&&!s.trim())throw new Error("illegal argument `languageId`. must not be empty");let o;const a=(l=(d=this.initData.environment.extensionLogLevel)==null?void 0:d.find(([u])=>fn.equals(i.identifier,u)))==null?void 0:l[1];a&&(o=Gq(a));const c=n?this.doCreateLogOutputChannel(e,o,i):this.doCreateOutputChannel(e,s,i);return c.then(u=>{this.channels.set(u.id,u),u.visible=u.id===this.visibleChannelId}),n?this.createExtHostLogOutputChannel(e,o??this.logService.getLevel(),c):this.createExtHostOutputChannel(e,c)}async doCreateOutputChannel(e,t,i){this.outputDirectoryPromise||(this.outputDirectoryPromise=this.extHostFileSystem.value.createDirectory(this.outputsLocation).then(()=>this.outputsLocation));const n=await this.outputDirectoryPromise,s=this.extHostFileSystemInfo.extUri.joinPath(n,`${this.namePool++}-${e.replace(/[\\/:\*\?"<>\|]/g,"")}.log`),o=this.loggerService.createLogger(s,{logLevel:"always",donotRotate:!0,donotUseFormatters:!0,hidden:!0}),a=await this.proxy.$register(e,s,t,i.identifier.value);return new $5(a,e,o,this.proxy,i)}async doCreateLogOutputChannel(e,t,i){const n=await this.createExtensionLogDirectory(i),s=e.replace(/[\\/:\*\?"<>\|]/g,""),o=this.extHostFileSystemInfo.extUri.joinPath(n,`${s}.log`),a=`${i.identifier.value}.${s}`,c=this.loggerService.createLogger(o,{id:a,name:e,logLevel:t,extensionId:i.identifier.value});return new ape(a,e,c,this.proxy,i)}createExtensionLogDirectory(e){let t=this.extensionLogDirectoryPromise.get(e.identifier.value);if(!t){const i=this.extHostFileSystemInfo.extUri.joinPath(this.initData.logsLocation,e.identifier.value);this.extensionLogDirectoryPromise.set(e.identifier.value,t=(async()=>{try{await this.extHostFileSystem.value.createDirectory(i)}catch(n){if(bh(n)!==lt.FileExists)throw n}return i})())}return t}createExtHostOutputChannel(e,t){let i=!1;const n=()=>{if(i)throw new Error("Channel has been closed")};return{get name(){return e},append(s){n(),t.then(o=>o.append(s))},appendLine(s){n(),t.then(o=>o.appendLine(s))},clear(){n(),t.then(s=>s.clear())},replace(s){n(),t.then(o=>o.replace(s))},show(s,o){n(),t.then(a=>a.show(s,o))},hide(){n(),t.then(s=>s.hide())},dispose(){i=!0,t.then(s=>s.dispose())}}}createExtHostLogOutputChannel(e,t,i){const n=new me,s=()=>{if(n.isDisposed)throw new Error("Channel has been closed")},o=n.add(new A);function a(c){t=c,o.fire(c)}return i.then(c=>{n.add(c),c.logLevel!==t&&a(c.logLevel),n.add(c.onDidChangeLogLevel(d=>a(d)))}),{...this.createExtHostOutputChannel(e,i),get logLevel(){return t},onDidChangeLogLevel:o.event,trace(c,...d){s(),i.then(l=>l.trace(c,...d))},debug(c,...d){s(),i.then(l=>l.debug(c,...d))},info(c,...d){s(),i.then(l=>l.info(c,...d))},warn(c,...d){s(),i.then(l=>l.warn(c,...d))},error(c,...d){s(),i.then(l=>l.error(c,...d))},dispose(){n.dispose()}}}};ML=T([v(0,Ii),v(1,Gr),v(2,YT),v(3,iv),v(4,Is),v(5,ze)],ML);const W5=re("IExtHostOutputService");class cpe{constructor(e){this._handles=0,this._mapHandleToCancellationSource=new Map,this._proxy=e}async withProgress(e,t,i){const n=this._handles++,{title:s,location:o,cancellable:a}=t,c={label:p("extensionSource","{0} (Extension)",e.displayName||e.name),id:e.identifier.value};return this._proxy.$startProgress(n,{location:oL.from(o),title:s,source:c,cancellable:a},e.isUnderDevelopment?void 0:e.identifier.value).catch(Fn),this._withProgress(n,i,!!a)}_withProgress(e,t,i){let n;i&&(n=new Xt,this._mapHandleToCancellationSource.set(e,n));const s=a=>{this._proxy.$progressEnd(a),this._mapHandleToCancellationSource.delete(a),n==null||n.dispose()};let o;try{o=t(new LL(this._proxy,e),i&&n?n.token:_t.None)}catch(a){throw s(e),a}return o.then(a=>s(e),a=>s(e)),o}$acceptProgressCanceled(e){const t=this._mapHandleToCancellationSource.get(e);t&&(t.cancel(),this._mapHandleToCancellationSource.delete(e))}}function dpe(r,e){return r.message=e.message,typeof e.increment=="number"&&(typeof r.increment=="number"?r.increment+=e.increment:r.increment=e.increment),r}class LL extends t1{constructor(e,t){super(i=>this.throttledReport(i)),this._proxy=e,this._handle=t}throttledReport(e){this._proxy.$progressReport(this._handle,e)}}LL.__decorator=T([XY(100,(r,e)=>dpe(r,e),()=>Object.create(null))],LL.prototype,"throttledReport",null);function lpe(r,e,t){const i=r.getProxy(ce.MainThreadQuickOpen);class n{constructor(g,m){this._sessions=new Map,this._instances=0,this._workspace=g,this._commands=m}showQuickPick(g,m,y,_=_t.None){this._onDidSelectItem=void 0;const b=Promise.resolve(m),E=++this._instances,D=i.$show(E,{title:y==null?void 0:y.title,placeHolder:y==null?void 0:y.placeHolder,matchOnDescription:y==null?void 0:y.matchOnDescription,matchOnDetail:y==null?void 0:y.matchOnDetail,ignoreFocusLost:y==null?void 0:y.ignoreFocusOut,canPickMany:y==null?void 0:y.canPickMany},_),R={},M=D.then(()=>R);return Promise.race([M,b]).then(O=>{if(O===R)return;const L=ts(g,"quickPickItemTooltip"),W=ts(g,"quickPickItemIcon");return b.then(Z=>{const K=[];for(let H=0;H<Z.length;H++){const C=Z[H];if(typeof C=="string")K.push({label:C,handle:H});else if(C.kind===Qg.Separator)K.push({type:"separator",label:C.label});else{C.tooltip&&!L&&console.warn(`Extension '${g.identifier.value}' uses a tooltip which is proposed API that is only available when running out of dev or with the following command line switch: --enable-proposed-api ${g.identifier.value}`),C.iconPath&&!W&&console.warn(`Extension '${g.identifier.value}' uses an icon which is proposed API that is only available when running out of dev or with the following command line switch: --enable-proposed-api ${g.identifier.value}`);const B=C.iconPath&&W?d(C.iconPath):void 0;K.push({label:C.label,iconPath:B==null?void 0:B.iconPath,iconClass:B==null?void 0:B.iconClass,description:C.description,detail:C.detail,picked:C.picked,alwaysShow:C.alwaysShow,tooltip:L?zi.fromStrict(C.tooltip):void 0,handle:H})}}return y&&typeof y.onDidSelectItem=="function"&&(this._onDidSelectItem=H=>{y.onDidSelectItem(Z[H])}),i.$setItems(E,K),D.then(H=>{if(typeof H=="number")return Z[H];if(Array.isArray(H))return H.map(C=>Z[C])})})}).then(void 0,O=>{if(!Ur(O))return i.$setError(E,O),Promise.reject(O)})}$onItemSelected(g){var m;(m=this._onDidSelectItem)==null||m.call(this,g)}showInput(g,m=_t.None){return this._validateInput=g==null?void 0:g.validateInput,i.$input(g,typeof this._validateInput=="function",m).then(void 0,y=>{if(!Ur(y))return Promise.reject(y)})}async $validateInput(g){if(!this._validateInput)return;const m=await this._validateInput(g);if(!m||typeof m=="string")return m;let y;switch(m.severity){case Ah.Info:y=yi.Info;break;case Ah.Warning:y=yi.Warning;break;case Ah.Error:y=yi.Error;break;default:y=m.message?yi.Error:yi.Ignore;break}return{content:m.message,severity:y}}async showWorkspaceFolderPick(g,m=_t.None){const y=await this._commands.executeCommand("_workbench.pickWorkspaceFolder",[g]);if(!y)return;const _=await this._workspace.getWorkspaceFolders2();if(_)return _.find(b=>b.uri.toString()===y.uri.toString())}createQuickPick(g){const m=new l(g,()=>this._sessions.delete(m._id));return this._sessions.set(m._id,m),m}createInputBox(g){const m=new u(g,()=>this._sessions.delete(m._id));return this._sessions.set(m._id,m),m}$onDidChangeValue(g,m){const y=this._sessions.get(g);y==null||y._fireDidChangeValue(m)}$onDidAccept(g){const m=this._sessions.get(g);m==null||m._fireDidAccept()}$onDidChangeActive(g,m){const y=this._sessions.get(g);y instanceof l&&y._fireDidChangeActive(m)}$onDidChangeSelection(g,m){const y=this._sessions.get(g);y instanceof l&&y._fireDidChangeSelection(m)}$onDidTriggerButton(g,m){const y=this._sessions.get(g);y==null||y._fireDidTriggerButton(m)}$onDidTriggerItemButton(g,m,y){const _=this._sessions.get(g);_ instanceof l&&_._fireDidTriggerItemButton(m,y)}$onDidHide(g){const m=this._sessions.get(g);m==null||m._fireDidHide()}}class s{constructor(g,m){this._extensionId=g,this._onDidDispose=m,this._id=l._nextId++,this._visible=!1,this._expectingHide=!1,this._enabled=!0,this._busy=!1,this._ignoreFocusOut=!0,this._value="",this._buttons=[],this._handlesToButtons=new Map,this._onDidAcceptEmitter=new A,this._onDidChangeValueEmitter=new A,this._onDidTriggerButtonEmitter=new A,this._onDidHideEmitter=new A,this._pendingUpdate={id:this._id},this._disposed=!1,this._disposables=[this._onDidTriggerButtonEmitter,this._onDidHideEmitter,this._onDidAcceptEmitter,this._onDidChangeValueEmitter],this.onDidChangeValue=this._onDidChangeValueEmitter.event,this.onDidAccept=this._onDidAcceptEmitter.event,this.onDidTriggerButton=this._onDidTriggerButtonEmitter.event,this.onDidHide=this._onDidHideEmitter.event}get title(){return this._title}set title(g){this._title=g,this.update({title:g})}get step(){return this._steps}set step(g){this._steps=g,this.update({step:g})}get totalSteps(){return this._totalSteps}set totalSteps(g){this._totalSteps=g,this.update({totalSteps:g})}get enabled(){return this._enabled}set enabled(g){this._enabled=g,this.update({enabled:g})}get busy(){return this._busy}set busy(g){this._busy=g,this.update({busy:g})}get ignoreFocusOut(){return this._ignoreFocusOut}set ignoreFocusOut(g){this._ignoreFocusOut=g,this.update({ignoreFocusOut:g})}get value(){return this._value}set value(g){this._value=g,this.update({value:g})}get placeholder(){return this._placeholder}set placeholder(g){this._placeholder=g,this.update({placeholder:g})}get buttons(){return this._buttons}set buttons(g){this._buttons=g.slice(),this._handlesToButtons.clear(),g.forEach((m,y)=>{const _=m===_f.Back?-1:y;this._handlesToButtons.set(_,m)}),this.update({buttons:g.map((m,y)=>({...d(m.iconPath),tooltip:m.tooltip,handle:m===_f.Back?-1:y}))})}show(){this._visible=!0,this._expectingHide=!0,this.update({visible:!0})}hide(){this._visible=!1,this.update({visible:!1})}_fireDidAccept(){this._onDidAcceptEmitter.fire()}_fireDidChangeValue(g){this._value=g,this._onDidChangeValueEmitter.fire(g)}_fireDidTriggerButton(g){const m=this._handlesToButtons.get(g);m&&this._onDidTriggerButtonEmitter.fire(m)}_fireDidHide(){this._expectingHide&&(this._expectingHide=this._visible,this._onDidHideEmitter.fire())}dispose(){this._disposed||(this._disposed=!0,this._fireDidHide(),this._disposables=vt(this._disposables),this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=void 0),this._onDidDispose(),i.$dispose(this._id))}update(g){if(!this._disposed){for(const m of Object.keys(g)){const y=g[m];this._pendingUpdate[m]=y===void 0?null:y}"visible"in this._pendingUpdate?(this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=void 0),this.dispatchUpdate()):this._visible&&!this._updateTimeout&&(this._updateTimeout=setTimeout(()=>{this._updateTimeout=void 0,this.dispatchUpdate()},0))}}dispatchUpdate(){i.$createOrUpdate(this._pendingUpdate),this._pendingUpdate={id:this._id}}}mi(s,"_nextId",1);function o(h){if(h instanceof Es)return{id:h.id};const g=c(h),m=a(h);return{dark:typeof g=="string"?k.file(g):g,light:typeof m=="string"?k.file(m):m}}function a(h){return typeof h=="object"&&"light"in h?h.light:h}function c(h){return typeof h=="object"&&"dark"in h?h.dark:h}function d(h){const g=o(h);let m,y;return"id"in g?y=Si.asClassName(g):m=g,{iconPath:m,iconClass:y}}class l extends s{constructor(g,m){super(g.identifier,m),this.extension=g,this._items=[],this._handlesToItems=new Map,this._itemsToHandles=new Map,this._canSelectMany=!1,this._matchOnDescription=!0,this._matchOnDetail=!0,this._sortByLabel=!0,this._keepScrollPosition=!1,this._activeItems=[],this._onDidChangeActiveEmitter=new A,this._selectedItems=[],this._onDidChangeSelectionEmitter=new A,this._onDidTriggerItemButtonEmitter=new A,this.onDidChangeActive=this._onDidChangeActiveEmitter.event,this.onDidChangeSelection=this._onDidChangeSelectionEmitter.event,this.onDidTriggerItemButton=this._onDidTriggerItemButtonEmitter.event,this._disposables.push(this._onDidChangeActiveEmitter,this._onDidChangeSelectionEmitter,this._onDidTriggerItemButtonEmitter),this.update({type:"quickPick"})}get items(){return this._items}set items(g){var b;this._items=g.slice(),this._handlesToItems.clear(),this._itemsToHandles.clear(),g.forEach((E,D)=>{this._handlesToItems.set(D,E),this._itemsToHandles.set(E,D)});const m=ts(this.extension,"quickPickItemTooltip"),y=ts(this.extension,"quickPickItemIcon"),_=[];for(let E=0;E<g.length;E++){const D=g[E];if(D.kind===Qg.Separator)_.push({type:"separator",label:D.label});else{D.tooltip&&!m&&console.warn(`Extension '${this.extension.identifier.value}' uses a tooltip which is proposed API that is only available when running out of dev or with the following command line switch: --enable-proposed-api ${this.extension.identifier.value}`),D.iconPath&&!y&&console.warn(`Extension '${this.extension.identifier.value}' uses an icon which is proposed API that is only available when running out of dev or with the following command line switch: --enable-proposed-api ${this.extension.identifier.value}`);const R=D.iconPath&&y?d(D.iconPath):void 0;_.push({handle:E,label:D.label,iconPath:R==null?void 0:R.iconPath,iconClass:R==null?void 0:R.iconClass,description:D.description,detail:D.detail,picked:D.picked,alwaysShow:D.alwaysShow,tooltip:m?zi.fromStrict(D.tooltip):void 0,buttons:(b=D.buttons)==null?void 0:b.map((M,O)=>({...d(M.iconPath),tooltip:M.tooltip,handle:O}))})}}this.update({items:_})}get canSelectMany(){return this._canSelectMany}set canSelectMany(g){this._canSelectMany=g,this.update({canSelectMany:g})}get matchOnDescription(){return this._matchOnDescription}set matchOnDescription(g){this._matchOnDescription=g,this.update({matchOnDescription:g})}get matchOnDetail(){return this._matchOnDetail}set matchOnDetail(g){this._matchOnDetail=g,this.update({matchOnDetail:g})}get sortByLabel(){return this._sortByLabel}set sortByLabel(g){this._sortByLabel=g,this.update({sortByLabel:g})}get keepScrollPosition(){return this._keepScrollPosition}set keepScrollPosition(g){this._keepScrollPosition=g,this.update({keepScrollPosition:g})}get activeItems(){return this._activeItems}set activeItems(g){this._activeItems=g.filter(m=>this._itemsToHandles.has(m)),this.update({activeItems:this._activeItems.map(m=>this._itemsToHandles.get(m))})}get selectedItems(){return this._selectedItems}set selectedItems(g){this._selectedItems=g.filter(m=>this._itemsToHandles.has(m)),this.update({selectedItems:this._selectedItems.map(m=>this._itemsToHandles.get(m))})}_fireDidChangeActive(g){const m=fi(g.map(y=>this._handlesToItems.get(y)));this._activeItems=m,this._onDidChangeActiveEmitter.fire(m)}_fireDidChangeSelection(g){const m=fi(g.map(y=>this._handlesToItems.get(y)));this._selectedItems=m,this._onDidChangeSelectionEmitter.fire(m)}_fireDidTriggerItemButton(g,m){const y=this._handlesToItems.get(g);if(!y||!y.buttons||!y.buttons.length)return;const _=y.buttons[m];_&&this._onDidTriggerItemButtonEmitter.fire({button:_,item:y})}}class u extends s{constructor(g,m){super(g.identifier,m),this._password=!1,this.update({type:"inputBox"})}get password(){return this._password}set password(g){this._password=g,this.update({password:g})}get prompt(){return this._prompt}set prompt(g){this._prompt=g,this.update({prompt:g})}get valueSelection(){return this._valueSelection}set valueSelection(g){this._valueSelection=g,this.update({valueSelection:g})}get validationMessage(){return this._validationMessage}set validationMessage(g){this._validationMessage=g,g?typeof g=="string"?this.update({validationMessage:g,severity:yi.Error}):this.update({validationMessage:g.message,severity:g.severity??yi.Error}):this.update({validationMessage:void 0,severity:yi.Ignore})}}return new n(e,t)}var Bc,WS,Yr;function eP(r){if(r)return typeof r.iconPath=="string"?k.file(r.iconPath):k.isUri(r.iconPath)||Si.isThemeIcon(r.iconPath)?r.iconPath:void 0}function tP(r,e){if(!r.iconPath&&!e.iconPath)return 0;if(r.iconPath){if(!e.iconPath)return 1}else return-1;const t=typeof r.iconPath=="string"?r.iconPath:k.isUri(r.iconPath)?r.iconPath.fsPath:r.iconPath.id,i=typeof e.iconPath=="string"?e.iconPath:k.isUri(e.iconPath)?e.iconPath.fsPath:e.iconPath.id;return vC(t,i)}function upe(r,e){let t=0;if(r.strikeThrough!==e.strikeThrough)return r.strikeThrough?1:-1;if(r.faded!==e.faded)return r.faded?1:-1;if(r.tooltip!==e.tooltip)return(r.tooltip||"").localeCompare(e.tooltip||"");if(t=tP(r,e),t!==0)return t;if(r.light&&e.light)t=tP(r.light,e.light);else{if(r.light)return 1;if(e.light)return-1}if(t!==0)return t;if(r.dark&&e.dark)t=tP(r.dark,e.dark);else{if(r.dark)return 1;if(e.dark)return-1}return t}function hpe(r,e){if(r.command!==e.command)return r.command<e.command?-1:1;if(r.title!==e.title)return r.title<e.title?-1:1;if(r.tooltip!==e.tooltip){if(r.tooltip!==void 0&&e.tooltip!==void 0)return r.tooltip<e.tooltip?-1:1;if(r.tooltip!==void 0)return 1;if(e.tooltip!==void 0)return-1}if(r.arguments===e.arguments)return 0;if(r.arguments)if(e.arguments){if(r.arguments.length!==e.arguments.length)return r.arguments.length-e.arguments.length}else return 1;else return-1;for(let t=0;t<r.arguments.length;t++){const i=r.arguments[t],n=e.arguments[t];if(i!==n)return i<n?-1:1}return 0}function pU(r,e){let t=vC(r.resourceUri.fsPath,e.resourceUri.fsPath,!0);if(t!==0)return t;if(r.command&&e.command)t=hpe(r.command,e.command);else{if(r.command)return 1;if(e.command)return-1}if(t!==0)return t;if(r.decorations&&e.decorations)t=upe(r.decorations,e.decorations);else{if(r.decorations)return 1;if(e.decorations)return-1}return t}function fpe(r,e){for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function ppe(r,e){return r.command===e.command&&r.title===e.title&&r.tooltip===e.tooltip&&(r.arguments&&e.arguments?fpe(r.arguments,e.arguments):r.arguments===e.arguments)}function gpe(r,e){return Ds(r,e,ppe)}class mpe{get value(){return this._value}set value(e){e=e??"",V(this,Bc,"f").$setInputBoxValue(this._sourceControlHandle,e),this.updateValue(e)}get onDidChange(){return this._onDidChange.event}get placeholder(){return this._placeholder}set placeholder(e){V(this,Bc,"f").$setInputBoxPlaceholder(this._sourceControlHandle,e),this._placeholder=e}get validateInput(){return He(this._extension,"scmValidation"),this._validateInput}set validateInput(e){if(He(this._extension,"scmValidation"),e&&typeof e!="function")throw new Error(`[${this._extension.identifier.value}]: Invalid SCM input box validation function`);this._validateInput=e,V(this,Bc,"f").$setValidationProviderIsEnabled(this._sourceControlHandle,!!e)}get enabled(){return this._enabled}set enabled(e){e=!!e,this._enabled!==e&&(this._enabled=e,V(this,Bc,"f").$setInputBoxEnablement(this._sourceControlHandle,e))}get visible(){return this._visible}set visible(e){e=!!e,this._visible!==e&&(this._visible=e,V(this,Bc,"f").$setInputBoxVisibility(this._sourceControlHandle,e))}get document(){return He(this._extension,"scmTextDocument"),V(this,WS,"f").getDocument(this._documentUri)}constructor(e,t,i,n,s){this._extension=e,this._sourceControlHandle=n,this._documentUri=s,Bc.set(this,void 0),WS.set(this,void 0),this._value="",this._onDidChange=new A,this._placeholder="",this._enabled=!0,this._visible=!0,rt(this,WS,t,"f"),rt(this,Bc,i,"f")}showValidationMessage(e,t){He(this._extension,"scmValidation"),V(this,Bc,"f").$showValidationMessage(this._sourceControlHandle,e,t)}$onInputBoxValueChange(e){this.updateValue(e)}updateValue(e){this._value=e,this._onDidChange.fire(e)}}Bc=new WeakMap,WS=new WeakMap;const BD=class BD{get disposed(){return this._disposed}get id(){return this._id}get label(){return this._label}set label(e){this._label=e,this._proxy.$updateGroupLabel(this._sourceControlHandle,this.handle,e)}get hideWhenEmpty(){return this._hideWhenEmpty}set hideWhenEmpty(e){this._hideWhenEmpty=e,this._proxy.$updateGroup(this._sourceControlHandle,this.handle,this.features)}get features(){return{hideWhenEmpty:this.hideWhenEmpty}}get resourceStates(){return[...this._resourceStates]}set resourceStates(e){this._resourceStates=[...e],this._onDidUpdateResourceStates.fire()}constructor(e,t,i,n,s){this._proxy=e,this._commands=t,this._sourceControlHandle=i,this._id=n,this._label=s,this._resourceHandlePool=0,this._resourceStates=[],this._resourceStatesMap=new Map,this._resourceStatesCommandsMap=new Map,this._resourceStatesDisposablesMap=new Map,this._onDidUpdateResourceStates=new A,this.onDidUpdateResourceStates=this._onDidUpdateResourceStates.event,this._disposed=!1,this._onDidDispose=new A,this.onDidDispose=this._onDidDispose.event,this._handlesSnapshot=[],this._resourceSnapshot=[],this._hideWhenEmpty=void 0,this.handle=BD._handlePool++}getResourceState(e){return this._resourceStatesMap.get(e)}$executeResourceCommand(e,t){const i=this._resourceStatesCommandsMap.get(e);return i?Nr(()=>this._commands.executeCommand(i.command,...i.arguments||[],t)):Promise.resolve(void 0)}_takeResourceStateSnapshot(){var o;const e=[...this._resourceStates].sort(pU),i=JY(this._resourceSnapshot,e,pU).map(a=>{const c=a.toInsert.map(d=>{const l=this._resourceHandlePool++;this._resourceStatesMap.set(l,d);const u=d.resourceUri;let h;if(d.command)if(d.command.command==="vscode.open"||d.command.command==="vscode.diff"){const O=new me;h=this._commands.converter.toInternal(d.command,O),this._resourceStatesDisposablesMap.set(l,O)}else this._resourceStatesCommandsMap.set(l,d.command);const g=eP(d.decorations),m=d.decorations&&eP(d.decorations.light)||g,y=d.decorations&&eP(d.decorations.dark)||g,_=[m,y],b=d.decorations&&d.decorations.tooltip||"",E=d.decorations&&!!d.decorations.strikeThrough,D=d.decorations&&!!d.decorations.faded,R=d.contextValue||"";return{rawResource:[l,u,_,b,E,D,R,h],handle:l}});return{start:a.start,deleteCount:a.deleteCount,toInsert:c}}),n=i.map(({start:a,deleteCount:c,toInsert:d})=>[a,c,d.map(l=>l.rawResource)]),s=i.reverse();for(const{start:a,deleteCount:c,toInsert:d}of s){const l=d.map(h=>h.handle),u=this._handlesSnapshot.splice(a,c,...l);for(const h of u)this._resourceStatesMap.delete(h),this._resourceStatesCommandsMap.delete(h),(o=this._resourceStatesDisposablesMap.get(h))==null||o.dispose(),this._resourceStatesDisposablesMap.delete(h)}return this._resourceSnapshot=e,n}dispose(){this._disposed=!0,this._onDidDispose.fire()}};mi(BD,"_handlePool",0);let FL=BD;class fu{get id(){return this._id}get label(){return this._label}get rootUri(){return this._rootUri}get inputBox(){return this._inputBox}get count(){return this._count}set count(e){this._count!==e&&(this._count=e,V(this,Yr,"f").$updateSourceControl(this.handle,{count:e}))}get quickDiffProvider(){return this._quickDiffProvider}set quickDiffProvider(e){this._quickDiffProvider=e;let t;ts(this._extension,"quickDiffProvider")&&(t=e==null?void 0:e.label),V(this,Yr,"f").$updateSourceControl(this.handle,{hasQuickDiffProvider:!!e,quickDiffLabel:t})}get commitTemplate(){return this._commitTemplate}set commitTemplate(e){e!==this._commitTemplate&&(this._commitTemplate=e,V(this,Yr,"f").$updateSourceControl(this.handle,{commitTemplate:e}))}get acceptInputCommand(){return this._acceptInputCommand}set acceptInputCommand(e){this._acceptInputDisposables.value=new me,this._acceptInputCommand=e;const t=this._commands.converter.toInternal(e,this._acceptInputDisposables.value);V(this,Yr,"f").$updateSourceControl(this.handle,{acceptInputCommand:t})}get actionButton(){return He(this._extension,"scmActionButton"),this._actionButton}set actionButton(e){var i;He(this._extension,"scmActionButton"),this._actionButtonDisposables.value=new me,this._actionButton=e;const t=e!==void 0?{command:this._commands.converter.toInternal(e.command,this._actionButtonDisposables.value),secondaryCommands:(i=e.secondaryCommands)==null?void 0:i.map(n=>n.map(s=>this._commands.converter.toInternal(s,this._actionButtonDisposables.value))),description:e.description,enabled:e.enabled}:void 0;V(this,Yr,"f").$updateSourceControl(this.handle,{actionButton:t??null})}get statusBarCommands(){return this._statusBarCommands}set statusBarCommands(e){if(this._statusBarCommands&&e&&gpe(this._statusBarCommands,e))return;this._statusBarDisposables.value=new me,this._statusBarCommands=e;const t=(e||[]).map(i=>this._commands.converter.toInternal(i,this._statusBarDisposables.value));V(this,Yr,"f").$updateSourceControl(this.handle,{statusBarCommands:t})}get selected(){return this._selected}constructor(e,t,i,n,s,o,a){this._extension=e,this._commands=n,this._id=s,this._label=o,this._rootUri=a,Yr.set(this,void 0),this._groups=new Map,this._count=void 0,this._quickDiffProvider=void 0,this._commitTemplate=void 0,this._acceptInputDisposables=new Hr,this._acceptInputCommand=void 0,this._actionButtonDisposables=new Hr,this._statusBarDisposables=new Hr,this._statusBarCommands=void 0,this._selected=!1,this._onDidChangeSelection=new A,this.onDidChangeSelection=this._onDidChangeSelection.event,this.handle=fu._handlePool++,this.createdResourceGroups=new Map,this.updatedResourceGroups=new Set,rt(this,Yr,i,"f");const c=k.from({scheme:pe.vscodeSourceControl,path:`${s}/scm${this.handle}/input`,query:a?`rootUri=${encodeURIComponent(a.toString())}`:void 0});this._inputBox=new mpe(e,t,V(this,Yr,"f"),this.handle,c),V(this,Yr,"f").$registerSourceControl(this.handle,s,o,a,c)}createResourceGroup(e,t){const i=new FL(V(this,Yr,"f"),this._commands,this.handle,e,t),n=F.once(i.onDidDispose)(()=>this.createdResourceGroups.delete(i));return this.createdResourceGroups.set(i,n),this.eventuallyAddResourceGroups(),i}eventuallyAddResourceGroups(){const e=[],t=[];for(const[i,n]of this.createdResourceGroups){n.dispose();const s=i.onDidUpdateResourceStates(()=>{this.updatedResourceGroups.add(i),this.eventuallyUpdateResourceStates()});F.once(i.onDidDispose)(()=>{this.updatedResourceGroups.delete(i),s.dispose(),this._groups.delete(i.handle),V(this,Yr,"f").$unregisterGroup(this.handle,i.handle)}),e.push([i.handle,i.id,i.label,i.features]);const o=i._takeResourceStateSnapshot();o.length>0&&t.push([i.handle,o]),this._groups.set(i.handle,i)}V(this,Yr,"f").$registerGroups(this.handle,e,t),this.createdResourceGroups.clear()}eventuallyUpdateResourceStates(){const e=[];this.updatedResourceGroups.forEach(t=>{const i=t._takeResourceStateSnapshot();i.length!==0&&e.push([t.handle,i])}),e.length>0&&V(this,Yr,"f").$spliceResourceStates(this.handle,e),this.updatedResourceGroups.clear()}getResourceGroup(e){return this._groups.get(e)}setSelectionState(e){this._selected=e,this._onDidChangeSelection.fire(e)}dispose(){this._acceptInputDisposables.dispose(),this._actionButtonDisposables.dispose(),this._statusBarDisposables.dispose(),this._groups.forEach(e=>e.dispose()),V(this,Yr,"f").$unregisterSourceControl(this.handle)}}Yr=new WeakMap;fu._handlePool=0;fu.__decorator=T([pk(100)],fu.prototype,"eventuallyAddResourceGroups",null);fu.__decorator=T([pk(100)],fu.prototype,"eventuallyUpdateResourceStates",null);let Fx=class H5{get onDidChangeActiveProvider(){return this._onDidChangeActiveProvider.event}constructor(e,t,i,n){this._commands=t,this._extHostDocuments=i,this.logService=n,this._sourceControls=new Map,this._sourceControlsByExtension=new Ln,this._onDidChangeActiveProvider=new A,this._proxy=e.getProxy(ce.MainThreadSCM),this._telemetry=e.getProxy(ce.MainThreadTelemetry),t.registerArgumentProcessor({processArgument:s=>{if(s&&s.$mid===3){const o=this._sourceControls.get(s.sourceControlHandle);if(!o)return s;const a=o.getResourceGroup(s.groupHandle);return a?a.getResourceState(s.handle):s}else if(s&&s.$mid===4){const o=this._sourceControls.get(s.sourceControlHandle);return o?o.getResourceGroup(s.groupHandle):s}else if(s&&s.$mid===5){const o=this._sourceControls.get(s.handle);return o||s}return s}})}createSourceControl(e,t,i,n){this.logService.trace("ExtHostSCM#createSourceControl",e.identifier.value,t,i,n),this._telemetry.$publicLog2("api/scm/createSourceControl",{extensionId:e.identifier.value});const s=H5._handlePool++,o=new fu(e,this._extHostDocuments,this._proxy,this._commands,t,i,n);this._sourceControls.set(s,o);const a=this._sourceControlsByExtension.get(e.identifier)||[];return a.push(o),this._sourceControlsByExtension.set(e.identifier,a),o}getLastInputBox(e){this.logService.trace("ExtHostSCM#getLastInputBox",e.identifier.value);const t=this._sourceControlsByExtension.get(e.identifier),i=t&&t[t.length-1];return i&&i.inputBox}$provideOriginalResource(e,t,i){const n=k.revive(t);this.logService.trace("ExtHostSCM#$provideOriginalResource",e,n.toString());const s=this._sourceControls.get(e);return!s||!s.quickDiffProvider||!s.quickDiffProvider.provideOriginalResource?Promise.resolve(null):Nr(()=>s.quickDiffProvider.provideOriginalResource(n,i)).then(o=>o||null)}$onInputBoxValueChange(e,t){this.logService.trace("ExtHostSCM#$onInputBoxValueChange",e);const i=this._sourceControls.get(e);return i&&i.inputBox.$onInputBoxValueChange(t),Promise.resolve(void 0)}$executeResourceCommand(e,t,i,n){this.logService.trace("ExtHostSCM#$executeResourceCommand",e,t,i);const s=this._sourceControls.get(e);if(!s)return Promise.resolve(void 0);const o=s.getResourceGroup(t);return o?o.$executeResourceCommand(i,n):Promise.resolve(void 0)}$validateInput(e,t,i){this.logService.trace("ExtHostSCM#$validateInput",e);const n=this._sourceControls.get(e);return!n||!n.inputBox.validateInput?Promise.resolve(void 0):Nr(()=>n.inputBox.validateInput(t,i)).then(s=>{if(!s)return Promise.resolve(void 0);const o=zi.fromStrict(s.message);return o?Promise.resolve([o,s.type]):Promise.resolve(void 0)})}$setSelectedSourceControl(e){var t,i;return this.logService.trace("ExtHostSCM#$setSelectedSourceControl",e),e!==void 0&&((t=this._sourceControls.get(e))==null||t.setSelectionState(!0)),this._selectedSourceControlHandle!==void 0&&((i=this._sourceControls.get(this._selectedSourceControlHandle))==null||i.setSelectionState(!1)),this._selectedSourceControlHandle=e,Promise.resolve(void 0)}};Fx._handlePool=0;Fx=T([v(3,ze)],Fx);var Zv,ey;class Uh{constructor(e,t,i,n,s,o=Jc.Left,a){if(Zv.set(this,void 0),ey.set(this,void 0),this._disposed=!1,this._text="",this._staleCommandRegistrations=new me,rt(this,Zv,e,"f"),rt(this,ey,t,"f"),s&&n){this._entryId=ite(n.identifier,s);const c=i.get(this._entryId);c&&(o=c.alignLeft?Jc.Left:Jc.Right,a=c.priority,this._visible=!0,this.name=c.name,this.text=c.text,this.tooltip=c.tooltip,this.command=c.command,this.accessibilityInformation=c.accessibilityInformation)}else this._entryId=String(Uh.ID_GEN++);this._extension=n,this._id=s,this._alignment=o,this._priority=this.validatePriority(a)}validatePriority(e){if(pr(e))return e===Number.POSITIVE_INFINITY?Number.MAX_VALUE:e===Number.NEGATIVE_INFINITY?-Number.MAX_VALUE:e}get id(){return this._id??this._extension.identifier.value}get alignment(){return this._alignment}get priority(){return this._priority}get text(){return this._text}get name(){return this._name}get tooltip(){return this._tooltip}get color(){return this._color}get backgroundColor(){return this._backgroundColor}get command(){var e;return(e=this._command)==null?void 0:e.fromApi}get accessibilityInformation(){return this._accessibilityInformation}set text(e){this._text=e,this.update()}set name(e){this._name=e,this.update()}set tooltip(e){this._tooltip=e,this.update()}set color(e){this._color=e,this.update()}set backgroundColor(e){e&&!Uh.ALLOWED_BACKGROUND_COLORS.has(e.id)&&(e=void 0),this._backgroundColor=e,this.update()}set command(e){var t;((t=this._command)==null?void 0:t.fromApi)!==e&&(this._latestCommandRegistration&&this._staleCommandRegistrations.add(this._latestCommandRegistration),this._latestCommandRegistration=new me,typeof e=="string"?this._command={fromApi:e,internal:V(this,ey,"f").toInternal({title:"",command:e},this._latestCommandRegistration)}:e?this._command={fromApi:e,internal:V(this,ey,"f").toInternal(e,this._latestCommandRegistration)}:this._command=void 0,this.update())}set accessibilityInformation(e){this._accessibilityInformation=e,this.update()}show(){this._visible=!0,this.update()}hide(){clearTimeout(this._timeoutHandle),this._visible=!1,V(this,Zv,"f").$disposeEntry(this._entryId)}update(){this._disposed||!this._visible||(clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{var s,o;this._timeoutHandle=void 0;let e;this._extension?this._id?e=`${this._extension.identifier.value}.${this._id}`:e=this._extension.identifier.value:e=this._id;let t;this._name?t=this._name:t=p("extensionLabel","{0} (Extension)",this._extension.displayName||this._extension.name);let i=this._color;this._backgroundColor&&(i=Uh.ALLOWED_BACKGROUND_COLORS.get(this._backgroundColor.id));const n=zi.fromStrict(this._tooltip);V(this,Zv,"f").$setEntry(this._entryId,e,(s=this._extension)==null?void 0:s.identifier.value,t,this._text,n,(o=this._command)==null?void 0:o.internal,i,this._backgroundColor,this._alignment===Jc.Left,this._priority,this._accessibilityInformation),this._staleCommandRegistrations.clear()},0))}dispose(){this.hide(),this._disposed=!0}}Zv=new WeakMap,ey=new WeakMap;Uh.ID_GEN=0;Uh.ALLOWED_BACKGROUND_COLORS=new Map([["statusBarItem.errorBackground",new qg("statusBarItem.errorForeground")],["statusBarItem.warningBackground",new qg("statusBarItem.warningForeground")]]);class vpe{constructor(e){this._messages=[],this._item=e.createStatusBarEntry(void 0,"status.extensionMessage",Jc.Left,Number.MIN_VALUE),this._item.name=p("status.extensionMessage","Extension Status")}dispose(){this._messages.length=0,this._item.dispose()}setMessage(e){const t={message:e};return this._messages.unshift(t),this._update(),new Yt(()=>{const i=this._messages.indexOf(t);i>=0&&(this._messages.splice(i,1),this._update())})}_update(){this._messages.length>0?(this._item.text=this._messages[0].message,this._item.show()):this._item.hide()}}class ype{constructor(e,t){this._existingItems=new Map,this._proxy=e.getProxy(ce.MainThreadStatusBar),this._commands=t,this._statusMessage=new vpe(this)}$acceptStaticEntries(e){for(const t of e)this._existingItems.set(t.entryId,t)}createStatusBarEntry(e,t,i,n){return new Uh(this._proxy,this._commands,this._existingItems,e,t,i,n)}setStatusBarMessage(e,t){const i=this._statusMessage.setMessage(e);let n;return typeof t=="number"?n=setTimeout(()=>i.dispose(),t):typeof t<"u"&&t.then(()=>i.dispose(),()=>i.dispose()),new Yt(()=>{i.dispose(),clearTimeout(n)})}}class _pe{constructor(e,t){this._extHostDocumentsAndEditors=t,this._onDidChangeTextEditorSelection=new A({onListenerError:Fn}),this._onDidChangeTextEditorOptions=new A({onListenerError:Fn}),this._onDidChangeTextEditorVisibleRanges=new A({onListenerError:Fn}),this._onDidChangeTextEditorViewColumn=new A({onListenerError:Fn}),this._onDidChangeActiveTextEditor=new A({onListenerError:Fn}),this._onDidChangeVisibleTextEditors=new A({onListenerError:Fn}),this.onDidChangeTextEditorSelection=this._onDidChangeTextEditorSelection.event,this.onDidChangeTextEditorOptions=this._onDidChangeTextEditorOptions.event,this.onDidChangeTextEditorVisibleRanges=this._onDidChangeTextEditorVisibleRanges.event,this.onDidChangeTextEditorViewColumn=this._onDidChangeTextEditorViewColumn.event,this.onDidChangeActiveTextEditor=this._onDidChangeActiveTextEditor.event,this.onDidChangeVisibleTextEditors=this._onDidChangeVisibleTextEditors.event,this._proxy=e.getProxy(ce.MainThreadTextEditors),this._extHostDocumentsAndEditors.onDidChangeVisibleTextEditors(i=>this._onDidChangeVisibleTextEditors.fire(i)),this._extHostDocumentsAndEditors.onDidChangeActiveTextEditor(i=>this._onDidChangeActiveTextEditor.fire(i))}getActiveTextEditor(){return this._extHostDocumentsAndEditors.activeEditor()}getVisibleTextEditors(e){const t=this._extHostDocumentsAndEditors.allEditors();return e?t:t.map(i=>i.value)}async showTextDocument(e,t,i){let n;typeof t=="number"?n={position:Hn.from(t),preserveFocus:i}:typeof t=="object"?n={position:Hn.from(t.viewColumn),preserveFocus:t.preserveFocus,selection:typeof t.selection=="object"?ge.from(t.selection):void 0,pinned:typeof t.preview=="boolean"?!t.preview:void 0}:n={preserveFocus:!1};const s=await this._proxy.$tryShowTextDocument(e.uri,n),o=s&&this._extHostDocumentsAndEditors.getEditor(s);if(o)return o.value;throw s?new Error(`Could NOT open editor for "${e.uri.toString()}" because another editor opened in the meantime.`):new Error(`Could NOT open editor for "${e.uri.toString()}".`)}createTextEditorDecorationType(e,t){return new ZT(this._proxy,e,t).value}$acceptEditorPropertiesChanged(e,t){const i=this._extHostDocumentsAndEditors.getEditor(e);if(!i)throw new Error("unknown text editor");if(t.options&&i._acceptOptions(t.options),t.selections){const n=t.selections.selections.map(Aa.to);i._acceptSelections(n)}if(t.visibleRanges){const n=fi(t.visibleRanges.map(ge.to));i._acceptVisibleRanges(n)}if(t.options&&this._onDidChangeTextEditorOptions.fire({textEditor:i.value,options:{...t.options,lineNumbers:gg.to(t.options.lineNumbers)}}),t.selections){const n=ff.fromValue(t.selections.source),s=t.selections.selections.map(Aa.to);this._onDidChangeTextEditorSelection.fire({textEditor:i.value,selections:s,kind:n})}if(t.visibleRanges){const n=fi(t.visibleRanges.map(ge.to));this._onDidChangeTextEditorVisibleRanges.fire({textEditor:i.value,visibleRanges:n})}}$acceptEditorPositionData(e){for(const t in e){const i=this._extHostDocumentsAndEditors.getEditor(t);if(!i)throw new Error("Unknown text editor");const n=Hn.to(e[t]);i.value.viewColumn!==n&&(i._acceptViewColumn(n),this._onDidChangeTextEditorViewColumn.fire({textEditor:i.value,viewColumn:n}))}}getDiffInformation(e){return Promise.resolve(this._proxy.$getDiffInformation(e))}}function gU(r,e){if(Rt(r))return{label:r};if(r&&typeof r=="object"&&typeof r.label=="string"){let t;return Array.isArray(r.highlights)&&(t=r.highlights.filter(i=>i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"),t=t.length?t:void 0),{label:r.label,highlights:t}}}class wpe{constructor(e,t,i){this._proxy=e,this.commands=t,this.logService=i,this.treeViews=new Map,this.treeDragAndDropService=new Nq;function n(s){return s&&s.$treeViewId&&(s.$treeItemHandle||s.$selectedTreeItems||s.$focusedTreeItem)}t.registerArgumentProcessor({processArgument:s=>n(s)?this.convertArgument(s):Array.isArray(s)&&s.length>0?s.map(o=>n(o)?this.convertArgument(o):o):s})}registerTreeDataProvider(e,t,i){const n=this.createTreeView(e,{treeDataProvider:t},i);return{dispose:()=>n.dispose()}}createTreeView(e,t,i){var u,h,g,m;if(!t||!t.treeDataProvider)throw new Error("Options with treeDataProvider is mandatory");const n=((u=t.dragAndDropController)==null?void 0:u.dropMimeTypes)??[],s=((h=t.dragAndDropController)==null?void 0:h.dragMimeTypes)??[],o=!!((g=t.dragAndDropController)!=null&&g.handleDrag),a=!!((m=t.dragAndDropController)!=null&&m.handleDrop),c=this.createExtHostTreeView(e,t,i),d={showCollapseAll:!!t.showCollapseAll,canSelectMany:!!t.canSelectMany,dropMimeTypes:n,dragMimeTypes:s,hasHandleDrag:o,hasHandleDrop:a,manuallyManageCheckboxes:!!t.manageCheckboxStateManually},l=this._proxy.$registerTreeViewDataProvider(e,d);return{get onDidCollapseElement(){return c.onDidCollapseElement},get onDidExpandElement(){return c.onDidExpandElement},get selection(){return c.selectedElements},get onDidChangeSelection(){return c.onDidChangeSelection},get visible(){return c.visible},get onDidChangeVisibility(){return c.onDidChangeVisibility},get onDidChangeCheckboxState(){return c.onDidChangeCheckboxState},get message(){return c.message},set message(y){c.message=y},get title(){return c.title},set title(y){c.title=y},get description(){return c.description},set description(y){c.description=y},get badge(){return c.badge},set badge(y){y!==void 0&&rA.isViewBadge(y)?c.badge={value:Math.floor(Math.abs(y.value)),tooltip:y.tooltip}:y===void 0&&(c.badge=void 0)},reveal:(y,_)=>c.reveal(y,_),dispose:async()=>{await l,this.treeViews.delete(e),c.dispose()}}}$getChildren(e,t){const i=this.treeViews.get(e);return i?i.getChildren(t):Promise.reject(new oa(e))}async $handleDrop(e,t,i,n,s,o,a,c){const d=this.treeViews.get(e);if(!d)return Promise.reject(new oa(e));const l=Qo.toDataTransfer(i,async u=>(await this._proxy.$resolveDropFileData(e,t,u)).buffer);return a===e&&c&&await this.addAdditionalTransferItems(l,d,c,s,o),d.onDrop(l,n,s)}async addAdditionalTransferItems(e,t,i,n,s){var a;const o=this.treeDragAndDropService.removeDragOperationTransfer(s);if(o)(a=await o)==null||a.forEach((c,d)=>{c&&e.set(d,c)});else if(s&&t.handleDrag){const c=t.handleDrag(i,e,n);this.treeDragAndDropService.addDragOperationTransfer(s,c),await c}return e}async $handleDrag(e,t,i,n){const s=this.treeViews.get(e);if(!s)return Promise.reject(new oa(e));const o=await this.addAdditionalTransferItems(new Vg,s,t,n,i);if(!(!o||n.isCancellationRequested))return Qo.from(o)}async $hasResolve(e){const t=this.treeViews.get(e);if(!t)throw new oa(e);return t.hasResolve}$resolve(e,t,i){const n=this.treeViews.get(e);if(!n)throw new oa(e);return n.resolveTreeItem(t,i)}$setExpanded(e,t,i){const n=this.treeViews.get(e);if(!n)throw new oa(e);n.setExpanded(t,i)}$setSelection(e,t){const i=this.treeViews.get(e);if(!i)throw new oa(e);i.setSelection(t)}$setFocus(e,t){const i=this.treeViews.get(e);if(!i)throw new oa(e);i.setFocus(t)}$setVisible(e,t){const i=this.treeViews.get(e);if(!i)throw new oa(e);i.setVisible(t)}$changeCheckboxState(e,t){const i=this.treeViews.get(e);if(!i)throw new oa(e);i.setCheckboxState(t)}createExtHostTreeView(e,t,i){const n=new OL(e,t,this._proxy,this.commands.converter,this.logService,i);return this.treeViews.set(e,n),n}convertArgument(e){const t=this.treeViews.get(e.$treeViewId);return t&&"$treeItemHandle"in e?t.getExtensionElement(e.$treeItemHandle):t&&"$focusedTreeItem"in e&&e.$focusedTreeItem?t.focusedElement:null}}const rg=class rg extends ne{get visible(){return this._visible}get selectedElements(){return this._selectedHandles.map(e=>this.getExtensionElement(e)).filter(e=>!Wo(e))}get focusedElement(){return this._focusedHandle?this.getExtensionElement(this._focusedHandle):void 0}constructor(e,t,i,n,s,o){if(super(),this.viewId=e,this.proxy=i,this.commands=n,this.logService=s,this.extension=o,this.roots=void 0,this.elements=new Map,this.nodes=new Map,this._visible=!1,this._selectedHandles=[],this._focusedHandle=void 0,this._onDidExpandElement=this._register(new A),this.onDidExpandElement=this._onDidExpandElement.event,this._onDidCollapseElement=this._register(new A),this.onDidCollapseElement=this._onDidCollapseElement.event,this._onDidChangeSelection=this._register(new A),this.onDidChangeSelection=this._onDidChangeSelection.event,this._onDidChangeVisibility=this._register(new A),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._onDidChangeCheckboxState=this._register(new A),this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event,this._onDidChangeData=this._register(new A),this.refreshPromise=Promise.resolve(),this.refreshQueue=Promise.resolve(),this._message="",this._title="",this._refreshCancellationSource=new Xt,o.contributes&&o.contributes.views)for(const d in o.contributes.views)for(const l of o.contributes.views[d])l.id===e&&(this._title=l.name);this.dataProvider=t.treeDataProvider,this.dndController=t.dragAndDropController,this.dataProvider.onDidChangeTreeData&&this._register(this.dataProvider.onDidChangeTreeData(d=>this._onDidChangeData.fire({message:!1,element:d})));let a,c;this._register(F.debounce(this._onDidChangeData.event,(d,l)=>(d||(d={message:!1,elements:[]}),l.element!==!1&&(a||(a=new Promise(u=>c=u),this.refreshPromise=this.refreshPromise.then(()=>a)),Array.isArray(l.element)?d.elements.push(...l.element):d.elements.push(l.element)),l.message&&(d.message=!0),d),200,!0)(({message:d,elements:l})=>{l.length&&(this.refreshQueue=this.refreshQueue.then(()=>{const u=c;return a=null,this.refresh(l).then(()=>u())})),d&&this.proxy.$setMessage(this.viewId,this._message)}))}async getChildren(e){const t=e?this.getExtensionElement(e):void 0;if(e&&!t)return this.logService.error(`No tree item with id '${e}' found.`),Promise.resolve([]);let i=this.getChildrenNodes(e);return i||(i=await this.fetchChildrenNodes(t)),i?i.map(n=>n.item):void 0}getExtensionElement(e){return this.elements.get(e)}reveal(e,t){t=t||{select:!0,focus:!1};const i=Wo(t.select)?!0:t.select,n=Wo(t.focus)?!1:t.focus,s=Wo(t.expand)?!1:t.expand;return typeof this.dataProvider.getParent!="function"?Promise.reject(new Error("Required registered TreeDataProvider to implement 'getParent' method to access 'reveal' method")):e?this.refreshPromise.then(()=>this.resolveUnknownParentChain(e)).then(o=>this.resolveTreeNode(e,o[o.length-1]).then(a=>this.proxy.$reveal(this.viewId,{item:a.item,parentChain:o.map(c=>c.item)},{select:i,focus:n,expand:s})),o=>this.logService.error(o)):this.proxy.$reveal(this.viewId,void 0,{select:i,focus:n,expand:s})}get message(){return this._message}set message(e){this._message=e,this._onDidChangeData.fire({message:!0,element:!1})}get title(){return this._title}set title(e){this._title=e,this.proxy.$setTitle(this.viewId,e,this._description)}get description(){return this._description}set description(e){this._description=e,this.proxy.$setTitle(this.viewId,this._title,e)}get badge(){return this._badge}set badge(e){var t,i;((t=this._badge)==null?void 0:t.value)===(e==null?void 0:e.value)&&((i=this._badge)==null?void 0:i.tooltip)===(e==null?void 0:e.tooltip)||(this._badge=Ix.from(e),this.proxy.$setBadge(this.viewId,e))}setExpanded(e,t){const i=this.getExtensionElement(e);i&&(t?this._onDidExpandElement.fire(Object.freeze({element:i})):this._onDidCollapseElement.fire(Object.freeze({element:i})))}setSelection(e){Ds(this._selectedHandles,e)||(this._selectedHandles=e,this._onDidChangeSelection.fire(Object.freeze({selection:this.selectedElements})))}setFocus(e){this._focusedHandle=e}setVisible(e){e!==this._visible&&(this._visible=e,this._onDidChangeVisibility.fire(Object.freeze({visible:this._visible})))}async setCheckboxState(e){const t=(await Promise.all(e.map(async i=>{const n=this.getExtensionElement(i.treeItemHandle);return n?{extensionItem:n,treeItem:await this.dataProvider.getTreeItem(n),newState:i.newState?fa.Checked:fa.Unchecked}:Promise.resolve(void 0)}))).filter(i=>i!==void 0);t.forEach(i=>{i.treeItem.checkboxState=i.newState?fa.Checked:fa.Unchecked}),this._onDidChangeCheckboxState.fire({items:t.map(i=>[i.extensionItem,i.newState])})}async handleDrag(e,t,i){var s;const n=[];for(const o of e){const a=this.getExtensionElement(o);a&&n.push(a)}if(!(!((s=this.dndController)!=null&&s.handleDrag)||n.length===0))return await this.dndController.handleDrag(n,t,i),t}get hasHandleDrag(){var e;return!!((e=this.dndController)!=null&&e.handleDrag)}async onDrop(e,t,i){var s;const n=t?this.getExtensionElement(t):void 0;if(!(!n&&t||!((s=this.dndController)!=null&&s.handleDrop)))return Nr(()=>{var o;return(o=this.dndController)!=null&&o.handleDrop?this.dndController.handleDrop(n,e,i):void 0})}get hasResolve(){return!!this.dataProvider.resolveTreeItem}async resolveTreeItem(e,t){if(!this.dataProvider.resolveTreeItem)return;const i=this.elements.get(e);if(i){const n=this.nodes.get(i);if(n){const s=await this.dataProvider.resolveTreeItem(n.extensionItem,i,t)??n.extensionItem;return this.validateTreeItem(s),n.item.tooltip=this.getTooltip(s.tooltip),n.item.command=this.getCommand(n.disposableStore,s.command),n.item}}}resolveUnknownParentChain(e){return this.resolveParent(e).then(t=>t?this.resolveUnknownParentChain(t).then(i=>this.resolveTreeNode(t,i[i.length-1]).then(n=>(i.push(n),i))):Promise.resolve([]))}resolveParent(e){const t=this.nodes.get(e);return t?Promise.resolve(t.parent?this.elements.get(t.parent.item.handle):void 0):Nr(()=>this.dataProvider.getParent(e))}resolveTreeNode(e,t){const i=this.nodes.get(e);return i?Promise.resolve(i):Nr(()=>this.dataProvider.getTreeItem(e)).then(n=>this.createHandle(e,n,t,!0)).then(n=>this.getChildren(t?t.item.handle:void 0).then(()=>{const s=this.getExtensionElement(n);if(s){const o=this.nodes.get(s);if(o)return Promise.resolve(o)}throw new Error(`Cannot resolve tree item for element ${n}`)}))}getChildrenNodes(e){if(e){let t;if(typeof e=="string"){const i=this.getExtensionElement(e);t=i?this.nodes.get(i):void 0}else t=e;return t&&t.children||void 0}return this.roots}async fetchChildrenNodes(e){this.clearChildren(e);const t=new Xt(this._refreshCancellationSource.token);try{const i=e?this.nodes.get(e):void 0,n=await this.dataProvider.getChildren(e);if(t.token.isCancellationRequested)return;const s=await Promise.all(fi(n||[]).map(async o=>{const a=await this.dataProvider.getTreeItem(o);return a&&!t.token.isCancellationRequested?this.createAndRegisterTreeNode(o,a,i):null}));return t.token.isCancellationRequested?void 0:fi(s)}finally{t.dispose()}}refresh(e){if(e.some(i=>!i))return this._refreshCancellationSource.dispose(!0),this._refreshCancellationSource=new Xt,this.clearAll(),this.proxy.$refresh(this.viewId);{const i=this.getHandlesToRefresh(e);if(i.length)return this.refreshHandles(i)}return Promise.resolve(void 0)}getHandlesToRefresh(e){const t=new Set,i=e.map(s=>this.nodes.get(s));for(const s of i)if(s&&!t.has(s.item.handle)){let o=s;for(;o&&o.parent&&i.findIndex(a=>o&&o.parent&&a&&a.item.handle===o.parent.item.handle)===-1;){const a=this.elements.get(o.parent.item.handle);o=a?this.nodes.get(a):void 0}o&&!o.parent&&t.add(s.item.handle)}const n=[];return t.forEach(s=>{const o=this.elements.get(s);if(o){const a=this.nodes.get(o);a&&(!a.parent||!t.has(a.parent.item.handle))&&n.push(s)}}),n}refreshHandles(e){const t={};return Promise.all(e.map(i=>this.refreshNode(i).then(n=>{n&&(t[i]=n.item)}))).then(()=>Object.keys(t).length?this.proxy.$refresh(this.viewId,t):void 0)}refreshNode(e){const t=this.getExtensionElement(e);if(t){const i=this.nodes.get(t);if(i)return this.clearChildren(t),Nr(()=>this.dataProvider.getTreeItem(t)).then(n=>{if(n){const s=this.createTreeNode(t,n,i.parent);return this.updateNodeCache(t,s,i,i.parent),i.dispose(),s}return null})}return Promise.resolve(null)}createAndRegisterTreeNode(e,t,i){const n=this.createTreeNode(e,t,i);if(t.id&&this.elements.has(n.item.handle))throw new Error(p("treeView.duplicateElement","Element with id {0} is already registered",t.id));return this.addNodeToCache(e,n),this.addNodeToParentCache(n,i),n}getTooltip(e){return Ia.isMarkdownString(e)?zi.from(e):e}getCommand(e,t){return t?{...this.commands.toInternal(t,e),originalId:t.command}:void 0}getCheckbox(e){if(e.checkboxState===void 0)return;let t,i,n;return typeof e.checkboxState=="number"?t=e.checkboxState:(t=e.checkboxState.state,i=e.checkboxState.tooltip,n=e.checkboxState.accessibilityInformation),{isChecked:t===fa.Checked,tooltip:i,accessibilityInformation:n}}validateTreeItem(e){if(!y_.isTreeItem(e,this.extension))throw new Error(`Extension ${this.extension.identifier.value} has provided an invalid tree item.`)}createTreeNode(e,t,i){this.validateTreeItem(t);const n=new me,s=this.createHandle(e,t,i),o=this.getLightIconPath(t);return{item:{handle:s,parentHandle:i?i.item.handle:void 0,label:gU(t.label),description:t.description,resourceUri:t.resourceUri,tooltip:this.getTooltip(t.tooltip),command:this.getCommand(n,t.command),contextValue:t.contextValue,icon:o,iconDark:this.getDarkIconPath(t)||o,themeIcon:this.getThemeIcon(t),collapsibleState:Wo(t.collapsibleState)?Hl.None:t.collapsibleState,accessibilityInformation:t.accessibilityInformation,checkbox:this.getCheckbox(t)},extensionItem:t,parent:i,children:void 0,disposableStore:n,dispose(){n.dispose()}}}getThemeIcon(e){return e.iconPath instanceof Es?e.iconPath:void 0}createHandle(e,{id:t,label:i,resourceUri:n},s,o){if(t)return`${rg.ID_HANDLE_PREFIX}/${t}`;const a=gU(i),c=s?s.item.handle:rg.LABEL_HANDLE_PREFIX;let d=a?a.label:n?Mt(n):"";d=d.indexOf("/")!==-1?d.replace("/","//"):d;const l=this.nodes.has(e)?this.nodes.get(e).item.handle:void 0,u=this.getChildrenNodes(s)||[];let h,g=0;do{if(h=`${c}/${g}:${d}`,o||!this.elements.has(h)||l===h)break;g++}while(g<=u.length);return h}getLightIconPath(e){if(e.iconPath&&!(e.iconPath instanceof Es))return typeof e.iconPath=="string"||k.isUri(e.iconPath)?this.getIconPath(e.iconPath):this.getIconPath(e.iconPath.light)}getDarkIconPath(e){if(e.iconPath&&!(e.iconPath instanceof Es)&&e.iconPath.dark)return this.getIconPath(e.iconPath.dark)}getIconPath(e){return k.isUri(e)?e:k.file(e)}addNodeToCache(e,t){this.elements.set(t.item.handle,e),this.nodes.set(e,t)}updateNodeCache(e,t,i,n){this.elements.delete(t.item.handle),this.nodes.delete(e),t.item.handle!==i.item.handle&&this.elements.delete(i.item.handle),this.addNodeToCache(e,t);const s=this.getChildrenNodes(n)||[],o=s.filter(a=>a.item.handle===i.item.handle)[0];o&&s.splice(s.indexOf(o),1,t)}addNodeToParentCache(e,t){t?(t.children||(t.children=[]),t.children.push(e)):(this.roots||(this.roots=[]),this.roots.push(e))}clearChildren(e){if(e){const t=this.nodes.get(e);if(t){if(t.children)for(const i of t.children){const n=this.elements.get(i.item.handle);n&&this.clear(n)}t.children=void 0}}else this.clearAll()}clear(e){const t=this.nodes.get(e);if(t){if(t.children)for(const i of t.children){const n=this.elements.get(i.item.handle);n&&this.clear(n)}this.nodes.delete(e),this.elements.delete(t.item.handle),t.dispose()}}clearAll(){this.roots=void 0,this.elements.clear(),this.nodes.forEach(e=>e.dispose()),this.nodes.clear()}dispose(){this._refreshCancellationSource.dispose(),this.clearAll(),this.proxy.$disposeTree(this.viewId)}};mi(rg,"LABEL_HANDLE_PREFIX","0"),mi(rg,"ID_HANDLE_PREFIX","1");let OL=rg;class tI{constructor(e){this.handles=new lc,this.handlers=new Map,this._proxy=e.getProxy(ce.MainThreadUrls)}registerUriHandler(e,t){const i=e.identifier;if(this.handles.has(i))throw new Error(`Protocol handler already registered for extension ${i}`);const n=tI.HandlePool++;return this.handles.add(i),this.handlers.set(n,t),this._proxy.$registerUriHandler(n,i,e.displayName||e.name),ot(()=>{this.handles.delete(i),this.handlers.delete(n),this._proxy.$unregisterUriHandler(n)})}$handleExternalUri(e,t){const i=this.handlers.get(e);if(!i)return Promise.resolve(void 0);try{i.handleUri(k.revive(t))}catch(n){en(n)}return Promise.resolve(void 0)}async createAppUri(e){return k.revive(await this._proxy.$createAppUri(e))}}tI.HandlePool=0;const j5=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,bpe=/^-(\d{4})(\d{2})(\d{2})$/;function Spe(r){return r=r.trim(),r==="*"||j5.test(r)}function B5(r){if(!Spe(r))return null;if(r=r.trim(),r==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};const e=r.match(j5);return e?{hasCaret:e[1]==="^",hasGreaterEquals:e[1]===">=",majorBase:e[2]==="x"?0:parseInt(e[2],10),majorMustEqual:e[2]!=="x",minorBase:e[4]==="x"?0:parseInt(e[4],10),minorMustEqual:e[4]!=="x",patchBase:e[6]==="x"?0:parseInt(e[6],10),patchMustEqual:e[6]!=="x",preRelease:e[8]||null}:null}function U5(r){if(!r)return null;const e=r.majorBase,t=r.majorMustEqual,i=r.minorBase;let n=r.minorMustEqual;const s=r.patchBase;let o=r.patchMustEqual;r.hasCaret&&(e===0||(n=!1),o=!1);let a=0;if(r.preRelease){const c=bpe.exec(r.preRelease);if(c){const[,d,l,u]=c;a=Date.UTC(Number(d),Number(l)-1,Number(u))}}return{majorBase:e,majorMustEqual:t,minorBase:i,minorMustEqual:n,patchBase:s,patchMustEqual:o,isMinimum:r.hasGreaterEquals,notBefore:a}}class Cpe{constructor(){this.buffers=[]}add(e){let t=this.buffers.indexOf(e);return t<0&&(t=this.buffers.length,this.buffers.push(e)),t}}function V5(r,e){if(e.serializeBuffersForPostMessage){const t=new Cpe,n=JSON.stringify(r,(o,a)=>{if(a instanceof ArrayBuffer)return{$$vscode_array_buffer_reference$$:!0,index:t.add(a)};if(ArrayBuffer.isView(a)){const c=Epe(a);if(c)return{$$vscode_array_buffer_reference$$:!0,index:t.add(a.buffer),view:{type:c,byteLength:a.byteLength,byteOffset:a.byteOffset}}}return a}),s=t.buffers.map(o=>{const a=new Uint8Array(o);return De.wrap(a)});return{message:n,buffers:s}}else return{message:JSON.stringify(r),buffers:[]}}function Epe(r){switch(r.constructor.name){case"Int8Array":return 1;case"Uint8Array":return 2;case"Uint8ClampedArray":return 3;case"Int16Array":return 4;case"Uint16Array":return 5;case"Int32Array":return 6;case"Uint32Array":return 7;case"Float32Array":return 8;case"Float64Array":return 9;case"BigInt64Array":return 10;case"BigUint64Array":return 11}}function q5(r,e){const t=e.map(s=>{const o=new ArrayBuffer(s.byteLength);return new Uint8Array(o).set(s.buffer),o}),i=e.length?(s,o)=>{if(o&&typeof o=="object"&&o.$$vscode_array_buffer_reference$$){const a=o,{index:c}=a,d=t[c];if(a.view)switch(a.view.type){case 1:return new Int8Array(d,a.view.byteOffset,a.view.byteLength/Int8Array.BYTES_PER_ELEMENT);case 2:return new Uint8Array(d,a.view.byteOffset,a.view.byteLength/Uint8Array.BYTES_PER_ELEMENT);case 3:return new Uint8ClampedArray(d,a.view.byteOffset,a.view.byteLength/Uint8ClampedArray.BYTES_PER_ELEMENT);case 4:return new Int16Array(d,a.view.byteOffset,a.view.byteLength/Int16Array.BYTES_PER_ELEMENT);case 5:return new Uint16Array(d,a.view.byteOffset,a.view.byteLength/Uint16Array.BYTES_PER_ELEMENT);case 6:return new Int32Array(d,a.view.byteOffset,a.view.byteLength/Int32Array.BYTES_PER_ELEMENT);case 7:return new Uint32Array(d,a.view.byteOffset,a.view.byteLength/Uint32Array.BYTES_PER_ELEMENT);case 8:return new Float32Array(d,a.view.byteOffset,a.view.byteLength/Float32Array.BYTES_PER_ELEMENT);case 9:return new Float64Array(d,a.view.byteOffset,a.view.byteLength/Float64Array.BYTES_PER_ELEMENT);case 10:return new BigInt64Array(d,a.view.byteOffset,a.view.byteLength/BigInt64Array.BYTES_PER_ELEMENT);case 11:return new BigUint64Array(d,a.view.byteOffset,a.view.byteLength/BigUint64Array.BYTES_PER_ELEMENT);default:throw new Error("Unknown array buffer view type")}return d}return o}:void 0;return{message:JSON.parse(r,i),arrayBuffers:t}}const G5="vscode-cdn.net",xpe=`vscode-resource.${G5}`,NL=`'self' https://*.${G5}`;function ky(r,e){return r.scheme===pe.http||r.scheme===pe.https?r:(e&&e.authority&&e.isRemote&&r.scheme===pe.file&&(r=k.from({scheme:pe.vscodeRemote,authority:e.authority,path:r.path})),k.from({scheme:pe.https,authority:`${r.scheme}+${Dpe(r.authority)}.${xpe}`,path:r.path,fragment:r.fragment,query:r.query}))}function Dpe(r){return r.replace(/./g,e=>{const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57?e:"-"+t.toString(16).padStart(4,"0")})}function eLe(r){return r.replace(/-([0-9a-f]{4})/g,(e,t)=>String.fromCharCode(parseInt(t,16)))}var Ep,xp,HS,jS,BS,Uc,ty,Dp,iy,ny,US,ry,sy;class kpe{constructor(e,t,i,n,s,o,a){Ep.set(this,void 0),xp.set(this,void 0),HS.set(this,void 0),jS.set(this,void 0),BS.set(this,void 0),Uc.set(this,void 0),ty.set(this,""),Dp.set(this,void 0),iy.set(this,!1),ny.set(this,!1),US.set(this,void 0),ry.set(this,void 0),this._onMessageEmitter=new A,this.onDidReceiveMessage=this._onMessageEmitter.event,sy.set(this,new A),this._onDidDispose=V(this,sy,"f").event,rt(this,Ep,e,"f"),rt(this,xp,t,"f"),rt(this,Dp,i,"f"),rt(this,jS,n,"f"),rt(this,BS,s,"f"),rt(this,Uc,o,"f"),rt(this,US,Em(o),"f"),rt(this,ry,Tpe(o),"f"),rt(this,HS,a,"f")}dispose(){rt(this,iy,!0,"f"),V(this,sy,"f").fire(),V(this,sy,"f").dispose(),this._onMessageEmitter.dispose()}asWebviewUri(e){return rt(this,ny,!0,"f"),ky(e,V(this,jS,"f"))}get cspSource(){const e=V(this,Uc,"f").extensionLocation;if(e.scheme===pe.https||e.scheme===pe.http){let t=e.toString();return t.endsWith("/")||(t+="/"),t+" "+NL}return NL}get html(){return this.assertNotDisposed(),V(this,ty,"f")}set html(e){this.assertNotDisposed(),V(this,ty,"f")!==e&&(rt(this,ty,e,"f"),V(this,ry,"f")&&!V(this,ny,"f")&&/(["'])vscode-resource:([^\s'"]+?)(["'])/i.test(e)&&(rt(this,ny,!0,"f"),V(this,HS,"f").report("Webview vscode-resource: uris",V(this,Uc,"f"),"Please migrate to use the 'webview.asWebviewUri' api instead: https://aka.ms/vscode-webview-use-aswebviewuri")),V(this,xp,"f").$setHtml(V(this,Ep,"f"),this.rewriteOldResourceUrlsIfNeeded(e)))}get options(){return this.assertNotDisposed(),V(this,Dp,"f")}set options(e){this.assertNotDisposed(),xa(V(this,Dp,"f"),e)||V(this,xp,"f").$setOptions(V(this,Ep,"f"),z5(V(this,Uc,"f"),V(this,BS,"f"),e)),rt(this,Dp,e,"f")}async postMessage(e){if(V(this,iy,"f"))return!1;const t=V5(e,{serializeBuffersForPostMessage:V(this,US,"f")});return V(this,xp,"f").$postMessage(V(this,Ep,"f"),t.message,...t.buffers)}assertNotDisposed(){if(V(this,iy,"f"))throw new Error("Webview is disposed")}rewriteOldResourceUrlsIfNeeded(e){var n;if(!V(this,ry,"f"))return e;const t=((n=V(this,Uc,"f").extensionLocation)==null?void 0:n.scheme)===pe.vscodeRemote,i=V(this,Uc,"f").extensionLocation.scheme===pe.vscodeRemote?V(this,Uc,"f").extensionLocation.authority:void 0;return e.replace(/(["'])(?:vscode-resource):(\/\/([^\s\/'"]+?)(?=\/))?([^\s'"]+?)(["'])/gi,(s,o,a,c,d,l)=>{const u=k.from({scheme:c||"file",path:decodeURIComponent(d)}),h=ky(u,{isRemote:t,authority:i}).toString();return`${o}${h}${l}`}).replace(/(["'])(?:vscode-webview-resource):(\/\/[^\s\/'"]+\/([^\s\/'"]+?)(?=\/))?([^\s'"]+?)(["'])/gi,(s,o,a,c,d,l)=>{const u=k.from({scheme:c||"file",path:decodeURIComponent(d)}),h=ky(u,{isRemote:t,authority:i}).toString();return`${o}${h}${l}`})}}Ep=new WeakMap,xp=new WeakMap,HS=new WeakMap,jS=new WeakMap,BS=new WeakMap,Uc=new WeakMap,ty=new WeakMap,Dp=new WeakMap,iy=new WeakMap,ny=new WeakMap,US=new WeakMap,ry=new WeakMap,sy=new WeakMap;function Em(r){try{const e=U5(B5(r.engines.vscode));return!!e&&e.majorBase>=1&&e.minorBase>=57}catch{return!1}}function Tpe(r){try{const e=U5(B5(r.engines.vscode));return e?e.majorBase<1||e.majorBase===1&&e.minorBase<60:!1}catch{return!1}}class Ipe{constructor(e,t,i,n,s){this.remoteInfo=t,this.workspace=i,this._logService=n,this._deprecationService=s,this._webviews=new Map,this._webviewProxy=e.getProxy(ce.MainThreadWebviews)}$onMessage(e,t,i){const n=this.getWebview(e);if(n){const{message:s}=q5(t,i.value);n._onMessageEmitter.fire(s)}}$onMissingCsp(e,t){this._logService.warn(`${t} created a webview without a content security policy: https://aka.ms/vscode-webview-missing-csp`)}createNewWebview(e,t,i){const n=new kpe(e,this._webviewProxy,Rpe(t),this.remoteInfo,this.workspace,i,this._deprecationService);return this._webviews.set(e,n),n._onDidDispose(()=>{this._webviews.delete(e)}),n}deleteWebview(e){this._webviews.delete(e)}getWebview(e){return this._webviews.get(e)}}function Ox(r){return{id:r.identifier,location:r.extensionLocation}}function z5(r,e,t){return{enableCommandUris:t.enableCommandUris,enableScripts:t.enableScripts,enableForms:t.enableForms,portMapping:t.portMapping,localResourceRoots:t.localResourceRoots||Ppe(r,e)}}function Rpe(r){var e;return{enableCommandUris:r.enableCommandUris,enableScripts:r.enableScripts,enableForms:r.enableForms,portMapping:r.portMapping,localResourceRoots:(e=r.localResourceRoots)==null?void 0:e.map(t=>k.from(t))}}function Ppe(r,e){return[...((e==null?void 0:e.getWorkspaceFolders())||[]).map(t=>t.uri),r.extensionLocation]}let Nx=class K5{getState(e){const t=this._state;return{get focused(){return t.focused},get active(){return He(e,"windowActivity"),t.active}}}constructor(e){this._onDidChangeWindowState=new A,this.onDidChangeWindowState=this._onDidChangeWindowState.event,this._state=K5.InitialState,this._proxy=e.getProxy(ce.MainThreadWindow),this._proxy.$getInitialState().then(({isFocused:t,isActive:i})=>{this.onDidChangeWindowProperty("focused",t),this.onDidChangeWindowProperty("active",i)})}$onDidChangeWindowFocus(e){this.onDidChangeWindowProperty("focused",e)}$onDidChangeWindowActive(e){this.onDidChangeWindowProperty("active",e)}onDidChangeWindowProperty(e,t){t!==this._state[e]&&(this._state={...this._state,[e]:t},this._onDidChangeWindowState.fire(this._state))}openUri(e,t){let i;if(typeof e=="string"){i=e;try{e=k.parse(e)}catch{return Promise.reject(`Invalid uri - '${e}'`)}}return ga(e.scheme)?Promise.reject("Invalid scheme - cannot be empty"):e.scheme===pe.command?Promise.reject(`Invalid scheme '${e.scheme}'`):this._proxy.$openUri(e,i,t)}async asExternalUri(e,t){if(ga(e.scheme))return Promise.reject("Invalid scheme - cannot be empty");const i=await this._proxy.$asExternalUri(e,t);return k.from(i)}};Nx.InitialState={focused:!0,active:!0};Nx=T([v(0,Ii)],Nx);const Q5=re("IExtHostWindow");class Ape{constructor(e,t,i){this._proxy=e,this._editors=t,this._remoteInfo=i,this._handlePool=0,this._disposables=new me,this._insets=new Map,this._disposables.add(t.onDidChangeVisibleTextEditors(()=>{const n=t.getVisibleTextEditors();for(const s of this._insets.values())n.indexOf(s.editor)<0&&s.inset.dispose()}))}dispose(){this._insets.forEach(e=>e.inset.dispose()),this._disposables.dispose()}createWebviewEditorInset(e,t,i,n,s){let o;for(const g of this._editors.getVisibleTextEditors(!0))if(g.value===e){o=g;break}if(!o)throw new Error("not a visible editor");const a=this,c=this._handlePool++,d=new A,l=new A,u=new class{constructor(){this._html="",this._options=Object.create(null)}asWebviewUri(g){return ky(g,a._remoteInfo)}get cspSource(){return NL}set options(g){this._options=g,a._proxy.$setOptions(c,g)}get options(){return this._options}set html(g){this._html=g,a._proxy.$setHtml(c,g)}get html(){return this._html}get onDidReceiveMessage(){return d.event}postMessage(g){return a._proxy.$postMessage(c,g)}},h=new class{constructor(){this.editor=e,this.line=t,this.height=i,this.webview=u,this.onDidDispose=l.event}dispose(){a._insets.has(c)&&(a._insets.delete(c),a._proxy.$disposeEditorInset(c),l.fire(),l.dispose(),d.dispose())}};return this._proxy.$createEditorInset(c,o.id,o.value.document.uri,t+1,i,n||{},s.identifier,s.extensionLocation),this._insets.set(c,{editor:e,inset:h,onDidReceiveMessage:d}),h}$onDidDispose(e){const t=this._insets.get(e);t&&t.inset.dispose()}$onDidReceiveMessage(e,t){const i=this._insets.get(e);i==null||i.onDidReceiveMessage.fire(t)}}class Mpe{constructor(e){this._handlePool=0,this._proxy=e.getProxy(ce.MainThreadLabelService)}$registerResourceLabelFormatter(e){const t=this._handlePool++;return this._proxy.$registerResourceLabelFormatter(t,e),ot(()=>{this._proxy.$unregisterResourceLabelFormatter(t)})}}let dw=class VS{constructor(e,t){this._logService=t,this._provider=new Map,this._proxy=e.getProxy(ce.MainThreadDecorations)}registerFileDecorationProvider(e,t){const i=VS._handlePool++;this._provider.set(i,{provider:e,extensionDescription:t}),this._proxy.$registerDecorationProvider(i,t.identifier.value);const n=e.onDidChangeFileDecorations&&e.onDidChangeFileDecorations(s=>{if(!s){this._proxy.$onDidChange(i,null);return}const o=bg(s);if(o.length<=VS._maxEventSize){this._proxy.$onDidChange(i,o);return}this._logService.warn("[Decorations] CAPPING events from decorations provider",t.identifier.value,o.length);const a=o.map(l=>({uri:l,rank:ZY(l.path,"/")})),c=yk(a,(l,u)=>l.rank-u.rank||Sa(l.uri.path,u.uri.path)),d=[];e:for(const l of c){let u;for(const h of l){const g=_h(h.uri.path);if(u!==g&&(u=g,d.push(h.uri)>=VS._maxEventSize))break e}}this._proxy.$onDidChange(i,d)});return new Yt(()=>{n==null||n.dispose(),this._proxy.$unregisterDecorationProvider(i),this._provider.delete(i)})}async $provideDecorations(e,t,i){if(!this._provider.has(e))return Object.create(null);const n=Object.create(null),{provider:s,extensionDescription:o}=this._provider.get(e);return await Promise.all(t.map(async a=>{try{const{uri:c,id:d}=a,l=await Promise.resolve(s.provideFileDecoration(k.revive(c),i));if(!l)return;try{sE.validate(l),l.badge&&typeof l.badge!="string"&&He(o,"codiconDecoration"),n[d]=[l.propagate,l.tooltip,l.badge,l.color]}catch(u){this._logService.warn(`INVALID decoration from extension '${o}': ${u}`)}}catch(c){this._logService.error(c)}})),n}};dw._handlePool=0;dw._maxEventSize=250;dw=T([v(0,Ii),v(1,ze)],dw);const Y5=re("IExtHostDecorations"),iI=re("IExtHostApiDeprecationService");let $L=class{constructor(e,t){this._extHostLogService=t,this._reportedUsages=new Set,this._telemetryShape=e.getProxy(ce.MainThreadTelemetry)}report(e,t,i){const n=this.getUsageKey(e,t);this._reportedUsages.has(n)||(this._reportedUsages.add(n),t.isUnderDevelopment&&this._extHostLogService.warn(`[Deprecation Warning] '${e}' is deprecated. ${i}`),this._telemetryShape.$publicLog2("extHostDeprecatedApiUsage",{extensionId:t.identifier.value,apiId:e}))}getUsageKey(e,t){return`${e}-${t.identifier.value}`}};$L=T([v(0,Ii),v(1,ze)],$L);var qS,$x;(function(r){function e(i){if(i!=null)return i}r.from=e;function t(i){if(i!=null)return i}r.to=t})($x||($x={}));var Wx;(function(r){function e(i){if(i!=null)return i}r.from=e;function t(i){if(i!=null)return i}r.to=t})(Wx||(Wx={}));var WL;(function(r){function e(i){if(i!=null)return i}r.from=e;function t(i){if(i!=null)return i}r.to=t})(WL||(WL={}));var Ty;(function(r){function e(n){if(n){const s=n;return s&&!!s.process}else return!1}r.is=e;function t(n){if(n==null)return;const s={process:n.process,args:n.args};return n.options&&(s.options=WL.from(n.options)),s}r.from=t;function i(n){if(n!=null)return new gf(n.process,n.args,n.options)}r.to=i})(Ty||(Ty={}));var HL;(function(r){function e(i){if(i!=null)return i}r.from=e;function t(i){if(i!=null)return i}r.to=t})(HL||(HL={}));var Iy;(function(r){function e(n){if(n){const s=n;return s&&(!!s.commandLine||!!s.command)}else return!1}r.is=e;function t(n){if(n==null)return;const s={};return n.commandLine!==void 0?s.commandLine=n.commandLine:(s.command=n.command,s.args=n.args),n.options&&(s.options=HL.from(n.options)),s}r.from=t;function i(n){if(!(n==null||n.command===void 0&&n.commandLine===void 0))return n.commandLine?new su(n.commandLine,n.options):new su(n.command,n.args?n.args:[],n.options)}r.to=i})(Iy||(Iy={}));var pd;(function(r){function e(n){if(n){const s=n;return s&&s.customExecution==="customExecution"}else return!1}r.is=e;function t(n){return{customExecution:"customExecution"}}r.from=t;function i(n,s){return s.get(n)}r.to=i})(pd||(pd={}));var jL;(function(r){function e(t){if(t!=null)return{_id:t.id,isDefault:t.isDefault}}r.from=e})(jL||(jL={}));var El;(function(r){function e(n,s){if(n==null)return[];const o=[];for(const a of n){const c=t(a,s);c&&o.push(c)}return o}r.fromMany=e;function t(n,s){if(n==null)return;let o;n.execution instanceof gf?o=Ty.from(n.execution):n.execution instanceof su?o=Iy.from(n.execution):n.execution&&n.execution instanceof Mk&&(o=pd.from(n.execution));const a=$x.from(n.definition);let c;return n.scope?typeof n.scope=="number"?c=n.scope:c=n.scope.uri:c=mf.Workspace,!a||!c?void 0:{_id:n._id,definition:a,name:n.name,source:{extensionId:s.identifier.value,label:n.source,scope:c},execution:o,isBackground:n.isBackground,group:jL.from(n.group),presentationOptions:Wx.from(n.presentationOptions),problemMatchers:n.problemMatchers,hasDefinedMatchers:n.hasDefinedMatchers,runOptions:n.runOptions?n.runOptions:{reevaluateOnRerun:!0},detail:n.detail}}r.from=t;async function i(n,s,o){if(n==null)return;let a;Ty.is(n.execution)?a=Ty.to(n.execution):Iy.is(n.execution)?a=Iy.to(n.execution):pd.is(n.execution)&&(a=pd.to(n._id,o));const c=$x.to(n.definition);let d;if(n.source&&(n.source.scope!==void 0?typeof n.source.scope=="number"?d=n.source.scope:d=await s.resolveWorkspaceFolder(k.revive(n.source.scope)):d=mf.Workspace),!c||!d)return;const l=new ou(c,d,n.name,n.source.label,a,n.problemMatchers);return n.isBackground!==void 0&&(l.isBackground=n.isBackground),n.group!==void 0&&(l.group=Cd.from(n.group._id),l.group&&n.group.isDefault&&(l.group=new Cd(l.group.id,l.group.label),n.group.isDefault===!0&&(l.group.isDefault=n.group.isDefault))),n.presentationOptions&&(l.presentationOptions=Wx.to(n.presentationOptions)),n._id&&(l._id=n._id),n.detail&&(l.detail=n.detail),l}r.to=i})(El||(El={}));var BL;(function(r){function e(i){return i}r.from=e;function t(i){if(i)return Object.assign(Object.create(null),i)}r.to=t})(BL||(BL={}));class mU{constructor(e,t,i){this._id=t,this._task=i,qS.set(this,void 0),rt(this,qS,e,"f")}get task(){return this._task}terminate(){V(this,qS,"f").terminateTask(this)}fireDidStartProcess(e){}fireDidEndProcess(e){}}qS=new WeakMap;let UL=class{constructor(e,t,i,n,s,o,a,c){this._onDidExecuteTask=new A,this._onDidTerminateTask=new A,this._onDidTaskProcessStarted=new A,this._onDidTaskProcessEnded=new A,this._proxy=e.getProxy(ce.MainThreadTask),this._workspaceProvider=i,this._editorService=n,this._configurationService=s,this._terminalService=o,this._handleCounter=0,this._handlers=new Map,this._taskExecutions=new Map,this._taskExecutionPromises=new Map,this._providedCustomExecutions2=new Map,this._notProvidedCustomExecutions=new Set,this._activeCustomExecutions2=new Map,this._logService=a,this._deprecationService=c,this._proxy.$registerSupportedExecutions(!0)}registerTaskProvider(e,t,i){if(!i)return new Yt(()=>{});const n=this.nextHandle();return this._handlers.set(n,{type:t,provider:i,extension:e}),this._proxy.$registerTaskProvider(n,t),new Yt(()=>{this._handlers.delete(n),this._proxy.$unregisterTaskProvider(n)})}registerTaskSystem(e,t){this._proxy.$registerTaskSystem(e,t)}fetchTasks(e){return this._proxy.$fetchTasks(BL.from(e)).then(async t=>{const i=[];for(const n of t){const s=await El.to(n,this._workspaceProvider,this._providedCustomExecutions2);s&&i.push(s)}return i})}get taskExecutions(){const e=[];return this._taskExecutions.forEach(t=>e.push(t)),e}terminateTask(e){if(!(e instanceof mU))throw new Error("No valid task execution provided");return this._proxy.$terminateTask(e._id)}get onDidStartTask(){return this._onDidExecuteTask.event}async $onDidStartTask(e,t,i){const n=this._providedCustomExecutions2.get(e.id);n&&(this._activeCustomExecutions2.set(e.id,n),this._terminalService.attachPtyToTerminal(t,await n.callback(i))),this._lastStartedTask=e.id,this._onDidExecuteTask.fire({execution:await this.getTaskExecution(e)})}get onDidEndTask(){return this._onDidTerminateTask.event}async $OnDidEndTask(e){const t=await this.getTaskExecution(e);this._taskExecutionPromises.delete(e.id),this._taskExecutions.delete(e.id),this.customExecutionComplete(e),this._onDidTerminateTask.fire({execution:t})}get onDidStartTaskProcess(){return this._onDidTaskProcessStarted.event}async $onDidStartTaskProcess(e){const t=await this.getTaskExecution(e.id);this._onDidTaskProcessStarted.fire({execution:t,processId:e.processId})}get onDidEndTaskProcess(){return this._onDidTaskProcessEnded.event}async $onDidEndTaskProcess(e){const t=await this.getTaskExecution(e.id);this._onDidTaskProcessEnded.fire({execution:t,exitCode:e.exitCode})}$provideTasks(e,t){const i=this._handlers.get(e);if(!i)return Promise.reject(new Error("no handler found"));const n=[],s=Nr(()=>i.provider.provideTasks(_t.None)).then(o=>this.provideTasksInternal(t,n,i,o));return new Promise(o=>{s.then(a=>{Promise.all(n).then(()=>{o(a)})})})}async $resolveTask(e,t){const i=this._handlers.get(e);if(!i)return Promise.reject(new Error("no handler found"));if(t.definition.type!==i.type)throw new Error(`Unexpected: Task of type [${t.definition.type}] cannot be resolved by provider of type [${i.type}].`);const n=await El.to(t,this._workspaceProvider,this._providedCustomExecutions2);if(!n)throw new Error("Unexpected: Task cannot be resolved.");const s=await i.provider.resolveTask(n,_t.None);if(!s)return;this.checkDeprecation(s,i);const o=El.from(s,i.extension);if(!o)throw new Error("Unexpected: Task cannot be resolved.");if(s.definition!==n.definition)throw new Error("Unexpected: The resolved task definition must be the same object as the original task definition. The task definition cannot be changed.");return pd.is(o.execution)&&await this.addCustomExecution(o,s,!0),await this.resolveTaskInternal(o)}nextHandle(){return this._handleCounter++}async addCustomExecution(e,t,i){const n=await this._proxy.$createTaskId(e);!i&&!this._providedCustomExecutions2.has(n)&&(this._notProvidedCustomExecutions.add(n),this._activeCustomExecutions2.set(n,t.execution)),this._providedCustomExecutions2.set(n,t.execution)}async getTaskExecution(e,t){if(typeof e=="string"){const s=this._taskExecutionPromises.get(e);if(!s)throw new rc("Unexpected: The specified task is missing an execution");return s}const i=this._taskExecutionPromises.get(e.id);if(i)return i;const n=new Promise((s,o)=>{function a(c,d,l){l?s(new mU(c,d.id,l)):o("Unexpected: Task does not exist.")}t?a(this,e,t):El.to(e.task,this._workspaceProvider,this._providedCustomExecutions2).then(c=>a(this,e,c))});return this._taskExecutionPromises.set(e.id,n),n.then(s=>(this._taskExecutions.set(e.id,s),s),s=>Promise.reject(s))}checkDeprecation(e,t){e._deprecated&&this._deprecationService.report("Task.constructor",t.extension,"Use the Task constructor that takes a `scope` instead.")}customExecutionComplete(e){this._activeCustomExecutions2.get(e.id)&&this._activeCustomExecutions2.delete(e.id),this._notProvidedCustomExecutions.has(e.id)&&this._lastStartedTask!==e.id&&(this._providedCustomExecutions2.delete(e.id),this._notProvidedCustomExecutions.delete(e.id));const i=this._notProvidedCustomExecutions.values();let n=i.next();for(;!n.done;)!this._activeCustomExecutions2.has(n.value)&&this._lastStartedTask!==n.value&&(this._providedCustomExecutions2.delete(n.value),this._notProvidedCustomExecutions.delete(n.value)),n=i.next()}};UL=T([v(0,Ii),v(1,Gr),v(2,$d),v(3,gb),v(4,Wd),v(5,pb),v(6,ze),v(7,iI)],UL);let VL=class extends UL{constructor(e,t,i,n,s,o,a,c){super(e,t,i,n,s,o,a,c),this.registerTaskSystem(pe.vscodeRemote,{scheme:pe.vscodeRemote,authority:"",platform:e7(0)})}async executeTask(e,t){if(!t.execution)throw new Error("Tasks to execute must include an execution");const i=El.from(t,e);if(i===void 0)throw new Error("Task is not valid");if(pd.is(i.execution))await this.addCustomExecution(i,t,!1);else throw new al;const n=await this.getTaskExecution(await this._proxy.$getTaskExecution(i),t);return this._proxy.$executeTask(i).catch(s=>{throw new Error(s)}),n}provideTasksInternal(e,t,i,n){const s=[];if(n)for(const o of n){this.checkDeprecation(o,i),(!o.definition||!e[o.definition.type])&&this._logService.warn(`The task [${o.source}, ${o.name}] uses an undefined task type. The task will be ignored in the future.`);const a=El.from(o,i.extension);a&&pd.is(a.execution)?(s.push(a),t.push(this.addCustomExecution(a,o,!0))):this._logService.warn("Only custom execution tasks supported.")}return{tasks:s,extension:i.extension}}async resolveTaskInternal(e){if(pd.is(e.execution))return e;this._logService.warn("Only custom execution tasks supported.")}async $resolveVariables(e,t){return{process:void 0,variables:Object.create(null)}}async $jsonTasksSupported(){return!1}async $findExecutable(e,t,i){}};VL=T([v(0,Ii),v(1,Gr),v(2,$d),v(3,gb),v(4,Wd),v(5,pb),v(6,ze),v(7,iI)],VL);const X5=re("IExtHostTask"),mb=re("IExtHostEditorTabs");class vU{constructor(e,t,i){this._activeTabIdGetter=i,this._parentGroup=t,this.acceptDtoUpdate(e)}get apiObject(){if(!this._apiObject){const e=this,t={get isActive(){return e._dto.id===e._activeTabIdGetter()},get label(){return e._dto.label},get input(){return e._input},get isDirty(){return e._dto.isDirty},get isPinned(){return e._dto.isPinned},get isPreview(){return e._dto.isPreview},get group(){return e._parentGroup.apiObject}};this._apiObject=Object.freeze(t)}return this._apiObject}get tabId(){return this._dto.id}acceptDtoUpdate(e){this._dto=e,this._input=this._initInput()}_initInput(){switch(this._dto.input.kind){case 1:return new Ok(k.revive(this._dto.input.uri));case 2:return new Nk(k.revive(this._dto.input.original),k.revive(this._dto.input.modified));case 3:return new yz(k.revive(this._dto.input.base),k.revive(this._dto.input.input1),k.revive(this._dto.input.input2),k.revive(this._dto.input.result));case 6:return new $k(k.revive(this._dto.input.uri),this._dto.input.viewType);case 7:return new P1(this._dto.input.viewType);case 4:return new Wk(k.revive(this._dto.input.uri),this._dto.input.notebookType);case 5:return new Hk(k.revive(this._dto.input.original),k.revive(this._dto.input.modified),this._dto.input.notebookType);case 8:return new A1;case 9:return new _z(k.revive(this._dto.input.uri),k.revive(this._dto.input.inputBoxUri));default:return}}}class Lpe{constructor(e,t){this._tabs=[],this._activeTabId="",this._dto=e,this._activeGroupIdGetter=t;for(const i of e.tabs)i.isActive&&(this._activeTabId=i.id),this._tabs.push(new vU(i,this,()=>this.activeTabId()))}get apiObject(){if(!this._apiObject){const e=this,t={get isActive(){return e._dto.groupId===e._activeGroupIdGetter()},get viewColumn(){return Hn.to(e._dto.viewColumn)},get activeTab(){var i;return(i=e._tabs.find(n=>n.tabId===e._activeTabId))==null?void 0:i.apiObject},get tabs(){return Object.freeze(e._tabs.map(i=>i.apiObject))}};this._apiObject=Object.freeze(t)}return this._apiObject}get groupId(){return this._dto.groupId}get tabs(){return this._tabs}acceptGroupDtoUpdate(e){this._dto=e}acceptTabOperation(e){if(e.kind===0){const i=new vU(e.tabDto,this,()=>this.activeTabId());return this._tabs.splice(e.index,0,i),e.tabDto.isActive&&(this._activeTabId=i.tabId),i}else if(e.kind===1){const i=this._tabs.splice(e.index,1)[0];if(!i)throw new Error(`Tab close updated received for index ${e.index} which does not exist`);return i.tabId===this._activeTabId&&(this._activeTabId=""),i}else if(e.kind===3){if(e.oldIndex===void 0)throw new Error("Invalid old index on move IPC");const i=this._tabs.splice(e.oldIndex,1)[0];if(!i)throw new Error(`Tab move updated received for index ${e.oldIndex} which does not exist`);return this._tabs.splice(e.index,0,i),i}const t=this._tabs.find(i=>i.tabId===e.tabDto.id);if(!t)throw new Error("INVALID tab");return e.tabDto.isActive?this._activeTabId=e.tabDto.id:this._activeTabId===e.tabDto.id&&!e.tabDto.isActive&&(this._activeTabId=""),t.acceptDtoUpdate(e.tabDto),t}activeTabId(){return this._activeTabId}}let qL=class{constructor(e){this._onDidChangeTabs=new A,this._onDidChangeTabGroups=new A,this._extHostTabGroups=[],this._proxy=e.getProxy(ce.MainThreadEditorTabs)}get tabGroups(){if(!this._apiObject){const e=this,t={onDidChangeTabGroups:e._onDidChangeTabGroups.event,onDidChangeTabs:e._onDidChangeTabs.event,get all(){return Object.freeze(e._extHostTabGroups.map(i=>i.apiObject))},get activeTabGroup(){var s;const i=e._activeGroupId;return Mi((s=e._extHostTabGroups.find(o=>o.groupId===i))==null?void 0:s.apiObject)},close:async(i,n)=>{const s=Array.isArray(i)?i:[i];return s.length?Fpe(s[0])?this._closeGroups(s,n):this._closeTabs(s,n):!0}};this._apiObject=Object.freeze(t)}return this._apiObject}$acceptEditorTabModel(e){var d;const t=new Set(this._extHostTabGroups.map(l=>l.groupId)),i=new Set(e.map(l=>l.groupId)),n=i1(t,i),s=this._extHostTabGroups.filter(l=>n.removed.includes(l.groupId)).map(l=>l.apiObject),o=[],a=[];this._extHostTabGroups=e.map(l=>{const u=new Lpe(l,()=>this._activeGroupId);return n.added.includes(u.groupId)?o.push(u.apiObject):a.push(u.apiObject),u});const c=Mi((d=e.find(l=>l.isActive===!0))==null?void 0:d.groupId);c!==void 0&&this._activeGroupId!==c&&(this._activeGroupId=c),this._onDidChangeTabGroups.fire(Object.freeze({opened:o,closed:s,changed:a}))}$acceptTabGroupUpdate(e){const t=this._extHostTabGroups.find(i=>i.groupId===e.groupId);if(!t)throw new Error("Update Group IPC call received before group creation.");t.acceptGroupDtoUpdate(e),e.isActive&&(this._activeGroupId=e.groupId),this._onDidChangeTabGroups.fire(Object.freeze({changed:[t.apiObject],opened:[],closed:[]}))}$acceptTabOperation(e){const t=this._extHostTabGroups.find(n=>n.groupId===e.groupId);if(!t)throw new Error("Update Tabs IPC call received before group creation.");const i=t.acceptTabOperation(e);switch(e.kind){case 0:this._onDidChangeTabs.fire(Object.freeze({opened:[i.apiObject],closed:[],changed:[]}));return;case 1:this._onDidChangeTabs.fire(Object.freeze({opened:[],closed:[i.apiObject],changed:[]}));return;case 3:case 2:this._onDidChangeTabs.fire(Object.freeze({opened:[],closed:[],changed:[i.apiObject]}));return}}_findExtHostTabFromApi(e){for(const t of this._extHostTabGroups)for(const i of t.tabs)if(i.apiObject===e)return i}_findExtHostTabGroupFromApi(e){return this._extHostTabGroups.find(t=>t.apiObject===e)}async _closeTabs(e,t){const i=[];for(const n of e){const s=this._findExtHostTabFromApi(n);if(!s)throw new Error("Tab close: Invalid tab not found!");i.push(s.tabId)}return this._proxy.$closeTab(i,t)}async _closeGroups(e,t){const i=[];for(const n of e){const s=this._findExtHostTabGroupFromApi(n);if(!s)throw new Error("Group close: Invalid group not found!");i.push(s.groupId)}return this._proxy.$closeGroup(i,t)}};qL=T([v(0,Ii)],qL);function Fpe(r){return r.tabs!==void 0}class J5{constructor(){this.pendingRequests=new Map,this.queue=[],this._onError=new A,this._onExit=new A,this.sequence=1}get onError(){return this._onError.event}get onExit(){return this._onExit.event}onMessage(e){this.messageCallback&&this._onError.fire(new Error("attempt to set more than one 'Message' callback")),this.messageCallback=e}onEvent(e){this.eventCallback&&this._onError.fire(new Error("attempt to set more than one 'Event' callback")),this.eventCallback=e}onRequest(e){this.requestCallback&&this._onError.fire(new Error("attempt to set more than one 'Request' callback")),this.requestCallback=e}sendResponse(e){e.seq>0?this._onError.fire(new Error(`attempt to send more than one response for command ${e.command}`)):this.internalSend("response",e)}sendRequest(e,t,i,n){const s={command:e};if(t&&Object.keys(t).length>0&&(s.arguments=t),this.internalSend("request",s),typeof n=="number"){const o=setTimeout(()=>{clearTimeout(o);const a=this.pendingRequests.get(s.seq);if(a){this.pendingRequests.delete(s.seq);const c={type:"response",seq:0,request_seq:s.seq,success:!1,command:e,message:p("timeout","Timeout after {0} ms for '{1}'",n,e)};a(c)}},n)}return i&&this.pendingRequests.set(s.seq,i),s.seq}acceptMessage(e){this.messageCallback?this.messageCallback(e):(this.queue.push(e),this.queue.length===1&&this.processQueue())}needsTaskBoundaryBetween(e,t){return e.type!=="event"||t.type!=="event"}async processQueue(){var t,i;let e;for(;this.queue.length;){if((!e||this.needsTaskBoundaryBetween(this.queue[0],e))&&await zs(0),e=this.queue.shift(),!e)return;switch(e.type){case"event":(t=this.eventCallback)==null||t.call(this,e);break;case"request":(i=this.requestCallback)==null||i.call(this,e);break;case"response":{const n=e,s=this.pendingRequests.get(n.request_seq);s&&(this.pendingRequests.delete(n.request_seq),s(n));break}}}}internalSend(e,t){t.type=e,t.seq=this.sequence++,this.sendMessage(t)}async cancelPendingRequests(){if(this.pendingRequests.size===0)return Promise.resolve();const e=new Map;this.pendingRequests.forEach((t,i)=>e.set(i,t)),await zs(500),e.forEach((t,i)=>{t({type:"response",seq:0,request_seq:i,success:!1,command:"canceled",message:"canceled"}),this.pendingRequests.delete(i)})}getPendingRequestIds(){return Array.from(this.pendingRequests.keys())}dispose(){this.queue=[]}}const Ope=/{([^}]+)}/g;function sLe(r,e,t){return r.replace(Ope,function(i,n){return e&&n.length>0&&n[0]!=="_"?i:t&&t.hasOwnProperty(n)?t[n]:i})}function oLe(r){const e={};for(const t of Object.keys(r))t.startsWith("!")||(e[t]=r[t]);return e}function Z5(r){return r.configuration.request==="attach"&&!e8(r)&&(!r.parentSession||Z5(r.parentSession))}function e8(r){let e=r.configuration.type;if(e)return e==="vslsShare"&&(e=r.configuration.adapterProxy.configuration.type),CP(e,"extensionhost")||CP(e,"pwa-extensionhost")?r:r.parentSession?e8(r.parentSession):void 0}function Npe(r){return r.type&&(r.label||r.program||r.runtime)}function $pe(r,e,t){let i,n=0;const s=/([^()\[\]{}<>\s+\-/%~#^;=|,`!]|\->)+/g;let o=null;for(;o=s.exec(r);){const a=o.index+1,c=a+o[0].length;if(a<=e&&c>=t){i=o[0],n=a;break}}if(i){const a=/\w+/g;let c=null;for(;(c=a.exec(i))&&!(c.index+1+n+c[0].length>=t););c&&(i=i.substring(0,a.lastIndex))}return i?{start:n,end:n+i.length-1}:{start:0,end:0}}async function aLe(r,e,t,i){if(r.evaluatableExpressionProvider.has(e)){const n=r.evaluatableExpressionProvider.ordered(e),s=fi(await Promise.all(n.map(async o=>{try{return await o.provideEvaluatableExpression(e,t,i??_t.None)}catch{return}})));if(s.length>0){let o=s[0].expression;const a=s[0].range;return o||(o=e.getLineContent(t.lineNumber).substring(a.startColumn-1,a.endColumn-1)),{range:a,matchingExpression:o}}}else{const n=e.getLineContent(t.lineNumber),{start:s,end:o}=$pe(n,t.column,t.column),a=n.substring(s-1,o);return{matchingExpression:a,range:new qe(t.lineNumber,s,t.lineNumber,s+a.length)}}return null}const Wpe=/^[a-zA-Z][a-zA-Z0-9\+\-\.]+:/;function Hpe(r){return!!(r&&r.match(Wpe))}function t8(r){if(typeof r.path=="string"&&!(typeof r.sourceReference=="number"&&r.sourceReference>0)){if(Hpe(r.path))return k.parse(r.path);if(Eg(r.path))return k.file(r.path)}return r.path}function i8(r){if(typeof r.path=="object"){const e=k.revive(r.path);if(e)return e.scheme===pe.file?e.fsPath:e.toString()}return r.path}function n8(r,e){const t=e?t8:i8,i=Gi(r);return s8(i,(n,s)=>{n&&s&&(s.path=t(s))}),i}function r8(r,e){const t=e?t8:i8,i=Gi(r);return s8(i,(n,s)=>{!n&&s&&(s.path=t(s))}),i}function s8(r,e){var t;switch(r.type){case"event":{const i=r;switch(i.event){case"output":e(!1,i.body.source);break;case"loadedSource":e(!1,i.body.source);break;case"breakpoint":e(!1,i.body.breakpoint.source);break}break}case"request":{const i=r;switch(i.command){case"setBreakpoints":e(!0,i.arguments.source);break;case"breakpointLocations":e(!0,i.arguments.source);break;case"source":e(!0,i.arguments.source);break;case"gotoTargets":e(!0,i.arguments.source);break;case"launchVSCode":i.arguments.args.forEach(n=>e(!1,n));break}break}case"response":{const i=r;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(n=>e(!1,n.source));break;case"loadedSources":i.body.sources.forEach(n=>e(!1,n));break;case"scopes":i.body.scopes.forEach(n=>e(!1,n.source));break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(n=>e(!1,n.source));break;case"setBreakpoints":i.body.breakpoints.forEach(n=>e(!1,n.source));break;case"disassemble":(t=i.body)==null||t.instructions.forEach(s=>e(!1,s.location));break}break}}}function cLe(r){return r.filter(e=>{var t;return!((t=e.presentation)!=null&&t.hidden)}).sort((e,t)=>e.presentation?t.presentation?e.presentation.group?t.presentation.group?e.presentation.group!==t.presentation.group?e.presentation.group.localeCompare(t.presentation.group):yU(e.presentation.order,t.presentation.order):-1:t.presentation.group?1:yU(e.presentation.order,t.presentation.order):-1:t.presentation?1:0)}function yU(r,e){return typeof r!="number"?typeof e!="number"?0:1:typeof e!="number"?-1:r-e}async function dLe(r,e){var i;const t=r.getValue("debug.saveBeforeStart",{overrideIdentifier:e.activeTextEditorLanguageId});if(t!=="none"&&(await e.saveAll(),t==="allEditorsInActiveGroup")){const n=e.activeEditorPane;n&&((i=n.input.resource)==null?void 0:i.scheme)===pe.untitled&&await e.save({editor:n.input,groupId:n.group.id})}await r.reloadConfiguration()}class Vh{constructor(e,t,i,n){this._contributedVariables=new Map,this._context=e,this._labelService=t,this._userHomePromise=i,n&&(this._envVariablesPromise=n.then(s=>this.prepareEnv(s)))}prepareEnv(e){if(wa){const t=Object.create(null);return Object.keys(e).forEach(i=>{t[i.toLowerCase()]=e[i]}),t}return e}resolveWithEnvironment(e,t,i){return this.recursiveResolve({env:this.prepareEnv(e),userHome:void 0},t?t.uri:void 0,i)}async resolveAsync(e,t){const i={env:await this._envVariablesPromise,userHome:await this._userHomePromise};return this.recursiveResolve(i,e?e.uri:void 0,t)}async resolveAnyBase(e,t,i,n){const s=Gi(t);wa&&s.windows?Object.keys(s.windows).forEach(a=>s[a]=s.windows[a]):uc&&s.osx?Object.keys(s.osx).forEach(a=>s[a]=s.osx[a]):ck&&s.linux&&Object.keys(s.linux).forEach(a=>s[a]=s.linux[a]),delete s.windows,delete s.osx,delete s.linux;const o={env:await this._envVariablesPromise,userHome:await this._userHomePromise};return this.recursiveResolve(o,e?e.uri:void 0,s,i,n)}async resolveAnyAsync(e,t,i){return this.resolveAnyBase(e,t,i)}async resolveAnyMap(e,t,i){const n=new Map;return{newConfig:await this.resolveAnyBase(e,t,i,n),resolvedVariables:n}}resolveWithInteractionReplace(e,t,i,n){throw new Error("resolveWithInteractionReplace not implemented.")}resolveWithInteraction(e,t,i,n){throw new Error("resolveWithInteraction not implemented.")}contributeVariable(e,t){if(this._contributedVariables.has(e))throw new Error("Variable "+e+" is contributed twice.");this._contributedVariables.set(e,t)}async recursiveResolve(e,t,i,n,s){if(Rt(i))return this.resolveString(e,t,i,n,s);if(Array.isArray(i))return Promise.all(i.map(o=>this.recursiveResolve(e,t,o,n,s)));if(bn(i)){const o=Object.create(null),a=await Promise.all(Object.keys(i).map(async c=>[await this.resolveString(e,t,c,n,s),await this.recursiveResolve(e,t,i[c],n,s)]));for(const[c,d]of a)o[c]=d;return o}return i}resolveString(e,t,i,n,s){return t7(i,Vh.VARIABLE_REGEXP,async(o,a)=>{if(a.includes(Vh.VARIABLE_LHS))return o;let c=await this.evaluateSingleVariable(e,o,a,t,n);return s==null||s.set(a,c),c!==o&&Rt(c)&&c.match(Vh.VARIABLE_REGEXP)&&(c=await this.resolveString(e,t,c,n,s)),c})}fsPath(e){return this._labelService?this._labelService.getUriLabel(e,{noPrefix:!0}):e.fsPath}async evaluateSingleVariable(e,t,i,n,s){let o;const a=i.split(":");a.length>1&&(i=a[0],o=a[1]);const c=u=>{const h=this._context.getFilePath();if(h)return Xu(h);throw new ps(u,p("canNotResolveFile","Variable {0} can not be resolved. Please open an editor.",t))},d=u=>{const h=c(u);if(this._context.getWorkspaceFolderPathForFile){const g=this._context.getWorkspaceFolderPathForFile();if(g)return Xu(g)}throw new ps(u,p("canNotResolveFolderForFile","Variable {0}: can not find workspace folder of '{1}'.",t,Yn(h)))},l=u=>{if(o){const h=this._context.getFolderUri(o);if(h)return h;throw new ps(u,p("canNotFindFolder","Variable {0} can not be resolved. No such folder '{1}'.",t,o))}if(n)return n;throw this._context.getWorkspaceFolderCount()>1?new ps(u,p("canNotResolveWorkspaceFolderMultiRoot","Variable {0} can not be resolved in a multi folder workspace. Scope this variable using ':' and a workspace folder name.",t)):new ps(u,p("canNotResolveWorkspaceFolder","Variable {0} can not be resolved. Please open a folder.",t))};switch(i){case"env":if(o){if(e.env){const u=e.env[wa?o.toLowerCase():o];if(Rt(u))return u}return""}throw new ps(qi.Env,p("missingEnvVarName","Variable {0} can not be resolved because no environment variable name is given.",t));case"config":if(o){const u=this._context.getConfigurationValue(n,o);if(Wo(u))throw new ps(qi.Config,p("configNotFound","Variable {0} can not be resolved because setting '{1}' not found.",t,o));if(bn(u))throw new ps(qi.Config,p("configNoString","Variable {0} can not be resolved because '{1}' is a structured value.",t,o));return u}throw new ps(qi.Config,p("missingConfigName","Variable {0} can not be resolved because no settings name is given.",t));case"command":return this.resolveFromMap(qi.Command,t,o,s,"command");case"input":return this.resolveFromMap(qi.Input,t,o,s,"input");case"extensionInstallFolder":if(o){const u=await this._context.getExtension(o);if(!u)throw new ps(qi.ExtensionInstallFolder,p("extensionNotInstalled","Variable {0} can not be resolved because the extension {1} is not installed.",t,o));return this.fsPath(u.extensionLocation)}throw new ps(qi.ExtensionInstallFolder,p("missingExtensionName","Variable {0} can not be resolved because no extension name is given.",t));default:switch(i){case"workspaceRoot":case"workspaceFolder":return Xu(this.fsPath(l(qi.WorkspaceFolder)));case"cwd":return n||o?Xu(this.fsPath(l(qi.Cwd))):zq();case"workspaceRootFolderName":case"workspaceFolderBasename":return Xu(Yn(this.fsPath(l(qi.WorkspaceFolderBasename))));case"userHome":{if(e.userHome)return e.userHome;throw new ps(qi.UserHome,p("canNotResolveUserHome","Variable {0} can not be resolved. UserHome path is not defined",t))}case"lineNumber":{const u=this._context.getLineNumber();if(u)return u;throw new ps(qi.LineNumber,p("canNotResolveLineNumber","Variable {0} can not be resolved. Make sure to have a line selected in the active editor.",t))}case"selectedText":{const u=this._context.getSelectedText();if(u)return u;throw new ps(qi.SelectedText,p("canNotResolveSelectedText","Variable {0} can not be resolved. Make sure to have some text selected in the active editor.",t))}case"file":return c(qi.File);case"fileWorkspaceFolder":return d(qi.FileWorkspaceFolder);case"relativeFile":return n||o?Sg(this.fsPath(l(qi.RelativeFile)),c(qi.RelativeFile)):c(qi.RelativeFile);case"relativeFileDirname":{const u=_h(c(qi.RelativeFileDirname));if(n||o){const h=Sg(this.fsPath(l(qi.RelativeFileDirname)),u);return h.length===0?".":h}return u}case"fileDirname":return _h(c(qi.FileDirname));case"fileExtname":return kg(c(qi.FileExtname));case"fileBasename":return Yn(c(qi.FileBasename));case"fileBasenameNoExtension":{const u=Yn(c(qi.FileBasenameNoExtension));return u.slice(0,u.length-kg(u).length)}case"fileDirnameBasename":return Yn(_h(c(qi.FileDirnameBasename)));case"execPath":{const u=this._context.getExecPath();return u||t}case"execInstallFolder":{const u=this._context.getAppRoot();return u||t}case"pathSeparator":return i7;default:try{const u=o?`${i}:${o}`:i;return this.resolveFromMap(qi.Unknown,t,u,s,void 0)}catch{return t}}}}resolveFromMap(e,t,i,n,s){if(i&&n){const o=s===void 0?n[i]:n[s+":"+i];if(typeof o=="string")return o;throw new ps(e,p("noValueForCommand","Variable {0} can not be resolved because the command has no value.",t))}return t}}Vh.VARIABLE_LHS="${";Vh.VARIABLE_REGEXP=/\$\{(.*?)\}/g;const U$=re("IExtHostVariableResolverProvider");class jpe extends Vh{constructor(e,t,i,n,s,o,a){function c(){var d;if(i){const l=i.activeEditor();if(l)return l.document.uri;const u=(d=n.tabGroups.all.find(h=>h.isActive))==null?void 0:d.activeTab;if(u!==void 0){if(u.input instanceof Nk||u.input instanceof Hk)return u.input.modified;if(u.input instanceof Ok||u.input instanceof Wk||u.input instanceof $k)return u.input.uri}}}super({getFolderUri:d=>{const l=o.folders.filter(u=>u.name===d);if(l&&l.length>0)return l[0].uri},getWorkspaceFolderCount:()=>o.folders.length,getConfigurationValue:(d,l)=>s.getConfiguration(void 0,d).get(l),getAppRoot:()=>zq(),getExecPath:()=>wH.VSCODE_EXEC_PATH,getFilePath:()=>{const d=c();if(d)return _C(d.fsPath)},getWorkspaceFolderPathForFile:()=>{if(t){const d=c();if(d){const l=t.getWorkspaceFolder(d);if(l)return _C(l.uri.fsPath)}}},getSelectedText:()=>{if(i){const d=i.activeEditor();if(d&&!d.selection.isEmpty)return d.document.getText(d.selection)}},getLineNumber:()=>{if(i){const d=i.activeEditor();if(d)return String(d.selection.end.line+1)}},getExtension:d=>e.getExtension(d)},void 0,a?Promise.resolve(a):void 0,Promise.resolve(wH))}}let GL=class extends ne{constructor(e,t,i,n,s){super(),this.extensionService=e,this.workspaceService=t,this.editorService=i,this.configurationService=n,this.editorTabs=s,this._resolver=new Tg(async()=>{const o=await this.configurationService.getConfigProvider(),c={folders:await this.workspaceService.getWorkspaceFolders2()||[]};return this._register(this.workspaceService.onDidChangeWorkspace(async d=>{c.folders=await this.workspaceService.getWorkspaceFolders2()||[]})),new jpe(this.extensionService,this.workspaceService,this.editorService,this.editorTabs,o,c,this.homeDir())})}getResolver(){return this._resolver.value}homeDir(){}};GL=T([v(0,xu),v(1,$d),v(2,gb),v(3,Wd),v(4,mb)],GL);const o8=re("IExtHostDebugService");let zL=class{get onDidStartDebugSession(){return this._onDidStartDebugSession.event}get onDidTerminateDebugSession(){return this._onDidTerminateDebugSession.event}get onDidChangeActiveDebugSession(){return this._onDidChangeActiveDebugSession.event}get activeDebugSession(){return this._activeDebugSession}get onDidReceiveDebugSessionCustomEvent(){return this._onDidReceiveDebugSessionCustomEvent.event}get activeDebugConsole(){return this._activeDebugConsole.value}constructor(e,t,i,n,s,o){this._workspaceService=t,this._extensionService=i,this._configurationService=n,this._editorTabs=s,this._variableResolver=o,this._debugSessions=new Map,this._configProviderHandleCounter=0,this._configProviders=[],this._adapterFactoryHandleCounter=0,this._adapterFactories=[],this._trackerFactoryHandleCounter=0,this._trackerFactories=[],this._debugAdapters=new Map,this._debugAdaptersTrackers=new Map,this._onDidStartDebugSession=new A,this._onDidTerminateDebugSession=new A,this._onDidChangeActiveDebugSession=new A,this._onDidReceiveDebugSessionCustomEvent=new A,this._debugServiceProxy=e.getProxy(ce.MainThreadDebugService),this._onDidChangeBreakpoints=new A({onWillAddFirstListener:()=>{this.startBreakpoints()}}),this._onDidChangeStackFrameFocus=new A,this._activeDebugConsole=new Upe(this._debugServiceProxy),this._breakpoints=new Map,this._breakpointEventsActive=!1,this._extensionService.getExtensionRegistry().then(a=>{a.onDidChange(c=>{this.registerAllDebugTypes(a)}),this.registerAllDebugTypes(a)})}asDebugSourceUri(e,t){const i=e;if(typeof i.sourceReference=="number"&&i.sourceReference>0){let n=`debug:${encodeURIComponent(i.path||"")}`,s="?";return t&&(n+=`${s}session=${encodeURIComponent(t.id)}`,s="&"),n+=`${s}ref=${i.sourceReference}`,k.parse(n)}else{if(i.path)return k.file(i.path);throw new Error("cannot create uri from DAP 'source' object; properties 'path' and 'sourceReference' are both missing.")}}registerAllDebugTypes(e){const t=[];for(const i of e.getAllExtensionDescriptions())if(i.contributes){const n=i.contributes.debuggers;if(n&&n.length>0)for(const s of n)Npe(s)&&t.push(s.type)}this._debugServiceProxy.$registerDebugTypes(t)}get stackFrameFocus(){return this._stackFrameFocus}get onDidChangeStackFrameFocus(){return this._onDidChangeStackFrameFocus.event}get onDidChangeBreakpoints(){return this._onDidChangeBreakpoints.event}get breakpoints(){this.startBreakpoints();const e=[];return this._breakpoints.forEach(t=>e.push(t)),e}addBreakpoints(e){this.startBreakpoints();const t=e.filter(s=>{const o=s.id;return this._breakpoints.has(o)?!1:(this._breakpoints.set(o,s),!0)});this.fireBreakpointChanges(t,[],[]);const i=[],n=new Map;for(const s of t)if(s instanceof _l){let o=n.get(s.location.uri.toString());o||(o={type:"sourceMulti",uri:s.location.uri,lines:[]},n.set(s.location.uri.toString(),o),i.push(o)),o.lines.push({id:s.id,enabled:s.enabled,condition:s.condition,hitCondition:s.hitCondition,logMessage:s.logMessage,line:s.location.range.start.line,character:s.location.range.start.character})}else s instanceof wl&&i.push({type:"function",id:s.id,enabled:s.enabled,hitCondition:s.hitCondition,logMessage:s.logMessage,condition:s.condition,functionName:s.functionName});return this._debugServiceProxy.$registerBreakpoints(i)}removeBreakpoints(e){this.startBreakpoints();const t=e.filter(o=>this._breakpoints.delete(o.id));this.fireBreakpointChanges([],t,[]);const i=t.filter(o=>o instanceof _l).map(o=>o.id),n=t.filter(o=>o instanceof wl).map(o=>o.id),s=t.filter(o=>o instanceof ZC).map(o=>o.id);return this._debugServiceProxy.$unregisterBreakpoints(i,n,s)}startDebugging(e,t,i){var n,s,o;return this._debugServiceProxy.$startDebugging(e?e.uri:void 0,t,{parentSessionID:i.parentSession?i.parentSession.id:void 0,lifecycleManagedByParent:i.lifecycleManagedByParent,repl:i.consoleMode===T_.MergeWithParent?"mergeWithParent":"separate",noDebug:i.noDebug,compact:i.compact,suppressSaveBeforeStart:i.suppressSaveBeforeStart,suppressDebugStatusbar:i.suppressDebugStatusbar??((n=i.debugUI)==null?void 0:n.simple),suppressDebugToolbar:i.suppressDebugToolbar??((s=i.debugUI)==null?void 0:s.simple),suppressDebugView:i.suppressDebugView??((o=i.debugUI)==null?void 0:o.simple)})}stopDebugging(e){return this._debugServiceProxy.$stopDebugging(e?e.id:void 0)}registerDebugConfigurationProvider(e,t,i){if(!t)return new Yt(()=>{});const n=this._configProviderHandleCounter++;return this._configProviders.push({type:e,handle:n,provider:t}),this._debugServiceProxy.$registerDebugConfigurationProvider(e,i,!!t.provideDebugConfigurations,!!t.resolveDebugConfiguration,!!t.resolveDebugConfigurationWithSubstitutedVariables,n),new Yt(()=>{this._configProviders=this._configProviders.filter(s=>s.provider!==t),this._debugServiceProxy.$unregisterDebugConfigurationProvider(n)})}registerDebugAdapterDescriptorFactory(e,t,i){if(!i)return new Yt(()=>{});if(!this.definesDebugType(e,t))throw new Error(`a DebugAdapterDescriptorFactory can only be registered from the extension that defines the '${t}' debugger.`);if(this.getAdapterDescriptorFactoryByType(t))throw new Error("a DebugAdapterDescriptorFactory can only be registered once per a type.");const n=this._adapterFactoryHandleCounter++;return this._adapterFactories.push({type:t,handle:n,factory:i}),this._debugServiceProxy.$registerDebugAdapterDescriptorFactory(t,n),new Yt(()=>{this._adapterFactories=this._adapterFactories.filter(s=>s.factory!==i),this._debugServiceProxy.$unregisterDebugAdapterDescriptorFactory(n)})}registerDebugAdapterTrackerFactory(e,t){if(!t)return new Yt(()=>{});const i=this._trackerFactoryHandleCounter++;return this._trackerFactories.push({type:e,handle:i,factory:t}),new Yt(()=>{this._trackerFactories=this._trackerFactories.filter(n=>n.factory!==t)})}async $runInTerminal(e,t){return Promise.resolve(void 0)}async $substituteVariables(e,t){let i;const n=await this.getFolder(e);return n&&(i={uri:n.uri,name:n.name,index:n.index,toResource:()=>{throw new Error("Not implemented")}}),(await this._variableResolver.getResolver()).resolveAnyAsync(i,t)}createDebugAdapter(e,t){if(e.type==="implementation")return new qpe(e.implementation)}createSignService(){}async $startDASession(e,t){const i=this,n=await this.getSession(t);return this.getAdapterDescriptor(this.getAdapterDescriptorFactoryByType(n.type),n).then(s=>{if(!s)throw new Error(`Couldn't find a debug adapter descriptor for debug type '${n.type}' (extension might have failed to activate)`);const o=this.convertToDto(s),a=this.createDebugAdapter(o,n);if(!a)throw new Error(`Couldn't create a debug adapter for type '${n.type}'.`);const c=a;return this._debugAdapters.set(e,c),this.getDebugAdapterTrackers(n).then(d=>(d&&this._debugAdaptersTrackers.set(e,d),c.onMessage(async l=>{if(l.type==="request"&&l.command==="handshake"){const u=l,h={type:"response",seq:0,command:u.command,request_seq:u.seq,success:!0};this._signService||(this._signService=this.createSignService());try{if(this._signService){const g=await this._signService.sign(u.arguments.value);h.body={signature:g},c.sendResponse(h)}else throw new Error("no signer")}catch(g){h.success=!1,h.message=g.message,c.sendResponse(h)}}else d&&d.onDidSendMessage&&d.onDidSendMessage(l),l=r8(l,!0),i._debugServiceProxy.$acceptDAMessage(e,l)}),c.onError(l=>{d&&d.onError&&d.onError(l),this._debugServiceProxy.$acceptDAError(e,l.name,l.message,l.stack)}),c.onExit(l=>{d&&d.onExit&&d.onExit(ii(l),void 0),this._debugServiceProxy.$acceptDAExit(e,ii(l),void 0)}),d&&d.onWillStartSession&&d.onWillStartSession(),c.startSession()))})}$sendDAMessage(e,t){t=n8(t,!1);const i=this._debugAdaptersTrackers.get(e);i&&i.onWillReceiveMessage&&i.onWillReceiveMessage(t);const n=this._debugAdapters.get(e);n==null||n.sendMessage(t)}$stopDASession(e){const t=this._debugAdaptersTrackers.get(e);this._debugAdaptersTrackers.delete(e),t&&t.onWillStopSession&&t.onWillStopSession();const i=this._debugAdapters.get(e);return this._debugAdapters.delete(e),i?i.stopSession():Promise.resolve(void 0)}$acceptBreakpointsDelta(e){const t=[],i=[],n=[];if(e.added)for(const s of e.added){const o=s.id;if(o&&!this._breakpoints.has(o)){let a;if(s.type==="function")a=new wl(s.functionName,s.enabled,s.condition,s.hitCondition,s.logMessage);else if(s.type==="data")a=new ZC(s.label,s.dataId,s.canPersist,s.enabled,s.hitCondition,s.condition,s.logMessage);else{const c=k.revive(s.uri);a=new _l(new wo(c,new At(s.line,s.character)),s.enabled,s.condition,s.hitCondition,s.logMessage)}ate(a,o),this._breakpoints.set(o,a),t.push(a)}}if(e.removed)for(const s of e.removed){const o=this._breakpoints.get(s);o&&(this._breakpoints.delete(s),i.push(o))}if(e.changed){for(const s of e.changed)if(s.id){const o=this._breakpoints.get(s.id);if(o){if(o instanceof wl&&s.type==="function"){const a=o;a.enabled=s.enabled,a.condition=s.condition,a.hitCondition=s.hitCondition,a.logMessage=s.logMessage,a.functionName=s.functionName}else if(o instanceof _l&&s.type==="source"){const a=o;a.enabled=s.enabled,a.condition=s.condition,a.hitCondition=s.hitCondition,a.logMessage=s.logMessage,a.location=new wo(k.revive(s.uri),new At(s.line,s.character))}n.push(o)}}}this.fireBreakpointChanges(t,i,n)}async $acceptStackFrameFocus(e){let t;const i=e.sessionId?await this.getSession(e.sessionId):void 0;if(!i)throw new Error("no DebugSession found for debug focus context");e.kind==="thread"?t=new tE(i,e.threadId):t=new eE(i,e.threadId,e.frameId),this._stackFrameFocus=t,this._onDidChangeStackFrameFocus.fire(this._stackFrameFocus)}$provideDebugConfigurations(e,t,i){return Nr(async()=>{const n=this.getConfigProviderByHandle(e);if(!n)throw new Error("no DebugConfigurationProvider found");if(!n.provideDebugConfigurations)throw new Error("DebugConfigurationProvider has no method provideDebugConfigurations");const s=await this.getFolder(t);return n.provideDebugConfigurations(s,i)}).then(n=>{if(!n)throw new Error("nothing returned from DebugConfigurationProvider.provideDebugConfigurations");return n})}$resolveDebugConfiguration(e,t,i,n){return Nr(async()=>{const s=this.getConfigProviderByHandle(e);if(!s)throw new Error("no DebugConfigurationProvider found");if(!s.resolveDebugConfiguration)throw new Error("DebugConfigurationProvider has no method resolveDebugConfiguration");const o=await this.getFolder(t);return s.resolveDebugConfiguration(o,i,n)})}$resolveDebugConfigurationWithSubstitutedVariables(e,t,i,n){return Nr(async()=>{const s=this.getConfigProviderByHandle(e);if(!s)throw new Error("no DebugConfigurationProvider found");if(!s.resolveDebugConfigurationWithSubstitutedVariables)throw new Error("DebugConfigurationProvider has no method resolveDebugConfigurationWithSubstitutedVariables");const o=await this.getFolder(t);return s.resolveDebugConfigurationWithSubstitutedVariables(o,i,n)})}async $provideDebugAdapter(e,t){const i=this.getAdapterDescriptorFactoryByHandle(e);if(!i)return Promise.reject(new Error("no adapter descriptor factory found for handle"));const n=await this.getSession(t);return this.getAdapterDescriptor(i,n).then(s=>{if(!s)throw new Error(`Couldn't find a debug adapter descriptor for debug type '${n.type}'`);return this.convertToDto(s)})}async $acceptDebugSessionStarted(e){const t=await this.getSession(e);this._onDidStartDebugSession.fire(t)}async $acceptDebugSessionTerminated(e){const t=await this.getSession(e);t&&(this._onDidTerminateDebugSession.fire(t),this._debugSessions.delete(t.id))}async $acceptDebugSessionActiveChanged(e){this._activeDebugSession=e?await this.getSession(e):void 0,this._onDidChangeActiveDebugSession.fire(this._activeDebugSession)}async $acceptDebugSessionNameChanged(e,t){const i=await this.getSession(e);i==null||i._acceptNameChanged(t)}async $acceptDebugSessionCustomEvent(e,t){const n={session:await this.getSession(e),event:t.event,body:t.body};this._onDidReceiveDebugSessionCustomEvent.fire(n)}convertToDto(e){if(e instanceof w_)return{type:"executable",command:e.command,args:e.args,options:e.options};if(e instanceof Gg)return{type:"server",port:e.port,host:e.host};if(e instanceof b_)return{type:"pipeServer",path:e.path};if(e instanceof S_)return{type:"implementation",implementation:e.implementation};throw new Error("convertToDto unexpected type")}getAdapterDescriptorFactoryByType(e){const t=this._adapterFactories.filter(i=>i.type===e);if(t.length>0)return t[0].factory}getAdapterDescriptorFactoryByHandle(e){const t=this._adapterFactories.filter(i=>i.handle===e);if(t.length>0)return t[0].factory}getConfigProviderByHandle(e){const t=this._configProviders.filter(i=>i.handle===e);if(t.length>0)return t[0].provider}definesDebugType(e,t){if(e.contributes){const i=e.contributes.debuggers;if(i&&i.length>0){for(const n of i)if(n.label&&n.type&&n.type===t)return!0}}return!1}getDebugAdapterTrackers(e){const i=e.configuration.type,n=this._trackerFactories.filter(s=>s.type===i||s.type==="*").map(s=>Nr(()=>s.factory.createDebugAdapterTracker(e)).then(o=>o,o=>null));return Promise.race([Promise.all(n).then(s=>{const o=s.filter(a=>!!a);if(o.length>0)return new Vpe(o)}),new Promise(s=>setTimeout(()=>s(void 0),1e3))]).catch(s=>{})}async getAdapterDescriptor(e,t){const i=t.configuration.debugServer;if(typeof i=="number")return Promise.resolve(new Gg(i));if(e){const s=await this._extensionService.getExtensionRegistry();return Nr(()=>e.createDebugAdapterDescriptor(t,this.daExecutableFromPackage(t,s))).then(o=>{if(o)return o})}const n=await this._extensionService.getExtensionRegistry();return Promise.resolve(this.daExecutableFromPackage(t,n))}daExecutableFromPackage(e,t){}startBreakpoints(){this._breakpointEventsActive||(this._breakpointEventsActive=!0,this._debugServiceProxy.$startBreakpointEvents())}fireBreakpointChanges(e,t,i){(e.length>0||t.length>0||i.length>0)&&this._onDidChangeBreakpoints.fire(Object.freeze({added:e,removed:t,changed:i}))}async getSession(e){if(e)if(typeof e=="string"){const t=this._debugSessions.get(e);if(t)return t}else{let t=this._debugSessions.get(e.id);if(!t){const i=await this.getFolder(e.folderUri),n=e.parent?this._debugSessions.get(e.parent):void 0;t=new Bpe(this._debugServiceProxy,e.id,e.type,e.name,i,e.configuration,n),this._debugSessions.set(t.id,t),this._debugServiceProxy.$sessionCached(t.id)}return t}throw new Error("cannot find session")}getFolder(e){if(e){const t=k.revive(e);return this._workspaceService.resolveWorkspaceFolder(t)}return Promise.resolve(void 0)}};zL=T([v(0,Ii),v(1,$d),v(2,xu),v(3,Wd),v(4,mb),v(5,U$)],zL);class Bpe{constructor(e,t,i,n,s,o,a){this._debugServiceProxy=e,this._id=t,this._type=i,this._name=n,this._workspaceFolder=s,this._configuration=o,this._parentSession=a}get id(){return this._id}get type(){return this._type}get name(){return this._name}set name(e){this._name=e,this._debugServiceProxy.$setDebugSessionName(this._id,e)}get parentSession(){return this._parentSession}_acceptNameChanged(e){this._name=e}get workspaceFolder(){return this._workspaceFolder}get configuration(){return this._configuration}customRequest(e,t){return this._debugServiceProxy.$customDebugAdapterRequest(this._id,e,t)}getDebugProtocolBreakpoint(e){return this._debugServiceProxy.$getDebugProtocolBreakpoint(this._id,e.id)}}class Upe{constructor(e){this.value=Object.freeze({append(t){e.$appendDebugConsole(t)},appendLine(t){this.append(t+`
`)}})}}class Vpe{constructor(e){this.trackers=e}onWillStartSession(){this.trackers.forEach(e=>e.onWillStartSession?e.onWillStartSession():void 0)}onWillReceiveMessage(e){this.trackers.forEach(t=>t.onWillReceiveMessage?t.onWillReceiveMessage(e):void 0)}onDidSendMessage(e){this.trackers.forEach(t=>t.onDidSendMessage?t.onDidSendMessage(e):void 0)}onWillStopSession(){this.trackers.forEach(e=>e.onWillStopSession?e.onWillStopSession():void 0)}onError(e){this.trackers.forEach(t=>t.onError?t.onError(e):void 0)}onExit(e,t){this.trackers.forEach(i=>i.onExit?i.onExit(e,t):void 0)}}class qpe extends J5{constructor(e){super(),this.implementation=e,e.onDidSendMessage(t=>{this.acceptMessage(t)})}startSession(){return Promise.resolve(void 0)}sendMessage(e){this.implementation.handleMessage(e)}stopSession(){return this.implementation.dispose(),Promise.resolve(void 0)}}let KL=class extends zL{constructor(e,t,i,n,s,o){super(e,t,i,n,s,o)}};KL=T([v(0,Ii),v(1,$d),v(2,xu),v(3,Wd),v(4,mb),v(5,U$)],KL);class Gpe{constructor(e,t,i){this.config=e,this.provider=t,this.sessionToken=i,this.isLimitHit=!1,this.resultCount=0,this.isCanceled=!1,this.filePattern=e.filePattern,this.includePattern=e.includePattern&&vd(e.includePattern),this.maxResults=e.maxResults||void 0,this.exists=e.exists,this.activeCancellationTokens=new Set,this.globalExcludePattern=e.excludePattern&&vd(e.excludePattern)}cancel(){this.isCanceled=!0,this.activeCancellationTokens.forEach(e=>e.cancel()),this.activeCancellationTokens=new Set}search(e){const t=this.config.folderQueries||[];return new Promise((i,n)=>{const s=o=>{this.resultCount++,e(o)};if(this.isCanceled)return i({limitHit:this.isLimitHit});this.config.extraFileResources&&this.config.extraFileResources.forEach(o=>{const a=o.toString(),c=Yn(a);this.globalExcludePattern&&this.globalExcludePattern(a,c)||this.matchFile(s,{base:o,basename:c})}),Promise.all(t.map(o=>this.searchInFolder(o,s))).then(o=>{i({limitHit:this.isLimitHit,stats:o[0]||void 0})},o=>{n(new Error(La(o)))})})}async searchInFolder(e,t){const i=new Xt,n=this.getSearchOptionsForFolder(e),s=this.initDirectoryTree(),o=new I3(this.config,e),a=!o.hasSiblingExcludeClauses();let c;try{this.activeCancellationTokens.add(i),c=Tr.create();const d=await this.provider.provideFileSearchResults({pattern:this.config.filePattern||""},n,i.token),l=c.elapsed(),u=Tr.create();return this.isCanceled&&!this.isLimitHit||(d&&d.forEach(h=>{const g=Ho.relative(e.folder.path,h.path);if(a){const m=Yn(h.path);this.matchFile(t,{base:e.folder,relativePath:g,basename:m});return}this.addDirectoryEntries(s,e.folder,g,t)}),this.isCanceled&&!this.isLimitHit)?null:(this.matchDirectoryTree(s,o,t),{providerTime:l,postProcessTime:u.elapsed()})}finally{i.dispose(),this.activeCancellationTokens.delete(i)}}getSearchOptionsForFolder(e){const t=IE(this.config.includePattern,e.includePattern),i=IE(this.config.excludePattern,e.excludePattern);return{folder:e.folder,excludes:i,includes:t,useIgnoreFiles:!e.disregardIgnoreFiles,useGlobalIgnoreFiles:!e.disregardGlobalIgnoreFiles,useParentIgnoreFiles:!e.disregardParentIgnoreFiles,followSymlinks:!e.ignoreSymlinks,maxResults:this.config.maxResults,session:this.sessionToken}}initDirectoryTree(){const e={rootEntries:[],pathToEntries:Object.create(null)};return e.pathToEntries["."]=e.rootEntries,e}addDirectoryEntries({pathToEntries:e},t,i,n){if(i===this.filePattern){const o=Yn(this.filePattern);this.matchFile(n,{base:t,relativePath:this.filePattern,basename:o})}function s(o){const a=Yn(o),c=_h(o);let d=e[c];d||(d=e[c]=[],s(c)),d.push({base:t,relativePath:o,basename:a})}s(i)}matchDirectoryTree({rootEntries:e,pathToEntries:t},i,n){const s=this,o=this.filePattern;function a(c){const d=Zce(()=>c.map(l=>l.basename));for(let l=0,u=c.length;l<u;l++){const h=c[l],{relativePath:g,basename:m}=h;if(i.matchesExcludesSync(g,m,o!==m?d:void 0))continue;const y=t[g];if(y)a(y);else{if(g===o)continue;s.matchFile(n,h)}if(s.isLimitHit)break}}a(e)}matchFile(e,t){(!this.includePattern||t.relativePath&&this.includePattern(t.relativePath,t.basename))&&((this.exists||this.maxResults&&this.resultCount>=this.maxResults)&&(this.isLimitHit=!0,this.cancel()),this.isLimitHit||e(t))}}class nI{constructor(){this.sessions=new Map}fileSearch(e,t,i,n){const s=this.getSessionTokenSource(e.cacheKey),o=new Gpe(e,t,s&&s.token);let a=0;const c=d=>{a+=d.length,i(d.map(l=>this.rawMatchToSearchItem(l)))};return this.doSearch(o,nI.BATCH_SIZE,c,n).then(d=>({limitHit:d.limitHit,stats:{fromCache:!1,type:"fileSearchProvider",resultCount:a,detailStats:d.stats}}))}clearCache(e){const t=this.getSessionTokenSource(e);t==null||t.cancel()}getSessionTokenSource(e){if(e)return this.sessions.has(e)||this.sessions.set(e,new Xt),this.sessions.get(e)}rawMatchToSearchItem(e){return e.relativePath?{resource:pt(e.base,e.relativePath)}:{resource:e.base}}doSearch(e,t,i,n){n.onCancellationRequested(()=>{e.cancel()});const s=a=>{a&&(o.push(a),t>0&&o.length>=t&&(i(o),o=[]))};let o=[];return e.search(s).then(a=>(o.length&&i(o),a),a=>(o.length&&i(o),Promise.reject(a)))}}nI.BATCH_SIZE=512;class zpe{constructor(e,t,i,n){this.query=e,this.provider=t,this.fileUtils=i,this.processType=n,this.collector=null,this.isLimitHit=!1,this.resultCount=0}search(e,t){const i=this.query.folderQueries||[],n=new Xt;return t.onCancellationRequested(()=>n.cancel()),new Promise((s,o)=>{this.collector=new Qpe(e);let a=!1;const c=(d,l)=>{if(!a&&!this.isLimitHit){const u=this.resultSize(d);oy(d)&&typeof this.query.maxResults=="number"&&this.resultCount+u>this.query.maxResults&&(this.isLimitHit=!0,a=!0,n.cancel(),d=this.trimResultToSize(d,this.query.maxResults-this.resultCount));const h=this.resultSize(d);this.resultCount+=h,(h>0||!oy(d))&&this.collector.add(d,l)}};Promise.all(i.map((d,l)=>this.searchInFolder(d,u=>c(u,l),n.token))).then(d=>{n.dispose(),this.collector.flush();const l=d.some(u=>!!u&&!!u.limitHit);s({limitHit:this.isLimitHit||l,messages:qy(d.map(u=>u!=null&&u.message?Array.isArray(u.message)?u.message:[u.message]:[])),stats:{type:this.processType}})},d=>{n.dispose();const l=La(d);o(new Error(l))})})}resultSize(e){return oy(e)?Array.isArray(e.ranges)?e.ranges.length:1:0}trimResultToSize(e,t){const i=Array.isArray(e.ranges)?e.ranges:[e.ranges],n=Array.isArray(e.preview.matches)?e.preview.matches:[e.preview.matches];return{ranges:i.slice(0,t),preview:{matches:n.slice(0,t),text:e.preview.text},uri:e.uri}}async searchInFolder(e,t,i){const n=new I3(this.query,e),s=[],o={report:d=>{if(!this.validateProviderResult(d))return;const l=e.folder.scheme===pe.file?Jce(()=>this.fileUtils.readdir(pn(d.uri))):void 0,u=xg(e.folder,d.uri);if(u){const h=n.includedInQuery(u,Yn(u),l);Cg(h)?s.push(h.then(g=>{g&&t(d)})):h&&t(d)}}},a=this.getSearchOptionsForFolder(e),c=await this.provider.provideTextSearchResults(Kpe(this.query.contentPattern),a,o,i);return s.length&&await Promise.all(s),c}validateProviderResult(e){if(oy(e)){if(Array.isArray(e.ranges)){if(!Array.isArray(e.preview.matches))return console.warn("INVALID - A text search provider match's`ranges` and`matches` properties must have the same type."),!1;if(e.preview.matches.length!==e.ranges.length)return console.warn("INVALID - A text search provider match's`ranges` and`matches` properties must have the same length."),!1}else if(Array.isArray(e.preview.matches))return console.warn("INVALID - A text search provider match's`ranges` and`matches` properties must have the same length."),!1}return!0}getSearchOptionsForFolder(e){const t=IE(this.query.includePattern,e.includePattern),i=IE(this.query.excludePattern,e.excludePattern),n={folder:k.from(e.folder),excludes:i,includes:t,useIgnoreFiles:!e.disregardIgnoreFiles,useGlobalIgnoreFiles:!e.disregardGlobalIgnoreFiles,useParentIgnoreFiles:!e.disregardParentIgnoreFiles,followSymlinks:!e.ignoreSymlinks,encoding:e.fileEncoding&&this.fileUtils.toCanonicalName(e.fileEncoding),maxFileSize:this.query.maxFileSize,maxResults:this.query.maxResults,previewOptions:this.query.previewOptions,afterContext:this.query.afterContext,beforeContext:this.query.beforeContext};return n.usePCRE2=this.query.usePCRE2,n}}function Kpe(r){return{isCaseSensitive:r.isCaseSensitive||!1,isRegExp:r.isRegExp||!1,isWordMatch:r.isWordMatch||!1,isMultiline:r.isMultiline||!1,pattern:r.pattern}}class Qpe{constructor(e){this._onResult=e,this._currentFolderIdx=-1,this._currentFileMatch=null,this._batchedCollector=new xm(512,t=>this.sendItems(t))}add(e,t){this._currentFileMatch&&(this._currentFolderIdx!==t||!si(this._currentUri,e.uri))&&(this.pushToCollector(),this._currentFileMatch=null),this._currentFileMatch||(this._currentFolderIdx=t,this._currentFileMatch={resource:e.uri,results:[]}),this._currentFileMatch.results.push(Ype(e))}pushToCollector(){const e=this._currentFileMatch&&this._currentFileMatch.results?this._currentFileMatch.results.length:0;this._batchedCollector.addItem(this._currentFileMatch,e)}flush(){this.pushToCollector(),this._batchedCollector.flush()}sendItems(e){this._onResult(e)}}function Ype(r){return oy(r)?{preview:{matches:Gy(r.preview.matches,e=>({startLineNumber:e.start.line,startColumn:e.start.character,endLineNumber:e.end.line,endColumn:e.end.character})),text:r.preview.text},ranges:Gy(r.ranges,e=>({startLineNumber:e.start.line,startColumn:e.start.character,endLineNumber:e.end.line,endColumn:e.end.character}))}:{text:r.text,lineNumber:r.lineNumber}}function oy(r){return!!r.preview}class xm{constructor(e,t){this.maxBatchSize=e,this.cb=t,this.totalNumberCompleted=0,this.batch=[],this.batchSize=0}addItem(e,t){e&&this.addItemToBatch(e,t)}addItems(e,t){e&&this.addItemsToBatch(e,t)}addItemToBatch(e,t){this.batch.push(e),this.batchSize+=t,this.onUpdate()}addItemsToBatch(e,t){this.batch=this.batch.concat(e),this.batchSize+=t,this.onUpdate()}onUpdate(){this.totalNumberCompleted<xm.START_BATCH_AFTER_COUNT?this.flush():this.batchSize>=this.maxBatchSize?this.flush():this.timeoutHandle||(this.timeoutHandle=setTimeout(()=>{this.flush()},xm.TIMEOUT))}flush(){this.batchSize&&(this.totalNumberCompleted+=this.batchSize,this.cb(this.batch),this.batch=[],this.batchSize=0,this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=0))}}xm.TIMEOUT=4e3;xm.START_BATCH_AFTER_COUNT=50;const a8=re("IExtHostSearch");let QL=class{constructor(e,t,i){this.extHostRpc=e,this._uriTransformer=t,this._logService=i,this._proxy=this.extHostRpc.getProxy(ce.MainThreadSearch),this._handlePool=0,this._textSearchProvider=new Map,this._textSearchUsedSchemes=new Set,this._fileSearchProvider=new Map,this._fileSearchUsedSchemes=new Set,this._fileSearchManager=new nI}_transformScheme(e){return this._uriTransformer.transformOutgoingScheme(e)}registerTextSearchProvider(e,t){if(this._textSearchUsedSchemes.has(e))throw new Error(`a text search provider for the scheme '${e}' is already registered`);this._textSearchUsedSchemes.add(e);const i=this._handlePool++;return this._textSearchProvider.set(i,t),this._proxy.$registerTextSearchProvider(i,this._transformScheme(e)),ot(()=>{this._textSearchUsedSchemes.delete(e),this._textSearchProvider.delete(i),this._proxy.$unregisterProvider(i)})}registerFileSearchProvider(e,t){if(this._fileSearchUsedSchemes.has(e))throw new Error(`a file search provider for the scheme '${e}' is already registered`);this._fileSearchUsedSchemes.add(e);const i=this._handlePool++;return this._fileSearchProvider.set(i,t),this._proxy.$registerFileSearchProvider(i,this._transformScheme(e)),ot(()=>{this._fileSearchUsedSchemes.delete(e),this._fileSearchProvider.delete(i),this._proxy.$unregisterProvider(i)})}$provideFileSearchResults(e,t,i,n){const s=_U(i),o=this._fileSearchProvider.get(e);if(o)return this._fileSearchManager.fileSearch(s,o,a=>{this._proxy.$handleFileMatch(e,t,a.map(c=>c.resource))},n);throw new Error("unknown provider: "+e)}$clearCache(e){return this._fileSearchManager.clearCache(e),Promise.resolve(void 0)}$provideTextSearchResults(e,t,i,n){const s=this._textSearchProvider.get(e);if(!s||!s.provideTextSearchResults)throw new Error(`Unknown provider ${e}`);const o=_U(i);return this.createTextSearchManager(o,s).search(c=>this._proxy.$handleTextMatch(e,t,c),n)}$enableExtensionHostSearch(){}createTextSearchManager(e,t){return new zpe(e,t,{readdir:i=>Promise.resolve([]),toCanonicalName:i=>i},"textSearchProvider")}};QL=T([v(0,Ii),v(1,KT),v(2,ze)],QL);function _U(r){return{...r,folderQueries:r.folderQueries&&r.folderQueries.map(Xpe),extraFileResources:r.extraFileResources&&r.extraFileResources.map(e=>k.revive(e))}}function Xpe(r){return{...r,folder:k.revive(r.folder)}}class iP{constructor(e,t,i,n){this.start=e,this.deletedCount=t,this.deletedItems=i,this.items=n}asApiEvent(){return{range:new Zc(this.start,this.start+this.deletedCount),addedCells:this.items.map(e=>e.apiCell),removedCells:this.deletedItems}}}class YL{static asModelAddData(e,t){return{EOL:t.eol,lines:t.source,languageId:t.language,uri:t.uri,isDirty:!1,versionId:1,notebook:e}}constructor(e,t,i){this.notebook=e,this._extHostDocument=t,this._cellData=i,this.handle=i.handle,this.uri=k.revive(i.uri),this.cellKind=i.cellKind,this._outputs=i.outputs.map(uu.to),this._internalMetadata=i.internalMetadata??{},this._metadata=Object.freeze(i.metadata??{}),this._previousResult=Object.freeze(bm.to(i.internalMetadata??{}))}get internalMetadata(){return this._internalMetadata}get apiCell(){if(!this._apiCell){const e=this,t=this._extHostDocument.getDocument(this.uri);if(!t)throw new Error(`MISSING extHostDocument for notebook cell: ${this.uri}`);const i={get index(){return e.notebook.getCellIndex(e)},notebook:e.notebook.apiNotebook,kind:rw.to(this._cellData.cellKind),document:t.document,get mime(){return e._mime},set mime(n){e._mime=n},get outputs(){return e._outputs.slice(0)},get metadata(){return e._metadata},get executionSummary(){return e._previousResult}};this._apiCell=Object.freeze(i)}return this._apiCell}setOutputs(e){this._outputs=e.map(uu.to)}setOutputItems(e,t,i){const n=i.map(Sm.to),s=this._outputs.find(o=>o.id===e);if(s&&(t||(s.items.length=0),s.items.push(...n),s.items.length>1&&s.items.every(o=>sz(o.mime)))){const o=new Map,a=[];s.items.forEach(c=>{let d;o.has(c.mime)?d=o.get(c.mime):(d=[],o.set(c.mime,d),a.push(c.mime)),d.push(c.data)}),s.items.length=0,a.forEach(c=>{const d=Gee(o.get(c));s.items.push({mime:c,data:d.buffer})})}}setMetadata(e){this._metadata=Object.freeze(e)}setInternalMetadata(e){this._internalMetadata=e,this._previousResult=Object.freeze(bm.to(e))}setMime(e){}}class rI{constructor(e,t,i,n,s){this._proxy=e,this._textDocumentsAndEditors=t,this._textDocuments=i,this.uri=n,this.handle=rI._handlePool++,this._cells=[],this._versionId=0,this._isDirty=!1,this._disposed=!1,this._notebookType=s.viewType,this._metadata=Object.freeze(s.metadata??Object.create(null)),this._spliceNotebookCells([[0,0,s.cells]],!0,void 0),this._versionId=s.versionId}dispose(){this._disposed=!0}get versionId(){return this._versionId}get apiNotebook(){if(!this._notebook){const e=this,t={get uri(){return e.uri},get version(){return e._versionId},get notebookType(){return e._notebookType},get isDirty(){return e._isDirty},get isUntitled(){return e.uri.scheme===pe.untitled},get isClosed(){return e._disposed},get metadata(){return e._metadata},get cellCount(){return e._cells.length},cellAt(i){return i=e._validateIndex(i),e._cells[i].apiCell},getCells(i){return(i?e._getCells(i):e._cells).map(s=>s.apiCell)},save(){return e._save()}};this._notebook=Object.freeze(t)}return this._notebook}acceptDocumentPropertiesChanged(e){e.metadata&&(this._metadata=Object.freeze({...this._metadata,...e.metadata}))}acceptDirty(e){this._isDirty=e}acceptModelChanged(e,t,i){this._versionId=e.versionId,this._isDirty=t,this.acceptDocumentPropertiesChanged({metadata:i});const n={notebook:this.apiNotebook,metadata:i,cellChanges:[],contentChanges:[]},s=[];for(const a of e.rawEvents)a.kind===_n.ModelChange?this._spliceNotebookCells(a.changes,!1,n.contentChanges):a.kind===_n.Move?this._moveCells(a.index,a.length,a.newIdx,n.contentChanges):a.kind===_n.Output?(this._setCellOutputs(a.index,a.outputs),s.push({cell:this._cells[a.index].apiCell,outputs:this._cells[a.index].apiCell.outputs})):a.kind===_n.OutputItem?(this._setCellOutputItems(a.index,a.outputId,a.append,a.outputItems),s.push({cell:this._cells[a.index].apiCell,outputs:this._cells[a.index].apiCell.outputs})):a.kind===_n.ChangeCellLanguage?(this._changeCellLanguage(a.index,a.language),s.push({cell:this._cells[a.index].apiCell,document:this._cells[a.index].apiCell.document})):a.kind===_n.ChangeCellContent?s.push({cell:this._cells[a.index].apiCell,document:this._cells[a.index].apiCell.document}):a.kind===_n.ChangeCellMime?this._changeCellMime(a.index,a.mime):a.kind===_n.ChangeCellMetadata?(this._changeCellMetadata(a.index,a.metadata),s.push({cell:this._cells[a.index].apiCell,metadata:this._cells[a.index].apiCell.metadata})):a.kind===_n.ChangeCellInternalMetadata&&(this._changeCellInternalMetadata(a.index,a.internalMetadata),s.push({cell:this._cells[a.index].apiCell,executionSummary:this._cells[a.index].apiCell.executionSummary}));const o=new Map;for(let a=0;a<s.length;a++){const c=s[a],d=o.get(c.cell);if(d===void 0){const l=n.cellChanges.push({document:void 0,executionSummary:void 0,metadata:void 0,outputs:void 0,...c});o.set(c.cell,l-1)}else n.cellChanges[d]={...n.cellChanges[d],...c}}return n}_validateIndex(e){return e=e|0,e<0?0:e>=this._cells.length?this._cells.length-1:e}_validateRange(e){let t=e.start|0,i=e.end|0;return t<0&&(t=0),i>this._cells.length&&(i=this._cells.length),e.with({start:t,end:i})}_getCells(e){e=this._validateRange(e);const t=[];for(let i=e.start;i<e.end;i++)t.push(this._cells[i]);return t}async _save(){return this._disposed?Promise.reject(new Error("Notebook has been closed")):this._proxy.$trySaveNotebook(this.uri)}_spliceNotebookCells(e,t,i){if(this._disposed)return;const n=[],s=[],o=[];if(e.reverse().forEach(a=>{const d=a[2].map(h=>{const g=new YL(this,this._textDocumentsAndEditors,h);return t||s.push(YL.asModelAddData(this.apiNotebook,h)),g}),l=new iP(a[0],a[1],[],d),u=this._cells.splice(a[0],a[1],...d);for(const h of u)o.push(h.uri),l.deletedItems.push(h.apiCell);n.push(l)}),this._textDocumentsAndEditors.acceptDocumentsAndEditorsDelta({addedDocuments:s,removedDocuments:o}),i)for(const a of n)i.push(a.asApiEvent())}_moveCells(e,t,i,n){const s=this._cells.splice(e,t);this._cells.splice(i,0,...s);const o=[new iP(e,t,s.map(a=>a.apiCell),[]),new iP(i,0,[],s)];for(const a of o)n.push(a.asApiEvent())}_setCellOutputs(e,t){this._cells[e].setOutputs(t)}_setCellOutputItems(e,t,i,n){this._cells[e].setOutputItems(t,i,n)}_changeCellLanguage(e,t){const i=this._cells[e];i.apiCell.document.languageId!==t&&this._textDocuments.$acceptModelLanguageChanged(i.uri,t)}_changeCellMime(e,t){const i=this._cells[e];i.apiCell.mime=t}_changeCellMetadata(e,t){this._cells[e].setMetadata(t)}_changeCellInternalMetadata(e,t){this._cells[e].setInternalMetadata(t)}getCellFromApiCell(e){return this._cells.find(t=>t.apiCell===e)}getCellFromIndex(e){return this._cells[e]}getCell(e){return this._cells.find(t=>t.handle===e)}getCellIndex(e){return this._cells.indexOf(e)}}rI._handlePool=0;class Dm{constructor(e,t,i,n,s,o){this.id=e,this._proxy=t,this.notebookData=i,this._selections=[],this._visibleRanges=[],this._visible=!1,this._selections=s,this._visibleRanges=n,this._viewColumn=o}get apiEditor(){if(!this._editor){const e=this;this._editor={get notebook(){return e.notebookData.apiNotebook},get selection(){return e._selections[0]},set selection(t){this.selections=[t]},get selections(){return e._selections},set selections(t){if(!Array.isArray(t)||!t.every(Zc.isNotebookRange))throw $t("selections");e._selections=t,e._trySetSelections(t)},get visibleRanges(){return e._visibleRanges},revealRange(t,i){e._proxy.$tryRevealRange(e.id,mc.from(t),i??dE.Default)},get viewColumn(){return e._viewColumn}},Dm.apiEditorsToExtHost.set(this._editor,this)}return this._editor}get visible(){return this._visible}_acceptVisibility(e){this._visible=e}_acceptVisibleRanges(e){this._visibleRanges=e}_acceptSelections(e){this._selections=e}_trySetSelections(e){this._proxy.$trySetSelections(this.id,e.map(mc.from))}_acceptViewColumn(e){this._viewColumn=e}}Dm.apiEditorsToExtHost=new WeakMap;class fh{get activeNotebookEditor(){var e;return(e=this._activeNotebookEditor)==null?void 0:e.apiEditor}get visibleNotebookEditors(){return this._visibleNotebookEditors.map(e=>e.apiEditor)}constructor(e,t,i,n,s){this._textDocumentsAndEditors=i,this._textDocuments=n,this._extHostFileSystem=s,this._notebookStatusBarItemProviders=new Map,this._documents=new ki,this._editors=new Map,this._onDidChangeActiveNotebookEditor=new A({onListenerError:Fn}),this.onDidChangeActiveNotebookEditor=this._onDidChangeActiveNotebookEditor.event,this._visibleNotebookEditors=[],this._onDidOpenNotebookDocument=new A({onListenerError:Fn}),this.onDidOpenNotebookDocument=this._onDidOpenNotebookDocument.event,this._onDidCloseNotebookDocument=new A({onListenerError:Fn}),this.onDidCloseNotebookDocument=this._onDidCloseNotebookDocument.event,this._onDidChangeVisibleNotebookEditors=new A({onListenerError:Fn}),this.onDidChangeVisibleNotebookEditors=this._onDidChangeVisibleNotebookEditors.event,this._statusBarCache=new To("NotebookCellStatusBarCache"),this._handlePool=0,this._notebookSerializer=new Map,this._notebookProxy=e.getProxy(ce.MainThreadNotebook),this._notebookDocumentsProxy=e.getProxy(ce.MainThreadNotebookDocuments),this._notebookEditorsProxy=e.getProxy(ce.MainThreadNotebookEditors),this._commandsConverter=t.converter,t.registerArgumentProcessor({processArgument:o=>{var a;if(o&&o.$mid===13){const c=(a=o.notebookEditor)==null?void 0:a.notebookUri,d=o.cell.handle,l=this._documents.get(c),u=l==null?void 0:l.getCell(d);if(u)return u.apiCell}if(o&&o.$mid===14){const c=o.uri,d=this._documents.get(c);if(d)return d.apiNotebook}return o}}),fh._registerApiCommands(t)}getEditorById(e){const t=this._editors.get(e);if(!t)throw new Error(`unknown text editor: ${e}. known editors: ${[...this._editors.keys()]} `);return t}getIdByEditor(e){for(const[t,i]of this._editors)if(i.apiEditor===e)return t}get notebookDocuments(){return[...this._documents.values()]}getNotebookDocument(e,t){const i=this._documents.get(e);if(!i&&!t)throw new Error(`NO notebook document for '${e}'`);return i}static _convertNotebookRegistrationData(e,t){if(!t)return;const i=t.filenamePattern.map(n=>Dx.from(n)).filter(n=>n!==void 0);if(t.filenamePattern&&!i){console.warn(`Notebook content provider view options file name pattern is invalid ${t.filenamePattern}`);return}return{extension:e.identifier,providerDisplayName:e.displayName||e.name,displayName:t.displayName,filenamePattern:i,exclusive:t.exclusive||!1}}registerNotebookCellStatusBarItemProvider(e,t,i){const n=fh._notebookStatusBarItemProviderHandlePool++,s=typeof i.onDidChangeCellStatusBarItems=="function"?fh._notebookStatusBarItemProviderHandlePool++:void 0;this._notebookStatusBarItemProviders.set(n,i),this._notebookProxy.$registerNotebookCellStatusBarItemProvider(n,s,t);let o;return s!==void 0&&(o=i.onDidChangeCellStatusBarItems(a=>this._notebookProxy.$emitCellStatusBarEvent(s))),new Yt(()=>{this._notebookStatusBarItemProviders.delete(n),this._notebookProxy.$unregisterNotebookCellStatusBarItemProvider(n,s),o==null||o.dispose()})}async createNotebookDocument(e){const t=await this._notebookDocumentsProxy.$tryCreateNotebook({viewType:e.viewType,content:e.content&&eh.from(e.content)});return k.revive(t)}async openNotebookDocument(e){const t=this._documents.get(e);if(t)return t.apiNotebook;const i=await this._notebookDocumentsProxy.$tryOpenNotebook(e),n=this._documents.get(k.revive(i));return Mi(n==null?void 0:n.apiNotebook)}async showNotebookDocument(e,t){var o;k.isUri(e)&&(e=await this.openNotebookDocument(e));let i;typeof t=="object"?i={position:Hn.from(t.viewColumn),preserveFocus:t.preserveFocus,selections:t.selections&&t.selections.map(mc.from),pinned:typeof t.preview=="boolean"?!t.preview:void 0}:i={preserveFocus:!1};const n=await this._notebookEditorsProxy.$tryShowNotebookDocument(e.uri,e.notebookType,i),s=n&&((o=this._editors.get(n))==null?void 0:o.apiEditor);if(s)return s;throw n?new Error(`Could NOT open editor for "${e.uri.toString()}" because another editor opened in the meantime.`):new Error(`Could NOT open editor for "${e.uri.toString()}".`)}async $provideNotebookCellStatusBarItems(e,t,i,n){const s=this._notebookStatusBarItemProviders.get(e),o=k.revive(t),a=this._documents.get(o);if(!a||!s)return;const c=a.getCellFromIndex(i);if(!c)return;const d=await s.provideCellStatusBarItems(c.apiCell,n);if(!d)return;const l=new me,u=this._statusBarCache.add([l]),g=(Array.isArray(d)?d:[d]).map(m=>dL.from(m,this._commandsConverter,l));return{cacheId:u,items:g}}$releaseNotebookCellStatusBarItems(e){this._statusBarCache.delete(e)}registerNotebookSerializer(e,t,i,n,s){if(ga(t))throw new Error("viewType cannot be empty or just whitespace");const o=this._handlePool++;return this._notebookSerializer.set(o,{viewType:t,serializer:i,options:n}),this._notebookProxy.$registerNotebookSerializer(o,{id:e.identifier,location:e.extensionLocation},t,uL.from(n),fh._convertNotebookRegistrationData(e,s)),ot(()=>{this._notebookProxy.$unregisterNotebookSerializer(o)})}async $dataToNotebook(e,t,i){const n=this._notebookSerializer.get(e);if(!n)throw new Error("NO serializer found");const s=await n.serializer.deserializeNotebook(t.buffer,i);return new rs(eh.from(s))}async $notebookToData(e,t,i){const n=this._notebookSerializer.get(e);if(!n)throw new Error("NO serializer found");const s=await n.serializer.serializeNotebook(eh.to(t.value),i);return De.wrap(s)}async $saveNotebook(e,t,i,n,s){var g;const o=k.revive(t),a=this._notebookSerializer.get(e);if(!a)throw new Error("NO serializer found");const c=this._documents.get(o);if(!c)throw new Error("Document NOT found");if(c.versionId!==i)throw new Error("Document version mismatch");const d={metadata:xC(c.apiNotebook.metadata,m=>{var y;return!(((y=a.options)==null?void 0:y.transientDocumentMetadata)??{})[m]}),cells:[]};for(const m of c.apiNotebook.getCells()){const y=new Lk(m.kind,m.document.getText(),m.document.languageId,m.mime,(g=a.options)!=null&&g.transientOutputs?[]:[...m.outputs],m.metadata,m.executionSummary);y.metadata=xC(m.metadata,_=>{var b;return!(((b=a.options)==null?void 0:b.transientCellMetadata)??{})[_]}),d.cells.push(y)}const l=await a.serializer.serializeNotebook(d,s);await this._extHostFileSystem.value.writeFile(o,l);const u=await this._extHostFileSystem.value.stat(o);return{name:Mt(o),isFile:(u.type&Or.File)!==0,isDirectory:(u.type&Or.Directory)!==0,isSymbolicLink:(u.type&Or.SymbolicLink)!==0,mtime:u.mtime,ctime:u.ctime,size:u.size,readonly:!!((u.permissions??0)&ad.Readonly)||!this._extHostFileSystem.value.isWritableFileSystem(o.scheme),locked:!!((u.permissions??0)&ad.Locked),etag:MP({mtime:u.mtime,size:u.size}),children:void 0}}_createExtHostEditor(e,t,i){if(this._editors.has(t))throw new Error(`editor with id ALREADY EXSIST: ${t}`);const n=new Dm(t,this._notebookEditorsProxy,e,i.visibleRanges.map(mc.to),i.selections.map(mc.to),typeof i.viewColumn=="number"?Hn.to(i.viewColumn):void 0);this._editors.set(t,n)}$acceptDocumentAndEditorsDelta(e){var t,i,n;if(e.value.removedDocuments)for(const s of e.value.removedDocuments){const o=k.revive(s),a=this._documents.get(o);a&&(a.dispose(),this._documents.delete(o),this._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({removedDocuments:a.apiNotebook.getCells().map(c=>c.document.uri)}),this._onDidCloseNotebookDocument.fire(a.apiNotebook));for(const c of this._editors.values())c.notebookData.uri.toString()===o.toString()&&this._editors.delete(c.id)}if(e.value.addedDocuments){const s=[];for(const o of e.value.addedDocuments){const a=k.revive(o.uri);if(this._documents.has(a))throw new Error(`adding EXISTING notebook ${a} `);const c=new rI(this._notebookDocumentsProxy,this._textDocumentsAndEditors,this._textDocuments,a,o);s.push(...o.cells.map(d=>YL.asModelAddData(c.apiNotebook,d))),(t=this._documents.get(a))==null||t.dispose(),this._documents.set(a,c),this._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({addedDocuments:s}),this._onDidOpenNotebookDocument.fire(c.apiNotebook)}}if(e.value.addedEditors)for(const s of e.value.addedEditors){if(this._editors.has(s.id))return;const o=k.revive(s.documentUri),a=this._documents.get(o);a&&this._createExtHostEditor(a,s.id,s)}if(e.value.removedEditors)for(const s of e.value.removedEditors){const o=this._editors.get(s);o&&(this._editors.delete(s),((i=this._activeNotebookEditor)==null?void 0:i.id)===o.id&&(this._activeNotebookEditor=void 0))}if(e.value.visibleEditors){this._visibleNotebookEditors=e.value.visibleEditors.map(o=>this._editors.get(o)).filter(o=>!!o);const s=new Set;this._visibleNotebookEditors.forEach(o=>s.add(o.id));for(const o of this._editors.values()){const a=s.has(o.id);o._acceptVisibility(a)}this._visibleNotebookEditors=[...this._editors.values()].map(o=>o).filter(o=>o.visible),this._onDidChangeVisibleNotebookEditors.fire(this.visibleNotebookEditors)}e.value.newActiveEditor===null?this._activeNotebookEditor=void 0:e.value.newActiveEditor&&(this._editors.get(e.value.newActiveEditor)||console.error(`FAILED to find active notebook editor ${e.value.newActiveEditor}`),this._activeNotebookEditor=this._editors.get(e.value.newActiveEditor)),e.value.newActiveEditor!==void 0&&this._onDidChangeActiveNotebookEditor.fire((n=this._activeNotebookEditor)==null?void 0:n.apiEditor)}static _registerApiCommands(e){const t=we.String.with("notebookType","A notebook type"),i=new Ct("vscode.executeDataToNotebook","_executeDataToNotebook","Invoke notebook serializer",[t,new we("data","Bytes to convert to data",s=>s instanceof Uint8Array,s=>De.wrap(s))],new wt("Notebook Data",s=>eh.to(s.value))),n=new Ct("vscode.executeNotebookToData","_executeNotebookToData","Invoke notebook serializer",[t,new we("NotebookData","Notebook data to convert to bytes",s=>!0,s=>new rs(eh.from(s)))],new wt("Bytes",s=>s.buffer));e.registerApiCommand(i),e.registerApiCommand(n)}}fh._notebookStatusBarItemProviderHandlePool=0;let XL=class{constructor(e){this._actual=new oE(Kc.Dark),this._onDidChangeActiveColorTheme=new A}get activeColorTheme(){return this._actual}$onColorThemeChange(e){let t;switch(e){case"light":t=Kc.Light;break;case"hcDark":t=Kc.HighContrast;break;case"hcLight":t=Kc.HighContrastLight;break;default:t=Kc.Dark}this._actual=new oE(t),this._onDidChangeActiveColorTheme.fire(this._actual)}get onDidChangeActiveColorTheme(){return this._onDidChangeActiveColorTheme.event}};XL=T([v(0,Ii)],XL);class Jpe{constructor(e){this._authenticationProviders=new Map,this._providers=[],this._onDidChangeSessions=new A,this.onDidChangeSessions=this._onDidChangeSessions.event,this._getSessionTaskSingler=new wU,this._getSessionsTaskSingler=new wU,this._proxy=e.getProxy(ce.MainThreadAuthentication)}$setProviders(e){return this._providers=e,Promise.resolve()}async getSession(e,t,i,n={}){const s=fn.toKey(e.identifier),o=[...i].sort().join(" ");return await this._getSessionTaskSingler.getOrCreate(`${s} ${t} ${o}`,async()=>{await this._proxy.$ensureProvider(t);const a=e.displayName||e.name;return this._proxy.$getSession(t,i,s,a,n)})}async getSessions(e,t,i){const n=fn.toKey(e.identifier),s=[...i].sort().join(" ");return await this._getSessionsTaskSingler.getOrCreate(`${n} ${s}`,async()=>{await this._proxy.$ensureProvider(t);const o=e.displayName||e.name;return this._proxy.$getSessions(t,i,n,o)})}async removeSession(e,t){const i=this._authenticationProviders.get(e);return i?i.provider.removeSession(t):this._proxy.$removeSession(e,t)}registerAuthenticationProvider(e,t,i,n){if(this._authenticationProviders.get(e))throw new Error(`An authentication provider with id '${e}' is already registered.`);this._authenticationProviders.set(e,{label:t,provider:i,options:n??{supportsMultipleAccounts:!1}}),this._providers.find(o=>o.id===e)||this._providers.push({id:e,label:t});const s=i.onDidChangeSessions(o=>{this._proxy.$sendDidChangeSessions(e,{added:o.added??[],changed:o.changed??[],removed:o.removed??[]})});return this._proxy.$registerAuthenticationProvider(e,t,(n==null?void 0:n.supportsMultipleAccounts)??!1),new Yt(()=>{s.dispose(),this._authenticationProviders.delete(e);const o=this._providers.findIndex(a=>a.id===e);o>-1&&this._providers.splice(o),this._proxy.$unregisterAuthenticationProvider(e)})}$createSession(e,t,i){const n=this._authenticationProviders.get(e);if(n)return Promise.resolve(n.provider.createSession(t,i));throw new Error(`Unable to find authentication provider with handle: ${e}`)}$removeSession(e,t){const i=this._authenticationProviders.get(e);if(i)return Promise.resolve(i.provider.removeSession(t));throw new Error(`Unable to find authentication provider with handle: ${e}`)}$getSessions(e,t){const i=this._authenticationProviders.get(e);if(i)return Promise.resolve(i.provider.getSessions(t));throw new Error(`Unable to find authentication provider with handle: ${e}`)}$onDidChangeAuthenticationSessions(e,t){return this._onDidChangeSessions.fire({provider:{id:e,label:t}}),Promise.resolve()}}class wU{constructor(){this._inFlightPromises=new Map}getOrCreate(e,t){const i=this._inFlightPromises.get(e);if(i)return i;const n=t().finally(()=>this._inFlightPromises.delete(e));return this._inFlightPromises.set(e,n),n}}class Zpe{constructor(e,t){this._providers=new Map,this._itemsBySourceAndUriMap=new Map,this._proxy=e.getProxy(ce.MainThreadTimeline),t.registerArgumentProcessor({processArgument:(i,n)=>{var s,o,a;if(i&&i.$mid===12)if(this._providers.get(i.source)&&fn.equals(n,(s=this._providers.get(i.source))==null?void 0:s.extension)){const c=i.uri===void 0?void 0:k.revive(i.uri);return(a=(o=this._itemsBySourceAndUriMap.get(i.source))==null?void 0:o.get(bU(c)))==null?void 0:a.get(i.handle)}else return;return i}})}async $getTimeline(e,t,i,n){const s=this._providers.get(e);return s==null?void 0:s.provider.provideTimeline(k.revive(t),i,n)}registerTimelineProvider(e,t,i,n){const s=new me,o=this.convertTimelineItem(t.id,n,s).bind(this);let a;t.onDidChange&&(a=t.onDidChange(d=>this._proxy.$emitTimelineChangeEvent({uri:void 0,reset:!0,...d,id:t.id}),this));const c=this._itemsBySourceAndUriMap;return this.registerTimelineProviderCore({...t,scheme:e,onDidChange:void 0,async provideTimeline(d,l,u){var m;l!=null&&l.resetCache&&(s.clear(),(m=c.get(t.id))==null||m.clear());const h=await t.provideTimeline(d,l,u);if(h==null)return;const g=o(d,l);return{...h,source:t.id,items:h.items.map(g)}},dispose(){var d;for(const l of c.values())(d=l.get(t.id))==null||d.clear();a==null||a.dispose(),s.dispose()}},i)}convertTimelineItem(e,t,i){return(n,s)=>{let o;if(s!=null&&s.cacheResults){let a=this._itemsBySourceAndUriMap.get(e);a===void 0&&(a=new Map,this._itemsBySourceAndUriMap.set(e,a));const c=bU(n);o=a.get(c),o===void 0&&(o=new Map,a.set(c,o))}return a=>{const{iconPath:c,...d}=a,l=`${e}|${a.id??a.timestamp}`;o==null||o.set(l,a);let u,h,g;a.iconPath&&(c instanceof Es?g={id:c.id,color:c.color}:k.isUri(c)?(u=c,h=c):{light:u,dark:h}=c);let m;return Ia.isMarkdownString(d.tooltip)?m=zi.from(d.tooltip):Rt(d.tooltip)?m=d.tooltip:Ia.isMarkdownString(d.detail)?(console.warn("Using deprecated TimelineItem.detail, migrate to TimelineItem.tooltip"),m=zi.from(d.detail)):Rt(d.detail)&&(console.warn("Using deprecated TimelineItem.detail, migrate to TimelineItem.tooltip"),m=d.detail),{...d,id:d.id??void 0,handle:l,source:e,command:a.command?t.toInternal(a.command,i):void 0,icon:u,iconDark:h,themeIcon:g,tooltip:m,accessibilityInformation:a.accessibilityInformation}}}}registerTimelineProviderCore(e,t){if(this._providers.get(e.id))throw new Error(`Timeline Provider ${e.id} already exists.`);return this._proxy.$registerTimelineProvider({id:e.id,label:e.label,scheme:e.scheme}),this._providers.set(e.id,{provider:e,extension:t}),ot(()=>{var n;for(const s of this._itemsBySourceAndUriMap.values())(n=s.get(e.id))==null||n.clear();this._providers.delete(e.id),this._proxy.$unregisterTimelineProvider(e.id),e.dispose()})}}function bU(r){return r==null?void 0:r.toString()}var Gu,zu,GS,ay,kp,Tp,Ip,cy,Rp,zS,KS;class ege extends ne{constructor(e,t,i,n,s,o){super(),Gu.set(this,void 0),zu.set(this,void 0),GS.set(this,void 0),ay.set(this,void 0),kp.set(this,!1),Tp.set(this,void 0),Ip.set(this,void 0),cy.set(this,void 0),Rp.set(this,void 0),zS.set(this,this._register(new A)),this.onDidChangeVisibility=V(this,zS,"f").event,KS.set(this,this._register(new A)),this.onDidDispose=V(this,KS,"f").event,rt(this,GS,i,"f"),rt(this,Ip,n,"f"),rt(this,Gu,e,"f"),rt(this,zu,t,"f"),rt(this,ay,s,"f"),rt(this,Tp,o,"f")}dispose(){V(this,kp,"f")||(rt(this,kp,!0,"f"),V(this,KS,"f").fire(),V(this,ay,"f").dispose(),super.dispose())}get title(){return this.assertNotDisposed(),V(this,Ip,"f")}set title(e){this.assertNotDisposed(),V(this,Ip,"f")!==e&&(rt(this,Ip,e,"f"),V(this,zu,"f").$setWebviewViewTitle(V(this,Gu,"f"),e))}get description(){return this.assertNotDisposed(),V(this,cy,"f")}set description(e){this.assertNotDisposed(),V(this,cy,"f")!==e&&(rt(this,cy,e,"f"),V(this,zu,"f").$setWebviewViewDescription(V(this,Gu,"f"),e))}get visible(){return V(this,Tp,"f")}get webview(){return V(this,ay,"f")}get viewType(){return V(this,GS,"f")}_setVisible(e){e===V(this,Tp,"f")||V(this,kp,"f")||(rt(this,Tp,e,"f"),V(this,zS,"f").fire())}get badge(){return this.assertNotDisposed(),V(this,Rp,"f")}set badge(e){var t,i;this.assertNotDisposed(),!((e==null?void 0:e.value)===((t=V(this,Rp,"f"))==null?void 0:t.value)&&(e==null?void 0:e.tooltip)===((i=V(this,Rp,"f"))==null?void 0:i.tooltip))&&(rt(this,Rp,Ix.from(e),"f"),V(this,zu,"f").$setWebviewViewBadge(V(this,Gu,"f"),e))}show(e){this.assertNotDisposed(),V(this,zu,"f").$show(V(this,Gu,"f"),!!e)}assertNotDisposed(){if(V(this,kp,"f"))throw new Error("Webview is disposed")}}Gu=new WeakMap,zu=new WeakMap,GS=new WeakMap,ay=new WeakMap,kp=new WeakMap,Tp=new WeakMap,Ip=new WeakMap,cy=new WeakMap,Rp=new WeakMap,zS=new WeakMap,KS=new WeakMap;class tge{constructor(e,t){this._extHostWebview=t,this._viewProviders=new Map,this._webviewViews=new Map,this._proxy=e.getProxy(ce.MainThreadWebviewViews)}registerWebviewViewProvider(e,t,i,n){if(this._viewProviders.has(t))throw new Error(`View provider for '${t}' already registered`);return this._viewProviders.set(t,{provider:i,extension:e}),this._proxy.$registerWebviewViewProvider(Ox(e),t,{retainContextWhenHidden:n==null?void 0:n.retainContextWhenHidden,serializeBuffersForPostMessage:Em(e)}),new Yt(()=>{this._viewProviders.delete(t),this._proxy.$unregisterWebviewViewProvider(t)})}async $resolveWebviewView(e,t,i,n,s){const o=this._viewProviders.get(t);if(!o)throw new Error(`No view provider found for '${t}'`);const{provider:a,extension:c}=o,d=this._extHostWebview.createNewWebview(e,{},c),l=new ege(e,this._proxy,t,i,d,!0);this._webviewViews.set(e,l),await a.resolveWebviewView(l,{state:n},s)}async $onDidChangeWebviewViewVisibility(e,t){this.getWebviewView(e)._setVisible(t)}async $disposeWebviewView(e){const t=this.getWebviewView(e);this._webviewViews.delete(e),t.dispose(),this._extHostWebview.deleteWebview(e)}getWebviewView(e){const t=this._webviewViews.get(e);if(!t)throw new Error("No webview found");return t}}class ige{constructor(e,t){this.document=e,this._storagePath=t,this._backupCounter=1,this._edits=new To("custom documents")}addEdit(e){return this._edits.add([e])}async undo(e,t){await this.getEdit(e).undo(),t||this.disposeBackup()}async redo(e,t){await this.getEdit(e).redo(),t||this.disposeBackup()}disposeEdits(e){for(const t of e)this._edits.delete(t)}getNewBackupUri(){if(!this._storagePath)throw new Error("Backup requires a valid storage path");const e=cge(this.document.uri)+this._backupCounter++;return pt(this._storagePath,e)}updateBackup(e){var t;(t=this._backup)==null||t.delete(),this._backup=e}disposeBackup(){var e;(e=this._backup)==null||e.delete(),this._backup=void 0}getEdit(e){const t=this._edits.get(e,0);if(!t)throw new Error("No edit found");return t}}class nge{constructor(){this._documents=new Map}get(e,t){return this._documents.get(this.key(e,t))}add(e,t,i){const n=this.key(e,t.uri);if(this._documents.has(n))throw new Error(`Document already exists for viewType:${e} resource:${t.uri}`);const s=new ige(t,i);return this._documents.set(n,s),s}delete(e,t){const i=this.key(e,t.uri);this._documents.delete(i)}key(e,t){return`${e}@@@${t}`}}class rge{constructor(){this._providers=new Map}addTextProvider(e,t,i){return this.add(0,e,t,i)}addCustomProvider(e,t,i){return this.add(1,e,t,i)}get(e){return this._providers.get(e)}add(e,t,i,n){if(this._providers.has(t))throw new Error(`Provider for viewType:${t} already registered`);return this._providers.set(t,{type:e,extension:i,provider:n}),new Yt(()=>this._providers.delete(t))}}class sge{constructor(e,t,i,n,s){this._extHostDocuments=t,this._extensionStoragePaths=i,this._extHostWebview=n,this._extHostWebviewPanels=s,this._editorProviders=new rge,this._documents=new nge,this._proxy=e.getProxy(ce.MainThreadCustomEditors)}registerCustomEditorProvider(e,t,i,n){const s=new me;return oge(i)?(s.add(this._editorProviders.addTextProvider(t,e,i)),this._proxy.$registerTextEditorProvider(Ox(e),t,n.webviewOptions||{},{supportsMove:!!i.moveCustomTextEditor},Em(e))):(s.add(this._editorProviders.addCustomProvider(t,e,i)),Zb(i)&&s.add(i.onDidChangeCustomDocument(o=>{const a=this.getCustomDocumentEntry(t,o.document.uri);if(age(o)){const c=a.addEdit(o);this._proxy.$onDidEdit(o.document.uri,t,c,o.label)}else this._proxy.$onContentChange(o.document.uri,t)})),this._proxy.$registerCustomEditorProvider(Ox(e),t,n.webviewOptions||{},!!n.supportsMultipleEditorsPerDocument,Em(e))),Yt.from(s,new Yt(()=>{this._proxy.$unregisterEditorProvider(t)}))}async $createCustomDocument(e,t,i,n,s){const o=this._editorProviders.get(t);if(!o)throw new Error(`No provider found for '${t}'`);if(o.type!==1)throw new Error(`Invalid provide type for '${t}'`);const a=k.revive(e),c=await o.provider.openCustomDocument(a,{backupId:i,untitledDocumentData:n==null?void 0:n.buffer},s);let d;return Zb(o.provider)&&this._extensionStoragePaths&&(d=this._extensionStoragePaths.workspaceValue(o.extension)??this._extensionStoragePaths.globalValue(o.extension)),this._documents.add(t,c,d),{editable:Zb(o.provider)}}async $disposeCustomDocument(e,t){const i=this._editorProviders.get(t);if(!i)throw new Error(`No provider found for '${t}'`);if(i.type!==1)throw new Error(`Invalid provider type for '${t}'`);const n=k.revive(e),{document:s}=this.getCustomDocumentEntry(t,n);this._documents.delete(t,s),s.dispose()}async $resolveCustomEditor(e,t,i,n,s,o){const a=this._editorProviders.get(i);if(!a)throw new Error(`No provider found for '${i}'`);const c=Hn.to(s),d=this._extHostWebview.createNewWebview(t,n.contentOptions,a.extension),l=this._extHostWebviewPanels.createNewWebviewPanel(t,i,n.title,c,n.options,d,n.active),u=k.revive(e);switch(a.type){case 1:{const{document:h}=this.getCustomDocumentEntry(i,u);return a.provider.resolveCustomEditor(h,l,o)}case 0:{const h=this._extHostDocuments.getDocument(u);return a.provider.resolveCustomTextEditor(h,l,o)}default:throw new Error("Unknown webview provider type")}}$disposeEdits(e,t,i){this.getCustomDocumentEntry(t,e).disposeEdits(i)}async $onMoveCustomEditor(e,t,i){const n=this._editorProviders.get(i);if(!n)throw new Error(`No provider found for '${i}'`);if(!n.provider.moveCustomTextEditor)throw new Error(`Provider does not implement move '${i}'`);const s=this._extHostWebviewPanels.getWebviewPanel(e);if(!s)throw new Error("No webview found");const o=k.revive(t),a=this._extHostDocuments.getDocument(o);await n.provider.moveCustomTextEditor(a,s,_t.None)}async $undo(e,t,i,n){return this.getCustomDocumentEntry(t,e).undo(i,n)}async $redo(e,t,i,n){return this.getCustomDocumentEntry(t,e).redo(i,n)}async $revert(e,t,i){const n=this.getCustomDocumentEntry(t,e);await this.getCustomEditorProvider(t).revertCustomDocument(n.document,i),n.disposeBackup()}async $onSave(e,t,i){const n=this.getCustomDocumentEntry(t,e);await this.getCustomEditorProvider(t).saveCustomDocument(n.document,i),n.disposeBackup()}async $onSaveAs(e,t,i,n){const s=this.getCustomDocumentEntry(t,e);return this.getCustomEditorProvider(t).saveCustomDocumentAs(s.document,k.revive(i),n)}async $backup(e,t,i){const n=this.getCustomDocumentEntry(t,e),o=await this.getCustomEditorProvider(t).backupCustomDocument(n.document,{destination:n.getNewBackupUri()},i);return n.updateBackup(o),o.id}getCustomDocumentEntry(e,t){const i=this._documents.get(e,k.revive(t));if(!i)throw new Error("No custom document found");return i}getCustomEditorProvider(e){const t=this._editorProviders.get(e),i=t==null?void 0:t.provider;if(!i||!Zb(i))throw new Error("Custom document is not editable");return i}}function Zb(r){return!!r.onDidChangeCustomDocument}function oge(r){return typeof r.resolveCustomTextEditor=="function"}function age(r){return typeof r.undo=="function"&&typeof r.redo=="function"}function cge(r){const e=r.scheme===pe.file||r.scheme===pe.untitled?r.fsPath:r.toString();return yc(e)+""}var Ku,Qu,QS,dy,YS,Pp,ly,Yu,XS,uy,Ap,JS,ZS;class dge extends ne{constructor(e,t,i,n){super(),Ku.set(this,void 0),Qu.set(this,void 0),QS.set(this,void 0),dy.set(this,void 0),YS.set(this,void 0),Pp.set(this,void 0),ly.set(this,void 0),Yu.set(this,void 0),XS.set(this,!0),uy.set(this,void 0),Ap.set(this,!1),JS.set(this,this._register(new A)),this.onDidDispose=V(this,JS,"f").event,ZS.set(this,this._register(new A)),this.onDidChangeViewState=V(this,ZS,"f").event,rt(this,Ku,e,"f"),rt(this,Qu,t,"f"),rt(this,dy,i,"f"),rt(this,QS,n.viewType,"f"),rt(this,YS,n.panelOptions,"f"),rt(this,Yu,n.viewColumn,"f"),rt(this,Pp,n.title,"f"),rt(this,uy,n.active,"f")}dispose(){V(this,Ap,"f")||(rt(this,Ap,!0,"f"),V(this,JS,"f").fire(),V(this,Qu,"f").$disposeWebview(V(this,Ku,"f")),V(this,dy,"f").dispose(),super.dispose())}get webview(){return this.assertNotDisposed(),V(this,dy,"f")}get viewType(){return this.assertNotDisposed(),V(this,QS,"f")}get title(){return this.assertNotDisposed(),V(this,Pp,"f")}set title(e){this.assertNotDisposed(),V(this,Pp,"f")!==e&&(rt(this,Pp,e,"f"),V(this,Qu,"f").$setTitle(V(this,Ku,"f"),e))}get iconPath(){return this.assertNotDisposed(),V(this,ly,"f")}set iconPath(e){this.assertNotDisposed(),V(this,ly,"f")!==e&&(rt(this,ly,e,"f"),V(this,Qu,"f").$setIconPath(V(this,Ku,"f"),k.isUri(e)?{light:e,dark:e}:e))}get options(){return V(this,YS,"f")}get viewColumn(){if(this.assertNotDisposed(),!(typeof V(this,Yu,"f")=="number"&&V(this,Yu,"f")<0))return V(this,Yu,"f")}get active(){return this.assertNotDisposed(),V(this,uy,"f")}get visible(){return this.assertNotDisposed(),V(this,XS,"f")}_updateViewState(e){V(this,Ap,"f")||(this.active!==e.active||this.visible!==e.visible||this.viewColumn!==e.viewColumn)&&(rt(this,uy,e.active,"f"),rt(this,XS,e.visible,"f"),rt(this,Yu,e.viewColumn,"f"),V(this,ZS,"f").fire({webviewPanel:this}))}reveal(e,t){this.assertNotDisposed(),V(this,Qu,"f").$reveal(V(this,Ku,"f"),{viewColumn:typeof e>"u"?void 0:Hn.from(e),preserveFocus:!!t})}assertNotDisposed(){if(V(this,Ap,"f"))throw new Error("Webview is disposed")}}Ku=new WeakMap,Qu=new WeakMap,QS=new WeakMap,dy=new WeakMap,YS=new WeakMap,Pp=new WeakMap,ly=new WeakMap,Yu=new WeakMap,XS=new WeakMap,uy=new WeakMap,Ap=new WeakMap,JS=new WeakMap,ZS=new WeakMap;class V${static newHandle(){return Nn()}constructor(e,t,i){this.webviews=t,this.workspace=i,this._webviewPanels=new Map,this._serializers=new Map,this._proxy=e.getProxy(ce.MainThreadWebviewPanels)}createWebviewPanel(e,t,i,n,s={}){const o=typeof n=="object"?n.viewColumn:n,a={viewColumn:Hn.from(o),preserveFocus:typeof n=="object"&&!!n.preserveFocus},c=Em(e),d=V$.newHandle();this._proxy.$createWebviewPanel(Ox(e),d,t,{title:i,panelOptions:lge(s),webviewOptions:z5(e,this.workspace,s),serializeBuffersForPostMessage:c},a);const l=this.webviews.createNewWebview(d,s,e);return this.createNewWebviewPanel(d,t,i,o,s,l,!0)}$onDidChangeWebviewPanelViewStates(e){const t=Object.keys(e);t.sort((i,n)=>{const s=e[i],o=e[n];return s.active?1:o.active?-1:+s.visible-+o.visible});for(const i of t){const n=this.getWebviewPanel(i);if(!n)continue;const s=e[i];n._updateViewState({active:s.active,visible:s.visible,viewColumn:Hn.to(s.position)})}}async $onDidDisposeWebviewPanel(e){const t=this.getWebviewPanel(e);t==null||t.dispose(),this._webviewPanels.delete(e),this.webviews.deleteWebview(e)}registerWebviewPanelSerializer(e,t,i){if(this._serializers.has(t))throw new Error(`Serializer for '${t}' already registered`);return this._serializers.set(t,{serializer:i,extension:e}),this._proxy.$registerSerializer(t,{serializeBuffersForPostMessage:Em(e)}),new Yt(()=>{this._serializers.delete(t),this._proxy.$unregisterSerializer(t)})}async $deserializeWebviewPanel(e,t,i,n){const s=this._serializers.get(t);if(!s)throw new Error(`No serializer found for '${t}'`);const{serializer:o,extension:a}=s,c=this.webviews.createNewWebview(e,i.webviewOptions,a),d=this.createNewWebviewPanel(e,t,i.title,n,i.panelOptions,c,i.active);await o.deserializeWebviewPanel(d,i.state)}createNewWebviewPanel(e,t,i,n,s,o,a){const c=new dge(e,this._proxy,o,{viewType:t,title:i,viewColumn:n,panelOptions:s,active:a});return this._webviewPanels.set(e,c),c}getWebviewPanel(e){return this._webviewPanels.get(e)}}function lge(r){return{enableFindWidget:r.enableFindWidget,retainContextWhenHidden:r.retainContextWhenHidden}}let JL=class{constructor(e,t){this._proxy=e.getProxy(ce.MainThreadBulkEdits),this._versionInformationProvider={getTextDocumentVersion:i=>{var n;return(n=t.getDocument(i))==null?void 0:n.version},getNotebookDocumentVersion:()=>{}}}applyWorkspaceEdit(e,t,i){const n=bo.from(e,this._versionInformationProvider);return this._proxy.$tryApplyWorkspaceEdit(n,void 0,(i==null?void 0:i.isRefactoring)??!1)}};JL=T([v(0,Ii)],JL);var Xa,hy;let ZL=class{constructor(e,t,i){this.editors=i,this.resultsChangedEmitter=new A,this.controllers=new Map,this.onResultsChanged=this.resultsChangedEmitter.event,this.results=[],this.proxy=e.getProxy(ce.MainThreadTesting),this.observer=new vge(this.proxy),this.runTracker=new fge(this.proxy),t.registerArgumentProcessor({processArgument:n=>{var c;if((n==null?void 0:n.$mid)!==15)return n;const s=n,o=s.tests[s.tests.length-1].item.extId,a=this.controllers.get(Et.root(o));return((c=a==null?void 0:a.collection.tree.get(o))==null?void 0:c.actual)??Ofe(n)}}),t.registerCommand(!1,"testing.getExplorerSelection",async()=>{const n=await t.executeCommand("_testing.getExplorerSelection"),s=o=>{var c;const a=this.controllers.get(Et.root(o));if(a)return Et.isRoot(o)?a.controller:(c=a.collection.tree.get(o))==null?void 0:c.actual};return{include:(n==null?void 0:n.include.map(s).filter(Op))||[],exclude:(n==null?void 0:n.exclude.map(s).filter(Op))||[]}})}createTestController(e,t,i,n){if(this.controllers.has(t))throw new Error(`Attempt to insert a duplicate controller with ID "${t}"`);const s=new me,o=s.add(new Nfe(t,i,this.editors));o.root.label=i;const a=new Map,c=this.proxy,d={items:o.root.children,get label(){return i},set label(u){i=u,o.root.label=u,c.$updateController(t,{label:i})},get refreshHandler(){return n},set refreshHandler(u){n=u,c.$updateController(t,{canRefresh:!!u})},get id(){return t},createRunProfile:(u,h,g,m,y,_)=>{let b=yc(u);for(;a.has(b);)b++;return new d8(this.proxy,a,t,b,u,h,g,m,y,_)},createTestItem(u,h,g){return new Qf(t,u,h,g)},createTestRun:(u,h,g=!0)=>this.runTracker.createTestRun(t,o,u,h,g),invalidateTestResults:u=>{He(e,"testInvalidateResults");for(const h of u instanceof Array?u:[u]){const g=h?Et.fromExtHostTestItem(h,t).toString():t;this.proxy.$markTestRetired(g)}},set resolveHandler(u){o.resolveHandler=u},get resolveHandler(){return o.resolveHandler},dispose:()=>{s.dispose()}};c.$registerTestController(t,i,!!n),s.add(ot(()=>c.$unregisterTestController(t)));const l={controller:d,collection:o,profiles:a};return this.controllers.set(t,l),s.add(ot(()=>this.controllers.delete(t))),s.add(o.onDidGenerateDiff(u=>c.$publishDiff(t,u.map(pm.serialize)))),d}createTestObserver(){return this.observer.checkout()}async runTests(e,t=_t.None){var s,o;const i=c8(e);if(!i)throw new Error("The request passed to `vscode.test.runTests` must include a profile");const n=this.controllers.get(i.controllerId);if(!n)throw new Error("Controller not found");await this.proxy.$runTests({isUiTriggered:!1,targets:[{testIds:((s=e.include)==null?void 0:s.map(a=>Et.fromExtHostTestItem(a,n.collection.root.id).toString()))??[n.collection.root.id],profileGroup:q$[i.kind],profileId:i.profileId,controllerId:i.controllerId}],exclude:(o=e.exclude)==null?void 0:o.map(a=>a.id)},t)}$syncTests(){for(const{collection:e}of this.controllers.values())e.flushDiff();return Promise.resolve()}$provideFileCoverage(e,t,i){const n=bH(this.runTracker.trackers,s=>s.id===e?s.getCoverage(t):void 0);return(n==null?void 0:n.provideFileCoverage(i))??Promise.resolve([])}$resolveFileCoverage(e,t,i,n){const s=bH(this.runTracker.trackers,o=>o.id===e?o.getCoverage(t):void 0);return(s==null?void 0:s.resolveFileCoverage(i,n))??Promise.resolve([])}$configureRunProfile(e,t){var i,n,s;(s=(n=(i=this.controllers.get(e))==null?void 0:i.profiles.get(t))==null?void 0:n.configureHandler)==null||s.call(n)}async $refreshTests(e,t){var i,n,s;await((s=(i=this.controllers.get(e))==null?void 0:(n=i.controller).refreshHandler)==null?void 0:s.call(n,t))}$publishTestResults(e){this.results=Object.freeze(e.map(t=>qq(hL.to(t))).concat(this.results).sort((t,i)=>i.completedAt-t.completedAt).slice(0,32)),this.resultsChangedEmitter.fire()}async $expandTest(e,t){var n;const i=(n=this.controllers.get(Et.fromString(e).controllerId))==null?void 0:n.collection;i&&(await i.expand(e,t<0?1/0:t),i.flushDiff())}$acceptDiff(e){this.observer.applyDiff(e.map(pm.deserialize))}async $runControllerTests(e,t){return Promise.all(e.map(i=>this.runControllerTestRequest(i,!1,t)))}async $startContinuousRun(e,t){const i=new Xt(t),n=await Promise.all(e.map(s=>this.runControllerTestRequest(s,!0,i.token)));return!t.isCancellationRequested&&!n.some(s=>s.error)&&await new Promise(s=>t.onCancellationRequested(s)),i.dispose(!0),n}async runControllerTestRequest(e,t,i){const n=this.controllers.get(e.controllerId);if(!n)return{};const{collection:s,profiles:o}=n,a=o.get(e.profileId);if(!a)return{};const c=e.testIds.map(h=>s.tree.get(h)).filter(Op),d=e.excludeExtIds.map(h=>n.collection.tree.get(h)).filter(Op).filter(h=>c.some(g=>g.fullId.compare(h.fullId)===2));if(!c.length)return{};const l=new Xg(c.some(h=>h.actual instanceof B$)?void 0:c.map(h=>h.actual),d.map(h=>h.actual),a,t),u=ife(e)&&this.runTracker.prepareForMainThreadTestRun(l,lw.fromInternal(e,n.collection),i);try{return await a.runHandler(l,i),{}}catch(h){return{error:String(h)}}finally{u&&(u.hasRunningTasks&&!i.isCancellationRequested&&await F.toPromise(u.onEnd),u.dispose())}}$cancelExtensionTestRun(e){e===void 0?this.runTracker.cancelAllRuns():this.runTracker.cancelRunById(e)}};ZL=T([v(0,Ii)],ZL);const uge=1e4;class hge extends ne{get hasRunningTasks(){return this.tasks.size>0}get id(){return this.dto.id}constructor(e,t,i){super(),this.dto=e,this.proxy=t,this.state=0,this.tasks=new Map,this.sharedTestIds=new Set,this.endEmitter=this._register(new A),this.onEnd=this.endEmitter.event,this.cts=this._register(new Xt(i));const n=this._register(new Ys(()=>this.forciblyEndTasks(),uge));this._register(this.cts.token.onCancellationRequested(()=>n.schedule()))}cancel(){this.state===0?(this.cts.cancel(),this.state=1):this.state===1&&this.forciblyEndTasks()}getCoverage(e){var t;return(t=this.tasks.get(e))==null?void 0:t.coverage}createRun(e){const t=this.dto.id,i=this.dto.controllerId,n=Nn(),s=new pge(this.proxy,t,n),o=l=>(u,...h)=>{if(c){console.warn(`Setting the state of test "${u.id}" is a no-op after the run ends.`);return}this.dto.isIncluded(u)&&(this.ensureTestIsKnown(u),l(u,...h))},a=(l,u)=>{const h=u instanceof Array?u.map(ow.from):[ow.from(u)];if(l.uri&&l.range){const g={range:ge.from(l.range),uri:l.uri};for(const m of h)m.location=m.location||g}this.proxy.$appendTestMessagesInRun(t,n,Et.fromExtHostTestItem(l,i).toString(),h)};let c=!1;const d={isPersisted:this.dto.isPersisted,token:this.cts.token,name:e,get coverageProvider(){return s.coverageProvider},set coverageProvider(l){s.coverageProvider=l},enqueued:o(l=>{this.proxy.$updateTestStateInRun(t,n,Et.fromExtHostTestItem(l,i).toString(),1)}),skipped:o(l=>{this.proxy.$updateTestStateInRun(t,n,Et.fromExtHostTestItem(l,i).toString(),5)}),started:o(l=>{this.proxy.$updateTestStateInRun(t,n,Et.fromExtHostTestItem(l,i).toString(),2)}),errored:o((l,u,h)=>{a(l,u),this.proxy.$updateTestStateInRun(t,n,Et.fromExtHostTestItem(l,i).toString(),6,h)}),failed:o((l,u,h)=>{a(l,u),this.proxy.$updateTestStateInRun(t,n,Et.fromExtHostTestItem(l,i).toString(),4,h)}),passed:o((l,u)=>{this.proxy.$updateTestStateInRun(t,n,Et.fromExtHostTestItem(l,this.dto.controllerId).toString(),3,u)}),appendOutput:(l,u,h)=>{c||(h&&(this.dto.isIncluded(h)?this.ensureTestIsKnown(h):h=void 0),this.proxy.$appendOutputToRun(t,n,De.fromString(l),u&&So.from(u),h&&Et.fromExtHostTestItem(h,i).toString()))},end:()=>{c||(c=!0,this.proxy.$finishedTestRunTask(t,n),this.tasks.delete(n),this.tasks.size||this.markEnded())}};return this.tasks.set(n,{run:d,coverage:s}),this.proxy.$startedTestRunTask(t,{id:n,name:e,running:!0}),d}forciblyEndTasks(){for(const{run:e}of this.tasks.values())e.end()}markEnded(){this.state!==2&&(this.state=2,this.endEmitter.fire())}ensureTestIsKnown(e){if(!(e instanceof Qf))throw new lx(e.id);if(this.sharedTestIds.has(Et.fromExtHostTestItem(e,this.dto.controllerId).toString()))return;const t=[],i=this.dto.colllection.root;for(;;){const n=hu.from(e);if(t.unshift(n),this.sharedTestIds.has(n.extId)||(this.sharedTestIds.add(n.extId),e===i))break;e=e.parent||i}this.proxy.$addTestsToRun(this.dto.controllerId,this.dto.id,t)}}class fge{get trackers(){return this.tracked.values()}constructor(e){this.proxy=e,this.tracked=new Map}prepareForMainThreadTestRun(e,t,i){return this.getTracker(e,t,i)}cancelRunById(e){for(const t of this.tracked.values())if(t.id===e){t.cancel();return}}cancelAllRuns(){for(const e of this.tracked.values())e.cancel()}createTestRun(e,t,i,n,s){var l,u;const o=this.tracked.get(i);if(o)return o.createRun(n);const a=lw.fromPublic(e,t,i,s),c=c8(i);this.proxy.$startedExtensionTestRun({controllerId:e,continuous:!!i.continuous,profile:c&&{group:q$[c.kind],id:c.profileId},exclude:((l=i.exclude)==null?void 0:l.map(h=>Et.fromExtHostTestItem(h,t.root.id).toString()))??[],id:a.id,include:((u=i.include)==null?void 0:u.map(h=>Et.fromExtHostTestItem(h,t.root.id).toString()))??[t.root.id],persist:s});const d=this.getTracker(i,a);return d.onEnd(()=>{this.proxy.$finishedExtensionTestRun(a.id),d.dispose()}),d.createRun(n)}getTracker(e,t,i){const n=new hge(t,this.proxy,i);return this.tracked.set(e,n),n.onEnd(()=>this.tracked.delete(e)),n}}const c8=r=>{if(r.profile){if(!(r.profile instanceof d8))throw new Error("TestRunRequest.profile is not an instance created from TestController.createRunProfile");return r.profile}};class lw{static fromPublic(e,t,i,n){var s,o;return new lw(e,Nn(),((s=i.include)==null?void 0:s.map(a=>Et.fromExtHostTestItem(a,e).toString()))??[e],((o=i.exclude)==null?void 0:o.map(a=>Et.fromExtHostTestItem(a,e).toString()))??[],n,t)}static fromInternal(e,t){return new lw(e.controllerId,e.runId,e.testIds,e.excludeExtIds,!0,t)}constructor(e,t,i,n,s,o){this.controllerId=e,this.id=t,this.isPersisted=s,this.colllection=o,this.includePrefix=i.map(a=>a+"\0"),this.excludePrefix=n.map(a=>a+"\0")}isIncluded(e){const t=Et.fromExtHostTestItem(e,this.controllerId).toString()+"\0";for(const i of this.excludePrefix)if(t===i||t.startsWith(i))return!1;for(const i of this.includePrefix)if(t===i||t.startsWith(i))return!0;return!1}}class pge{set coverageProvider(e){if(this._coverageProvider)throw new Error("The TestCoverageProvider cannot be replaced after being provided");e&&(this._coverageProvider=e,this.proxy.$signalCoverageAvailable(this.runId,this.taskId))}get coverageProvider(){return this._coverageProvider}constructor(e,t,i){this.proxy=e,this.runId=t,this.taskId=i}async provideFileCoverage(e){if(!this._coverageProvider)return[];this.fileCoverage||(this.fileCoverage=(async()=>this._coverageProvider.provideFileCoverage(e))());try{const t=await this.fileCoverage;return(t==null?void 0:t.map(Tx.fromFile))??[]}catch(t){throw this.fileCoverage=void 0,t}}async resolveFileCoverage(e,t){var s,o,a;const i=await this.fileCoverage;let n=i==null?void 0:i[e];return!this._coverageProvider||!i||!n?[]:(n.detailedCoverage||(n=i[e]=await((o=(s=this._coverageProvider).resolveFileCoverage)==null?void 0:o.call(s,n,t))??n),((a=n.detailedCoverage)==null?void 0:a.map(Tx.fromDetailed))??[])}}class gge{get isEmpty(){return this.added.size===0&&this.removed.size===0&&this.updated.size===0}constructor(e){this.emitter=e,this.added=new Set,this.updated=new Set,this.removed=new Set,this.alreadyRemoved=new Set}add(e){this.added.add(e)}update(e){Object.assign(e.revived,hu.toPlain(e.item)),this.added.has(e)||this.updated.add(e)}remove(e){if(this.added.has(e)){this.added.delete(e);return}this.updated.delete(e);const t=Et.parentId(e.item.extId);if(t&&this.alreadyRemoved.has(t.toString())){this.alreadyRemoved.add(e.item.extId);return}this.removed.add(e)}getChangeEvent(){const{added:e,updated:t,removed:i}=this;return{get added(){return[...e].map(n=>n.revived)},get updated(){return[...t].map(n=>n.revived)},get removed(){return[...i].map(n=>n.revived)}}}complete(){this.isEmpty||this.emitter.fire(this.getChangeEvent())}}class mge extends rfe{constructor(){super(...arguments),this.changeEmitter=new A,this.onDidChangeTests=this.changeEmitter.event}get rootTests(){return super.roots}getMirroredTestDataById(e){return this.items.get(e)}getMirroredTestDataByReference(e){return this.items.get(e.id)}createItem(e,t){return{...e,revived:hu.toPlain(e.item),depth:t?t.depth+1:0,children:new Set}}createChangeCollector(){return new gge(this.changeEmitter)}}class vge{constructor(e){this.proxy=e}checkout(){this.current||(this.current=this.createObserverData());const e=this.current;return e.observers++,{onDidChangeTest:e.tests.onDidChangeTests,get tests(){return[...e.tests.rootTests].map(t=>t.revived)},dispose:eb(()=>{--e.observers===0&&(this.proxy.$unsubscribeFromDiffs(),this.current=void 0)})}}getMirroredTestDataByReference(e){var t;return(t=this.current)==null?void 0:t.tests.getMirroredTestDataByReference(e)}applyDiff(e){var t;(t=this.current)==null||t.tests.apply(e)}createObserverData(){const e=new mge;return this.proxy.$subscribeToDiffs(),{observers:0,tests:e}}}class d8{get label(){return this._label}set label(e){e!==this._label&&(this._label=e,V(this,Xa,"f").$updateTestRunConfig(this.controllerId,this.profileId,{label:e}))}get supportsContinuousRun(){return this._supportsContinuousRun}set supportsContinuousRun(e){e!==this._supportsContinuousRun&&(this._supportsContinuousRun=e,V(this,Xa,"f").$updateTestRunConfig(this.controllerId,this.profileId,{supportsContinuousRun:e}))}get isDefault(){return this._isDefault}set isDefault(e){e!==this._isDefault&&(this._isDefault=e,V(this,Xa,"f").$updateTestRunConfig(this.controllerId,this.profileId,{isDefault:e}))}get tag(){return this._tag}set tag(e){var t;(e==null?void 0:e.id)!==((t=this._tag)==null?void 0:t.id)&&(this._tag=e,V(this,Xa,"f").$updateTestRunConfig(this.controllerId,this.profileId,{tag:e?Ma.namespace(this.controllerId,e.id):null}))}get configureHandler(){return this._configureHandler}set configureHandler(e){e!==this._configureHandler&&(this._configureHandler=e,V(this,Xa,"f").$updateTestRunConfig(this.controllerId,this.profileId,{hasConfigurationHandler:!!e}))}constructor(e,t,i,n,s,o,a,c=!1,d=void 0,l=!1){this.controllerId=i,this.profileId=n,this._label=s,this.kind=o,this.runHandler=a,this._isDefault=c,this._tag=d,this._supportsContinuousRun=l,Xa.set(this,void 0),hy.set(this,void 0),rt(this,Xa,e,"f"),rt(this,hy,t,"f"),t.set(n,this);const u=q$[o];if(typeof u!="number")throw new Error(`Unknown TestRunProfile.group ${o}`);V(this,Xa,"f").$publishTestRunProfile({profileId:n,controllerId:i,tag:d?Ma.namespace(this.controllerId,d.id):null,label:s,group:u,isDefault:c,hasConfigurationHandler:!1,supportsContinuousRun:l})}dispose(){var e;(e=V(this,hy,"f"))!=null&&e.delete(this.profileId)&&(rt(this,hy,void 0,"f"),V(this,Xa,"f").$removeTestProfile(this.controllerId,this.profileId))}}Xa=new WeakMap,hy=new WeakMap;const q$={[Lh.Coverage]:8,[Lh.Debug]:4,[Lh.Run]:2};class sI{constructor(e){this._openers=new Map,this._proxy=e.getProxy(ce.MainThreadUriOpeners)}registerExternalUriOpener(e,t,i,n){if(this._openers.has(t))throw new Error(`Opener with id '${t}' already registered`);const s=n.schemes.find(o=>!sI.supportedSchemes.has(o));if(s)throw new Error(`Scheme '${s}' is not supported. Only http and https are currently supported.`);return this._openers.set(t,i),this._proxy.$registerUriOpener(t,n.schemes,e,n.label),ot(()=>{this._openers.delete(t),this._proxy.$unregisterUriOpener(t)})}async $canOpenUri(e,t,i){const n=this._openers.get(e);if(!n)throw new Error(`Unknown opener with id: ${e}`);const s=k.revive(t);return n.canOpenExternalUri(s,i)}async $openUri(e,t,i){const n=this._openers.get(e);if(!n)throw new Error(`Unknown opener id: '${e}'`);return n.openExternalUri(k.revive(t.resolvedUri),{sourceUri:k.revive(t.sourceUri)},i)}}sI.supportedSchemes=new Set([pe.http,pe.https]);var xl;(function(r){r[r.Output=1]="Output",r[r.OutputItems=2]="OutputItems",r[r.ExecutionState=3]="ExecutionState"})(xl||(xl={}));let eF=class{constructor(e,t,i,n,s){this._initData=t,this._extHostNotebook=i,this._commands=n,this._logService=s,this._activeExecutions=new ki,this._activeNotebookExecutions=new ki,this._kernelDetectionTask=new Map,this._kernelDetectionTaskHandlePool=0,this._kernelSourceActionProviders=new Map,this._kernelSourceActionProviderHandlePool=0,this._kernelSourceActionProviderCache=new To("NotebookKernelSourceActionProviderCache"),this._kernelData=new Map,this._handlePool=0,this._onDidChangeCellExecutionState=new A,this.onDidChangeNotebookCellExecutionState=this._onDidChangeCellExecutionState.event,this._proxy=e.getProxy(ce.MainThreadNotebookKernels);const o=new Ct("notebook.selectKernel","_notebook.selectKernel","Trigger kernel picker for specified notebook editor widget",[new we("options","Select kernel options",a=>!0,a=>{if(a&&"notebookEditor"in a&&"id"in a){const c=this._extHostNotebook.getIdByEditor(a.notebookEditor);return{id:a.id,extension:a.extension,notebookEditorId:c}}else if(a&&"notebookEditor"in a){const c=this._extHostNotebook.getIdByEditor(a.notebookEditor);if(c===void 0)throw new Error(`Cannot invoke 'notebook.selectKernel' for unrecognized notebook editor ${a.notebookEditor.notebook.uri.toString()}`);return{notebookEditorId:c}}return a})],wt.Void);this._commands.registerApiCommand(o)}createNotebookController(e,t,i,n,s,o){for(const M of this._kernelData.values())if(M.controller.id===t&&fn.equals(e.identifier,M.extensionId))throw new Error(`notebook controller with id '${t}' ALREADY exist`);const a=this._handlePool++,c=this;this._logService.trace(`NotebookController[${a}], CREATED by ${e.identifier.value}, ${t}`);const d=()=>console.warn(`NO execute handler from notebook controller '${m.id}' of extension: '${e.identifier}'`);let l=!1;const u=new me,h=new A,g=new A,m={id:eS(e.identifier,t),notebookType:i,extensionId:e.identifier,extensionLocation:e.extensionLocation,label:n||e.identifier.value,preloads:o?o.map(kx.from):[]};let y=s??d,_;this._proxy.$addKernel(a,m).catch(M=>{console.log(M),l=!0});let b=0;const E=()=>{if(l)return;const M=++b;Promise.resolve().then(()=>{M===b&&this._proxy.$updateKernel(a,m)})},D=new ki,R={get id(){return t},get notebookType(){return m.notebookType},onDidChangeSelectedNotebooks:h.event,get label(){return m.label},set label(M){m.label=M??e.displayName??e.name,E()},get detail(){return m.detail??""},set detail(M){m.detail=M,E()},get description(){return m.description??""},set description(M){m.description=M,E()},get supportedLanguages(){return m.supportedLanguages},set supportedLanguages(M){m.supportedLanguages=M,E()},get supportsExecutionOrder(){return m.supportsExecutionOrder??!1},set supportsExecutionOrder(M){m.supportsExecutionOrder=M,E()},get rendererScripts(){return m.preloads?m.preloads.map(kx.to):[]},get executeHandler(){return y},set executeHandler(M){y=M??d},get interruptHandler(){return _},set interruptHandler(M){_=M,m.supportsInterrupt=!!M,E()},createNotebookCellExecution(M){if(l)throw new Error("notebook controller is DISPOSED");if(!D.has(M.notebook.uri))throw c._logService.trace(`NotebookController[${a}] NOT associated to notebook, associated to THESE notebooks:`,Array.from(D.keys()).map(O=>O.toString())),new Error(`notebook controller is NOT associated to notebook: ${M.notebook.uri.toString()}`);return c._createNotebookCellExecution(M,eS(e.identifier,this.id))},createNotebookExecution(M){if(He(e,"notebookExecution"),l)throw new Error("notebook controller is DISPOSED");if(!D.has(M.uri))throw c._logService.trace(`NotebookController[${a}] NOT associated to notebook, associated to THESE notebooks:`,Array.from(D.keys()).map(O=>O.toString())),new Error(`notebook controller is NOT associated to notebook: ${M.uri.toString()}`);return c._createNotebookExecution(M,eS(e.identifier,this.id))},dispose:()=>{l||(this._logService.trace(`NotebookController[${a}], DISPOSED`),l=!0,this._kernelData.delete(a),u.dispose(),h.dispose(),g.dispose(),this._proxy.$removeKernel(a))},updateNotebookAffinity(M,O){O===lE.Hidden&&He(e,"notebookControllerAffinityHidden"),c._proxy.$updateNotebookPriority(a,M.uri,O)},onDidReceiveMessage:g.event,postMessage(M,O){return He(e,"notebookMessaging"),c._proxy.$postMessage(a,O&&c._extHostNotebook.getIdByEditor(O),M)},asWebviewUri(M){return He(e,"notebookMessaging"),ky(M,c._initData.remote)}};return this._kernelData.set(a,{extensionId:e.identifier,controller:R,onDidReceiveMessage:g,onDidChangeSelection:h,associatedNotebooks:D}),R}getIdByController(e){for(const[t,i]of this._kernelData)if(i.controller===e)return eS(i.extensionId,e.id);return null}createNotebookControllerDetectionTask(e,t){const i=this._kernelDetectionTaskHandlePool++,n=this;this._logService.trace(`NotebookControllerDetectionTask[${i}], CREATED by ${e.identifier.value}`),this._proxy.$addKernelDetectionTask(i,t);const s={dispose:()=>{this._kernelDetectionTask.delete(i),n._proxy.$removeKernelDetectionTask(i)}};return this._kernelDetectionTask.set(i,s),s}registerKernelSourceActionProvider(e,t,i){const n=this._kernelSourceActionProviderHandlePool++,s=typeof i.onDidChangeNotebookKernelSourceActions=="function"?n:void 0,o=this;this._kernelSourceActionProviders.set(n,i),this._logService.trace(`NotebookKernelSourceActionProvider[${n}], CREATED by ${e.identifier.value}`),this._proxy.$addKernelSourceActionProvider(n,n,t);let a;return s!==void 0&&(a=i.onDidChangeNotebookKernelSourceActions(c=>this._proxy.$emitNotebookKernelSourceActionsChangeEvent(s))),{dispose:()=>{this._kernelSourceActionProviders.delete(n),o._proxy.$removeKernelSourceActionProvider(n,n),a==null||a.dispose()}}}async $provideKernelSourceActions(e,t){const i=this._kernelSourceActionProviders.get(e);if(i){const n=new me;return this._kernelSourceActionProviderCache.add([n]),(await i.provideNotebookKernelSourceActions(t)??[]).map(o=>lL.from(o,this._commands.converter,n))}return[]}$acceptNotebookAssociation(e,t,i){const n=this._kernelData.get(e);if(n){const s=this._extHostNotebook.getNotebookDocument(k.revive(t));i?n.associatedNotebooks.set(s.uri,!0):n.associatedNotebooks.delete(s.uri),this._logService.trace(`NotebookController[${e}] ASSOCIATE notebook`,s.uri.toString(),i),n.onDidChangeSelection.fire({selected:i,notebook:s.apiNotebook})}}async $executeCells(e,t,i){const n=this._kernelData.get(e);if(!n)return;const s=this._extHostNotebook.getNotebookDocument(k.revive(t)),o=[];for(const a of i){const c=s.getCell(a);c&&o.push(c.apiCell)}try{this._logService.trace(`NotebookController[${e}] EXECUTE cells`,s.uri.toString(),o.length),await n.controller.executeHandler.call(n.controller,o,s.apiNotebook,n.controller)}catch(a){this._logService.error(`NotebookController[${e}] execute cells FAILED`,a),console.error(a)}}async $cancelCells(e,t,i){var o;const n=this._kernelData.get(e);if(!n)return;const s=this._extHostNotebook.getNotebookDocument(k.revive(t));if(n.controller.interruptHandler)await n.controller.interruptHandler.call(n.controller,s.apiNotebook);else for(const a of i){const c=s.getCell(a);c&&((o=this._activeExecutions.get(c.uri))==null||o.cancel())}if(n.controller.interruptHandler){const a=this._activeNotebookExecutions.get(s.uri);i.length&&Array.isArray(a)&&a.length&&a.forEach(c=>c.dispose())}}$acceptKernelMessageFromRenderer(e,t,i){const n=this._kernelData.get(e);if(!n)return;const s=this._extHostNotebook.getEditorById(t);n.onDidReceiveMessage.fire(Object.freeze({editor:s.apiEditor,message:i}))}$cellExecutionChanged(e,t,i){const s=this._extHostNotebook.getNotebookDocument(k.revive(e)).getCell(t);if(s){const o=i?cL.to(i):Yg.Idle;o!==void 0&&this._onDidChangeCellExecutionState.fire({cell:s.apiCell,state:o})}}_createNotebookCellExecution(e,t){if(e.index<0)throw new Error("CANNOT execute cell that has been REMOVED from notebook");const n=this._extHostNotebook.getNotebookDocument(e.notebook.uri).getCellFromApiCell(e);if(!n)throw new Error("invalid cell");if(this._activeExecutions.has(n.uri))throw new Error(`duplicate execution for ${n.uri}`);const s=new tF(t,n,this._proxy);this._activeExecutions.set(n.uri,s);const o=s.onDidChangeState(()=>{s.state===ca.Resolved&&(s.dispose(),o.dispose(),this._activeExecutions.delete(n.uri))});return s.asApiObject()}_createNotebookExecution(e,t){const i=this._extHostNotebook.getNotebookDocument(e.uri),n=e.getCells().find(a=>{const c=i.getCellFromApiCell(a);return c&&this._activeExecutions.has(c.uri)});if(n)throw new Error(`duplicate cell execution for ${n.document.uri}`);if(this._activeNotebookExecutions.has(i.uri))throw new Error(`duplicate notebook execution for ${i.uri}`);const s=new iF(t,i,this._proxy),o=s.onDidChangeState(()=>{s.state===Gc.Resolved&&(s.dispose(),o.dispose(),this._activeNotebookExecutions.delete(i.uri))});return this._activeNotebookExecutions.set(i.uri,[s,o]),s.asApiObject()}};eF=T([v(4,ze)],eF);var ca;(function(r){r[r.Init=0]="Init",r[r.Started=1]="Started",r[r.Resolved=2]="Resolved"})(ca||(ca={}));const UD=class UD extends ne{get state(){return this._state}constructor(e,t,i){super(),this._cell=t,this._proxy=i,this._handle=UD.HANDLE++,this._onDidChangeState=new A,this.onDidChangeState=this._onDidChangeState.event,this._state=ca.Init,this._tokenSource=this._register(new Xt),this._collector=new yge(10,n=>this.update(n)),this._executionOrder=t.internalMetadata.executionOrder,this._proxy.$createExecution(this._handle,e,this._cell.notebook.uri,this._cell.handle)}cancel(){this._tokenSource.cancel()}async updateSoon(e){await this._collector.addItem(e)}async update(e){const t=Array.isArray(e)?e:[e];return this._proxy.$updateExecution(this._handle,new rs(t))}verifyStateForOutput(){if(this._state===ca.Init)throw new Error("Must call start before modifying cell output");if(this._state===ca.Resolved)throw new Error("Cannot modify cell output after calling resolve")}cellIndexToHandle(e){let t=this._cell;if(e&&(t=this._cell.notebook.getCellFromApiCell(e)),!t)throw new Error("INVALID cell");return t.handle}validateAndConvertOutputs(e){return e.map(t=>{const i=aE.ensureUniqueMimeTypes(t.items,!0);return i===t.items?uu.from(t):uu.from({items:i,id:t.id,metadata:t.metadata})})}async updateOutputs(e,t,i){const n=this.cellIndexToHandle(t),s=this.validateAndConvertOutputs(bg(e));return this.updateSoon({editType:xl.Output,cellHandle:n,append:i,outputs:s})}async updateOutputItems(e,t,i){return e=aE.ensureUniqueMimeTypes(bg(e),!0),this.updateSoon({editType:xl.OutputItems,items:e.map(Sm.from),outputId:t.id,append:i})}asApiObject(){const e=this;return Object.freeze({get token(){return e._tokenSource.token},get cell(){return e._cell.apiCell},get executionOrder(){return e._executionOrder},set executionOrder(i){e._executionOrder=i,e.update([{editType:xl.ExecutionState,executionOrder:e._executionOrder}])},start(i){if(e._state===ca.Resolved||e._state===ca.Started)throw new Error("Cannot call start again");e._state=ca.Started,e._onDidChangeState.fire(),e.update({editType:xl.ExecutionState,runStartTime:i})},end(i,n){if(e._state===ca.Resolved)throw new Error("Cannot call resolve twice");e._state=ca.Resolved,e._onDidChangeState.fire(),e._collector.flush(),e._proxy.$completeExecution(e._handle,new rs({runEndTime:n,lastRunSuccess:i}))},clearOutput(i){return e.verifyStateForOutput(),e.updateOutputs([],i,!1)},appendOutput(i,n){return e.verifyStateForOutput(),e.updateOutputs(i,n,!0)},replaceOutput(i,n){return e.verifyStateForOutput(),e.updateOutputs(i,n,!1)},appendOutputItems(i,n){return e.verifyStateForOutput(),e.updateOutputItems(i,n,!0)},replaceOutputItems(i,n){return e.verifyStateForOutput(),e.updateOutputItems(i,n,!1)}})}};mi(UD,"HANDLE",0);let tF=UD;var Gc;(function(r){r[r.Init=0]="Init",r[r.Started=1]="Started",r[r.Resolved=2]="Resolved"})(Gc||(Gc={}));const VD=class VD extends ne{get state(){return this._state}constructor(e,t,i){super(),this._notebook=t,this._proxy=i,this._handle=VD.HANDLE++,this._onDidChangeState=new A,this.onDidChangeState=this._onDidChangeState.event,this._state=Gc.Init,this._tokenSource=this._register(new Xt),this._proxy.$createNotebookExecution(this._handle,e,this._notebook.uri)}cancel(){this._tokenSource.cancel()}asApiObject(){return Object.freeze({start:()=>{if(this._state===Gc.Resolved||this._state===Gc.Started)throw new Error("Cannot call start again");this._state=Gc.Started,this._onDidChangeState.fire(),this._proxy.$beginNotebookExecution(this._handle)},end:()=>{if(this._state===Gc.Resolved)throw new Error("Cannot call resolve twice");this._state=Gc.Resolved,this._onDidChangeState.fire(),this._proxy.$completeNotebookExecution(this._handle)}})}};mi(VD,"HANDLE",0);let iF=VD;class yge{constructor(e,t){this.delay=e,this.callback=t,this.batch=[],this.startedTimer=Date.now()}addItem(e){return this.batch.push(e),this.currentDeferred||(this.currentDeferred=new Hm,this.startedTimer=Date.now(),zs(this.delay).then(()=>this.flush())),Date.now()-this.startedTimer>this.delay?this.flush():this.currentDeferred.p}flush(){if(this.batch.length===0||!this.currentDeferred)return Promise.resolve();const e=this.currentDeferred;this.currentDeferred=void 0;const t=this.batch;return this.batch=[],this.callback(t).finally(()=>e.complete())}}function eS(r,e){return`${r.value}/${e}`}class _ge{constructor(e,t){this._extHostNotebook=t,this._rendererMessageEmitters=new Map,this.proxy=e.getProxy(ce.MainThreadNotebookRenderers)}$postRendererMessage(e,t,i){var s;const n=this._extHostNotebook.getEditorById(e);(s=this._rendererMessageEmitters.get(t))==null||s.fire({editor:n.apiEditor,message:i})}createRendererMessaging(e,t){var n,s;if(!((s=(n=e.contributes)==null?void 0:n.notebookRenderer)!=null&&s.some(o=>o.id===t)))throw new Error(`Extensions may only call createRendererMessaging() for renderers they contribute (got ${t})`);return{onDidReceiveMessage:(o,a,c)=>this.getOrCreateEmitterFor(t).event(o,a,c),postMessage:(o,a)=>{Dm.apiEditorsToExtHost.has(o)&&([o,a]=[a,o]);const c=a&&Dm.apiEditorsToExtHost.get(a);return this.proxy.$postMessage(c==null?void 0:c.id,t,o)}}}getOrCreateEmitterFor(e){let t=this._rendererMessageEmitters.get(e);return t||(t=new A({onDidRemoveLastListener:()=>{t==null||t.dispose(),this._rendererMessageEmitters.delete(e)}}),this._rendererMessageEmitters.set(e,t),t)}}let nF=class{constructor(e,t){this._logService=e,this._notebooksAndEditors=t,this._onDidChangeNotebookEditorSelection=new A({onListenerError:Fn}),this._onDidChangeNotebookEditorVisibleRanges=new A({onListenerError:Fn}),this.onDidChangeNotebookEditorSelection=this._onDidChangeNotebookEditorSelection.event,this.onDidChangeNotebookEditorVisibleRanges=this._onDidChangeNotebookEditorVisibleRanges.event}$acceptEditorPropertiesChanged(e,t){this._logService.debug("ExtHostNotebook#$acceptEditorPropertiesChanged",e,t);const i=this._notebooksAndEditors.getEditorById(e);t.visibleRanges&&i._acceptVisibleRanges(t.visibleRanges.ranges.map(mc.to)),t.selections&&i._acceptSelections(t.selections.selections.map(mc.to)),t.visibleRanges&&this._onDidChangeNotebookEditorVisibleRanges.fire({notebookEditor:i.apiEditor,visibleRanges:i.apiEditor.visibleRanges}),t.selections&&this._onDidChangeNotebookEditorSelection.fire(Object.freeze({notebookEditor:i.apiEditor,selections:i.apiEditor.selections}))}$acceptEditorViewColumns(e){for(const t in e)this._notebooksAndEditors.getEditorById(t)._acceptViewColumn(Hn.to(e[t]))}};nF=T([v(0,ze)],nF);class wge{constructor(e){this._notebooksAndEditors=e,this._onDidSaveNotebookDocument=new A,this.onDidSaveNotebookDocument=this._onDidSaveNotebookDocument.event,this._onDidChangeNotebookDocument=new A,this.onDidChangeNotebookDocument=this._onDidChangeNotebookDocument.event}$acceptModelChanged(e,t,i,n){const o=this._notebooksAndEditors.getNotebookDocument(k.revive(e)).acceptModelChanged(t.value,i,n);this._onDidChangeNotebookDocument.fire(o)}$acceptDirtyStateChanged(e,t){this._notebooksAndEditors.getNotebookDocument(k.revive(e)).acceptDirty(t)}$acceptModelSaved(e){const t=this._notebooksAndEditors.getNotebookDocument(k.revive(e));this._onDidSaveNotebookDocument.fire(t.apiNotebook)}}class bge{constructor(e,t,i,n,s){this._extHostNotebooks=t,this._textDocumentsAndEditors=i,this._commands=n;const o=new Ct("interactive.open","_interactive.open","Open interactive window and return notebook editor and input URI",[new we("showOptions","Show Options",a=>!0,a=>a),new we("resource","Interactive resource Uri",a=>!0,a=>a),new we("controllerId","Notebook controller Id",a=>!0,a=>a),new we("title","Interactive editor title",a=>!0,a=>a)],new wt("Notebook and input URI",a=>{if(s.debug("[ExtHostInteractive] open iw with notebook editor id",a.notebookEditorId),a.notebookEditorId!==void 0){const c=this._extHostNotebooks.getEditorById(a.notebookEditorId);return s.debug("[ExtHostInteractive] notebook editor found",c.id),{notebookUri:k.revive(a.notebookUri),inputUri:k.revive(a.inputUri),notebookEditor:c.apiEditor}}return s.debug("[ExtHostInteractive] notebook editor not found, uris for the interactive document",a.notebookUri,a.inputUri),{notebookUri:k.revive(a.notebookUri),inputUri:k.revive(a.inputUri)}}));this._commands.registerApiCommand(o)}$willAddInteractiveDocument(e,t,i,n){var s;this._textDocumentsAndEditors.acceptDocumentsAndEditorsDelta({addedDocuments:[{EOL:t,lines:[""],languageId:i,uri:e,isDirty:!1,versionId:1,notebook:(s=this._extHostNotebooks.getNotebookDocument(k.revive(n)))==null?void 0:s.apiNotebook}]})}$willRemoveInteractiveDocument(e,t){this._textDocumentsAndEditors.acceptDocumentsAndEditorsDelta({removedDocuments:[e]})}}class Sge{constructor(e){this.handlers=new Map,this.proxy=e.getProxy(ce.MainThreadProfileContentHandlers)}registrProfileContentHandler(e,t,i){if(He(e,"profileContentHandlers"),this.handlers.has(t))throw new Error(`Handler with id '${t}' already registered`);return this.handlers.set(t,i),this.proxy.$registerProfileContentHandler(t,i.name,i.description,e.identifier.value),ot(()=>{this.handlers.delete(t),this.proxy.$unregisterProfileContentHandler(t)})}async $saveProfile(e,t,i,n){const s=this.handlers.get(e);if(!s)throw new Error(`Unknown handler with id: ${e}`);return s.saveProfile(t,i,n)}async $readProfile(e,t,i){const n=this.handlers.get(e);if(!n)throw new Error(`Unknown handler with id: ${e}`);return n.readProfile(Rt(t)?t:k.revive(t),i)}}class oI{constructor(e,t){this.uriTransformer=t,this.providers=new Map,this.proxy=e.getProxy(ce.MainThreadQuickDiff)}$provideOriginalResource(e,t,i){const n=k.revive(t),s=this.providers.get(e);return s?Nr(()=>s.provideOriginalResource(n,i)).then(o=>o||null):Promise.resolve(null)}registerQuickDiffProvider(e,t,i,n){const s=oI.handlePool++;return this.providers.set(s,t),this.proxy.$registerQuickDiffProvider(s,gm.from(e,this.uriTransformer),i,n),{dispose:()=>{this.proxy.$unregisterQuickDiffProvider(s),this.providers.delete(s)}}}}oI.handlePool=0;const qD=class qD{constructor(e,t){this.extension=e,this.provider=t,this.handle=qD._pool++}};mi(qD,"_pool",0);let Hx=qD;class aI{constructor(e,t){this.logService=t,this._chatProvider=new Map,this._slashCommandProvider=new Map,this._chatSessions=new Map,this._onDidPerformUserAction=new A,this.onDidPerformUserAction=this._onDidPerformUserAction.event,this._proxy=e.getProxy(ce.MainThreadChat)}registerChatProvider(e,t,i){const n=new Hx(e,i);return this._chatProvider.set(n.handle,n),this._proxy.$registerChatProvider(n.handle,t),ot(()=>{this._proxy.$unregisterChatProvider(n.handle),this._chatProvider.delete(n.handle)})}transferChatSession(e,t){const i=Go.find(this._chatSessions.keys(),n=>this._chatSessions.get(n)===e)??0;typeof i=="number"&&this._proxy.$transferChatSession(i,t)}addChatRequest(e){this._proxy.$addRequest(e)}sendInteractiveRequestToProvider(e,t){this._proxy.$sendRequestToProvider(e,t)}async $prepareChat(e,t,i){var a,c,d,l;const n=this._chatProvider.get(e);if(!n)return;const s=await n.provider.prepareSession(t,i);if(!s)return;const o=aI._nextId++;return this._chatSessions.set(o,s),{id:o,requesterUsername:(a=s.requester)==null?void 0:a.name,requesterAvatarIconUri:(c=s.requester)==null?void 0:c.icon,responderUsername:(d=s.responder)==null?void 0:d.name,responderAvatarIconUri:(l=s.responder)==null?void 0:l.icon,inputPlaceholder:s.inputPlaceholder}}async $resolveRequest(e,t,i,n){const s=this._chatProvider.get(e);if(!s)return;const o=this._chatSessions.get(t);if(!o||!s.provider.resolveRequest)return;const a=await s.provider.resolveRequest(o,i,n);if(a)return{message:typeof a.message=="string"?a.message:mg.from(a.message)}}async $provideWelcomeMessage(e,t){const i=this._chatProvider.get(e);if(!i||!i.provider.provideWelcomeMessage)return;const n=await i.provider.provideWelcomeMessage(t);if(n)return n.map(s=>typeof s=="string"?s:s.map(o=>mg.from(o)))}async $provideFollowups(e,t,i){const n=this._chatProvider.get(e);if(!n)return;const s=this._chatSessions.get(t);if(!s||!n.provider.provideFollowups)return;const o=await n.provider.provideFollowups(s,i);return o==null?void 0:o.map(a=>pL.from(a))}$removeRequest(e,t,i){const n=this._chatProvider.get(e);if(!n)return;const s=this._chatSessions.get(t);s&&n.provider.removeRequest&&n.provider.removeRequest(s,i)}async $provideReply(e,t,i,n){const s=this._chatProvider.get(e);if(!s)return;const o=this._chatSessions.get(t);if(!o)return;const a={session:o,message:typeof i.message=="string"?i.message:mg.to(i.message)},c=Tr.create(!1);let d;const l={report:g=>{if(n.isCancellationRequested)return;typeof d>"u"&&(d=c.elapsed());const m="responseId"in g?{requestId:g.responseId}:g;this._proxy.$acceptResponseProgress(e,t,m)}};let u;try{u=await s.provider.provideResponseWithProgress(a,l,n),u||(u={errorDetails:{message:p("emptyResponse","Provider returned null response")}})}catch(g){u={errorDetails:{message:p("errorResponse","Error from provider: {0}",g.message),responseIsIncomplete:!0}},this.logService.error(g)}try{if(o.saveState&&this._chatSessions.has(t)){const g=o.saveState();this._proxy.$acceptChatState(t,g)}}catch(g){this.logService.warn(g)}const h={firstProgress:d??0,totalElapsed:c.elapsed()};return{errorDetails:u.errorDetails,timings:h}}async $provideSlashCommands(e,t,i){const n=this._chatProvider.get(e);if(!n)return;const s=this._chatSessions.get(t);if(!s||!n.provider.provideSlashCommands)return;const o=await n.provider.provideSlashCommands(s,i);return o==null?void 0:o.map(a=>({...a,kind:ym.from(a.kind)}))}$releaseSession(e){this._chatSessions.delete(e)}async $onDidPerformUserAction(e){this._onDidPerformUserAction.fire(e)}registerSlashCommandProvider(e,t,i){const n=new Hx(e,i);return this._slashCommandProvider.set(n.handle,n),this._proxy.$registerSlashCommandProvider(n.handle,t),ot(()=>{this._proxy.$unregisterSlashCommandProvider(n.handle),this._slashCommandProvider.delete(n.handle)})}async $provideProviderSlashCommands(e,t){const i=this._slashCommandProvider.get(e);if(!i)return;const n=await i.provider.provideSlashCommands(t);return n==null?void 0:n.map(s=>({...s,kind:ym.from(s.kind)}))}async $resolveSlashCommand(e,t,i){const n=this._slashCommandProvider.get(e);if(!n)return;const s=await n.provider.resolveSlashCommand(t,i);return ii(s)}}aI._nextId=0;const GD=class GD{constructor(e,t){this.extension=e,this.provider=t,this.handle=GD._pool++}};mi(GD,"_pool",0);let rF=GD;class Cge{constructor(e){this.session=e,this.responses=[]}}class uw{constructor(e,t,i,n){this._documents=i,this._logService=n,this._inputProvider=new Map,this._inputSessions=new Map,this._proxy=e.getProxy(ce.MainThreadInlineChat),t.registerApiCommand(new Ct("vscode.editorChat.start","inlineChat.start","Invoke a new editor chat session",[new we("Run arguments","",s=>!0,s=>{if(s)return{initialRange:s.initialRange?ge.from(s.initialRange):void 0,message:s.message,autoSend:s.autoSend}})],wt.Void))}registerProvider(e,t){const i=new rF(e,t);return this._inputProvider.set(i.handle,i),this._proxy.$registerInteractiveEditorProvider(i.handle,e.identifier.value,typeof t.handleInteractiveEditorResponseFeedback=="function"),ot(()=>{this._proxy.$unregisterInteractiveEditorProvider(i.handle),this._inputProvider.delete(i.handle)})}async $prepareSession(e,t,i,n){var l;const s=this._inputProvider.get(e);if(!s){this._logService.warn("CANNOT prepare session because the PROVIDER IS GONE");return}const o=this._documents.getDocument(k.revive(t)),a=Aa.to(i),c=await s.provider.prepareInteractiveEditorSession({document:o,selection:a},n);if(!c)return;if(c.wholeRange&&!c.wholeRange.contains(a))throw new Error("InteractiveEditorSessionProvider returned a wholeRange that does not contain the selection.");const d=uw._nextId++;return this._inputSessions.set(d,new Cge(c)),{id:d,placeholder:c.placeholder,slashCommands:(l=c.slashCommands)==null?void 0:l.map(u=>({command:u.command,detail:u.detail,refer:u.refer})),wholeRange:ge.from(c.wholeRange),message:c.message}}async $provideResponse(e,t,i,n){const s=this._inputProvider.get(e);if(!s)return;const o=this._inputSessions.get(t.id);if(!o)return;const a=await s.provider.provideInteractiveEditorResponse({session:o.session,prompt:i.prompt,selection:Aa.to(i.selection),wholeRange:ge.to(i.wholeRange),attempt:i.attempt},n);if(a){const c=o.responses.push(a)-1,d={wholeRange:ge.from(a.wholeRange),placeholder:a.placeholder};if(uw._isMessageResponse(a))return{...d,id:c,type:"message",message:zi.from(a.contents)};const{edits:l}=a;if(l instanceof Sd)return{...d,id:c,type:"bulkEdit",edits:bo.from(l)};if(Array.isArray(l))return{...d,id:c,type:"editorEdit",edits:l.map(fr.from)}}}$handleFeedback(e,t,i,n){var c,d;const s=this._inputProvider.get(e),o=this._inputSessions.get(t),a=o==null?void 0:o.responses[i];if(s&&a){let l;switch(n){case 1:l=lg.Helpful;break;case 0:l=lg.Unhelpful;break;case 2:l=lg.Undone;break}(d=(c=s.provider).handleInteractiveEditorResponseFeedback)==null||d.call(c,o.session,a,l)}}$releaseSession(e,t){var s,o;const i=this._inputSessions.get(t),n=this._inputProvider.get(e);i&&n&&((o=(s=n.provider).releaseInteractiveEditorSession)==null||o.call(s,i.session)),this._inputSessions.delete(t)}static _isMessageResponse(e){return typeof e=="object"&&typeof e.contents=="object"}}uw._nextId=0;let Ege=class{constructor(e,t,i,n={timeout:1500,errors:3}){this._logService=e,this._notebooksAndEditors=t,this._mainThreadBulkEdits=i,this._thresholds=n,this._onWillSaveNotebookDocumentEvent=new Ml}dispose(){}getOnWillSaveNotebookDocumentEvent(e){return(t,i,n)=>{const s=function(a){t.call(i,a)};return s.extension=e,this._onWillSaveNotebookDocumentEvent.event(s,void 0,n)}}async $participateInSave(e,t,i){const n=k.revive(e),s=this._notebooksAndEditors.getNotebookDocument(n);if(!s)throw new Error("Unable to resolve notebook document");const o=[];if(await this._onWillSaveNotebookDocumentEvent.fireAsync({notebook:s.apiNotebook,reason:Cx.to(t)},i,async(c,d)=>{const l=Date.now(),u=await await Promise.resolve(c);Date.now()-l>this._thresholds.timeout&&this._logService.warn("onWillSaveNotebookDocument-listener from extension",d.extension.identifier),!i.isCancellationRequested&&u&&(u instanceof Sd?o.push(u):this._logService.warn("onWillSaveNotebookDocument-listener from extension",d.extension.identifier,"ignored due to invalid data"))}),i.isCancellationRequested)return!1;if(o.length===0)return!0;const a={edits:[]};for(const c of o){const{edits:d}=bo.from(c);a.edits=a.edits.concat(d)}return this._mainThreadBulkEdits.$tryApplyWorkspaceEdit(a)}};class xge{constructor(e){this._semanticSimilarityProviders=new Map,this._nextHandle=0,this._proxy=e.getProxy(ce.MainThreadSemanticSimilarity)}async $provideSimilarityScore(e,t,i,n){if(this._semanticSimilarityProviders.size===0)throw new Error("No semantic similarity providers registered");const s=this._semanticSimilarityProviders.get(e);if(!s)throw new Error("Semantic similarity provider not found");return await s.provideSimilarityScore(t,i,n)}registerSemanticSimilarityProvider(e,t){const i=this._nextHandle;return this._nextHandle++,this._semanticSimilarityProviders.set(i,t),this._proxy.$registerSemanticSimilarityProvider(i),new Yt(()=>{this._proxy.$unregisterSemanticSimilarityProvider(i),this._semanticSimilarityProviders.delete(i)})}}class Dge{constructor(e){this._IssueUriRequestHandlers=new Map,this._proxy=e.getProxy(ce.MainThreadIssueReporter)}async $getIssueReporterUri(e,t){if(this._IssueUriRequestHandlers.size===0)throw new Error("No issue request handlers registered");const i=this._IssueUriRequestHandlers.get(e);if(!i)throw new Error("Issue request handler not found");const n=await i.handleIssueUrlRequest();if(!n)throw new Error("Issue request handler returned no result");return n}registerIssueUriRequestHandler(e,t){const i=e.identifier.value;return this._IssueUriRequestHandlers.set(i,t),this._proxy.$registerIssueUriRequestHandler(i),new Yt(()=>{this._proxy.$unregisterIssueUriRequestHandler(i),this._IssueUriRequestHandlers.delete(i)})}}class cI{constructor(e,t){this.uriTransformer=t,this.providers=new Map,this.proxy=e.getProxy(ce.MainThreadShare)}async $provideShare(e,t,i){const n=this.providers.get(e);return await(n==null?void 0:n.provideShare({selection:ge.to(t.selection),resourceUri:k.revive(t.resourceUri)},i))??void 0}registerShareProvider(e,t){const i=cI.handlePool++;return this.providers.set(i,t),this.proxy.$registerShareProvider(i,gm.from(e,this.uriTransformer),t.id,t.label,t.priority),{dispose:()=>{this.proxy.$unregisterShareProvider(i),this.providers.delete(i)}}}}cI.handlePool=0;function kge(r){const e=r.get(Gr),t=r.get(iv),i=r.get(YT),n=r.get(xu),s=r.get($d),o=r.get(XT),a=r.get(Wd),c=r.get(KT),d=r.get(Ii),l=r.get(F$),u=r.get(O$),h=r.get(Is),g=r.get(ze),m=r.get(N$),y=r.get(iI),_=r.get(Q5),b=r.get(W$),E=r.get(mb),D=r.get(j$);d.set(fe.ExtHostFileSystemInfo,t),d.set(fe.ExtHostLogLevelServiceShape,h),d.set(fe.ExtHostWorkspace,s),d.set(fe.ExtHostConfiguration,a),d.set(fe.ExtHostExtensionService,n),d.set(fe.ExtHostStorage,l),d.set(fe.ExtHostTunnelService,m),d.set(fe.ExtHostWindow,_),d.set(fe.ExtHostSecretState,b),d.set(fe.ExtHostTelemetry,o),d.set(fe.ExtHostEditorTabs,E),d.set(fe.ExtHostManagedSockets,D);const R=d.set(fe.ExtHostDecorations,r.get(Y5)),M=d.set(fe.ExtHostDocumentsAndEditors,r.get(gb)),O=d.set(fe.ExtHostCommands,r.get(N5)),L=d.set(fe.ExtHostTerminalService,r.get(pb)),W=d.set(fe.ExtHostDebugService,r.get(o8)),Z=d.set(fe.ExtHostSearch,r.get(a8)),K=d.set(fe.ExtHostTask,r.get(X5)),H=d.set(fe.ExtHostOutputService,r.get(W5)),C=d.set(fe.ExtHostLocalization,r.get(H$)),B=d.set(fe.ExtHostUrls,new tI(d)),te=d.set(fe.ExtHostDocuments,new Qfe(d,M)),ue=d.set(fe.ExtHostDocumentContentProviders,new JT(d,M,g)),be=d.set(fe.ExtHostDocumentSaveParticipant,new Vfe(g,te,d.getProxy(ce.MainThreadBulkEdits))),de=d.set(fe.ExtHostNotebook,new fh(d,O,M,te,i)),le=d.set(fe.ExtHostNotebookDocuments,new wge(de)),Me=d.set(fe.ExtHostNotebookEditors,new nF(g,de)),Re=d.set(fe.ExtHostNotebookKernels,new eF(d,e,de,O,g)),Oe=d.set(fe.ExtHostNotebookRenderers,new _ge(d,de)),Ge=d.set(fe.ExtHostNotebookDocumentSaveParticipant,new Ege(g,de,d.getProxy(ce.MainThreadBulkEdits))),xe=d.set(fe.ExtHostEditors,new _pe(d,M)),Kt=d.set(fe.ExtHostTreeViews,new wpe(d.getProxy(ce.MainThreadTreeViews),O,g)),je=d.set(fe.ExtHostEditorInsets,new Ape(d.getProxy(ce.MainThreadEditorInsets),xe,e.remote)),et=d.set(fe.ExtHostDiagnostics,new cw(d,g,t,M)),Qt=d.set(fe.ExtHostLanguages,new spe(d,te,O.converter,c)),ct=d.set(fe.ExtHostLanguageFeatures,new dr(d,c,te,O,et,g,y,o)),ai=d.set(fe.ExtHostFileSystem,new Mx(d,ct)),dt=d.set(fe.ExtHostFileSystemEventService,new ipe(d,g,M)),xi=d.set(fe.ExtHostQuickOpen,lpe(d,s,O)),ci=d.set(fe.ExtHostSCM,new Fx(d,O,te,g)),mt=d.set(fe.ExtHostQuickDiff,new oI(d,c)),vn=d.set(fe.ExtHostShare,new cI(d,c)),zr=d.set(fe.ExtHostComments,Bfe(d,O,te)),Kr=d.set(fe.ExtHostProgress,new cpe(d.getProxy(ce.MainThreadProgress))),qn=d.set(fe.ExtHosLabelService,new Mpe(d)),ut=d.set(fe.ExtHostTheming,new XL(d)),U=d.set(fe.ExtHostAuthentication,new Jpe(d)),J=d.set(fe.ExtHostTimeline,new Zpe(d,O)),Y=d.set(fe.ExtHostWebviews,new Ipe(d,e.remote,s,g,y)),_e=d.set(fe.ExtHostWebviewPanels,new V$(d,Y,s)),Se=d.set(fe.ExtHostCustomEditors,new sge(d,te,u,Y,_e)),Ce=d.set(fe.ExtHostWebviewViews,new tge(d,Y)),Vt=d.set(fe.ExtHostTesting,new ZL(d,O,M)),Pt=d.set(fe.ExtHostUriOpeners,new sI(d)),Zt=d.set(fe.ExtHostProfileContentHandlers,new Sge(d));d.set(fe.ExtHostInteractive,new bge(d,de,M,O,g));const cr=d.set(fe.ExtHostInlineChat,new uw(d,O,te,g)),yn=d.set(fe.ExtHostChat,new aI(d,g)),Ro=d.set(fe.ExtHostSemanticSimilarity,new xge(d)),Ua=d.set(fe.ExtHostIssueReporter,new Dge(d)),hs=d.set(fe.ExtHostStatusBar,new ype(d,O.converter)),Va=new JL(d,M),Rc=new jfe(d),Po=new AL(d,g),na=new Ufe(d);return Hfe.register(O),function(X,wr,P){const oe=function(){let x=!X.isUnderDevelopment;function I(){x||(g.info(`Extension '${X.identifier.value}' uses a document selector without scheme. Learn more about this: https://go.microsoft.com/fwlink/?linkid=872305`),x=!0)}return function j($e){if(Array.isArray($e))$e.forEach(j);else if(typeof $e=="string")I();else{const S=$e;typeof S.scheme>"u"&&I(),typeof S.exclusive=="boolean"&&He(X,"documentFiltersExclusive")}return $e}}(),tt={getSession(x,I,j){return U.getSession(X,x,I,j)},getSessions(x,I){return He(X,"authGetSessions"),U.getSessions(X,x,I)},async hasSession(x,I){return He(X,"authSession"),!!await U.getSession(X,x,I,{silent:!0})},get onDidChangeSessions(){return U.onDidChangeSessions},registerAuthenticationProvider(x,I,j,$e){return U.registerAuthenticationProvider(x,I,j,$e)}},ei={registerCommand(x,I,j){return O.registerCommand(!0,x,I,j,void 0,X)},registerTextEditorCommand(x,I,j){return O.registerCommand(!0,x,(...$e)=>{const S=xe.getActiveTextEditor();if(!S){g.warn("Cannot execute "+x+" because there is no active text editor.");return}return S.edit($=>{I.apply(j,[S,$,...$e])}).then($=>{$||g.warn("Edits from command "+x+" were not applied.")},$=>{g.warn("An error occurred while running command "+x,$)})},void 0,void 0,X)},registerDiffInformationCommand:(x,I,j)=>(He(X,"diffCommand"),O.registerCommand(!0,x,async(...$e)=>{const S=M.activeEditor(!0);if(!S){g.warn("Cannot execute "+x+" because there is no active text editor.");return}const $=await xe.getDiffInformation(S.id);I.apply(j,[$,...$e])},void 0,void 0,X)),executeCommand(x,...I){return O.executeCommand(x,...I)},getCommands(x=!1){return O.getCommands(x)}},wi={get machineId(){return e.telemetryInfo.machineId},get sessionId(){return e.telemetryInfo.sessionId},get language(){return e.environment.appLanguage},get appName(){return e.environment.appName},get appRoot(){var x;return((x=e.environment.appRoot)==null?void 0:x.fsPath)??""},get appHost(){return e.environment.appHost},get uriScheme(){return e.environment.appUriScheme},get clipboard(){return Rc.value},get shell(){return L.getDefaultShell(!1)},get onDidChangeShell(){return He(X,"envShellEvent"),L.onDidChangeShell},get isTelemetryEnabled(){return o.getTelemetryConfiguration()},get onDidChangeTelemetryEnabled(){return o.onDidChangeTelemetryEnabled},get telemetryConfiguration(){return He(X,"telemetry"),o.getTelemetryDetails()},get onDidChangeTelemetryConfiguration(){return He(X,"telemetry"),o.onDidChangeTelemetryConfiguration},get isNewAppInstall(){return O5(e.telemetryInfo.firstSessionDate)},createTelemetryLogger(x,I){return F5.validateSender(x),o.instantiateLogger(X,x,I)},openExternal(x,I){return _.openUri(x,{allowTunneling:!!e.remote.authority,allowContributedOpeners:I==null?void 0:I.allowContributedOpeners})},async asExternalUri(x){if(x.scheme===e.environment.appUriScheme)return B.createAppUri(x);try{return await _.asExternalUri(x,{allowTunneling:!!e.remote.authority})}catch(I){if(Xy(x,pe.http)||Xy(x,pe.https))return x;throw I}},get remoteName(){return WN(e.remote.authority)},get remoteAuthority(){return He(X,"resolvers"),e.remote.authority},get uiKind(){return e.uiKind},get logLevel(){return g.getLevel()},get onDidChangeLogLevel(){return g.onDidChangeLogLevel},registerIssueUriRequestHandler(x){return He(X,"handleIssueUri"),Ua.registerIssueUriRequestHandler(X,x)},get appQuality(){return He(X,"resolvers"),e.quality},get appCommit(){return He(X,"resolvers"),e.commit}},nn={createTestController(x,I,j){return Vt.createTestController(X,x,I,j)},createTestObserver(){return He(X,"testObserver"),Vt.createTestObserver()},runTests(x){return He(X,"testObserver"),Vt.runTests(x)},get onDidChangeTestResults(){return He(X,"testObserver"),Vt.onResultsChanged},get testResults(){return He(X,"testObserver"),Vt.results}},kn=e.remote.isRemote?jl.Workspace:jl.UI,Tn={getExtension(x,I){ts(X,"extensionsAny")||(I=!1);const j=wr.mine.getExtensionDescription(x);if(j)return new Xv(n,X.identifier,j,kn,!1);if(I){const $e=wr.all.getExtensionDescription(x);if($e)return new Xv(n,X.identifier,$e,kn,!0)}},get all(){const x=[];for(const I of wr.mine.getAllExtensionDescriptions())x.push(new Xv(n,X.identifier,I,kn,!1));return x},get allAcrossExtensionHosts(){He(X,"extensionsAny");const x=new lc(wr.mine.getAllExtensionDescriptions().map(j=>j.identifier)),I=[];for(const j of wr.all.getAllExtensionDescriptions()){const $e=!x.has(j.identifier);I.push(new Xv(n,X.identifier,j,kn,$e))}return I},get onDidChange(){return ts(X,"extensionsAny")?F.any(wr.mine.onDidChange,wr.all.onDidChange):wr.mine.onDidChange}},Ao={createDiagnosticCollection(x){return et.createDiagnosticCollection(X.identifier,x)},get onDidChangeDiagnostics(){return et.onDidChangeDiagnostics},getDiagnostics:x=>et.getDiagnostics(x),getLanguages(){return Qt.getLanguages()},setTextDocumentLanguage(x,I){return Qt.changeLanguage(x.uri,I)},match(x,I){var $e;const j=($e=te.getDocumentData(I.uri))==null?void 0:$e.notebook;return n7(aL.from(x),I.uri,I.languageId,!0,j==null?void 0:j.uri,j==null?void 0:j.notebookType)},registerCodeActionsProvider(x,I,j){return ct.registerCodeActionProvider(X,oe(x),I,j)},registerDocumentPasteEditProvider(x,I,j){return He(X,"documentPaste"),ct.registerDocumentPasteEditProvider(X,oe(x),I,j)},registerCodeLensProvider(x,I){return ct.registerCodeLensProvider(X,oe(x),I)},registerDefinitionProvider(x,I){return ct.registerDefinitionProvider(X,oe(x),I)},registerDeclarationProvider(x,I){return ct.registerDeclarationProvider(X,oe(x),I)},registerImplementationProvider(x,I){return ct.registerImplementationProvider(X,oe(x),I)},registerTypeDefinitionProvider(x,I){return ct.registerTypeDefinitionProvider(X,oe(x),I)},registerHoverProvider(x,I){return ct.registerHoverProvider(X,oe(x),I,X.identifier)},registerEvaluatableExpressionProvider(x,I){return ct.registerEvaluatableExpressionProvider(X,oe(x),I,X.identifier)},registerInlineValuesProvider(x,I){return ct.registerInlineValuesProvider(X,oe(x),I,X.identifier)},registerDocumentHighlightProvider(x,I){return ct.registerDocumentHighlightProvider(X,oe(x),I)},registerLinkedEditingRangeProvider(x,I){return ct.registerLinkedEditingRangeProvider(X,oe(x),I)},registerReferenceProvider(x,I){return ct.registerReferenceProvider(X,oe(x),I)},registerRenameProvider(x,I){return ct.registerRenameProvider(X,oe(x),I)},registerDocumentSymbolProvider(x,I,j){return ct.registerDocumentSymbolProvider(X,oe(x),I,j)},registerWorkspaceSymbolProvider(x){return ct.registerWorkspaceSymbolProvider(X,x)},registerDocumentFormattingEditProvider(x,I){return ct.registerDocumentFormattingEditProvider(X,oe(x),I)},registerDocumentRangeFormattingEditProvider(x,I){return ct.registerDocumentRangeFormattingEditProvider(X,oe(x),I)},registerOnTypeFormattingEditProvider(x,I,j,...$e){return ct.registerOnTypeFormattingEditProvider(X,oe(x),I,[j].concat($e))},registerDocumentSemanticTokensProvider(x,I,j){return ct.registerDocumentSemanticTokensProvider(X,oe(x),I,j)},registerDocumentRangeSemanticTokensProvider(x,I,j){return ct.registerDocumentRangeSemanticTokensProvider(X,oe(x),I,j)},registerSignatureHelpProvider(x,I,j,...$e){return typeof j=="object"?ct.registerSignatureHelpProvider(X,oe(x),I,j):ct.registerSignatureHelpProvider(X,oe(x),I,typeof j>"u"?[]:[j,...$e])},registerCompletionItemProvider(x,I,...j){return ct.registerCompletionItemProvider(X,oe(x),I,j)},registerInlineCompletionItemProvider(x,I){return I.handleDidShowCompletionItem&&He(X,"inlineCompletionsAdditions"),I.handleDidPartiallyAcceptCompletionItem&&He(X,"inlineCompletionsAdditions"),ct.registerInlineCompletionsProvider(X,oe(x),I)},registerDocumentLinkProvider(x,I){return ct.registerDocumentLinkProvider(X,oe(x),I)},registerColorProvider(x,I){return ct.registerColorProvider(X,oe(x),I)},registerFoldingRangeProvider(x,I){return ct.registerFoldingRangeProvider(X,oe(x),I)},registerSelectionRangeProvider(x,I){return ct.registerSelectionRangeProvider(X,x,I)},registerCallHierarchyProvider(x,I){return ct.registerCallHierarchyProvider(X,x,I)},registerTypeHierarchyProvider(x,I){return ct.registerTypeHierarchyProvider(X,x,I)},setLanguageConfiguration:(x,I)=>ct.setLanguageConfiguration(X,x,I),getTokenInformationAtPosition(x,I){return He(X,"tokenInformation"),Qt.tokenAtPosition(x,I)},registerInlayHintsProvider(x,I){return ct.registerInlayHintsProvider(X,x,I)},createLanguageStatusItem(x,I){return Qt.createLanguageStatusItem(X,x,I)},registerDocumentDropEditProvider(x,I,j){return ct.registerDocumentOnDropEditProvider(X,x,I,ts(X,"dropMetadata")?j:void 0)}},ra={get activeTextEditor(){return xe.getActiveTextEditor()},get visibleTextEditors(){return xe.getVisibleTextEditors()},get activeTerminal(){return L.activeTerminal},get terminals(){return L.terminals},async showTextDocument(x,I,j){const $e=await(k.isUri(x)?Promise.resolve(Pc.openTextDocument(x)):Promise.resolve(x));return xe.showTextDocument($e,I,j)},createTextEditorDecorationType(x){return xe.createTextEditorDecorationType(X,x)},onDidChangeActiveTextEditor(x,I,j){return xe.onDidChangeActiveTextEditor(x,I,j)},onDidChangeVisibleTextEditors(x,I,j){return xe.onDidChangeVisibleTextEditors(x,I,j)},onDidChangeTextEditorSelection(x,I,j){return xe.onDidChangeTextEditorSelection(x,I,j)},onDidChangeTextEditorOptions(x,I,j){return xe.onDidChangeTextEditorOptions(x,I,j)},onDidChangeTextEditorVisibleRanges(x,I,j){return xe.onDidChangeTextEditorVisibleRanges(x,I,j)},onDidChangeTextEditorViewColumn(x,I,j){return xe.onDidChangeTextEditorViewColumn(x,I,j)},onDidCloseTerminal(x,I,j){return L.onDidCloseTerminal(x,I,j)},onDidOpenTerminal(x,I,j){return L.onDidOpenTerminal(x,I,j)},onDidChangeActiveTerminal(x,I,j){return L.onDidChangeActiveTerminal(x,I,j)},onDidChangeTerminalDimensions(x,I,j){return He(X,"terminalDimensions"),L.onDidChangeTerminalDimensions(x,I,j)},onDidChangeTerminalState(x,I,j){return L.onDidChangeTerminalState(x,I,j)},onDidWriteTerminalData(x,I,j){return He(X,"terminalDataWriteEvent"),L.onDidWriteTerminalData(x,I,j)},get state(){return _.getState(X)},onDidChangeWindowState(x,I,j){return _.onDidChangeWindowState(x,I,j)},showInformationMessage(x,...I){return Po.showMessage(X,yi.Info,x,I[0],I.slice(1))},showWarningMessage(x,...I){return Po.showMessage(X,yi.Warning,x,I[0],I.slice(1))},showErrorMessage(x,...I){return Po.showMessage(X,yi.Error,x,I[0],I.slice(1))},showQuickPick(x,I,j){return xi.showQuickPick(X,x,I,j)},showWorkspaceFolderPick(x){return xi.showWorkspaceFolderPick(x)},showInputBox(x,I){return xi.showInput(x,I)},showOpenDialog(x){return na.showOpenDialog(X,x)},showSaveDialog(x){return na.showSaveDialog(x)},createStatusBarItem(x,I,j){let $e,S,$;return typeof x=="string"?($e=x,S=I,$=j):(S=x,$=I),hs.createStatusBarEntry(X,$e,S,$)},setStatusBarMessage(x,I){return hs.setStatusBarMessage(x,I)},withScmProgress(x){return y.report("window.withScmProgress",X,"Use 'withProgress' instead."),Kr.withProgress(X,{location:Wl.SourceControl},(I,j)=>x({report($e){}}))},withProgress(x,I){return Kr.withProgress(X,x,I)},createOutputChannel(x,I){return H.createOutputChannel(x,I,X)},createWebviewPanel(x,I,j,$e){return _e.createWebviewPanel(X,x,I,j,$e)},createWebviewTextEditorInset(x,I,j,$e){return He(X,"editorInsets"),je.createWebviewEditorInset(x,I,j,$e,X)},createTerminal(x,I,j){return typeof x=="object"?"pty"in x?L.createExtensionTerminal(x):L.createTerminalFromOptions(x):L.createTerminal(x,I,j)},registerTerminalLinkProvider(x){return L.registerLinkProvider(x)},registerTerminalProfileProvider(x,I){return L.registerProfileProvider(X,x,I)},registerTerminalQuickFixProvider(x,I){return He(X,"terminalQuickFixProvider"),L.registerTerminalQuickFixProvider(x,X.identifier.value,I)},registerTreeDataProvider(x,I){return Kt.registerTreeDataProvider(x,I,X)},createTreeView(x,I){return Kt.createTreeView(x,I,X)},registerWebviewPanelSerializer:(x,I)=>_e.registerWebviewPanelSerializer(X,x,I),registerCustomEditorProvider:(x,I,j={})=>Se.registerCustomEditorProvider(X,x,I,j),registerFileDecorationProvider(x){return R.registerFileDecorationProvider(x,X)},registerUriHandler(x){return B.registerUriHandler(X,x)},createQuickPick(){return xi.createQuickPick(X)},createInputBox(){return xi.createInputBox(X)},get activeColorTheme(){return ut.activeColorTheme},onDidChangeActiveColorTheme(x,I,j){return ut.onDidChangeActiveColorTheme(x,I,j)},registerWebviewViewProvider(x,I,j){return Ce.registerWebviewViewProvider(X,x,I,j==null?void 0:j.webviewOptions)},get activeNotebookEditor(){return de.activeNotebookEditor},onDidChangeActiveNotebookEditor(x,I,j){return de.onDidChangeActiveNotebookEditor(x,I,j)},get visibleNotebookEditors(){return de.visibleNotebookEditors},get onDidChangeVisibleNotebookEditors(){return de.onDidChangeVisibleNotebookEditors},onDidChangeNotebookEditorSelection(x,I,j){return Me.onDidChangeNotebookEditorSelection(x,I,j)},onDidChangeNotebookEditorVisibleRanges(x,I,j){return Me.onDidChangeNotebookEditorVisibleRanges(x,I,j)},showNotebookDocument(x,I){return de.showNotebookDocument(x,I)},registerExternalUriOpener(x,I,j){return He(X,"externalUriOpener"),Pt.registerExternalUriOpener(X.identifier,x,I,j)},registerProfileContentHandler(x,I){return He(X,"profileContentHandlers"),Zt.registrProfileContentHandler(X,x,I)},registerQuickDiffProvider(x,I,j,$e){return He(X,"quickDiffProvider"),mt.registerQuickDiffProvider(oe(x),I,j,$e)},get tabGroups(){return E.tabGroups},registerShareProvider(x,I){return He(X,"shareProvider"),vn.registerShareProvider(oe(x),I)}},Pc={get rootPath(){return y.report("workspace.rootPath",X,"Please use 'workspace.workspaceFolders' instead. More details: https://aka.ms/vscode-eliminating-rootpath"),s.getPath()},set rootPath(x){throw ah()},getWorkspaceFolder(x){return s.getWorkspaceFolder(x)},get workspaceFolders(){return s.getWorkspaceFolders()},get name(){return s.name},set name(x){throw ah()},get workspaceFile(){return s.workspaceFile},set workspaceFile(x){throw ah()},updateWorkspaceFolders:(x,I,...j)=>s.updateWorkspaceFolders(X,x,I||0,...j),onDidChangeWorkspaceFolders:function(x,I,j){return s.onDidChangeWorkspace(x,I,j)},asRelativePath:(x,I)=>s.getRelativePath(x,I),findFiles:(x,I,j,$e)=>s.findFiles(x,I,j,X.identifier,$e),findTextInFiles:(x,I,j,$e)=>{He(X,"findTextInFiles");let S,$;return typeof I=="object"?(S=I,$=j):(S={},$=I,$e=j),s.findTextInFiles(x,S||{},$,X.identifier,$e)},save:x=>(He(X,"saveEditor"),s.save(x)),saveAs:x=>(He(X,"saveEditor"),s.saveAs(x)),saveAll:x=>s.saveAll(x),applyEdit(x,I){return Va.applyWorkspaceEdit(x,X,I)},createFileSystemWatcher:(x,I,j,$e)=>dt.createFileSystemWatcher(s,X,x,I,j,$e),get textDocuments(){return te.getAllDocumentData().map(x=>x.document)},set textDocuments(x){throw ah()},openTextDocument(x){let I;const j=x;if(typeof x=="string")I=Promise.resolve(k.file(x));else if(k.isUri(x))I=Promise.resolve(x);else if(!j||typeof j=="object")I=te.createDocumentData(j);else throw new Error("illegal argument - uriOrFileNameOrOptions");return I.then($e=>te.ensureDocumentData($e).then(S=>S.document))},onDidOpenTextDocument:(x,I,j)=>te.onDidAddDocument(x,I,j),onDidCloseTextDocument:(x,I,j)=>te.onDidRemoveDocument(x,I,j),onDidChangeTextDocument:(x,I,j)=>te.onDidChangeDocument(x,I,j),onDidSaveTextDocument:(x,I,j)=>te.onDidSaveDocument(x,I,j),onWillSaveTextDocument:(x,I,j)=>be.getOnWillSaveTextDocumentEvent(X)(x,I,j),get notebookDocuments(){return de.notebookDocuments.map(x=>x.apiNotebook)},async openNotebookDocument(x,I){let j;if(k.isUri(x))j=x,await de.openNotebookDocument(x);else if(typeof x=="string")j=k.revive(await de.createNotebookDocument({viewType:x,content:I}));else throw new Error("Invalid arguments");return de.getNotebookDocument(j).apiNotebook},onDidSaveNotebookDocument(x,I,j){return le.onDidSaveNotebookDocument(x,I,j)},onDidChangeNotebookDocument(x,I,j){return le.onDidChangeNotebookDocument(x,I,j)},onWillSaveNotebookDocument(x,I,j){return Ge.getOnWillSaveNotebookDocumentEvent(X)(x,I,j)},get onDidOpenNotebookDocument(){return de.onDidOpenNotebookDocument},get onDidCloseNotebookDocument(){return de.onDidCloseNotebookDocument},registerNotebookSerializer(x,I,j,$e){return de.registerNotebookSerializer(X,x,I,j,ts(X,"notebookLiveShare")?$e:void 0)},onDidChangeConfiguration:(x,I,j)=>P.onDidChangeConfiguration(x,I,j),getConfiguration(x,I){return I=arguments.length===1?void 0:I,P.getConfiguration(x,I,X)},registerTextDocumentContentProvider(x,I){return ue.registerTextDocumentContentProvider(x,I)},registerTaskProvider:(x,I)=>(y.report("window.registerTaskProvider",X,"Use the corresponding function on the 'tasks' namespace instead"),K.registerTaskProvider(X,x,I)),registerFileSystemProvider(x,I,j){return Da(ai.registerFileSystemProvider(X,x,I,j),i.addFileSystemProvider(x,I,j))},get fs(){return i.value},registerFileSearchProvider:(x,I)=>(He(X,"fileSearchProvider"),Z.registerFileSearchProvider(x,I)),registerTextSearchProvider:(x,I)=>(He(X,"textSearchProvider"),Z.registerTextSearchProvider(x,I)),registerRemoteAuthorityResolver:(x,I)=>(He(X,"resolvers"),n.registerRemoteAuthorityResolver(x,I)),registerResourceLabelFormatter:x=>(He(X,"resolvers"),qn.$registerResourceLabelFormatter(x)),getRemoteExecServer:x=>(He(X,"resolvers"),n.getRemoteExecServer(x)),onDidCreateFiles:(x,I,j)=>dt.onDidCreateFile(x,I,j),onDidDeleteFiles:(x,I,j)=>dt.onDidDeleteFile(x,I,j),onDidRenameFiles:(x,I,j)=>dt.onDidRenameFile(x,I,j),onWillCreateFiles:(x,I,j)=>dt.getOnWillCreateFileEvent(X)(x,I,j),onWillDeleteFiles:(x,I,j)=>dt.getOnWillDeleteFileEvent(X)(x,I,j),onWillRenameFiles:(x,I,j)=>dt.getOnWillRenameFileEvent(X)(x,I,j),openTunnel:x=>(He(X,"tunnels"),m.openTunnel(X,x).then(I=>{if(!I)throw new Error("cannot open tunnel");return I})),get tunnels(){return He(X,"tunnels"),m.getTunnels()},onDidChangeTunnels:(x,I,j)=>(He(X,"tunnels"),m.onDidChangeTunnels(x,I,j)),registerPortAttributesProvider:(x,I)=>(He(X,"portsAttributes"),m.registerPortsAttributesProvider(x,I)),registerTimelineProvider:(x,I)=>(He(X,"timeline"),J.registerTimelineProvider(x,I,X.identifier,O.converter)),get isTrusted(){return s.trusted},requestWorkspaceTrust:x=>(He(X,"workspaceTrust"),s.requestWorkspaceTrust(x)),onDidGrantWorkspaceTrust:(x,I,j)=>s.onDidGrantWorkspaceTrust(x,I,j),registerEditSessionIdentityProvider:(x,I)=>(He(X,"editSessionIdentityProvider"),s.registerEditSessionIdentityProvider(x,I)),onWillCreateEditSessionIdentity:(x,I,j)=>(He(X,"editSessionIdentityProvider"),s.getOnWillCreateEditSessionIdentityEvent(X)(x,I,j)),registerCanonicalUriProvider:(x,I)=>(He(X,"canonicalUriProvider"),s.registerCanonicalUriProvider(x,I)),getCanonicalUri:(x,I,j)=>(He(X,"canonicalUriProvider"),s.provideCanonicalUri(x,I,j))},no={get inputBox(){return y.report("scm.inputBox",X,"Use 'SourceControl.inputBox' instead"),ci.getLastInputBox(X)},createSourceControl(x,I,j){return ci.createSourceControl(X,x,I,j)}},Ac={createCommentController(x,I){return zr.createCommentController(X,x,I)}},qa={get activeDebugSession(){return W.activeDebugSession},get activeDebugConsole(){return W.activeDebugConsole},get breakpoints(){return W.breakpoints},get stackFrameFocus(){return W.stackFrameFocus},onDidStartDebugSession(x,I,j){return W.onDidStartDebugSession(x,I,j)},onDidTerminateDebugSession(x,I,j){return W.onDidTerminateDebugSession(x,I,j)},onDidChangeActiveDebugSession(x,I,j){return W.onDidChangeActiveDebugSession(x,I,j)},onDidReceiveDebugSessionCustomEvent(x,I,j){return W.onDidReceiveDebugSessionCustomEvent(x,I,j)},onDidChangeBreakpoints(x,I,j){return W.onDidChangeBreakpoints(x,I,j)},onDidChangeStackFrameFocus(x,I,j){return He(X,"debugFocus"),W.onDidChangeStackFrameFocus(x,I,j)},registerDebugConfigurationProvider(x,I,j){return W.registerDebugConfigurationProvider(x,I,j||R_.Initial)},registerDebugAdapterDescriptorFactory(x,I){return W.registerDebugAdapterDescriptorFactory(X,x,I)},registerDebugAdapterTrackerFactory(x,I){return W.registerDebugAdapterTrackerFactory(x,I)},startDebugging(x,I,j){return!j||typeof j=="object"&&"configuration"in j?W.startDebugging(x,I,{parentSession:j}):W.startDebugging(x,I,j||{})},stopDebugging(x){return W.stopDebugging(x)},addBreakpoints(x){return W.addBreakpoints(x)},removeBreakpoints(x){return W.removeBreakpoints(x)},asDebugSourceUri(x,I){return W.asDebugSourceUri(x,I)}},Ga={registerTaskProvider:(x,I)=>K.registerTaskProvider(X,x,I),fetchTasks:x=>K.fetchTasks(x),executeTask:x=>K.executeTask(X,x),get taskExecutions(){return K.taskExecutions},onDidStartTask:(x,I,j)=>K.onDidStartTask(x,I,j),onDidEndTask:(x,I,j)=>K.onDidEndTask(x,I,j),onDidStartTaskProcess:(x,I,j)=>K.onDidStartTaskProcess(x,I,j),onDidEndTaskProcess:(x,I,j)=>K.onDidEndTaskProcess(x,I,j)},Pe={createNotebookController(x,I,j,$e,S){return Re.createNotebookController(X,x,I,j,$e,ts(X,"notebookMessaging")?S:void 0)},registerNotebookCellStatusBarItemProvider:(x,I)=>de.registerNotebookCellStatusBarItemProvider(X,x,I),createRendererMessaging(x){return Oe.createRendererMessaging(X,x)},createNotebookControllerDetectionTask(x){return He(X,"notebookKernelSource"),Re.createNotebookControllerDetectionTask(X,x)},registerKernelSourceActionProvider(x,I){return He(X,"notebookKernelSource"),Re.registerKernelSourceActionProvider(X,x,I)},onDidChangeNotebookCellExecutionState(x,I,j){return He(X,"notebookCellExecutionState"),Re.onDidChangeNotebookCellExecutionState(x,I,j)}},Ne={t(...x){if(typeof x[0]=="string"){const I=x.shift(),j=!x||typeof x[0]!="object"?x:x[0];return C.getMessage(X.identifier.value,{message:I,args:j})}return C.getMessage(X.identifier.value,x[0])},get bundle(){return C.getBundle(X.identifier.value)},get uri(){return C.getBundleUri(X.identifier.value)}},N={_version:1,registerInteractiveEditorSessionProvider(x){return He(X,"interactive"),cr.registerProvider(X,x)},registerInteractiveSessionProvider(x,I){return He(X,"interactive"),yn.registerChatProvider(X,x,I)},addInteractiveRequest(x){return He(X,"interactive"),yn.addChatRequest(x)},sendInteractiveRequestToProvider(x,I){return He(X,"interactive"),yn.sendInteractiveRequestToProvider(x,I)},get onDidPerformUserAction(){return He(X,"interactiveUserActions"),yn.onDidPerformUserAction},transferChatSession(x,I){return He(X,"interactive"),yn.transferChatSession(x,I)}},Q={registerSlashCommandProvider(x,I){return He(X,"interactiveSlashCommands"),yn.registerSlashCommandProvider(X,x,I)}},ve={registerSemanticSimilarityProvider(x){return He(X,"semanticSimilarity"),Ro.registerSemanticSimilarityProvider(X,x)}};return{version:e.version,ai:ve,authentication:tt,commands:ei,comments:Ac,debug:qa,env:wi,extensions:Tn,interactive:N,interactiveSlashCommands:Q,l10n:Ne,languages:Ao,notebooks:Pe,scm:no,tasks:Ga,tests:nn,window:ra,workspace:Pc,Breakpoint:vf,TerminalOutputAnchor:ZP,CallHierarchyIncomingCall:k1,CallHierarchyItem:Ak,CallHierarchyOutgoingCall:T1,CancellationError:yh,CancellationTokenSource:Xt,CandidatePortSource:X_,CodeAction:d_,CodeActionKind:$i,CodeActionTriggerKind:uf,CodeLens:l_,Color:pf,ColorInformation:m_,ColorPresentation:v_,ColorThemeKind:Kc,CommentMode:nE,CommentState:oA,CommentThreadCollapsibleState:Kg,CommentThreadState:k_,CompletionItem:f_,CompletionItemKind:ht,CompletionItemTag:jg,CompletionList:hf,CompletionTriggerKind:kh,ConfigurationTarget:Ih,CustomExecution:Mk,DebugAdapterExecutable:w_,DebugAdapterInlineImplementation:S_,DebugAdapterNamedPipeServer:b_,DebugAdapterServer:Gg,DebugConfigurationProviderTriggerKind:R_,DebugConsoleMode:T_,DecorationRangeBehavior:yl,Diagnostic:o_,DiagnosticRelatedInformation:Fg,DiagnosticSeverity:ur,DiagnosticTag:vl,Disposable:Yt,DocumentHighlight:c_,DocumentHighlightKind:Og,DocumentLink:g_,DocumentSymbol:Wg,EndOfLine:Bo,EnvironmentVariableMutatorType:xh,EvaluatableExpression:C_,InlineValueText:E_,InlineValueVariableLookup:x_,InlineValueEvaluatableExpression:D_,InlineCompletionTriggerKind:zg,EventEmitter:A,ExtensionKind:jl,ExtensionMode:Mh,ExternalUriOpenerPriority:hE,FileChangeType:Ph,FileDecoration:sE,FileDecoration2:sE,FileSystemError:In,FileType:Or,FilePermission:ad,FoldingRange:iE,FoldingRangeKind:nc,FunctionBreakpoint:wl,InlineCompletionItem:qC,InlineCompletionList:GC,Hover:a_,IndentAction:Fp,Location:wo,MarkdownString:Ia,OverviewRulerLane:Qw,ParameterInformation:HC,PortAutoForwardAction:_A,Position:At,ProcessExecution:gf,ProgressLocation:Wl,QuickInputButtons:_f,Range:Tt,RelativePattern:Rh,Selection:wd,SelectionRange:Hg,SemanticTokens:yf,SemanticTokensBuilder:fz,SemanticTokensEdit:I1,SemanticTokensEdits:wy,SemanticTokensLegend:rE,ShellExecution:su,ShellQuoting:QC,SignatureHelp:BC,SignatureHelpTriggerKind:UC,SignatureInformation:jC,SnippetString:ru,SourceBreakpoint:_l,StandardTokenType:bl,StatusBarAlignment:Jc,SymbolInformation:$g,SymbolKind:Ai,SymbolTag:Ng,Task:ou,TaskGroup:Cd,TaskPanelKind:nA,TaskRevealKind:iA,TaskScope:mf,TerminalLink:dz,TerminalQuickFixCommand:rte,TerminalQuickFixOpener:nte,TerminalLocation:KC,TerminalProfile:lz,TerminalExitReason:zC,TerminalQuickFixType:s_,TextDocumentSaveReason:Th,TextEdit:bd,SnippetTextEdit:Pk,TextEditorCursorStyle:HN,TextEditorLineNumbersStyle:ic,TextEditorRevealType:p_,TextEditorSelectionChangeKind:ff,TextDocumentChangeReason:Ug,ThemeColor:qg,ThemeIcon:Es,TreeItem:y_,TreeItemCheckboxState:fa,TreeItemCollapsibleState:Hl,TypeHierarchyItem:Fk,UIKind:Yo,Uri:k,ViewColumn:Bg,WorkspaceEdit:Sd,DocumentDropEdit:XC,DocumentPasteEdit:JC,InlayHint:h_,InlayHintLabelPart:u_,InlayHintKind:VC,RemoteAuthorityResolverError:$l,ResolvedAuthority:ete,ManagedResolvedAuthority:eA,SourceControlInputBoxValidationType:tA,ExtensionRuntime:uE,TimelineItem:uA,NotebookRange:Zc,NotebookCellKind:dh,NotebookCellExecutionState:Yg,NotebookCellData:Lk,NotebookData:gz,NotebookRendererScript:mz,NotebookCellStatusBarAlignment:cE,NotebookEditorRevealType:dE,NotebookCellOutput:aE,NotebookCellOutputItem:R1,NotebookCellStatusBarItem:dte,NotebookControllerAffinity:lA,NotebookControllerAffinity2:lE,NotebookEdit:WC,NotebookKernelSourceAction:lte,PortAttributes:ute,LinkedEditingRanges:vz,TestResultState:hA,TestRunRequest:Xg,TestRunRequest2:fA,TestMessage:I_,TestTag:Jg,TestRunProfileKind:Lh,TextSearchCompleteMessageType:pE,DataTransfer:Vg,DataTransferItem:__,CoveredCount:dg,FileCoverage:pA,StatementCoverage:gA,BranchCoverage:mA,FunctionCoverage:vA,WorkspaceTrustState:yA,LanguageStatusSeverity:Dh,QuickPickItemKind:Qg,InputBoxValidationSeverity:Ah,TabInputText:Ok,TabInputTextDiff:Nk,TabInputTextMerge:yz,TabInputCustom:$k,TabInputNotebook:Wk,TabInputNotebookDiff:Hk,TabInputWebview:P1,TabInputTerminal:A1,TabInputInteractiveWindow:_z,TelemetryTrustedValue:jk,LogLevel:ua,EditSessionIdentityMatch:LM,InteractiveSessionVoteDirection:wA,InteractiveSessionCopyKind:bA,InteractiveEditorResponseFeedbackKind:lg,StackFrameFocus:eE,ThreadFocus:tE,NotebookCodeActionKind:tte}}}let sF=class{constructor(e,t,i,n,s,o,a){this._apiFactory=e,this._extensionRegistry=t,this._instaService=i,this._extHostConfiguration=n,this._extHostExtensionService=s,this._initData=o,this._logService=a,this._factories=new Map,this._alternatives=[]}async install(){this._installInterceptor(),qt("code/extHost/willWaitForConfig");const e=await this._extHostConfiguration.getConfigProvider();qt("code/extHost/didWaitForConfig");const t=await this._extHostExtensionService.getExtensionPathIndex();this.register(new Tge(this._apiFactory,t,this._extensionRegistry,e,this._logService)),this.register(this._instaService.createInstance(aF,t)),this.register(this._instaService.createInstance(jx)),this._initData.remote.isRemote&&this.register(this._instaService.createInstance(cF,t,this._initData.environment.appUriScheme))}register(e){if("nodeModuleName"in e)if(Array.isArray(e.nodeModuleName))for(const t of e.nodeModuleName)this._factories.set(t,e);else this._factories.set(e.nodeModuleName,e);typeof e.alternativeModuleName=="function"&&this._alternatives.push(t=>e.alternativeModuleName(t))}};sF=T([v(2,Te),v(3,Wd),v(4,xu),v(5,Gr),v(6,ze)],sF);let jx=class oF{constructor(e){if(e.environment.appRoot&&oF.aliased.size){const t=Hq(this.forceForwardSlashes(e.environment.appRoot.fsPath)),i="[a-z0-9_.-]",n=`@${i}+\\/${i}+|${i}+`,s="node_modules|node_modules\\.asar(?:\\.unpacked)?";this.re=new RegExp(`^(${t}/${s}\\/)(${n})(.*)$`,"i")}}alternativeModuleName(e){if(!this.re)return;const t=this.re.exec(this.forceForwardSlashes(e));if(!t)return;const[,i,n,s]=t,o=oF.aliased.get(n);if(o!==void 0)return console.warn(`${n} as been renamed to ${o}, please update your imports`),i+o+s}forceForwardSlashes(e){return e.replace(/\\/g,"/")}};jx.aliased=new Map([["vscode-ripgrep","@vscode/ripgrep"],["vscode-windows-registry","@vscode/windows-registry"]]);jx=T([v(0,Gr)],jx);class Tge{constructor(e,t,i,n,s){this._apiFactory=e,this._extensionPaths=t,this._extensionRegistry=i,this._configProvider=n,this._logService=s,this.nodeModuleName="vscode",this._extApiImpl=new Ln}load(e,t){const i=this._extensionPaths.findSubstr(t);if(i){let n=this._extApiImpl.get(i.identifier);return n||(n=this._apiFactory(i,this._extensionRegistry,this._configProvider),this._extApiImpl.set(i.identifier,n)),n}if(!this._defaultApiImpl){let n="";this._extensionPaths.forEach((s,o)=>n+=`	${o} -> ${s.identifier.value}
`),this._logService.warn(`Could not identify extension for 'vscode' require call from ${t}. These are the extension path mappings: 
${n}`),this._defaultApiImpl=this._apiFactory(v3,this._extensionRegistry,this._configProvider)}return this._defaultApiImpl}}let aF=class{constructor(e,t,i){this._extensionPaths=e,this.nodeModuleName="keytar",this._mainThreadTelemetry=t.getProxy(ce.MainThreadTelemetry);const{environment:n}=i,s=t.getProxy(ce.MainThreadKeytar);if(n.appRoot){let o=n.appRoot.fsPath;r7==="win32"&&(o=o.replace(/\\/g,"/")),o[o.length-1]==="/"&&(o=o.substr(0,o.length-1)),this.alternativeNames=new Set,this.alternativeNames.add(`${o}/node_modules.asar/keytar`),this.alternativeNames.add(`${o}/node_modules/keytar`)}this._impl={getPassword:(o,a)=>s.$getPassword(o,a),setPassword:(o,a,c)=>s.$setPassword(o,a,c),deletePassword:(o,a)=>s.$deletePassword(o,a),findPassword:o=>s.$findPassword(o),findCredentials(o){return s.$findCredentials(o)}}}load(e,t){const i=this._extensionPaths.findSubstr(t);return this._mainThreadTelemetry.$publicLog2("shimming.keytar",{extension:(i==null?void 0:i.identifier.value)??"unknown_extension"}),this._impl}alternativeModuleName(e){const t=e.length;if(t<=7||!this.alternativeNames)return;const i=t-7;if((e.charAt(i)==="/"||e.charAt(i)==="\\")&&e.endsWith("keytar")&&(e=e.replace(/\\/g,"/"),this.alternativeNames.has(e)))return"keytar"}};aF=T([v(1,Ii),v(2,Gr)],aF);let cF=class{constructor(e,t,i){this._extensionPaths=e,this._appUriScheme=t,this.nodeModuleName=["open","opn"],this._mainThreadTelemetry=i.getProxy(ce.MainThreadTelemetry);const n=i.getProxy(ce.MainThreadWindow);this._impl=(s,o)=>{const a=k.parse(s);return o?this.callOriginal(s,o):a.scheme==="http"||a.scheme==="https"?n.$openUri(a,s,{allowTunneling:!0}):a.scheme==="mailto"||a.scheme===this._appUriScheme?n.$openUri(a,s,{}):this.callOriginal(s,o)}}load(e,t,i){const n=this._extensionPaths.findSubstr(t);return n&&(this._extensionId=n.identifier.value,this.sendShimmingTelemetry()),this._original=i(e),this._impl}callOriginal(e,t){return this.sendNoForwardTelemetry(),this._original(e,t)}sendShimmingTelemetry(){this._extensionId&&this._mainThreadTelemetry.$publicLog2("shimming.open",{extension:this._extensionId})}sendNoForwardTelemetry(){this._extensionId&&this._mainThreadTelemetry.$publicLog2("shimming.open.call.noForward",{extension:this._extensionId})}};cF=T([v(2,Ii)],cF);let dF=class{constructor(e,t){this._mainThreadConsole=e.getProxy(ce.MainThreadConsole),this._includeStack=t.consoleForward.includeStack,this._logNative=t.consoleForward.logNative,this._wrapConsoleMethod("info","log"),this._wrapConsoleMethod("log","log"),this._wrapConsoleMethod("warn","warn"),this._wrapConsoleMethod("error","error")}_wrapConsoleMethod(e,t){const i=this,n=console[e];Object.defineProperty(console,e,{set:()=>{},get:()=>function(){i._handleConsoleCall(e,t,n,arguments)}})}_handleConsoleCall(e,t,i,n){this._mainThreadConsole.$logExtensionHostMessage({type:"__$console",severity:t,arguments:Rge(n,this._includeStack)}),this._logNative&&this._nativeConsoleLogMessage(e,i,n)}};dF=T([v(0,Ii),v(1,Gr)],dF);const Ige=1e5;function Rge(r,e){const t=[];if(r.length)for(let i=0;i<r.length;i++){let n=r[i];if(typeof n>"u")n="undefined";else if(n instanceof Error){const s=n;s.stack?n=s.stack:n=s.toString()}t.push(n)}if(e){const i=new Error().stack;i&&t.push({__$stack:i.split(`
`).slice(3).join(`
`)})}try{const i=s7(t);return i.length>Ige?"Output omitted for a large object that exceeds the limits":i}catch(i){return`Output omitted for an object that cannot be inspected ('${i.toString()}')`}}let lF=class extends dF{constructor(e,t){super(e,t)}_nativeConsoleLogMessage(e,t,i){t.apply(console,i)}};lF=T([v(0,Ii),v(1,Gr)],lF);class Pge extends sF{_installInterceptor(){}getModule(e,t){for(const i of this._alternatives){const n=i(e);if(n){e=n;break}}if(this._factories.has(e))return this._factories.get(e).load(e,t,()=>{throw new Error("CANNOT LOAD MODULE from here.")})}}class Age extends kL{constructor(){super(...arguments),this.extensionRuntime=uE.Webworker}async _beforeAlmostReadyToRunExtensions(){SC&&this._instaService.createInstance(lF),this._apiFactory=this._instaService.invokeFunction(kge),this._fakeModules=this._instaService.createInstance(Pge,this._apiFactory,{mine:this._myRegistry,all:this._globalRegistry}),await this._fakeModules.install(),performance.mark("code/extHost/didInitAPI"),await this._waitForDebuggerAttachment()}_getEntryPoint(e){return e.browser}async _loadCommonJSModule(e,t,i){t=t.with({path:Mge(t.path,".js")});const n=e==null?void 0:e.identifier.value;n&&performance.mark(`code/extHost/willFetchExtensionCode/${n}`);const s=k.revive(await this._mainThreadExtensionsProxy.$asBrowserUri(t)),o=await fetch(s.toString(!0));if(n&&performance.mark(`code/extHost/didFetchExtensionCode/${n}`),o.status!==200)throw new Error(o.statusText);const a=await o.text(),c=`${t.toString(!0)}#vscode-extension`,d=`${a}
//# sourceURL=${c}`;let l;try{l=new Function("module","exports","require",d)}catch(m){throw console.error(n?`Loading code for extension ${n} failed: ${m.message}`:`Loading code failed: ${m.message}`),console.error(`${t.toString(!0)}${typeof m.line=="number"?` line ${m.line}`:""}${typeof m.column=="number"?` column ${m.column}`:""}`),console.error(m),m}e&&await this._extHostLocalizationService.initializeLocalizedMessages(e);const u={},h={exports:u},g=m=>{const y=this._fakeModules.getModule(m,t);if(y===void 0)throw new Error(`Cannot load module '${m}'`);return y};try{return i.codeLoadingStart(),n&&performance.mark(`code/extHost/willLoadExtensionCode/${n}`),l(h,u,g),h.exports!==u?h.exports:u}finally{n&&performance.mark(`code/extHost/didLoadExtensionCode/${n}`),i.codeLoadingStop()}}async $setRemoteEnvironment(e){}async _waitForDebuggerAttachment(e=5e3){if(!this._initData.environment.isExtensionDevelopmentDebug)return;const t=Date.now()+e;for(;Date.now()<t&&!("__jsDebugIsReady"in globalThis);)await zs(10)}}function Mge(r,e){return r.endsWith(e)?r:r+e}let uF=class extends o7{constructor(e,t,i){const n=i.remote.isRemote?"remoteexthost":e?"workerexthost":"exthost",s=i.remote.isRemote?p("remote","Extension Host (Remote)"):e?p("worker","Extension Host (Worker)"):p("local","Extension Host");super(t.createLogger(n,{name:s}))}};uF=T([v(1,Is),v(2,Gr)],uF);class SU{static async installEarlyHandler(e){const t=e.get(ze),n=e.get(Ii).getProxy(ce.MainThreadErrors);PP(s=>{t.error(s);const o=yC(s);n.$onUnexpectedError(o)})}static async installFullHandler(e){const t=e.get(ze),i=e.get(Ii),n=e.get(xu),s=e.get(XT),o=i.getProxy(ce.MainThreadExtensionService),a=i.getProxy(ce.MainThreadErrors),c=await n.getExtensionPathIndex(),d=new WeakMap;function l(g,m){if(d.has(g))return d.get(g).stack;let y="",_,b;for(const D of m)y+=`
	at ${D.toString()}`,b=D.getFileName(),!_&&b&&(_=c.findSubstr(k.file(b)));const E=`${g.name||"Error"}: ${g.message||""}${y}`;return d.set(g,{extensionIdentifier:_==null?void 0:_.identifier,stack:E}),E}const u=Symbol("prepareStackTrace wrapped");let h=l;Object.defineProperty(Error,"prepareStackTrace",{configurable:!1,get(){return h},set(g){if(g===l||g[u]){h=g;return}h=function(m,y){return l(m,y),g.call(Error,m,y)},Object.assign(h,{[u]:!0})}}),PP(g=>{t.error(g);const m=yC(g),y=d.get(g);if(!(y!=null&&y.extensionIdentifier)){a.$onUnexpectedError(m);return}o.$onExtensionRuntimeError(y.extensionIdentifier,m);const _=s.onExtensionError(y.extensionIdentifier,g);t.trace("forwarded error to extension?",_,y)})}}Error.stackTraceLimit=100;class G${constructor(e,t,i,n,s){this._hostUtils=i,this._rpcProtocol=new um(e,null,n),t=G$._transform(t,this._rpcProtocol);const o=new Of(...a7());o.set(Gr,{_serviceBrand:void 0,...t,messagePorts:s}),o.set(Ii,new tfe(this._rpcProtocol)),o.set(KT,new gfe(n)),o.set(A5,i),o.set(ze,new er(uF,[!0],!0));const a=new c7(o,!0);SC&&a.invokeFunction(SU.installEarlyHandler),this._logService=a.invokeFunction(c=>c.get(ze)),qt("code/extHost/didCreateServices"),this._hostUtils.pid?this._logService.info(`Extension host with pid ${this._hostUtils.pid} started`):this._logService.info("Extension host started"),this._logService.trace("initData",t),this._extensionService=a.invokeFunction(c=>c.get(xu)),this._extensionService.initialize(),SC&&a.invokeFunction(SU.installFullHandler)}async asBrowserUri(e){const t=this._rpcProtocol.getProxy(ce.MainThreadExtensionService);return k.revive(await t.$asBrowserUri(e))}async getAllStaticBrowserUris(){return(await this._rpcProtocol.getProxy(ce.MainThreadExtensionService).$getAllStaticBrowserUris()).map(([t,i])=>[k.revive(t),k.revive(i)])}terminate(e){this._extensionService.terminate(e)}getExtHostExtensionService(){return this._extensionService}static _transform(e,t){e.allExtensions.forEach(n=>{n.extensionLocation=k.revive(t.transformIncomingURIs(n.extensionLocation))}),e.environment.appRoot=k.revive(t.transformIncomingURIs(e.environment.appRoot));const i=e.environment.extensionDevelopmentLocationURI;return i&&(e.environment.extensionDevelopmentLocationURI=i.map(n=>k.revive(t.transformIncomingURIs(n)))),e.environment.extensionTestsLocationURI=k.revive(t.transformIncomingURIs(e.environment.extensionTestsLocationURI)),e.environment.globalStorageHome=k.revive(t.transformIncomingURIs(e.environment.globalStorageHome)),e.environment.workspaceStorageHome=k.revive(t.transformIncomingURIs(e.environment.workspaceStorageHome)),e.environment.extensionTelemetryLogResource=k.revive(t.transformIncomingURIs(e.environment.extensionTelemetryLogResource)),e.nlsBaseUrl=k.revive(t.transformIncomingURIs(e.nlsBaseUrl)),e.logsLocation=k.revive(t.transformIncomingURIs(e.logsLocation)),e.workspace=t.transformIncomingURIs(e.workspace),e}}class Lge extends vk{constructor(e=d7){super(),this.buffer=[],this._logger=void 0,this.setLevel(e),this._register(this.onDidChangeLogLevel(t=>{var i;(i=this._logger)==null||i.setLevel(t)}))}set logger(e){this._logger=e;for(const{level:t,message:i}of this.buffer)EC(e,t,i);this.buffer=[]}log(e,t){this._logger?EC(this._logger,e,t):this.getLevel()<=e&&this.buffer.push({level:e,message:t})}dispose(){var e;(e=this._logger)==null||e.dispose()}flush(){var e;(e=this._logger)==null||e.flush()}}const Fge=5*_s.MB;let hF=class extends vk{constructor(e,t,i,n){super(),this.resource=e,this.donotUseFormatters=i,this.fileService=n,this.backupIndex=1,this.buffer="",this.setLevel(t),this.flushDelayer=new ok(100),this.initializePromise=this.initialize()}async flush(){if(!this.buffer)return;await this.initializePromise;let e=await this.loadContent();e.length>Fge&&(await this.fileService.writeFile(this.getBackupResource(),De.fromString(e)),e=""),this.buffer&&(e+=this.buffer,this.buffer="",await this.fileService.writeFile(this.resource,De.fromString(e)))}async initialize(){try{await this.fileService.createFile(this.resource)}catch(e){if(e.fileOperationResult!==3)throw e}}log(e,t){this.donotUseFormatters?this.buffer+=t:this.buffer+=`${this.getCurrentTimestamp()} [${this.stringifyLogLevel(e)}] ${t}
`,this.flushDelayer.trigger(()=>this.flush())}getCurrentTimestamp(){const e=n=>n<10?`0${n}`:n,t=n=>n<10?`00${n}`:n<100?`0${n}`:n,i=new Date;return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())} ${e(i.getHours())}:${e(i.getMinutes())}:${e(i.getSeconds())}.${t(i.getMilliseconds())}`}getBackupResource(){return this.backupIndex=this.backupIndex>5?1:this.backupIndex,pt(pn(this.resource),`${Mt(this.resource)}_${this.backupIndex++}`)}async loadContent(){try{return(await this.fileService.readFile(this.resource)).value.toString()}catch{return""}}stringifyLogLevel(e){switch(e){case ua.Debug:return"debug";case ua.Error:return"error";case ua.Info:return"info";case ua.Trace:return"trace";case ua.Warning:return"warning"}return""}};hF=T([v(3,at)],hF);class Oge extends XN{constructor(e,t,i){super(e,t),this.fileService=i}doCreateLogger(e,t,i){const n=new Lge(t);return l7(e,this.fileService).then(()=>n.logger=new hF(e,n.getLevel(),!!(i!=null&&i.donotUseFormatters),this.fileService)),n}}function Bx(r,e,t){let i=!1;const n=Nge(r);if(LT(n)&&(e.restoreViewState(n),i=!0),r.selection){const s={startLineNumber:r.selection.startLineNumber,startColumn:r.selection.startColumn,endLineNumber:r.selection.endLineNumber??r.selection.startLineNumber,endColumn:r.selection.endColumn??r.selection.startColumn};e.setSelection(s,r.selectionSource??"code.navigation"),r.selectionRevealType===2?e.revealRangeNearTop(s,t):r.selectionRevealType===3?e.revealRangeNearTopIfOutsideViewport(s,t):r.selectionRevealType===1?e.revealRangeInCenterIfOutsideViewport(s,t):e.revealRangeInCenter(s,t),i=!0}return i}function Nge(r){if(!r.selection||!r.viewState)return r.viewState;const e=r.viewState;if(e.modified)return e.modified.cursorState=[],e;const t=r.viewState;return t.cursorState&&(t.cursorState=[]),t}class z${static create(e,t,i){return new z$(e,t,i)}constructor(e,t,i){this.ctor=e,this.typeId=t,this.name=i}instantiate(e){return e.createInstance(this.ctor)}describes(e){return e.getId()===this.typeId}}class $ge{constructor(){this.mapEditorPanesToEditors=new Map}registerEditorPane(e,t){return this.mapEditorPanesToEditors.set(e,t),ot(()=>{this.mapEditorPanesToEditors.delete(e)})}getEditorPane(e){const t=this.findEditorPaneDescriptors(e);if(t.length!==0)return t.length===1?t[0]:e.prefersEditorPane(t)}findEditorPaneDescriptors(e,t){const i=[];for(const n of this.mapEditorPanesToEditors.keys()){const s=this.mapEditorPanesToEditors.get(n)||[];for(const o of s){const a=o.ctor;if(!t&&e.constructor===a){i.push(n);break}else if(t&&e instanceof a){i.push(n);break}}}return!t&&i.length===0?this.findEditorPaneDescriptors(e,!0):i}getEditorPaneByType(e){return Go.find(this.mapEditorPanesToEditors.keys(),t=>t.typeId===e)}getEditorPanes(){return Array.from(this.mapEditorPanesToEditors.keys())}getEditors(){const e=[];for(const t of this.mapEditorPanesToEditors.keys()){const i=this.mapEditorPanesToEditors.get(t);i&&e.push(...i.map(n=>n.ctor))}return e}}st.add(au.EditorPane,new $ge);function Wge(r,e,t,i){let n=r.getAriaLabel();return t&&!t.isPinned(r)&&(n=p("preview","{0}, preview",n)),t!=null&&t.isSticky(e??r)&&(n=p("pinned","{0}, pinned",n)),t&&typeof i=="number"&&i>1&&(n=`${n}, ${t.ariaLabel}`),n}let Ux=class extends Wh{constructor(e,t,i,n,s,o,a,c,d){super(e,i,a,s),this.instantiationService=n,this.textResourceConfigurationService=o,this.editorService=c,this.editorGroupService=d,this.groupListener=this._register(new Hr),this.viewState=this.getEditorMemento(d,o,t,100)}setEditorVisible(e,t){this.groupListener.value=t==null?void 0:t.onWillCloseEditor(i=>this.onWillCloseEditor(i)),super.setEditorVisible(e,t)}onWillCloseEditor(e){const t=e.editor;t===this.input&&this.updateEditorViewState(t)}clearInput(){this.updateEditorViewState(this.input),super.clearInput()}saveState(){this.updateEditorViewState(this.input),super.saveState()}updateEditorViewState(e){if(!e||!this.tracksEditorViewState(e))return;const t=this.toEditorViewStateResource(e);t&&(this.tracksDisposedEditorViewState()||(this.editorViewStateDisposables||(this.editorViewStateDisposables=new Map),this.editorViewStateDisposables.has(e)||this.editorViewStateDisposables.set(e,F.once(e.onWillDispose)(()=>{var i;this.clearEditorViewState(t,this.group),(i=this.editorViewStateDisposables)==null||i.delete(e)}))),e.isDisposed()&&!this.tracksDisposedEditorViewState()||!this.shouldRestoreEditorViewState(e)&&(!this.group||!this.group.contains(e))?this.clearEditorViewState(t,this.group):e.isDisposed()||this.saveEditorViewState(t))}shouldRestoreEditorViewState(e,t){return t!=null&&t.newInGroup?this.textResourceConfigurationService.getValue(Vn.getOriginalUri(e,{supportSideBySide:Ui.PRIMARY}),"workbench.editor.restoreViewState")!==!1:!0}getViewState(){const e=this.input;if(!e||!this.tracksEditorViewState(e))return;const t=this.toEditorViewStateResource(e);if(t)return this.computeEditorViewState(t)}saveEditorViewState(e){if(!this.group)return;const t=this.computeEditorViewState(e);t&&this.viewState.saveEditorState(this.group,e,t)}loadEditorViewState(e,t){if(!e||!this.group||!this.tracksEditorViewState(e)||!this.shouldRestoreEditorViewState(e,t))return;const i=this.toEditorViewStateResource(e);if(i)return this.viewState.loadEditorState(this.group,i)}moveEditorViewState(e,t,i){return this.viewState.moveEditorState(e,t,i)}clearEditorViewState(e,t){this.viewState.clearEditorState(e,t)}dispose(){if(super.dispose(),this.editorViewStateDisposables){for(const[,e]of this.editorViewStateDisposables)e.dispose();this.editorViewStateDisposables=void 0}}tracksDisposedEditorViewState(){return!1}};Ux=T([v(2,gi),v(3,Te),v(4,ri),v(5,Do),v(6,Fi),v(7,Ke),v(8,it)],Ux);let km=class l8 extends Ux{constructor(e,t,i,n,s,o,a,c,d){super(e,l8.VIEW_STATE_PREFERENCE_KEY,t,i,n,s,o,a,c),this.fileService=d,this._onDidChangeSelection=this._register(new A),this.onDidChangeSelection=this._onDidChangeSelection.event,this.inputListener=this._register(new Hr),this._register(this.textResourceConfigurationService.onDidChangeConfiguration(l=>this.handleConfigurationChangeEvent(l))),this._register(F.any(this.editorGroupService.onDidAddGroup,this.editorGroupService.onDidRemoveGroup)(()=>{var u;const l=this.computeAriaLabel();(u=this.editorContainer)==null||u.setAttribute("aria-label",l),this.updateEditorControlOptions({ariaLabel:l})})),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(l=>this.onDidChangeFileSystemProvider(l.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(l=>this.onDidChangeFileSystemProvider(l.scheme)))}handleConfigurationChangeEvent(e){const t=this.getActiveResource();this.shouldHandleConfigurationChangeEvent(e,t)&&(this.isVisible()?this.updateEditorConfiguration(t):this.hasPendingConfigurationChange=!0)}shouldHandleConfigurationChangeEvent(e,t){return e.affectsConfiguration(t,"editor")}consumePendingConfigurationChangeEvent(){this.hasPendingConfigurationChange&&(this.updateEditorConfiguration(),this.hasPendingConfigurationChange=!1)}computeConfiguration(e){const t=bn(e.editor)?Gi(e.editor):Object.create(null);return Object.assign(t,this.getConfigurationOverrides()),t.ariaLabel=this.computeAriaLabel(),t}computeAriaLabel(){return this._input?Wge(this._input,void 0,this.group,this.editorGroupService.count):p("editor","Editor")}onDidChangeFileSystemProvider(e){var t;this.input&&((t=this.getActiveResource())==null?void 0:t.scheme)===e&&this.updateReadonly(this.input)}onDidChangeInputCapabilities(e){this.input===e&&this.updateReadonly(e)}updateReadonly(e){this.updateEditorControlOptions({...this.getReadonlyConfiguration(e.isReadonly())})}getReadonlyConfiguration(e){return{readOnly:!!e,readOnlyMessage:typeof e!="boolean"?e:void 0}}getConfigurationOverrides(){var e;return{overviewRulerLanes:3,lineNumbersMinChars:3,fixedOverflowWidgets:!0,...this.getReadonlyConfiguration((e=this.input)==null?void 0:e.isReadonly()),renderValidationDecorations:"on"}}createEditor(e){this.editorContainer=e,this.createEditorControl(e,this.computeConfiguration(this.textResourceConfigurationService.getValue(this.getActiveResource()))),this.registerCodeEditorListeners()}registerCodeEditorListeners(){const e=this.getMainControl();e&&(this._register(e.onDidChangeModelLanguage(()=>this.updateEditorConfiguration())),this._register(e.onDidChangeModel(()=>this.updateEditorConfiguration())),this._register(e.onDidChangeCursorPosition(t=>this._onDidChangeSelection.fire({reason:this.toEditorPaneSelectionChangeReason(t)}))),this._register(e.onDidChangeModelContent(()=>this._onDidChangeSelection.fire({reason:3}))))}toEditorPaneSelectionChangeReason(e){switch(e.source){case"api":return 1;case"code.navigation":return 4;case"code.jump":return 5;default:return 2}}getSelection(){const e=this.getMainControl();if(e){const t=e.getSelection();if(t)return new hw(t)}}async setInput(e,t,i,n){await super.setInput(e,t,i,n),this.inputListener.value=e.onDidChangeCapabilities(()=>this.onDidChangeInputCapabilities(e)),this.updateEditorConfiguration(),Mi(this.editorContainer).setAttribute("aria-label",this.computeAriaLabel())}clearInput(){this.inputListener.clear(),super.clearInput()}setEditorVisible(e,t){e&&this.consumePendingConfigurationChangeEvent(),super.setEditorVisible(e,t)}toEditorViewStateResource(e){return e.resource}updateEditorConfiguration(e=this.getActiveResource()){let t;if(e&&(t=this.textResourceConfigurationService.getValue(e)),!t)return;const i=this.computeConfiguration(t);let n=i;this.lastAppliedEditorOptions&&(n=Kq(this.lastAppliedEditorOptions,n)),Object.keys(n).length>0&&(this.lastAppliedEditorOptions=i,this.updateEditorControlOptions(n))}getActiveResource(){const e=this.getMainControl();if(e){const t=e.getModel();if(t)return t.uri}if(this.input)return this.input.resource}dispose(){this.lastAppliedEditorOptions=void 0,super.dispose()}};km.VIEW_STATE_PREFERENCE_KEY="textEditorViewState";km=T([v(1,gi),v(2,Te),v(3,ri),v(4,Do),v(5,Fi),v(6,Ke),v(7,it),v(8,at)],km);class hw{constructor(e){this.textSelection=e}compare(e){if(!(e instanceof hw))return 3;const t=Math.min(this.textSelection.selectionStartLineNumber,this.textSelection.positionLineNumber),i=Math.min(e.textSelection.selectionStartLineNumber,e.textSelection.positionLineNumber);return t===i?1:Math.abs(t-i)<hw.TEXT_EDITOR_SELECTION_THRESHOLD?2:3}restore(e){return{...e,selection:this.textSelection,selectionRevealType:1}}log(){return`line: ${this.textSelection.startLineNumber}-${this.textSelection.endLineNumber}, col:  ${this.textSelection.startColumn}-${this.textSelection.endColumn}`}}hw.TEXT_EDITOR_SELECTION_THRESHOLD=10;let fF=class{};class Hge{static[Symbol.hasInstance](e){return fF!=null&&e instanceof fF}}function jge(r){fF=r}jge(km);class Bge extends km{constructor(){super(...arguments),this.editorControl=void 0}get scopedContextKeyService(){var e;return(e=this.editorControl)==null?void 0:e.invokeWithinContext(t=>t.get(It))}getTitle(){return this.input?this.input.getName():p("textEditor","Text Editor")}createEditorControl(e,t){this.editorControl=this._register(this.instantiationService.createInstance(QN,e,t,this.getCodeEditorWidgetOptions()))}getCodeEditorWidgetOptions(){return Object.create(null)}updateEditorControlOptions(e){var t;(t=this.editorControl)==null||t.updateOptions(e)}getMainControl(){return this.editorControl}getControl(){return this.editorControl}computeEditorViewState(e){if(!this.editorControl)return;const t=this.editorControl.getModel();if(!t)return;const i=t.uri;if(i&&si(i,e))return ii(this.editorControl.saveViewState())}setOptions(e){super.setOptions(e),e&&Bx(e,Mi(this.editorControl),0)}focus(){var e;(e=this.editorControl)==null||e.focus()}hasFocus(){var e;return((e=this.editorControl)==null?void 0:e.hasTextFocus())||super.hasFocus()}setEditorVisible(e,t){var i,n;super.setEditorVisible(e,t),e?(i=this.editorControl)==null||i.onVisible():(n=this.editorControl)==null||n.onHide()}layout(e){var t;(t=this.editorControl)==null||t.layout(e)}}let fw=class extends Bge{constructor(e,t,i,n,s,o,a,c,d){super(e,t,i,n,s,o,c,a,d)}async setInput(e,t,i,n){await super.setInput(e,t,i,n);const s=await e.resolve(t);if(n.isCancellationRequested)return;if(!(s instanceof Ec))throw new Error("Unable to open file as text");const o=Mi(this.editorControl),a=s.textEditorModel;if(o.setModel(a),!LT(t==null?void 0:t.viewState)){const c=this.loadEditorViewState(e,i);c&&(t!=null&&t.selection&&(c.cursorState=[]),o.restoreViewState(c))}t&&Bx(t,o,1),o.updateOptions(this.getReadonlyConfiguration(s.isReadonly()))}revealLastLine(){const e=this.editorControl;if(!e)return;const t=e.getModel();if(t){const i=t.getLineCount();e.revealPosition({lineNumber:i,column:t.getLineMaxColumn(i)},0)}}clearInput(){var e;super.clearInput(),(e=this.editorControl)==null||e.setModel(null)}tracksEditorViewState(e){return e instanceof lu||e instanceof du}};fw=T([v(1,gi),v(2,Te),v(3,ri),v(4,Do),v(5,Fi),v(6,it),v(7,Ke),v(8,at)],fw);let pF=class u8 extends fw{constructor(e,t,i,n,s,o,a,c,d,l){super(u8.ID,e,t,i,n,s,a,o,l),this.modelService=c,this.languageService=d}createEditorControl(e,t){super.createEditorControl(e,t);const i=this.editorControl;i&&this._register(i.onDidPaste(n=>this.onDidEditorPaste(n,i)))}onDidEditorPaste(e,t){if(this.input instanceof lu&&this.input.model.hasLanguageSetExplicitly||e.range.startLineNumber!==1||e.range.startColumn!==1||t.getOption(88))return;const i=t.getModel();if(!i||!(i.getLineCount()===e.range.endLineNumber&&i.getLineMaxColumn(e.range.endLineNumber)===e.range.endColumn)||i.getLanguageId()!==fo)return;let o;if(e.languageId)o={id:e.languageId,source:"event"};else{const a=ii(this.languageService.guessLanguageIdByFilepathOrFirstLine(i.uri,i.getLineContent(1).substr(0,1e3)));a&&(o={id:a,source:"guess"})}if(o&&o.id!==fo){this.input instanceof lu&&o.source==="event"?this.input.model.setLanguageId(o.id):i.setLanguage(this.languageService.createById(o.id));const a=this.modelService.getCreationOptions(i.getLanguageId(),i.uri,i.isForSimpleWidget);i.detectIndentation(a.insertSpaces,a.tabSize)}}};pF.ID="workbench.editors.textResourceEditor";pF=T([v(0,gi),v(1,Te),v(2,ri),v(3,Do),v(4,Fi),v(5,Ke),v(6,it),v(7,_i),v(8,ji),v(9,at)],pF);var CU=[],Lv=[];function Ic(r,e){if(r&&typeof document<"u"){var t,i=e.prepend===!0?"prepend":"append",n=e.singleTag===!0,s=typeof e.container=="string"?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(n){var o=CU.indexOf(s);o===-1&&(o=CU.push(s)-1,Lv[o]={}),t=Lv[o]&&Lv[o][i]?Lv[o][i]:Lv[o][i]=a()}else t=a();r.charCodeAt(0)===65279&&(r=r.substring(1)),t.styleSheet?t.styleSheet.cssText+=r:t.appendChild(document.createTextNode(r))}function a(){var c=document.createElement("style");if(c.setAttribute("type","text/css"),e.attributes)for(var d=Object.keys(e.attributes),l=0;l<d.length;l++)c.setAttribute(d[l],e.attributes[d[l]]);var u=i==="prepend"?"afterbegin":"beforeend";return s.insertAdjacentElement(u,c),c}}var Uge=".monaco-pane-view .split-view-view:first-of-type>.pane>.pane-header{border-top:none!important}.monaco-pane-view .split-view-view:first-of-type>.pane{border-left:none!important}.monaco-pane-view .pane>.pane-header{position:relative}.monaco-pane-view .pane>.pane-header>.actions.show{display:initial}.monaco-pane-view .pane>.pane-header>.icon{display:none;height:16px;width:16px}.monaco-pane-view .pane.pane.horizontal:not(.expanded)>.pane-header>.icon{display:inline;margin-top:4px}.monaco-pane-view .pane>.pane-header h3.title{-webkit-margin-before:0;-webkit-margin-after:0;font-size:11px;min-width:3ch;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.monaco-pane-view .pane>.pane-header .description{display:block;flex-shrink:100000;font-weight:400;margin-left:10px;opacity:.6;overflow:hidden;text-overflow:ellipsis;text-transform:none;white-space:nowrap}.monaco-pane-view .pane>.pane-header .description .codicon{font-size:9px;margin-left:2px}.monaco-pane-view .pane.horizontal:not(.expanded)>.pane-header .description,.monaco-pane-view .pane.horizontal:not(.expanded)>.pane-header h3.title,.monaco-pane-view .pane>.pane-header:not(.expanded) .description{display:none}.monaco-pane-view .pane .monaco-progress-container{height:2px;left:0;position:absolute;top:-2px;z-index:5}.monaco-pane-view .pane:not(.merged-header) .monaco-progress-container{top:20px}";Ic(Uge,{});function ILe(r){switch(r.type){case pS.LIGHT:return Ue.fromHex("#F3F3F3");case pS.HIGH_CONTRAST_LIGHT:return Ue.fromHex("#FFFFFF");case pS.HIGH_CONTRAST_DARK:return Ue.fromHex("#000000");default:return Ue.fromHex("#252526")}}const tS=ee("tab.activeBackground",{dark:jn,light:jn,hcDark:jn,hcLight:jn},p("tabActiveBackground","Active tab background color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),RLe=ee("tab.unfocusedActiveBackground",{dark:tS,light:tS,hcDark:tS,hcLight:tS},p("tabUnfocusedActiveBackground","Active tab background color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),iS=ee("tab.inactiveBackground",{dark:"#2D2D2D",light:"#ECECEC",hcDark:null,hcLight:null},p("tabInactiveBackground","Inactive tab background color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),PLe=ee("tab.unfocusedInactiveBackground",{dark:iS,light:iS,hcDark:iS,hcLight:iS},p("tabUnfocusedInactiveBackground","Inactive tab background color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),Vx=ee("tab.activeForeground",{dark:Ue.white,light:"#333333",hcDark:Ue.white,hcLight:"#292929"},p("tabActiveForeground","Active tab foreground color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),EU=ee("tab.inactiveForeground",{dark:Xe(Vx,.5),light:Xe(Vx,.7),hcDark:Ue.white,hcLight:"#292929"},p("tabInactiveForeground","Inactive tab foreground color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),ALe=ee("tab.unfocusedActiveForeground",{dark:Xe(Vx,.5),light:Xe(Vx,.7),hcDark:Ue.white,hcLight:"#292929"},p("tabUnfocusedActiveForeground","Active tab foreground color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),MLe=ee("tab.unfocusedInactiveForeground",{dark:Xe(EU,.5),light:Xe(EU,.5),hcDark:Ue.white,hcLight:"#292929"},p("tabUnfocusedInactiveForeground","Inactive tab foreground color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),xU=ee("tab.hoverBackground",{dark:null,light:null,hcDark:null,hcLight:null},p("tabHoverBackground","Tab background color when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),LLe=ee("tab.unfocusedHoverBackground",{dark:Xe(xU,.5),light:Xe(xU,.7),hcDark:null,hcLight:null},p("tabUnfocusedHoverBackground","Tab background color in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),DU=ee("tab.hoverForeground",{dark:null,light:null,hcDark:null,hcLight:null},p("tabHoverForeground","Tab foreground color when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),FLe=ee("tab.unfocusedHoverForeground",{dark:Xe(DU,.5),light:Xe(DU,.5),hcDark:null,hcLight:null},p("tabUnfocusedHoverForeground","Tab foreground color in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),OLe=ee("tab.border",{dark:"#252526",light:"#F3F3F3",hcDark:yt,hcLight:yt},p("tabBorder","Border to separate tabs from each other. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),NLe=ee("tab.lastPinnedBorder",{dark:SH,light:SH,hcDark:yt,hcLight:yt},p("lastPinnedTabBorder","Border to separate pinned tabs from other tabs. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),Qp=ee("tab.activeBorder",{dark:null,light:null,hcDark:null,hcLight:null},p("tabActiveBorder","Border on the bottom of an active tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),$Le=ee("tab.unfocusedActiveBorder",{dark:Xe(Qp,.5),light:Xe(Qp,.7),hcDark:null,hcLight:null},p("tabActiveUnfocusedBorder","Border on the bottom of an active tab in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),kU=ee("tab.activeBorderTop",{dark:null,light:null,hcDark:null,hcLight:"#B5200D"},p("tabActiveBorderTop","Border to the top of an active tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),WLe=ee("tab.unfocusedActiveBorderTop",{dark:Xe(kU,.5),light:Xe(kU,.7),hcDark:null,hcLight:"#B5200D"},p("tabActiveUnfocusedBorderTop","Border to the top of an active tab in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),TU=ee("tab.hoverBorder",{dark:null,light:null,hcDark:null,hcLight:null},p("tabHoverBorder","Border to highlight tabs when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),HLe=ee("tab.unfocusedHoverBorder",{dark:Xe(TU,.5),light:Xe(TU,.7),hcDark:null,hcLight:yt},p("tabUnfocusedHoverBorder","Border to highlight tabs in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),qx=ee("tab.activeModifiedBorder",{dark:"#3399CC",light:"#33AAEE",hcDark:null,hcLight:yt},p("tabActiveModifiedBorder","Border on the top of modified active tabs in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),IU=ee("tab.inactiveModifiedBorder",{dark:Xe(qx,.5),light:Xe(qx,.5),hcDark:Ue.white,hcLight:yt},p("tabInactiveModifiedBorder","Border on the top of modified inactive tabs in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),jLe=ee("tab.unfocusedActiveModifiedBorder",{dark:Xe(qx,.5),light:Xe(qx,.7),hcDark:Ue.white,hcLight:yt},p("unfocusedActiveModifiedBorder","Border on the top of modified active tabs in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),BLe=ee("tab.unfocusedInactiveModifiedBorder",{dark:Xe(IU,.5),light:Xe(IU,.5),hcDark:Ue.white,hcLight:yt},p("unfocusedINactiveModifiedBorder","Border on the top of modified inactive tabs in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),ULe=ee("editorPane.background",{dark:jn,light:jn,hcDark:jn,hcLight:jn},p("editorPaneBackground","Background color of the editor pane visible on the left and right side of the centered editor layout.")),VLe=ee("editorGroup.emptyBackground",{dark:null,light:null,hcDark:null,hcLight:null},p("editorGroupEmptyBackground","Background color of an empty editor group. Editor groups are the containers of editors."));ee("editorGroup.focusedEmptyBorder",{dark:null,light:null,hcDark:hl,hcLight:hl},p("editorGroupFocusedEmptyBorder","Border color of an empty editor group that is focused. Editor groups are the containers of editors."));const qLe=ee("editorGroupHeader.tabsBackground",{dark:"#252526",light:"#F3F3F3",hcDark:null,hcLight:null},p("tabsContainerBackground","Background color of the editor group title header when tabs are enabled. Editor groups are the containers of editors.")),GLe=ee("editorGroupHeader.tabsBorder",{dark:null,light:null,hcDark:null,hcLight:null},p("tabsContainerBorder","Border color of the editor group title header when tabs are enabled. Editor groups are the containers of editors.")),zLe=ee("editorGroupHeader.noTabsBackground",{dark:jn,light:jn,hcDark:jn,hcLight:jn},p("editorGroupHeaderBackground",'Background color of the editor group title header when tabs are disabled (`"workbench.editor.showTabs": false`). Editor groups are the containers of editors.')),KLe=ee("editorGroupHeader.border",{dark:null,light:null,hcDark:yt,hcLight:yt},p("editorTitleContainerBorder","Border color of the editor group title header. Editor groups are the containers of editors.")),Dl=ee("editorGroup.border",{dark:"#444444",light:"#E7E7E7",hcDark:yt,hcLight:yt},p("editorGroupBorder","Color to separate multiple editor groups from each other. Editor groups are the containers of editors.")),Vo=ee("editorGroup.dropBackground",{dark:Ue.fromHex("#53595D").transparent(.5),light:Ue.fromHex("#2677CB").transparent(.18),hcDark:null,hcLight:Ue.fromHex("#0F4A85").transparent(.5)},p("editorDragAndDropBackground","Background color when dragging editors around. The color should have transparency so that the editor contents can still shine through.")),QLe=ee("editorGroup.dropIntoPromptForeground",{dark:fl,light:fl,hcDark:fl,hcLight:fl},p("editorDropIntoPromptForeground","Foreground color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),YLe=ee("editorGroup.dropIntoPromptBackground",{dark:jo,light:jo,hcDark:jo,hcLight:jo},p("editorDropIntoPromptBackground","Background color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),XLe=ee("editorGroup.dropIntoPromptBorder",{dark:null,light:null,hcDark:yt,hcLight:yt},p("editorDropIntoPromptBorder","Border color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),Vge=ee("sideBySideEditor.horizontalBorder",{dark:Dl,light:Dl,hcDark:Dl,hcLight:Dl},p("sideBySideEditor.horizontalBorder","Color to separate two editors from each other when shown side by side in an editor group from top to bottom.")),qge=ee("sideBySideEditor.verticalBorder",{dark:Dl,light:Dl,hcDark:Dl,hcLight:Dl},p("sideBySideEditor.verticalBorder","Color to separate two editors from each other when shown side by side in an editor group from left to right.")),Gge=ee("panel.background",{dark:jn,light:jn,hcDark:jn,hcLight:jn},p("panelBackground","Panel background color. Panels are shown below the editor area and contain views like output and integrated terminal.")),nd=ee("panel.border",{dark:Ue.fromHex("#808080").transparent(.35),light:Ue.fromHex("#808080").transparent(.35),hcDark:yt,hcLight:yt},p("panelBorder","Panel border color to separate the panel from the editor. Panels are shown below the editor area and contain views like output and integrated terminal.")),kl=ee("panelTitle.activeForeground",{dark:"#E7E7E7",light:"#424242",hcDark:Ue.white,hcLight:yd},p("panelActiveTitleForeground","Title color for the active panel. Panels are shown below the editor area and contain views like output and integrated terminal.")),JLe=ee("panelTitle.inactiveForeground",{dark:Xe(kl,.6),light:Xe(kl,.75),hcDark:Ue.white,hcLight:yd},p("panelInactiveTitleForeground","Title color for the inactive panel. Panels are shown below the editor area and contain views like output and integrated terminal.")),ZLe=ee("panelTitle.activeBorder",{dark:kl,light:kl,hcDark:yt,hcLight:"#B5200D"},p("panelActiveTitleBorder","Border color for the active panel title. Panels are shown below the editor area and contain views like output and integrated terminal."));ee("panelInput.border",{dark:NI,light:Ue.fromHex("#ddd"),hcDark:NI,hcLight:NI},p("panelInputBorder","Input box border for inputs in the panel."));const eFe=ee("panel.dropBorder",{dark:kl,light:kl,hcDark:kl,hcLight:kl},p("panelDragAndDropBorder","Drag and drop feedback color for the panel titles. Panels are shown below the editor area and contain views like output and integrated terminal.")),h8=ee("panelSection.dropBackground",{dark:Vo,light:Vo,hcDark:Vo,hcLight:Vo},p("panelSectionDragAndDropBackground","Drag and drop feedback color for the panel sections. The color should have transparency so that the panel sections can still shine through. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),zge=ee("panelSectionHeader.background",{dark:Ue.fromHex("#808080").transparent(.2),light:Ue.fromHex("#808080").transparent(.2),hcDark:null,hcLight:null},p("panelSectionHeaderBackground","Panel section header background color. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Kge=ee("panelSectionHeader.foreground",{dark:null,light:null,hcDark:null,hcLight:null},p("panelSectionHeaderForeground","Panel section header foreground color. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Qge=ee("panelSectionHeader.border",{dark:yt,light:yt,hcDark:yt,hcLight:yt},p("panelSectionHeaderBorder","Panel section header border color used when multiple views are stacked vertically in the panel. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Yge=ee("panelSection.border",{dark:nd,light:nd,hcDark:nd,hcLight:nd},p("panelSectionBorder","Panel section border color used when multiple views are stacked horizontally in the panel. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels."));ee("banner.background",{dark:Ab,light:rf(Ab,.3),hcDark:Ab,hcLight:Ab},p("banner.background","Banner background color. The banner is shown under the title bar of the window."));ee("banner.foreground",{dark:Mb,light:Mb,hcDark:Mb,hcLight:Mb},p("banner.foreground","Banner foreground color. The banner is shown under the title bar of the window."));ee("banner.iconForeground",{dark:pl,light:pl,hcDark:pl,hcLight:pl},p("banner.iconForeground","Banner icon color. The banner is shown under the title bar of the window."));const ho=ee("statusBar.foreground",{dark:"#FFFFFF",light:"#FFFFFF",hcDark:"#FFFFFF",hcLight:yd},p("statusBarForeground","Status bar foreground color when a workspace or folder is opened. The status bar is shown in the bottom of the window.")),tFe=ee("statusBar.noFolderForeground",{dark:ho,light:ho,hcDark:ho,hcLight:ho},p("statusBarNoFolderForeground","Status bar foreground color when no folder is opened. The status bar is shown in the bottom of the window.")),iFe=ee("statusBar.background",{dark:"#007ACC",light:"#007ACC",hcDark:null,hcLight:null},p("statusBarBackground","Status bar background color when a workspace or folder is opened. The status bar is shown in the bottom of the window.")),nFe=ee("statusBar.noFolderBackground",{dark:"#68217A",light:"#68217A",hcDark:null,hcLight:null},p("statusBarNoFolderBackground","Status bar background color when no folder is opened. The status bar is shown in the bottom of the window.")),nS=ee("statusBar.border",{dark:null,light:null,hcDark:yt,hcLight:yt},p("statusBarBorder","Status bar border color separating to the sidebar and editor. The status bar is shown in the bottom of the window.")),rFe=ee("statusBar.focusBorder",{dark:ho,light:ho,hcDark:null,hcLight:ho},p("statusBarFocusBorder","Status bar border color when focused on keyboard navigation. The status bar is shown in the bottom of the window.")),sFe=ee("statusBar.noFolderBorder",{dark:nS,light:nS,hcDark:nS,hcLight:nS},p("statusBarNoFolderBorder","Status bar border color separating to the sidebar and editor when no folder is opened. The status bar is shown in the bottom of the window."));ee("statusBarItem.activeBackground",{dark:Ue.white.transparent(.18),light:Ue.white.transparent(.18),hcDark:Ue.white.transparent(.18),hcLight:Ue.black.transparent(.18)},p("statusBarItemActiveBackground","Status bar item background color when clicking. The status bar is shown in the bottom of the window."));const oFe=ee("statusBarItem.focusBorder",{dark:ho,light:ho,hcDark:null,hcLight:DC},p("statusBarItemFocusBorder","Status bar item border color when focused on keyboard navigation. The status bar is shown in the bottom of the window.")),aFe=ee("statusBarItem.hoverBackground",{dark:Ue.white.transparent(.12),light:Ue.white.transparent(.12),hcDark:Ue.white.transparent(.12),hcLight:Ue.black.transparent(.12)},p("statusBarItemHoverBackground","Status bar item background color when hovering. The status bar is shown in the bottom of the window.")),cFe=ee("statusBarItem.compactHoverBackground",{dark:Ue.white.transparent(.2),light:Ue.white.transparent(.2),hcDark:Ue.white.transparent(.2),hcLight:Ue.black.transparent(.2)},p("statusBarItemCompactHoverBackground","Status bar item background color when hovering an item that contains two hovers. The status bar is shown in the bottom of the window.")),dFe=ee("statusBarItem.prominentForeground",{dark:ho,light:ho,hcDark:ho,hcLight:ho},p("statusBarProminentItemForeground","Status bar prominent items foreground color. Prominent items stand out from other status bar entries to indicate importance. Change mode `Toggle Tab Key Moves Focus` from command palette to see an example. The status bar is shown in the bottom of the window.")),lFe=ee("statusBarItem.prominentBackground",{dark:Ue.black.transparent(.5),light:Ue.black.transparent(.5),hcDark:Ue.black.transparent(.5),hcLight:Ue.black.transparent(.5)},p("statusBarProminentItemBackground","Status bar prominent items background color. Prominent items stand out from other status bar entries to indicate importance. Change mode `Toggle Tab Key Moves Focus` from command palette to see an example. The status bar is shown in the bottom of the window."));ee("statusBarItem.prominentHoverBackground",{dark:Ue.black.transparent(.3),light:Ue.black.transparent(.3),hcDark:Ue.black.transparent(.3),hcLight:null},p("statusBarProminentItemHoverBackground","Status bar prominent items background color when hovering. Prominent items stand out from other status bar entries to indicate importance. Change mode `Toggle Tab Key Moves Focus` from command palette to see an example. The status bar is shown in the bottom of the window."));const uFe=ee("statusBarItem.errorBackground",{dark:rf(CH,.4),light:rf(CH,.4),hcDark:null,hcLight:"#B5200D"},p("statusBarErrorItemBackground","Status bar error items background color. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window.")),hFe=ee("statusBarItem.errorForeground",{dark:Ue.white,light:Ue.white,hcDark:Ue.white,hcLight:Ue.white},p("statusBarErrorItemForeground","Status bar error items foreground color. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window.")),fFe=ee("statusBarItem.warningBackground",{dark:rf(Np,.4),light:rf(Np,.4),hcDark:null,hcLight:"#895503"},p("statusBarWarningItemBackground","Status bar warning items background color. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window.")),pFe=ee("statusBarItem.warningForeground",{dark:Ue.white,light:Ue.white,hcDark:Ue.white,hcLight:Ue.white},p("statusBarWarningItemForeground","Status bar warning items foreground color. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window.")),gFe=ee("activityBar.background",{dark:"#333333",light:"#2C2C2C",hcDark:"#000000",hcLight:"#FFFFFF"},p("activityBarBackground","Activity bar background color. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Tm=ee("activityBar.foreground",{dark:Ue.white,light:Ue.white,hcDark:Ue.white,hcLight:yd},p("activityBarForeground","Activity bar item foreground color when it is active. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),mFe=ee("activityBar.inactiveForeground",{dark:Xe(Tm,.4),light:Xe(Tm,.4),hcDark:Ue.white,hcLight:yd},p("activityBarInActiveForeground","Activity bar item foreground color when it is inactive. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),vFe=ee("activityBar.border",{dark:null,light:null,hcDark:yt,hcLight:yt},p("activityBarBorder","Activity bar border color separating to the side bar. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),yFe=ee("activityBar.activeBorder",{dark:Tm,light:Tm,hcDark:null,hcLight:yt},p("activityBarActiveBorder","Activity bar border color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),_Fe=ee("activityBar.activeFocusBorder",{dark:null,light:null,hcDark:null,hcLight:"#B5200D"},p("activityBarActiveFocusBorder","Activity bar focus border color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),wFe=ee("activityBar.activeBackground",{dark:null,light:null,hcDark:null,hcLight:null},p("activityBarActiveBackground","Activity bar background color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),bFe=ee("activityBar.dropBorder",{dark:Tm,light:Tm,hcDark:null,hcLight:null},p("activityBarDragAndDropBorder","Drag and drop feedback color for the activity bar items. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Tl=ee("activityBarBadge.background",{dark:"#007ACC",light:"#007ACC",hcDark:"#000000",hcLight:"#0F4A85"},p("activityBarBadgeBackground","Activity notification badge background color. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Il=ee("activityBarBadge.foreground",{dark:Ue.white,light:Ue.white,hcDark:Ue.white,hcLight:Ue.white},p("activityBarBadgeForeground","Activity notification badge foreground color. The activity bar is showing on the far left or right and allows to switch between views of the side bar."));ee("profileBadge.background",{dark:"#4D4D4D",light:"#C4C4C4",hcDark:Ue.white,hcLight:Ue.black},p("profileBadgeBackground","Profile badge background color. The profile badge shows on top of the settings gear icon in the activity bar."));ee("profileBadge.foreground",{dark:Ue.white,light:"#333333",hcDark:Ue.black,hcLight:Ue.white},p("profileBadgeForeground","Profile badge foreground color. The profile badge shows on top of the settings gear icon in the activity bar."));ee("statusBarItem.remoteBackground",{dark:Tl,light:Tl,hcDark:Tl,hcLight:Tl},p("statusBarItemHostBackground","Background color for the remote indicator on the status bar."));ee("statusBarItem.remoteForeground",{dark:Il,light:Il,hcDark:Il,hcLight:Il},p("statusBarItemHostForeground","Foreground color for the remote indicator on the status bar."));ee("extensionBadge.remoteBackground",{dark:Tl,light:Tl,hcDark:Tl,hcLight:Tl},p("extensionBadge.remoteBackground","Background color for the remote badge in the extensions view."));ee("extensionBadge.remoteForeground",{dark:Il,light:Il,hcDark:Il,hcLight:Il},p("extensionBadge.remoteForeground","Foreground color for the remote badge in the extensions view."));const Gx=ee("sideBar.background",{dark:"#252526",light:"#F3F3F3",hcDark:"#000000",hcLight:"#FFFFFF"},p("sideBarBackground","Side bar background color. The side bar is the container for views like explorer and search.")),Rl=ee("sideBar.foreground",{dark:null,light:null,hcDark:null,hcLight:null},p("sideBarForeground","Side bar foreground color. The side bar is the container for views like explorer and search.")),SFe=ee("sideBar.border",{dark:null,light:null,hcDark:yt,hcLight:yt},p("sideBarBorder","Side bar border color on the side separating to the editor. The side bar is the container for views like explorer and search.")),CFe=ee("sideBarTitle.foreground",{dark:Rl,light:Rl,hcDark:Rl,hcLight:Rl},p("sideBarTitleForeground","Side bar title foreground color. The side bar is the container for views like explorer and search.")),f8=ee("sideBar.dropBackground",{dark:Vo,light:Vo,hcDark:Vo,hcLight:Vo},p("sideBarDragAndDropBackground","Drag and drop feedback color for the side bar sections. The color should have transparency so that the side bar sections can still shine through. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),Xge=ee("sideBarSectionHeader.background",{dark:Ue.fromHex("#808080").transparent(.2),light:Ue.fromHex("#808080").transparent(.2),hcDark:null,hcLight:null},p("sideBarSectionHeaderBackground","Side bar section header background color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),Jge=ee("sideBarSectionHeader.foreground",{dark:Rl,light:Rl,hcDark:Rl,hcLight:Rl},p("sideBarSectionHeaderForeground","Side bar section header foreground color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),Zge=ee("sideBarSectionHeader.border",{dark:yt,light:yt,hcDark:yt,hcLight:yt},p("sideBarSectionHeaderBorder","Side bar section header border color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),Yp=ee("titleBar.activeForeground",{dark:"#CCCCCC",light:"#333333",hcDark:"#FFFFFF",hcLight:"#292929"},p("titleBarActiveForeground","Title bar foreground when the window is active."));ee("titleBar.inactiveForeground",{dark:Xe(Yp,.6),light:Xe(Yp,.6),hcDark:null,hcLight:"#292929"},p("titleBarInactiveForeground","Title bar foreground when the window is inactive."));const RU=ee("titleBar.activeBackground",{dark:"#3C3C3C",light:"#DDDDDD",hcDark:"#000000",hcLight:"#FFFFFF"},p("titleBarActiveBackground","Title bar background when the window is active."));ee("titleBar.inactiveBackground",{dark:Xe(RU,.6),light:Xe(RU,.6),hcDark:null,hcLight:null},p("titleBarInactiveBackground","Title bar background when the window is inactive."));ee("titleBar.border",{dark:null,light:null,hcDark:yt,hcLight:yt},p("titleBarBorder","Title bar border color."));ee("menubar.selectionForeground",{dark:Yp,light:Yp,hcDark:Yp,hcLight:Yp},p("menubarSelectionForeground","Foreground color of the selected menu item in the menubar."));ee("menubar.selectionBackground",{dark:EH,light:EH,hcDark:null,hcLight:null},p("menubarSelectionBackground","Background color of the selected menu item in the menubar."));ee("menubar.selectionBorder",{dark:null,light:null,hcDark:DC,hcLight:DC},p("menubarSelectionBorder","Border color of the selected menu item in the menubar."));const EFe=ee("notificationCenter.border",{dark:kC,light:kC,hcDark:yt,hcLight:yt},p("notificationCenterBorder","Notifications center border color. Notifications slide in from the bottom right of the window.")),xFe=ee("notificationToast.border",{dark:kC,light:kC,hcDark:yt,hcLight:yt},p("notificationToastBorder","Notification toast border color. Notifications slide in from the bottom right of the window."));ee("notifications.foreground",{dark:fl,light:fl,hcDark:fl,hcLight:fl},p("notificationsForeground","Notifications foreground color. Notifications slide in from the bottom right of the window."));const rS=ee("notifications.background",{dark:jo,light:jo,hcDark:jo,hcLight:jo},p("notificationsBackground","Notifications background color. Notifications slide in from the bottom right of the window."));ee("notificationLink.foreground",{dark:$p,light:$p,hcDark:$p,hcLight:$p},p("notificationsLink","Notification links foreground color. Notifications slide in from the bottom right of the window."));const DFe=ee("notificationCenterHeader.foreground",{dark:null,light:null,hcDark:null,hcLight:null},p("notificationCenterHeaderForeground","Notifications center header foreground color. Notifications slide in from the bottom right of the window.")),sS=ee("notificationCenterHeader.background",{dark:u7(rS,.3),light:rf(rS,.05),hcDark:rS,hcLight:rS},p("notificationCenterHeaderBackground","Notifications center header background color. Notifications slide in from the bottom right of the window."));ee("notifications.border",{dark:sS,light:sS,hcDark:sS,hcLight:sS},p("notificationsBorder","Notifications border color separating from other notifications in the notifications center. Notifications slide in from the bottom right of the window."));ee("notificationsErrorIcon.foreground",{dark:gl,light:gl,hcDark:gl,hcLight:gl},p("notificationsErrorIconForeground","The color used for the icon of error notifications. Notifications slide in from the bottom right of the window."));ee("notificationsWarningIcon.foreground",{dark:Np,light:Np,hcDark:Np,hcLight:Np},p("notificationsWarningIconForeground","The color used for the icon of warning notifications. Notifications slide in from the bottom right of the window."));ee("notificationsInfoIcon.foreground",{dark:pl,light:pl,hcDark:pl,hcLight:pl},p("notificationsInfoIconForeground","The color used for the icon of info notifications. Notifications slide in from the bottom right of the window."));ee("window.activeBorder",{dark:null,light:null,hcDark:yt,hcLight:yt},p("windowActiveBorder","The color used for the border of the window when it is active. Only supported in the macOS and Linux desktop client when using the custom title bar."));ee("window.inactiveBorder",{dark:null,light:null,hcDark:yt,hcLight:yt},p("windowInactiveBorder","The color used for the border of the window when it is inactive. Only supported in the macOS and Linux desktop client when using the custom title bar."));var eme=".monaco-pane-view{height:100%;width:100%}.monaco-pane-view .pane{display:flex;flex-direction:column;height:100%;overflow:hidden;width:100%}.monaco-pane-view .pane.horizontal:not(.expanded){flex-direction:row}.monaco-pane-view .pane>.pane-header{align-items:center;box-sizing:border-box;cursor:pointer;display:flex;font-size:11px;font-weight:700;height:22px;overflow:hidden}.monaco-pane-view .pane>.pane-header>.title{text-transform:uppercase}.monaco-pane-view .pane.horizontal:not(.expanded)>.pane-header{flex-direction:column;height:100%;width:22px}.monaco-pane-view .pane>.pane-header>.codicon:first-of-type{margin:0 2px}.monaco-pane-view .pane.horizontal:not(.expanded)>.pane-header>.codicon:first-of-type{margin:2px}.monaco-pane-view .pane>.pane-header>.actions{display:none;margin-left:auto}.monaco-pane-view .pane>.pane-header>.actions .action-item{margin-right:4px}.monaco-pane-view .pane>.pane-header>.actions .action-label{padding:2px}.monaco-pane-view .pane:focus-within>.pane-header.expanded>.actions,.monaco-pane-view .pane:hover>.pane-header.expanded>.actions,.monaco-pane-view .pane>.pane-header.actions-always-visible.expanded>.actions,.monaco-pane-view .pane>.pane-header.focused.expanded>.actions{display:initial}.monaco-pane-view .pane>.pane-header .monaco-action-bar .action-item.select-container{cursor:default}.monaco-pane-view .pane>.pane-header .action-item .monaco-select-box{cursor:pointer;min-height:18px;min-width:110px;padding:2px 23px 2px 8px}.linux .monaco-pane-view .pane>.pane-header .action-item .monaco-select-box,.windows .monaco-pane-view .pane>.pane-header .action-item .monaco-select-box{padding:0 23px 0 8px}.monaco-pane-view:lang(ja) .pane>.pane-header,.monaco-pane-view:lang(ko) .pane>.pane-header,.monaco-pane-view:lang(zh-Hans) .pane>.pane-header,.monaco-pane-view:lang(zh-Hant) .pane>.pane-header{font-weight:400}.monaco-pane-view .pane>.pane-header.hidden{display:none}.monaco-pane-view .pane>.pane-body{flex:1;overflow:hidden}.monaco-pane-view.animated .split-view-view{transition-duration:.15s;transition-timing-function:ease-out}.reduce-motion .monaco-pane-view .split-view-view{transition-duration:0s!important}.monaco-pane-view.animated.vertical .split-view-view{transition-property:height}.monaco-pane-view.animated.horizontal .split-view-view{transition-property:width}#monaco-pane-drop-overlay{box-sizing:border-box;height:100%;left:0;position:absolute;width:100%;z-index:10000}#monaco-pane-drop-overlay>.pane-overlay-indicator{height:100%;min-height:22px;min-width:19px;pointer-events:none;position:absolute;transition:opacity .15s ease-out;width:100%}#monaco-pane-drop-overlay>.pane-overlay-indicator.overlay-move-transition{transition:top 70ms ease-out,left 70ms ease-out,width 70ms ease-out,height 70ms ease-out,opacity .15s ease-out}";Ic(eme,{});class pw extends ne{get ariaHeaderLabel(){return this._ariaHeaderLabel}set ariaHeaderLabel(e){this._ariaHeaderLabel=e,this.header.setAttribute("aria-label",this.ariaHeaderLabel)}get draggableElement(){return this.header}get dropTargetElement(){return this.element}get dropBackground(){return this.styles.dropBackground}get minimumBodySize(){return this._minimumBodySize}set minimumBodySize(e){this._minimumBodySize=e,this._onDidChange.fire(void 0)}get maximumBodySize(){return this._maximumBodySize}set maximumBodySize(e){this._maximumBodySize=e,this._onDidChange.fire(void 0)}get headerSize(){return this.headerVisible?pw.HEADER_SIZE:0}get minimumSize(){const e=this.headerSize,i=!this.headerVisible||this.isExpanded()?this.minimumBodySize:0;return e+i}get maximumSize(){const e=this.headerSize,i=!this.headerVisible||this.isExpanded()?this.maximumBodySize:0;return e+i}constructor(e){super(),this.expandedSize=void 0,this._headerVisible=!0,this._bodyRendered=!1,this.styles={dropBackground:void 0,headerBackground:void 0,headerBorder:void 0,headerForeground:void 0,leftBorder:void 0},this.animationTimer=void 0,this._onDidChange=this._register(new A),this.onDidChange=this._onDidChange.event,this._onDidChangeExpansionState=this._register(new A),this.onDidChangeExpansionState=this._onDidChangeExpansionState.event,this.orthogonalSize=0,this._expanded=typeof e.expanded>"u"?!0:!!e.expanded,this._orientation=typeof e.orientation>"u"?0:e.orientation,this._ariaHeaderLabel=p("viewSection","{0} Section",e.title),this._minimumBodySize=typeof e.minimumBodySize=="number"?e.minimumBodySize:this._orientation===1?200:120,this._maximumBodySize=typeof e.maximumBodySize=="number"?e.maximumBodySize:Number.POSITIVE_INFINITY,this.element=Ve(".pane")}isExpanded(){return this._expanded}setExpanded(e){var t;return this._expanded===!!e?!1:((t=this.element)==null||t.classList.toggle("expanded",e),this._expanded=!!e,this.updateHeader(),e?(this._bodyRendered||(this.renderBody(this.body),this._bodyRendered=!0),typeof this.animationTimer=="number"&&clearTimeout(this.animationTimer),Fe(this.element,this.body)):this.animationTimer=window.setTimeout(()=>{this.body.remove()},200),this._onDidChangeExpansionState.fire(e),this._onDidChange.fire(e?this.expandedSize:void 0),!0)}get headerVisible(){return this._headerVisible}set headerVisible(e){this._headerVisible!==!!e&&(this._headerVisible=!!e,this.updateHeader(),this._onDidChange.fire(void 0))}get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._orientation=e,this.element&&(this.element.classList.toggle("horizontal",this.orientation===1),this.element.classList.toggle("vertical",this.orientation===0)),this.header&&this.updateHeader())}render(){this.element.classList.toggle("expanded",this.isExpanded()),this.element.classList.toggle("horizontal",this.orientation===1),this.element.classList.toggle("vertical",this.orientation===0),this.header=Ve(".pane-header"),Fe(this.element,this.header),this.header.setAttribute("tabindex","0"),this.header.setAttribute("role","button"),this.header.setAttribute("aria-label",this.ariaHeaderLabel),this.renderHeader(this.header);const e=Um(this.header);this._register(e),this._register(e.onDidFocus(()=>this.header.classList.add("focused"),null)),this._register(e.onDidBlur(()=>this.header.classList.remove("focused"),null)),this.updateHeader();const t=this._register(new me),i=this._register(new gk(this.header,"keydown")),n=F.map(i.event,s=>new e_(s),t);this._register(F.filter(n,s=>s.keyCode===3||s.keyCode===10,t)(()=>this.setExpanded(!this.isExpanded()),null)),this._register(F.filter(n,s=>s.keyCode===15,t)(()=>this.setExpanded(!1),null)),this._register(F.filter(n,s=>s.keyCode===17,t)(()=>this.setExpanded(!0),null)),this._register(Qq.addTarget(this.header)),[sn.CLICK,Yq.Tap].forEach(s=>{this._register(Ci(this.header,s,o=>{o.defaultPrevented||this.setExpanded(!this.isExpanded())}))}),this.body=Fe(this.element,Ve(".pane-body")),!this._bodyRendered&&this.isExpanded()&&(this.renderBody(this.body),this._bodyRendered=!0),this.isExpanded()||this.body.remove()}layout(e){const t=this.headerVisible?pw.HEADER_SIZE:0,i=this._orientation===0?this.orthogonalSize:e,n=this._orientation===0?e-t:this.orthogonalSize-t;this.isExpanded()&&(this.body.classList.toggle("wide",i>=600),this.layoutBody(n,i),this.expandedSize=e)}style(e){this.styles=e,this.header&&this.updateHeader()}updateHeader(){const e=!this.headerVisible||this.isExpanded();this.header.style.lineHeight=`${this.headerSize}px`,this.header.classList.toggle("hidden",!this.headerVisible),this.header.classList.toggle("expanded",e),this.header.setAttribute("aria-expanded",String(e)),this.header.style.color=this.styles.headerForeground??"",this.header.style.backgroundColor=this.styles.headerBackground??"",this.header.style.borderTop=this.styles.headerBorder&&this.orientation===0?`1px solid ${this.styles.headerBorder}`:"",this.element.style.borderLeft=this.styles.leftBorder&&this.orientation===1?`1px solid ${this.styles.leftBorder}`:""}}pw.HEADER_SIZE=22;class dI extends ne{constructor(e,t,i){super(),this.pane=e,this.dnd=t,this.context=i,this.dragOverCounter=0,this._onDidDrop=this._register(new A),this.onDidDrop=this._onDidDrop.event,e.draggableElement.draggable=!0,this._register(Ci(e.draggableElement,"dragstart",n=>this.onDragStart(n))),this._register(Ci(e.dropTargetElement,"dragenter",n=>this.onDragEnter(n))),this._register(Ci(e.dropTargetElement,"dragleave",n=>this.onDragLeave(n))),this._register(Ci(e.dropTargetElement,"dragend",n=>this.onDragEnd(n))),this._register(Ci(e.dropTargetElement,"drop",n=>this.onDrop(n)))}onDragStart(e){var i;if(!this.dnd.canDrag(this.pane)||!e.dataTransfer){e.preventDefault(),e.stopPropagation();return}e.dataTransfer.effectAllowed="move",f7&&((i=e.dataTransfer)==null||i.setData(ml.TEXT,this.pane.draggableElement.textContent||""));const t=Fe(document.body,Ve(".monaco-drag-image",{},this.pane.draggableElement.textContent||""));e.dataTransfer.setDragImage(t,-10,-10),setTimeout(()=>document.body.removeChild(t),0),this.context.draggable=this}onDragEnter(e){!this.context.draggable||this.context.draggable===this||this.dnd.canDrop(this.context.draggable.pane,this.pane)&&(this.dragOverCounter++,this.render())}onDragLeave(e){!this.context.draggable||this.context.draggable===this||this.dnd.canDrop(this.context.draggable.pane,this.pane)&&(this.dragOverCounter--,this.dragOverCounter===0&&this.render())}onDragEnd(e){this.context.draggable&&(this.dragOverCounter=0,this.render(),this.context.draggable=null)}onDrop(e){this.context.draggable&&(p7.stop(e),this.dragOverCounter=0,this.render(),this.dnd.canDrop(this.context.draggable.pane,this.pane)&&this.context.draggable!==this&&this._onDidDrop.fire({from:this.context.draggable.pane,to:this.pane}),this.context.draggable=null)}render(){let e=null;this.dragOverCounter>0&&(e=this.pane.dropBackground??dI.DefaultDragOverBackgroundColor.toString()),this.pane.dropTargetElement.style.backgroundColor=e||""}}dI.DefaultDragOverBackgroundColor=new Ue(new h7(128,128,128,.5));class tme extends ne{constructor(e,t={}){super(),this.dndContext={draggable:null},this.paneItems=[],this.orthogonalSize=0,this.size=0,this.animationTimer=void 0,this._onDidDrop=this._register(new A),this.onDidDrop=this._onDidDrop.event,this.dnd=t.dnd,this.orientation=t.orientation??0,this.element=Fe(e,Ve(".monaco-pane-view")),this.splitview=this._register(new LP(this.element,{orientation:this.orientation})),this.onDidSashReset=this.splitview.onDidSashReset,this.onDidSashChange=this.splitview.onDidSashChange,this.onDidScroll=this.splitview.onDidScroll;const i=this._register(new me),n=this._register(new gk(this.element,"keydown")),s=F.map(F.filter(n.event,o=>o.target instanceof HTMLElement&&o.target.classList.contains("pane-header"),i),o=>new e_(o),i);this._register(F.filter(s,o=>o.keyCode===16,i)(()=>this.focusPrevious())),this._register(F.filter(s,o=>o.keyCode===18,i)(()=>this.focusNext()))}addPane(e,t,i=this.splitview.length){const n=new me;e.onDidChangeExpansionState(this.setupAnimation,this,n);const s={pane:e,disposable:n};if(this.paneItems.splice(i,0,s),e.orientation=this.orientation,e.orthogonalSize=this.orthogonalSize,this.splitview.addView(e,t,i),this.dnd){const o=new dI(e,this.dnd,this.dndContext);n.add(o),n.add(o.onDidDrop(this._onDidDrop.fire,this._onDidDrop))}}removePane(e){const t=this.paneItems.findIndex(n=>n.pane===e);if(t===-1)return;this.splitview.removeView(t,e.isExpanded()?FP.Distribute:void 0),this.paneItems.splice(t,1)[0].disposable.dispose()}movePane(e,t){const i=this.paneItems.findIndex(o=>o.pane===e),n=this.paneItems.findIndex(o=>o.pane===t);if(i===-1||n===-1)return;const[s]=this.paneItems.splice(i,1);this.paneItems.splice(n,0,s),this.splitview.moveView(i,n)}resizePane(e,t){const i=this.paneItems.findIndex(n=>n.pane===e);i!==-1&&this.splitview.resizeView(i,t)}getPaneSize(e){const t=this.paneItems.findIndex(i=>i.pane===e);return t===-1?-1:this.splitview.getViewSize(t)}layout(e,t){this.orthogonalSize=this.orientation===0?t:e,this.size=this.orientation===1?t:e;for(const i of this.paneItems)i.pane.orthogonalSize=this.orthogonalSize;this.splitview.layout(this.size)}setBoundarySashes(e){this.boundarySashes=e,this.updateSplitviewOrthogonalSashes(e)}updateSplitviewOrthogonalSashes(e){this.orientation===0?(this.splitview.orthogonalStartSash=e==null?void 0:e.left,this.splitview.orthogonalEndSash=e==null?void 0:e.right):this.splitview.orthogonalEndSash=e==null?void 0:e.bottom}flipOrientation(e,t){this.orientation=this.orientation===0?1:0;const i=this.paneItems.map(o=>this.getPaneSize(o.pane));this.splitview.dispose(),Rg(this.element),this.splitview=this._register(new LP(this.element,{orientation:this.orientation})),this.updateSplitviewOrthogonalSashes(this.boundarySashes);const n=this.orientation===0?t:e,s=this.orientation===1?t:e;this.paneItems.forEach((o,a)=>{o.pane.orthogonalSize=n,o.pane.orientation=this.orientation;const c=this.size===0?0:s*i[a]/this.size;this.splitview.addView(o.pane,c,a)}),this.size=s,this.orthogonalSize=n,this.splitview.layout(this.size)}setupAnimation(){typeof this.animationTimer=="number"&&window.clearTimeout(this.animationTimer),this.element.classList.add("animated"),this.animationTimer=window.setTimeout(()=>{this.animationTimer=void 0,this.element.classList.remove("animated")},200)}getPaneHeaderElements(){return[...this.element.querySelectorAll(".pane-header")]}focusPrevious(){const e=this.getPaneHeaderElements(),t=e.indexOf(document.activeElement);t!==-1&&e[Math.max(t-1,0)].focus()}focusNext(){const e=this.getPaneHeaderElements(),t=e.indexOf(document.activeElement);t!==-1&&e[Math.min(t+1,e.length-1)].focus()}dispose(){super.dispose(),this.paneItems.forEach(e=>e.disposable.dispose())}}class kFe extends ne{constructor(e,t){super(),this.progressBar=e,this.group=t,this.registerListeners()}registerListeners(){this._register(this.group.onDidModelChange(e=>{(e.kind===6||e.kind===4&&this.group.isEmpty)&&this.progressBar.stop().hide()}))}show(e,t){return this.group.isEmpty?g7:e===!0?this.doShow(!0,t):this.doShow(e,t)}doShow(e,t){return typeof e=="boolean"?this.progressBar.infinite().show(t):this.progressBar.total(e).show(t),{total:i=>{this.progressBar.total(i)},worked:i=>{this.progressBar.hasTotal()?this.progressBar.worked(i):this.progressBar.infinite().show()},done:()=>{this.progressBar.stop().hide()}}}async showWhile(e,t){if(this.group.isEmpty)try{await e}catch{}return this.doShowWhile(e,t)}async doShowWhile(e,t){try{this.progressBar.infinite().show(t),await e}catch{}finally{this.progressBar.stop().hide()}}}var Fo;(function(r){(function(i){i[i.None=0]="None",i[i.Done=1]="Done",i[i.Infinite=2]="Infinite",i[i.While=3]="While",i[i.Work=4]="Work"})(r.Type||(r.Type={})),r.None={type:0},r.Done={type:1},r.Infinite={type:2};class e{constructor(n,s,o){this.whilePromise=n,this.whileStart=s,this.whileDelay=o,this.type=3}}r.While=e;class t{constructor(n,s){this.total=n,this.worked=s,this.type=4}}r.Work=t})(Fo||(Fo={}));class ime extends ne{constructor(e,t){super(),this.progressBar=e,this.scope=t,this.progressState=Fo.None,this.registerListeners()}registerListeners(){this._register(this.scope.onDidChangeActive(()=>{this.scope.isActive?this.onDidScopeActivate():this.onDidScopeDeactivate()}))}onDidScopeActivate(){if(this.progressState.type!==Fo.Done.type)if(this.progressState.type===3){let e;if(this.progressState.whileDelay>0){const t=this.progressState.whileDelay-(Date.now()-this.progressState.whileStart);t>0&&(e=t)}this.doShowWhile(e)}else this.progressState.type===2?this.progressBar.infinite().show():this.progressState.type===4&&(this.progressState.total&&this.progressBar.total(this.progressState.total).show(),this.progressState.worked&&this.progressBar.worked(this.progressState.worked).show())}onDidScopeDeactivate(){this.progressBar.stop().hide()}show(e,t){return typeof e=="boolean"?this.progressState=Fo.Infinite:this.progressState=new Fo.Work(e,void 0),this.scope.isActive&&(this.progressState.type===2?this.progressBar.infinite().show(t):this.progressState.type===4&&typeof this.progressState.total=="number"&&this.progressBar.total(this.progressState.total).show(t)),{total:i=>{this.progressState=new Fo.Work(i,this.progressState.type===4?this.progressState.worked:void 0),this.scope.isActive&&this.progressBar.total(i)},worked:i=>{!this.scope.isActive||this.progressBar.hasTotal()?(this.progressState=new Fo.Work(this.progressState.type===4?this.progressState.total:void 0,this.progressState.type===4&&typeof this.progressState.worked=="number"?this.progressState.worked+i:i),this.scope.isActive&&this.progressBar.worked(i)):(this.progressState=Fo.Infinite,this.progressBar.infinite().show())},done:()=>{this.progressState=Fo.Done,this.scope.isActive&&this.progressBar.stop().hide()}}}async showWhile(e,t){this.progressState.type===3&&(e=Promise.all([e,this.progressState.whilePromise])),this.progressState=new Fo.While(e,t||0,Date.now());try{this.doShowWhile(t),await e}catch{}finally{(this.progressState.type!==3||this.progressState.whilePromise===e)&&(this.progressState=Fo.None,this.scope.isActive&&this.progressBar.stop().hide())}}doShowWhile(e){this.scope.isActive&&this.progressBar.infinite().show(e)}}class nme extends ne{get isActive(){return this._isActive}constructor(e,t){super(),this.scopeId=e,this._isActive=t,this._onDidChangeActive=this._register(new A),this.onDidChangeActive=this._onDidChangeActive.event}onScopeOpened(e){e===this.scopeId&&(this._isActive||(this._isActive=!0,this._onDidChangeActive.fire()))}onScopeClosed(e){e===this.scopeId&&this._isActive&&(this._isActive=!1,this._onDidChangeActive.fire())}}class rme extends ne{get primaryActions(){return this._primaryActions}get secondaryActions(){return this._secondaryActions}constructor(e,t,i,n){super(),this.options=t,this.menuService=i,this.contextKeyService=n,this._primaryActions=[],this._secondaryActions=[],this._onDidChange=this._register(new A),this.onDidChange=this._onDidChange.event,this.disposables=this._register(new me),this.menu=this._register(i.createMenu(e,n)),this._register(this.menu.onDidChange(()=>this.updateActions())),this.updateActions()}updateActions(){this.disposables.clear(),this._primaryActions=[],this._secondaryActions=[],_k(this.menu,this.options,{primary:this._primaryActions,secondary:this._secondaryActions}),this.disposables.add(this.updateSubmenus([...this._primaryActions,...this._secondaryActions],{})),this._onDidChange.fire()}updateSubmenus(e,t){const i=new me;for(const n of e)if(n instanceof wk&&!t[n.item.submenu.id]){const s=t[n.item.submenu.id]=i.add(this.menuService.createMenu(n.item.submenu,this.contextKeyService));i.add(s.onDidChange(()=>this.updateActions())),i.add(this.updateSubmenus(n.actions,t))}return i}}let zx=class extends ne{constructor(e,t,i,n,s){super(),this.menuId=e,this.contextMenuId=t,this.options=i,this.contextKeyService=n,this.menuService=s,this._onDidChange=this._register(new A),this.onDidChange=this._onDidChange.event,this.menuActions=this._register(new rme(e,this.options,s,n)),this._register(this.menuActions.onDidChange(()=>this._onDidChange.fire()))}getPrimaryActions(){return this.menuActions.primaryActions}getSecondaryActions(){return this.menuActions.secondaryActions}getContextMenuActions(){const e=[];if(this.contextMenuId){const t=this.menuService.createMenu(this.contextMenuId,this.contextKeyService);_k(t,this.options,{primary:[],secondary:e}),t.dispose()}return e}};zx=T([v(3,It),v(4,ib)],zx);const p8=new Ee("menu.view.filter"),lI=new Ee("submenu.view.filter");Un.appendMenuItem(p8,{submenu:lI,title:p("more filters","More Filters..."),group:"navigation",icon:jt.filter});class sme extends iG{constructor(){super(...arguments),this._checked=!1}set checked(e){this._checked!==e&&(this._checked=e,this.updateChecked())}updateChecked(){this.element&&this.element.classList.toggle("checked",this._checked)}render(e){super.render(e),this.updateChecked()}}let gF=class extends Xq{constructor(e,t,i,n,s){super(),this.options=e,this.instantiationService=t,this.contextViewService=i,this.keybindingService=s,this._onDidChangeFilterText=this._register(new A),this.onDidChangeFilterText=this._onDidChangeFilterText.event,this.isMoreFiltersChecked=!1,this.delayedFilterUpdate=new Jq(400),this._register(ot(()=>this.delayedFilterUpdate.cancel())),e.focusContextKey&&(this.focusContextKey=new G(e.focusContextKey,!1).bindTo(n)),this.element=Ve(".viewpane-filter"),this.filterInputBox=this.createInput(this.element);const o=Fe(this.element,Ve(".viewpane-filter-controls"));this.filterBadge=this.createBadge(o),this.toolbar=this._register(this.createToolBar(o)),this.adjustInputBox()}focus(){this.filterInputBox.focus()}blur(){this.filterInputBox.blur()}updateBadge(e){this.filterBadge.classList.toggle("hidden",!e),this.filterBadge.textContent=e||"",this.adjustInputBox()}setFilterText(e){this.filterInputBox.value=e}getFilterText(){return this.filterInputBox.value}getHistory(){return this.filterInputBox.getHistory()}layout(e){var t;(t=this.element.parentElement)==null||t.classList.toggle("grow",e>700),this.element.classList.toggle("small",e<400),this.adjustInputBox()}checkMoreFilters(e){this.isMoreFiltersChecked=e,this.moreFiltersActionViewItem&&(this.moreFiltersActionViewItem.checked=e)}createInput(e){const t=this._register(this.instantiationService.createInstance(m7,e,this.contextViewService,{placeholder:this.options.placeholder,ariaLabel:this.options.ariaLabel,history:this.options.history||[],showHistoryHint:()=>v7(this.keybindingService),inputBoxStyles:Zq}));this.options.text&&(t.value=this.options.text),this._register(t.onDidChange(n=>this.delayedFilterUpdate.trigger(()=>this.onDidInputChange(t)))),this._register(Wp(t.inputElement,sn.KEY_DOWN,n=>this.onInputKeyDown(n,t))),this._register(Wp(e,sn.KEY_DOWN,this.handleKeyboardEvent)),this._register(Wp(e,sn.KEY_UP,this.handleKeyboardEvent)),this._register(Wp(t.inputElement,sn.CLICK,n=>{n.stopPropagation(),n.preventDefault()}));const i=this._register(Um(t.inputElement));return this.focusContextKey&&(this._register(i.onDidFocus(()=>this.focusContextKey.set(!0))),this._register(i.onDidBlur(()=>this.focusContextKey.set(!1))),this._register(ot(()=>this.focusContextKey.reset()))),t}createBadge(e){const t=Fe(e,Ve(".viewpane-filter-badge.hidden"));return t.style.backgroundColor=es(eG),t.style.color=es(tG),t.style.border=`1px solid ${es(yt)}`,t}createToolBar(e){return this.instantiationService.createInstance(y7,e,p8,{hiddenItemStrategy:-1,actionViewItemProvider:t=>{if(t instanceof wk&&t.item.submenu.id===lI.id)return this.moreFiltersActionViewItem=this.instantiationService.createInstance(sme,t,void 0),this.moreFiltersActionViewItem.checked=this.isMoreFiltersChecked,this.moreFiltersActionViewItem}})}onDidInputChange(e){e.addToHistory(),this._onDidChangeFilterText.fire(e.value)}adjustInputBox(){this.filterInputBox.inputElement.style.paddingRight=this.element.classList.contains("small")||this.filterBadge.classList.contains("hidden")?"25px":"150px"}handleKeyboardEvent(e){(e.equals(10)||e.equals(15)||e.equals(17))&&e.stopPropagation()}onInputKeyDown(e,t){let i=!1;e.equals(2)&&!this.toolbar.isEmpty()&&(this.toolbar.focus(),i=!0),i&&(e.stopPropagation(),e.preventDefault())}};gF=T([v(1,Te),v(2,fk),v(3,It),v(4,Ts)],gF);const PU=new Zn("viewpane.action.filter"),ome=Tc("view-pane-container-expanded",jt.chevronDown,p("viewPaneContainerExpandedIcon","Icon for an expanded view pane container.")),ame=Tc("view-pane-container-collapsed",jt.chevronRight,p("viewPaneContainerCollapsedIcon","Icon for a collapsed view pane container.")),AU=st.as(Xo.ViewsRegistry);let mF=class{get contents(){const e=this.items.filter(t=>t.visible);return e.length===0&&this.defaultItem?[this.defaultItem.descriptor]:e.map(t=>t.descriptor)}constructor(e,t){this.id=e,this.contextKeyService=t,this._onDidChange=new A,this.onDidChange=this._onDidChange.event,this.items=[],this.disposables=new me,t.onDidChangeContext(this.onDidChangeContext,this,this.disposables),F.filter(AU.onDidChangeViewWelcomeContent,i=>i===this.id)(this.onDidChangeViewWelcomeContent,this,this.disposables),this.onDidChangeViewWelcomeContent()}onDidChangeViewWelcomeContent(){const e=AU.getViewWelcomeContent(this.id);this.items=[];for(const t of e)if(t.when==="default")this.defaultItem={descriptor:t,visible:!0};else{const i=t.when?this.contextKeyService.contextMatchesRules(t.when):!0;this.items.push({descriptor:t,visible:i})}this._onDidChange.fire()}onDidChangeContext(){let e=!1;for(const t of this.items){if(!t.descriptor.when||t.descriptor.when==="default")continue;const i=this.contextKeyService.contextMatchesRules(t.descriptor.when);t.visible!==i&&(t.visible=i,e=!0)}e&&this._onDidChange.fire()}dispose(){this.disposables.dispose()}};mF=T([v(1,It)],mF);let pu=class g8 extends pw{get title(){return this._title}get titleDescription(){return this._titleDescription}constructor(e,t,i,n,s,o,a,c,d,l){super({...e,orientation:o.getViewLocationById(e.id)===1?1:0}),this.keybindingService=t,this.contextMenuService=i,this.configurationService=n,this.contextKeyService=s,this.viewDescriptorService=o,this.instantiationService=a,this.openerService=c,this.themeService=d,this.telemetryService=l,this._onDidFocus=this._register(new A),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new A),this.onDidBlur=this._onDidBlur.event,this._onDidChangeBodyVisibility=this._register(new A),this.onDidChangeBodyVisibility=this._onDidChangeBodyVisibility.event,this._onDidChangeTitleArea=this._register(new A),this.onDidChangeTitleArea=this._onDidChangeTitleArea.event,this._onDidChangeViewWelcomeState=this._register(new A),this.onDidChangeViewWelcomeState=this._onDidChangeViewWelcomeState.event,this._isVisible=!1,this.showActionsAlways=!1,this.viewWelcomeDisposable=ne.None,this.id=e.id,this._title=e.title,this._titleDescription=e.titleDescription,this.showActionsAlways=!!e.showActionsAlways,this.scopedContextKeyService=this._register(s.createScoped(this.element)),this.scopedContextKeyService.createKey("view",this.id);const u=this.scopedContextKeyService.createKey("viewLocation",j_(o.getViewLocationById(this.id)));this._register(F.filter(o.onDidChangeLocation,h=>h.views.some(g=>g.id===this.id))(()=>u.set(j_(o.getViewLocationById(this.id))))),this.menuActions=this._register(this.instantiationService.createChild(new Of([It,this.scopedContextKeyService])).createInstance(zx,e.titleMenuId??Ee.ViewTitle,Ee.ViewTitleContext,{shouldForwardArgs:!e.donotForwardArgs})),this._register(this.menuActions.onDidChange(()=>this.updateActions())),this.viewWelcomeController=new mF(this.id,s)}get headerVisible(){return super.headerVisible}set headerVisible(e){super.headerVisible=e,this.element.classList.toggle("merged-header",!e)}setVisible(e){this._isVisible!==e&&(this._isVisible=e,this.isExpanded()&&this._onDidChangeBodyVisibility.fire(e))}isVisible(){return this._isVisible}isBodyVisible(){return this._isVisible&&this.isExpanded()}setExpanded(e){const t=super.setExpanded(e);return t&&this._onDidChangeBodyVisibility.fire(e),this.twistiesContainer&&(this.twistiesContainer.classList.remove(...Si.asClassNameArray(this.getTwistyIcon(!e))),this.twistiesContainer.classList.add(...Si.asClassNameArray(this.getTwistyIcon(e)))),t}render(){super.render();const e=Um(this.element);this._register(e),this._register(e.onDidFocus(()=>this._onDidFocus.fire())),this._register(e.onDidBlur(()=>this._onDidBlur.fire()))}renderHeader(e){this.headerContainer=e,this.twistiesContainer=Fe(e,Ve(Si.asCSSSelector(this.getTwistyIcon(this.isExpanded())))),this.renderHeaderTitle(e,this.title);const t=Fe(e,Ve(".actions"));t.classList.toggle("show",this.showActionsAlways),this.toolbar=this.instantiationService.createInstance(_7,t,{orientation:0,actionViewItemProvider:s=>this.getActionViewItem(s),ariaLabel:p("viewToolbarAriaLabel","{0} actions",this.title),getKeyBinding:s=>this.keybindingService.lookupKeybinding(s.id),renderDropdownAsChildElement:!0,actionRunner:this.getActionRunner(),resetMenu:this.menuActions.menuId}),this._register(this.toolbar),this.setActions(),this._register(Ci(t,sn.CLICK,s=>s.preventDefault()));const i=this.viewDescriptorService.getViewContainerByViewId(this.id);i?this._register(this.viewDescriptorService.getViewContainerModel(i).onDidChangeContainerInfo(({title:s})=>this.updateTitle(this.title))):console.error(`View container model not found for view ${this.id}`);const n=F.filter(this.configurationService.onDidChangeConfiguration,s=>s.affectsConfiguration(g8.AlwaysShowActionsConfig));this._register(n(this.updateActionsVisibility,this)),this.updateActionsVisibility()}getTwistyIcon(e){return e?ome:ame}style(e){super.style(e);const t=this.getIcon();if(this.iconContainer){const i=w7(e.headerForeground,es(k7));k.isUri(t)?(this.iconContainer.style.backgroundColor=i,this.iconContainer.style.color=""):(this.iconContainer.style.color=i,this.iconContainer.style.backgroundColor="")}}getIcon(){var e;return((e=this.viewDescriptorService.getViewDescriptorById(this.id))==null?void 0:e.containerIcon)||Hce}renderHeaderTitle(e,t){this.iconContainer=Fe(e,Ve(".icon",void 0));const i=this.getIcon();let n;if(k.isUri(i)){n=`view-${this.id.replace(/[\.\:]/g,"-")}`;const o=`.pane-header .icon.${n}`;Nu(o,`
				mask: ${Qy(i)} no-repeat 50% 50%;
				mask-size: 24px;
				-webkit-mask: ${Qy(i)} no-repeat 50% 50%;
				-webkit-mask-size: 16px;
			`)}else Si.isThemeIcon(i)&&(n=Si.asClassName(i));n&&this.iconContainer.classList.add(...n.split(" "));const s=this.calculateTitle(t);this.titleContainer=Fe(e,Ve("h3.title",{title:s},s)),this._titleDescription&&this.setTitleDescription(this._titleDescription),this.iconContainer.title=s,this.iconContainer.setAttribute("aria-label",s)}updateTitle(e){const t=this.calculateTitle(e);this.titleContainer&&(this.titleContainer.textContent=t,this.titleContainer.setAttribute("title",t)),this.iconContainer&&(this.iconContainer.title=t,this.iconContainer.setAttribute("aria-label",t)),this._title=e,this._onDidChangeTitleArea.fire()}setTitleDescription(e){this.titleDescriptionContainer?(this.titleDescriptionContainer.textContent=e??"",this.titleDescriptionContainer.setAttribute("title",e??"")):e&&this.titleContainer&&(this.titleDescriptionContainer=b7(this.titleContainer,Ve("span.description",{title:e},e)))}updateTitleDescription(e){this.setTitleDescription(e),this._titleDescription=e,this._onDidChangeTitleArea.fire()}calculateTitle(e){const t=this.viewDescriptorService.getViewContainerByViewId(this.id),i=this.viewDescriptorService.getViewContainerModel(t),n=this.viewDescriptorService.getViewDescriptorById(this.id);return!(this.viewDescriptorService.getDefaultContainerById(this.id)===t)&&(n!=null&&n.containerTitle)&&i.title!==n.containerTitle?`${n.containerTitle}: ${e}`:e}renderBody(e){this.bodyContainer=e;const t=Fe(e,Ve(".welcome-view"));this.viewWelcomeContainer=Ve(".welcome-view-content",{tabIndex:0}),this.scrollableElement=this._register(new S7(this.viewWelcomeContainer,{alwaysConsumeMouseWheel:!0,horizontal:2,vertical:3})),Fe(t,this.scrollableElement.getDomNode());const i=F.any(this.viewWelcomeController.onDidChange,this.onDidChangeViewWelcomeState);this._register(i(this.updateViewWelcome,this)),this.updateViewWelcome()}layoutBody(e,t){this.viewWelcomeContainer.style.height=`${e}px`,this.viewWelcomeContainer.style.width=`${t}px`,this.viewWelcomeContainer.classList.toggle("wide",t>640),this.scrollableElement.scanDomNode()}onDidScrollRoot(){}getProgressIndicator(){if(this.progressBar===void 0&&(this.progressBar=this._register(new C7(this.element,E7)),this.progressBar.hide()),this.progressIndicator===void 0){const e=this;this.progressIndicator=new ime(Mi(this.progressBar),new class extends nme{constructor(){super(e.id,e.isBodyVisible()),this._register(e.onDidChangeBodyVisibility(t=>t?this.onScopeOpened(e.id):this.onScopeClosed(e.id)))}})}return this.progressIndicator}getProgressLocation(){return this.viewDescriptorService.getViewContainerByViewId(this.id).id}getBackgroundColor(){switch(this.viewDescriptorService.getViewLocationById(this.id)){case 1:return Gge;case 0:case 2:return Gx}return Gx}focus(){this.shouldShowWelcome()?this.viewWelcomeContainer.focus():this.element&&(this.element.focus(),this._onDidFocus.fire())}setActions(){if(this.toolbar){const e=[...this.menuActions.getPrimaryActions()];this.shouldShowFilterInHeader()&&e.unshift(PU),this.toolbar.setActions(xH(e),xH(this.menuActions.getSecondaryActions())),this.toolbar.context=this.getActionsContext()}}updateActionsVisibility(){if(!this.headerContainer)return;const e=this.configurationService.getValue("workbench.view.alwaysShowHeaderActions");this.headerContainer.classList.toggle("actions-always-visible",e)}updateActions(){this.setActions(),this._onDidChangeTitleArea.fire()}getActionViewItem(e,t){if(e.id===PU.id){const i=this;return new class extends x7{constructor(){super(null,e)}setFocusable(){}get trapsArrowNavigation(){return!0}render(n){n.classList.add("viewpane-filter-container"),Fe(n,i.getFilterWidget().element)}}}return n1(this.instantiationService,e,{...t,menuAsChild:e instanceof wk})}getActionsContext(){}getActionRunner(){}getOptimalWidth(){return 0}saveState(){}updateViewWelcome(){if(this.viewWelcomeDisposable.dispose(),!this.shouldShowWelcome()){this.bodyContainer.classList.remove("welcome"),this.viewWelcomeContainer.innerText="",this.scrollableElement.scanDomNode();return}const e=this.viewWelcomeController.contents;if(e.length===0){this.bodyContainer.classList.remove("welcome"),this.viewWelcomeContainer.innerText="",this.scrollableElement.scanDomNode();return}const t=new me;this.bodyContainer.classList.add("welcome"),this.viewWelcomeContainer.innerText="";for(const{content:i,precondition:n}of e){const s=i.split(`
`);for(let o of s){if(o=o.trim(),!o)continue;const a=D7(o);if(a.nodes.length===1&&typeof a.nodes[0]!="string"){const c=a.nodes[0],d=Fe(this.viewWelcomeContainer,Ve(".button-container")),l=new nG(d,{title:c.title,supportIcons:!0,...rG});if(l.label=c.label,l.onDidClick(u=>{this.telemetryService.publicLog2("views.welcomeAction",{viewId:this.id,uri:c.href}),this.openerService.open(c.href,{allowCommands:!0})},null,t),t.add(l),n){const u=()=>l.enabled=this.contextKeyService.contextMatchesRules(n);u();const h=new Set;n.keys().forEach(m=>h.add(m)),F.filter(this.contextKeyService.onDidChangeContext,m=>m.affectsSome(h))(u,null,t)}}else{const c=Fe(this.viewWelcomeContainer,Ve("p"));for(const d of a.nodes)if(typeof d=="string")Fe(c,document.createTextNode(d));else{const l=t.add(this.instantiationService.createInstance(sG,c,d,{}));if(n&&d.href.startsWith("command:")){const u=()=>l.enabled=this.contextKeyService.contextMatchesRules(n);u();const h=new Set;n.keys().forEach(m=>h.add(m)),F.filter(this.contextKeyService.onDidChangeContext,m=>m.affectsSome(h))(u,null,t)}}}}}this.scrollableElement.scanDomNode(),this.viewWelcomeDisposable=t}shouldShowWelcome(){return!1}getFilterWidget(){}shouldShowFilterInHeader(){return!1}};pu.AlwaysShowActionsConfig="workbench.view.alwaysShowHeaderActions";pu=T([v(1,Ts),v(2,eo),v(3,We),v(4,It),v(5,to),v(6,Te),v(7,us),v(8,Fi),v(9,gi)],pu);let vF=class extends pu{constructor(e,t,i,n,s,o,a,c,d,l){super(e,t,i,n,s,o,a,c,d,l),this.filterWidget=this._register(a.createChild(new Of([It,this.scopedContextKeyService])).createInstance(gF,e.filterOptions))}getFilterWidget(){return this.filterWidget}renderBody(e){super.renderBody(e),this.filterContainer=Fe(e,Ve(".viewpane-filter-container"))}layoutBody(e,t){var s;super.layoutBody(e,t),this.dimension=new Fl(t,e);const i=!((s=this.filterContainer)!=null&&s.hasChildNodes()),n=this.shouldShowFilterInHeader();i!==n&&(n&&TC(this.filterContainer),this.updateActions(),n||Fe(this.filterContainer,this.filterWidget.element)),n||(e=e-44),this.filterWidget.layout(t),this.layoutBodyContent(e,t)}shouldShowFilterInHeader(){return!(this.dimension&&this.dimension.width<600&&this.dimension.height>100)}};vF=T([v(1,Ts),v(2,eo),v(3,We),v(4,It),v(5,to),v(6,Te),v(7,us),v(8,Fi),v(9,gi)],vF);class Yf extends Le{constructor(e){super(e),this.desc=e}run(e,...t){const i=e.get(ko).getActiveViewWithId(this.desc.viewId);if(i)return this.runInView(e,i,...t)}}const gw=new G("workbenchState",void 0,{type:"string",description:p("workbenchState","The kind of workspace opened in the window, either 'empty' (no workspace), 'folder' (single folder) or 'workspace' (multi-root workspace)")}),cme=new G("workspaceFolderCount",0,p("workspaceFolderCount","The number of root folders in the workspace")),K$=new G("openFolderWorkspaceSupport",!0,!0),m8=new G("enterMultiRootWorkspaceSupport",!0,!0),dme=new G("emptyWorkspaceSupport",!0,!0),AFe=new G("dirtyWorkingCopies",!1,p("dirtyWorkingCopies","Whether there are any working copies with unsaved changes")),lme=new G("remoteName","",p("remoteName","The name of the remote the window is connected to or an empty string if not connected to any remote")),MFe=new G("virtualWorkspace","",p("virtualWorkspace","The scheme of the current workspace is from a virtual file system or an empty string.")),LFe=new G("isFullscreen",!1,p("isFullscreen","Whether the window is in fullscreen mode")),FFe=new G("hasWebFileSystemAccess",!1,!0),OFe=new G("activeEditorIsDirty",!1,p("activeEditorIsDirty","Whether the active editor has unsaved changes")),NFe=new G("activeEditorIsNotPreview",!1,p("activeEditorIsNotPreview","Whether the active editor is not in preview mode")),$Fe=new G("activeEditorIsFirstInGroup",!1,p("activeEditorIsFirstInGroup","Whether the active editor is the first one in its group")),WFe=new G("activeEditorIsLastInGroup",!1,p("activeEditorIsLastInGroup","Whether the active editor is the last one in its group")),MU=new G("activeEditorIsPinned",!1,p("activeEditorIsPinned","Whether the active editor is pinned")),ume=new G("activeEditorCanToggleReadonly",!0,p("activeEditorCanToggleReadonly","Whether the active editor can toggle between being read-only or writeable")),nP=new G("activeEditorCanSplitInGroup",!0),hme=new G("activeEditor",null,{type:"string",description:p("activeEditor","The identifier of the active editor")}),v8=new G("activeEditorAvailableEditorIds","",p("activeEditorAvailableEditorIds","The available editor identifiers that are usable for the active editor")),LU=new G("textCompareEditorVisible",!1,p("textCompareEditorVisible","Whether a text compare editor is visible")),Kl=new G("textCompareEditorActive",!1,p("textCompareEditorActive","Whether a text compare editor is active")),ph=new G("sideBySideEditorActive",!1,p("sideBySideEditorActive","Whether a side by side editor is active")),HFe=new G("groupEditorsCount",0,p("groupEditorsCount","The number of opened editor groups")),Q$=new G("activeEditorGroupEmpty",!1,p("activeEditorGroupEmpty","Whether the active editor group is empty")),FU=new G("activeEditorGroupLocked",!1,p("activeEditorGroupLocked","Whether the active editor group is locked")),eC=new G("multipleEditorGroups",!1,p("multipleEditorGroups","Whether there are multiple editor groups opened")),jFe=new G("inZenMode",!1,p("inZenMode","Whether Zen mode is enabled")),BFe=new G("isCenteredLayout",!1,p("isCenteredLayout","Whether centered layout is enabled")),UFe=new G("editorTabsVisible",!0,p("editorTabsVisible","Whether editor tabs are visible")),VFe=new G("sideBarVisible",!1,p("sideBarVisible","Whether the sidebar is visible")),qFe=new G("sideBarFocus",!1,p("sideBarFocus","Whether the sidebar has keyboard focus")),GFe=new G("activeViewlet","",p("activeViewlet","The identifier of the active viewlet")),zFe=new G("statusBarFocused",!1,p("statusBarFocused","Whether the status bar has keyboard focus")),KFe=new G("notificationFocus",!0,p("notificationFocus","Whether a notification has keyboard focus")),QFe=new G("notificationCenterVisible",!1,p("notificationCenterVisible","Whether the notifications center is visible")),YFe=new G("notificationToastsVisible",!1,p("notificationToastsVisible","Whether a notification toast is visible")),XFe=new G("auxiliaryBarVisible",!1,p("auxiliaryBarVisible","Whether the auxiliary bar is visible")),JFe=new G("activePanel","",p("activePanel","The identifier of the active panel")),ZFe=new G("panelFocus",!1,p("panelFocus","Whether the panel has keyboard focus")),eOe=new G("panelPosition","bottom",p("panelPosition","The position of the panel, always 'bottom'")),tOe=new G("panelAlignment","center",p("panelAlignment","The alignment of the panel, either 'center', 'left', 'right' or 'justify'")),iOe=new G("panelVisible",!1,p("panelVisible","Whether the panel is visible")),nv=new G("focusedView","",p("focusedView","The identifier of the view that has keyboard focus"));function nOe(r){return`view.${r}.visible`}function rOe(r){return`viewContainer.${r}.enabled`}let Zs=class Ja{constructor(e,t,i,n){this._contextKeyService=e,this._fileService=t,this._languageService=i,this._modelService=n,this._disposables=new me,this._schemeKey=Ja.Scheme.bindTo(this._contextKeyService),this._filenameKey=Ja.Filename.bindTo(this._contextKeyService),this._dirnameKey=Ja.Dirname.bindTo(this._contextKeyService),this._pathKey=Ja.Path.bindTo(this._contextKeyService),this._langIdKey=Ja.LangId.bindTo(this._contextKeyService),this._resourceKey=Ja.Resource.bindTo(this._contextKeyService),this._extensionKey=Ja.Extension.bindTo(this._contextKeyService),this._hasResource=Ja.HasResource.bindTo(this._contextKeyService),this._isFileSystemResource=Ja.IsFileSystemResource.bindTo(this._contextKeyService),this._disposables.add(t.onDidChangeFileSystemProviderRegistrations(()=>{const s=this.get();this._isFileSystemResource.set(!!(s&&t.hasProvider(s)))})),this._disposables.add(n.onModelAdded(s=>{si(s.uri,this.get())&&this._setLangId()})),this._disposables.add(n.onModelLanguageChanged(s=>{si(s.model.uri,this.get())&&this._setLangId()}))}dispose(){this._disposables.dispose()}_setLangId(){var i;const e=this.get();if(!e){this._langIdKey.set(null);return}const t=((i=this._modelService.getModel(e))==null?void 0:i.getLanguageId())??this._languageService.guessLanguageIdByFilepathOrFirstLine(e);this._langIdKey.set(t)}set(e){e=e??void 0,!si(this._value,e)&&(this._value=e,this._contextKeyService.bufferChangeEvents(()=>{this._resourceKey.set(e?e.toString():null),this._schemeKey.set(e?e.scheme:null),this._filenameKey.set(e?Mt(e):null),this._dirnameKey.set(e?this.uriToPath(pn(e)):null),this._pathKey.set(e?this.uriToPath(e):null),this._setLangId(),this._extensionKey.set(e?Xw(e):null),this._hasResource.set(!!e),this._isFileSystemResource.set(e?this._fileService.hasProvider(e):!1)}))}uriToPath(e){return e.scheme===pe.file?e.fsPath:e.path}reset(){this._value=void 0,this._contextKeyService.bufferChangeEvents(()=>{this._resourceKey.reset(),this._schemeKey.reset(),this._filenameKey.reset(),this._dirnameKey.reset(),this._pathKey.reset(),this._langIdKey.reset(),this._extensionKey.reset(),this._hasResource.reset(),this._isFileSystemResource.reset()})}get(){return this._value}};Zs.Scheme=new G("resourceScheme",void 0,{type:"string",description:p("resourceScheme","The scheme of the resource")});Zs.Filename=new G("resourceFilename",void 0,{type:"string",description:p("resourceFilename","The file name of the resource")});Zs.Dirname=new G("resourceDirname",void 0,{type:"string",description:p("resourceDirname","The folder name the resource is contained in")});Zs.Path=new G("resourcePath",void 0,{type:"string",description:p("resourcePath","The full path of the resource")});Zs.LangId=new G("resourceLangId",void 0,{type:"string",description:p("resourceLangId","The language identifier of the resource")});Zs.Resource=new G("resource",void 0,{type:"URI",description:p("resource","The full value of the resource including scheme and path")});Zs.Extension=new G("resourceExtname",void 0,{type:"string",description:p("resourceExtname","The extension name of the resource")});Zs.HasResource=new G("resourceSet",void 0,{type:"boolean",description:p("resourceSet","Whether a resource is present or not")});Zs.IsFileSystemResource=new G("isFileSystemResource",void 0,{type:"boolean",description:p("isFileSystemResource","Whether the resource is backed by a file system provider")});Zs=T([v(0,It),v(1,at),v(2,ji),v(3,_i)],Zs);let yF=class extends pu{get scrollLock(){return!!this.scrollLockContextKey.get()}set scrollLock(e){this.scrollLockContextKey.set(e)}constructor(e,t,i,n,s,o,a,c,d,l){super(e,t,i,n,s,o,a,c,d,l),this.editorPromise=null,this.scrollLockContextKey=Q3.bindTo(this.contextKeyService);const u=a.createChild(new Of([It,this.scopedContextKeyService]));this.editor=u.createInstance(_F),this._register(this.editor.onTitleAreaUpdate(()=>{this.updateTitle(this.editor.getTitle()),this.updateActions()})),this._register(this.onDidChangeBodyVisibility(()=>this.onDidChangeVisibility(this.isBodyVisible())))}showChannel(e,t){this.channelId!==e.id&&this.setInput(e),t||this.focus()}focus(){var e;super.focus(),(e=this.editorPromise)==null||e.then(()=>this.editor.focus())}renderBody(e){super.renderBody(e),this.editor.create(e),e.classList.add("output-view");const t=this.editor.getControl();t.setAriaOptions({role:"document",activeDescendant:void 0}),this._register(t.onDidChangeModelContent(()=>{this.scrollLock||this.editor.revealLastLine()})),this._register(t.onDidChangeCursorPosition(i=>{if(i.reason!==3||!this.configurationService.getValue("output.smartScroll.enabled"))return;const n=t.getModel();if(n){const s=i.position.lineNumber,o=n.getLineCount();this.scrollLock=o!==s}}))}layoutBody(e,t){super.layoutBody(e,t),this.editor.layout(new Fl(t,e))}onDidChangeVisibility(e){this.editor.setVisible(e),e||this.clearInput()}setInput(e){var i;this.channelId=e.id;const t=this.createInput(e);(!this.editor.input||!t.matches(this.editor.input))&&((i=this.editorPromise)==null||i.cancel(),this.editorPromise=cd(n=>this.editor.setInput(this.createInput(e),{preserveFocus:!0},Object.create(null),n).then(()=>this.editor)))}clearInput(){this.channelId=void 0,this.editor.clearInput(),this.editorPromise=null}createInput(e){return this.instantiationService.createInstance(du,e.uri,p("output model title","{0} - Output",e.label),p("channel","Output channel for '{0}'",e.label),void 0,void 0)}};yF=T([v(1,Ts),v(2,eo),v(3,We),v(4,It),v(5,to),v(6,Te),v(7,us),v(8,Fi),v(9,gi)],yF);let _F=class extends fw{constructor(e,t,i,n,s,o,a,c,d,l){super(Xn,e,t,i,s,o,a,c,d),this.configurationService=n,this.resourceContext=this._register(t.createInstance(Zs))}getId(){return Xn}getTitle(){return p("output","Output")}getConfigurationOverrides(){const e=super.getConfigurationOverrides();e.wordWrap="on",e.lineNumbers="off",e.glyphMargin=!1,e.lineDecorationsWidth=20,e.rulers=[],e.folding=!1,e.scrollBeyondLastLine=!1,e.renderLineHighlight="none",e.minimap={enabled:!1},e.renderValidationDecorations="editable",e.padding=void 0,e.readOnly=!0,e.domReadOnly=!0,e.unicodeHighlight={nonBasicASCII:!1,invisibleCharacters:!1,ambiguousCharacters:!1};const t=this.configurationService.getValue("[Log]");return t&&(t["editor.minimap.enabled"]&&(e.minimap={enabled:!0}),"editor.wordWrap"in t&&(e.wordWrap=t["editor.wordWrap"])),e}getAriaLabel(){return this.input?this.input.getAriaLabel():p("outputViewAriaLabel","Output panel")}async setInput(e,t,i,n){const s=!(t&&t.preserveFocus);this.input&&e.matches(this.input)||(this.input&&this.input.dispose(),await super.setInput(e,t,i,n),this.resourceContext.set(e.resource),s&&this.focus(),this.revealLastLine())}clearInput(){this.input&&this.input.dispose(),super.clearInput(),this.resourceContext.reset()}createEditor(e){e.setAttribute("role","document"),super.createEditor(e);const t=this.scopedContextKeyService;t&&z3.bindTo(t).set(!0)}};_F=T([v(0,gi),v(1,Te),v(2,ri),v(3,We),v(4,Do),v(5,Fi),v(6,it),v(7,Ke),v(8,at),v(9,It)],_F);T7((r,e)=>{const t=r.getColor(Gx);t&&t!==r.getColor(jn)&&e.addRule(`
			.monaco-workbench .part.sidebar .output-view .monaco-editor,
			.monaco-workbench .part.sidebar .output-view .monaco-editor .margin,
			.monaco-workbench .part.sidebar .output-view .monaco-editor .monaco-editor-background {
				background-color: ${t};
			}
		`)});let Im=class y8 extends du{get typeId(){return y8.ID}constructor(e,t,i,n,s,o,a){super(k.from({scheme:h$,path:e.id}),Yn(e.file.path),_h(e.file.path),void 0,void 0,t,i,n,s,o,a)}};Im.ID="workbench.editorinputs.output";Im=T([v(1,or),v(2,Dn),v(3,Ke),v(4,at),v(5,Qi),v(6,qr)],Im);let mw=class _8 extends fw{constructor(e,t,i,n,s,o,a,c){super(_8.LOG_VIEWER_EDITOR_ID,e,t,i,n,s,o,a,c)}getConfigurationOverrides(){const e=super.getConfigurationOverrides();return e.wordWrap="off",e.folding=!1,e.scrollBeyondLastLine=!1,e.renderValidationDecorations="editable",e}getAriaLabel(){return p("logViewerAriaLabel","Log viewer")}};mw.LOG_VIEWER_EDITOR_ID="workbench.editors.logViewer";mw=T([v(0,gi),v(1,Te),v(2,ri),v(3,Do),v(4,Fi),v(5,it),v(6,Ke),v(7,at)],mw);class aOe{constructor(e){this.identifier=e}}class cOe{constructor(e){this.identifier=e}}async function dOe(r){var i;const e=[],t=wg.uriList.toLowerCase();if(r.has(t))try{const n=await((i=r.get(t))==null?void 0:i.asString()),s=JSON.stringify(Jy.parse(n??""));e.push(...L7(s))}catch{}return e}let Kx=class{constructor(e,t,i,n,s,o,a,c){this.options=e,this.fileService=t,this.workspacesService=i,this.editorService=n,this.workspaceEditingService=s,this.hostService=o,this.contextService=a,this.instantiationService=c}async handleDrop(e,t,i,n){const s=await this.instantiationService.invokeFunction(c=>oG(c,e));if(!s.length)return;if(await this.hostService.focus(),this.options.allowWorkspaceOpen){const c=fi(s.filter(d=>{var l;return d.allowWorkspaceOpen&&((l=d.resource)==null?void 0:l.scheme)===pe.file}).map(d=>d.resource));if(c.length>0&&await this.handleWorkspaceDrop(c))return}const o=fi(s.filter(c=>{var d;return c.isExternal&&((d=c.resource)==null?void 0:d.scheme)===pe.file}).map(c=>c.resource));o.length&&this.workspacesService.addRecentlyOpened(o.map(c=>({fileUri:c})));const a=t();await this.editorService.openEditors(s.map(c=>({...c,resource:c.resource,options:{...c.options,pinned:!0,index:n}})),a,{validateTrust:!0}),i(a)}async handleWorkspaceDrop(e){const t=[],i=[];return await Promise.all(e.map(async n=>{if(I7(n)){t.push({workspaceUri:n});return}try{const s=await this.fileService.stat(n);s.isDirectory&&(t.push({folderUri:s.resource}),i.push({uri:s.resource}))}catch{}})),t.length===0?!1:(this.hostService.focus(),t.length>i.length||i.length===1?await this.hostService.openWindow(t):r1(this.contextService.getWorkspace())?await this.workspaceEditingService.addFolders(i):await this.workspaceEditingService.createAndEnterWorkspace(i),!0)}};Kx=T([v(1,at),v(2,c$),v(3,Ke),v(4,Zm),v(5,bu),v(6,oi),v(7,Te)],Kx);function Y$(r,e,t){var m;if(e.length===0||!t.dataTransfer)return;const i=r.get(Dn),n=r.get(Ke),s=r.get(at),o=r.get(Qi),a=fi(e.map(y=>k.isUri(y)?{resource:y}:DM(y)?k.isUri(y.editor.resource)?{resource:y.editor.resource}:void 0:y)),c=a.filter(({resource:y})=>s.hasProvider(y)),d=wa?`\r
`:`
`;t.dataTransfer.setData(ml.TEXT,c.map(({resource:y})=>o.getUriLabel(y,{noPrefix:!0})).join(d));const l=c.find(({isDirectory:y})=>!y);if(l){const y=wh.uriToFileUri(l.resource);y.scheme===pe.file&&t.dataTransfer.setData(ml.DOWNLOAD_URL,[wg.binary,Mt(l.resource),y.toString()].join(":"))}const u=c.filter(({isDirectory:y})=>!y);u.length&&t.dataTransfer.setData(ml.RESOURCES,JSON.stringify(u.map(({resource:y})=>y.toString())));const h=st.as(R7.DragAndDropContribution).getAll();for(const y of h)y.setData(a,t);const g=[];for(const y of e){let _;if(DM(y)){const b=y.editor.toUntyped({preserveViewState:y.groupId});b&&(_={...b,resource:Vn.getCanonicalUri(b)})}else if(k.isUri(y)){const{selection:b,uri:E}=P7(y);_={resource:E,options:b?{selection:b}:void 0}}else y.isDirectory||(_={resource:y.resource});if(_){{const b=_.resource;if(b){const E=i.files.get(b);E&&(typeof _.languageId!="string"&&(_.languageId=E.getLanguageId()),typeof _.encoding!="string"&&(_.encoding=E.getEncoding()),typeof _.contents!="string"&&E.isDirty()&&(_.contents=E.textEditorModel.getValue())),(m=_.options)!=null&&m.viewState||(_.options={..._.options,viewState:(()=>{for(const D of n.visibleEditorPanes)if(si(D.input.resource,b)){const R=D.getViewState();if(R)return R}})()})}}g.push(_)}}if(g.length){t.dataTransfer.setData(IC.EDITORS,A7(g));const y=[];for(const _ of g)_.resource?y.push(_.resource):va(_)?_.modified.resource&&y.push(_.modified.resource):td(_)?_.primary.resource&&y.push(_.primary.resource):hc(_)&&y.push(_.result.resource);t.dataTransfer.setData(wg.uriList,Jy.create(y.slice(0,1))),t.dataTransfer.setData(ml.INTERNAL_URI_LIST,Jy.create(y))}}class fme{constructor(e,t){this.type=e,this.id=t}update(e){}getData(){return{type:this.type,id:this.id}}}class Fv{constructor(e){this.compositeId=e}get id(){return this.compositeId}}class Ov{constructor(e){this.viewId=e}get id(){return this.viewId}}class Pl extends ne{static get INSTANCE(){return Pl.instance||(Pl.instance=new Pl),Pl.instance}constructor(){super(),this.transferData=M7.getInstance(),this.onDragStart=this._register(new A),this.onDragEnd=this._register(new A),this._register(this.onDragEnd.event(e=>{const t=e.dragAndDropData.getData().id,i=e.dragAndDropData.getData().type,n=this.readDragData(i);(n==null?void 0:n.getData().id)===t&&this.transferData.clearData(i==="view"?Ov.prototype:Fv.prototype)}))}readDragData(e){if(this.transferData.hasData(e==="view"?Ov.prototype:Fv.prototype)){const t=this.transferData.getData(e==="view"?Ov.prototype:Fv.prototype);if(t&&t[0])return new fme(e,t[0].id)}}writeDragData(e,t){this.transferData.setData([t==="view"?new Ov(e):new Fv(e)],t==="view"?Ov.prototype:Fv.prototype)}registerTarget(e,t){const i=new me;return i.add(new RC(e,{onDragEnd:n=>{},onDragEnter:n=>{if(n.preventDefault(),t.onDragEnter){const s=this.readDragData("composite")||this.readDragData("view");s&&t.onDragEnter({eventData:n,dragAndDropData:s})}},onDragLeave:n=>{const s=this.readDragData("composite")||this.readDragData("view");t.onDragLeave&&s&&t.onDragLeave({eventData:n,dragAndDropData:s})},onDrop:n=>{if(t.onDrop){const s=this.readDragData("composite")||this.readDragData("view");if(!s)return;t.onDrop({eventData:n,dragAndDropData:s}),this.onDragEnd.fire({eventData:n,dragAndDropData:s})}},onDragOver:n=>{if(n.preventDefault(),t.onDragOver){const s=this.readDragData("composite")||this.readDragData("view");if(!s)return;t.onDragOver({eventData:n,dragAndDropData:s})}}})),t.onDragStart&&this.onDragStart.event(n=>{t.onDragStart(n)},this,i),t.onDragEnd&&this.onDragEnd.event(n=>{t.onDragEnd(n)}),this._register(i)}registerDraggable(e,t,i){e.draggable=!0;const n=new me;return n.add(Ci(e,sn.DRAG_START,s=>{var c;const{id:o,type:a}=t();this.writeDragData(o,a),(c=s.dataTransfer)==null||c.setDragImage(e,0,0),this.onDragStart.fire({eventData:s,dragAndDropData:this.readDragData(a)})})),n.add(new RC(e,{onDragEnd:s=>{const{type:o}=t(),a=this.readDragData(o);a&&this.onDragEnd.fire({eventData:s,dragAndDropData:a})},onDragEnter:s=>{if(i.onDragEnter){const o=this.readDragData("composite")||this.readDragData("view");if(!o)return;o&&i.onDragEnter({eventData:s,dragAndDropData:o})}},onDragLeave:s=>{var a;const o=this.readDragData("composite")||this.readDragData("view");o&&((a=i.onDragLeave)==null||a.call(i,{eventData:s,dragAndDropData:o}))},onDrop:s=>{if(i.onDrop){const o=this.readDragData("composite")||this.readDragData("view");if(!o)return;i.onDrop({eventData:s,dragAndDropData:o}),this.onDragEnd.fire({eventData:s,dragAndDropData:o})}},onDragOver:s=>{if(i.onDragOver){const o=this.readDragData("composite")||this.readDragData("view");if(!o)return;i.onDragOver({eventData:s,dragAndDropData:o})}}})),i.onDragStart&&this.onDragStart.event(s=>{i.onDragStart(s)},this,n),i.onDragEnd&&this.onDragEnd.event(s=>{i.onDragEnd(s)},this,n),this._register(n)}}function OU(r,e,t){r&&(r.dropEffect=t?e:"none")}let NU=class{constructor(e,t){this.toResource=e,this.instantiationService=t}getDragURI(e){const t=this.toResource(e);return t?t.toString():null}getDragLabel(e){const t=fi(e.map(this.toResource));return t.length===1?Mt(t[0]):t.length>1?String(t.length):void 0}onDragStart(e,t){const i=[];for(const n of e.elements){const s=this.toResource(n);s&&i.push(s)}i.length&&this.instantiationService.invokeFunction(n=>Y$(n,i,t))}onDragOver(e,t,i,n){return!1}drop(e,t,i,n){}};NU=T([v(1,Te)],NU);const pme=new Ee("Views");Un.appendMenuItem(Ee.ViewContainerTitle,{submenu:pme,title:p("views","Views"),order:1,when:nt.equals("viewContainerLocation",j_(0))});const zD=class zD extends Rq{get currentDropOperation(){return this._currentDropOperation}constructor(e,t,i,n,s){super(s),this.paneElement=e,this.orientation=t,this.bounds=i,this.location=n,this.cleanupOverlayScheduler=this._register(new Ys(()=>this.dispose(),300)),this.create()}get disposed(){return!!this._disposed}create(){this.container=document.createElement("div"),this.container.id=zD.OVERLAY_ID,this.container.style.top="0px",this.paneElement.appendChild(this.container),this.paneElement.classList.add("dragged-over"),this._register(ot(()=>{this.paneElement.removeChild(this.container),this.paneElement.classList.remove("dragged-over")})),this.overlay=document.createElement("div"),this.overlay.classList.add("pane-overlay-indicator"),this.container.appendChild(this.overlay),this.registerListeners(),this.updateStyles()}updateStyles(){this.overlay.style.backgroundColor=this.getColor(this.location===1?h8:f8)||"";const e=this.getColor(DC);this.overlay.style.outlineColor=e||"",this.overlay.style.outlineOffset=e?"-2px":"",this.overlay.style.outlineStyle=e?"dashed":"",this.overlay.style.outlineWidth=e?"2px":"",this.overlay.style.borderColor=e||"",this.overlay.style.borderStyle="solid",this.overlay.style.borderWidth="0px"}registerListeners(){this._register(new RC(this.container,{onDragEnter:e=>{},onDragOver:e=>{this.positionOverlay(e.offsetX,e.offsetY),this.cleanupOverlayScheduler.isScheduled()&&this.cleanupOverlayScheduler.cancel()},onDragLeave:e=>this.dispose(),onDragEnd:e=>this.dispose(),onDrop:e=>{this.dispose()}})),this._register(Ci(this.container,sn.MOUSE_OVER,()=>{this.cleanupOverlayScheduler.isScheduled()||this.cleanupOverlayScheduler.schedule()}))}positionOverlay(e,t){const i=this.paneElement.clientWidth,n=this.paneElement.clientHeight,s=i/2,o=n/2;let a;switch(this.orientation===0?t<o?a=0:t>=o&&(a=1):this.orientation===1&&(e<s?a=2:e>=s&&(a=3)),a){case 0:this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"50%"});break;case 1:this.doPositionOverlay({bottom:"0",left:"0",width:"100%",height:"50%"});break;case 2:this.doPositionOverlay({top:"0",left:"0",width:"50%",height:"100%"});break;case 3:this.doPositionOverlay({top:"0",right:"0",width:"50%",height:"100%"});break;default:{let c="0",d="0",l="100%",u="100%";if(this.bounds){const h=this.container.getBoundingClientRect();c=`${this.bounds.top-h.top}px`,d=`${this.bounds.left-h.left}px`,u=`${this.bounds.bottom-this.bounds.top}px`,l=`${this.bounds.right-this.bounds.left}px`}this.doPositionOverlay({top:c,left:d,width:l,height:u})}}this.orientation===0&&n<=25||this.orientation===1&&i<=25?this.doUpdateOverlayBorder(a):this.doUpdateOverlayBorder(void 0),this.overlay.style.opacity="1",setTimeout(()=>this.overlay.classList.add("overlay-move-transition"),0),this._currentDropOperation=a}doUpdateOverlayBorder(e){this.overlay.style.borderTopWidth=e===0?"2px":"0px",this.overlay.style.borderLeftWidth=e===2?"2px":"0px",this.overlay.style.borderBottomWidth=e===1?"2px":"0px",this.overlay.style.borderRightWidth=e===3?"2px":"0px"}doPositionOverlay(e){this.container.style.height="100%",this.overlay.style.top=e.top||"",this.overlay.style.left=e.left||"",this.overlay.style.bottom=e.bottom||"",this.overlay.style.right=e.right||"",this.overlay.style.width=e.width,this.overlay.style.height=e.height}contains(e){return e===this.container||e===this.overlay}dispose(){super.dispose(),this._disposed=!0}};mi(zD,"OVERLAY_ID","monaco-pane-drop-overlay");let Xp=zD,wF=class extends zx{constructor(e,t,i,n,s){const o=n.createScoped(e);o.createKey("viewContainer",t.id);const a=o.createKey("viewContainerLocation",j_(i.getViewContainerLocation(t)));super(Ee.ViewContainerTitle,Ee.ViewContainerTitleContext,{shouldForwardArgs:!0},o,s),this._register(o),this._register(F.filter(i.onDidChangeContainerLocation,c=>c.viewContainer===t)(()=>a.set(j_(i.getViewContainerLocation(t)))))}};wF=T([v(2,to),v(3,It),v(4,ib)],wF);let vw=class extends k4{get onDidSashChange(){return Mi(this.paneview).onDidSashChange}get panes(){return this.paneItems.map(e=>e.pane)}get views(){return this.panes}get length(){return this.paneItems.length}get menuActions(){return this._menuActions}constructor(e,t,i,n,s,o,a,c,d,l,u,h){super(e,d,l),this.options=t,this.instantiationService=i,this.configurationService=n,this.layoutService=s,this.contextMenuService=o,this.telemetryService=a,this.extensionService=c,this.storageService=l,this.contextService=u,this.viewDescriptorService=h,this.paneItems=[],this.visible=!1,this.areExtensionsReady=!1,this.didLayout=!1,this.viewDisposables=[],this._onTitleAreaUpdate=this._register(new A),this.onTitleAreaUpdate=this._onTitleAreaUpdate.event,this._onDidChangeVisibility=this._register(new A),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._onDidAddViews=this._register(new A),this.onDidAddViews=this._onDidAddViews.event,this._onDidRemoveViews=this._register(new A),this.onDidRemoveViews=this._onDidRemoveViews.event,this._onDidChangeViewVisibility=this._register(new A),this.onDidChangeViewVisibility=this._onDidChangeViewVisibility.event,this._onDidFocusView=this._register(new A),this.onDidFocusView=this._onDidFocusView.event,this._onDidBlurView=this._register(new A),this.onDidBlurView=this._onDidBlurView.event;const g=this.viewDescriptorService.getViewContainerById(e);if(!g)throw new Error("Could not find container");this.viewContainer=g,this.visibleViewsStorageId=`${e}.numberOfVisibleViews`,this.visibleViewsCountFromCache=this.storageService.getNumber(this.visibleViewsStorageId,1,void 0),this._register(ot(()=>this.viewDisposables=vt(this.viewDisposables))),this.viewContainerModel=this.viewDescriptorService.getViewContainerModel(g)}create(e){const t=this.options;t.orientation=this.orientation,this.paneview=this._register(new tme(e,this.options)),this._boundarySashes&&this.paneview.setBoundarySashes(this._boundarySashes),this._register(this.paneview.onDidDrop(({from:c,to:d})=>this.movePane(c,d))),this._register(this.paneview.onDidScroll(c=>this.onDidScrollPane())),this._register(this.paneview.onDidSashReset(c=>this.onDidSashReset(c))),this._register(Ci(e,sn.CONTEXT_MENU,c=>this.showContextMenu(new $I(c)))),this._register(Qq.addTarget(e)),this._register(Ci(e,Yq.Contextmenu,c=>this.showContextMenu(new $I(c)))),this._menuActions=this._register(this.instantiationService.createInstance(wF,this.paneview.element,this.viewContainer)),this._register(this._menuActions.onDidChange(()=>this.updateTitleArea()));let i;const n=()=>{const c=e.getBoundingClientRect(),d=this.panes[this.panes.length-1].element.getBoundingClientRect(),l=this.orientation===0?d.bottom:c.top,u=this.orientation===1?d.right:c.left;return{top:l,bottom:c.bottom,left:u,right:c.right}},s=(c,d)=>d.x>=c.left&&d.x<=c.right&&d.y>=c.top&&d.y<=c.bottom;let o;this._register(Pl.INSTANCE.registerTarget(e,{onDragEnter:c=>{if(o=n(),i&&i.disposed&&(i=void 0),!i&&s(o,c.eventData)){const d=c.dragAndDropData.getData();if(d.type==="view"){const l=this.viewDescriptorService.getViewContainerByViewId(d.id),u=this.viewDescriptorService.getViewDescriptorById(d.id);if(l!==this.viewContainer&&(!u||!u.canMoveView||this.viewContainer.rejectAddedViews))return;i=new Xp(e,void 0,o,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService)}if(d.type==="composite"&&d.id!==this.viewContainer.id){const l=this.viewDescriptorService.getViewContainerById(d.id),u=this.viewDescriptorService.getViewContainerModel(l).allViewDescriptors;!u.some(h=>!h.canMoveView)&&u.length>0&&(i=new Xp(e,void 0,o,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService))}}},onDragOver:c=>{i&&i.disposed&&(i=void 0),i&&!s(o,c.eventData)&&(i.dispose(),i=void 0),s(o,c.eventData)&&OU(c.eventData.dataTransfer,"move",i!==void 0)},onDragLeave:c=>{i==null||i.dispose(),i=void 0},onDrop:c=>{if(i){const d=c.dragAndDropData.getData(),l=[];if(d.type==="composite"&&d.id!==this.viewContainer.id){const h=this.viewDescriptorService.getViewContainerById(d.id),g=this.viewDescriptorService.getViewContainerModel(h).allViewDescriptors;g.some(m=>!m.canMoveView)||l.push(...g)}else if(d.type==="view"){const h=this.viewDescriptorService.getViewContainerByViewId(d.id),g=this.viewDescriptorService.getViewDescriptorById(d.id);h!==this.viewContainer&&g&&g.canMoveView&&this.viewDescriptorService.moveViewsToContainer([g],this.viewContainer)}const u=this.panes.length;if(l.length>0&&this.viewDescriptorService.moveViewsToContainer(l,this.viewContainer),u>0)for(const h of l){const g=this.panes.find(m=>m.id===h.id);g&&this.movePane(g,this.panes[this.panes.length-1])}}i==null||i.dispose(),i=void 0}})),this._register(this.onDidSashChange(()=>this.saveViewSizes())),this._register(this.viewContainerModel.onDidAddVisibleViewDescriptors(c=>this.onDidAddViewDescriptors(c))),this._register(this.viewContainerModel.onDidRemoveVisibleViewDescriptors(c=>this.onDidRemoveViewDescriptors(c)));const a=this.viewContainerModel.visibleViewDescriptors.map((c,d)=>{const l=this.viewContainerModel.getSize(c.id),u=this.viewContainerModel.isCollapsed(c.id);return{viewDescriptor:c,index:d,size:l,collapsed:u}});a.length&&this.onDidAddViewDescriptors(a),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this.areExtensionsReady=!0,this.panes.length&&(this.updateTitleArea(),this.updateViewHeaders())}),this._register(this.viewContainerModel.onDidChangeActiveViewDescriptors(()=>this._onTitleAreaUpdate.fire()))}getTitle(){const e=this.viewContainerModel.title;if(this.isViewMergedWithContainer()){const t=this.paneItems[0].pane.title;return e===t?this.paneItems[0].pane.title:t?`${e}: ${t}`:e}return e}showContextMenu(e){for(const i of this.paneItems)if(aG(e.target,i.pane.element))return;e.stopPropagation(),e.preventDefault();const t={x:e.posx,y:e.posy};this.contextMenuService.showContextMenu({getAnchor:()=>t,getActions:()=>{var i;return((i=this.menuActions)==null?void 0:i.getContextMenuActions())??[]}})}getActionsContext(){}getActionViewItem(e){return this.isViewMergedWithContainer()?this.paneItems[0].pane.getActionViewItem(e):n1(this.instantiationService,e)}focus(){if(this.lastFocusedPane)this.lastFocusedPane.focus();else if(this.paneItems.length>0){for(const{pane:e}of this.paneItems)if(e.isExpanded()){e.focus();return}}}get orientation(){switch(this.viewDescriptorService.getViewContainerLocation(this.viewContainer)){case 0:case 2:return 0;case 1:return this.layoutService.getPanelPosition()===2?1:0}return 0}layout(e){this.paneview&&(this.paneview.orientation!==this.orientation&&this.paneview.flipOrientation(e.height,e.width),this.paneview.layout(e.height,e.width)),this.dimension=e,this.didLayout?this.saveViewSizes():(this.didLayout=!0,this.restoreViewSizes())}setBoundarySashes(e){var t;this._boundarySashes=e,(t=this.paneview)==null||t.setBoundarySashes(e)}getOptimalWidth(){return Math.max(...this.panes.map(i=>i.getOptimalWidth()||0))+16}addPanes(e){const t=this.isViewMergedWithContainer();for(const{pane:i,size:n,index:s}of e)this.addPane(i,n,s);this.updateViewHeaders(),this.isViewMergedWithContainer()!==t&&this.updateTitleArea(),this._onDidAddViews.fire(e.map(({pane:i})=>i))}setVisible(e){this.visible!==!!e&&(this.visible=e,this._onDidChangeVisibility.fire(e)),this.panes.filter(t=>t.isVisible()!==e).forEach(t=>t.setVisible(e))}isVisible(){return this.visible}updateTitleArea(){this._onTitleAreaUpdate.fire()}createView(e,t){return this.instantiationService.createInstance(e.ctorDescriptor.ctor,...e.ctorDescriptor.staticArguments||[],t)}getView(e){return this.panes.filter(t=>t.id===e)[0]}saveViewSizes(){this.didLayout&&this.viewContainerModel.setSizes(this.panes.map(e=>({id:e.id,size:this.getPaneSize(e)})))}restoreViewSizes(){if(this.didLayout){let e;for(let t=0;t<this.viewContainerModel.visibleViewDescriptors.length;t++){const i=this.panes[t],n=this.viewContainerModel.visibleViewDescriptors[t],s=this.viewContainerModel.getSize(n.id);typeof s=="number"?this.resizePane(i,s):(e=e||this.computeInitialSizes(),this.resizePane(i,e.get(i.id)||200))}}}computeInitialSizes(){const e=new Map;if(this.dimension){const t=this.viewContainerModel.visibleViewDescriptors.reduce((i,{weight:n})=>i+(n||20),0);for(const i of this.viewContainerModel.visibleViewDescriptors)this.orientation===0?e.set(i.id,this.dimension.height*(i.weight||20)/t):e.set(i.id,this.dimension.width*(i.weight||20)/t)}return e}saveState(){this.panes.forEach(e=>e.saveState()),this.storageService.store(this.visibleViewsStorageId,this.length,1,1)}onContextMenu(e,t){e.stopPropagation(),e.preventDefault();const i=t.menuActions.getContextMenuActions(),n={x:e.posx,y:e.posy};this.contextMenuService.showContextMenu({getAnchor:()=>n,getActions:()=>i})}openView(e,t){let i=this.getView(e);return i||this.toggleViewVisibility(e),i=this.getView(e),i&&(i.setExpanded(!0),t&&i.focus()),i}onDidAddViewDescriptors(e){const t=[];for(const{viewDescriptor:n,collapsed:s,index:o,size:a}of e){const c=this.createView(n,{id:n.id,title:n.name,fromExtensionId:n.extensionId,expanded:!s});c.render();const d=Ci(c.draggableElement,"contextmenu",u=>{u.stopPropagation(),u.preventDefault(),this.onContextMenu(new $I(u),c)}),l=F.latch(F.map(c.onDidChange,()=>!c.isExpanded()))(u=>{this.viewContainerModel.setCollapsed(n.id,u)});this.viewDisposables.splice(o,0,Da(d,l)),t.push({pane:c,size:a||c.minimumSize,index:o})}this.addPanes(t),this.restoreViewSizes();const i=[];for(const{pane:n}of t)n.setVisible(this.isVisible()),i.push(n);return i}onDidRemoveViewDescriptors(e){e=e.sort((i,n)=>n.index-i.index);const t=[];for(const{index:i}of e){const[n]=this.viewDisposables.splice(i,1);n.dispose(),t.push(this.panes[i])}this.removePanes(t);for(const i of t)i.setVisible(!1)}toggleViewVisibility(e){if(this.viewContainerModel.activeViewDescriptors.some(t=>t.id===e)){const t=!this.viewContainerModel.isVisible(e);this.viewContainerModel.setVisible(e,t)}}addPane(e,t,i=this.paneItems.length-1){const n=e.onDidFocus(()=>{this._onDidFocusView.fire(e),this.lastFocusedPane=e}),s=e.onDidBlur(()=>this._onDidBlurView.fire(e)),o=e.onDidChangeTitleArea(()=>{this.isViewMergedWithContainer()&&this.updateTitleArea()}),a=e.onDidChangeBodyVisibility(()=>this._onDidChangeViewVisibility.fire(e)),c=e.onDidChange(()=>{e===this.lastFocusedPane&&!e.isExpanded()&&(this.lastFocusedPane=void 0)}),d=this.viewDescriptorService.getViewContainerLocation(this.viewContainer)===1;e.style({headerForeground:es(d?Kge:Jge),headerBackground:es(d?zge:Xge),headerBorder:es(d?Qge:Zge),dropBackground:es(d?h8:f8),leftBorder:d?es(Yge):void 0});const l=Da(e,n,s,o,c,a),u={pane:e,disposable:l};this.paneItems.splice(i,0,u),Mi(this.paneview).addPane(e,t,i);let h;this._register(Pl.INSTANCE.registerDraggable(e.draggableElement,()=>({type:"view",id:e.id}),{})),this._register(Pl.INSTANCE.registerTarget(e.dropTargetElement,{onDragEnter:g=>{if(!h){const m=g.dragAndDropData.getData();if(m.type==="view"&&m.id!==e.id){const y=this.viewDescriptorService.getViewContainerByViewId(m.id),_=this.viewDescriptorService.getViewDescriptorById(m.id);if(y!==this.viewContainer&&(!_||!_.canMoveView||this.viewContainer.rejectAddedViews))return;h=new Xp(e.dropTargetElement,this.orientation??0,void 0,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService)}if(m.type==="composite"&&m.id!==this.viewContainer.id&&!this.viewContainer.rejectAddedViews){const y=this.viewDescriptorService.getViewContainerById(m.id),_=this.viewDescriptorService.getViewContainerModel(y).allViewDescriptors;!_.some(b=>!b.canMoveView)&&_.length>0&&(h=new Xp(e.dropTargetElement,this.orientation??0,void 0,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService))}}},onDragOver:g=>{OU(g.eventData.dataTransfer,"move",h!==void 0)},onDragLeave:g=>{h==null||h.dispose(),h=void 0},onDrop:g=>{if(h){const m=g.dragAndDropData.getData(),y=[];let _;if(m.type==="composite"&&m.id!==this.viewContainer.id&&!this.viewContainer.rejectAddedViews){const b=this.viewDescriptorService.getViewContainerById(m.id),E=this.viewDescriptorService.getViewContainerModel(b).allViewDescriptors;E.length>0&&!E.some(D=>!D.canMoveView)&&(y.push(...E),_=E[0])}else if(m.type==="view"){const b=this.viewDescriptorService.getViewContainerByViewId(m.id),E=this.viewDescriptorService.getViewDescriptorById(m.id);b!==this.viewContainer&&E&&E.canMoveView&&!this.viewContainer.rejectAddedViews&&y.push(E),E&&(_=E)}if(y&&this.viewDescriptorService.moveViewsToContainer(y,this.viewContainer),_){if(h.currentDropOperation===1||h.currentDropOperation===3){const b=this.panes.findIndex(D=>D.id===_.id);let E=this.panes.findIndex(D=>D.id===e.id);b>=0&&E>=0&&(b>E&&E++,E<this.panes.length&&E!==b&&this.movePane(this.panes[b],this.panes[E]))}if(h.currentDropOperation===0||h.currentDropOperation===2){const b=this.panes.findIndex(D=>D.id===_.id);let E=this.panes.findIndex(D=>D.id===e.id);b>=0&&E>=0&&(b<E&&E--,E>=0&&E!==b&&this.movePane(this.panes[b],this.panes[E]))}y.length>1&&y.slice(1).forEach(b=>{let E=this.panes.findIndex(R=>R.id===_.id);const D=this.panes.findIndex(R=>R.id===b.id);D>=0&&E>=0&&(D>E&&E++,E<this.panes.length&&E!==D&&(this.movePane(this.panes[D],this.panes[E]),_=b))})}}h==null||h.dispose(),h=void 0}}))}removePanes(e){const t=this.isViewMergedWithContainer();e.forEach(i=>this.removePane(i)),this.updateViewHeaders(),t!==this.isViewMergedWithContainer()&&this.updateTitleArea(),this._onDidRemoveViews.fire(e)}removePane(e){const t=this.paneItems.findIndex(n=>n.pane===e);if(t===-1)return;this.lastFocusedPane===e&&(this.lastFocusedPane=void 0),Mi(this.paneview).removePane(e);const[i]=this.paneItems.splice(t,1);i.disposable.dispose()}movePane(e,t){const i=this.paneItems.findIndex(c=>c.pane===e),n=this.paneItems.findIndex(c=>c.pane===t),s=this.viewContainerModel.visibleViewDescriptors[i],o=this.viewContainerModel.visibleViewDescriptors[n];if(i<0||i>=this.paneItems.length||n<0||n>=this.paneItems.length)return;const[a]=this.paneItems.splice(i,1);this.paneItems.splice(n,0,a),Mi(this.paneview).movePane(e,t),this.viewContainerModel.move(s.id,o.id),this.updateTitleArea()}resizePane(e,t){Mi(this.paneview).resizePane(e,t)}getPaneSize(e){return Mi(this.paneview).getPaneSize(e)}updateViewHeaders(){this.isViewMergedWithContainer()?(this.paneItems[0].pane.isExpanded()?this.lastMergedCollapsedPane=void 0:(this.lastMergedCollapsedPane=this.paneItems[0].pane,this.paneItems[0].pane.setExpanded(!0)),this.paneItems[0].pane.headerVisible=!1):(this.paneItems.forEach(e=>{e.pane.headerVisible=!0,e.pane===this.lastMergedCollapsedPane&&e.pane.setExpanded(!1)}),this.lastMergedCollapsedPane=void 0)}isViewMergedWithContainer(){return this.options.mergeViewWithContainerWhenSingleView&&this.paneItems.length===1?this.areExtensionsReady?!0:this.visibleViewsCountFromCache===void 0?this.paneItems[0].pane.isExpanded():this.visibleViewsCountFromCache===1:!1}onDidScrollPane(){for(const e of this.panes)e.onDidScrollRoot()}onDidSashReset(e){var n,s,o,a;let t,i;for(let c=e;c>=0;c--)if((n=this.paneItems[c].pane)!=null&&n.isVisible()&&((s=this.paneItems[c])!=null&&s.pane.isExpanded())){t=this.paneItems[c].pane;break}for(let c=e+1;c<this.paneItems.length;c++)if((o=this.paneItems[c].pane)!=null&&o.isVisible()&&((a=this.paneItems[c])!=null&&a.pane.isExpanded())){i=this.paneItems[c].pane;break}if(t&&i){const c=this.getPaneSize(t),d=this.getPaneSize(i),l=Math.ceil((c+d)/2),u=Math.floor((c+d)/2);c>d?(this.resizePane(t,l),this.resizePane(i,u)):(this.resizePane(i,u),this.resizePane(t,l))}}dispose(){super.dispose(),this.paneItems.forEach(e=>e.disposable.dispose()),this.paneview&&this.paneview.dispose()}};vw=T([v(2,Te),v(3,We),v(4,Kf),v(5,eo),v(6,gi),v(7,yr),v(8,Fi),v(9,ri),v(10,oi),v(11,to)],vw);class pOe extends Le{constructor(e){super(e),this.desc=e}run(e,...t){const i=e.get(ko).getActiveViewPaneContainerWithId(this.desc.viewPaneContainerId);if(i)return this.runInViewPaneContainer(e,i,...t)}}class uI extends Le{constructor(e,t){super(e),this.offset=t}async run(e){const t=e.get(to),i=e.get(It),n=nv.getValue(i);if(n===void 0)return;const s=t.getViewContainerByViewId(n),o=t.getViewContainerModel(s),a=o.visibleViewDescriptors.find(l=>l.id===n),c=o.visibleViewDescriptors.indexOf(a);if(c+this.offset<0||c+this.offset>=o.visibleViewDescriptors.length)return;const d=o.visibleViewDescriptors[c+this.offset];o.move(a.id,d.id)}}Nt(class extends uI{constructor(){super({id:"views.moveViewUp",title:p("viewMoveUp","Move View Up"),keybinding:{primary:Bt(2048+41,16),weight:200+1,when:nv.notEqualsTo("")}},-1)}});Nt(class extends uI{constructor(){super({id:"views.moveViewLeft",title:p("viewMoveLeft","Move View Left"),keybinding:{primary:Bt(2048+41,15),weight:200+1,when:nv.notEqualsTo("")}},-1)}});Nt(class extends uI{constructor(){super({id:"views.moveViewDown",title:p("viewMoveDown","Move View Down"),keybinding:{primary:Bt(2048+41,18),weight:200+1,when:nv.notEqualsTo("")}},1)}});Nt(class extends uI{constructor(){super({id:"views.moveViewRight",title:p("viewMoveRight","Move View Right"),keybinding:{primary:Bt(2048+41,17),weight:200+1,when:nv.notEqualsTo("")}},1)}});Nt(class extends Le{constructor(){super({id:"vscode.moveViews",title:p("viewsMove","Move Views")})}async run(e,t){if(!Array.isArray(t==null?void 0:t.viewIds)||typeof(t==null?void 0:t.destinationId)!="string")return Promise.reject("Invalid arguments");const i=e.get(to),n=i.getViewContainerById(t.destinationId);if(n){for(const s of t.viewIds){const o=i.getViewDescriptorById(s);o!=null&&o.canMoveView&&i.moveViewsToContainer([o],n,AM.Default)}await e.get(ko).openViewContainer(n.id,!0)}}});cG.registerLanguage({id:q3,extensions:[],mimetypes:[l$]});cG.registerLanguage({id:G3,extensions:[],mimetypes:[u$]});const w8=Tc("output-view-icon",jt.output,p("outputViewIcon","View icon of the output view.")),gme=st.as(Xo.ViewContainersRegistry).registerViewContainer({id:Xn,title:p("output","Output"),icon:w8,order:1,ctorDescriptor:new er(vw,[Xn,{mergeViewWithContainerWhenSingleView:!0}]),storageId:Xn,hideIfEmpty:!0},1,{doNotRegisterOpenCommand:!0});st.as(Xo.ViewsRegistry).registerViews([{id:Xn,name:p("output","Output"),containerIcon:w8,canMoveView:!0,canToggleVisibility:!1,ctorDescriptor:new er(yF),openCommandActionDescriptor:{id:"workbench.action.output.toggleOutput",mnemonicTitle:p({key:"miToggleOutput",comment:["&& denotes a mnemonic"]},"&&Output"),keybindings:{primary:3123,linux:{primary:Bt(2089,2086)}},order:1}}],gme);st.as(au.EditorPane).registerEditorPane(z$.create(mw,mw.LOG_VIEWER_EDITOR_ID,p("logViewer","Log Viewer")),[new er(Im)]);let bF=class extends ne{constructor(e,t,i){super(),this.outputService=i,t.registerTextModelContentProvider(h$,e.createInstance(s0)),this.registerActions()}registerActions(){this.registerSwitchOutputAction(),this.registerShowOutputChannelsAction(),this.registerClearOutputAction(),this.registerToggleAutoScrollAction(),this.registerOpenActiveLogOutputFileAction(),this.registerShowLogsAction(),this.registerOpenLogFileAction()}registerSwitchOutputAction(){this._register(Nt(class extends Le{constructor(){super({id:"workbench.output.action.switchBetweenOutputs",title:p("switchBetweenOutputs.label","Switch Output")})}async run(s,o){o&&s.get(da).showChannel(o,!0)}}));const e=new Ee("workbench.output.menu.switchOutput");this._register(Un.appendMenuItem(Ee.ViewTitle,{submenu:e,title:p("switchToOutput.label","Switch Output"),group:"navigation",when:nt.equals("view",Xn),order:1,isSelection:!0}));const t=new Map;this._register(ot(()=>vt(t.values())));const i=s=>{for(const o of s){const a=o.label,c=o.extensionId?"0_ext_outputchannels":"1_core_outputchannels";t.set(o.id,Nt(class extends Le{constructor(){super({id:`workbench.action.output.show.${o.id}`,title:a,toggled:Y3.isEqualTo(o.id),menu:{id:e,group:c}})}async run(d){return d.get(da).showChannel(o.id,!0)}}))}};i(this.outputService.getChannelDescriptors());const n=st.as(cl.OutputChannels);this._register(n.onDidRegisterChannel(s=>{const o=this.outputService.getChannelDescriptor(s);o&&i([o])})),this._register(n.onDidRemoveChannel(s=>{var o;(o=t.get(s))==null||o.dispose(),t.delete(s)}))}registerShowOutputChannelsAction(){this._register(Nt(class extends Le{constructor(){super({id:"workbench.action.showOutputChannels",title:{value:p("showOutputChannels","Show Output Channels..."),original:"Show Output Channels..."},category:{value:p("output","Output"),original:"Output"},f1:!0})}async run(e){const t=e.get(da),i=e.get(ss),n=[],s=[];for(const c of t.getChannelDescriptors())c.extensionId?n.push(c):s.push(c);const o=[];for(const{id:c,label:d}of n)o.push({id:c,label:d});n.length&&s.length&&o.push({type:"separator"});for(const{id:c,label:d}of s)o.push({id:c,label:d});const a=await i.pick(o,{placeHolder:p("selectOutput","Select Output Channel")});if(a)return t.showChannel(a.id)}}))}registerClearOutputAction(){this._register(Nt(class extends Le{constructor(){super({id:"workbench.output.action.clearOutput",title:{value:p("clearOutput.label","Clear Output"),original:"Clear Output"},category:ye.View,menu:[{id:Ee.ViewTitle,when:nt.equals("view",Xn),group:"navigation",order:2},{id:Ee.CommandPalette},{id:Ee.EditorContext,when:z3}],icon:jt.clearAll})}async run(e){const i=e.get(da).getActiveChannel();i&&(i.clear(),F7(p("outputCleared","Output was cleared")))}}))}registerToggleAutoScrollAction(){this._register(Nt(class extends Le{constructor(){super({id:"workbench.output.action.toggleAutoScroll",title:{value:p("toggleAutoScroll","Toggle Auto Scrolling"),original:"Toggle Auto Scrolling"},tooltip:p("outputScrollOff","Turn Auto Scrolling Off"),menu:{id:Ee.ViewTitle,when:nt.and(nt.equals("view",Xn)),group:"navigation",order:3},icon:jt.lock,toggled:{condition:Q3,icon:jt.unlock,tooltip:p("outputScrollOn","Turn Auto Scrolling On")}})}async run(e){const t=e.get(ko).getActiveViewWithId(Xn);t.scrollLock=!t.scrollLock}}))}registerOpenActiveLogOutputFileAction(){this._register(Nt(class extends Le{constructor(){super({id:"workbench.action.openActiveLogOutputFile",title:{value:p("openActiveLogOutputFile","Open Log Output File"),original:"Open Log Output File"},menu:[{id:Ee.ViewTitle,when:nt.equals("view",Xn),group:"navigation",order:4}],icon:jt.goToFile,precondition:K3})}async run(e){const t=e.get(da),i=e.get(Ke),n=e.get(Te),s=this.getLogFileOutputChannelDescriptor(t);s&&await i.openEditor(n.createInstance(Im,s),{pinned:!0})}getLogFileOutputChannelDescriptor(e){const t=e.getActiveChannel();if(t){const i=e.getChannelDescriptors().filter(n=>n.id===t.id)[0];if(i&&i.file&&i.log)return i}return null}}))}registerShowLogsAction(){this._register(Nt(class extends Le{constructor(){super({id:"workbench.action.showLogs",title:{value:p("showLogs","Show Logs..."),original:"Show Logs..."},category:ye.Developer,menu:{id:Ee.CommandPalette}})}async run(e){const t=e.get(da),i=e.get(ss),n=[],s=[];for(const c of t.getChannelDescriptors())c.log&&(c.extensionId?n.push(c):s.push(c));const o=[];for(const{id:c,label:d}of s)o.push({id:c,label:d});n.length&&s.length&&o.push({type:"separator",label:p("extensionLogs","Extension Logs")});for(const{id:c,label:d}of n)o.push({id:c,label:d});const a=await i.pick(o,{placeHolder:p("selectlog","Select Log")});if(a)return t.showChannel(a.id)}}))}registerOpenLogFileAction(){this._register(Nt(class extends Le{constructor(){super({id:"workbench.action.openLogFile",title:{value:p("openLogFile","Open Log File..."),original:"Open Log File..."},category:ye.Developer,menu:{id:Ee.CommandPalette},description:{description:"workbench.action.openLogFile",args:[{name:"logFile",schema:{markdownDescription:p("logFile",'The id of the log file to open, for example `"window"`. Currently the best way to get this is to get the ID by checking the `workbench.action.output.show.<id>` commands'),type:"string"}}]}})}async run(e,t){const i=e.get(da),n=e.get(ss),s=e.get(Te),o=e.get(Ke),a=i.getChannelDescriptors().filter(l=>l.file&&l.log).map(l=>({id:l.id,label:l.label,channel:l})),c=t&&typeof t=="string"?t:void 0;let d;c&&(d=a.find(l=>l.id===c)),d||(d=await n.pick(a,{placeHolder:p("selectlogFile","Select Log File")})),d&&(Mi(d.channel.file),await o.openEditor(s.createInstance(Im,d.channel),{pinned:!0}))}}))}};bF=T([v(0,Te),v(1,or),v(2,da)],bF);st.as(Js.Workbench).registerWorkbenchContribution(bF,3);st.as(ks.Configuration).registerConfiguration({id:"output",order:30,title:p("output","Output"),type:"object",properties:{"output.smartScroll.enabled":{type:"boolean",description:p("output.smartScroll.enabled","Enable/disable the ability of smart scrolling in the output view. Smart scrolling allows you to lock scrolling automatically when you click in the output view and unlocks when you click in the last line."),default:!0,scope:3,tags:["output"]}}});let SF=class extends Oge{constructor(e){super(ua.Info,k.from({scheme:"logs",path:"/"}),e)}};SF=T([v(0,at)],SF);function b8(){return{[Is.toString()]:new er(SF)}}const mme=Object.freeze(Object.defineProperty({__proto__:null,default:b8},Symbol.toStringTag,{value:"Module"}));function S8(r,e){if(e==null)return r;const t=new URL(r,e);return t.host=new URL(e).hostname,t.toString()}let CF={};function vme(r){CF={...CF,...r}}function yme(r){let e=CF[r];return typeof e=="function"&&(e=e()),new URL(e,window.location.href).toString()}window.monacoRequire={toUrl:yme};const EF=st.as(O7.ColorContribution),oS=EF.getColorReferenceSchema(),C8="^\\w+[.\\w+]*$",_me=io.registerExtensionPoint({extensionPoint:"colors",jsonSchema:{description:p("contributes.color","Contributes extension defined themable colors"),type:"array",items:{type:"object",properties:{id:{type:"string",description:p("contributes.color.id","The identifier of the themable color"),pattern:C8,patternErrorMessage:p("contributes.color.id.format","Identifiers must only contain letters, digits and dots and can not start with a dot")},description:{type:"string",description:p("contributes.color.description","The description of the themable color")},defaults:{type:"object",properties:{light:{description:p("contributes.defaults.light","The default color for light themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default."),type:"string",anyOf:[oS,{type:"string",format:"color-hex"}]},dark:{description:p("contributes.defaults.dark","The default color for dark themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default."),type:"string",anyOf:[oS,{type:"string",format:"color-hex"}]},highContrast:{description:p("contributes.defaults.highContrast","The default color for high contrast dark themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default. If not provided, the `dark` color is used as default for high contrast dark themes."),type:"string",anyOf:[oS,{type:"string",format:"color-hex"}]},highContrastLight:{description:p("contributes.defaults.highContrastLight","The default color for high contrast light themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default. If not provided, the `light` color is used as default for high contrast light themes."),type:"string",anyOf:[oS,{type:"string",format:"color-hex"}]}},required:["light","dark"]}}}}});class wme{constructor(){_me.setHandler((e,t)=>{for(const i of t.added){const n=i.value,s=i.collector;if(!n||!Array.isArray(n)){s.error(p("invalid.colorConfiguration","'configuration.colors' must be a array"));return}const o=(a,c)=>a.length>0?a[0]==="#"?Ue.Format.CSS.parseHex(a):a:(s.error(p("invalid.default.colorType","{0} must be either a color value in hex (#RRGGBB[AA] or #RGB[A]) or the identifier of a themable color which provides the default.",c)),Ue.red);for(const a of n){if(typeof a.id!="string"||a.id.length===0){s.error(p("invalid.id","'configuration.colors.id' must be defined and can not be empty"));return}if(!a.id.match(C8)){s.error(p("invalid.id.format","'configuration.colors.id' must only contain letters, digits and dots and can not start with a dot"));return}if(typeof a.description!="string"||a.id.length===0){s.error(p("invalid.description","'configuration.colors.description' must be defined and can not be empty"));return}const c=a.defaults;if(!c||typeof c!="object"||typeof c.light!="string"||typeof c.dark!="string"){s.error(p("invalid.defaults","'configuration.colors.defaults' must be defined and must contain 'light' and 'dark'"));return}if(c.highContrast&&typeof c.highContrast!="string"){s.error(p("invalid.defaults.highContrast","If defined, 'configuration.colors.defaults.highContrast' must be a string."));return}if(c.highContrastLight&&typeof c.highContrastLight!="string"){s.error(p("invalid.defaults.highContrastLight","If defined, 'configuration.colors.defaults.highContrastLight' must be a string."));return}EF.registerColor(a.id,{light:o(c.light,"configuration.colors.defaults.light"),dark:o(c.dark,"configuration.colors.defaults.dark"),hcDark:o(c.highContrast??c.dark,"configuration.colors.defaults.highContrast"),hcLight:o(c.highContrastLight??c.light,"configuration.colors.defaults.highContrastLight")},a.description)}}for(const i of t.removed){const n=i.value;for(const s of n)EF.deregisterColor(s.id)}})}}const bme=st.as(N7.IconContribution);bme.getIconReferenceSchema();const Sme="*",E8=":",x8=".",tC="\\w+[-_\\w+]*",rP=`^${tC}$`,Cme=`^(${tC}|\\*)(\\${x8}${tC})*(${E8}${tC})?$`,Eme="^(\\s*(italic|bold|underline|strikethrough))*\\s*$";class Jp{constructor(e,t,i,n,s){this.foreground=e,this.bold=t,this.underline=i,this.strikethrough=n,this.italic=s}}(function(r){function e(a){return{_foreground:a.foreground===void 0?null:Ue.Format.CSS.formatHexA(a.foreground,!0),_bold:a.bold===void 0?null:a.bold,_underline:a.underline===void 0?null:a.underline,_italic:a.italic===void 0?null:a.italic,_strikethrough:a.strikethrough===void 0?null:a.strikethrough}}r.toJSONObject=e;function t(a){if(a){const c=l=>typeof l=="boolean"?l:void 0,d=l=>typeof l=="string"?Ue.fromHex(l):void 0;return new r(d(a._foreground),c(a._bold),c(a._underline),c(a._strikethrough),c(a._italic))}}r.fromJSONObject=t;function i(a,c){return a===c?!0:a!==void 0&&c!==void 0&&(a.foreground instanceof Ue?a.foreground.equals(c.foreground):c.foreground===void 0)&&a.bold===c.bold&&a.underline===c.underline&&a.strikethrough===c.strikethrough&&a.italic===c.italic}r.equals=i;function n(a){return a instanceof r}r.is=n;function s(a){return new r(a.foreground,a.bold,a.underline,a.strikethrough,a.italic)}r.fromData=s;function o(a,c,d,l,u,h){let g;if(a!==void 0&&(g=Ue.fromHex(a)),c!==void 0){d=h=l=u=!1;const m=/italic|bold|underline|strikethrough/g;let y;for(;y=m.exec(c);)switch(y[0]){case"bold":d=!0;break;case"italic":h=!0;break;case"underline":l=!0;break;case"strikethrough":u=!0;break}}return new r(g,d,l,u,h)}r.fromSettings=o})(Jp||(Jp={}));var xF;(function(r){function e(s,o){if(o&&typeof o._selector=="string"&&o._style){const a=Jp.fromJSONObject(o._style);if(a)try{return{selector:s.parseTokenSelector(o._selector),style:a}}catch{}}}r.fromJSONObject=e;function t(s){return{_selector:s.selector.id,_style:Jp.toJSONObject(s.style)}}r.toJSONObject=t;function i(s,o){return s===o?!0:s!==void 0&&o!==void 0&&s.selector&&o.selector&&s.selector.id===o.selector.id&&Jp.equals(s.style,o.style)}r.equals=i;function n(s){return s&&s.selector&&typeof s.selector.id=="string"&&Jp.is(s.style)}r.is=n})(xF||(xF={}));class xme{constructor(){this._onDidChangeSchema=new A,this.onDidChangeSchema=this._onDidChangeSchema.event,this.currentTypeNumber=0,this.currentModifierBit=1,this.tokenStylingDefaultRules=[],this.tokenStylingSchema={type:"object",properties:{},patternProperties:{[Cme]:sP()},additionalProperties:!1,definitions:{style:{type:"object",description:p("schema.token.settings","Colors and styles for the token."),properties:{foreground:{type:"string",description:p("schema.token.foreground","Foreground color for the token."),format:"color-hex",default:"#ff0000"},background:{type:"string",deprecationMessage:p("schema.token.background.warning","Token background colors are currently not supported.")},fontStyle:{type:"string",description:p("schema.token.fontStyle","Sets the all font styles of the rule: 'italic', 'bold', 'underline' or 'strikethrough' or a combination. All styles that are not listed are unset. The empty string unsets all styles."),pattern:Eme,patternErrorMessage:p("schema.fontStyle.error","Font style must be 'italic', 'bold', 'underline' or 'strikethrough' or a combination. The empty string unsets all styles."),defaultSnippets:[{label:p("schema.token.fontStyle.none","None (clear inherited style)"),bodyText:'""'},{body:"italic"},{body:"bold"},{body:"underline"},{body:"strikethrough"},{body:"italic bold"},{body:"italic underline"},{body:"italic strikethrough"},{body:"bold underline"},{body:"bold strikethrough"},{body:"underline strikethrough"},{body:"italic bold underline"},{body:"italic bold strikethrough"},{body:"italic underline strikethrough"},{body:"bold underline strikethrough"},{body:"italic bold underline strikethrough"}]},bold:{type:"boolean",description:p("schema.token.bold","Sets or unsets the font style to bold. Note, the presence of 'fontStyle' overrides this setting.")},italic:{type:"boolean",description:p("schema.token.italic","Sets or unsets the font style to italic. Note, the presence of 'fontStyle' overrides this setting.")},underline:{type:"boolean",description:p("schema.token.underline","Sets or unsets the font style to underline. Note, the presence of 'fontStyle' overrides this setting.")},strikethrough:{type:"boolean",description:p("schema.token.strikethrough","Sets or unsets the font style to strikethrough. Note, the presence of 'fontStyle' overrides this setting.")}},defaultSnippets:[{body:{foreground:"${1:#FF0000}",fontStyle:"${2:bold}"}}]}}},this.tokenTypeById=Object.create(null),this.tokenModifierById=Object.create(null),this.typeHierarchy=Object.create(null)}registerTokenType(e,t,i,n){if(!e.match(rP))throw new Error("Invalid token type id.");if(i&&!i.match(rP))throw new Error("Invalid token super type id.");const o={num:this.currentTypeNumber++,id:e,superType:i,description:t,deprecationMessage:n};this.tokenTypeById[e]=o;const a=sP(t,n);this.tokenStylingSchema.properties[e]=a,this.typeHierarchy=Object.create(null)}registerTokenModifier(e,t,i){if(!e.match(rP))throw new Error("Invalid token modifier id.");const n=this.currentModifierBit;this.currentModifierBit=this.currentModifierBit*2;const s={num:n,id:e,description:t,deprecationMessage:i};this.tokenModifierById[e]=s,this.tokenStylingSchema.properties[`*.${e}`]=sP(t,i)}parseTokenSelector(e,t){const i=kme(e,t);return i.type?{match:(n,s,o)=>{let a=0;if(i.language!==void 0){if(i.language!==o)return-1;a+=10}if(i.type!==Sme){const d=this.getTypeHierarchy(n).indexOf(i.type);if(d===-1)return-1;a+=100-d}for(const c of i.modifiers)if(s.indexOf(c)===-1)return-1;return a+i.modifiers.length*100},id:`${[i.type,...i.modifiers.sort()].join(".")}${i.language!==void 0?":"+i.language:""}`}:{match:()=>-1,id:"$invalid"}}registerTokenStyleDefault(e,t){this.tokenStylingDefaultRules.push({selector:e,defaults:t})}deregisterTokenStyleDefault(e){const t=e.id;this.tokenStylingDefaultRules=this.tokenStylingDefaultRules.filter(i=>i.selector.id!==t)}deregisterTokenType(e){delete this.tokenTypeById[e],delete this.tokenStylingSchema.properties[e],this.typeHierarchy=Object.create(null)}deregisterTokenModifier(e){delete this.tokenModifierById[e],delete this.tokenStylingSchema.properties[`*.${e}`]}getTokenTypes(){return Object.keys(this.tokenTypeById).map(e=>this.tokenTypeById[e])}getTokenModifiers(){return Object.keys(this.tokenModifierById).map(e=>this.tokenModifierById[e])}getTokenStylingSchema(){return this.tokenStylingSchema}getTokenStylingDefaultRules(){return this.tokenStylingDefaultRules}getTypeHierarchy(e){let t=this.typeHierarchy[e];if(!t){this.typeHierarchy[e]=t=[e];let i=this.tokenTypeById[e];for(;i&&i.superType;)t.push(i.superType),i=this.tokenTypeById[i.superType]}return t}toString(){const e=(t,i)=>{const n=t.indexOf(".")===-1?0:1,s=i.indexOf(".")===-1?0:1;return n!==s?n-s:t.localeCompare(i)};return Object.keys(this.tokenTypeById).sort(e).map(t=>`- \`${t}\`: ${this.tokenTypeById[t].description}`).join(`
`)}}const $U=E8.charCodeAt(0),Dme=x8.charCodeAt(0);function kme(r,e){let t=r.length,i=e;const n=[];for(let o=t-1;o>=0;o--){const a=r.charCodeAt(o);if(a===$U||a===Dme){const c=r.substring(o+1,t);t=o,a===$U?i=c:n.push(c)}}return{type:r.substring(0,t),modifiers:n,language:i}}const X$=Tme();function Tme(){const r=new xme;function e(i,n,s=[],o,a){return r.registerTokenType(i,n,o,a),s&&t(i,s),i}function t(i,n){try{const s=r.parseTokenSelector(i);r.registerTokenStyleDefault(s,{scopesToProbe:n})}catch(s){console.log(s)}}return e("comment",p("comment","Style for comments."),[["comment"]]),e("string",p("string","Style for strings."),[["string"]]),e("keyword",p("keyword","Style for keywords."),[["keyword.control"]]),e("number",p("number","Style for numbers."),[["constant.numeric"]]),e("regexp",p("regexp","Style for expressions."),[["constant.regexp"]]),e("operator",p("operator","Style for operators."),[["keyword.operator"]]),e("namespace",p("namespace","Style for namespaces."),[["entity.name.namespace"]]),e("type",p("type","Style for types."),[["entity.name.type"],["support.type"]]),e("struct",p("struct","Style for structs."),[["entity.name.type.struct"]]),e("class",p("class","Style for classes."),[["entity.name.type.class"],["support.class"]]),e("interface",p("interface","Style for interfaces."),[["entity.name.type.interface"]]),e("enum",p("enum","Style for enums."),[["entity.name.type.enum"]]),e("typeParameter",p("typeParameter","Style for type parameters."),[["entity.name.type.parameter"]]),e("function",p("function","Style for functions"),[["entity.name.function"],["support.function"]]),e("member",p("member","Style for member functions"),[],"method","Deprecated use `method` instead"),e("method",p("method","Style for method (member functions)"),[["entity.name.function.member"],["support.function"]]),e("macro",p("macro","Style for macros."),[["entity.name.function.preprocessor"]]),e("variable",p("variable","Style for variables."),[["variable.other.readwrite"],["entity.name.variable"]]),e("parameter",p("parameter","Style for parameters."),[["variable.parameter"]]),e("property",p("property","Style for properties."),[["variable.other.property"]]),e("enumMember",p("enumMember","Style for enum members."),[["variable.other.enummember"]]),e("event",p("event","Style for events."),[["variable.other.event"]]),e("decorator",p("decorator","Style for decorators & annotations."),[["entity.name.decorator"],["entity.name.function"]]),e("label",p("labels","Style for labels. "),void 0),r.registerTokenModifier("declaration",p("declaration","Style for all symbol declarations."),void 0),r.registerTokenModifier("documentation",p("documentation","Style to use for references in documentation."),void 0),r.registerTokenModifier("static",p("static","Style to use for symbols that are static."),void 0),r.registerTokenModifier("abstract",p("abstract","Style to use for symbols that are abstract."),void 0),r.registerTokenModifier("deprecated",p("deprecated","Style to use for symbols that are deprecated."),void 0),r.registerTokenModifier("modification",p("modification","Style to use for write accesses."),void 0),r.registerTokenModifier("async",p("async","Style to use for symbols that are async."),void 0),r.registerTokenModifier("readonly",p("readonly","Style to use for symbols that are read-only."),void 0),t("variable.readonly",[["variable.other.constant"]]),t("property.readonly",[["variable.other.constant.property"]]),t("type.defaultLibrary",[["support.type"]]),t("class.defaultLibrary",[["support.class"]]),t("interface.defaultLibrary",[["support.class"]]),t("variable.defaultLibrary",[["support.variable"],["support.other.variable"]]),t("variable.defaultLibrary.readonly",[["support.constant"]]),t("property.defaultLibrary",[["support.variable.property"]]),t("property.defaultLibrary.readonly",[["support.constant.property"]]),t("function.defaultLibrary",[["support.function"]]),t("member.defaultLibrary",[["support.function"]]),r}function SOe(){return X$}function sP(r,e){return{description:r,deprecationMessage:e,defaultSnippets:[{body:"${1:#ff0000}"}],anyOf:[{type:"string",format:"color-hex"},{$ref:"#/definitions/style"}]}}const D8="vscode://schemas/token-styling",k8=st.as(lk.JSONContribution);k8.registerSchema(D8,X$.getTokenStylingSchema());const WU=new Ys(()=>k8.notifySchemaChanged(D8),200);X$.onDidChangeSchema(()=>{WU.isScheduled()||WU.schedule()});function Ime(r){switch(r){case 1:return p("error.invalidSymbol","Invalid symbol");case 2:return p("error.invalidNumberFormat","Invalid number format");case 3:return p("error.propertyNameExpected","Property name expected");case 4:return p("error.valueExpected","Value expected");case 5:return p("error.colonExpected","Colon expected");case 6:return p("error.commaExpected","Comma expected");case 7:return p("error.closeBraceExpected","Closing brace expected");case 8:return p("error.closeBracketExpected","Closing bracket expected");case 9:return p("error.endOfFileExpected","End of file expected");default:return""}}function T8(r){if(!Array.isArray(r))return!1;for(let e=0,t=r.length;e<t;e++)if(typeof r[e]!="string")return!1;return!0}function Nv(r){return T8(r)&&r.length===2}let HU=class extends ne{constructor(e,t,i,n){super(),this._languageService=e,this._extensionResourceLoaderService=t,this._extensionService=i,this._languageConfigurationService=n,this._done=new Map,this._register(this._languageService.onDidRequestBasicLanguageFeatures(async s=>{this._extensionService.whenInstalledExtensionsRegistered().then(()=>{this._loadConfigurationsForMode(s)})})),this._register(this._languageService.onDidChange(()=>{for(const[s]of this._done)this._loadConfigurationsForMode(s)}))}async _loadConfigurationsForMode(e){const t=this._languageService.getConfigurationFiles(e),i=yc(t.map(s=>s.toString()));if(this._done.get(e)===i)return;this._done.set(e,i);const n=await Promise.all(t.map(s=>this._readConfigFile(s)));for(const s of n)this._handleConfig(e,s)}async _readConfigFile(e){try{const t=await this._extensionResourceLoaderService.readExtensionResource(e),i=[];let n=sc(t,i);return i.length&&console.error(p("parseErrors","Errors parsing {0}: {1}",e.toString(),i.map(s=>`[${s.offset}, ${s.length}] ${Ime(s.error)}`).join(`
`))),Pq(n)!=="object"&&(console.error(p("formatError","{0}: Invalid format, JSON object expected.",e.toString())),n={}),n}catch(t){return console.error(t),{}}}_extractValidCommentRule(e,t){const i=t.comments;if(typeof i>"u")return;if(!bn(i)){console.warn(`[${e}]: language configuration: expected \`comments\` to be an object.`);return}let n;return typeof i.lineComment<"u"&&(typeof i.lineComment!="string"?console.warn(`[${e}]: language configuration: expected \`comments.lineComment\` to be a string.`):(n=n||{},n.lineComment=i.lineComment)),typeof i.blockComment<"u"&&(Nv(i.blockComment)?(n=n||{},n.blockComment=i.blockComment):console.warn(`[${e}]: language configuration: expected \`comments.blockComment\` to be an array of two strings.`)),n}_extractValidBrackets(e,t){const i=t.brackets;if(typeof i>"u")return;if(!Array.isArray(i)){console.warn(`[${e}]: language configuration: expected \`brackets\` to be an array.`);return}let n;for(let s=0,o=i.length;s<o;s++){const a=i[s];if(!Nv(a)){console.warn(`[${e}]: language configuration: expected \`brackets[${s}]\` to be an array of two strings.`);continue}n=n||[],n.push(a)}return n}_extractValidAutoClosingPairs(e,t){const i=t.autoClosingPairs;if(typeof i>"u")return;if(!Array.isArray(i)){console.warn(`[${e}]: language configuration: expected \`autoClosingPairs\` to be an array.`);return}let n;for(let s=0,o=i.length;s<o;s++){const a=i[s];if(Array.isArray(a)){if(!Nv(a)){console.warn(`[${e}]: language configuration: expected \`autoClosingPairs[${s}]\` to be an array of two strings or an object.`);continue}n=n||[],n.push({open:a[0],close:a[1]})}else{if(!bn(a)){console.warn(`[${e}]: language configuration: expected \`autoClosingPairs[${s}]\` to be an array of two strings or an object.`);continue}if(typeof a.open!="string"){console.warn(`[${e}]: language configuration: expected \`autoClosingPairs[${s}].open\` to be a string.`);continue}if(typeof a.close!="string"){console.warn(`[${e}]: language configuration: expected \`autoClosingPairs[${s}].close\` to be a string.`);continue}if(typeof a.notIn<"u"&&!T8(a.notIn)){console.warn(`[${e}]: language configuration: expected \`autoClosingPairs[${s}].notIn\` to be a string array.`);continue}n=n||[],n.push({open:a.open,close:a.close,notIn:a.notIn})}}return n}_extractValidSurroundingPairs(e,t){const i=t.surroundingPairs;if(typeof i>"u")return;if(!Array.isArray(i)){console.warn(`[${e}]: language configuration: expected \`surroundingPairs\` to be an array.`);return}let n;for(let s=0,o=i.length;s<o;s++){const a=i[s];if(Array.isArray(a)){if(!Nv(a)){console.warn(`[${e}]: language configuration: expected \`surroundingPairs[${s}]\` to be an array of two strings or an object.`);continue}n=n||[],n.push({open:a[0],close:a[1]})}else{if(!bn(a)){console.warn(`[${e}]: language configuration: expected \`surroundingPairs[${s}]\` to be an array of two strings or an object.`);continue}if(typeof a.open!="string"){console.warn(`[${e}]: language configuration: expected \`surroundingPairs[${s}].open\` to be a string.`);continue}if(typeof a.close!="string"){console.warn(`[${e}]: language configuration: expected \`surroundingPairs[${s}].close\` to be a string.`);continue}n=n||[],n.push({open:a.open,close:a.close})}}return n}_extractValidColorizedBracketPairs(e,t){const i=t.colorizedBracketPairs;if(typeof i>"u")return;if(!Array.isArray(i)){console.warn(`[${e}]: language configuration: expected \`colorizedBracketPairs\` to be an array.`);return}const n=[];for(let s=0,o=i.length;s<o;s++){const a=i[s];if(!Nv(a)){console.warn(`[${e}]: language configuration: expected \`colorizedBracketPairs[${s}]\` to be an array of two strings.`);continue}n.push([a[0],a[1]])}return n}_extractValidOnEnterRules(e,t){const i=t.onEnterRules;if(typeof i>"u")return;if(!Array.isArray(i)){console.warn(`[${e}]: language configuration: expected \`onEnterRules\` to be an array.`);return}let n;for(let s=0,o=i.length;s<o;s++){const a=i[s];if(!bn(a)){console.warn(`[${e}]: language configuration: expected \`onEnterRules[${s}]\` to be an object.`);continue}if(!bn(a.action)){console.warn(`[${e}]: language configuration: expected \`onEnterRules[${s}].action\` to be an object.`);continue}let c;if(a.action.indent==="none")c=Fp.None;else if(a.action.indent==="indent")c=Fp.Indent;else if(a.action.indent==="indentOutdent")c=Fp.IndentOutdent;else if(a.action.indent==="outdent")c=Fp.Outdent;else{console.warn(`[${e}]: language configuration: expected \`onEnterRules[${s}].action.indent\` to be 'none', 'indent', 'indentOutdent' or 'outdent'.`);continue}const d={indentAction:c};a.action.appendText&&(typeof a.action.appendText=="string"?d.appendText=a.action.appendText:console.warn(`[${e}]: language configuration: expected \`onEnterRules[${s}].action.appendText\` to be undefined or a string.`)),a.action.removeText&&(typeof a.action.removeText=="number"?d.removeText=a.action.removeText:console.warn(`[${e}]: language configuration: expected \`onEnterRules[${s}].action.removeText\` to be undefined or a number.`));const l=this._parseRegex(e,`onEnterRules[${s}].beforeText`,a.beforeText);if(!l)continue;const u={beforeText:l,action:d};if(a.afterText){const h=this._parseRegex(e,`onEnterRules[${s}].afterText`,a.afterText);h&&(u.afterText=h)}if(a.previousLineText){const h=this._parseRegex(e,`onEnterRules[${s}].previousLineText`,a.previousLineText);h&&(u.previousLineText=h)}n=n||[],n.push(u)}return n}_handleConfig(e,t){const i=this._extractValidCommentRule(e,t),n=this._extractValidBrackets(e,t),s=this._extractValidAutoClosingPairs(e,t),o=this._extractValidSurroundingPairs(e,t),a=this._extractValidColorizedBracketPairs(e,t),c=typeof t.autoCloseBefore=="string"?t.autoCloseBefore:void 0,d=t.wordPattern?this._parseRegex(e,"wordPattern",t.wordPattern):void 0,l=t.indentationRules?this._mapIndentationRules(e,t.indentationRules):void 0;let u;if(t.folding){const m=t.folding.markers,y=m&&m.start?this._parseRegex(e,"folding.markers.start",m.start):void 0,_=m&&m.end?this._parseRegex(e,"folding.markers.end",m.end):void 0,b=y&&_?{start:y,end:_}:void 0;u={offSide:t.folding.offSide,markers:b}}const h=this._extractValidOnEnterRules(e,t),g={comments:i,brackets:n,wordPattern:d,indentationRules:l,onEnterRules:h,autoClosingPairs:s,surroundingPairs:o,colorizedBracketPairs:a,autoCloseBefore:c,folding:u,__electricCharacterSupport:void 0};this._languageConfigurationService.register(e,g,50)}_parseRegex(e,t,i){if(typeof i=="string")try{return new RegExp(i,"")}catch(n){console.warn(`[${e}]: Invalid regular expression in \`${t}\`: `,n);return}if(bn(i)){if(typeof i.pattern!="string"){console.warn(`[${e}]: language configuration: expected \`${t}.pattern\` to be a string.`);return}if(typeof i.flags<"u"&&typeof i.flags!="string"){console.warn(`[${e}]: language configuration: expected \`${t}.flags\` to be a string.`);return}try{return new RegExp(i.pattern,i.flags)}catch(n){console.warn(`[${e}]: Invalid regular expression in \`${t}\`: `,n);return}}console.warn(`[${e}]: language configuration: expected \`${t}\` to be a string or an object.`)}_mapIndentationRules(e,t){const i=this._parseRegex(e,"indentationRules.increaseIndentPattern",t.increaseIndentPattern);if(!i)return;const n=this._parseRegex(e,"indentationRules.decreaseIndentPattern",t.decreaseIndentPattern);if(!n)return;const s={increaseIndentPattern:i,decreaseIndentPattern:n};return t.indentNextLinePattern&&(s.indentNextLinePattern=this._parseRegex(e,"indentationRules.indentNextLinePattern",t.indentNextLinePattern)),t.unIndentedLinePattern&&(s.unIndentedLinePattern=this._parseRegex(e,"indentationRules.unIndentedLinePattern",t.unIndentedLinePattern)),s}};HU=T([v(0,ji),v(1,g$),v(2,yr),v(3,Bm)],HU);const Rme="vscode://schemas/language-configuration",Pme={allowComments:!0,allowTrailingCommas:!0,default:{comments:{blockComment:["/*","*/"],lineComment:"//"},brackets:[["(",")"],["[","]"],["{","}"]],autoClosingPairs:[["(",")"],["[","]"],["{","}"]],surroundingPairs:[["(",")"],["[","]"],["{","}"]]},definitions:{openBracket:{type:"string",description:p("schema.openBracket","The opening bracket character or string sequence.")},closeBracket:{type:"string",description:p("schema.closeBracket","The closing bracket character or string sequence.")},bracketPair:{type:"array",items:[{$ref:"#/definitions/openBracket"},{$ref:"#/definitions/closeBracket"}]}},properties:{comments:{default:{blockComment:["/*","*/"],lineComment:"//"},description:p("schema.comments","Defines the comment symbols"),type:"object",properties:{blockComment:{type:"array",description:p("schema.blockComments","Defines how block comments are marked."),items:[{type:"string",description:p("schema.blockComment.begin","The character sequence that starts a block comment.")},{type:"string",description:p("schema.blockComment.end","The character sequence that ends a block comment.")}]},lineComment:{type:"string",description:p("schema.lineComment","The character sequence that starts a line comment.")}}},brackets:{default:[["(",")"],["[","]"],["{","}"]],markdownDescription:p("schema.brackets","Defines the bracket symbols that increase or decrease the indentation. When bracket pair colorization is enabled and {0} is not defined, this also defines the bracket pairs that are colorized by their nesting level.","`colorizedBracketPairs`"),type:"array",items:{$ref:"#/definitions/bracketPair"}},colorizedBracketPairs:{default:[["(",")"],["[","]"],["{","}"]],markdownDescription:p("schema.colorizedBracketPairs","Defines the bracket pairs that are colorized by their nesting level if bracket pair colorization is enabled. Any brackets included here that are not included in {0} will be automatically included in {0}.","`brackets`"),type:"array",items:{$ref:"#/definitions/bracketPair"}},autoClosingPairs:{default:[["(",")"],["[","]"],["{","}"]],description:p("schema.autoClosingPairs","Defines the bracket pairs. When a opening bracket is entered, the closing bracket is inserted automatically."),type:"array",items:{oneOf:[{$ref:"#/definitions/bracketPair"},{type:"object",properties:{open:{$ref:"#/definitions/openBracket"},close:{$ref:"#/definitions/closeBracket"},notIn:{type:"array",description:p("schema.autoClosingPairs.notIn","Defines a list of scopes where the auto pairs are disabled."),items:{enum:["string","comment"]}}}}]}},autoCloseBefore:{default:`;:.,=}])> 
	`,description:p("schema.autoCloseBefore","Defines what characters must be after the cursor in order for bracket or quote autoclosing to occur when using the 'languageDefined' autoclosing setting. This is typically the set of characters which can not start an expression."),type:"string"},surroundingPairs:{default:[["(",")"],["[","]"],["{","}"]],description:p("schema.surroundingPairs","Defines the bracket pairs that can be used to surround a selected string."),type:"array",items:{oneOf:[{$ref:"#/definitions/bracketPair"},{type:"object",properties:{open:{$ref:"#/definitions/openBracket"},close:{$ref:"#/definitions/closeBracket"}}}]}},wordPattern:{default:"",description:p("schema.wordPattern","Defines what is considered to be a word in the programming language."),type:["string","object"],properties:{pattern:{type:"string",description:p("schema.wordPattern.pattern","The RegExp pattern used to match words."),default:""},flags:{type:"string",description:p("schema.wordPattern.flags","The RegExp flags used to match words."),default:"g",pattern:"^([gimuy]+)$",patternErrorMessage:p("schema.wordPattern.flags.errorMessage","Must match the pattern `/^([gimuy]+)$/`.")}}},indentationRules:{default:{increaseIndentPattern:"",decreaseIndentPattern:""},description:p("schema.indentationRules","The language's indentation settings."),type:"object",properties:{increaseIndentPattern:{type:["string","object"],description:p("schema.indentationRules.increaseIndentPattern","If a line matches this pattern, then all the lines after it should be indented once (until another rule matches)."),properties:{pattern:{type:"string",description:p("schema.indentationRules.increaseIndentPattern.pattern","The RegExp pattern for increaseIndentPattern."),default:""},flags:{type:"string",description:p("schema.indentationRules.increaseIndentPattern.flags","The RegExp flags for increaseIndentPattern."),default:"",pattern:"^([gimuy]+)$",patternErrorMessage:p("schema.indentationRules.increaseIndentPattern.errorMessage","Must match the pattern `/^([gimuy]+)$/`.")}}},decreaseIndentPattern:{type:["string","object"],description:p("schema.indentationRules.decreaseIndentPattern","If a line matches this pattern, then all the lines after it should be unindented once (until another rule matches)."),properties:{pattern:{type:"string",description:p("schema.indentationRules.decreaseIndentPattern.pattern","The RegExp pattern for decreaseIndentPattern."),default:""},flags:{type:"string",description:p("schema.indentationRules.decreaseIndentPattern.flags","The RegExp flags for decreaseIndentPattern."),default:"",pattern:"^([gimuy]+)$",patternErrorMessage:p("schema.indentationRules.decreaseIndentPattern.errorMessage","Must match the pattern `/^([gimuy]+)$/`.")}}},indentNextLinePattern:{type:["string","object"],description:p("schema.indentationRules.indentNextLinePattern","If a line matches this pattern, then **only the next line** after it should be indented once."),properties:{pattern:{type:"string",description:p("schema.indentationRules.indentNextLinePattern.pattern","The RegExp pattern for indentNextLinePattern."),default:""},flags:{type:"string",description:p("schema.indentationRules.indentNextLinePattern.flags","The RegExp flags for indentNextLinePattern."),default:"",pattern:"^([gimuy]+)$",patternErrorMessage:p("schema.indentationRules.indentNextLinePattern.errorMessage","Must match the pattern `/^([gimuy]+)$/`.")}}},unIndentedLinePattern:{type:["string","object"],description:p("schema.indentationRules.unIndentedLinePattern","If a line matches this pattern, then its indentation should not be changed and it should not be evaluated against the other rules."),properties:{pattern:{type:"string",description:p("schema.indentationRules.unIndentedLinePattern.pattern","The RegExp pattern for unIndentedLinePattern."),default:""},flags:{type:"string",description:p("schema.indentationRules.unIndentedLinePattern.flags","The RegExp flags for unIndentedLinePattern."),default:"",pattern:"^([gimuy]+)$",patternErrorMessage:p("schema.indentationRules.unIndentedLinePattern.errorMessage","Must match the pattern `/^([gimuy]+)$/`.")}}}}},folding:{type:"object",description:p("schema.folding","The language's folding settings."),properties:{offSide:{type:"boolean",description:p("schema.folding.offSide","A language adheres to the off-side rule if blocks in that language are expressed by their indentation. If set, empty lines belong to the subsequent block.")},markers:{type:"object",description:p("schema.folding.markers","Language specific folding markers such as '#region' and '#endregion'. The start and end regexes will be tested against the contents of all lines and must be designed efficiently"),properties:{start:{type:"string",description:p("schema.folding.markers.start","The RegExp pattern for the start marker. The regexp must start with '^'.")},end:{type:"string",description:p("schema.folding.markers.end","The RegExp pattern for the end marker. The regexp must start with '^'.")}}}}},onEnterRules:{type:"array",description:p("schema.onEnterRules","The language's rules to be evaluated when pressing Enter."),items:{type:"object",description:p("schema.onEnterRules","The language's rules to be evaluated when pressing Enter."),required:["beforeText","action"],properties:{beforeText:{type:["string","object"],description:p("schema.onEnterRules.beforeText","This rule will only execute if the text before the cursor matches this regular expression."),properties:{pattern:{type:"string",description:p("schema.onEnterRules.beforeText.pattern","The RegExp pattern for beforeText."),default:""},flags:{type:"string",description:p("schema.onEnterRules.beforeText.flags","The RegExp flags for beforeText."),default:"",pattern:"^([gimuy]+)$",patternErrorMessage:p("schema.onEnterRules.beforeText.errorMessage","Must match the pattern `/^([gimuy]+)$/`.")}}},afterText:{type:["string","object"],description:p("schema.onEnterRules.afterText","This rule will only execute if the text after the cursor matches this regular expression."),properties:{pattern:{type:"string",description:p("schema.onEnterRules.afterText.pattern","The RegExp pattern for afterText."),default:""},flags:{type:"string",description:p("schema.onEnterRules.afterText.flags","The RegExp flags for afterText."),default:"",pattern:"^([gimuy]+)$",patternErrorMessage:p("schema.onEnterRules.afterText.errorMessage","Must match the pattern `/^([gimuy]+)$/`.")}}},previousLineText:{type:["string","object"],description:p("schema.onEnterRules.previousLineText","This rule will only execute if the text above the line matches this regular expression."),properties:{pattern:{type:"string",description:p("schema.onEnterRules.previousLineText.pattern","The RegExp pattern for previousLineText."),default:""},flags:{type:"string",description:p("schema.onEnterRules.previousLineText.flags","The RegExp flags for previousLineText."),default:"",pattern:"^([gimuy]+)$",patternErrorMessage:p("schema.onEnterRules.previousLineText.errorMessage","Must match the pattern `/^([gimuy]+)$/`.")}}},action:{type:["string","object"],description:p("schema.onEnterRules.action","The action to execute."),required:["indent"],default:{indent:"indent"},properties:{indent:{type:"string",description:p("schema.onEnterRules.action.indent","Describe what to do with the indentation"),default:"indent",enum:["none","indent","indentOutdent","outdent"],markdownEnumDescriptions:[p("schema.onEnterRules.action.indent.none","Insert new line and copy the previous line's indentation."),p("schema.onEnterRules.action.indent.indent","Insert new line and indent once (relative to the previous line's indentation)."),p("schema.onEnterRules.action.indent.indentOutdent",`Insert two new lines:
 - the first one indented which will hold the cursor
 - the second one at the same indentation level`),p("schema.onEnterRules.action.indent.outdent","Insert new line and outdent once (relative to the previous line's indentation).")]},appendText:{type:"string",description:p("schema.onEnterRules.action.appendText","Describes text to be appended after the new line and after the indentation."),default:""},removeText:{type:"number",description:p("schema.onEnterRules.action.removeText","Describes the number of characters to remove from the new line's indentation."),default:0}}}}}}}},Ame=st.as(lk.JSONContribution);Ame.registerSchema(Rme,Pme);let jU=class extends ne{constructor(e,t,i){super(),this.fileService=t,this.languagePackService=i}async $fetchBuiltInBundleUri(e,t){try{return await this.languagePackService.getBuiltInExtensionTranslationsUri(e,t)}catch{return}}async $fetchBundleContents(e){return(await this.fileService.readFile(k.revive(e))).value.toString()}};jU=T([gt(ce.MainThreadLocalization),v(1,at),v(2,n4)],jU);class yg extends $7{static is(e){return e instanceof yg?!0:k.isUri(e.resource)&&bn(e.cellEdit)}static lift(e){return e instanceof yg?e:new yg(e.resource,e.cellEdit,e.notebookVersionId,e.metadata)}constructor(e,t,i=void 0,n){super(n),this.resource=e,this.cellEdit=t,this.notebookVersionId=i}}let BU=class{constructor(e,t,i,n,s,o,a){this._undoRedoGroup=e,this._progress=i,this._token=n,this._edits=s,this._editorService=o,this._notebookModelService=a,this._edits=this._edits.map(c=>{var d;if(c.resource.scheme===$C.scheme){const l=(d=$C.parse(c.resource))==null?void 0:d.notebook;if(!l)throw new Error(`Invalid notebook URI: ${c.resource}`);return new yg(l,c.cellEdit,c.notebookVersionId,c.metadata)}else return c})}async apply(){var i;const e=[],t=yk(this._edits,(n,s)=>Sa(n.resource.toString(),s.resource.toString()));for(const n of t){if(this._token.isCancellationRequested)break;const[s]=n,o=await this._notebookModelService.resolve(s.resource);if(typeof s.notebookVersionId=="number"&&o.object.notebook.versionId!==s.notebookVersionId)throw o.dispose(),new Error(`Notebook '${s.resource}' has changed in the meantime`);const a=n.map(u=>u.cellEdit),c=!o.object.isReadonly(),d=fg(this._editorService.activeEditorPane),l=((i=d==null?void 0:d.textModel)==null?void 0:i.uri.toString())===o.object.notebook.uri.toString()?{kind:VP.Index,focus:d.getFocus(),selections:d.getSelections()}:void 0;o.object.notebook.applyEdits(a,!0,l,()=>{},this._undoRedoGroup,c),o.dispose(),this._progress.report(void 0),e.push(s.resource)}return e}};BU=T([v(5,Ke),v(6,C$)],BU);let UU=class{constructor(e,t,i,n){this._bulkEditService=t,this._logService=i,this._uriIdentService=n}dispose(){}$tryApplyWorkspaceEdit(e,t,i){const n=Ql(e,this._uriIdentService);return this._bulkEditService.apply(n,{undoRedoGroupId:t,respectAutoSaveConfig:i}).then(s=>s.isApplied,s=>(this._logService.warn(`IGNORING workspace edit: ${s}`),!1))}};UU=T([gt(ce.MainThreadBulkEdits),v(1,dG),v(2,ze),v(3,Hi)],UU);function Ql(r,e,t){var n;if(!r||!r.edits)return r;const i=Ta(r);for(const s of i.edits){if(W7.is(s)&&(s.resource=e.asCanonicalUri(s.resource)),zo.is(s)){if(s.options){const o=(n=s.options)==null?void 0:n.contents;if(o)if(o.type==="base64")s.options.contents=Promise.resolve(sq(o.value));else if(t)s.options.contents=t(o.id);else throw new Error("Could not revive data transfer file")}s.newResource=s.newResource&&e.asCanonicalUri(s.newResource),s.oldResource=s.oldResource&&e.asCanonicalUri(s.oldResource)}yg.is(s)&&(s.resource=e.asCanonicalUri(s.resource))}return r}let Qx=class I8 extends ne{constructor(e,t,i){super(),this._openerService=t,this._productService=i,this._webviews=new Map,this._proxy=e.getProxy(fe.ExtHostWebviews)}addWebview(e,t,i){if(this._webviews.has(e))throw new Error("Webview already registered");this._webviews.set(e,t),this.hookupWebviewEventDelegate(e,t,i)}$setHtml(e,t){var i;(i=this.tryGetWebview(e))==null||i.setHtml(t)}$setOptions(e,t){const i=this.tryGetWebview(e);i&&(i.contentOptions=Xx(t))}async $postMessage(e,t,...i){const n=this.tryGetWebview(e);if(!n)return!1;const{message:s,arrayBuffers:o}=q5(t,i);return n.postMessage(s,o)}hookupWebviewEventDelegate(e,t,i){const n=new me;n.add(t.onDidClickLink(s=>this.onDidClickLink(e,s))),n.add(t.onMessage(s=>{const o=V5(s.message,i);this._proxy.$onMessage(e,o.message,new rs(o.buffers))})),n.add(t.onMissingCsp(s=>this._proxy.$onMissingCsp(e,s.value))),n.add(t.onDidDispose(()=>{n.dispose(),this._webviews.delete(e)}))}onDidClickLink(e,t){const i=this.getWebview(e);this.isSupportedLink(i,k.parse(t))&&this._openerService.open(t,{fromUserGesture:!0,allowContributedOpeners:!0,allowCommands:Array.isArray(i.contentOptions.enableCommandUris)||i.contentOptions.enableCommandUris===!0,fromWorkspace:!0})}isSupportedLink(e,t){return I8.standardSupportedLinkSchemes.has(t.scheme)||!ln&&this._productService.urlProtocol===t.scheme?!0:t.scheme===pe.command?Array.isArray(e.contentOptions.enableCommandUris)?e.contentOptions.enableCommandUris.includes(t.path):e.contentOptions.enableCommandUris===!0:!1}tryGetWebview(e){return this._webviews.get(e)}getWebview(e){const t=this.tryGetWebview(e);if(!t)throw new Error(`Unknown webview handle:${e}`);return t}getWebviewResolvedFailedContent(e){return`<!DOCTYPE html>
		<html>
			<head>
				<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
				<meta http-equiv="Content-Security-Policy" content="default-src 'none';">
			</head>
			<body>${p("errorMessage","An error occurred while loading view: {0}",lG(e))}</body>
		</html>`}};Qx.standardSupportedLinkSchemes=new Set([pe.http,pe.https,pe.mailto,pe.vscode,"vscode-insider"]);Qx=T([v(1,us),v(2,Rs)],Qx);function Yx(r){return{id:r.id,location:k.revive(r.location)}}function Xx(r){return{allowScripts:r.enableScripts,allowForms:r.enableForms,enableCommandUris:r.enableCommandUris,localResourceRoots:Array.isArray(r.localResourceRoots)?r.localResourceRoots.map(e=>k.revive(e)):void 0,portMapping:r.portMapping}}class Mme{constructor(e,t,i,n){this.editor=e,this.line=t,this.height=i,this.webview=n,this.domNode=document.createElement("div"),this.domNode.style.zIndex="10",this.afterLineNumber=t,this.afterColumn=1,this.heightInLines=i,e.changeViewZones(s=>this._id=s.addZone(this)),n.mountTo(this.domNode)}dispose(){this.editor.changeViewZones(e=>this._id&&e.removeZone(this._id))}}let VU=class{constructor(e,t,i){this._editorService=t,this._webviewService=i,this._disposables=new me,this._insets=new Map,this._proxy=e.getProxy(fe.ExtHostEditorInsets)}dispose(){this._disposables.dispose()}async $createEditorInset(e,t,i,n,s,o,a,c){let d;t=t.substr(0,t.indexOf(","));for(const m of this._editorService.listCodeEditors())if(m.getId()===t&&m.hasModel()&&si(m.getModel().uri,k.revive(i))){d=m;break}if(!d){setTimeout(()=>this._proxy.$onDidDispose(e));return}const l=new me,u=this._webviewService.createWebviewElement({title:void 0,options:{enableFindWidget:!1},contentOptions:Xx(o),extension:{id:a,location:k.revive(c)}}),h=new Mme(d,n,s,u),g=()=>{l.dispose(),this._proxy.$onDidDispose(e),this._insets.delete(e)};l.add(d.onDidChangeModel(g)),l.add(d.onDidDispose(g)),l.add(h),l.add(u),l.add(u.onMessage(m=>this._proxy.$onDidReceiveMessage(e,m.message))),this._insets.set(e,h)}$disposeEditorInset(e){const t=this.getInset(e);this._insets.delete(e),t.dispose()}$setHtml(e,t){this.getInset(e).webview.setHtml(t)}$setOptions(e,t){const i=this.getInset(e);i.webview.contentOptions=Xx(t)}async $postMessage(e,t){return this.getInset(e).webview.postMessage(t),!0}getInset(e){const t=this._insets.get(e);if(!t)throw new Error("Unknown inset");return t}};VU=T([gt(ce.MainThreadEditorInsets),v(1,En),v(2,UT)],VU);let qU=class{constructor(e,t){this._clipboardService=t}dispose(){}$readText(){return this._clipboardService.readText()}$writeText(e){return this._clipboardService.writeText(e)}};qU=T([gt(ce.MainThreadClipboard),v(1,Vm)],qU);let GU=class{constructor(e,t,i){this._commandService=t,this._extensionService=i,this._commandRegistrations=new mr,this._proxy=e.getProxy(fe.ExtHostCommands),this._generateCommandsDocumentationRegistration=Gt.registerCommand("_generateCommandsDocumentation",()=>this._generateCommandsDocumentation())}dispose(){this._commandRegistrations.dispose(),this._generateCommandsDocumentationRegistration.dispose()}async _generateCommandsDocumentation(){const e=await this._proxy.$getContributedCommandHandlerDescriptions(),t=Gt.getCommands();for(const[n,s]of t)s.description&&(e[n]=s.description);const i=[];for(const n in e)i.push("`"+n+"` - "+Lme(e[n]));console.log(i.join(`
`))}$registerCommand(e){this._commandRegistrations.set(e,Gt.registerCommand(e,(t,...i)=>this._proxy.$executeContributedCommand(e,...i).then(n=>Ta(n))))}$unregisterCommand(e){this._commandRegistrations.deleteAndDispose(e)}$fireCommandActivationEvent(e){const t=`onCommand:${e}`;this._extensionService.activationEventIsDone(t)||this._extensionService.activateByEvent(t)}async $executeCommand(e,t,i){t instanceof rs&&(t=t.value);for(let n=0;n<t.length;n++)t[n]=Ta(t[n]);if(i&&t.length>0&&!Gt.getCommand(e))throw await this._extensionService.activateByEvent(`onCommand:${e}`),new Error("$executeCommand:retry");return this._commandService.executeCommand(e,...t)}$getCommands(){return Promise.resolve([...Gt.getCommands().keys()])}};GU=T([gt(ce.MainThreadCommands),v(1,un),v(2,yr)],GU);function Lme(r){if(typeof r=="string")return r;{const e=[r.description];if(e.push(`

`),r.args)for(const t of r.args)e.push(`* _${t.name}_ - ${t.description||""}
`);return r.returns&&e.push(`* _(returns)_ - ${r.returns}`),e.push(`

`),e.join("")}}let zU=class{constructor(e,t,i,n){this._workspaceContextService=t,this.configurationService=i,this._environmentService=n;const s=e.getProxy(fe.ExtHostConfiguration);s.$initializeConfiguration(this._getConfigurationData()),this._configurationListener=i.onDidChangeConfiguration(o=>{s.$acceptConfigurationChanged(this._getConfigurationData(),o.change)})}_getConfigurationData(){const e={...this.configurationService.getConfigurationData(),configurationScopes:[]};return(!this._environmentService.isBuilt||this._environmentService.isExtensionDevelopment)&&(e.configurationScopes=H7()),e}dispose(){this._configurationListener.dispose()}$updateConfigurationOption(e,t,i,n,s){return n={resource:n!=null&&n.resource?k.revive(n.resource):void 0,overrideIdentifier:n==null?void 0:n.overrideIdentifier},this.writeConfiguration(e,t,i,n,s)}$removeConfigurationOption(e,t,i,n){return i={resource:i!=null&&i.resource?k.revive(i.resource):void 0,overrideIdentifier:i==null?void 0:i.overrideIdentifier},this.writeConfiguration(e,t,void 0,i,n)}writeConfiguration(e,t,i,n,s){var a,c,d,l,u;e=e??this.deriveConfigurationTarget(t,n);const o=this.configurationService.inspect(t,n);switch(e){case 8:return this._updateValue(t,i,e,(a=o==null?void 0:o.memory)==null?void 0:a.override,n,s);case 6:return this._updateValue(t,i,e,(c=o==null?void 0:o.workspaceFolder)==null?void 0:c.override,n,s);case 5:return this._updateValue(t,i,e,(d=o==null?void 0:o.workspace)==null?void 0:d.override,n,s);case 4:return this._updateValue(t,i,e,(l=o==null?void 0:o.userRemote)==null?void 0:l.override,n,s);default:return this._updateValue(t,i,e,(u=o==null?void 0:o.userLocal)==null?void 0:u.override,n,s)}}_updateValue(e,t,i,n,s,o){return s=o===!0?s:o===!1?{resource:s.resource}:s.overrideIdentifier&&n!==void 0?s:{resource:s.resource},this.configurationService.updateValue(e,t,s,i,{donotNotifyError:!0})}deriveConfigurationTarget(e,t){if(t.resource&&this._workspaceContextService.getWorkbenchState()===3){const i=st.as(ks.Configuration).getConfigurationProperties();if(i[e]&&(i[e].scope===4||i[e].scope===5))return 6}return 5}};zU=T([gt(ce.MainThreadConfiguration),v(1,oi),v(2,We),v(3,ls)],zU);function J$(r){const e=[];let t;try{const i=JSON.parse(r.arguments),n=i[i.length-1];n&&n.__$stack&&(i.pop(),t=n.__$stack),e.push(...i)}catch{e.push("Unable to log remote console arguments",r.arguments)}return{args:e,stack:t}}function Fme(r){if(!r)return r;const e=r.indexOf(`
`);return e===-1?r:r.substring(0,e)}function Ome(r,e){const{args:t,stack:i}=J$(r),n=typeof t[0]=="string"&&t.length===1;let s=Fme(i);s&&(s=`(${s.trim()})`);let o=[];if(typeof t[0]=="string"?s&&n?o=[`%c[${e}] %c${t[0]} %c${s}`,fp("blue"),fp(""),fp("grey")]:o=[`%c[${e}] %c${t[0]}`,fp("blue"),fp(""),...t.slice(1)]:o=[`%c[${e}]%`,fp("blue"),...t],s&&!n&&o.push(s),typeof console[r.severity]!="function")throw new Error("Unknown console method");console[r.severity].apply(console,o)}function fp(r){return`color: ${r}`}function Nme(r,e,t=null){const i=J$(e).args;let n=i.shift();if(typeof n=="string")switch(e.severity||(e.severity="info"),t&&(/^\[/.test(t)||(t=`[${t}]`),/ $/.test(t)||(t=`${t} `),n=t+n),e.severity){case"log":case"info":r.info(n,...i);break;case"warn":r.warn(n,...i);break;case"error":r.error(n,...i);break}}function $me(r,e,t){const i=J$(e).args,n=i.shift();typeof n!="string"||e.severity!=="error"||(/^\[/.test(t)||(t=`[${t}]`),/ $/.test(t)||(t=`${t} `),r.error(t+n,...i))}let KU=class{constructor(e,t,i){this._environmentService=t,this._logService=i;const n=P$(this._environmentService);this._isExtensionDevTestFromCli=n.isExtensionDevTestFromCli}dispose(){}$logExtensionHostMessage(e){this._isExtensionDevTestFromCli?Nme(this._logService,e):($me(this._logService,e,"Extension Host"),Ome(e,"Extension Host"))}};KU=T([gt(ce.MainThreadConsole),v(1,ls),v(2,ze)],KU);let QU=class{constructor(e,t){this.debugService=t,this._toDispose=new me,this._debugAdaptersHandleCounter=1,this._proxy=e.getProxy(fe.ExtHostDebugService),this._toDispose.add(t.onDidNewSession(i=>{this._proxy.$acceptDebugSessionStarted(this.getSessionDto(i)),this._toDispose.add(i.onDidChangeName(n=>{this._proxy.$acceptDebugSessionNameChanged(this.getSessionDto(i),n)}))})),this._toDispose.add(t.onWillNewSession(i=>{this._toDispose.add(i.onDidCustomEvent(n=>this._proxy.$acceptDebugSessionCustomEvent(this.getSessionDto(i),n)))})),this._toDispose.add(t.onDidEndSession(i=>{this._proxy.$acceptDebugSessionTerminated(this.getSessionDto(i)),this._sessions.delete(i.getId())})),this._toDispose.add(t.getViewModel().onDidFocusSession(i=>{this._proxy.$acceptDebugSessionActiveChanged(this.getSessionDto(i))})),this._debugAdapters=new Map,this._debugConfigurationProviders=new Map,this._debugAdapterDescriptorFactories=new Map,this._sessions=new Set,this._toDispose.add(this.debugService.getViewModel().onDidFocusThread(({thread:i,explicit:n,session:s})=>{if(s){const o={kind:"thread",threadId:i==null?void 0:i.threadId,sessionId:s.getId()};this._proxy.$acceptStackFrameFocus(o)}})),this._toDispose.add(this.debugService.getViewModel().onDidFocusStackFrame(({stackFrame:i,explicit:n,session:s})=>{if(s){const o={kind:"stackFrame",threadId:i==null?void 0:i.thread.threadId,frameId:i==null?void 0:i.frameId,sessionId:s.getId()};this._proxy.$acceptStackFrameFocus(o)}}))}dispose(){this._toDispose.dispose()}createDebugAdapter(e){const t=this._debugAdaptersHandleCounter++,i=new Wme(this,t,this._proxy,e);return this._debugAdapters.set(t,i),i}substituteVariables(e,t){return Promise.resolve(this._proxy.$substituteVariables(e?e.uri:void 0,t))}runInTerminal(e,t){return this._proxy.$runInTerminal(e,t)}$registerDebugTypes(e){this._toDispose.add(this.debugService.getAdapterManager().registerDebugAdapterFactory(e,this))}$startBreakpointEvents(){if(!this._breakpointEventsActive){this._breakpointEventsActive=!0,this._toDispose.add(this.debugService.getModel().onDidChangeBreakpoints(n=>{if(n&&!n.sessionOnly){const s={};n.added&&(s.added=this.convertToDto(n.added)),n.removed&&(s.removed=n.removed.map(o=>o.getId())),n.changed&&(s.changed=this.convertToDto(n.changed)),(s.added||s.removed||s.changed)&&this._proxy.$acceptBreakpointsDelta(s)}}));const e=this.debugService.getModel().getBreakpoints(),t=this.debugService.getModel().getFunctionBreakpoints(),i=this.debugService.getModel().getDataBreakpoints();(e.length>0||t.length>0)&&this._proxy.$acceptBreakpointsDelta({added:this.convertToDto(e).concat(this.convertToDto(t)).concat(this.convertToDto(i))})}}$registerBreakpoints(e){for(const t of e)if(t.type==="sourceMulti"){const i=t.lines.map(n=>({id:n.id,enabled:n.enabled,lineNumber:n.line+1,column:n.character>0?n.character+1:void 0,condition:n.condition,hitCondition:n.hitCondition,logMessage:n.logMessage}));this.debugService.addBreakpoints(k.revive(t.uri),i)}else t.type==="function"?this.debugService.addFunctionBreakpoint(t.functionName,t.id):t.type==="data"&&this.debugService.addDataBreakpoint(t.label,t.dataId,t.canPersist,t.accessTypes,t.accessType);return Promise.resolve()}$unregisterBreakpoints(e,t,i){return e.forEach(n=>this.debugService.removeBreakpoints(n)),t.forEach(n=>this.debugService.removeFunctionBreakpoints(n)),i.forEach(n=>this.debugService.removeDataBreakpoints(n)),Promise.resolve()}$registerDebugConfigurationProvider(e,t,i,n,s,o){const a={type:e,triggerKind:t};return i&&(a.provideDebugConfigurations=(c,d)=>this._proxy.$provideDebugConfigurations(o,c,d)),n&&(a.resolveDebugConfiguration=(c,d,l)=>this._proxy.$resolveDebugConfiguration(o,c,d,l)),s&&(a.resolveDebugConfigurationWithSubstitutedVariables=(c,d,l)=>this._proxy.$resolveDebugConfigurationWithSubstitutedVariables(o,c,d,l)),this._debugConfigurationProviders.set(o,a),this._toDispose.add(this.debugService.getConfigurationManager().registerDebugConfigurationProvider(a)),Promise.resolve(void 0)}$unregisterDebugConfigurationProvider(e){const t=this._debugConfigurationProviders.get(e);t&&(this._debugConfigurationProviders.delete(e),this.debugService.getConfigurationManager().unregisterDebugConfigurationProvider(t))}$registerDebugAdapterDescriptorFactory(e,t){const i={type:e,createDebugAdapterDescriptor:n=>Promise.resolve(this._proxy.$provideDebugAdapter(t,this.getSessionDto(n)))};return this._debugAdapterDescriptorFactories.set(t,i),this._toDispose.add(this.debugService.getAdapterManager().registerDebugAdapterDescriptorFactory(i)),Promise.resolve(void 0)}$unregisterDebugAdapterDescriptorFactory(e){const t=this._debugAdapterDescriptorFactories.get(e);t&&(this._debugAdapterDescriptorFactories.delete(e),this.debugService.getAdapterManager().unregisterDebugAdapterDescriptorFactory(t))}getSession(e){if(e)return this.debugService.getModel().getSession(e,!0)}async $startDebugging(e,t,i){const n=e?k.revive(e):void 0,s=this.debugService.getConfigurationManager().getLaunch(n),o=this.getSession(i.parentSessionID),a=typeof i.suppressSaveBeforeStart=="boolean"?!i.suppressSaveBeforeStart:void 0,c={noDebug:i.noDebug,parentSession:o,lifecycleManagedByParent:i.lifecycleManagedByParent,repl:i.repl,compact:i.compact,compoundRoot:o==null?void 0:o.compoundRoot,saveBeforeRestart:a,suppressDebugStatusbar:i.suppressDebugStatusbar,suppressDebugToolbar:i.suppressDebugToolbar,suppressDebugView:i.suppressDebugView};try{return this.debugService.startDebugging(s,t,c,a)}catch(d){throw new rc(d&&d.message?d.message:"cannot start debugging")}}$setDebugSessionName(e,t){const i=this.debugService.getModel().getSession(e);i==null||i.setName(t)}$customDebugAdapterRequest(e,t,i){const n=this.debugService.getModel().getSession(e,!0);return n?n.customRequest(t,i).then(s=>s&&s.success?s.body:Promise.reject(new rc(s?s.message:"custom request failed"))):Promise.reject(new rc("debug session not found"))}$getDebugProtocolBreakpoint(e,t){const i=this.debugService.getModel().getSession(e,!0);return i?Promise.resolve(i.getDebugProtocolBreakpoint(t)):Promise.reject(new rc("debug session not found"))}$stopDebugging(e){if(e){const t=this.debugService.getModel().getSession(e,!0);if(t)return this.debugService.stopSession(t,Z5(t))}else return this.debugService.stopSession(void 0);return Promise.reject(new rc("debug session not found"))}$appendDebugConsole(e){const t=this.debugService.getViewModel().focusedSession;t==null||t.appendToRepl({output:e,sev:yi.Warning})}$acceptDAMessage(e,t){this.getDebugAdapter(e).acceptMessage(r8(t,!1))}$acceptDAError(e,t,i,n){this.getDebugAdapter(e).fireError(e,new Error(`${t}: ${i}
${n}`))}$acceptDAExit(e,t,i){this.getDebugAdapter(e).fireExit(e,t,i)}getDebugAdapter(e){const t=this._debugAdapters.get(e);if(!t)throw new Error("Invalid debug adapter");return t}$sessionCached(e){this._sessions.add(e)}getSessionDto(e){var t;if(e){const i=e.getId();return this._sessions.has(i)?i:{id:i,type:e.configuration.type,name:e.name,folderUri:e.root?e.root.uri:void 0,configuration:e.configuration,parent:(t=e.parentSession)==null?void 0:t.getId()}}}convertToDto(e){return e.map(t=>{if("name"in t){const i=t;return{type:"function",id:i.getId(),enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,functionName:i.name}}else if("dataId"in t){const i=t;return{type:"data",id:i.getId(),dataId:i.dataId,enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,label:i.description,canPersist:i.canPersist}}else{const i=t;return{type:"source",id:i.getId(),enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,uri:i.uri,line:i.lineNumber>0?i.lineNumber-1:0,character:typeof i.column=="number"&&i.column>0?i.column-1:0}}})}};QU=T([gt(ce.MainThreadDebugService),v(1,wz)],QU);class Wme extends J5{constructor(e,t,i,n){super(),this._ds=e,this._handle=t,this._proxy=i,this._session=n}fireError(e,t){this._onError.fire(t)}fireExit(e,t,i){this._onExit.fire(t)}startSession(){return Promise.resolve(this._proxy.$startDASession(this._handle,this._ds.getSessionDto(this._session)))}sendMessage(e){this._proxy.$sendDAMessage(this._handle,n8(e,!0))}async stopSession(){return await this.cancelPendingRequests(),Promise.resolve(this._proxy.$stopDASession(this._handle))}}class Hme{constructor(e,t){this._proxy=e,this._handle=t,this._idPool=0,this._requests=new Map,this._resolver=new Map}enqueue(e,t){const i=++this._idPool,n=new Promise(o=>{this._requests.set(i,{id:i,uri:e}),this._resolver.set(i,o),this._processQueue()}),s=t.onCancellationRequested(()=>{this._requests.delete(i),this._resolver.delete(i)});return n.finally(()=>s.dispose())}_processQueue(){typeof this._timer!="number"&&(this._timer=setTimeout(()=>{const e=this._requests,t=this._resolver;this._proxy.$provideDecorations(this._handle,[...e.values()],_t.None).then(i=>{for(const[n,s]of t)s(i[n])}),this._requests=new Map,this._resolver=new Map,this._timer=void 0},0))}}let YU=class{constructor(e,t){this._decorationsService=t,this._provider=new Map,this._proxy=e.getProxy(fe.ExtHostDecorations)}dispose(){this._provider.forEach(e=>vt(e)),this._provider.clear()}$registerDecorationProvider(e,t){const i=new A,n=new Hme(this._proxy,e),s=this._decorationsService.registerDecorationsProvider({label:t,onDidChange:i.event,provideDecorations:async(o,a)=>{const c=await n.enqueue(o,a);if(!c)return;const[d,l,u,h]=c;return{weight:10,bubble:d??!1,color:h==null?void 0:h.id,tooltip:l,letter:u}}});this._provider.set(e,[i,s])}$onDidChange(e,t){const i=this._provider.get(e);if(i){const[n]=i;n.fire(t&&t.map(s=>k.revive(s)))}}$unregisterDecorationProvider(e){const t=this._provider.get(e);t&&(vt(t),this._provider.delete(e))}};YU=T([gt(ce.MainThreadDecorations),v(1,Su)],YU);let XU=class{constructor(e,t,i){this._markerService=t,this._uriIdentService=i,this._activeOwners=new Set,this._proxy=e.getProxy(fe.ExtHostDiagnostics),this._markerListener=this._markerService.onMarkerChanged(this._forwardMarkers,this)}dispose(){this._markerListener.dispose(),this._activeOwners.forEach(e=>this._markerService.changeAll(e,[])),this._activeOwners.clear()}_forwardMarkers(e){const t=[];for(const i of e){const n=this._markerService.read({resource:i});if(n.length===0)t.push([i,[]]);else{const s=n.filter(o=>!this._activeOwners.has(o.owner));s.length>0&&t.push([i,s])}}t.length>0&&this._proxy.$acceptMarkersChange(t)}$changeMany(e,t){for(const i of t){const[n,s]=i;if(s)for(const o of s){if(o.relatedInformation)for(const a of o.relatedInformation)a.resource=k.revive(a.resource);o.code&&typeof o.code!="string"&&(o.code.target=k.revive(o.code.target))}this._markerService.changeOne(e,this._uriIdentService.asCanonicalUri(k.revive(n)),s)}this._activeOwners.add(e)}$clear(e){this._markerService.changeAll(e,[]),this._activeOwners.delete(e)}};XU=T([gt(ce.MainThreadDiagnostics),v(1,j7),v(2,Hi)],XU);var iC;let JU=iC=class{constructor(e,t){this._fileDialogService=t}dispose(){}async $showOpenDialog(e){const t=iC._convertOpenOptions(e);return t.defaultUri||(t.defaultUri=await this._fileDialogService.defaultFilePath()),Promise.resolve(this._fileDialogService.showOpenDialog(t))}async $showSaveDialog(e){const t=iC._convertSaveOptions(e);return t.defaultUri||(t.defaultUri=await this._fileDialogService.defaultFilePath()),Promise.resolve(this._fileDialogService.showSaveDialog(t))}static _convertOpenOptions(e){const t={openLabel:(e==null?void 0:e.openLabel)||void 0,canSelectFiles:(e==null?void 0:e.canSelectFiles)||!(e!=null&&e.canSelectFiles)&&!(e!=null&&e.canSelectFolders),canSelectFolders:e==null?void 0:e.canSelectFolders,canSelectMany:e==null?void 0:e.canSelectMany,defaultUri:e!=null&&e.defaultUri?k.revive(e.defaultUri):void 0,title:(e==null?void 0:e.title)||void 0,availableFileSystems:e!=null&&e.allowUIResources?[pe.vscodeRemote,pe.file]:[]};if(e!=null&&e.filters){t.filters=[];for(const[i,n]of Object.entries(e.filters))t.filters.push({name:i,extensions:n})}return t}static _convertSaveOptions(e){const t={defaultUri:e!=null&&e.defaultUri?k.revive(e.defaultUri):void 0,saveLabel:(e==null?void 0:e.saveLabel)||void 0,title:(e==null?void 0:e.title)||void 0};if(e!=null&&e.filters){t.filters=[];for(const[i,n]of Object.entries(e.filters))t.filters.push({name:i,extensions:n})}return t}};JU=iC=T([gt(ce.MainThreadDialogs),v(1,ia)],JU);let ZU=class{constructor(e,t,i,n,s){this._textModelResolverService=t,this._languageService=i,this._modelService=n,this._editorWorkerService=s,this._resourceContentProvider=new mr,this._pendingUpdate=new Map,this._proxy=e.getProxy(fe.ExtHostDocumentContentProviders)}dispose(){this._resourceContentProvider.dispose(),vt(this._pendingUpdate.values())}$registerTextContentProvider(e,t){const i=this._textModelResolverService.registerTextModelContentProvider(t,{provideTextContent:n=>this._proxy.$provideTextDocumentContent(e,n).then(s=>{if(typeof s=="string"){const o=s.substr(0,1+s.search(/\r?\n/)),a=this._languageService.createByFilepathOrFirstLine(n,o);return this._modelService.createModel(s,a,n)}return null})});this._resourceContentProvider.set(e,i)}$unregisterTextContentProvider(e){this._resourceContentProvider.deleteAndDispose(e)}$onVirtualDocumentChange(e,t){const i=this._modelService.getModel(k.revive(e));if(!i)return;const n=this._pendingUpdate.get(i.id);n==null||n.cancel();const s=new Xt;this._pendingUpdate.set(i.id,s),this._editorWorkerService.computeMoreMinimalEdits(i.uri,[{text:t,range:i.getFullModelRange()}]).then(o=>{this._pendingUpdate.delete(i.id),!s.token.isCancellationRequested&&o&&o.length>0&&i.applyEdits(o.map(a=>ma.replace(qe.lift(a.range),a.text)))}).catch(en)}};ZU=T([gt(ce.MainThreadDocumentContentProviders),v(1,or),v(2,ji),v(3,_i),v(4,Zw)],ZU);class R8{constructor(e,t=1e3*60*3,i=1024*1024*80,n=50){this._extUri=e,this._maxAge=t,this._maxLength=i,this._maxSize=n,this._data=new Array,this._length=0}dispose(){this._data=vt(this._data)}remove(e){for(const t of[...this._data])this._extUri.isEqualOrParent(t.uri,e)&&t.dispose()}add(e,t,i=0){const n=()=>{const a=this._data.indexOf(o);a>=0&&(this._length-=i,t.dispose(),clearTimeout(s),this._data.splice(a,1))},s=setTimeout(n,this._maxAge),o={uri:e,length:i,dispose:n};this._data.push(o),this._length+=i,this._cleanup()}_cleanup(){for(;this._length>this._maxLength;)this._data[0].dispose();const e=Math.ceil(this._maxSize*1.2);this._data.length>=e&&vt(this._data.slice(0,e-this._maxSize))}}class jme extends ne{constructor(e,t,i,n){super(),this._model=e,this._onIsCaughtUpWithContentChanges=t,this._proxy=i,this._textFileService=n,this._knownVersionId=this._model.getVersionId(),this._store.add(this._model.onDidChangeContent(s=>{this._knownVersionId=s.versionId,this._proxy.$acceptModelChanged(this._model.uri,s,this._textFileService.isDirty(this._model.uri)),this.isCaughtUpWithContentChanges()&&this._onIsCaughtUpWithContentChanges.fire(this._model.uri)}))}isCaughtUpWithContentChanges(){return this._model.getVersionId()===this._knownVersionId}}let DF=class extends ne{constructor(e,t,i,n,s,o,a,c,d){super(),this._modelService=t,this._textFileService=i,this._fileService=n,this._textModelResolverService=s,this._environmentService=o,this._uriIdentityService=a,this._pathService=d,this._onIsCaughtUpWithContentChanges=this._store.add(new A),this.onIsCaughtUpWithContentChanges=this._onIsCaughtUpWithContentChanges.event,this._modelTrackers=new ki,this._modelReferenceCollection=this._store.add(new R8(a.extUri)),this._proxy=e.getProxy(fe.ExtHostDocuments),this._store.add(t.onModelLanguageChanged(this._onModelModeChanged,this)),this._store.add(i.files.onDidSave(l=>{this._shouldHandleFileEvent(l.model.resource)&&this._proxy.$acceptModelSaved(l.model.resource)})),this._store.add(i.files.onDidChangeDirty(l=>{this._shouldHandleFileEvent(l.resource)&&this._proxy.$acceptDirtyStateChanged(l.resource,l.isDirty())})),this._store.add(c.onDidRunWorkingCopyFileOperation(l=>{const u=l.operation===2;if(u||l.operation===1)for(const h of l.files){const g=u?h.source:h.target;g&&this._modelReferenceCollection.remove(g)}}))}dispose(){vt(this._modelTrackers.values()),this._modelTrackers.clear(),super.dispose()}isCaughtUpWithContentChanges(e){const t=this._modelTrackers.get(e);return t?t.isCaughtUpWithContentChanges():!0}_shouldHandleFileEvent(e){const t=this._modelService.getModel(e);return!!t&&Sh(t)}handleModelAdded(e){Sh(e)&&this._modelTrackers.set(e.uri,new jme(e,this._onIsCaughtUpWithContentChanges,this._proxy,this._textFileService))}_onModelModeChanged(e){const{model:t}=e;this._modelTrackers.has(t.uri)&&this._proxy.$acceptModelLanguageChanged(t.uri,t.getLanguageId())}handleModelRemoved(e){this._modelTrackers.has(e)&&(this._modelTrackers.get(e).dispose(),this._modelTrackers.delete(e))}async $trySaveDocument(e){return!!await this._textFileService.save(k.revive(e))}async $tryOpenDocument(e){const t=k.revive(e);if(!t.scheme||!(t.fsPath||t.authority))throw new Error("Invalid uri. Scheme and authority or path must be set.");const i=this._uriIdentityService.asCanonicalUri(t);let n;switch(i.scheme){case pe.untitled:n=this._handleUntitledScheme(i);break;case pe.file:default:n=this._handleAsResourceInput(i);break}let s;try{s=await n}catch(o){throw new Error(`cannot open ${i.toString()}. Detail: ${La(o)}`)}if(s)if(Yw.isEqual(s,i)){if(this._modelTrackers.has(i))return i;throw new Error(`cannot open ${i.toString()}. Detail: Files above 50MB cannot be synchronized with extensions.`)}else throw new Error(`cannot open ${i.toString()}. Detail: Actual document opened as ${s.toString()}`);else throw new Error(`cannot open ${i.toString()}`)}$tryCreateDocument(e){return this._doCreateUntitled(void 0,e?e.language:void 0,e?e.content:void 0)}async _handleAsResourceInput(e){const t=await this._textModelResolverService.createModelReference(e);return this._modelReferenceCollection.add(e,t,t.object.textEditorModel.getValueLength()),t.object.textEditorModel.uri}async _handleUntitledScheme(e){const t=zy(e,this._environmentService.remoteAuthority,this._pathService.defaultUriScheme);return await this._fileService.exists(t)?Promise.reject(new Error("file already exists")):await this._doCreateUntitled(e.path?e:void 0)}async _doCreateUntitled(e,t,i){const s=(await this._textFileService.untitled.resolve({associatedResource:e,languageId:t,initialValue:i})).resource;if(!this._modelTrackers.has(s))throw new Error(`expected URI ${s.toString()} to have come to LIFE`);return this._proxy.$acceptDirtyStateChanged(s,!0),s}};DF=T([v(1,_i),v(2,Dn),v(3,at),v(4,or),v(5,Ar),v(6,Hi),v(7,$a),v(8,ta)],DF);class tc{static readFromEditor(e,t,i){const n=tc._readSelectionsFromCodeEditor(e,i),s=tc._readOptionsFromCodeEditor(e,t,i),o=tc._readVisibleRangesFromCodeEditor(e,i);return new tc(n,s,o)}static _readSelectionsFromCodeEditor(e,t){let i=null;return t&&(i=t.getSelections()),!i&&e&&(i=e.selections),i||(i=[new ef(1,1,1,1)]),i}static _readOptionsFromCodeEditor(e,t,i){if(t.isDisposed()){if(e)return e.options;throw new Error("No valid properties")}let n,s;if(i){const a=i.getOptions(),c=a.get(65);n=a.get(26),s=c.renderType}else e?(n=e.options.cursorStyle,s=e.options.lineNumbers):(n=HN.Line,s=1);const o=t.getOptions();return{insertSpaces:o.insertSpaces,tabSize:o.tabSize,indentSize:o.indentSize,cursorStyle:n,lineNumbers:s}}static _readVisibleRangesFromCodeEditor(e,t){return t?t.getVisibleRanges():[]}constructor(e,t,i){this.selections=e,this.options=t,this.visibleRanges=i}generateDelta(e,t){const i={options:null,selections:null,visibleRanges:null};return(!e||!tc._selectionsEqual(e.selections,this.selections))&&(i.selections={selections:this.selections,source:ii(t)}),(!e||!tc._optionsEqual(e.options,this.options))&&(i.options=this.options),(!e||!tc._rangesEqual(e.visibleRanges,this.visibleRanges))&&(i.visibleRanges=this.visibleRanges),i.selections||i.options||i.visibleRanges?i:null}static _selectionsEqual(e,t){return Ds(e,t,(i,n)=>i.equalsSelection(n))}static _rangesEqual(e,t){return Ds(e,t,(i,n)=>i.equalsRange(n))}static _optionsEqual(e,t){return e&&!t||!e&&t?!1:!e&&!t?!0:e.tabSize===t.tabSize&&e.indentSize===t.indentSize&&e.insertSpaces===t.insertSpaces&&e.cursorStyle===t.cursorStyle&&e.lineNumbers===t.lineNumbers}}class Bme{constructor(e,t,i,n,s,o,a){this._modelListeners=new me,this._codeEditorListeners=new me,this._id=e,this._model=t,this._codeEditor=null,this._properties=null,this._focusTracker=n,this._mainThreadDocuments=s,this._modelService=o,this._clipboardService=a,this._onPropertiesChanged=new A,this._modelListeners.add(this._model.onDidChangeOptions(c=>{this._updatePropertiesNow(null)})),this.setCodeEditor(i),this._updatePropertiesNow(null)}dispose(){this._modelListeners.dispose(),this._codeEditor=null,this._codeEditorListeners.dispose()}_updatePropertiesNow(e){this._setProperties(tc.readFromEditor(this._properties,this._model,this._codeEditor),e)}_setProperties(e,t){const i=e.generateDelta(this._properties,t);this._properties=e,i&&this._onPropertiesChanged.fire(i)}getId(){return this._id}getModel(){return this._model}getCodeEditor(){return this._codeEditor}hasCodeEditor(e){return this._codeEditor===e}setCodeEditor(e){if(!this.hasCodeEditor(e)&&(this._codeEditorListeners.clear(),this._codeEditor=e,this._codeEditor)){this._codeEditorListeners.add(this._codeEditor.onDidChangeModel(()=>{this.setCodeEditor(null)})),this._codeEditorListeners.add(this._codeEditor.onDidFocusEditorWidget(()=>{this._focusTracker.onGainedFocus()})),this._codeEditorListeners.add(this._codeEditor.onDidBlurEditorWidget(()=>{this._focusTracker.onLostFocus()}));let t=null;this._codeEditorListeners.add(this._mainThreadDocuments.onIsCaughtUpWithContentChanges(s=>{if(s.toString()===this._model.uri.toString()){const o=t;t=null,this._updatePropertiesNow(o)}}));const i=()=>this._codeEditor&&this._codeEditor.getModel()===this._model,n=s=>{this._mainThreadDocuments.isCaughtUpWithContentChanges(this._model.uri)?(t=null,this._updatePropertiesNow(s)):t=s};this._codeEditorListeners.add(this._codeEditor.onDidChangeCursorSelection(s=>{i()&&n(s.source)})),this._codeEditorListeners.add(this._codeEditor.onDidChangeConfiguration(s=>{i()&&n(null)})),this._codeEditorListeners.add(this._codeEditor.onDidLayoutChange(()=>{i()&&n(null)})),this._codeEditorListeners.add(this._codeEditor.onDidScrollChange(()=>{i()&&n(null)})),this._updatePropertiesNow(null)}}isVisible(){return!!this._codeEditor}getProperties(){return this._properties}get onPropertiesChanged(){return this._onPropertiesChanged.event}setSelections(e){if(this._codeEditor){this._codeEditor.setSelections(e);return}const t=e.map(ef.liftSelection);this._setProperties(new tc(t,this._properties.options,this._properties.visibleRanges),null)}_setIndentConfiguration(e){const t=this._modelService.getCreationOptions(this._model.getLanguageId(),this._model.uri,this._model.isForSimpleWidget);if(e.tabSize==="auto"||e.insertSpaces==="auto"){let n=t.insertSpaces,s=t.tabSize;e.insertSpaces!=="auto"&&typeof e.insertSpaces<"u"&&(n=e.insertSpaces),e.tabSize!=="auto"&&typeof e.tabSize<"u"&&(s=e.tabSize),this._model.detectIndentation(n,s);return}const i={};typeof e.insertSpaces<"u"&&(i.insertSpaces=e.insertSpaces),typeof e.tabSize<"u"&&(i.tabSize=e.tabSize),typeof e.indentSize<"u"&&(i.indentSize=e.indentSize),this._model.updateOptions(i)}setConfiguration(e){if(this._setIndentConfiguration(e),!!this._codeEditor){if(e.cursorStyle){const t=B7(e.cursorStyle);this._codeEditor.updateOptions({cursorStyle:t})}if(typeof e.lineNumbers<"u"){let t;switch(e.lineNumbers){case 1:t="on";break;case 2:t="relative";break;default:t="off"}this._codeEditor.updateOptions({lineNumbers:t})}}}setDecorations(e,t){this._codeEditor&&this._codeEditor.setDecorationsByType("exthost-api",e,t)}setDecorationsFast(e,t){if(!this._codeEditor)return;const i=[];for(let n=0,s=Math.floor(t.length/4);n<s;n++)i[n]=new qe(t[4*n],t[4*n+1],t[4*n+2],t[4*n+3]);this._codeEditor.setDecorationsByTypeFast(e,i)}revealRange(e,t){if(this._codeEditor)switch(t){case Gp.Default:this._codeEditor.revealRange(e,0);break;case Gp.InCenter:this._codeEditor.revealRangeInCenter(e,0);break;case Gp.InCenterIfOutsideViewport:this._codeEditor.revealRangeInCenterIfOutsideViewport(e,0);break;case Gp.AtTop:this._codeEditor.revealRangeAtTop(e,0);break;default:console.warn(`Unknown revealType: ${t}`);break}}isFocused(){return this._codeEditor?this._codeEditor.hasTextFocus():!1}matches(e){return e?e.getControl()===this._codeEditor:!1}applyEdits(e,t,i){if(this._model.getVersionId()!==e||!this._codeEditor)return!1;typeof i.setEndOfLine<"u"&&this._model.pushEOL(i.setEndOfLine);const n=t.map(s=>({range:qe.lift(s.range),text:s.text,forceMoveMarkers:s.forceMoveMarkers}));return i.undoStopBefore&&this._codeEditor.pushUndoStop(),this._codeEditor.executeEdits("MainThreadTextEditor",n),i.undoStopAfter&&this._codeEditor.pushUndoStop(),!0}async insertSnippet(e,t,i,n){if(!this._codeEditor||!this._codeEditor.hasModel())return!1;let s;if(zN.guessNeedsClipboard(t)){const d=new Mq(this._codeEditor,5);if(s=await this._clipboardService.readText(),!d.validate(this._codeEditor))return!1}if(this._codeEditor.getModel().getVersionId()!==e)return!1;const a=nf.get(this._codeEditor);if(!a)return!1;const c=i.map(d=>new ef(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn));return this._codeEditor.setSelections(c),this._codeEditor.focus(),a.insert(t,{overwriteBefore:0,overwriteAfter:0,undoStopBefore:n.undoStopBefore,undoStopAfter:n.undoStopAfter,clipboardText:s}),!0}}function qh(r,e,t=Vl){if(t===Vl||t===Ed)return t;let i=r.getGroups(2)[t];if(!i&&t<9){for(let n=0;n<=t;n++){const s=r.getGroups(2);s[n]||r.addGroup(s[n-1],Vf(e))}i=r.getGroups(2)[t]}return(i==null?void 0:i.id)??Ed}function gu(r,e){const t=typeof e=="number"?r.getGroup(e):e;return r.getGroups(2).indexOf(t??r.activeGroup)}let Jx=class P8{constructor(e,t,i,n,s,o){this._editorLocator=e,this._codeEditorService=i,this._editorService=n,this._editorGroupService=s,this._configurationService=o,this._toDispose=new me,this._instanceId=String(++P8.INSTANCE_COUNT),this._proxy=t.getProxy(fe.ExtHostEditors),this._textEditorsListenersMap=Object.create(null),this._editorPositionData=null,this._toDispose.add(this._editorService.onDidVisibleEditorsChange(()=>this._updateActiveAndVisibleTextEditors())),this._toDispose.add(this._editorGroupService.onDidRemoveGroup(()=>this._updateActiveAndVisibleTextEditors())),this._toDispose.add(this._editorGroupService.onDidMoveGroup(()=>this._updateActiveAndVisibleTextEditors())),this._registeredDecorationTypes=Object.create(null)}dispose(){Object.keys(this._textEditorsListenersMap).forEach(e=>{vt(this._textEditorsListenersMap[e])}),this._textEditorsListenersMap=Object.create(null),this._toDispose.dispose();for(const e in this._registeredDecorationTypes)this._codeEditorService.removeDecorationType(e);this._registeredDecorationTypes=Object.create(null)}handleTextEditorAdded(e){const t=e.getId(),i=[];i.push(e.onPropertiesChanged(n=>{this._proxy.$acceptEditorPropertiesChanged(t,n)})),this._textEditorsListenersMap[t]=i}handleTextEditorRemoved(e){vt(this._textEditorsListenersMap[e]),delete this._textEditorsListenersMap[e]}_updateActiveAndVisibleTextEditors(){const e=this._getTextEditorPositionData();xa(this._editorPositionData,e)||(this._editorPositionData=e,this._proxy.$acceptEditorPositionData(this._editorPositionData))}_getTextEditorPositionData(){const e=Object.create(null);for(const t of this._editorService.visibleEditorPanes){const i=this._editorLocator.findTextEditorIdFor(t);i&&(e[i]=gu(this._editorGroupService,t.group))}return e}async $tryShowTextDocument(e,t){const i=k.revive(e),n={preserveFocus:t.preserveFocus,pinned:t.pinned,selection:t.selection,activation:t.preserveFocus?Yy.RESTORE:void 0,override:uG.EXCLUSIVE_ONLY},s={resource:i,options:n},o=await this._editorService.openEditor(s,qh(this._editorGroupService,this._configurationService,t.position));if(!o)return;const a=o.getControl(),c=U7(a);return c?this._editorLocator.getIdOfCodeEditor(c):void 0}async $tryShowEditor(e,t){const i=this._editorLocator.getEditor(e);if(i){const n=i.getModel();await this._editorService.openEditor({resource:n.uri,options:{preserveFocus:!1}},qh(this._editorGroupService,this._configurationService,t));return}}async $tryHideEditor(e){const t=this._editorLocator.getEditor(e);if(t){const i=this._editorService.visibleEditorPanes;for(const n of i)if(t.matches(n)){await n.group.closeEditor(n.input);return}}}$trySetSelections(e,t){const i=this._editorLocator.getEditor(e);return i?(i.setSelections(t),Promise.resolve(void 0)):Promise.reject(ku(`TextEditor(${e})`))}$trySetDecorations(e,t,i){t=`${this._instanceId}-${t}`;const n=this._editorLocator.getEditor(e);return n?(n.setDecorations(t,i),Promise.resolve(void 0)):Promise.reject(ku(`TextEditor(${e})`))}$trySetDecorationsFast(e,t,i){t=`${this._instanceId}-${t}`;const n=this._editorLocator.getEditor(e);return n?(n.setDecorationsFast(t,i),Promise.resolve(void 0)):Promise.reject(ku(`TextEditor(${e})`))}$tryRevealRange(e,t,i){const n=this._editorLocator.getEditor(e);return n?(n.revealRange(t,i),Promise.resolve()):Promise.reject(ku(`TextEditor(${e})`))}$trySetOptions(e,t){const i=this._editorLocator.getEditor(e);return i?(i.setConfiguration(t),Promise.resolve(void 0)):Promise.reject(ku(`TextEditor(${e})`))}$tryApplyEdits(e,t,i,n){const s=this._editorLocator.getEditor(e);return s?Promise.resolve(s.applyEdits(t,i,n)):Promise.reject(ku(`TextEditor(${e})`))}$tryInsertSnippet(e,t,i,n,s){const o=this._editorLocator.getEditor(e);return o?Promise.resolve(o.insertSnippet(t,i,n,s)):Promise.reject(ku(`TextEditor(${e})`))}$registerTextEditorDecorationType(e,t,i){t=`${this._instanceId}-${t}`,this._registeredDecorationTypes[t]=!0,this._codeEditorService.registerDecorationType(`exthost-api-${e}`,t,i)}$removeTextEditorDecorationType(e){e=`${this._instanceId}-${e}`,delete this._registeredDecorationTypes[e],this._codeEditorService.removeDecorationType(e)}$getDiffInformation(e){const t=this._editorLocator.getEditor(e);if(!t)return Promise.reject(new Error("No such TextEditor"));const i=t.getCodeEditor();if(!i)return Promise.reject(new Error("No such CodeEditor"));const n=i.getId(),s=this._codeEditorService.listDiffEditors(),[o]=s.filter(c=>c.getOriginalEditor().getId()===n||c.getModifiedEditor().getId()===n);if(o)return Promise.resolve(o.getLineChanges()||[]);const a=i.getContribution("editor.contrib.dirtydiff");return a?Promise.resolve(a.getChanges()):Promise.resolve([])}};Jx.INSTANCE_COUNT=0;Jx=T([v(2,En),v(3,Ke),v(4,it),v(5,We)],Jx);Gt.registerCommand("_workbench.revertAllDirty",async function(r){if(!r.get(ls).extensionTestsLocationURI)throw new Error("Command is only available when running extension tests.");const t=r.get(Od);for(const i of t.dirtyWorkingCopies)await i.revert({soft:!0})});class Ume{constructor(e){this.editor=e,this.id=`${e.getId()},${e.getModel().id}`}}class kF{constructor(e,t,i,n,s,o){this.removedDocuments=e,this.addedDocuments=t,this.removedEditors=i,this.addedEditors=n,this.oldActiveEditor=s,this.newActiveEditor=o,this.isEmpty=this.removedDocuments.length===0&&this.addedDocuments.length===0&&this.removedEditors.length===0&&this.addedEditors.length===0&&s===o}toString(){let e=`DocumentAndEditorStateDelta
`;return e+=`	Removed Documents: [${this.removedDocuments.map(t=>t.uri.toString(!0)).join(", ")}]
`,e+=`	Added Documents: [${this.addedDocuments.map(t=>t.uri.toString(!0)).join(", ")}]
`,e+=`	Removed Editors: [${this.removedEditors.map(t=>t.id).join(", ")}]
`,e+=`	Added Editors: [${this.addedEditors.map(t=>t.id).join(", ")}]
`,e+=`	New Active Editor: ${this.newActiveEditor}
`,e}}class oP{static compute(e,t){if(!e)return new kF([],[...t.documents.values()],[],[...t.textEditors.values()],void 0,t.activeEditor);const i=i1(e.documents,t.documents),n=OP(e.textEditors,t.textEditors),s=e.activeEditor!==t.activeEditor?e.activeEditor:void 0,o=e.activeEditor!==t.activeEditor?t.activeEditor:void 0;return new kF(i.removed,i.added,n.removed,n.added,s,o)}constructor(e,t,i){this.documents=e,this.textEditors=t,this.activeEditor=i}}let TF=class{constructor(e,t,i,n,s){this._onDidChangeState=e,this._modelService=t,this._codeEditorService=i,this._editorService=n,this._paneCompositeService=s,this._toDispose=new me,this._toDisposeOnEditorRemove=new mr,this._activeEditorOrder=0,this._modelService.onModelAdded(this._updateStateOnModelAdd,this,this._toDispose),this._modelService.onModelRemoved(o=>this._updateState(),this,this._toDispose),this._editorService.onDidActiveEditorChange(o=>this._updateState(),this,this._toDispose),this._codeEditorService.onCodeEditorAdd(this._onDidAddEditor,this,this._toDispose),this._codeEditorService.onCodeEditorRemove(this._onDidRemoveEditor,this,this._toDispose),this._codeEditorService.listCodeEditors().forEach(this._onDidAddEditor,this),F.filter(this._paneCompositeService.onDidPaneCompositeOpen,o=>o.viewContainerLocation===1)(o=>this._activeEditorOrder=1,void 0,this._toDispose),F.filter(this._paneCompositeService.onDidPaneCompositeClose,o=>o.viewContainerLocation===1)(o=>this._activeEditorOrder=0,void 0,this._toDispose),this._editorService.onDidVisibleEditorsChange(o=>this._activeEditorOrder=0,void 0,this._toDispose),this._updateState()}dispose(){this._toDispose.dispose(),this._toDisposeOnEditorRemove.dispose()}_onDidAddEditor(e){this._toDisposeOnEditorRemove.set(e.getId(),Da(e.onDidChangeModel(()=>this._updateState()),e.onDidFocusEditorText(()=>this._updateState()),e.onDidFocusEditorWidget(()=>this._updateState(e)))),this._updateState()}_onDidRemoveEditor(e){const t=e.getId();this._toDisposeOnEditorRemove.has(t)&&(this._toDisposeOnEditorRemove.deleteAndDispose(t),this._updateState())}_updateStateOnModelAdd(e){if(Sh(e)){if(!this._currentState){this._updateState();return}this._currentState=new oP(this._currentState.documents.add(e),this._currentState.textEditors,this._currentState.activeEditor),this._onDidChangeState(new kF([],[e],[],[],void 0,void 0))}}_updateState(e){const t=new Set;for(const a of this._modelService.getModels())Sh(a)&&t.add(a);const i=new Map;let n=null;for(const a of this._codeEditorService.listCodeEditors()){if(a.isSimpleWidget)continue;const c=a.getModel();if(a.hasModel()&&c&&Sh(c)&&!c.isDisposed()&&this._modelService.getModel(c.uri)){const d=new Ume(a);i.set(d.id,d),(a.hasTextFocus()||e===a&&a.hasWidgetFocus())&&(n=d.id)}}if(!n){let a;if(this._activeEditorOrder===0?a=this._getActiveEditorFromEditorPart()||this._getActiveEditorFromPanel():a=this._getActiveEditorFromPanel()||this._getActiveEditorFromEditorPart(),a)for(const c of i.values())a===c.editor&&(n=c.id)}const s=new oP(t,i,n),o=oP.compute(this._currentState,s);o.isEmpty||(this._currentState=s,this._onDidChangeState(o))}_getActiveEditorFromPanel(){const e=this._paneCompositeService.getActivePaneComposite(1);if(e instanceof Hge){const t=e.getControl();if(Ch(t))return t}}_getActiveEditorFromEditorPart(){let e=this._editorService.activeTextEditorControl;return s1(e)&&(e=e.getModifiedEditor()),e}};TF=T([v(1,_i),v(2,En),v(3,Ke),v(4,Jm)],TF);let eV=class{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y){this._modelService=t,this._textFileService=i,this._editorService=n,this._editorGroupService=c,this._clipboardService=g,this._toDispose=new me,this._textEditors=new Map,this._proxy=e.getProxy(fe.ExtHostDocumentsAndEditors),this._mainThreadDocuments=this._toDispose.add(new DF(e,this._modelService,this._textFileService,o,a,l,h,u,m)),e.set(ce.MainThreadDocuments,this._mainThreadDocuments),this._mainThreadEditors=this._toDispose.add(new Jx(this,e,s,this._editorService,this._editorGroupService,y)),e.set(ce.MainThreadTextEditors,this._mainThreadEditors),this._toDispose.add(new TF(_=>this._onDelta(_),t,s,this._editorService,d))}dispose(){this._toDispose.dispose()}_onDelta(e){const t=[],i=[],n=e.removedDocuments.map(a=>a.uri);for(const a of e.addedEditors){const c=new Bme(a.id,a.editor.getModel(),a.editor,{onGainedFocus(){},onLostFocus(){}},this._mainThreadDocuments,this._modelService,this._clipboardService);this._textEditors.set(a.id,c),i.push(c)}for(const{id:a}of e.removedEditors){const c=this._textEditors.get(a);c&&(c.dispose(),this._textEditors.delete(a),t.push(a))}const s=Object.create(null);let o=!0;e.newActiveEditor!==void 0&&(o=!1,s.newActiveEditor=e.newActiveEditor),n.length>0&&(o=!1,s.removedDocuments=n),t.length>0&&(o=!1,s.removedEditors=t),e.addedDocuments.length>0&&(o=!1,s.addedDocuments=e.addedDocuments.map(a=>this._toModelAddData(a))),e.addedEditors.length>0&&(o=!1,s.addedEditors=i.map(a=>this._toTextEditorAddData(a))),o||(this._proxy.$acceptDocumentsAndEditorsDelta(s),n.forEach(this._mainThreadDocuments.handleModelRemoved,this._mainThreadDocuments),e.addedDocuments.forEach(this._mainThreadDocuments.handleModelAdded,this._mainThreadDocuments),t.forEach(this._mainThreadEditors.handleTextEditorRemoved,this._mainThreadEditors),i.forEach(this._mainThreadEditors.handleTextEditorAdded,this._mainThreadEditors))}_toModelAddData(e){return{uri:e.uri,versionId:e.getVersionId(),lines:e.getLinesContent(),EOL:e.getEOL(),languageId:e.getLanguageId(),isDirty:this._textFileService.isDirty(e.uri)}}_toTextEditorAddData(e){const t=e.getProperties();return{id:e.getId(),documentUri:e.getModel().uri,options:t.options,selections:t.selections,visibleRanges:t.visibleRanges,editorPosition:this._findEditorPosition(e)}}_findEditorPosition(e){for(const t of this._editorService.visibleEditorPanes)if(e.matches(t))return gu(this._editorGroupService,t.group)}findTextEditorIdFor(e){for(const[t,i]of this._textEditors)if(i.matches(e))return t}getIdOfCodeEditor(e){for(const[t,i]of this._textEditors)if(i.getCodeEditor()===e)return t}getEditor(e){return this._textEditors.get(e)}};eV=T([Eu,v(1,_i),v(2,Dn),v(3,Ke),v(4,En),v(5,at),v(6,or),v(7,it),v(8,Jm),v(9,Ar),v(10,$a),v(11,Hi),v(12,Vm),v(13,ta),v(14,We)],eV);let Gh=class fy extends Ef{static create(e,t,i,n,s){return e.invokeFunction(o=>{const a=o.get(tv).getValue(t),c=a?De.fromString(a):void 0,d=o.get(UT).createWebviewOverlay({providedViewType:i,title:void 0,options:{customClasses:s==null?void 0:s.customClasses},contentOptions:{},extension:void 0}),l=e.createInstance(fy,{resource:t,viewType:i},d,{untitledDocumentData:c,oldResource:s==null?void 0:s.oldResource});return typeof n<"u"&&l.updateGroup(n),l})}get resource(){return this._editorResource}constructor(e,t,i,n,s,o,a,c,d,l,u){super({providedId:e.viewType,viewType:e.viewType,name:""},t,n),this.instantiationService=s,this.labelService=o,this.customEditorService=a,this.fileDialogService=c,this.undoRedoService=d,this.fileService=l,this.filesConfigurationService=u,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._editorResource=e.resource,this.oldResource=i.oldResource,this._defaultDirtyState=i.startsDirty,this._backupId=i.backupId,this._untitledDocumentData=i.untitledDocumentData,this.registerListeners()}registerListeners(){this._register(this.labelService.onDidChangeFormatters(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e=>this.onLabelEvent(e.scheme)))}onLabelEvent(e){e===this.resource.scheme&&this.updateLabel()}updateLabel(){this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._onDidChangeLabel.fire()}get typeId(){return fy.typeId}get editorId(){return this.viewType}get capabilities(){var t;let e=0;return e|=128,(t=this.customEditorService.getCustomEditorCapabilities(this.viewType))!=null&&t.supportsMultipleEditorsPerDocument||(e|=8),this._modelRef?this._modelRef.object.isReadonly()&&(e|=2):this.filesConfigurationService.isReadonly(this.resource)&&(e|=2),this.resource.scheme===pe.untitled&&(e|=4),e}getName(){return Yn(this.labelService.getUriLabel(this.resource))}getDescription(e=1){switch(e){case 0:return this.shortDescription;case 2:return this.longDescription;case 1:default:return this.mediumDescription}}get shortDescription(){return typeof this._shortDescription!="string"&&(this._shortDescription=this.labelService.getUriBasenameLabel(pn(this.resource))),this._shortDescription}get mediumDescription(){return typeof this._mediumDescription!="string"&&(this._mediumDescription=this.labelService.getUriLabel(pn(this.resource),{relative:!0})),this._mediumDescription}get longDescription(){return typeof this._longDescription!="string"&&(this._longDescription=this.labelService.getUriLabel(pn(this.resource))),this._longDescription}get shortTitle(){return typeof this._shortTitle!="string"&&(this._shortTitle=this.getName()),this._shortTitle}get mediumTitle(){return typeof this._mediumTitle!="string"&&(this._mediumTitle=this.labelService.getUriLabel(this.resource,{relative:!0})),this._mediumTitle}get longTitle(){return typeof this._longTitle!="string"&&(this._longTitle=this.labelService.getUriLabel(this.resource)),this._longTitle}getTitle(e){switch(e){case 0:return this.shortTitle;case 2:return this.longTitle;default:case 1:return this.mediumTitle}}matches(e){return super.matches(e)?!0:this===e||e instanceof fy&&this.viewType===e.viewType&&si(this.resource,e.resource)}copy(){return fy.create(this.instantiationService,this.resource,this.viewType,this.group,this.webview.options)}isReadonly(){return this._modelRef?this._modelRef.object.isReadonly():this.filesConfigurationService.isReadonly(this.resource)}isDirty(){return this._modelRef?this._modelRef.object.isDirty():!!this._defaultDirtyState}async save(e,t){if(!this._modelRef)return;const i=await this._modelRef.object.saveCustomEditor(t);if(i)return si(i,this.resource)?this:{resource:i}}async saveAs(e,t){var s;if(!this._modelRef)return;const i=this._editorResource,n=await this.fileDialogService.pickFileToSave(i,t==null?void 0:t.availableFileSystems);if(n&&await this._modelRef.object.saveCustomEditorAs(this._editorResource,n,t))return(s=await this.rename(e,n))==null?void 0:s.editor}async revert(e,t){if(this._modelRef)return this._modelRef.object.revert(t);this._defaultDirtyState=!1,this._onDidChangeDirty.fire()}async resolve(){if(await super.resolve(),this.isDisposed())return null;if(!this._modelRef){const e=this.capabilities;this._modelRef=this._register(Mi(await this.customEditorService.models.tryRetain(this.resource,this.viewType))),this._register(this._modelRef.object.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this._modelRef.object.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire())),this._untitledDocumentData&&(this._defaultDirtyState=!0),this.isDirty()&&this._onDidChangeDirty.fire(),this.capabilities!==e&&this._onDidChangeCapabilities.fire()}return null}async rename(e,t){return{editor:{resource:t}}}undo(){return Mi(this._modelRef),this.undoRedoService.undo(this.resource)}redo(){return Mi(this._modelRef),this.undoRedoService.redo(this.resource)}onMove(e){this._moveHandler=e}transfer(e){if(super.transfer(e))return e._moveHandler=this._moveHandler,this._moveHandler=void 0,e}get backupId(){return this._modelRef?this._modelRef.object.backupId:this._backupId}get untitledDocumentData(){return this._untitledDocumentData}toUntyped(){return{resource:this.resource,options:{override:this.viewType}}}};Gh.typeId="workbench.editors.webviewEditor";Gh=T([v(3,ub),v(4,Te),v(5,Qi),v(6,x$),v(7,ia),v(8,o1),v(9,at),v(10,qr)],Gh);const Vme=[],HOe=ee("terminal.background",null,p("terminal.background","The background color of the terminal, this allows coloring the terminal differently to the panel.")),jOe=ee("terminal.foreground",{light:"#333333",dark:"#CCCCCC",hcDark:"#FFFFFF",hcLight:"#292929"},p("terminal.foreground","The foreground color of the terminal.")),BOe=ee("terminalCursor.foreground",null,p("terminalCursor.foreground","The foreground color of the terminal cursor.")),UOe=ee("terminalCursor.background",null,p("terminalCursor.background","The background color of the terminal cursor. Allows customizing the color of a character overlapped by a block cursor.")),aS=ee("terminal.selectionBackground",{light:Lb,dark:Lb,hcDark:Lb,hcLight:Lb},p("terminal.selectionBackground","The selection background color of the terminal.")),VOe=ee("terminal.inactiveSelectionBackground",{light:Xe(aS,.5),dark:Xe(aS,.5),hcDark:Xe(aS,.7),hcLight:Xe(aS,.5)},p("terminal.inactiveSelectionBackground","The selection background color of the terminal when it does not have focus.")),qOe=ee("terminal.selectionForeground",{light:null,dark:null,hcDark:"#000000",hcLight:"#ffffff"},p("terminal.selectionForeground","The selection foreground color of the terminal. When this is null the selection foreground will be retained and have the minimum contrast ratio feature applied.")),GOe=ee("terminalCommandDecoration.defaultBackground",{light:"#00000040",dark:"#ffffff40",hcDark:"#ffffff80",hcLight:"#00000040"},p("terminalCommandDecoration.defaultBackground","The default terminal command decoration background color.")),zOe=ee("terminalCommandDecoration.successBackground",{dark:"#1B81A8",light:"#2090D3",hcDark:"#1B81A8",hcLight:"#007100"},p("terminalCommandDecoration.successBackground","The terminal command decoration background color for successful commands.")),KOe=ee("terminalCommandDecoration.errorBackground",{dark:"#F14C4C",light:"#E51400",hcDark:"#F14C4C",hcLight:"#B5200D"},p("terminalCommandDecoration.errorBackground","The terminal command decoration background color for error commands.")),QOe=ee("terminalOverviewRuler.cursorForeground",{dark:"#A0A0A0CC",light:"#A0A0A0CC",hcDark:"#A0A0A0CC",hcLight:"#A0A0A0CC"},p("terminalOverviewRuler.cursorForeground","The overview ruler cursor color."));ee("terminal.border",{dark:nd,light:nd,hcDark:nd,hcLight:nd},p("terminal.border","The color of the border that separates split panes within the terminal. This defaults to panel.border."));const YOe=ee("terminal.findMatchBackground",{dark:DH,light:DH,hcDark:null,hcLight:"#0F4A85"},p("terminal.findMatchBackground","Color of the current search match in the terminal. The color must not be opaque so as not to hide underlying terminal content."));ee("terminal.hoverHighlightBackground",{dark:Xe(ul,.5),light:Xe(ul,.5),hcDark:Xe(ul,.5),hcLight:Xe(ul,.5)},p("terminal.findMatchHighlightBorder","Border color of the other search matches in the terminal."));const XOe=ee("terminal.findMatchBorder",{dark:null,light:null,hcDark:"#f38518",hcLight:"#0F4A85"},p("terminal.findMatchBorder","Border color of the current search match in the terminal.")),JOe=ee("terminal.findMatchHighlightBackground",{dark:kH,light:kH,hcDark:null,hcLight:null},p("terminal.findMatchHighlightBackground","Color of the other search matches in the terminal. The color must not be opaque so as not to hide underlying terminal content.")),ZOe=ee("terminal.findMatchHighlightBorder",{dark:null,light:null,hcDark:"#f38518",hcLight:"#0F4A85"},p("terminal.findMatchHighlightBorder","Border color of the other search matches in the terminal.")),eNe=ee("terminalOverviewRuler.findMatchForeground",{dark:mC,light:mC,hcDark:"#f38518",hcLight:"#0F4A85"},p("terminalOverviewRuler.findMatchHighlightForeground","Overview ruler marker color for find matches in the terminal."));ee("terminal.dropBackground",{dark:Vo,light:Vo,hcDark:Vo,hcLight:Vo},p("terminal.dragAndDropBackground","Background color when dragging on top of terminals. The color should have transparency so that the terminal contents can still shine through."));ee("terminal.tab.activeBorder",{dark:Qp,light:Qp,hcDark:Qp,hcLight:Qp},p("terminal.tab.activeBorder","Border on the side of the terminal tab in the panel. This defaults to tab.activeBorder."));const IF={"terminal.ansiBlack":{index:0,defaults:{light:"#000000",dark:"#000000",hcDark:"#000000",hcLight:"#292929"}},"terminal.ansiRed":{index:1,defaults:{light:"#cd3131",dark:"#cd3131",hcDark:"#cd0000",hcLight:"#cd3131"}},"terminal.ansiGreen":{index:2,defaults:{light:"#00BC00",dark:"#0DBC79",hcDark:"#00cd00",hcLight:"#00bc00"}},"terminal.ansiYellow":{index:3,defaults:{light:"#949800",dark:"#e5e510",hcDark:"#cdcd00",hcLight:"#949800"}},"terminal.ansiBlue":{index:4,defaults:{light:"#0451a5",dark:"#2472c8",hcDark:"#0000ee",hcLight:"#0451a5"}},"terminal.ansiMagenta":{index:5,defaults:{light:"#bc05bc",dark:"#bc3fbc",hcDark:"#cd00cd",hcLight:"#bc05bc"}},"terminal.ansiCyan":{index:6,defaults:{light:"#0598bc",dark:"#11a8cd",hcDark:"#00cdcd",hcLight:"#0598bc"}},"terminal.ansiWhite":{index:7,defaults:{light:"#555555",dark:"#e5e5e5",hcDark:"#e5e5e5",hcLight:"#555555"}},"terminal.ansiBrightBlack":{index:8,defaults:{light:"#666666",dark:"#666666",hcDark:"#7f7f7f",hcLight:"#666666"}},"terminal.ansiBrightRed":{index:9,defaults:{light:"#cd3131",dark:"#f14c4c",hcDark:"#ff0000",hcLight:"#cd3131"}},"terminal.ansiBrightGreen":{index:10,defaults:{light:"#14CE14",dark:"#23d18b",hcDark:"#00ff00",hcLight:"#00bc00"}},"terminal.ansiBrightYellow":{index:11,defaults:{light:"#b5ba00",dark:"#f5f543",hcDark:"#ffff00",hcLight:"#b5ba00"}},"terminal.ansiBrightBlue":{index:12,defaults:{light:"#0451a5",dark:"#3b8eea",hcDark:"#5c5cff",hcLight:"#0451a5"}},"terminal.ansiBrightMagenta":{index:13,defaults:{light:"#bc05bc",dark:"#d670d6",hcDark:"#ff00ff",hcLight:"#bc05bc"}},"terminal.ansiBrightCyan":{index:14,defaults:{light:"#0598bc",dark:"#29b8db",hcDark:"#00ffff",hcLight:"#0598bc"}},"terminal.ansiBrightWhite":{index:15,defaults:{light:"#a5a5a5",dark:"#e5e5e5",hcDark:"#ffffff",hcLight:"#a5a5a5"}}};function tNe(){for(const r in IF){const e=IF[r],t=r.substring(13);Vme[e.index]=ee(r,e.defaults,p("terminal.ansiColor","'{0}' ANSI color in the terminal.",t))}}function Z$(r){let e;if(typeof r=="string"?e=r:r.color?e=r.color.replace(/\./g,"_"):Si.isThemeIcon(r.icon)&&r.icon.color&&(e=r.icon.color.id.replace(/\./g,"_")),e)return`terminal-icon-${e.replace(/\./g,"_")}`}function A8(r){const e=[];for(const t in IF)r.getColor(t)&&!t.toLowerCase().includes("bright")&&e.push(t);return e}function iNe(r){const e=A8(r),t=document.createElement("style");let i="";for(const n of e){const s=Z$(n),o=r.getColor(n);o&&(i+=`.monaco-workbench .${s} .codicon:first-child:not(.codicon-split-horizontal):not(.codicon-trashcan):not(.file-icon){ color: ${o} !important; }`)}return t.textContent=i,t}function nNe(r,e){const t=A8(r);let i="";for(const n of t){const s=Z$(n),o=r.getColor(n);o&&(e?i+=`.monaco-workbench .show-file-icons .file-icon.terminal-tab.${s}::before{ color: ${o} !important; }`:i+=`.monaco-workbench .${s} .codicon:first-child:not(.codicon-split-horizontal):not(.codicon-trashcan):not(.file-icon){ color: ${o} !important; }`)}return i}function qme(r,e,t){const i=r.icon;if(!i)return;const n=[];let s;if(t){if(typeof i=="string"&&(i.startsWith("$(")||Sq().getIcon(i)))return n;typeof i=="string"&&(s=k.parse(i))}if(i instanceof k?s=i:i instanceof Object&&"light"in i&&"dark"in i&&(s=e===pS.LIGHT?i.light:i.dark),s instanceof k){const a=`terminal-uri-icon-${yc(s.path).toString(36)}`;n.push(a),n.push("terminal-uri-icon")}return n}function rNe(r,e){return!e.icon||e.icon instanceof Object&&!("id"in e.icon)?r.get(w$).getDefaultIcon().id:typeof e.icon=="string"?e.icon:e.icon.id}var RF;(function(r){r.isOpen=new G("terminalIsOpen",!1,!0),r.focus=new G("terminalFocus",!1,p("terminalFocusContextKey","Whether the terminal is focused.")),r.focusInAny=new G("terminalFocusInAny",!1,p("terminalFocusInAnyContextKey","Whether any terminal is focused, including detached terminals used in other UI.")),r.accessibleBufferFocus=new G("terminalAccessibleBufferFocus",!1,p("terminalAccessibleBufferFocusContextKey","Whether the terminal accessible buffer is focused.")),r.editorFocus=new G("terminalEditorFocus",!1,p("terminalEditorFocusContextKey","Whether a terminal in the editor area is focused.")),r.count=new G("terminalCount",0,p("terminalCountContextKey","The current number of terminals.")),r.groupCount=new G("terminalGroupCount",0,!0),r.tabsNarrow=new G("isTerminalTabsNarrow",!1,!0),r.terminalHasFixedWidth=new G("terminalHasFixedWidth",!1,!0),r.tabsFocus=new G("terminalTabsFocus",!1,p("terminalTabsFocusContextKey","Whether the terminal tabs widget is focused.")),r.webExtensionContributedProfile=new G("terminalWebExtensionContributedProfile",!1,!0),r.terminalHasBeenCreated=new G("terminalHasBeenCreated",!1,!0),r.terminalEditorActive=new G("terminalEditorActive",!1,!0),r.tabsMouse=new G("terminalTabsMouse",!1,!0),r.shellType=new G("terminalShellType",void 0,{type:"string",description:p("terminalShellTypeContextKey","The shell type of the active terminal, this is set to the last known value when no terminals exist.")}),r.altBufferActive=new G("terminalAltBufferActive",!1,p("terminalAltBufferActive","Whether the terminal's alt buffer is active.")),r.suggestWidgetVisible=new G("terminalSuggestWidgetVisible",!1,p("terminalSuggestWidgetVisible","Whether the terminal's suggest widget is visible.")),r.notFocus=r.focus.toNegated(),r.viewShowing=new G("terminalViewShowing",!1,p("terminalViewShowing","Whether the terminal view is showing")),r.textSelected=new G("terminalTextSelected",!1,p("terminalTextSelectedContextKey","Whether text is selected in the active terminal.")),r.textSelectedInFocused=new G("terminalTextSelectedInFocused",!1,p("terminalTextSelectedInFocusedContextKey","Whether text is selected in a focused terminal.")),r.notTextSelected=r.textSelected.toNegated(),r.findVisible=new G("terminalFindVisible",!1,!0),r.notFindVisible=r.findVisible.toNegated(),r.findInputFocus=new G("terminalFindInputFocused",!1,!0),r.findFocus=new G("terminalFindFocused",!1,!0),r.notFindFocus=r.findInputFocus.toNegated(),r.processSupported=new G("terminalProcessSupported",!1,p("terminalProcessSupportedContextKey","Whether terminal processes can be launched in the current workspace.")),r.tabsSingularSelection=new G("terminalTabsSingularSelection",!1,p("terminalTabsSingularSelectedContextKey","Whether one terminal is selected in the terminal tabs list.")),r.splitTerminal=new G("terminalSplitTerminal",!1,p("isSplitTerminalContextKey","Whether the focused tab's terminal is a split terminal.")),r.inTerminalRunCommandPicker=new G("inTerminalRunCommandPicker",!1,p("inTerminalRunCommandPickerContextKey","Whether the terminal run command picker is currently open.")),r.terminalShellIntegrationEnabled=new G("terminalShellIntegrationEnabled",!1,p("terminalShellIntegrationEnabled","Whether shell integration is enabled in the active terminal"))})(RF||(RF={}));let Zx=class PF extends Cf{setGroup(e){this._group=e}get group(){return this._group}get typeId(){return PF.ID}get editorId(){return hB}get capabilities(){return 138}setTerminalInstance(e){if(this._terminalInstance)throw new Error("cannot set instance that has already been set");this._terminalInstance=e,this._setupInstanceListeners()}copy(){const e=this._terminalInstanceService.createInstance(this._copyLaunchConfig||{},om.Editor);return e.focusWhenReady(),this._copyLaunchConfig=void 0,this._instantiationService.createInstance(PF,e.resource,e)}setCopyLaunchConfig(e){this._copyLaunchConfig=e}get terminalInstance(){return this._isDetached?void 0:this._terminalInstance}showConfirm(){var t;if(this._isReverted)return!1;const e=this._configurationService.getValue("terminal.integrated.confirmOnKill");return(e==="editor"||e==="always")&&((t=this._terminalInstance)==null?void 0:t.hasChildProcesses)||!1}async confirm(e){const{confirmed:t}=await this._dialogService.confirm({type:yi.Warning,message:p("confirmDirtyTerminal.message","Do you want to terminate running processes?"),primaryButton:p({key:"confirmDirtyTerminal.button",comment:["&& denotes a mnemonic"]},"&&Terminate"),detail:e.length>1?e.map(i=>i.editor.getName()).join(`
`)+`

`+p("confirmDirtyTerminals.detail","Closing will terminate the running processes in the terminals."):p("confirmDirtyTerminal.detail","Closing will terminate the running processes in this terminal.")});return t?1:2}async revert(){this._isReverted=!0}constructor(e,t,i,n,s,o,a,c,d){super(),this.resource=e,this._terminalInstance=t,this._themeService=i,this._terminalInstanceService=n,this._instantiationService=s,this._configurationService=o,this._lifecycleService=a,this._dialogService=d,this.closeHandler=this,this._isDetached=!1,this._isShuttingDown=!1,this._isReverted=!1,this._onDidRequestAttach=this._register(new A),this.onDidRequestAttach=this._onDidRequestAttach.event,this._terminalEditorFocusContextKey=RF.editorFocus.bindTo(c),t&&this._setupInstanceListeners()}_setupInstanceListeners(){const e=this._terminalInstance;if(!e)return;const t=e.onDidFocus(()=>this._terminalEditorFocusContextKey.set(!0)),i=e.onDidBlur(()=>this._terminalEditorFocusContextKey.reset());this._register(ot(()=>{!this._isDetached&&!this._isShuttingDown&&e.dispose($h.User),vt([t,i])}));const n=[e.onExit(s=>{e.waitOnExit||this.dispose()}),e.onDisposed(()=>this.dispose()),e.onTitleChanged(()=>this._onDidChangeLabel.fire()),e.onIconChanged(()=>this._onDidChangeLabel.fire()),t,i,e.statusList.onDidChangePrimaryStatus(()=>this._onDidChangeLabel.fire())];this._lifecycleService.onWillShutdown(s=>{this._isShuttingDown=!0,vt(n),this._configurationService.getValue("terminal.integrated.enablePersistentSessions")&&s.reason===3?e.detachProcessAndDispose($h.Shutdown):e.dispose($h.Shutdown)})}getName(){var e;return((e=this._terminalInstance)==null?void 0:e.title)||this.resource.fragment}getLabelExtraClasses(){if(!this._terminalInstance)return[];const e=["terminal-tab"],t=Z$(this._terminalInstance);t&&e.push(t);const i=qme(this._terminalInstance,this._themeService.getColorTheme().type);return i&&e.push(...i),Si.isThemeIcon(this._terminalInstance.icon)&&e.push(`codicon-${this._terminalInstance.icon.id}`),e}detachInstance(){var e;this._isShuttingDown||((e=this._terminalInstance)==null||e.detachFromElement(),this._isDetached=!0)}getDescription(){var e;return(e=this._terminalInstance)==null?void 0:e.description}toUntyped(){return{resource:this.resource,options:{override:hB,pinned:!0,forceReload:!0}}}};Zx.ID="workbench.editors.terminal";Zx=T([v(2,Fi),v(3,d4),v(4,Te),v(5,We),v(6,ea),v(7,It),v(8,ar)],Zx);const aP={LEFT:"left",RIGHT:"right",FIRST:"first",LAST:"last"};function Gme(r){const e=r;return!!(e&&typeof e=="object"&&Array.isArray(e.editors)&&Array.isArray(e.mru))}function sNe(r){const e=r;return e.kind===3&&e.editorIndex!==void 0}function zme(r){const e=r;return e.kind===5&&e.editorIndex!==void 0&&e.oldEditorIndex!==void 0}function oNe(r){const e=r;return e.kind===4&&e.editorIndex!==void 0&&e.context!==void 0&&e.sticky!==void 0}let AF=class Mp extends ne{get id(){return this._id}constructor(e,t,i){super(),this.instantiationService=t,this.configurationService=i,this._onDidModelChange=this._register(new A),this.onDidModelChange=this._onDidModelChange.event,this.editors=[],this.mru=[],this.locked=!1,this.preview=null,this.active=null,this.sticky=-1,Gme(e)?this._id=this.deserialize(e):this._id=Mp.IDS++,this.onConfigurationUpdated(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e)))}onConfigurationUpdated(e){e&&!e.affectsConfiguration("workbench.editor.openPositioning")&&!e.affectsConfiguration("workbench.editor.focusRecentEditorAfterClose")||(this.editorOpenPositioning=this.configurationService.getValue("workbench.editor.openPositioning"),this.focusRecentEditorAfterClose=this.configurationService.getValue("workbench.editor.focusRecentEditorAfterClose"))}get count(){return this.editors.length}get stickyCount(){return this.sticky+1}getEditors(e,t){const i=e===0?this.mru.slice(0):this.editors.slice(0);return t!=null&&t.excludeSticky?e===0?i.filter(n=>!this.isSticky(n)):i.slice(this.sticky+1):i}getEditorByIndex(e){return this.editors[e]}get activeEditor(){return this.active}isActive(e){return this.matches(this.active,e)}get previewEditor(){return this.preview}openEditor(e,t){const i=(t==null?void 0:t.sticky)||typeof(t==null?void 0:t.index)=="number"&&this.isSticky(t.index),n=(t==null?void 0:t.pinned)||(t==null?void 0:t.sticky),s=(t==null?void 0:t.active)||!this.activeEditor||!n&&this.matches(this.preview,this.activeEditor),o=this.findEditor(e,t);if(o){const[a,c]=o;return n&&this.doPin(a,c),s&&this.doSetActive(a,c),t&&typeof t.index=="number"&&this.moveEditor(a,t.index),i&&this.doStick(a,this.indexOf(a)),{editor:a,isNew:!1}}else{const a=e,c=this.indexOf(this.active);let d;if(t&&typeof t.index=="number"?d=t.index:this.editorOpenPositioning===aP.FIRST?(d=0,!i&&this.isSticky(d)&&(d=this.sticky+1)):this.editorOpenPositioning===aP.LAST?d=this.editors.length:(this.editorOpenPositioning===aP.LEFT?c===0||!this.editors.length?d=0:d=c:d=c+1,!i&&this.isSticky(d)&&(d=this.sticky+1)),i&&(this.sticky++,this.isSticky(d)||(d=this.sticky)),(n||!this.preview)&&this.splice(d,!1,a),!n){if(this.preview){const u=this.indexOf(this.preview);d>u&&d--,this.replaceEditor(this.preview,a,d,!s)}this.preview=a}this.registerEditorListeners(a);const l={kind:3,editor:a,editorIndex:d};return this._onDidModelChange.fire(l),s&&this.doSetActive(a,d),{editor:a,isNew:!0}}}registerEditorListeners(e){const t=new me;t.add(F.once(e.onWillDispose)(()=>{const i=this.editors.indexOf(e);if(i>=0){const n={kind:12,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}})),t.add(e.onDidChangeDirty(()=>{const i={kind:11,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(e.onDidChangeLabel(()=>{const i={kind:7,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(e.onDidChangeCapabilities(()=>{const i={kind:8,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(this.onDidModelChange(i=>{var n;i.kind===4&&((n=i.editor)!=null&&n.matches(e))&&vt(t)}))}replaceEditor(e,t,i,n=!0){const s=this.doCloseEditor(e,by.REPLACE,n);if(this.splice(i,!1,t),s){const o={kind:4,...s};this._onDidModelChange.fire(o)}}closeEditor(e,t=by.UNKNOWN,i=!0){const n=this.doCloseEditor(e,t,i);if(n){const s={kind:4,...n};return this._onDidModelChange.fire(s),n}}doCloseEditor(e,t,i){const n=this.indexOf(e);if(n===-1)return;const s=this.editors[n],o=this.isSticky(n);if(i&&this.matches(this.active,s))if(this.mru.length>1){let a;this.focusRecentEditorAfterClose?a=this.mru[1]:n===this.editors.length-1?a=this.editors[n-1]:a=this.editors[n+1],this.doSetActive(a,this.editors.indexOf(a))}else this.active=null;return this.matches(this.preview,s)&&(this.preview=null),this.splice(n,!0),{editor:s,sticky:o,editorIndex:n,context:t}}moveEditor(e,t){t>=this.editors.length?t=this.editors.length-1:t<0&&(t=0);const i=this.indexOf(e);if(i<0||t===i)return;const n=this.editors[i],s=this.sticky;this.isSticky(i)&&t>this.sticky?this.sticky--:!this.isSticky(i)&&t<=this.sticky&&this.sticky++,this.editors.splice(i,1),this.editors.splice(t,0,n);const o={kind:5,editor:n,oldEditorIndex:i,editorIndex:t};if(this._onDidModelChange.fire(o),s!==this.sticky){const a={kind:10,editor:n,editorIndex:t};this._onDidModelChange.fire(a)}return n}setActive(e){let t;return e?t=this.setEditorActive(e):this.setGroupActive(),t}setGroupActive(){this._onDidModelChange.fire({kind:0})}setEditorActive(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doSetActive(i,n),i}doSetActive(e,t){if(this.matches(this.active,e))return;this.active=e;const i=this.indexOf(e,this.mru);this.mru.splice(i,1),this.mru.unshift(e);const n={kind:6,editor:e,editorIndex:t};this._onDidModelChange.fire(n)}setIndex(e){this._onDidModelChange.fire({kind:1})}pin(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doPin(i,n),i}doPin(e,t){if(this.isPinned(e))return;this.preview=null;const i={kind:9,editor:e,editorIndex:t};this._onDidModelChange.fire(i)}unpin(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doUnpin(i,n),i}doUnpin(e,t){if(!this.isPinned(e))return;const i=this.preview;this.preview=e;const n={kind:9,editor:e,editorIndex:t};this._onDidModelChange.fire(n),i&&this.closeEditor(i,by.UNPIN)}isPinned(e){let t;return typeof e=="number"?t=this.editors[e]:t=e,!this.matches(this.preview,t)}stick(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doStick(i,n),i}doStick(e,t){if(this.isSticky(t))return;this.pin(e);const i=this.sticky+1;this.moveEditor(e,i),this.sticky++;const n={kind:10,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}unstick(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doUnstick(i,n),i}doUnstick(e,t){if(!this.isSticky(t))return;const i=this.sticky;this.moveEditor(e,i),this.sticky--;const n={kind:10,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}isSticky(e){if(this.sticky<0)return!1;let t;return typeof e=="number"?t=e:t=this.indexOf(e),t<0?!1:t<=this.sticky}splice(e,t,i){const n=this.editors[e];if(t&&this.isSticky(e)&&this.sticky--,i?this.editors.splice(e,t?1:0,i):this.editors.splice(e,t?1:0),!t&&i)this.mru.length===0?this.mru.push(i):this.mru.splice(1,0,i);else{const s=this.indexOf(n,this.mru);t&&!i?this.mru.splice(s,1):t&&i&&this.mru.splice(s,1,i)}}indexOf(e,t=this.editors,i){let n=-1;if(!e)return n;for(let s=0;s<t.length;s++){const o=t[s];if(this.matches(o,e,i))if(i!=null&&i.supportSideBySide&&o instanceof ns&&!(e instanceof ns))n=s;else{n=s;break}}return n}findEditor(e,t){const i=this.indexOf(e,this.editors,t);if(i!==-1)return[this.editors[i],i]}isFirst(e){return this.matches(this.editors[0],e)}isLast(e){return this.matches(this.editors[this.editors.length-1],e)}contains(e,t){for(const i of this.editors)if(this.matches(i,e,t))return!0;return!1}matches(e,t,i){if(!e||!t)return!1;if(i!=null&&i.supportSideBySide&&e instanceof ns&&!(t instanceof ns))switch(i.supportSideBySide){case Ui.ANY:if(this.matches(e.primary,t,i)||this.matches(e.secondary,t,i))return!0;break;case Ui.BOTH:if(this.matches(e.primary,t,i)&&this.matches(e.secondary,t,i))return!0;break}const n=e===t;return i!=null&&i.strictEquals?n:n||e.matches(t)}get isLocked(){return this.locked}lock(e){this.isLocked!==e&&(this.locked=e,this._onDidModelChange.fire({kind:2}))}clone(){const e=this.instantiationService.createInstance(Mp,void 0);e.editors=this.editors.slice(0),e.mru=this.mru.slice(0),e.preview=this.preview,e.active=this.active,e.sticky=this.sticky;for(const t of e.editors)e.registerEditorListeners(t);return e}serialize(){const e=st.as(au.EditorFactory),t=[],i=[];let n,s=this.sticky;for(let a=0;a<this.editors.length;a++){const c=this.editors[a];let d=!1;const l=e.getEditorSerializer(c);if(l){const u=l.serialize(c);typeof u=="string"?(d=!0,i.push({id:c.typeId,value:u}),t.push(c),this.preview===c&&(n=t.length-1)):d=!1}!d&&this.isSticky(a)&&s--}const o=this.mru.map(a=>this.indexOf(a,t)).filter(a=>a>=0);return{id:this.id,locked:this.locked?!0:void 0,editors:i,mru:o,preview:n,sticky:s>=0?s:void 0}}deserialize(e){const t=st.as(au.EditorFactory);return typeof e.id=="number"?(this._id=e.id,Mp.IDS=Math.max(e.id+1,Mp.IDS)):this._id=Mp.IDS++,e.locked&&(this.locked=!0),this.editors=fi(e.editors.map((i,n)=>{let s;const o=t.getEditorSerializer(i.id);if(o){const a=o.deserialize(this.instantiationService,i.value);a instanceof Cf&&(s=a,this.registerEditorListeners(s))}return!s&&typeof e.sticky=="number"&&n<=e.sticky&&e.sticky--,s})),this.mru=fi(e.mru.map(i=>this.editors[i])),this.active=this.mru[0],typeof e.preview=="number"&&(this.preview=this.editors[e.preview]),typeof e.sticky=="number"&&(this.sticky=e.sticky),this._id}};AF.IDS=0;AF=T([v(1,Te),v(2,We)],AF);const Kme=re("IInteractiveHistoryService");let eD=class nC extends Cf{static create(e,t,i,n,s){return e.createInstance(nC,t,i,n,s)}get editorId(){return"interactive"}get typeId(){return nC.ID}get language(){var e;return((e=this._inputModelRef)==null?void 0:e.object.textEditorModel.getLanguageId())??this._initLanguage}get notebookEditorInput(){return this._notebookEditorInput}get editorInputs(){return[this._notebookEditorInput]}get resource(){return this._resource}get inputResource(){return this._inputResource}get primary(){return this._notebookEditorInput}constructor(e,t,i,n,s,o,a,c,d,l){const u=IS.create(s,e,"interactive",{});super(),this._notebookService=d,this._fileDialogService=l,this._notebookEditorInput=u,this._register(this._notebookEditorInput),this._initTitle=i,this._initLanguage=n,this._resource=e,this._inputResource=t,this._inputResolver=null,this._editorModelReference=null,this._inputModelRef=null,this._textModelService=o,this._interactiveDocumentService=a,this._historyService=c,this._registerListeners()}_registerListeners(){const e=F.once(this.primary.onWillDispose);this._register(e(()=>{this.isDisposed()||this.dispose()})),this._register(this.primary.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.primary.onDidChangeLabel(()=>this._onDidChangeLabel.fire())),this._register(this.primary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire()))}get capabilities(){return 518}async _resolveEditorModel(){return this._editorModelReference||(this._editorModelReference=await this._notebookEditorInput.resolve()),this._editorModelReference}async resolve(){return this._editorModelReference?this._editorModelReference:this._inputResolver?this._inputResolver:(this._inputResolver=this._resolveEditorModel(),this._inputResolver)}async resolveInput(e){if(this._inputModelRef)return this._inputModelRef.object.textEditorModel;const t=e??this._initLanguage??fo;return this._interactiveDocumentService.willCreateInteractiveDocument(this.resource,this.inputResource,t),this._inputModelRef=await this._textModelService.createModelReference(this.inputResource),this._inputModelRef.object.textEditorModel}async save(e,t){if(this._editorModelReference)return this.hasCapability(4)?this.saveAs(e,t):(await this._editorModelReference.save(t),this)}async saveAs(e,t){if(!this._editorModelReference||!this._notebookService.getContributedNotebookType("interactive"))return;const n=this.getName()+".ipynb",s=pt(await this._fileDialogService.defaultFilePath(),n),o=await this._fileDialogService.pickFileToSave(s,t==null?void 0:t.availableFileSystems);if(o)return await this._editorModelReference.saveAs(o)}matches(e){return super.matches(e)?!0:e instanceof nC?si(this.resource,e.resource)&&si(this.inputResource,e.inputResource):!1}getName(){if(this._initTitle)return this._initTitle;const e=this.primary.resource.path,t=Yn(e);return t.substr(0,t.length-kg(e).length)}isModified(){var e;return((e=this._editorModelReference)==null?void 0:e.isModified())??!1}dispose(){var e,t,i,n;(e=this._editorModelReference)==null||e.revert({soft:!0}),(t=this._notebookEditorInput)==null||t.dispose(),(i=this._editorModelReference)==null||i.dispose(),this._editorModelReference=null,this._interactiveDocumentService.willRemoveInteractiveDocument(this.resource,this.inputResource),(n=this._inputModelRef)==null||n.dispose(),this._inputModelRef=null,super.dispose()}get historyService(){return this._historyService}};eD.ID="workbench.input.interactive";eD=T([v(4,Te),v(5,or),v(6,R$),v(7,Kme),v(8,qf),v(9,ia)],eD);const Qme={start:"<<<<<<<",end:">>>>>>>"};class $n{static join(e){if(e.length===0)return;let t=Number.MAX_SAFE_INTEGER,i=0;for(const n of e)t=Math.min(t,n.startLineNumber),i=Math.max(i,n.startLineNumber+n.lineCount);return new $n(t,i-t)}static fromLineNumbers(e,t){return new $n(e,t-e)}constructor(e,t){if(this.startLineNumber=e,this.lineCount=t,t<0)throw new Ko}join(e){return new $n(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive)-this.startLineNumber)}get endLineNumberExclusive(){return this.startLineNumber+this.lineCount}get isEmpty(){return this.lineCount===0}touches(e){return this.endLineNumberExclusive>=e.startLineNumber&&e.endLineNumberExclusive>=this.startLineNumber}isAfter(e){return this.startLineNumber>=e.endLineNumberExclusive}isBefore(e){return e.startLineNumber>=this.endLineNumberExclusive}delta(e){return new $n(this.startLineNumber+e,this.lineCount)}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}equals(e){return this.startLineNumber===e.startLineNumber&&this.lineCount===e.lineCount}contains(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}deltaEnd(e){return new $n(this.startLineNumber,this.lineCount+e)}deltaStart(e){return new $n(this.startLineNumber+e,this.lineCount-e)}getLines(e){const t=new Array(this.lineCount);for(let i=0;i<this.lineCount;i++)t[i]=e.getLineContent(this.startLineNumber+i);return t}containsRange(e){return this.startLineNumber<=e.startLineNumber&&e.endLineNumberExclusive<=this.endLineNumberExclusive}toRange(){return new qe(this.startLineNumber,1,this.endLineNumberExclusive,1)}toInclusiveRange(){if(!this.isEmpty)return new qe(this.startLineNumber,1,this.endLineNumberExclusive-1,1073741824)}toInclusiveRangeOrEmpty(){return this.isEmpty?new qe(this.startLineNumber,1,this.startLineNumber,1):new qe(this.startLineNumber,1,this.endLineNumberExclusive-1,1073741824)}intersects(e){return this.startLineNumber<=e.endLineNumberExclusive&&e.startLineNumber<=this.endLineNumberExclusive}}$n.compareByStart=Pg(r=>r.startLineNumber,bk);class Yme{constructor(){this._isActive=!1}get isActive(){return this._isActive}makeExclusive(e){return(...t)=>{if(!this._isActive){this._isActive=!0;try{return e(...t)}finally{this._isActive=!1}}}}runExclusively(e){if(!this._isActive){this._isActive=!0;try{e()}finally{this._isActive=!1}}}runExclusivelyOrThrow(e){if(this._isActive)throw new Ko;this._isActive=!0;try{e()}finally{this._isActive=!1}}}function*Xme(r,e,t){const i=new V7(e);for(const n of r){i.takeWhile(o=>NP.isGreaterThan(t(n,o)));const s=i.takeWhile(o=>NP.isNeitherLessOrGreaterThan(t(n,o)));yield{left:n,rights:s||[]}}}function M8(...r){return[].concat(...r)}function Jme(r,e,t){return a1(i=>t.onDidChangeConfiguration(n=>{n.affectsConfiguration(r)&&i(n)}),()=>t.getValue(r)??e)}class yw{constructor(e,t){this.range=e,this.newLines=t}equals(e){return this.range.equals(e.range)&&Ds(this.newLines,e.newLines)}toEdits(e){return new eve([this]).toEdits(e)}}class Zme{constructor(e,t){this.range=e,this.newText=t}equals(e){return qe.equalsRange(this.range,e.range)&&this.newText===e.newText}}class eve{constructor(e){this.edits=e}toEdits(e){return this.edits.map(t=>t.range.endLineNumberExclusive<=e?{range:new qe(t.range.startLineNumber,1,t.range.endLineNumberExclusive,1),text:t.newLines.map(i=>i+`
`).join("")}:t.range.startLineNumber===1?{range:new qe(1,1,e,Number.MAX_SAFE_INTEGER),text:t.newLines.join(`
`)}:{range:new qe(t.range.startLineNumber-1,Number.MAX_SAFE_INTEGER,e,Number.MAX_SAFE_INTEGER),text:t.newLines.map(i=>`
`+i).join("")})}}function tve(r,e){return!(e.lineNumber<r.startLineNumber||e.lineNumber>r.endLineNumber||e.lineNumber===r.startLineNumber&&e.column<r.startColumn||e.lineNumber===r.endLineNumber&&e.column>=r.endColumn)}function ive(r,e){return r.lineNumber===e.lineNumber?new TH(0,e.column-r.column):new TH(e.lineNumber-r.lineNumber,e.column-1)}function nve(r,e){return e.lineCount===0?new Us(r.lineNumber,r.column+e.columnCount):new Us(r.lineNumber+e.lineCount,e.columnCount+1)}function tV(r,e){return r.endLineNumber<e.startLineNumber||r.endLineNumber===e.startLineNumber&&r.endColumn<=e.startColumn}class is{static join(e){return e.reduce((t,i)=>t?t.join(i):i,void 0)}constructor(e,t){this.inputRange=e,this.outputRange=t}extendInputRange(e){if(!e.containsRange(this.inputRange))throw new Ko;const t=e.startLineNumber-this.inputRange.startLineNumber,i=e.endLineNumberExclusive-this.inputRange.endLineNumberExclusive;return new is(e,new $n(this.outputRange.startLineNumber+t,this.outputRange.lineCount-t+i))}join(e){return new is(this.inputRange.join(e.inputRange),this.outputRange.join(e.outputRange))}get resultingDeltaFromOriginalToModified(){return this.outputRange.endLineNumberExclusive-this.inputRange.endLineNumberExclusive}toString(){return`${this.inputRange.toString()} -> ${this.outputRange.toString()}`}addOutputLineDelta(e){return new is(this.inputRange,this.outputRange.delta(e))}addInputLineDelta(e){return new is(this.inputRange.delta(e),this.outputRange)}reverse(){return new is(this.outputRange,this.inputRange)}}class gh{static betweenOutputs(e,t,i){const s=hI.compute(e,t).map(o=>new is(o.output1Range,o.output2Range));return new gh(s,i)}constructor(e,t){this.lineRangeMappings=e,this.inputLineCount=t,Gm(()=>c1(e,(i,n)=>i.inputRange.isBefore(n.inputRange)&&i.outputRange.isBefore(n.outputRange)&&n.inputRange.startLineNumber-i.inputRange.endLineNumberExclusive===n.outputRange.startLineNumber-i.outputRange.endLineNumberExclusive))}project(e){const t=hG(this.lineRangeMappings,s=>s.inputRange.startLineNumber<=e);if(!t)return new is(new $n(e,1),new $n(e,1));if(t.inputRange.contains(e))return t;const i=new $n(e,1),n=new $n(e+t.outputRange.endLineNumberExclusive-t.inputRange.endLineNumberExclusive,1);return new is(i,n)}get outputLineCount(){const e=fG(this.lineRangeMappings),t=e?e.outputRange.endLineNumberExclusive-e.inputRange.endLineNumberExclusive:0;return this.inputLineCount+t}reverse(){return new gh(this.lineRangeMappings.map(e=>e.reverse()),this.outputLineCount)}}class hI{static compute(e,t){const i=Pg(l=>l.inputRange.startLineNumber,bk),n=M8(e.map(l=>({source:0,diff:l})),t.map(l=>({source:1,diff:l}))).sort(Pg(l=>l.diff,i)),s=[new Array,new Array],o=[0,0],a=new Array;function c(l){const u=is.join(s[0])||new is(l,l.delta(o[0])),h=is.join(s[1])||new is(l,l.delta(o[1]));a.push(new hI(d,u.extendInputRange(d).outputRange,s[0],h.extendInputRange(d).outputRange,s[1])),s[0]=[],s[1]=[]}let d;for(const l of n){const u=l.diff.inputRange;d&&!d.touches(u)&&(c(d),d=void 0),o[l.source]=l.diff.resultingDeltaFromOriginalToModified,d=d?d.join(u):u,s[l.source].push(l.diff)}return d&&c(d),a}constructor(e,t,i,n,s){this.inputRange=e,this.output1Range=t,this.output1LineMappings=i,this.output2Range=n,this.output2LineMappings=s}toString(){return`${this.output1Range} <- ${this.inputRange} -> ${this.output2Range}`}}class Yl extends is{static join(e){return e.reduce((t,i)=>t?t.join(i):i,void 0)}constructor(e,t,i,n,s){super(e,i),this.inputTextModel=t,this.outputTextModel=n,this.rangeMappings=s||[new gd(this.inputRange.toRange(),this.outputRange.toRange())],Gm(()=>{for(const o of this.rangeMappings){let a=e.startLineNumber-1<=o.inputRange.startLineNumber&&o.inputRange.endLineNumber<=e.endLineNumberExclusive;a&&o.inputRange.startLineNumber===e.startLineNumber-1&&(a=o.inputRange.endColumn>=t.getLineMaxColumn(o.inputRange.startLineNumber)),a&&o.inputRange.endLineNumber===e.endLineNumberExclusive&&(a=o.inputRange.endColumn===1);let c=i.startLineNumber-1<=o.outputRange.startLineNumber&&o.outputRange.endLineNumber<=i.endLineNumberExclusive;if(c&&o.outputRange.startLineNumber===i.startLineNumber-1&&(c=o.outputRange.endColumn>=n.getLineMaxColumn(o.outputRange.startLineNumber)),c&&o.outputRange.endLineNumber===i.endLineNumberExclusive&&(c=o.outputRange.endColumn===1),!a||!c)return!1}return!0})}addOutputLineDelta(e){return new Yl(this.inputRange,this.inputTextModel,this.outputRange.delta(e),this.outputTextModel,this.rangeMappings.map(t=>t.addOutputLineDelta(e)))}addInputLineDelta(e){return new Yl(this.inputRange.delta(e),this.inputTextModel,this.outputRange,this.outputTextModel,this.rangeMappings.map(t=>t.addInputLineDelta(e)))}join(e){return new Yl(this.inputRange.join(e.inputRange),this.inputTextModel,this.outputRange.join(e.outputRange),this.outputTextModel)}getLineEdit(){return new yw(this.inputRange,this.getOutputLines())}getReverseLineEdit(){return new yw(this.outputRange,this.getInputLines())}getOutputLines(){return this.outputRange.getLines(this.outputTextModel)}getInputLines(){return this.inputRange.getLines(this.inputTextModel)}}class gd{constructor(e,t){this.inputRange=e,this.outputRange=t}toString(){function e(t){return`[${t.startLineNumber}:${t.startColumn}, ${t.endLineNumber}:${t.endColumn})`}return`${e(this.inputRange)} -> ${e(this.outputRange)}`}addOutputLineDelta(e){return new gd(this.inputRange,new qe(this.outputRange.startLineNumber+e,this.outputRange.startColumn,this.outputRange.endLineNumber+e,this.outputRange.endColumn))}addInputLineDelta(e){return new gd(new qe(this.inputRange.startLineNumber+e,this.inputRange.startColumn,this.inputRange.endLineNumber+e,this.inputRange.endColumn),this.outputRange)}reverse(){return new gd(this.outputRange,this.inputRange)}}class Zp{constructor(e,t){this.rangeMappings=e,this.inputLineCount=t,Gm(()=>c1(e,(i,n)=>tV(i.inputRange,n.inputRange)&&tV(i.outputRange,n.outputRange)))}project(e){const t=hG(this.rangeMappings,s=>s.inputRange.getStartPosition().isBeforeOrEqual(e));if(!t)return new gd(qe.fromPositions(e,e),qe.fromPositions(e,e));if(tve(t.inputRange,e))return t;const i=ive(t.inputRange.getEndPosition(),e),n=nve(t.outputRange.getEndPosition(),i);return new gd(qe.fromPositions(e),qe.fromPositions(n))}projectRange(e){const t=this.project(e.getStartPosition()),i=this.project(e.getEndPosition());return new gd(t.inputRange.plusRange(i.inputRange),t.outputRange.plusRange(i.outputRange))}get outputLineCount(){const e=fG(this.rangeMappings),t=e?e.outputRange.endLineNumber-e.inputRange.endLineNumber:0;return this.inputLineCount+t}reverse(){return new Zp(this.rangeMappings.map(e=>e.reverse()),this.outputLineCount)}}let tD=class{constructor(e,t){this.editorWorkerService=e,this.configurationService=t,this.mergeAlgorithm=Jme("mergeEditor.diffAlgorithm","advanced",this.configurationService).map(i=>i==="smart"?"legacy":i==="experimental"?"advanced":i)}async computeDiff(e,t,i){const n=this.mergeAlgorithm.read(i),s=await this.editorWorkerService.computeDiff(e.uri,t.uri,{ignoreTrimWhitespace:!1,maxComputationTimeMs:0,computeMoves:!1},n);if(!s)throw new Error("Diff computation failed");if(e.isDisposed()||t.isDisposed())return{diffs:null};const o=s.changes.map(a=>{var c;return new Yl(iV(a.originalRange),e,iV(a.modifiedRange),t,(c=a.innerChanges)==null?void 0:c.map(d=>rve(d)))});return Gm(()=>o.length===0||o[0].inputRange.startLineNumber===o[0].outputRange.startLineNumber&&c1(o,(a,c)=>c.inputRange.startLineNumber-a.inputRange.endLineNumberExclusive===c.outputRange.startLineNumber-a.outputRange.endLineNumberExclusive&&a.inputRange.endLineNumberExclusive<c.inputRange.startLineNumber&&a.outputRange.endLineNumberExclusive<c.outputRange.startLineNumber)),{diffs:o}}};tD=T([v(0,Zw),v(1,We)],tD);function iV(r){return new $n(r.startLineNumber,r.length)}function rve(r){return new gd(r.originalRange,r.modifiedRange)}class cP extends ne{get isApplyingChange(){return this.barrier.isActive}constructor(e,t,i){super(),this.baseTextModel=e,this.textModel=t,this.diffComputer=i,this.recomputeCount=0,this._state=cg("LiveDiffState",1),this._diffs=cg("LiveDiffs",[]),this.barrier=new Yme,this.isDisposed=!1,this.isInitializing=!0;const n=q7("recompute");this._register(pG("Update diff state",s=>{n.read(s),this.recompute(s)})),this._register(e.onDidChangeContent(this.barrier.makeExclusive(()=>{n.trigger(void 0)}))),this._register(t.onDidChangeContent(this.barrier.makeExclusive(()=>{n.trigger(void 0)}))),this._register(ot(()=>{this.isDisposed=!0}))}get state(){return this._state}get diffs(){return this._diffs}recompute(e){this.recomputeCount++;const t=this.recomputeCount;this._state.get()===1&&(this.isInitializing=!0),zc(n=>{this._state.set(this.isInitializing?1:3,n,0)}),this.diffComputer.computeDiff(this.baseTextModel,this.textModel,e).then(n=>{this.isDisposed||t===this.recomputeCount&&zc(s=>{n.diffs?(this._state.set(2,s,1),this._diffs.set(n.diffs,s,1)):this._state.set(4,s,1),this.isInitializing=!1})})}ensureUpToDate(){if(this.state.get()!==2)throw new Ko("Cannot remove diffs when the model is not up to date")}removeDiffs(e,t,i){this.ensureUpToDate(),e.sort(Pg(s=>s.inputRange.startLineNumber,bk)),e.reverse();let n=this._diffs.get();for(const s of e){const o=n.length;if(n=n.filter(a=>a!==s),o===n.length)throw new Ko;this.barrier.runExclusivelyOrThrow(()=>{const a=s.getReverseLineEdit().toEdits(this.textModel.getLineCount());this.textModel.pushEditOperations(null,a,()=>null,i)}),n=n.map(a=>a.outputRange.isAfter(s.outputRange)?a.addOutputLineDelta(s.inputRange.lineCount-s.outputRange.lineCount):a)}this._diffs.set(n,t,0)}applyEditRelativeToOriginal(e,t,i){this.ensureUpToDate();const n=new Yl(e.range,this.baseTextModel,new $n(e.range.startLineNumber,e.newLines.length),this.textModel);let s=!1,o=0;const a=new Array;for(const c of this.diffs.get()){if(c.inputRange.touches(e.range))throw new Ko("Edit must be conflict free.");c.inputRange.isAfter(e.range)?(s||(s=!0,a.push(n.addOutputLineDelta(o))),a.push(c.addOutputLineDelta(e.newLines.length-e.range.lineCount))):a.push(c),s||(o+=c.outputRange.lineCount-c.inputRange.lineCount)}s||(s=!0,a.push(n.addOutputLineDelta(o))),this.barrier.runExclusivelyOrThrow(()=>{const c=new yw(e.range.delta(o),e.newLines).toEdits(this.textModel.getLineCount());this.textModel.pushEditOperations(null,c,()=>null,i)}),this._diffs.set(a,t,0)}findTouchingDiffs(e){return this.diffs.get().filter(t=>t.inputRange.touches(e))}getResultLine(e,t){let i=0;const n=t?this.diffs.read(t):this.diffs.get();for(const s of n){if(s.inputRange.contains(e)||s.inputRange.endLineNumberExclusive===e)return s;if(s.inputRange.endLineNumberExclusive<e)i=s.resultingDeltaFromOriginalToModified;else break}return e+i}getResultLineRange(e,t){let i=this.getResultLine(e.startLineNumber,t);typeof i!="number"&&(i=i.outputRange.startLineNumber);let n=this.getResultLine(e.endLineNumberExclusive,t);return typeof n!="number"&&(n=n.outputRange.endLineNumberExclusive),$n.fromLineNumbers(i,n)}}class eW{static fromDiffs(e,t,i,n,s){return hI.compute(e,t).map(a=>new eW(a.inputRange,i,a.output1Range,n,a.output1LineMappings,a.output2Range,s,a.output2LineMappings))}constructor(e,t,i,n,s,o,a,c){if(this.baseRange=e,this.baseTextModel=t,this.input1Range=i,this.input1TextModel=n,this.input1Diffs=s,this.input2Range=o,this.input2TextModel=a,this.input2Diffs=c,this.input1CombinedDiff=Yl.join(this.input1Diffs),this.input2CombinedDiff=Yl.join(this.input2Diffs),this.isEqualChange=Ds(this.input1Diffs,this.input2Diffs,(d,l)=>d.getLineEdit().equals(l.getLineEdit())),this.smartInput1LineRangeEdit=null,this.smartInput2LineRangeEdit=null,this.dumbInput1LineRangeEdit=null,this.dumbInput2LineRangeEdit=null,this.input1Diffs.length===0&&this.input2Diffs.length===0)throw new Ko("must have at least one diff")}getInputRange(e){return e===1?this.input1Range:this.input2Range}getInputCombinedDiff(e){return e===1?this.input1CombinedDiff:this.input2CombinedDiff}getInputDiffs(e){return e===1?this.input1Diffs:this.input2Diffs}get isConflicting(){return this.input1Diffs.length>0&&this.input2Diffs.length>0}get canBeCombined(){return this.smartCombineInputs(1)!==void 0}get isOrderRelevant(){const e=this.smartCombineInputs(1),t=this.smartCombineInputs(2);return!e||!t?!1:!e.equals(t)}getEditForBase(e){const t=[];if(e.includesInput1&&this.input1CombinedDiff&&t.push({diff:this.input1CombinedDiff,inputNumber:1}),e.includesInput2&&this.input2CombinedDiff&&t.push({diff:this.input2CombinedDiff,inputNumber:2}),t.length===0)return{edit:void 0,effectiveState:lr.base};if(t.length===1)return{edit:t[0].diff.getLineEdit(),effectiveState:lr.base.withInputValue(t[0].inputNumber,!0,!1)};if(e.kind!==vi.both)throw new Ko;const i=e.smartCombination?this.smartCombineInputs(e.firstInput):this.dumbCombineInputs(e.firstInput);return i?{edit:i,effectiveState:e}:{edit:t[MF(e.firstInput)-1].diff.getLineEdit(),effectiveState:lr.base.withInputValue(MF(e.firstInput),!0,!1)}}smartCombineInputs(e){if(e===1&&this.smartInput1LineRangeEdit!==null)return this.smartInput1LineRangeEdit;if(e===2&&this.smartInput2LineRangeEdit!==null)return this.smartInput2LineRangeEdit;const i=M8(this.input1Diffs.flatMap(s=>s.rangeMappings.map(o=>({diff:o,input:1}))),this.input2Diffs.flatMap(s=>s.rangeMappings.map(o=>({diff:o,input:2})))).sort(G7(Pg(s=>s.diff.inputRange,qe.compareRangesUsingStarts),Pg(s=>s.input===e?1:2,bk))).map(s=>{const o=s.input===1?this.input1TextModel:this.input2TextModel;return new Zme(s.diff.inputRange,o.getValueInRange(s.diff.outputRange))}),n=sve(this.baseRange,i,this.baseTextModel);return e===1?this.smartInput1LineRangeEdit=n:this.smartInput2LineRangeEdit=n,n}dumbCombineInputs(e){if(e===1&&this.dumbInput1LineRangeEdit!==null)return this.dumbInput1LineRangeEdit;if(e===2&&this.dumbInput2LineRangeEdit!==null)return this.dumbInput2LineRangeEdit;let t=this.input1Range.getLines(this.input1TextModel),i=this.input2Range.getLines(this.input2TextModel);e===2&&([t,i]=[i,t]);const n=new yw(this.baseRange,t.concat(i));return e===1?this.dumbInput1LineRangeEdit=n:this.dumbInput2LineRangeEdit=n,n}}function sve(r,e,t){let i="";const n=r.startLineNumber>1;let s=n?new Us(r.startLineNumber-1,t.getLineMaxColumn(r.startLineNumber-1)):new Us(r.startLineNumber,1);for(const l of e){const u=l.range.getStartPosition();if(!s.isBeforeOrEqual(u))return;let h=t.getValueInRange(qe.fromPositions(s,u));u.lineNumber>t.getLineCount()&&(h+=`
`),i+=h,i+=l.newText,s=l.range.getEndPosition()}const o=r.endLineNumberExclusive<=t.getLineCount(),a=o?new Us(r.endLineNumberExclusive,1):new Us(r.endLineNumberExclusive-1,1073741824),c=t.getValueInRange(qe.fromPositions(s,a));i+=c;const d=Uq(i);if(n){if(d[0]!=="")return;d.shift()}if(o){if(d[d.length-1]!=="")return;d.pop()}return new yw(r,d)}var vi;(function(r){r[r.base=0]="base",r[r.input1=1]="input1",r[r.input2=2]="input2",r[r.both=3]="both",r[r.unrecognized=4]="unrecognized"})(vi||(vi={}));function MF(r){return r===1?2:1}class vb{constructor(){}get includesInput1(){return!1}get includesInput2(){return!1}includesInput(e){return e===1?this.includesInput1:this.includesInput2}isInputIncluded(e){return e===1?this.includesInput1:this.includesInput2}toggle(e){return this.withInputValue(e,!this.includesInput(e),!0)}getInput(e){return this.isInputIncluded(e)?1:0}}class tW extends vb{get kind(){return vi.base}toString(){return"base"}swap(){return this}withInputValue(e,t,i=!1){return e===1?t?new fI:this:t?new Df:this}equals(e){return e.kind===vi.base}}class fI extends vb{get kind(){return vi.input1}get includesInput1(){return!0}toString(){return"1✓"}swap(){return new Df}withInputValue(e,t,i=!1){return e===1?t?this:new tW:t?new pI(1,i):new Df}equals(e){return e.kind===vi.input1}}class Df extends vb{get kind(){return vi.input2}get includesInput2(){return!0}toString(){return"2✓"}swap(){return new fI}withInputValue(e,t,i=!1){return e===2?t?this:new tW:t?new pI(2,i):new Df}equals(e){return e.kind===vi.input2}}class pI extends vb{constructor(e,t){super(),this.firstInput=e,this.smartCombination=t}get kind(){return vi.both}get includesInput1(){return!0}get includesInput2(){return!0}toString(){return"2✓"}swap(){return new pI(MF(this.firstInput),this.smartCombination)}withInputValue(e,t,i=!1){return t?this:e===1?new Df:new fI}equals(e){return e.kind===vi.both&&this.firstInput===e.firstInput&&this.smartCombination===e.smartCombination}getInput(e){return e===this.firstInput?1:2}}class ove extends vb{get kind(){return vi.unrecognized}toString(){return"unrecognized"}swap(){return this}withInputValue(e,t,i=!1){return t?e===1?new fI:new Df:this}equals(e){return e.kind===vi.unrecognized}}var lr;(function(r){r.base=new tW,r.unrecognized=new ove})(lr||(lr={}));let iD=class extends db{constructor(e,t,i,n,s,o,a,c,d){super(),this.base=e,this.input1=t,this.input2=i,this.resultTextModel=n,this.diffComputer=s,this.options=o,this.telemetry=a,this.languageService=c,this.undoRedoService=d,this.input1TextModelDiffs=this._register(new cP(this.base,this.input1.textModel,this.diffComputer)),this.input2TextModelDiffs=this._register(new cP(this.base,this.input2.textModel,this.diffComputer)),this.resultTextModelDiffs=this._register(new cP(this.base,this.resultTextModel,this.diffComputer)),this.modifiedBaseRanges=Os("modifiedBaseRanges",u=>{const h=this.input1TextModelDiffs.diffs.read(u),g=this.input2TextModelDiffs.diffs.read(u);return eW.fromDiffs(h,g,this.base,this.input1.textModel,this.input2.textModel)}),this.modifiedBaseRangeResultStates=Os("modifiedBaseRangeResultStates",u=>new Map(this.modifiedBaseRanges.read(u).map(g=>[g,new nV(g)]))),this.resultSnapshot=this.resultTextModel.createSnapshot(),this.baseInput1Diffs=this.input1TextModelDiffs.diffs,this.baseInput2Diffs=this.input2TextModelDiffs.diffs,this.baseResultDiffs=this.resultTextModelDiffs.diffs,this.input1ResultMapping=Os("input1ResultMapping",u=>this.getInputResultMapping(this.baseInput1Diffs.read(u),this.baseResultDiffs.read(u),this.input1.textModel.getLineCount())),this.resultInput1Mapping=Os("resultInput1Mapping",u=>this.input1ResultMapping.read(u).reverse()),this.input2ResultMapping=Os("input2ResultMapping",u=>this.getInputResultMapping(this.baseInput2Diffs.read(u),this.baseResultDiffs.read(u),this.input2.textModel.getLineCount())),this.resultInput2Mapping=Os("resultInput2Mapping",u=>this.input2ResultMapping.read(u).reverse()),this.baseResultMapping=Os("baseResultMapping",u=>{const h=new gh(this.baseResultDiffs.read(u),-1);return new gh(h.lineRangeMappings.map(g=>g.inputRange.isEmpty||g.outputRange.isEmpty?new is(g.inputRange.deltaStart(-1),g.outputRange.deltaStart(-1)):g),h.inputLineCount)}),this.resultBaseMapping=Os("resultBaseMapping",u=>this.baseResultMapping.read(u).reverse()),this.diffComputingState=Os("diffComputingState",u=>{const h=[this.input1TextModelDiffs,this.input2TextModelDiffs,this.resultTextModelDiffs].map(g=>g.state.read(u));return h.some(g=>g===1)?1:h.some(g=>g===3)?3:2}),this.inputDiffComputingState=Os("inputDiffComputingState",u=>{const h=[this.input1TextModelDiffs,this.input2TextModelDiffs].map(g=>g.state.read(u));return h.some(g=>g===1)?1:h.some(g=>g===3)?3:2}),this.isUpToDate=Os("isUpToDate",u=>this.diffComputingState.read(u)===2),this.onInitialized=WI(this.diffComputingState,u=>u===2).then(()=>{}),this.firstRun=!0,this.unhandledConflictsCount=Os("unhandledConflictsCount",u=>{const h=this.modifiedBaseRangeResultStates.read(u);let g=0;for(const[m,y]of h)y.handled.read(u)||g++;return g}),this.hasUnhandledConflicts=this.unhandledConflictsCount.map(u=>u>0),this._register(HI(this.modifiedBaseRangeResultStates)),this._register(HI(this.input1ResultMapping)),this._register(HI(this.input2ResultMapping));const l=this.initialize();this.onInitialized=this.onInitialized.then(async()=>{await l}),l.then(()=>{let u=!0;this._register(z7("Merge Editor Model: Recompute State From Result",{handleChange:h=>(h.didChange(this.modifiedBaseRangeResultStates)&&(u=!0),h.didChange(this.resultTextModelDiffs.diffs)?h.change===1:!0)},h=>{const g=this.modifiedBaseRangeResultStates.read(h);if(!this.isUpToDate.read(h))return;const m=this.resultTextModelDiffs.diffs.read(h);zc(y=>{if(this.updateBaseRangeAcceptedState(m,g,y),u){u=!1;for(const[_,b]of g){const E=b.accepted.get(),D=!(E.kind===vi.base||E.kind===vi.unrecognized);b.handledInput1.set(D,y),b.handledInput2.set(D,y)}}})}))})}async initialize(){this.options.resetResult&&await this.reset()}async reset(){await WI(this.inputDiffComputingState,t=>t===2);const e=this.modifiedBaseRangeResultStates.get();zc(t=>{for(const[i,n]of e){let s,o=!1;i.input1Diffs.length===0?(s=lr.base.withInputValue(2,!0),o=!0):i.input2Diffs.length===0||i.isEqualChange?(s=lr.base.withInputValue(1,!0),o=!0):(s=lr.base,o=!1),n.accepted.set(s,t),n.computedFromDiffing=!1,n.previousNonDiffingState=void 0,n.handledInput1.set(o,t),n.handledInput2.set(o,t)}this.resultTextModel.pushEditOperations(null,[{range:new qe(1,1,Number.MAX_SAFE_INTEGER,1),text:this.computeAutoMergedResult()}],()=>null)})}computeAutoMergedResult(){const e=this.modifiedBaseRanges.get(),t=this.base.getLinesContent(),i=this.input1.textModel.getLinesContent(),n=this.input2.textModel.getLinesContent(),s=[];function o(c,d){for(let l=d.startLineNumber;l<d.endLineNumberExclusive;l++)s.push(c[l-1])}let a=1;for(const c of e)o(t,$n.fromLineNumbers(a,c.baseRange.startLineNumber)),a=c.baseRange.endLineNumberExclusive,c.input1Diffs.length===0?o(n,c.input2Range):c.input2Diffs.length===0||c.isEqualChange?o(i,c.input1Range):o(t,c.baseRange);return o(t,$n.fromLineNumbers(a,t.length+1)),s.join(this.resultTextModel.getEOL())}hasBaseRange(e){return this.modifiedBaseRangeResultStates.get().has(e)}get isApplyingEditInResult(){return this.resultTextModelDiffs.isApplyingChange}getInputResultMapping(e,t,i){const n=gh.betweenOutputs(e,t,i);return new gh(n.lineRangeMappings.map(s=>s.inputRange.isEmpty||s.outputRange.isEmpty?new is(s.inputRange.deltaStart(-1),s.outputRange.deltaStart(-1)):s),n.inputLineCount)}translateInputRangeToBase(e,t){const i=e===1?this.baseInput1Diffs.get():this.baseInput2Diffs.get();return new Zp(i.flatMap(s=>s.rangeMappings),0).reverse().projectRange(t).outputRange}translateBaseRangeToInput(e,t){const i=e===1?this.baseInput1Diffs.get():this.baseInput2Diffs.get();return new Zp(i.flatMap(s=>s.rangeMappings),0).projectRange(t).outputRange}getLineRangeInResult(e,t){return this.resultTextModelDiffs.getResultLineRange(e,t)}translateResultRangeToBase(e){return new Zp(this.baseResultDiffs.get().flatMap(i=>i.rangeMappings),0).reverse().projectRange(e).outputRange}translateBaseRangeToResult(e){return new Zp(this.baseResultDiffs.get().flatMap(i=>i.rangeMappings),0).projectRange(e).outputRange}findModifiedBaseRangesInRange(e){return this.modifiedBaseRanges.get().filter(t=>t.baseRange.intersects(e))}updateBaseRangeAcceptedState(e,t,i){const n=Xme(t,e,(s,o)=>s[0].baseRange.touches(o.inputRange)?NP.neitherLessOrGreaterThan:$n.compareByStart(s[0].baseRange,o.inputRange));for(const s of n){const o=this.computeState(s.left[0],s.rights),a=s.left[1],c=a.accepted.get();c.equals(o)||(!this.firstRun&&!a.computedFromDiffing&&(a.computedFromDiffing=!0,a.previousNonDiffingState=c),a.accepted.set(o,i))}this.firstRun&&(this.firstRun=!1)}computeState(e,t){if(t.length===0)return lr.base;const i=t.map(o=>o.getLineEdit());function n(o){return Ds(i,o.map(a=>a.getLineEdit()),(a,c)=>a.equals(c))}if(n(e.input1Diffs))return lr.base.withInputValue(1,!0);if(n(e.input2Diffs))return lr.base.withInputValue(2,!0);const s=[lr.base.withInputValue(1,!0).withInputValue(2,!0,!0),lr.base.withInputValue(2,!0).withInputValue(1,!0,!0),lr.base.withInputValue(1,!0).withInputValue(2,!0,!1),lr.base.withInputValue(2,!0).withInputValue(1,!0,!1)];for(const o of s){const{edit:a}=e.getEditForBase(o);if(a){const d=this.resultTextModelDiffs.getResultLineRange(e.baseRange).getLines(this.resultTextModel);if(Ds(a.newLines,d,(l,u)=>l===u))return o}}return lr.unrecognized}getState(e){const t=this.modifiedBaseRangeResultStates.get().get(e);if(!t)throw new Ko("object must be from this instance");return t.accepted}setState(e,t,i,n,s=!1){if(!this.isUpToDate.get())throw new Ko("Cannot set state while updating");const o=this.modifiedBaseRangeResultStates.get().get(e);if(!o)throw new Ko("object must be from this instance");const a=this.resultTextModelDiffs.findTouchingDiffs(e.baseRange),c=new K7;a&&this.resultTextModelDiffs.removeDiffs(a,n,c);const{edit:d,effectiveState:l}=e.getEditForBase(t);o.accepted.set(l,n),o.previousNonDiffingState=void 0,o.computedFromDiffing=!1;const u=o.handledInput1.get(),h=o.handledInput2.get();(!u||!h)&&this.undoRedoService.pushElement(new ave(this.resultTextModel.uri,new WeakRef(this),new WeakRef(o),u,h),c),d&&(this.resultTextModel.pushStackElement(),this.resultTextModelDiffs.applyEditRelativeToOriginal(d,n,c),this.resultTextModel.pushStackElement()),o.handledInput1.set(!0,n),o.handledInput2.set(!0,n)}resetDirtyConflictsToBase(){zc(e=>{this.resultTextModel.pushStackElement();for(const t of this.modifiedBaseRanges.get())this.getState(t).get().kind===vi.unrecognized&&this.setState(t,lr.base,!1,e,!1);this.resultTextModel.pushStackElement()})}isHandled(e){return this.modifiedBaseRangeResultStates.get().get(e).handled}isInputHandled(e,t){const i=this.modifiedBaseRangeResultStates.get().get(e);return t===1?i.handledInput1:i.handledInput2}setInputHandled(e,t,i,n){const s=this.modifiedBaseRangeResultStates.get().get(e);if(s.handled.get()===i)return;const o=new WeakRef(nV),a=new WeakRef(this);this.undoRedoService.pushElement({type:0,resource:this.resultTextModel.uri,code:"setInputHandled",label:p("setInputHandled","Set Input Handled"),redo(){const c=a.deref(),d=o.deref();c&&!c.isDisposed()&&d&&zc(l=>{t===1?s.handledInput1.set(i,l):s.handledInput2.set(i,l)})},undo(){const c=a.deref(),d=o.deref();c&&!c.isDisposed()&&d&&zc(l=>{t===1?s.handledInput1.set(!i,l):s.handledInput2.set(!i,l)})}}),t===1?s.handledInput1.set(i,n):s.handledInput2.set(i,n)}setHandled(e,t,i){const n=this.modifiedBaseRangeResultStates.get().get(e);n.handled.get()!==t&&(n.handledInput1.set(t,i),n.handledInput2.set(t,i))}setLanguageId(e,t){const i=this.languageService.createById(e);this.base.setLanguage(i,t),this.input1.textModel.setLanguage(i,t),this.input2.textModel.setLanguage(i,t),this.resultTextModel.setLanguage(i,t)}getInitialResultValue(){const e=[];for(;;){const t=this.resultSnapshot.read();if(t===null)break;e.push(t)}return e.join()}async getResultValueWithConflictMarkers(){if(await WI(this.diffComputingState,c=>c===2),this.unhandledConflictsCount.get()===0)return this.resultTextModel.getValue();const e=this.resultTextModel.getLinesContent(),t=this.input1.textModel.getLinesContent(),i=this.input2.textModel.getLinesContent(),n=this.modifiedBaseRangeResultStates.get(),s=[];function o(c,d){for(let l=d.startLineNumber;l<d.endLineNumberExclusive;l++)s.push(c[l-1])}let a=1;for(const[c,d]of n){if(d.handled.get())continue;const l=this.resultTextModelDiffs.getResultLineRange(c.baseRange);o(e,$n.fromLineNumbers(a,Math.max(a,l.startLineNumber))),a=l.endLineNumberExclusive,s.push("<<<<<<<"),d.accepted.get().kind===vi.unrecognized?o(e,l):o(t,c.input1Range),s.push("======="),o(i,c.input2Range),s.push(">>>>>>>")}return o(e,$n.fromLineNumbers(a,e.length+1)),s.join(`
`)}get conflictCount(){return ms(this.modifiedBaseRanges.get(),e=>e.isConflicting)}get combinableConflictCount(){return ms(this.modifiedBaseRanges.get(),e=>e.isConflicting&&e.canBeCombined)}get conflictsResolvedWithBase(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===vi.base)}get conflictsResolvedWithInput1(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===vi.input1)}get conflictsResolvedWithInput2(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===vi.input2)}get conflictsResolvedWithSmartCombination(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===vi.both&&i.smartCombination})}get manuallySolvedConflictCountThatEqualNone(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===vi.unrecognized)}get manuallySolvedConflictCountThatEqualSmartCombine(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===vi.both&&i.smartCombination})}get manuallySolvedConflictCountThatEqualInput1(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===vi.input1})}get manuallySolvedConflictCountThatEqualInput2(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===vi.input2})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBase(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{var n;const i=t.accepted.get();return e.isConflicting&&i.kind===vi.unrecognized&&((n=t.previousNonDiffingState)==null?void 0:n.kind)===vi.base})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{var n;const i=t.accepted.get();return e.isConflicting&&i.kind===vi.unrecognized&&((n=t.previousNonDiffingState)==null?void 0:n.kind)===vi.input1})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{var n;const i=t.accepted.get();return e.isConflicting&&i.kind===vi.unrecognized&&((n=t.previousNonDiffingState)==null?void 0:n.kind)===vi.input2})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{var n,s;const i=t.accepted.get();return e.isConflicting&&i.kind===vi.unrecognized&&((n=t.previousNonDiffingState)==null?void 0:n.kind)===vi.both&&!((s=t.previousNonDiffingState)!=null&&s.smartCombination)})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart(){return ms(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{var n,s;const i=t.accepted.get();return e.isConflicting&&i.kind===vi.unrecognized&&((n=t.previousNonDiffingState)==null?void 0:n.kind)===vi.both&&((s=t.previousNonDiffingState)==null?void 0:s.smartCombination)})}};iD=T([v(7,ji),v(8,o1)],iD);function ms(r,e){let t=0;for(const i of r)e(i)&&t++;return t}class nV{constructor(e){this.baseRange=e,this.accepted=cg(`BaseRangeState${this.baseRange.baseRange}`,lr.base),this.handledInput1=cg(`BaseRangeHandledState${this.baseRange.baseRange}.Input1`,!1),this.handledInput2=cg(`BaseRangeHandledState${this.baseRange.baseRange}.Input2`,!1),this.computedFromDiffing=!1,this.previousNonDiffingState=void 0,this.handled=Os("handled",t=>this.handledInput1.read(t)&&this.handledInput2.read(t))}}class ave{constructor(e,t,i,n,s){this.resource=e,this.mergeEditorModelRef=t,this.stateRef=i,this.input1Handled=n,this.input2Handled=s,this.code="undoMarkAsHandled",this.label=p("undoMarkAsHandled","Undo Mark As Handled"),this.type=0}redo(){const e=this.mergeEditorModelRef.deref();if(!e||e.isDisposed())return;const t=this.stateRef.deref();t&&zc(i=>{t.handledInput1.set(!0,i),t.handledInput2.set(!0,i)})}undo(){const e=this.mergeEditorModelRef.deref();if(!e||e.isDisposed())return;const t=this.stateRef.deref();t&&zc(i=>{t.handledInput1.set(this.input1Handled,i),t.handledInput2.set(this.input2Handled,i)})}}const rV="mergeEditorCloseWithConflicts";let LF=class{constructor(e,t,i,n){this._mergeEditorTelemetry=e,this._instantiationService=t,this._textModelService=i,this._modelService=n}async createInputModel(e){const t=new me,[i,n,s,o]=await Promise.all([this._textModelService.createModelReference(e.base),this._textModelService.createModelReference(e.result),rD(e.input1,this._textModelService,t),rD(e.input2,this._textModelService,t)]);t.add(i),t.add(n);const a=n.object.textEditorModel.uri.with({scheme:"merge-result"}),c=this._modelService.createModel("",{languageId:n.object.textEditorModel.getLanguageId(),onDidChange:F.None},a);t.add(c);const d=this._instantiationService.createInstance(tD),l=this._instantiationService.createInstance(iD,i.object.textEditorModel,s,o,c,d,{resetResult:!0},this._mergeEditorTelemetry);return t.add(l),await l.onInitialized,this._instantiationService.createInstance(FF,l,t,n.object,e.result)}};LF=T([v(1,Te),v(2,or),v(3,_i)],LF);let FF=class extends db{constructor(e,t,i,n,s,o,a){super(),this.model=e,this.disposable=t,this.result=i,this.resultUri=n,this.textFileService=s,this.dialogService=o,this.editorService=a,this.savedAltVersionId=cg("initialAltVersionId",this.model.resultTextModel.getAlternativeVersionId()),this.altVersionId=a1(c=>this.model.resultTextModel.onDidChangeContent(c),()=>this.model.resultTextModel.getAlternativeVersionId()),this.isDirty=Os("isDirty",c=>this.altVersionId.read(c)!==this.savedAltVersionId.read(c)),this.finished=!1}dispose(){this.disposable.dispose(),super.dispose()}async accept(){const e=await this.model.resultTextModel.getValue();this.result.textEditorModel.setValue(e),this.savedAltVersionId.set(this.model.resultTextModel.getAlternativeVersionId(),void 0),await this.textFileService.save(this.result.textEditorModel.uri),this.finished=!0}async _discard(){await this.textFileService.revert(this.model.resultTextModel.uri),this.savedAltVersionId.set(this.model.resultTextModel.getAlternativeVersionId(),void 0),this.finished=!0}shouldConfirmClose(){return!0}async confirmClose(e){Gm(()=>e.some(n=>n===this));const t=e.some(n=>n.isDirty.get());let i;if(t){const n=e.length>1,s=n?p("messageN","Do you want keep the merge result of {0} files?",e.length):p("message1","Do you want keep the merge result of {0}?",Mt(e[0].model.resultTextModel.uri)),o=e.some(c=>c.model.hasUnhandledConflicts.get()),a=[{label:o?p({key:"saveWithConflict",comment:["&& denotes a mnemonic"]},"&&Save With Conflicts"):p({key:"save",comment:["&& denotes a mnemonic"]},"&&Save"),run:()=>0},{label:p({key:"discard",comment:["&& denotes a mnemonic"]},"Do&&n't Save"),run:()=>1}];i=(await this.dialogService.prompt({type:yi.Info,message:s,detail:o?n?p("detailNConflicts","The files contain unhandled conflicts. The merge results will be lost if you don't save them."):p("detail1Conflicts","The file contains unhandled conflicts. The merge result will be lost if you don't save it."):n?p("detailN","The merge results will be lost if you don't save them."):p("detail1","The merge result will be lost if you don't save it."),buttons:a,cancelButton:{run:()=>2}})).result}else i=1;return i===0?await Promise.all(e.map(n=>n.accept())):i===1&&await Promise.all(e.map(n=>n._discard())),i}async save(e){this.finished||(async()=>{const{confirmed:t}=await this.dialogService.confirm({message:p("saveTempFile.message","Do you want to accept the merge result?"),detail:p("saveTempFile.detail","This will write the merge result to the original file and close the merge editor."),primaryButton:p({key:"acceptMerge",comment:["&& denotes a mnemonic"]},"&&Accept Merge")});if(t){await this.accept();const i=this.editorService.findEditors(this.resultUri).filter(n=>n.editor.typeId==="mergeEditor.Input");await this.editorService.closeEditors(i)}})()}async revert(e){}};FF=T([v(4,Dn),v(5,ar),v(6,Ke)],FF);let nD=class L8{constructor(e,t,i,n){this._mergeEditorTelemetry=e,this._instantiationService=t,this._textModelService=i,this.textFileService=n}async createInputModel(e){const t=new me;let i;const n=t.add(new me),s=y=>{si(e.result,y.resource)&&(n.clear(),i=y)};n.add(this.textFileService.files.onDidCreate(s)),this.textFileService.files.models.forEach(s);const[o,a,c,d]=await Promise.all([this._textModelService.createModelReference(e.base),this._textModelService.createModelReference(e.result),rD(e.input1,this._textModelService,t),rD(e.input2,this._textModelService,t)]);if(t.add(o),t.add(a),!i)throw new Ko;await i.save({source:L8.FILE_SAVED_SOURCE});const h=i.textEditorModel.getLinesContent().some(y=>y.startsWith(Qme.start)),g=this._instantiationService.createInstance(tD),m=this._instantiationService.createInstance(iD,o.object.textEditorModel,c,d,a.object.textEditorModel,g,{resetResult:h},this._mergeEditorTelemetry);return t.add(m),await m.onInitialized,this._instantiationService.createInstance(OF,m,t,i,this._mergeEditorTelemetry)}};nD.FILE_SAVED_SOURCE=MT.registerSource("merge-editor.source",p("merge-editor.source","Before Resolving Conflicts In Merge Editor"));nD=T([v(1,Te),v(2,or),v(3,Dn)],nD);let OF=class extends db{constructor(e,t,i,n,s,o){super(),this.model=e,this.disposableStore=t,this.resultTextFileModel=i,this.telemetry=n,this._dialogService=s,this._storageService=o,this.isDirty=a1(F.any(this.resultTextFileModel.onDidChangeDirty,this.resultTextFileModel.onDidSaveError),()=>this.resultTextFileModel.isDirty()),this.reported=!1,this.dateTimeOpened=new Date}dispose(){this.disposableStore.dispose(),super.dispose(),this.reportClose(!1)}reportClose(e){if(!this.reported){const t=this.model.unhandledConflictsCount.get(),i=new Date().getTime()-this.dateTimeOpened.getTime();this.telemetry.reportMergeEditorClosed({durationOpenedSecs:i/1e3,remainingConflictCount:t,accepted:e,conflictCount:this.model.conflictCount,combinableConflictCount:this.model.combinableConflictCount,conflictsResolvedWithBase:this.model.conflictsResolvedWithBase,conflictsResolvedWithInput1:this.model.conflictsResolvedWithInput1,conflictsResolvedWithInput2:this.model.conflictsResolvedWithInput2,conflictsResolvedWithSmartCombination:this.model.conflictsResolvedWithSmartCombination,manuallySolvedConflictCountThatEqualNone:this.model.manuallySolvedConflictCountThatEqualNone,manuallySolvedConflictCountThatEqualSmartCombine:this.model.manuallySolvedConflictCountThatEqualSmartCombine,manuallySolvedConflictCountThatEqualInput1:this.model.manuallySolvedConflictCountThatEqualInput1,manuallySolvedConflictCountThatEqualInput2:this.model.manuallySolvedConflictCountThatEqualInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBase:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBase,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart}),this.reported=!0}}async accept(){this.reportClose(!0),await this.resultTextFileModel.save()}get resultUri(){return this.resultTextFileModel.resource}async save(e){await this.resultTextFileModel.save(e)}async revert(e){await this.resultTextFileModel.revert(e)}shouldConfirmClose(){return!0}async confirmClose(e){const t=e.length>1,i=e.some(s=>s.isDirty.get()),n=e.some(s=>s.model.hasUnhandledConflicts.get());if(i){const s=t?p("workspace.messageN","Do you want to save the changes you made to {0} files?",e.length):p("workspace.message1","Do you want to save the changes you made to {0}?",Mt(e[0].resultUri)),{result:o}=await this._dialogService.prompt({type:yi.Info,message:s,detail:n?t?p("workspace.detailN.unhandled","The files contain unhandled conflicts. Your changes will be lost if you don't save them."):p("workspace.detail1.unhandled","The file contains unhandled conflicts. Your changes will be lost if you don't save them."):t?p("workspace.detailN.handled","Your changes will be lost if you don't save them."):p("workspace.detail1.handled","Your changes will be lost if you don't save them."),buttons:[{label:n?p({key:"workspace.saveWithConflict",comment:["&& denotes a mnemonic"]},"&&Save with Conflicts"):p({key:"workspace.save",comment:["&& denotes a mnemonic"]},"&&Save"),run:()=>0},{label:p({key:"workspace.doNotSave",comment:["&& denotes a mnemonic"]},"Do&&n't Save"),run:()=>1}],cancelButton:{run:()=>2}});return o}else if(n&&!this._storageService.getBoolean(rV,0,!1)){const{confirmed:s,checkboxChecked:o}=await this._dialogService.confirm({message:t?p("workspace.messageN.nonDirty","Do you want to close {0} merge editors?",e.length):p("workspace.message1.nonDirty","Do you want to close the merge editor for {0}?",Mt(e[0].resultUri)),detail:n?t?p("workspace.detailN.unhandled.nonDirty","The files contain unhandled conflicts."):p("workspace.detail1.unhandled.nonDirty","The file contains unhandled conflicts."):void 0,primaryButton:n?p({key:"workspace.closeWithConflicts",comment:["&& denotes a mnemonic"]},"&&Close with Conflicts"):p({key:"workspace.close",comment:["&& denotes a mnemonic"]},"&&Close"),checkbox:{label:p("noMoreWarn","Don't ask again")}});return o&&this._storageService.store(rV,!0,0,0),s?0:2}else return 0}};OF=T([v(4,ar),v(5,ri)],OF);async function rD(r,e,t){const i=await e.createModelReference(r.uri);return t.add(i),{textModel:i.object.textEditorModel,title:r.title,description:r.description,detail:r.detail}}let NF=class{constructor(e){this.telemetryService=e}reportMergeEditorOpened(e){this.telemetryService.publicLog2("mergeEditor.opened",{conflictCount:e.conflictCount,combinableConflictCount:e.combinableConflictCount,baseVisible:e.baseVisible,isColumnView:e.isColumnView,baseTop:e.baseTop})}reportLayoutChange(e){this.telemetryService.publicLog2("mergeEditor.layoutChanged",{baseVisible:e.baseVisible,isColumnView:e.isColumnView,baseTop:e.baseTop})}reportMergeEditorClosed(e){this.telemetryService.publicLog2("mergeEditor.closed",{conflictCount:e.conflictCount,combinableConflictCount:e.combinableConflictCount,durationOpenedSecs:e.durationOpenedSecs,remainingConflictCount:e.remainingConflictCount,accepted:e.accepted,conflictsResolvedWithBase:e.conflictsResolvedWithBase,conflictsResolvedWithInput1:e.conflictsResolvedWithInput1,conflictsResolvedWithInput2:e.conflictsResolvedWithInput2,conflictsResolvedWithSmartCombination:e.conflictsResolvedWithSmartCombination,manuallySolvedConflictCountThatEqualNone:e.manuallySolvedConflictCountThatEqualNone,manuallySolvedConflictCountThatEqualSmartCombine:e.manuallySolvedConflictCountThatEqualSmartCombine,manuallySolvedConflictCountThatEqualInput1:e.manuallySolvedConflictCountThatEqualInput1,manuallySolvedConflictCountThatEqualInput2:e.manuallySolvedConflictCountThatEqualInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBase:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBase,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart})}reportAcceptInvoked(e,t){this.telemetryService.publicLog2("mergeEditor.action.accept",{otherAccepted:t,isInput1:e===1})}reportSmartCombinationInvoked(e){this.telemetryService.publicLog2("mergeEditor.action.smartCombination",{otherAccepted:e})}reportRemoveInvoked(e,t){this.telemetryService.publicLog2("mergeEditor.action.remove",{otherAccepted:t,isInput1:e===1})}reportResetToBaseInvoked(){this.telemetryService.publicLog2("mergeEditor.action.resetToBase",{})}reportNavigationToNextConflict(){this.telemetryService.publicLog2("mergeEditor.action.goToNextConflict",{})}reportNavigationToPreviousConflict(){this.telemetryService.publicLog2("mergeEditor.action.goToPreviousConflict",{})}reportConflictCounterClicked(){this.telemetryService.publicLog2("mergeEditor.action.conflictCounterClicked",{})}};NF=T([v(0,gi)],NF);let sD=class rC extends cc{get useWorkingCopy(){return this.configurationService.getValue("mergeEditor.useWorkingCopy")??!1}constructor(e,t,i,n,s,o,a,c,d,l,u){super(n,void 0,o,a,c,d,u),this.base=e,this.input1=t,this.input2=i,this.result=n,this._instaService=s,this.configurationService=l,this.closeHandler={showConfirm:()=>{var h;return((h=this._inputModel)==null?void 0:h.shouldConfirmClose())??!1},confirm:async h=>{Gm(()=>h.every(m=>m.editor instanceof rC));const g=h.map(m=>m.editor._inputModel).filter(Op);return await this._inputModel.confirmClose(g)}},this.mergeEditorModeFactory=this._instaService.createInstance(this.useWorkingCopy?LF:nD,this._instaService.createInstance(NF))}dispose(){super.dispose()}get typeId(){return rC.ID}get editorId(){return fd.id}get capabilities(){let e=super.capabilities|256;return this.useWorkingCopy&&(e|=4),e}getName(){return p("name","Merging: {0}",super.getName())}async resolve(){if(!this._inputModel){const e=this._register(await this.mergeEditorModeFactory.createInputModel({base:this.base,input1:this.input1,input2:this.input2,result:this.result}));this._inputModel=e,this._register(pG("fire dirty event",t=>{e.isDirty.read(t),this._onDidChangeDirty.fire()})),await this._inputModel.model.onInitialized}return this._inputModel}async accept(){var e;await((e=this._inputModel)==null?void 0:e.accept())}async save(e,t){var i;await((i=this._inputModel)==null?void 0:i.save(t))}toUntyped(){return{input1:{resource:this.input1.uri,label:this.input1.title,description:this.input1.description,detail:this.input1.detail},input2:{resource:this.input2.uri,label:this.input2.title,description:this.input2.description,detail:this.input2.detail},base:{resource:this.base},result:{resource:this.result},options:{override:this.typeId}}}matches(e){var t,i;return this===e?!0:e instanceof rC?si(this.base,e.base)&&si(this.input1.uri,e.input1.uri)&&si(this.input2.uri,e.input2.uri)&&si(this.result,e.result):hc(e)?(this.editorId===((t=e.options)==null?void 0:t.override)||((i=e.options)==null?void 0:i.override)===void 0)&&si(this.base,e.base.resource)&&si(this.input1.uri,e.input1.resource)&&si(this.input2.uri,e.input2.resource)&&si(this.result,e.result.resource):!1}async revert(e,t){var i;return(i=this._inputModel)==null?void 0:i.revert(t)}isDirty(){var e;return((e=this._inputModel)==null?void 0:e.isDirty.get())??!1}setLanguageId(e,t){var i;(i=this._inputModel)==null||i.model.setLanguageId(e,t)}};sD.ID="mergeEditor.Input";sD=T([v(4,Te),v(5,Ke),v(6,Dn),v(7,Qi),v(8,at),v(9,We),v(10,qr)],sD);let sV=class{constructor(e,t,i,n,s){this._editorGroupsService=t,this._configurationService=i,this._logService=n,this._dispoables=new me,this._tabGroupModel=[],this._groupLookup=new Map,this._tabInfoLookup=new Map,this._proxy=e.getProxy(fe.ExtHostEditorTabs),this._dispoables.add(s.onDidEditorsChange(o=>{try{this._updateTabsModel(o)}catch{this._logService.error("Failed to update model, rebuilding"),this._createTabsModel()}})),this._dispoables.add(this._editorGroupsService.onDidAddGroup(()=>this._createTabsModel())),this._dispoables.add(this._editorGroupsService.onDidRemoveGroup(()=>this._createTabsModel())),this._editorGroupsService.whenReady.then(()=>this._createTabsModel())}dispose(){this._groupLookup.clear(),this._tabInfoLookup.clear(),this._dispoables.dispose()}_buildTabObject(e,t,i){const n=t.editorId;return{id:this._generateTabId(t,e.id),label:t.getName(),editorId:n,input:this._editorInputToDto(t),isPinned:e.isSticky(i),isPreview:!e.isPinned(i),isActive:e.isActive(t),isDirty:t.isDirty()}}_editorInputToDto(e){if(e instanceof sD)return{kind:3,base:e.base,input1:e.input1.uri,input2:e.input2.uri,result:e.resource};if(e instanceof cc)return{kind:1,uri:e.resource};if(e instanceof ns&&!(e instanceof Ss)){const t=e.primary.resource,i=e.secondary.resource;return e.primary instanceof cc&&e.secondary instanceof cc&&si(t,i)&&t&&i?{kind:1,uri:t}:{kind:0}}if(e instanceof IS)return{kind:4,notebookType:e.viewType,uri:e.resource};if(e instanceof Gh)return{kind:6,viewType:e.viewType,uri:e.resource};if(e instanceof qs)return{kind:7,viewType:e.viewType};if(e instanceof Zx)return{kind:8};if(e instanceof Ss){if(e.modified instanceof cc&&e.original instanceof cc)return{kind:2,modified:e.modified.resource,original:e.original.resource};if(e.modified instanceof IS&&e.original instanceof IS)return{kind:5,notebookType:e.original.viewType,modified:e.modified.resource,original:e.original.resource}}return e instanceof eD?{kind:9,uri:e.resource,inputBoxUri:e.inputResource}:{kind:0}}_generateTabId(e,t){var s,o;let i;const n=Vn.getCanonicalUri(e,{supportSideBySide:Ui.BOTH});return n instanceof k?i=n.toString():i=`${(s=n==null?void 0:n.primary)==null?void 0:s.toString()}-${(o=n==null?void 0:n.secondary)==null?void 0:o.toString()}`,`${t}~${e.editorId}-${e.typeId}-${i} `}_onDidGroupActivate(){const e=this._editorGroupsService.activeGroup.id,t=this._groupLookup.get(e);t&&(t.isActive=!0,this._proxy.$acceptTabGroupUpdate(t))}_onDidTabLabelChange(e,t,i){const n=this._generateTabId(t,e),s=this._tabInfoLookup.get(n);s?(s.tab.label=t.getName(),this._proxy.$acceptTabOperation({groupId:e,index:i,tabDto:s.tab,kind:2})):(this._logService.error("Invalid model for label change, rebuilding"),this._createTabsModel())}_onDidTabOpen(e,t,i){var c;const n=this._editorGroupsService.getGroup(e),s=this._groupLookup.get(e)!==void 0;if(!n||!s){this._createTabsModel();return}const o=(c=this._groupLookup.get(e))==null?void 0:c.tabs;if(!o)return;const a=this._buildTabObject(n,t,i);o.splice(i,0,a),this._tabInfoLookup.set(this._generateTabId(t,e),{group:n,editorInput:t,tab:a}),this._proxy.$acceptTabOperation({groupId:e,index:i,tabDto:a,kind:0})}_onDidTabClose(e,t){var o,a;const i=this._editorGroupsService.getGroup(e),n=(o=this._groupLookup.get(e))==null?void 0:o.tabs;if(!i||!n){this._createTabsModel();return}const s=n.splice(t,1);s.length!==0&&(this._tabInfoLookup.delete(((a=s[0])==null?void 0:a.id)??""),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:s[0],kind:1}))}_onDidTabActiveChange(e,t){var s;const i=(s=this._groupLookup.get(e))==null?void 0:s.tabs;if(!i)return;const n=i[t];n.isActive=!0,this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:n,kind:2})}_onDidTabDirty(e,t,i){const n=this._generateTabId(i,e),s=this._tabInfoLookup.get(n);if(!s){this._logService.error("Invalid model for dirty change, rebuilding"),this._createTabsModel();return}s.tab.isDirty=i.isDirty(),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:s.tab,kind:2})}_onDidTabPinChange(e,t,i){const n=this._generateTabId(i,e),s=this._tabInfoLookup.get(n),o=s==null?void 0:s.group,a=s==null?void 0:s.tab;if(!o||!a){this._logService.error("Invalid model for sticky change, rebuilding"),this._createTabsModel();return}a.isPinned=o.isSticky(t),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:a,kind:2})}_onDidTabPreviewChange(e,t,i){const n=this._generateTabId(i,e),s=this._tabInfoLookup.get(n),o=s==null?void 0:s.group,a=s==null?void 0:s.tab;if(!o||!a){this._logService.error("Invalid model for sticky change, rebuilding"),this._createTabsModel();return}a.isPreview=!o.isPinned(t),this._proxy.$acceptTabOperation({kind:2,groupId:e,tabDto:a,index:t})}_onDidTabMove(e,t,i,n){var a;const s=(a=this._groupLookup.get(e))==null?void 0:a.tabs;if(!s){this._logService.error("Invalid model for move change, rebuilding"),this._createTabsModel();return}const o=s.splice(i,1);o.length!==0&&(s.splice(t,0,o[0]),this._proxy.$acceptTabOperation({kind:3,groupId:e,tabDto:o[0],index:t,oldIndex:i}))}_createTabsModel(){this._tabGroupModel=[],this._groupLookup.clear(),this._tabInfoLookup.clear();let e=[];for(const t of this._editorGroupsService.groups){const i={groupId:t.id,isActive:t.id===this._editorGroupsService.activeGroup.id,viewColumn:gu(this._editorGroupsService,t),tabs:[]};t.editors.forEach((n,s)=>{const o=this._buildTabObject(t,n,s);e.push(o),this._tabInfoLookup.set(this._generateTabId(n,t.id),{group:t,tab:o,editorInput:n})}),i.tabs=e,this._tabGroupModel.push(i),this._groupLookup.set(t.id,i),e=[]}this._proxy.$acceptEditorTabModel(this._tabGroupModel)}_updateTabsModel(e){const t=e.event,i=e.groupId;switch(t.kind){case 0:if(i===this._editorGroupsService.activeGroup.id){this._onDidGroupActivate();break}else return;case 7:if(t.editor!==void 0&&t.editorIndex!==void 0){this._onDidTabLabelChange(i,t.editor,t.editorIndex);break}case 3:if(t.editor!==void 0&&t.editorIndex!==void 0){this._onDidTabOpen(i,t.editor,t.editorIndex);break}case 4:if(t.editorIndex!==void 0){this._onDidTabClose(i,t.editorIndex);break}case 6:if(t.editorIndex!==void 0){this._onDidTabActiveChange(i,t.editorIndex);break}case 11:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabDirty(i,t.editorIndex,t.editor);break}case 10:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabPinChange(i,t.editorIndex,t.editor);break}case 9:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabPreviewChange(i,t.editorIndex,t.editor);break}case 5:if(zme(t)&&t.editor&&t.editorIndex!==void 0&&t.oldEditorIndex!==void 0){this._onDidTabMove(i,t.editorIndex,t.oldEditorIndex,t.editor);break}default:this._createTabsModel()}}$moveTab(e,t,i,n){const s=qh(this._editorGroupsService,this._configurationService,i),o=this._tabInfoLookup.get(e);if(!(o==null?void 0:o.tab))throw new Error(`Attempted to close tab with id ${e} which does not exist`);let c;const d=this._editorGroupsService.getGroup(o.group.id);if(!d)return;if(this._groupLookup.get(s)===void 0){let u=3;i===Ed&&(u=Vf(this._configurationService)),c=this._editorGroupsService.addGroup(this._editorGroupsService.groups[this._editorGroupsService.groups.length-1],u,void 0)}else c=this._editorGroupsService.getGroup(s);if(!c)return;(t<0||t>c.editors.length)&&(t=c.editors.length);const l=o==null?void 0:o.editorInput;l&&d.moveEditor(l,c,{index:t,preserveFocus:n})}async $closeTab(e,t){const i=new Map;for(const s of e){const o=this._tabInfoLookup.get(s),a=o==null?void 0:o.tab,c=o==null?void 0:o.group,d=o==null?void 0:o.editorInput;if(!c||!a||!o||!d)continue;const l=i.get(c);l?l.push(d):i.set(c,[d])}const n=[];for(const[s,o]of i)n.push(await s.closeEditors(o,{preserveFocus:t}));return n.every(s=>s)}async $closeGroup(e,t){const i=[];for(const n of e){const s=this._editorGroupsService.getGroup(n);s&&(i.push(await s.closeAllEditors()),s.count===0&&this._editorGroupsService.getGroup(s.id)&&this._editorGroupsService.removeGroup(s))}return i.every(n=>n)}};sV=T([gt(ce.MainThreadEditorTabs),v(1,it),v(2,We),v(3,ze),v(4,Ke)],sV);let oV=class{dispose(){}$onUnexpectedError(e){if(e&&e.$isError){const{name:t,message:i,stack:n}=e;e=e.noTelemetry?new rc:new Error,e.message=i,e.name=t,e.stack=n}en(e)}};oV=T([gt(ce.MainThreadErrors)],oV);let aV=class{constructor(e,t,i,n,s,o,a,c,d){this._extensionService=t,this._notificationService=i,this._extensionsWorkbenchService=n,this._hostService=s,this._extensionEnablementService=o,this._timerService=a,this._commandService=c,this._environmentService=d,this._extensionHostKind=e.extensionHostKind;const l=e;this._internalExtensionService=l.internalExtensionService,l._setExtensionHostProxy(new cve(e.getProxy(fe.ExtHostExtensionService))),l._setAllMainProxyIdentifiers(Object.keys(ce).map(u=>ce[u]))}dispose(){}$getExtension(e){return this._extensionService.getExtension(e)}$activateExtension(e,t){return this._internalExtensionService._activateById(e,t)}async $onWillActivateExtension(e){this._internalExtensionService._onWillActivateExtension(e)}$onDidActivateExtension(e,t,i,n,s){this._internalExtensionService._onDidActivateExtension(e,t,i,n,s)}$onExtensionRuntimeError(e,t){const i=new Error;i.name=t.name,i.message=t.message,i.stack=t.stack,this._internalExtensionService._onExtensionRuntimeError(e,i),console.error(`[${e.value}]${i.message}`),console.error(i.stack)}async $onExtensionActivationError(e,t,i){const n=new Error;if(n.name=t.name,n.message=t.message,n.stack=t.stack,this._internalExtensionService._onDidActivateExtensionError(e,n),i){const o=await this._extensionService.getExtension(e.value);if(o){const c=(await this._extensionsWorkbenchService.queryLocal()).find(d=>g3(d.identifier,{id:i.dependency}));if(c!=null&&c.local){await this._handleMissingInstalledDependency(o,c.local);return}else{await this._handleMissingNotInstalledDependency(o,i.dependency);return}}}if(!this._environmentService.isBuilt||this._environmentService.isExtensionDevelopment){this._notificationService.error(n);return}console.error(n.message)}async _handleMissingInstalledDependency(e,t){const i=e.displayName||e.name;if(this._extensionEnablementService.isEnabled(t))this._notificationService.notify({severity:yi.Error,message:p("reload window","Cannot activate the '{0}' extension because it depends on the '{1}' extension, which is not loaded. Would you like to reload the window to load the extension?",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Zn("reload",p("reload","Reload Window"),"",!0,()=>this._hostService.reload())]}});else{const n=this._extensionEnablementService.getEnablementState(t);n===4?this._notificationService.notify({severity:yi.Error,message:p("notSupportedInWorkspace","Cannot activate the '{0}' extension because it depends on the '{1}' extension which is not supported in the current workspace",i,t.manifest.displayName||t.manifest.name)}):n===0?this._notificationService.notify({severity:yi.Error,message:p("restrictedMode","Cannot activate the '{0}' extension because it depends on the '{1}' extension which is not supported in Restricted Mode",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Zn("manageWorkspaceTrust",p("manageWorkspaceTrust","Manage Workspace Trust"),"",!0,()=>this._commandService.executeCommand("workbench.trust.manage"))]}}):this._extensionEnablementService.canChangeEnablement(t)?this._notificationService.notify({severity:yi.Error,message:p("disabledDep","Cannot activate the '{0}' extension because it depends on the '{1}' extension which is disabled. Would you like to enable the extension and reload the window?",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Zn("enable",p("enable dep","Enable and Reload"),"",!0,()=>this._extensionEnablementService.setEnablement([t],n===6?8:9).then(()=>this._hostService.reload(),s=>this._notificationService.error(s)))]}}):this._notificationService.notify({severity:yi.Error,message:p("disabledDepNoAction","Cannot activate the '{0}' extension because it depends on the '{1}' extension which is disabled.",i,t.manifest.displayName||t.manifest.name)})}}async _handleMissingNotInstalledDependency(e,t){const i=e.displayName||e.name;let n=null;try{n=(await this._extensionsWorkbenchService.getExtensions([{id:t}],_t.None))[0]}catch{}n?this._notificationService.notify({severity:yi.Error,message:p("uninstalledDep","Cannot activate the '{0}' extension because it depends on the '{1}' extension, which is not installed. Would you like to install the extension and reload the window?",i,n.displayName),actions:{primary:[new Zn("install",p("install missing dep","Install and Reload"),"",!0,()=>this._extensionsWorkbenchService.install(n).then(()=>this._hostService.reload(),s=>this._notificationService.error(s)))]}}):this._notificationService.error(p("unknownDep","Cannot activate the '{0}' extension because it depends on an unknown '{1}' extension.",i,t))}async $setPerformanceMarks(e){this._extensionHostKind===1?this._timerService.setPerformanceMarks("localExtHost",e):this._extensionHostKind===2?this._timerService.setPerformanceMarks("workerExtHost",e):this._timerService.setPerformanceMarks("remoteExtHost",e)}async $asBrowserUri(e){return wh.uriToBrowserUri(k.revive(e))}async $getAllStaticBrowserUris(){return Array.from(wh.getRegisteredBrowserUris(),e=>[e,wh.uriToBrowserUri(e)])}};aV=T([gt(ce.MainThreadExtensionService),v(1,yr),v(2,on),v(3,M3),v(4,bu),v(5,ev),v(6,A3),v(7,un),v(8,Ar)],aV);class cve{constructor(e){this._actual=e}async resolveAuthority(e,t){return dve(await this._actual.$resolveAuthority(e,t))}async getCanonicalURI(e,t){const i=await this._actual.$getCanonicalURI(e,t);return i&&k.revive(i)}startExtensionHost(e){return this._actual.$startExtensionHost(e)}extensionTestsExecute(){return this._actual.$extensionTestsExecute()}activateByEvent(e,t){return this._actual.$activateByEvent(e,t)}activate(e,t){return this._actual.$activate(e,t)}setRemoteEnvironment(e){return this._actual.$setRemoteEnvironment(e)}updateRemoteConnectionData(e){return this._actual.$updateRemoteConnectionData(e)}deltaExtensions(e){return this._actual.$deltaExtensions(e)}test_latency(e){return this._actual.$test_latency(e)}test_up(e){return this._actual.$test_up(e)}test_down(e){return this._actual.$test_down(e)}}function dve(r){return r.type==="ok"?{type:"ok",value:{...r.value,authority:lve(r.value.authority)}}:r}function lve(r){return{...r,connectTo:uve(r.connectTo)}}function uve(r){return r.type===0?new rz(r.host,r.port):new nz(r.id)}const hve=Rf(at);class iW extends ne{constructor(e,t,i,n){super(),this.onFileChanges=e,this.onLogMessage=t,this.verboseLogging=i,this.options=n,this.watcherDisposables=this._register(new Hr),this.requests=void 0,this.restartCounter=0}init(){const e=new me;this.watcherDisposables.value=e,this.watcher=this.createWatcher(e),this.watcher.setVerboseLogging(this.verboseLogging),e.add(this.watcher.onDidChangeFile(t=>this.onFileChanges(t))),e.add(this.watcher.onDidLogMessage(t=>this.onLogMessage(t))),e.add(this.watcher.onDidError(t=>this.onError(t)))}onError(e){this.options.restartOnError?this.restartCounter<iW.MAX_RESTARTS&&this.requests?(this.error(`restarting watcher after error: ${e}`),this.restart(this.requests)):this.error(`gave up attempting to restart watcher after error: ${e}`):this.error(e)}restart(e){this.restartCounter++,this.init(),this.watch(e)}async watch(e){var t;this.requests=e,await((t=this.watcher)==null?void 0:t.watch(e))}async setVerboseLogging(e){var t;this.verboseLogging=e,await((t=this.watcher)==null?void 0:t.setVerboseLogging(e))}error(e){this.onLogMessage({type:"error",message:`[File Watcher (${this.options.type})] ${e}`})}trace(e){this.onLogMessage({type:"trace",message:`[File Watcher (${this.options.type})] ${e}`})}dispose(){return this.watcher=void 0,super.dispose()}}iW.MAX_RESTARTS=5;function fve(r,e){return typeof e=="string"&&!e.startsWith(e1)&&!Eg(e)?{base:r,pattern:e}:e}var Mo;let cV=Mo=class{constructor(e,t,i,n,s){this._fileService=t,this._contextService=i,this._logService=n,this._configurationService=s,this._fileProvider=new mr,this._disposables=new me,this._watches=new mr,this._proxy=e.getProxy(fe.ExtHostFileSystem);const o=e.getProxy(fe.ExtHostFileSystemInfo);for(const a of t.listCapabilities())o.$acceptProviderInfos(k.from({scheme:a.scheme,path:"/dummy"}),a.capabilities);this._disposables.add(t.onDidChangeFileSystemProviderRegistrations(a=>{var c;return o.$acceptProviderInfos(k.from({scheme:a.scheme,path:"/dummy"}),((c=a.provider)==null?void 0:c.capabilities)??null)})),this._disposables.add(t.onDidChangeFileSystemProviderCapabilities(a=>o.$acceptProviderInfos(k.from({scheme:a.scheme,path:"/dummy"}),a.provider.capabilities)))}dispose(){this._disposables.dispose(),this._fileProvider.dispose(),this._watches.dispose()}async $registerFileSystemProvider(e,t,i,n){this._fileProvider.set(e,new nW(this._fileService,t,i,n,e,this._proxy))}$unregisterProvider(e){this._fileProvider.deleteAndDispose(e)}$onFileSystemChange(e,t){const i=this._fileProvider.get(e);if(!i)throw new Error("Unknown file provider");i.$onFileSystemChange(t)}$stat(e){return this._fileService.stat(k.revive(e)).then(t=>({ctime:t.ctime,mtime:t.mtime,size:t.size,permissions:t.readonly?ad.Readonly:void 0,type:Mo._asFileType(t)})).catch(Mo._handleError)}$readdir(e){return this._fileService.resolve(k.revive(e),{resolveMetadata:!1}).then(t=>{if(!t.isDirectory){const i=new Error(t.name);throw i.name=lt.FileNotADirectory,i}return t.children?t.children.map(i=>[i.name,Mo._asFileType(i)]):[]}).catch(Mo._handleError)}static _asFileType(e){let t=0;return e.isFile?t+=Or.File:e.isDirectory&&(t+=Or.Directory),e.isSymbolicLink&&(t+=Or.SymbolicLink),t}$readFile(e){return this._fileService.readFile(k.revive(e)).then(t=>t.value).catch(Mo._handleError)}$writeFile(e,t){return this._fileService.writeFile(k.revive(e),t).then(()=>{}).catch(Mo._handleError)}$rename(e,t,i){return this._fileService.move(k.revive(e),k.revive(t),i.overwrite).then(()=>{}).catch(Mo._handleError)}$copy(e,t,i){return this._fileService.copy(k.revive(e),k.revive(t),i.overwrite).then(()=>{}).catch(Mo._handleError)}$mkdir(e){return this._fileService.createFolder(k.revive(e)).then(()=>{}).catch(Mo._handleError)}$delete(e,t){return this._fileService.del(k.revive(e),t).catch(Mo._handleError)}static _handleError(e){if(e instanceof Fs)switch(e.fileOperationResult){case 1:e.name=lt.FileNotFound;break;case 0:e.name=lt.FileIsADirectory;break;case 6:e.name=lt.NoPermissions;break;case 4:e.name=lt.FileExists;break}else if(e instanceof Error){const t=bh(e);t!==lt.Unknown&&(e.name=t)}throw e}$ensureActivation(e){return this._fileService.activateProvider(e)}async $watch(e,t,i,n){var d,l;const s=k.revive(i),o=this._contextService.getWorkspaceFolder(s),a={...n};if(a.recursive)try{(await this._fileService.stat(s)).isDirectory||(a.recursive=!1)}catch(u){this._logService.error(`MainThreadFileSystem#$watch(): failed to stat a resource for file watching (extension: ${e}, path: ${s.toString(!0)}, recursive: ${a.recursive}, session: ${t}): ${u}`)}if(o&&a.recursive){this._logService.trace(`MainThreadFileSystem#$watch(): ignoring request to start watching because path is inside workspace (extension: ${e}, path: ${s.toString(!0)}, recursive: ${a.recursive}, session: ${t})`);return}if(this._logService.trace(`MainThreadFileSystem#$watch(): request to start watching (extension: ${e}, path: ${s.toString(!0)}, recursive: ${a.recursive}, session: ${t})`),a.recursive){const u=this._configurationService.getValue();if((d=u.files)!=null&&d.watcherExclude)for(const h in u.files.watcherExclude)u.files.watcherExclude[h]===!0&&a.excludes.push(h)}else if(o){const u=this._configurationService.getValue();if((l=u.files)!=null&&l.watcherExclude){for(const h in u.files.watcherExclude)if(u.files.watcherExclude[h]===!0){a.includes||(a.includes=[]);const g=`${tf(h,"/")}/${e1}`;a.includes.push(fve(o.uri.fsPath,g))}}if(!a.includes||a.includes.length===0){this._logService.trace(`MainThreadFileSystem#$watch(): ignoring request to start watching because path is inside workspace and no excludes are configured (extension: ${e}, path: ${s.toString(!0)}, recursive: ${a.recursive}, session: ${t})`);return}}const c=this._fileService.watch(s,a);this._watches.set(t,c)}$unwatch(e){this._watches.has(e)&&(this._logService.trace(`MainThreadFileSystem#$unwatch(): request to stop watching (session: ${e})`),this._watches.deleteAndDispose(e))}};cV=Mo=T([gt(ce.MainThreadFileSystem),v(1,hve),v(2,oi),v(3,ze),v(4,We)],cV);class nW{constructor(e,t,i,n,s,o){this.readOnlyMessage=n,this._handle=s,this._proxy=o,this._onDidChange=new A,this.onDidChangeFile=this._onDidChange.event,this.onDidChangeCapabilities=F.None,this.capabilities=i,this._registration=e.registerProvider(t,this)}dispose(){this._registration.dispose(),this._onDidChange.dispose()}watch(e,t){const i=Math.random();return this._proxy.$watch(this._handle,i,e,t),ot(()=>{this._proxy.$unwatch(this._handle,i)})}$onFileSystemChange(e){this._onDidChange.fire(e.map(nW._createFileChange))}static _createFileChange(e){return{resource:k.revive(e.resource),type:e.type}}stat(e){return this._proxy.$stat(this._handle,e).then(void 0,t=>{throw t})}readFile(e){return this._proxy.$readFile(this._handle,e).then(t=>t.buffer)}writeFile(e,t,i){return this._proxy.$writeFile(this._handle,e,De.wrap(t),i)}delete(e,t){return this._proxy.$delete(this._handle,e,t)}mkdir(e){return this._proxy.$mkdir(this._handle,e)}readdir(e){return this._proxy.$readdir(this._handle,e)}rename(e,t,i){return this._proxy.$rename(this._handle,e,t,i)}copy(e,t,i){return this._proxy.$copy(this._handle,e,t,i)}open(e,t){return this._proxy.$open(this._handle,e,t)}close(e){return this._proxy.$close(this._handle,e)}read(e,t,i,n,s){return this._proxy.$read(this._handle,e,t,s).then(o=>(i.set(o.buffer,n),o.byteLength))}write(e,t,i,n,s){return this._proxy.$write(this._handle,e,t,De.wrap(i).slice(n,n+s))}}var sC;let oD=sC=class{constructor(e,t,i,n,s,o,a,c,d,l){this._listener=new me;const u=e.getProxy(fe.ExtHostFileSystemEventService);this._listener.add(t.onDidFilesChange(g=>{u.$onFileEvent({created:g.rawAdded,changed:g.rawUpdated,deleted:g.rawDeleted})}));const h=new class{async participate(g,m,y,_,b){if(y!=null&&y.isUndoing)return;const E=new Xt(b),D=setTimeout(()=>E.cancel(),_),R=await s.withProgress({location:15,title:this._progressLabel(m),cancellable:!0,delay:Math.min(_/2,3e3)},()=>{const L=u.$onWillRunFileOperation(m,g,_,E.token);return BN(L,E.token)},()=>{E.cancel()}).finally(()=>{E.dispose(),clearTimeout(D)});if(!R||R.edit.edits.length===0)return;const M=R.edit.edits.some(L=>{var W;return(W=L.metadata)==null?void 0:W.needsConfirmation});let O=a.getBoolean(sC.MementoKeyAdditionalEdits,0);if(d.extensionTestsLocationURI&&(O=!1),O===void 0){let L;if(R.extensionNames.length===1?m===0?L=p("ask.1.create","Extension '{0}' wants to make refactoring changes with this file creation",R.extensionNames[0]):m===3?L=p("ask.1.copy","Extension '{0}' wants to make refactoring changes with this file copy",R.extensionNames[0]):m===2?L=p("ask.1.move","Extension '{0}' wants to make refactoring changes with this file move",R.extensionNames[0]):L=p("ask.1.delete","Extension '{0}' wants to make refactoring changes with this file deletion",R.extensionNames[0]):m===0?L=p({key:"ask.N.create",comment:['{0} is a number, e.g "3 extensions want..."']},"{0} extensions want to make refactoring changes with this file creation",R.extensionNames.length):m===3?L=p({key:"ask.N.copy",comment:['{0} is a number, e.g "3 extensions want..."']},"{0} extensions want to make refactoring changes with this file copy",R.extensionNames.length):m===2?L=p({key:"ask.N.move",comment:['{0} is a number, e.g "3 extensions want..."']},"{0} extensions want to make refactoring changes with this file move",R.extensionNames.length):L=p({key:"ask.N.delete",comment:['{0} is a number, e.g "3 extensions want..."']},"{0} extensions want to make refactoring changes with this file deletion",R.extensionNames.length),M){const{confirmed:W}=await o.confirm({type:yi.Info,message:L,primaryButton:p("preview","Show &&Preview"),cancelButton:p("cancel","Skip Changes")});if(O=!0,!W)return}else{let W;(function(H){H[H.OK=0]="OK",H[H.Preview=1]="Preview",H[H.Cancel=2]="Cancel"})(W||(W={}));const{result:Z,checkboxChecked:K}=await o.prompt({type:yi.Info,message:L,buttons:[{label:p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),run:()=>W.OK},{label:p({key:"preview",comment:["&& denotes a mnemonic"]},"Show &&Preview"),run:()=>W.Preview}],cancelButton:{label:p("cancel","Skip Changes"),run:()=>W.Cancel},checkbox:{label:p("again","Don't ask again")}});if(Z===W.Cancel)return;O=Z===W.Preview,K&&a.store(sC.MementoKeyAdditionalEdits,O,0,0)}}c.info("[onWill-handler] applying additional workspace edit from extensions",R.extensionNames),await n.apply(Ql(R.edit,l),{undoRedoGroupId:y==null?void 0:y.undoRedoGroupId,showPreview:O})}_progressLabel(g){switch(g){case 0:return p("msg-create","Running 'File Create' participants...");case 2:return p("msg-rename","Running 'File Rename' participants...");case 3:return p("msg-copy","Running 'File Copy' participants...");case 1:return p("msg-delete","Running 'File Delete' participants...");case 4:return p("msg-write","Running 'File Write' participants...")}}};this._listener.add(i.addFileOperationParticipant(h)),this._listener.add(i.onDidRunWorkingCopyFileOperation(g=>u.$onDidRunFileOperation(g.operation,g.files)))}dispose(){this._listener.dispose()}};oD.MementoKeyAdditionalEdits="file.particpants.additionalEdits";oD=sC=T([Eu,v(1,at),v(2,$a),v(3,dG),v(4,kc),v(5,ar),v(6,ri),v(7,ze),v(8,ls),v(9,Hi)],oD);Nt(class extends Le{constructor(){super({id:"files.participants.resetChoice",title:{value:p("label","Reset choice for 'File operation needs preview'"),original:"Reset choice for 'File operation needs preview'"},f1:!0})}run(e){e.get(ri).remove(oD.MementoKeyAdditionalEdits,0)}});let dV=class{constructor(e,t){this._credentialsService=t}async $getPassword(e,t){return this._credentialsService.getPassword(e,t)}async $setPassword(e,t,i){return this._credentialsService.setPassword(e,t,i)}async $deletePassword(e,t){return this._credentialsService.deletePassword(e,t)}async $findPassword(e){return this._credentialsService.findPassword(e)}async $findCredentials(e){return this._credentialsService.findCredentials(e)}dispose(){}};dV=T([gt(ce.MainThreadKeytar),v(1,T$)],dV);class rW{constructor(){this.requestIdPool=0,this.dataTransferFiles=new Map}add(e){const t=this.requestIdPool++;return this.dataTransferFiles.set(t,fi(Array.from(e,([,i])=>i.asFile()))),{id:t,dispose:()=>{this.dataTransferFiles.delete(t)}}}async resolveFileData(e,t){const i=this.dataTransferFiles.get(e);if(!i)throw new Error("No data transfer found");const n=i.find(s=>s.id===t);if(!n)throw new Error("No matching file found in data transfer");return De.wrap(await n.data())}dispose(){this.dataTransferFiles.clear()}}const F8=new YN;class aD{static async create(e,t,i){const[n]=F8.ordered(e);if(!n)return;const s=await n.prepareCallHierarchy(e,t,i);if(s)return new aD(s.roots.reduce((o,a)=>o+a._sessionId,""),n,s.roots,new gG(s))}constructor(e,t,i,n){this.id=e,this.provider=t,this.roots=i,this.ref=n,this.root=i[0]}dispose(){this.ref.release()}fork(e){const t=this;return new class extends aD{constructor(){super(t.id,t.provider,[e],t.ref.acquire())}}}async resolveIncomingCalls(e,t){try{const i=await this.provider.provideIncomingCalls(e,t);if(Pr(i))return i}catch(i){Fn(i)}return[]}async resolveOutgoingCalls(e,t){try{const i=await this.provider.provideOutgoingCalls(e,t);if(Pr(i))return i}catch(i){Fn(i)}return[]}}const Ry=new Map;Gt.registerCommand("_executePrepareCallHierarchy",async(r,...e)=>{const[t,i]=e;yo(k.isUri(t)),yo(Us.isIPosition(i));let s=r.get(_i).getModel(t),o;if(!s){const c=await r.get(or).createModelReference(t);s=c.object.textEditorModel,o=c}try{const a=await aD.create(s,i,_t.None);return a?(Ry.set(a.id,a),Ry.forEach((c,d,l)=>{l.size>10&&(c.dispose(),Ry.delete(d))}),[a.root]):[]}finally{o==null||o.dispose()}});function O8(r){return!0}Gt.registerCommand("_executeProvideIncomingCalls",async(r,...e)=>{const[t]=e;yo(O8());const i=Ry.get(t._sessionId);if(i)return i.resolveIncomingCalls(t,_t.None)});Gt.registerCommand("_executeProvideOutgoingCalls",async(r,...e)=>{const[t]=e;yo(O8());const i=Ry.get(t._sessionId);if(i)return i.resolveOutgoingCalls(t,_t.None)});var cD;(function(r){const e=[];function t(n){let s=n;return s&&e.push(s),{dispose(){if(s){const o=e.indexOf(s);o>=0&&(e.splice(o,1),s=void 0)}}}}r.register=t;function i(){return e.slice(0)}r.all=i})(cD||(cD={}));class pve{constructor(e,t){this.symbol=e,this.provider=t}}async function wNe(r,e=_t.None){const t=[],i=cD.all().map(async s=>{try{const o=await s.provideWorkspaceSymbols(r,e);if(!o)return;for(const a of o)t.push(new pve(a,s))}catch(o){Fn(o)}});if(await Promise.all(i),e.isCancellationRequested)return[];function n(s,o){let a=Sa(s.symbol.name,o.symbol.name);return a===0&&(a=s.symbol.kind-o.symbol.kind),a===0&&(a=Sa(s.symbol.location.uri.toString(),o.symbol.location.uri.toString())),a===0&&(s.symbol.location.range&&o.symbol.location.range?qe.areIntersecting(s.symbol.location.range,o.symbol.location.range)||(a=qe.compareRangesUsingStarts(s.symbol.location.range,o.symbol.location.range)):s.provider.resolveWorkspaceSymbol&&!o.provider.resolveWorkspaceSymbol?a=-1:!s.provider.resolveWorkspaceSymbol&&o.provider.resolveWorkspaceSymbol&&(a=1)),a===0&&(a=Sa(s.symbol.containerName??"",o.symbol.containerName??"")),a}return yk(t,n).map(s=>s[0]).flat()}function bNe(r){const e=r.get(Ke),t=r.get(oi),i=r.get(at);return e.editors.map(s=>Vn.getOriginalUri(s,{supportSideBySide:Ui.PRIMARY})).filter(s=>!!s&&!t.isInsideWorkspace(s)&&i.hasProvider(s))}const lV=/\s?[#:\(](?:line )?(\d*)(?:[#:,](\d*))?\)?\s*$/;function SNe(r,e){if(!r||e!=null&&e.some(n=>{const s=r.indexOf(n);return s===0||s>0&&!lV.test(r.substring(s+1))}))return;let t;const i=lV.exec(r);if(i){const n=parseInt(i[1]??"",10);if(pr(n)){t={startLineNumber:n,startColumn:1,endLineNumber:n,endColumn:1};const s=parseInt(i[2]??"",10);pr(s)&&(t={startLineNumber:t.startLineNumber,startColumn:s,endLineNumber:t.endLineNumber,endColumn:s})}else i[1]===""&&(t={startLineNumber:1,startColumn:1,endLineNumber:1,endColumn:1})}if(i&&t)return{filter:r.substr(0,i.index),range:t}}var $F;(function(r){r[r.Idle=0]="Idle",r[r.Searching=1]="Searching",r[r.SlowSearch=2]="SlowSearch"})($F||($F={}));const CNe=new G("searchState",$F.Idle),N8=new YN;class dD{static async create(e,t,i){const[n]=N8.ordered(e);if(!n)return;const s=await n.prepareTypeHierarchy(e,t,i);if(s)return new dD(s.roots.reduce((o,a)=>o+a._sessionId,""),n,s.roots,new gG(s))}constructor(e,t,i,n){this.id=e,this.provider=t,this.roots=i,this.ref=n,this.root=i[0]}dispose(){this.ref.release()}fork(e){const t=this;return new class extends dD{constructor(){super(t.id,t.provider,[e],t.ref.acquire())}}}async provideSupertypes(e,t){try{const i=await this.provider.provideSupertypes(e,t);if(Pr(i))return i}catch(i){Fn(i)}return[]}async provideSubtypes(e,t){try{const i=await this.provider.provideSubtypes(e,t);if(Pr(i))return i}catch(i){Fn(i)}return[]}}const Py=new Map;Gt.registerCommand("_executePrepareTypeHierarchy",async(r,...e)=>{const[t,i]=e;yo(k.isUri(t)),yo(Us.isIPosition(i));let s=r.get(_i).getModel(t),o;if(!s){const c=await r.get(or).createModelReference(t);s=c.object.textEditorModel,o=c}try{const a=await dD.create(s,i,_t.None);return a?(Py.set(a.id,a),Py.forEach((c,d,l)=>{l.size>10&&(c.dispose(),Py.delete(d))}),[a.root]):[]}finally{o==null||o.dispose()}});function $8(r){const e=r;return typeof r=="object"&&typeof e.name=="string"&&typeof e.kind=="number"&&k.isUri(e.uri)&&qe.isIRange(e.range)&&qe.isIRange(e.selectionRange)}Gt.registerCommand("_executeProvideSupertypes",async(r,...e)=>{const[t]=e;yo($8(t));const i=Py.get(t._sessionId);if(i)return i.provideSupertypes(t,_t.None)});Gt.registerCommand("_executeProvideSubtypes",async(r,...e)=>{const[t]=e;yo($8(t));const i=Py.get(t._sessionId);if(i)return i.provideSubtypes(t,_t.None)});var li;let uV=li=class extends ne{constructor(e,t,i,n,s){if(super(),this._languageService=t,this._languageConfigurationService=i,this._languageFeaturesService=n,this._uriIdentService=s,this._registrations=this._register(new mr),this._pasteEditProviders=new Map,this._documentOnDropEditProviders=new Map,this._proxy=e.getProxy(fe.ExtHostLanguageFeatures),this._languageService){const o=()=>{const a=[];for(const c of t.getRegisteredLanguageIds()){const d=this._languageConfigurationService.getLanguageConfiguration(c).getWordDefinition();a.push({languageId:c,regexSource:d.source,regexFlags:d.flags})}this._proxy.$setWordDefinitions(a)};this._languageConfigurationService.onDidChange(a=>{if(!a.languageId)o();else{const c=this._languageConfigurationService.getLanguageConfiguration(a.languageId).getWordDefinition();this._proxy.$setWordDefinitions([{languageId:a.languageId,regexSource:c.source,regexFlags:c.flags}])}}),o()}}$unregister(e){this._registrations.deleteAndDispose(e)}static _reviveLocationDto(e){return e&&(Array.isArray(e)?(e.forEach(t=>li._reviveLocationDto(t)),e):(e.uri=k.revive(e.uri),e))}static _reviveLocationLinkDto(e){return e&&(Array.isArray(e)?(e.forEach(t=>li._reviveLocationLinkDto(t)),e):(e.uri=k.revive(e.uri),e))}static _reviveWorkspaceSymbolDto(e){return e&&(Array.isArray(e)?(e.forEach(li._reviveWorkspaceSymbolDto),e):(e.location=li._reviveLocationDto(e.location),e))}static _reviveCodeActionDto(e,t){return e==null||e.forEach(i=>Ql(i.edit,t)),e}static _reviveLinkDTO(e){return e.url&&typeof e.url!="string"&&(e.url=k.revive(e.url)),e}static _reviveCallHierarchyItemDto(e){return e&&(e.uri=k.revive(e.uri)),e}static _reviveTypeHierarchyItemDto(e){return e&&(e.uri=k.revive(e.uri)),e}$registerDocumentSymbolProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.documentSymbolProvider.register(t,{displayName:i,provideDocumentSymbols:(n,s)=>this._proxy.$provideDocumentSymbols(e,n.uri,s)}))}$registerCodeLensSupport(e,t,i){const n={provideCodeLenses:async(s,o)=>{const a=await this._proxy.$provideCodeLenses(e,s.uri,o);if(a)return{lenses:a.lenses,dispose:()=>a.cacheId&&this._proxy.$releaseCodeLenses(e,a.cacheId)}},resolveCodeLens:async(s,o,a)=>{const c=await this._proxy.$resolveCodeLens(e,o,a);if(c)return{...c,range:s.validateRange(c.range)}}};if(typeof i=="number"){const s=new A;this._registrations.set(i,s),n.onDidChange=s.event}this._registrations.set(e,this._languageFeaturesService.codeLensProvider.register(t,n))}$emitCodeLensEvent(e,t){const i=this._registrations.get(e);i instanceof A&&i.fire(t)}$registerDefinitionSupport(e,t){this._registrations.set(e,this._languageFeaturesService.definitionProvider.register(t,{provideDefinition:(i,n,s)=>this._proxy.$provideDefinition(e,i.uri,n,s).then(li._reviveLocationLinkDto)}))}$registerDeclarationSupport(e,t){this._registrations.set(e,this._languageFeaturesService.declarationProvider.register(t,{provideDeclaration:(i,n,s)=>this._proxy.$provideDeclaration(e,i.uri,n,s).then(li._reviveLocationLinkDto)}))}$registerImplementationSupport(e,t){this._registrations.set(e,this._languageFeaturesService.implementationProvider.register(t,{provideImplementation:(i,n,s)=>this._proxy.$provideImplementation(e,i.uri,n,s).then(li._reviveLocationLinkDto)}))}$registerTypeDefinitionSupport(e,t){this._registrations.set(e,this._languageFeaturesService.typeDefinitionProvider.register(t,{provideTypeDefinition:(i,n,s)=>this._proxy.$provideTypeDefinition(e,i.uri,n,s).then(li._reviveLocationLinkDto)}))}$registerHoverProvider(e,t){this._registrations.set(e,this._languageFeaturesService.hoverProvider.register(t,{provideHover:(i,n,s)=>this._proxy.$provideHover(e,i.uri,n,s)}))}$registerEvaluatableExpressionProvider(e,t){this._registrations.set(e,this._languageFeaturesService.evaluatableExpressionProvider.register(t,{provideEvaluatableExpression:(i,n,s)=>this._proxy.$provideEvaluatableExpression(e,i.uri,n,s)}))}$registerInlineValuesProvider(e,t,i){const n={provideInlineValues:(s,o,a,c)=>this._proxy.$provideInlineValues(e,s.uri,o,a,c)};if(typeof i=="number"){const s=new A;this._registrations.set(i,s),n.onDidChangeInlineValues=s.event}this._registrations.set(e,this._languageFeaturesService.inlineValuesProvider.register(t,n))}$emitInlineValuesEvent(e,t){const i=this._registrations.get(e);i instanceof A&&i.fire(t)}$registerDocumentHighlightProvider(e,t){this._registrations.set(e,this._languageFeaturesService.documentHighlightProvider.register(t,{provideDocumentHighlights:(i,n,s)=>this._proxy.$provideDocumentHighlights(e,i.uri,n,s)}))}$registerLinkedEditingRangeProvider(e,t){this._registrations.set(e,this._languageFeaturesService.linkedEditingRangeProvider.register(t,{provideLinkedEditingRanges:async(i,n,s)=>{const o=await this._proxy.$provideLinkedEditingRanges(e,i.uri,n,s);if(o)return{ranges:o.ranges,wordPattern:o.wordPattern?li._reviveRegExp(o.wordPattern):void 0}}}))}$registerReferenceSupport(e,t){this._registrations.set(e,this._languageFeaturesService.referenceProvider.register(t,{provideReferences:(i,n,s,o)=>this._proxy.$provideReferences(e,i.uri,n,s,o).then(li._reviveLocationDto)}))}$registerQuickFixSupport(e,t,i,n,s){const o={provideCodeActions:async(a,c,d,l)=>{const u=await this._proxy.$provideCodeActions(e,a.uri,c,d,l);if(u)return{actions:li._reviveCodeActionDto(u.actions,this._uriIdentService),dispose:()=>{typeof u.cacheId=="number"&&this._proxy.$releaseCodeActions(e,u.cacheId)}}},providedCodeActionKinds:i.providedKinds,documentation:i.documentation,displayName:n};s&&(o.resolveCodeAction=async(a,c)=>{const d=await this._proxy.$resolveCodeAction(e,a.cacheId,c);return d.edit&&(a.edit=Ql(d.edit,this._uriIdentService)),d.command&&(a.command=d.command),a}),this._registrations.set(e,this._languageFeaturesService.codeActionProvider.register(t,o))}$registerPasteEditProvider(e,t,i){const n=new WF(e,this._proxy,i,this._uriIdentService);this._pasteEditProviders.set(e,n),this._registrations.set(e,Da(this._languageFeaturesService.documentPasteEditProvider.register(t,n),ot(()=>this._pasteEditProviders.delete(e))))}$resolvePasteFileData(e,t,i){const n=this._pasteEditProviders.get(e);if(!n)throw new Error("Could not find provider");return n.resolveFileData(t,i)}$registerDocumentFormattingSupport(e,t,i,n){this._registrations.set(e,this._languageFeaturesService.documentFormattingEditProvider.register(t,{extensionId:i,displayName:n,provideDocumentFormattingEdits:(s,o,a)=>this._proxy.$provideDocumentFormattingEdits(e,s.uri,o,a)}))}$registerRangeFormattingSupport(e,t,i,n,s){this._registrations.set(e,this._languageFeaturesService.documentRangeFormattingEditProvider.register(t,{extensionId:i,displayName:n,provideDocumentRangeFormattingEdits:(o,a,c,d)=>this._proxy.$provideDocumentRangeFormattingEdits(e,o.uri,a,c,d),provideDocumentRangesFormattingEdits:s?(o,a,c,d)=>this._proxy.$provideDocumentRangesFormattingEdits(e,o.uri,a,c,d):void 0}))}$registerOnTypeFormattingSupport(e,t,i,n){this._registrations.set(e,this._languageFeaturesService.onTypeFormattingEditProvider.register(t,{extensionId:n,autoFormatTriggerCharacters:i,provideOnTypeFormattingEdits:(s,o,a,c,d)=>this._proxy.$provideOnTypeFormattingEdits(e,s.uri,o,a,c,d)}))}$registerNavigateTypeSupport(e,t){let i;const n={provideWorkspaceSymbols:async(s,o)=>{const a=await this._proxy.$provideWorkspaceSymbols(e,s,o);return i!==void 0&&this._proxy.$releaseWorkspaceSymbols(e,i),i=a.cacheId,li._reviveWorkspaceSymbolDto(a.symbols)}};t&&(n.resolveWorkspaceSymbol=async(s,o)=>{const a=await this._proxy.$resolveWorkspaceSymbol(e,s,o);return a&&li._reviveWorkspaceSymbolDto(a)}),this._registrations.set(e,cD.register(n))}$registerRenameSupport(e,t,i){this._registrations.set(e,this._languageFeaturesService.renameProvider.register(t,{provideRenameEdits:(n,s,o,a)=>this._proxy.$provideRenameEdits(e,n.uri,s,o,a).then(c=>Ql(c,this._uriIdentService)),resolveRenameLocation:i?(n,s,o)=>this._proxy.$resolveRenameLocation(e,n.uri,s,o):void 0}))}$registerDocumentSemanticTokensProvider(e,t,i,n){let s;if(typeof n=="number"){const o=new A;this._registrations.set(n,o),s=o.event}this._registrations.set(e,this._languageFeaturesService.documentSemanticTokensProvider.register(t,new gve(this._proxy,e,i,s)))}$emitDocumentSemanticTokensEvent(e){const t=this._registrations.get(e);t instanceof A&&t.fire(void 0)}$registerDocumentRangeSemanticTokensProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.documentRangeSemanticTokensProvider.register(t,new mve(this._proxy,e,i)))}static _inflateSuggestDto(e,t,i){const n=t.a,s=t.o,o=t.n,a=t.k;return{label:n,extensionId:i,kind:t.b??9,tags:t.m,detail:t.c,documentation:t.d,sortText:t.e,filterText:t.f,preselect:t.g,insertText:t.h??(typeof n=="string"?n:n.label),range:t.j??e,insertTextRules:t.i,commitCharacters:a?Array.from(a):void 0,additionalTextEdits:t.l,command:s?{$ident:o,id:s,title:"",arguments:o?[o]:t.p}:void 0,_id:t.x}}$registerCompletionsProvider(e,t,i,n,s){const o={triggerCharacters:i,_debugDisplayName:`${s.value}(${i.join("")})`,provideCompletionItems:async(a,c,d,l)=>{const u=await this._proxy.$provideCompletionItems(e,a.uri,c,d,l);return u&&{suggestions:u.b.map(h=>li._inflateSuggestDto(u.a,h,s)),incomplete:u.c||!1,duration:u.d,dispose:()=>{typeof u.x=="number"&&this._proxy.$releaseCompletionItems(e,u.x)}}}};n&&(o.resolveCompletionItem=(a,c)=>this._proxy.$resolveCompletionItem(e,a._id,c).then(d=>{if(!d)return a;const l=li._inflateSuggestDto(a.range,d,s);return tu(a,l,!0)})),this._registrations.set(e,this._languageFeaturesService.completionProvider.register(t,o))}$registerInlineCompletionsSupport(e,t,i){const n={provideInlineCompletions:async(s,o,a,c)=>this._proxy.$provideInlineCompletions(e,s.uri,o,a,c),handleItemDidShow:async(s,o,a)=>{i&&await this._proxy.$handleInlineCompletionDidShow(e,s.pid,o.idx,a)},handlePartialAccept:async(s,o,a)=>{i&&await this._proxy.$handleInlineCompletionPartialAccept(e,s.pid,o.idx,a)},freeInlineCompletions:s=>{this._proxy.$freeInlineCompletionsList(e,s.pid)}};this._registrations.set(e,this._languageFeaturesService.inlineCompletionsProvider.register(t,n))}$registerSignatureHelpProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.signatureHelpProvider.register(t,{signatureHelpTriggerCharacters:i.triggerCharacters,signatureHelpRetriggerCharacters:i.retriggerCharacters,provideSignatureHelp:async(n,s,o,a)=>{const c=await this._proxy.$provideSignatureHelp(e,n.uri,s,a,o);if(c)return{value:c,dispose:()=>{this._proxy.$releaseSignatureHelp(e,c.id)}}}}))}$registerInlayHintsProvider(e,t,i,n,s){const o={displayName:s,provideInlayHints:async(a,c,d)=>{const l=await this._proxy.$provideInlayHints(e,a.uri,c,d);if(l)return{hints:Ta(l.hints),dispose:()=>{l.cacheId&&this._proxy.$releaseInlayHints(e,l.cacheId)}}}};if(i&&(o.resolveInlayHint=async(a,c)=>{const d=a;if(!d.cacheId)return a;const l=await this._proxy.$resolveInlayHint(e,d.cacheId,c);if(c.isCancellationRequested)throw new yh;return l?{...a,tooltip:l.tooltip,label:Ta(l.label)}:a}),typeof n=="number"){const a=new A;this._registrations.set(n,a),o.onDidChangeInlayHints=a.event}this._registrations.set(e,this._languageFeaturesService.inlayHintsProvider.register(t,o))}$emitInlayHintsEvent(e){const t=this._registrations.get(e);t instanceof A&&t.fire(void 0)}$registerDocumentLinkProvider(e,t,i){const n={provideLinks:(s,o)=>this._proxy.$provideDocumentLinks(e,s.uri,o).then(a=>{if(a)return{links:a.links.map(li._reviveLinkDTO),dispose:()=>{typeof a.cacheId=="number"&&this._proxy.$releaseDocumentLinks(e,a.cacheId)}}})};i&&(n.resolveLink=(s,o)=>{const a=s;return a.cacheId?this._proxy.$resolveDocumentLink(e,a.cacheId,o).then(c=>c&&li._reviveLinkDTO(c)):s}),this._registrations.set(e,this._languageFeaturesService.linkProvider.register(t,n))}$registerDocumentColorProvider(e,t){const i=this._proxy;this._registrations.set(e,this._languageFeaturesService.colorProvider.register(t,{provideDocumentColors:(n,s)=>i.$provideDocumentColors(e,n.uri,s).then(o=>o.map(a=>{const[c,d,l,u]=a.color;return{color:{red:c,green:d,blue:l,alpha:u},range:a.range}})),provideColorPresentations:(n,s,o)=>i.$provideColorPresentations(e,n.uri,{color:[s.color.red,s.color.green,s.color.blue,s.color.alpha],range:s.range},o)}))}$registerFoldingRangeProvider(e,t,i,n){const s={id:i.value,provideFoldingRanges:(o,a,c)=>this._proxy.$provideFoldingRanges(e,o.uri,a,c)};if(typeof n=="number"){const o=new A;this._registrations.set(n,o),s.onDidChange=o.event}this._registrations.set(e,this._languageFeaturesService.foldingRangeProvider.register(t,s))}$emitFoldingRangeEvent(e,t){const i=this._registrations.get(e);i instanceof A&&i.fire(t)}$registerSelectionRangeProvider(e,t){this._registrations.set(e,this._languageFeaturesService.selectionRangeProvider.register(t,{provideSelectionRanges:(i,n,s)=>this._proxy.$provideSelectionRanges(e,i.uri,n,s)}))}$registerCallHierarchyProvider(e,t){this._registrations.set(e,F8.register(t,{prepareCallHierarchy:async(i,n,s)=>{const o=await this._proxy.$prepareCallHierarchy(e,i.uri,n,s);if(!(!o||o.length===0))return{dispose:()=>{for(const a of o)this._proxy.$releaseCallHierarchy(e,a._sessionId)},roots:o.map(li._reviveCallHierarchyItemDto)}},provideOutgoingCalls:async(i,n)=>{const s=await this._proxy.$provideCallHierarchyOutgoingCalls(e,i._sessionId,i._itemId,n);return s&&(s.forEach(o=>{o.to=li._reviveCallHierarchyItemDto(o.to)}),s)},provideIncomingCalls:async(i,n)=>{const s=await this._proxy.$provideCallHierarchyIncomingCalls(e,i._sessionId,i._itemId,n);return s&&(s.forEach(o=>{o.from=li._reviveCallHierarchyItemDto(o.from)}),s)}}))}static _reviveRegExp(e){return new RegExp(e.pattern,e.flags)}static _reviveIndentationRule(e){return{decreaseIndentPattern:li._reviveRegExp(e.decreaseIndentPattern),increaseIndentPattern:li._reviveRegExp(e.increaseIndentPattern),indentNextLinePattern:e.indentNextLinePattern?li._reviveRegExp(e.indentNextLinePattern):void 0,unIndentedLinePattern:e.unIndentedLinePattern?li._reviveRegExp(e.unIndentedLinePattern):void 0}}static _reviveOnEnterRule(e){return{beforeText:li._reviveRegExp(e.beforeText),afterText:e.afterText?li._reviveRegExp(e.afterText):void 0,previousLineText:e.previousLineText?li._reviveRegExp(e.previousLineText):void 0,action:e.action}}static _reviveOnEnterRules(e){return e.map(li._reviveOnEnterRule)}$setLanguageConfiguration(e,t,i){const n={comments:i.comments,brackets:i.brackets,wordPattern:i.wordPattern?li._reviveRegExp(i.wordPattern):void 0,indentationRules:i.indentationRules?li._reviveIndentationRule(i.indentationRules):void 0,onEnterRules:i.onEnterRules?li._reviveOnEnterRules(i.onEnterRules):void 0,autoClosingPairs:void 0,surroundingPairs:void 0,__electricCharacterSupport:void 0};i.__characterPairSupport&&(n.autoClosingPairs=i.__characterPairSupport.autoClosingPairs),i.__electricCharacterSupport&&i.__electricCharacterSupport.docComment&&(n.__electricCharacterSupport={docComment:{open:i.__electricCharacterSupport.docComment.open,close:i.__electricCharacterSupport.docComment.close}}),this._languageService.isRegisteredLanguageId(t)&&this._registrations.set(e,this._languageConfigurationService.register(t,n,100))}$registerTypeHierarchyProvider(e,t){this._registrations.set(e,N8.register(t,{prepareTypeHierarchy:async(i,n,s)=>{const o=await this._proxy.$prepareTypeHierarchy(e,i.uri,n,s);if(o)return{dispose:()=>{for(const a of o)this._proxy.$releaseTypeHierarchy(e,a._sessionId)},roots:o.map(li._reviveTypeHierarchyItemDto)}},provideSupertypes:async(i,n)=>{const s=await this._proxy.$provideTypeHierarchySupertypes(e,i._sessionId,i._itemId,n);return s&&s.map(li._reviveTypeHierarchyItemDto)},provideSubtypes:async(i,n)=>{const s=await this._proxy.$provideTypeHierarchySubtypes(e,i._sessionId,i._itemId,n);return s&&s.map(li._reviveTypeHierarchyItemDto)}}))}$registerDocumentOnDropEditProvider(e,t,i){const n=new HF(e,i,this._proxy,this._uriIdentService);this._documentOnDropEditProviders.set(e,n),this._registrations.set(e,Da(this._languageFeaturesService.documentOnDropEditProvider.register(t,n),ot(()=>this._documentOnDropEditProviders.delete(e))))}async $resolveDocumentOnDropFileData(e,t,i){const n=this._documentOnDropEditProviders.get(e);if(!n)throw new Error("Could not find provider");return n.resolveDocumentOnDropFileData(t,i)}};uV=li=T([gt(ce.MainThreadLanguageFeatures),v(1,ji),v(2,Bm),v(3,Lf),v(4,Hi)],uV);let WF=class{constructor(e,t,i,n){this.handle=e,this._proxy=t,this._uriIdentService=n,this.dataTransfers=new rW,this.copyMimeTypes=i.copyMimeTypes,this.pasteMimeTypes=i.pasteMimeTypes,i.supportsCopy&&(this.prepareDocumentPaste=async(s,o,a,c)=>{const d=await Qo.from(a);if(c.isCancellationRequested)return;const l=await this._proxy.$prepareDocumentPaste(e,s.uri,o,d,c);if(!l)return;const u=new vG;for(const[h,g]of l.items)u.replace(h,mG(g.asString));return u}),i.supportsPaste&&(this.provideDocumentPasteEdits=async(s,o,a,c)=>{const d=this.dataTransfers.add(a);try{const l=await Qo.from(a);if(c.isCancellationRequested)return;const u=await this._proxy.$providePasteEdits(this.handle,d.id,s.uri,o,l,c);return u?{...u,additionalEdit:u.additionalEdit?Ql(u.additionalEdit,this._uriIdentService,h=>this.resolveFileData(d.id,h)):void 0}:void 0}finally{d.dispose()}})}resolveFileData(e,t){return this.dataTransfers.resolveFileData(e,t)}};WF=T([v(3,Hi)],WF);let HF=class{constructor(e,t,i,n){this.handle=e,this._proxy=i,this._uriIdentService=n,this.dataTransfers=new rW,this.dropMimeTypes=(t==null?void 0:t.dropMimeTypes)??["*/*"]}async provideDocumentOnDropEdits(e,t,i,n){const s=this.dataTransfers.add(i);try{const o=await Qo.from(i);if(n.isCancellationRequested)return;const a=await this._proxy.$provideDocumentOnDropEdits(this.handle,s.id,e.uri,t,o,n);return a?{...a,additionalEdit:Ql(a.additionalEdit,this._uriIdentService,c=>this.resolveDocumentOnDropFileData(s.id,c))}:void 0}finally{s.dispose()}}resolveDocumentOnDropFileData(e,t){return this.dataTransfers.resolveFileData(e,t)}};HF=T([v(3,Hi)],HF);class gve{constructor(e,t,i,n){this._proxy=e,this._handle=t,this._legend=i,this.onDidChange=n}releaseDocumentSemanticTokens(e){e&&this._proxy.$releaseDocumentSemanticTokens(this._handle,parseInt(e,10))}getLegend(){return this._legend}async provideDocumentSemanticTokens(e,t,i){const n=t?parseInt(t,10):0,s=await this._proxy.$provideDocumentSemanticTokens(this._handle,e.uri,n,i);if(!s||i.isCancellationRequested)return null;const o=CC(s);return o.type==="full"?{resultId:String(o.id),data:o.data}:{resultId:String(o.id),edits:o.deltas}}}class mve{constructor(e,t,i){this._proxy=e,this._handle=t,this._legend=i}getLegend(){return this._legend}async provideDocumentRangeSemanticTokens(e,t,i){const n=await this._proxy.$provideDocumentRangeSemanticTokens(this._handle,e.uri,t,i);if(!n||i.isCancellationRequested)return null;const s=CC(n);if(s.type==="full")return{resultId:String(s.id),data:s.data};throw new Error("Unexpected")}}let hV=class{constructor(e,t,i,n,s){this._languageService=t,this._modelService=i,this._resolverService=n,this._languageStatusService=s,this._disposables=new me,this._status=new mr,this._proxy=e.getProxy(fe.ExtHostLanguages),this._proxy.$acceptLanguageIds(t.getRegisteredLanguageIds()),this._disposables.add(t.onDidChange(o=>{this._proxy.$acceptLanguageIds(t.getRegisteredLanguageIds())}))}dispose(){this._disposables.dispose(),this._status.dispose()}async $changeLanguage(e,t){if(!this._languageService.isRegisteredLanguageId(t))return Promise.reject(new Error(`Unknown language id: ${t}`));const i=k.revive(e),n=await this._resolverService.createModelReference(i);try{n.object.textEditorModel.setLanguage(this._languageService.createById(t))}finally{n.dispose()}}async $tokensAtPosition(e,t){const i=k.revive(e),n=this._modelService.getModel(i);if(!n)return;n.tokenization.tokenizeIfCheap(t.lineNumber);const s=n.tokenization.getLineTokens(t.lineNumber),o=s.findTokenIndexAtOffset(t.column-1);return{type:s.getStandardTokenType(o),range:new qe(t.lineNumber,1+s.getStartOffset(o),t.lineNumber,1+s.getEndOffset(o))}}$setLanguageStatus(e,t){var i;(i=this._status.get(e))==null||i.dispose(),this._status.set(e,this._languageStatusService.addStatus(t))}$removeLanguageStatus(e){var t;(t=this._status.get(e))==null||t.dispose()}};hV=T([gt(ce.MainThreadLanguages),v(1,ji),v(2,_i),v(3,or),v(4,p3)],hV);let fV=class{constructor(e,t){this.loggerService=t,this.disposables=new me;const i=e.getProxy(fe.ExtHostLogLevelServiceShape);this.disposables.add(t.onDidChangeLogLevel(n=>{Bq(n)?i.$setLogLevel(n):i.$setLogLevel(n[1],n[0])}))}$log(e,t){const i=this.loggerService.getLogger(k.revive(e));if(!i)throw new Error("Create the logger before logging");for(const[n,s]of t)EC(i,n,s)}async $createLogger(e,t){this.loggerService.createLogger(k.revive(e),t)}async $registerLogger(e){this.loggerService.registerLogger({...e,resource:k.revive(e.resource)})}async $deregisterLogger(e){this.loggerService.deregisterLogger(k.revive(e))}async $setVisibility(e,t){this.loggerService.setVisibility(k.revive(e),t)}$flush(e){const t=this.loggerService.getLogger(k.revive(e));if(!t)throw new Error("Create the logger before flushing");t.flush()}dispose(){this.disposables.dispose()}};fV=T([gt(ce.MainThreadLogger),v(1,Is)],fV);Gt.registerCommand("_extensionTests.setLogLevel",function(r,e){const t=r.get(Is),i=r.get(ls);if(i.isExtensionDevelopment&&i.extensionTestsLocationURI){const n=Gq(e);n!==void 0&&t.setLogLevel(n)}});Gt.registerCommand("_extensionTests.getLogLevel",function(r){const e=r.get(ze);return gC(e.getLevel())});let pV=class{constructor(e,t,i,n){this._notificationService=t,this._commandService=i,this._dialogService=n}dispose(){}$showMessage(e,t,i,n){return i.modal?this._showModalMessage(e,t,i.detail,n,i.useCustom):this._showMessage(e,t,n,i)}_showMessage(e,t,i,n){return new Promise(s=>{const o=i.map(l=>pC({id:`_extension_message_handle_${l.handle}`,label:l.title,enabled:!0,run:()=>(s(l.handle),Promise.resolve())}));let a;n.source&&(a={label:p("extensionSource","{0} (Extension)",n.source.label),id:n.source.identifier.value}),a||(a=p("defaultSource","Extension"));const c=[];n.source&&c.push(pC({id:n.source.identifier.value,label:p("manageExtension","Manage Extension"),run:()=>this._commandService.executeCommand("_extensions.manage",n.source.identifier.value)}));const d=this._notificationService.notify({severity:e,message:t,actions:{primary:o,secondary:c},source:a});F.once(d.onDidClose)(()=>{s(void 0)})})}async _showModalMessage(e,t,i,n,s){const o=[];let a;for(const d of n){const l={label:d.title,run:()=>d.handle};d.isCloseAffordance?a=l:o.push(l)}a||(o.length>0?a={label:p("cancel","Cancel"),run:()=>{}}:a={label:p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),run:()=>{}});const{result:c}=await this._dialogService.prompt({type:e,message:t,detail:i,buttons:o,cancelButton:a,custom:s});return c}};pV=T([gt(ce.MainThreadMessageService),v(1,on),v(2,un),v(3,ar)],pV);const vve=(r,e,t)=>{const i=new Uint8Array(16);for(let o=0;o<16;o++)i[o]=Math.round(Math.random()*256);const n=NN(De.wrap(i));return[`GET ws://localhost${r}?${e}&skipWebSocketFrames=true HTTP/1.1`,"Connection: Upgrade","Upgrade: websocket",`Sec-WebSocket-Key: ${n}`].join(`\r
`)+`\r
\r
`},gV=De.fromString(`\r
\r
`);let mV=class extends ne{constructor(e,t){super(),this._remoteSocketFactoryService=t,this._registrations=new Map,this._remoteSockets=new Map,this._proxy=e.getProxy(fe.ExtHostManagedSockets)}async $registerSocketFactory(e){const t=this,i=new class{supports(n){return n.id===e}connect(n,s,o,a){return new Promise((c,d)=>{if(n.id!==e)return d(new Error("Invalid connectTo"));const l=n.id;t._proxy.$openRemoteSocket(l).then(u=>{const h={onClose:new A,onData:new A,onEnd:new A};t._remoteSockets.set(u,h),sW.connect(u,t._proxy,s,o,a,h).then(g=>{g.onDidDispose(()=>t._remoteSockets.delete(u)),c(g)},g=>{t._remoteSockets.delete(u),d(g)})}).catch(d)})}};this._registrations.set(e,this._remoteSocketFactoryService.register(1,i))}async $unregisterSocketFactory(e){var t;(t=this._registrations.get(e))==null||t.dispose()}$onDidManagedSocketHaveData(e,t){var i;(i=this._remoteSockets.get(e))==null||i.onData.fire(t)}$onDidManagedSocketClose(e,t){var i;(i=this._remoteSockets.get(e))==null||i.onClose.fire({type:0,error:t?new Error(t):void 0,hadError:!!t}),this._remoteSockets.delete(e)}$onDidManagedSocketEnd(e){var t;(t=this._remoteSockets.get(e))==null||t.onEnd.fire()}};mV=T([gt(ce.MainThreadManagedSockets),v(1,I$)],mV);class sW extends ne{static connect(e,t,i,n,s,o){const a=new sW(e,t,s,o.onClose,o.onData,o.onEnd);a.write(De.fromString(vve(i,n)));const c=new me;return new Promise((d,l)=>{let u;c.add(a.onData(h=>{u?u=De.concat([u,h],u.byteLength+h.byteLength):u=h;const g=u.indexOf(gV);if(g===-1)return;d(a),a.pauseData();const m=u.slice(g+gV.byteLength);m.byteLength&&o.onData.fire(m)})),c.add(a.onClose(h=>l(h??new Error("socket closed")))),c.add(a.onEnd(()=>l(new Error("socket ended"))))}).finally(()=>c.dispose())}constructor(e,t,i,n,s,o){super(),this.socketId=e,this.proxy=t,this.debugLabel=i,this.pausableDataEmitter=this._register(new fC),this.onData=(...a)=>(this.pausableDataEmitter.isPaused&&queueMicrotask(()=>this.pausableDataEmitter.resume()),this.pausableDataEmitter.event(...a)),this.didDisposeEmitter=this._register(new A),this.onDidDispose=this.didDisposeEmitter.event,this.ended=!1,this._register(s),this._register(s.event(a=>this.pausableDataEmitter.fire(a))),this.onClose=this._register(n).event,this.onEnd=this._register(o).event}pauseData(){this.pausableDataEmitter.pause()}write(e){this.proxy.$remoteSocketWrite(this.socketId,e)}end(){this.ended=!0,this.proxy.$remoteSocketEnd(this.socketId)}drain(){return this.proxy.$remoteSocketDrain(this.socketId)}traceSocketEvent(e,t){H0.traceSocketEvent(this,this.debugLabel,e,t)}dispose(){this.ended||this.proxy.$remoteSocketEnd(this.socketId),this.didDisposeEmitter.fire(),super.dispose()}}var oC;let jF=oC=class extends ne{constructor(e,t,i){super(),this._outputService=t,this._viewsService=i,this._proxy=e.getProxy(fe.ExtHostOutputService);const n=()=>{const s=this._viewsService.isViewVisible(Xn)?this._outputService.getActiveChannel():void 0;this._proxy.$setVisibleChannel(s?s.id:null)};this._register(F.any(this._outputService.onActiveOutputChannel,F.filter(this._viewsService.onDidChangeViewVisibility,({id:s})=>s===Xn))(()=>n())),n()}async $register(e,t,i,n){const s=(oC._extensionIdPool.get(n)||0)+1;oC._extensionIdPool.set(n,s);const o=`extension-output-${n}-#${s}-${e}`,a=k.revive(t);return st.as(cl.OutputChannels).registerChannel({id:o,label:e,file:a,log:!1,languageId:i,extensionId:n}),this._register(ot(()=>this.$dispose(o))),o}async $update(e,t,i){const n=this._getChannel(e);n&&(t===bs.Append?n.update(t):pr(i)&&n.update(t,i))}async $reveal(e,t){const i=this._getChannel(e);i&&this._outputService.showChannel(i.id,t)}async $close(e){if(this._viewsService.isViewVisible(Xn)){const t=this._outputService.getActiveChannel();t&&e===t.id&&this._viewsService.closeView(Xn)}}async $dispose(e){const t=this._getChannel(e);t==null||t.dispose()}_getChannel(e){return this._outputService.getChannel(e)}};jF._extensionIdPool=new Map;jF=oC=T([gt(ce.MainThreadOutputService),v(1,da),v(2,ko)],jF);class yve extends Zn{constructor(e,t,i){super(e,t,void 0,!0,()=>i.executeCommand("_extensions.manage",e))}}let vV=class{constructor(e,t,i){this._commandService=i,this._progress=new Map,this._proxy=e.getProxy(fe.ExtHostProgress),this._progressService=t}dispose(){this._progress.forEach(e=>e.resolve()),this._progress.clear()}async $startProgress(e,t,i){const n=this._createTask(e);t.location===15&&i&&(t={...t,location:15,secondaryActions:[new yve(i,p("manageExtension","Manage Extension"),this._commandService)]}),this._progressService.withProgress(t,n,()=>this._proxy.$acceptProgressCanceled(e))}$progressReport(e,t){const i=this._progress.get(e);i==null||i.progress.report(t)}$progressEnd(e){const t=this._progress.get(e);t&&(t.resolve(),this._progress.delete(e))}_createTask(e){return t=>new Promise(i=>{this._progress.set(e,{resolve:i,progress:t})})}};vV=T([gt(ce.MainThreadProgress),v(1,kc),v(2,un)],vV);let yV=class{constructor(e,t){this.quickDiffService=t,this.providers=new Map,this.providerDisposables=new Map,this.proxy=e.getProxy(fe.ExtHostQuickDiff)}async $registerQuickDiffProvider(e,t,i,n){const s={label:i,rootUri:k.revive(n),selector:t,isSCM:!1,getOriginalResource:async a=>k.revive(await this.proxy.$provideOriginalResource(e,a,new Xt().token))};this.providers.set(e,s);const o=this.quickDiffService.addQuickDiffProvider(s);this.providerDisposables.set(e,o)}async $unregisterQuickDiffProvider(e){this.providers.has(e)&&this.providers.delete(e),this.providerDisposables.has(e)&&this.providerDisposables.delete(e)}dispose(){this.providers.clear(),vt(this.providerDisposables.values()),this.providerDisposables.clear()}};yV=T([gt(ce.MainThreadQuickDiff),v(1,VT)],yV);function _V(r){r.dark=k.revive(r.dark),r.light&&(r.light=k.revive(r.light))}let wV=class{constructor(e,t){this._items={},this.sessions=new Map,this._proxy=e.getProxy(fe.ExtHostQuickOpen),this._quickInputService=t}dispose(){}$show(e,t,i){const n=new Promise((s,o)=>{this._items[e]={resolve:s,reject:o}});return t={...t,onDidFocus:s=>{s&&this._proxy.$onItemSelected(s.handle)}},t.canPickMany?this._quickInputService.pick(n,t,i).then(s=>{if(s)return s.map(o=>o.handle)}):this._quickInputService.pick(n,t,i).then(s=>{if(s)return s.handle})}$setItems(e,t){return this._items[e]&&(this._items[e].resolve(t),delete this._items[e]),Promise.resolve()}$setError(e,t){return this._items[e]&&(this._items[e].reject(t),delete this._items[e]),Promise.resolve()}$input(e,t,i){const n=Object.create(null);return e&&(n.title=e.title,n.password=e.password,n.placeHolder=e.placeHolder,n.valueSelection=e.valueSelection,n.prompt=e.prompt,n.value=e.value,n.ignoreFocusLost=e.ignoreFocusOut),t&&(n.validateInput=s=>this._proxy.$validateInput(s)),this._quickInputService.input(n,i)}$createOrUpdate(e){const t=e.id;let i=this.sessions.get(t);if(!i){const o=e.type==="quickPick"?this._quickInputService.createQuickPick():this._quickInputService.createInputBox();if(o.onDidAccept(()=>{this._proxy.$onDidAccept(t)}),o.onDidTriggerButton(a=>{this._proxy.$onDidTriggerButton(t,a.handle)}),o.onDidChangeValue(a=>{this._proxy.$onDidChangeValue(t,a)}),o.onDidHide(()=>{this._proxy.$onDidHide(t)}),e.type==="quickPick"){const a=o;a.onDidChangeActive(c=>{this._proxy.$onDidChangeActive(t,c.map(d=>d.handle))}),a.onDidChangeSelection(c=>{this._proxy.$onDidChangeSelection(t,c.map(d=>d.handle))}),a.onDidTriggerItemButton(c=>{this._proxy.$onDidTriggerItemButton(t,c.item.handle,c.button.handle)})}i={input:o,handlesToItems:new Map},this.sessions.set(t,i)}const{input:n,handlesToItems:s}=i;for(const o in e)o==="id"||o==="type"||(o==="visible"?e.visible?n.show():n.hide():o==="items"?(s.clear(),e[o].forEach(a=>{a.type!=="separator"&&(a.buttons&&(a.buttons=a.buttons.map(c=>(c.iconPath&&_V(c.iconPath),c))),s.set(a.handle,a))}),n[o]=e[o]):o==="activeItems"||o==="selectedItems"?n[o]=e[o].filter(a=>s.has(a)).map(a=>s.get(a)):o==="buttons"?n[o]=e.buttons.map(a=>a.handle===-1?this._quickInputService.backButton:(a.iconPath&&_V(a.iconPath),a)):n[o]=e[o]);return Promise.resolve(void 0)}$dispose(e){const t=this.sessions.get(e);return t&&(t.input.dispose(),this.sessions.delete(e)),Promise.resolve(void 0)}};wV=T([gt(ce.MainThreadQuickOpen),v(1,ss)],wV);let bV=class extends ne{constructor(e,t,i){super(),this._environmentService=t,this._proxy=e.getProxy(fe.ExtHostExtensionService);const n=this._environmentService.remoteAuthority;n&&this._register(i.onDidChangeConnectionData(()=>{const s=i.getConnectionData(n);s&&this._proxy.$updateRemoteConnectionData(s)}))}};bV=T([Eu,v(1,Ar),v(2,wu)],bV);class _ve{constructor(e){this._proxy=e.getProxy(fe.ExtHostDocumentSaveParticipant)}async participate(e,t,i,n){if(!e.textEditorModel||!Sh(e.textEditorModel))return;const s=new Promise((o,a)=>{setTimeout(()=>a(new Error(p("timeout.onWillSave","Aborted onWillSaveTextDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(e.resource,t.reason).then(c=>{if(!c.every(d=>d))return Promise.reject(new Error("listener failed"))}).then(o,a)});return mk(s,n)}}let SV=class{constructor(e,t,i){this._textFileService=i,this._saveParticipantDisposable=this._textFileService.files.addSaveParticipant(t.createInstance(_ve,e))}dispose(){this._saveParticipantDisposable.dispose()}};SV=T([Eu,v(1,Te),v(2,Dn)],SV);class wve{constructor(e){this.timeout=1e4,this._proxy=e.getProxy(fe.ExtHostWorkspace)}async participate(e,t){const i=new Promise((n,s)=>{setTimeout(()=>s(new Error(p("timeout.onWillCreateEditSessionIdentity","Aborted onWillCreateEditSessionIdentity-event after 10000ms"))),this.timeout),this._proxy.$onWillCreateEditSessionIdentity(e.uri,t,this.timeout).then(n,s)});return mk(i,t)}}let CV=class{constructor(e,t,i){this._editSessionIdentityService=i,this._saveParticipantDisposable=this._editSessionIdentityService.addEditSessionIdentityCreateParticipant(t.createInstance(wve,e))}dispose(){this._saveParticipantDisposable.dispose()}};CV=T([Eu,v(1,Te),v(2,X1)],CV);class bve{constructor(){this.elements=[],this._onDidSplice=new A,this.onDidSplice=this._onDidSplice.event}splice(e,t,i=[]){this.elements.splice(e,t,...i),this._onDidSplice.fire({start:e,deleteCount:t,toInsert:i})}}class Sve{get hideWhenEmpty(){return!!this.features.hideWhenEmpty}constructor(e,t,i,n,s,o){this.sourceControlHandle=e,this.handle=t,this.provider=i,this.features=n,this.label=s,this.id=o,this.elements=[],this._onDidSplice=new A,this.onDidSplice=this._onDidSplice.event,this._onDidChange=new A,this.onDidChange=this._onDidChange.event}toJSON(){return{$mid:4,sourceControlHandle:this.sourceControlHandle,groupHandle:this.handle}}splice(e,t,i){this.elements.splice(e,t,...i),this._onDidSplice.fire({start:e,deleteCount:t,toInsert:i})}$updateGroup(e){this.features={...this.features,...e},this._onDidChange.fire()}$updateGroupLabel(e){this.label=e,this._onDidChange.fire()}}class Cve{constructor(e,t,i,n,s,o,a,c,d){this.proxy=e,this.sourceControlHandle=t,this.groupHandle=i,this.handle=n,this.sourceUri=s,this.resourceGroup=o,this.decorations=a,this.contextValue=c,this.command=d}open(e){return this.proxy.$executeResourceCommand(this.sourceControlHandle,this.groupHandle,this.handle,e)}toJSON(){return{$mid:3,sourceControlHandle:this.sourceControlHandle,groupHandle:this.groupHandle,handle:this.handle}}}const KD=class KD{get id(){return this._id}get handle(){return this._handle}get label(){return this._label}get rootUri(){return this._rootUri}get inputBoxDocumentUri(){return this._inputBoxDocumentUri}get contextValue(){return this._contextValue}get commitTemplate(){return this.features.commitTemplate||""}get acceptInputCommand(){return this.features.acceptInputCommand}get actionButton(){return this.features.actionButton??void 0}get statusBarCommands(){return this.features.statusBarCommands}get count(){return this.features.count}get onDidChangeStatusBarCommands(){return this._onDidChangeStatusBarCommands.event}constructor(e,t,i,n,s,o,a){this.proxy=e,this._handle=t,this._contextValue=i,this._label=n,this._rootUri=s,this._inputBoxDocumentUri=o,this._quickDiffService=a,this._id=`scm${KD.ID_HANDLE++}`,this.groups=new bve,this._groupsByHandle=Object.create(null),this._onDidChangeResources=new A,this.onDidChangeResources=this._onDidChangeResources.event,this.features={},this._onDidChangeCommitTemplate=new A,this.onDidChangeCommitTemplate=this._onDidChangeCommitTemplate.event,this._onDidChangeStatusBarCommands=new A,this._onDidChange=new A,this.onDidChange=this._onDidChange.event,this.isSCM=!0}$updateSourceControl(e){this.features={...this.features,...e},this._onDidChange.fire(),typeof e.commitTemplate<"u"&&this._onDidChangeCommitTemplate.fire(this.commitTemplate),typeof e.statusBarCommands<"u"&&this._onDidChangeStatusBarCommands.fire(this.statusBarCommands),e.hasQuickDiffProvider&&!this._quickDiff?this._quickDiff=this._quickDiffService.addQuickDiffProvider({label:e.quickDiffLabel??this.label,rootUri:this.rootUri,isSCM:this.isSCM,getOriginalResource:t=>this.getOriginalResource(t)}):e.hasQuickDiffProvider===!1&&this._quickDiff&&(this._quickDiff.dispose(),this._quickDiff=void 0)}$registerGroups(e){const t=e.map(([i,n,s,o])=>{const a=new Sve(this.handle,i,this,o,s,n);return this._groupsByHandle[i]=a,a});this.groups.splice(this.groups.elements.length,0,t)}$updateGroup(e,t){const i=this._groupsByHandle[e];i&&i.$updateGroup(t)}$updateGroupLabel(e,t){const i=this._groupsByHandle[e];i&&i.$updateGroupLabel(t)}$spliceGroupResourceStates(e){for(const[t,i]of e){const n=this._groupsByHandle[t];if(!n){console.warn(`SCM group ${t} not found in provider ${this.label}`);continue}i.reverse();for(const[s,o,a]of i){const c=a.map(d=>{const[l,u,h,g,m,y,_,b]=d,[E,D]=h,R=Si.isThemeIcon(E)?E:k.revive(E),M=(Si.isThemeIcon(D)?D:k.revive(D))||R,O={icon:R,iconDark:M,tooltip:g,strikeThrough:m,faded:y};return new Cve(this.proxy,this.handle,t,l,k.revive(u),n,O,_||void 0,b)});n.splice(s,o,c)}}this._onDidChangeResources.fire()}$unregisterGroup(e){const t=this._groupsByHandle[e];t&&(delete this._groupsByHandle[e],this.groups.splice(this.groups.elements.indexOf(t),1),this._onDidChangeResources.fire())}async getOriginalResource(e){if(!this.features.hasQuickDiffProvider)return null;const t=await this.proxy.$provideOriginalResource(this.handle,e,_t.None);return t&&k.revive(t)}toJSON(){return{$mid:5,handle:this.handle}}dispose(){var e;(e=this._quickDiff)==null||e.dispose()}};mi(KD,"ID_HANDLE",0);let BF=KD,EV=class{constructor(e,t,i,n){this.scmService=t,this.scmViewService=i,this.quickDiffService=n,this._repositories=new Map,this._repositoryDisposables=new Map,this._disposables=new me,this._proxy=e.getProxy(fe.ExtHostSCM)}dispose(){vt(this._repositories.values()),this._repositories.clear(),vt(this._repositoryDisposables.values()),this._repositoryDisposables.clear(),this._disposables.dispose()}$registerSourceControl(e,t,i,n,s){const o=new BF(this._proxy,e,t,i,n?k.revive(n):void 0,k.revive(s),this.quickDiffService),a=this.scmService.registerSCMProvider(o);this._repositories.set(e,a);const c=Da(F.filter(this.scmViewService.onDidFocusRepository,d=>d===a)(d=>this._proxy.$setSelectedSourceControl(e)),a.input.onDidChange(({value:d})=>this._proxy.$onInputBoxValueChange(e,d)));this.scmViewService.focusedRepository===a&&setTimeout(()=>this._proxy.$setSelectedSourceControl(e),0),a.input.value&&setTimeout(()=>this._proxy.$onInputBoxValueChange(e,a.input.value),0),this._repositoryDisposables.set(e,c)}$updateSourceControl(e,t){const i=this._repositories.get(e);if(!i)return;i.provider.$updateSourceControl(t)}$unregisterSourceControl(e){const t=this._repositories.get(e);t&&(this._repositoryDisposables.get(e).dispose(),this._repositoryDisposables.delete(e),t.dispose(),this._repositories.delete(e))}$registerGroups(e,t,i){const n=this._repositories.get(e);if(!n)return;const s=n.provider;s.$registerGroups(t),s.$spliceGroupResourceStates(i)}$updateGroup(e,t,i){const n=this._repositories.get(e);if(!n)return;n.provider.$updateGroup(t,i)}$updateGroupLabel(e,t,i){const n=this._repositories.get(e);if(!n)return;n.provider.$updateGroupLabel(t,i)}$spliceResourceStates(e,t){const i=this._repositories.get(e);if(!i)return;i.provider.$spliceGroupResourceStates(t)}$unregisterGroup(e,t){const i=this._repositories.get(e);if(!i)return;i.provider.$unregisterGroup(t)}$setInputBoxValue(e,t){const i=this._repositories.get(e);i&&i.input.setValue(t,!1)}$setInputBoxPlaceholder(e,t){const i=this._repositories.get(e);i&&(i.input.placeholder=t)}$setInputBoxEnablement(e,t){const i=this._repositories.get(e);i&&(i.input.enabled=t)}$setInputBoxVisibility(e,t){const i=this._repositories.get(e);i&&(i.input.visible=t)}$showValidationMessage(e,t,i){const n=this._repositories.get(e);n&&n.input.showValidationMessage(t,i)}$setValidationProviderIsEnabled(e,t){const i=this._repositories.get(e);i&&(t?i.input.validateInput=async(n,s)=>{const o=await this._proxy.$validateInput(e,n,s);return o&&{message:o[0],type:o[1]}}:i.input.validateInput=async()=>{})}};EV=T([gt(ce.MainThreadSCM),v(1,F4),v(2,O4),v(3,VT)],EV);let xV=class{constructor(e,t,i,n){this._searchService=t,this._telemetryService=i,this._searchProvider=new Map,this._proxy=e.getProxy(fe.ExtHostSearch),this._proxy.$enableExtensionHostSearch()}dispose(){this._searchProvider.forEach(e=>e.dispose()),this._searchProvider.clear()}$registerTextSearchProvider(e,t){this._searchProvider.set(e,new DV(this._searchService,1,t,e,this._proxy))}$registerFileSearchProvider(e,t){this._searchProvider.set(e,new DV(this._searchService,0,t,e,this._proxy))}$unregisterProvider(e){vt(this._searchProvider.get(e)),this._searchProvider.delete(e)}$handleFileMatch(e,t,i){const n=this._searchProvider.get(e);if(!n)throw new Error("Got result for unknown provider");n.handleFindMatch(t,i)}$handleTextMatch(e,t,i){const n=this._searchProvider.get(e);if(!n)throw new Error("Got result for unknown provider");n.handleFindMatch(t,i)}$handleTelemetry(e,t){this._telemetryService.publicLog(e,t)}};xV=T([gt(ce.MainThreadSearch),v(1,cb),v(2,gi),v(3,We)],xV);const QD=class QD{constructor(e,t=++QD._idPool,i=new Map){this.progress=e,this.id=t,this.matches=i}addMatch(e){var i;const t=this.matches.get(e.resource.toString());t?t.results&&e.results&&t.results.push(...e.results):this.matches.set(e.resource.toString(),e),(i=this.progress)==null||i.call(this,e)}};mi(QD,"_idPool",0);let UF=QD;class DV{constructor(e,t,i,n,s){this._scheme=i,this._handle=n,this._proxy=s,this._registrations=new me,this._searches=new Map,this._registrations.add(e.registerSearchResultProvider(this._scheme,t,this))}dispose(){this._registrations.dispose()}fileSearch(e,t=_t.None){return this.doSearch(e,void 0,t)}textSearch(e,t,i=_t.None){return this.doSearch(e,t,i)}doSearch(e,t,i=_t.None){if(!e.folderQueries.length)throw new Error("Empty folderQueries");const n=new UF(t);this._searches.set(n.id,n);const s=e.type===1?this._proxy.$provideFileSearchResults(this._handle,n.id,e,i):this._proxy.$provideTextSearchResults(this._handle,n.id,e,i);return Promise.resolve(s).then(o=>(this._searches.delete(n.id),{results:Array.from(n.matches.values()),stats:o.stats,limitHit:o.limitHit,messages:o.messages}),o=>(this._searches.delete(n.id),Promise.reject(o)))}clearCache(e){return Promise.resolve(this._proxy.$clearCache(e))}handleFindMatch(e,t){const i=this._searches.get(e);i&&t.forEach(n=>{n.results?i.addMatch({resource:k.revive(n.resource),results:n.results}):i.addMatch({resource:k.revive(n)})})}}let kV=class{constructor(e,t){this.statusbarService=t,this._store=new me;const i=e.getProxy(fe.ExtHostStatusBar),n=[];for(const[o,a]of t.getEntries())n.push(s(o,a));i.$acceptStaticEntries(n),this._store.add(t.onDidChange(o=>{o.added&&i.$acceptStaticEntries([s(o.added[0],o.added[1])])}));function s(o,a){return{entryId:o,name:a.entry.name,text:a.entry.text,tooltip:a.entry.tooltip,command:typeof a.entry.command=="string"?a.entry.command:typeof a.entry.command=="object"?a.entry.command.id:void 0,priority:a.priority,alignLeft:a.alignment===0,accessibilityInformation:a.entry.ariaLabel?{label:a.entry.ariaLabel,role:a.entry.role}:void 0}}}dispose(){this._store.dispose()}$setEntry(e,t,i,n,s,o,a,c,d,l,u,h){this.statusbarService.setOrUpdateEntry(e,t,i,n,s,o,a,c,d,l,u,h)===0&&this._store.add(ot(()=>this.statusbarService.unsetEntry(e)))}$disposeEntry(e){this.statusbarService.unsetEntry(e)}};kV=T([gt(ce.MainThreadStatusBar),v(1,E$)],kV);async function Eve(r,e,t,i){return i.invokeFunction(async n=>{const s=n.get(ls),o=n.get(Pf),a=n.get(_$),c=n.get(ri),d=n.get(Hi),l=n.get(at),u=n.get(oi),h=n.get(ze),g=`extensionStorage.migrate.${r}-${e}`,m=r.toLowerCase()===e.toLowerCase()?`extension.storage.migrateFromLowerCaseKey.${r.toLowerCase()}`:void 0;if(r===e)return;const y=(b,E)=>E?d.extUri.joinPath(o.defaultProfile.globalStorageHome,b.toLowerCase()):d.extUri.joinPath(s.workspaceStorageHome,u.getWorkspace().id,b),_=t?0:1;if(!c.getBoolean(g,_,!1)&&!(m&&c.getBoolean(m,_,!1))){h.info(`Migrating ${t?"global":"workspace"} extension storage from ${r} to ${e}...`);const b=a.getExtensionState(r,t);b&&(a.setExtensionState(e,b,t),a.setExtensionState(r,void 0,t));const E=y(r,t),D=y(e,t);if(!d.extUri.isEqual(E,D))try{await l.move(E,D,!0)}catch(R){R.code!==lt.FileNotFound&&h.info(`Error while migrating ${t?"global":"workspace"} file storage from '${r}' to '${e}'`,UN(R))}h.info(`Migrated ${t?"global":"workspace"} extension storage from ${r} to ${e}`),c.store(g,!0,_,1)}})}let TV=class{constructor(e,t,i,n,s){this._extensionStorageService=t,this._storageService=i,this._instantiationService=n,this._logService=s,this._sharedStorageKeysToWatch=new Map,this._proxy=e.getProxy(fe.ExtHostStorage),this._storageListener=this._storageService.onDidChangeValue(o=>{const a=o.scope===0;if(a&&this._sharedStorageKeysToWatch.has(o.key)){const c=this._extensionStorageService.getExtensionStateRaw(o.key,a);typeof c=="string"&&this._proxy.$acceptValue(a,o.key,c)}})}dispose(){this._storageListener.dispose()}async $initializeExtensionStorage(e,t){return await this.checkAndMigrateExtensionStorage(t,e),e&&this._sharedStorageKeysToWatch.set(t,!0),this._extensionStorageService.getExtensionStateRaw(t,e)}async $setValue(e,t,i){this._extensionStorageService.setExtensionState(t,i,e)}$registerExtensionStorageKeysToSync(e,t){this._extensionStorageService.setKeysForSync(e,t)}async checkAndMigrateExtensionStorage(e,t){try{let i=this._extensionStorageService.getSourceExtensionToMigrate(e);!i&&ln&&e!==e.toLowerCase()&&(i=e.toLowerCase()),i&&(ln&&i!==i.toLowerCase()&&this._extensionStorageService.getExtensionState(i.toLowerCase(),t)&&!this._extensionStorageService.getExtensionState(i,t)&&(i=i.toLowerCase()),await Eve(i,e,t,this._instantiationService))}catch(i){this._logService.error(i)}}};TV=T([gt(ce.MainThreadStorage),v(1,_$),v(2,ri),v(3,Te),v(4,ze)],TV);var VF;let qF=VF=class extends ne{constructor(e,t,i,n,s){super(),this._telemetryService=t,this._configurationService=i,this._environmentService=n,this._productService=s,this._proxy=e.getProxy(fe.ExtHostTelemetry),bS(this._productService,this._environmentService)&&this._register(this._configurationService.onDidChangeConfiguration(o=>{(o.affectsConfiguration(cq)||o.affectsConfiguration(dq))&&this._proxy.$onDidChangeTelemetryLevel(this.telemetryLevel)})),this._proxy.$initializeTelemetryLevel(this.telemetryLevel,bS(this._productService,this._environmentService),this._productService.enabledTelemetryLevels)}get telemetryLevel(){return bS(this._productService,this._environmentService)?this._telemetryService.telemetryLevel:0}$publicLog(e,t=Object.create(null)){t[VF._name]=!0,this._telemetryService.publicLog(e,t)}$publicLog2(e,t){this.$publicLog(e,t)}};qF._name="pluginHostTelemetry";qF=VF=T([gt(ce.MainThreadTelemetry),v(1,gi),v(2,We),v(3,ls),v(4,Rs)],qF);let GF=class extends ne{get onProcessReady(){return this._onProcessReady.event}constructor(e,t,i,n){super(),this.instanceId=e,this._cols=t,this._rows=i,this._terminalService=n,this.id=0,this.shouldPersist=!1,this._onProcessData=this._register(new A),this.onProcessData=this._onProcessData.event,this._onProcessReady=this._register(new A),this._onStart=this._register(new A),this.onStart=this._onStart.event,this._onInput=this._register(new A),this.onInput=this._onInput.event,this._onBinary=this._register(new A),this.onBinary=this._onBinary.event,this._onResize=this._register(new A),this.onResize=this._onResize.event,this._onAcknowledgeDataEvent=this._register(new A),this.onAcknowledgeDataEvent=this._onAcknowledgeDataEvent.event,this._onShutdown=this._register(new A),this.onShutdown=this._onShutdown.event,this._onRequestInitialCwd=this._register(new A),this.onRequestInitialCwd=this._onRequestInitialCwd.event,this._onRequestCwd=this._register(new A),this.onRequestCwd=this._onRequestCwd.event,this._onRequestLatency=this._register(new A),this.onRequestLatency=this._onRequestLatency.event,this._onDidChangeProperty=this._register(new A),this.onDidChangeProperty=this._onDidChangeProperty.event,this._onProcessExit=this._register(new A),this.onProcessExit=this._onProcessExit.event,this._pendingInitialCwdRequests=[],this._pendingCwdRequests=[],this._pendingLatencyRequests=[]}emitData(e){this._onProcessData.fire(e)}emitTitle(e){this._onDidChangeProperty.fire({type:"title",value:e})}emitReady(e,t){this._onProcessReady.fire({pid:e,cwd:t,windowsPty:void 0})}emitProcessProperty({type:e,value:t}){switch(e){case"cwd":this.emitCwd(t);break;case"initialCwd":this.emitInitialCwd(t);break;case"title":this.emitTitle(t);break;case"overrideDimensions":this.emitOverrideDimensions(t);break;case"resolvedShellLaunchConfig":this.emitResolvedShellLaunchConfig(t);break}}emitExit(e){this._onProcessExit.fire(e),this.dispose()}emitOverrideDimensions(e){this._onDidChangeProperty.fire({type:"overrideDimensions",value:e})}emitResolvedShellLaunchConfig(e){this._onDidChangeProperty.fire({type:"resolvedShellLaunchConfig",value:e})}emitInitialCwd(e){for(;this._pendingInitialCwdRequests.length>0;)this._pendingInitialCwdRequests.pop()(e)}emitCwd(e){for(;this._pendingCwdRequests.length>0;)this._pendingCwdRequests.pop()(e)}emitLatency(e){for(;this._pendingLatencyRequests.length>0;)this._pendingLatencyRequests.pop()(e)}async start(){return this._terminalService.requestStartExtensionTerminal(this,this._cols,this._rows)}shutdown(e){this._onShutdown.fire(e)}input(e){this._onInput.fire(e)}resize(e,t){this._onResize.fire({cols:e,rows:t})}clearBuffer(){}acknowledgeDataEvent(){}async setUnicodeVersion(e){}async processBinary(e){this._onBinary.fire(e)}getInitialCwd(){return new Promise(e=>{this._onRequestInitialCwd.fire(),this._pendingInitialCwdRequests.push(e)})}getCwd(){return new Promise(e=>{this._onRequestCwd.fire(),this._pendingCwdRequests.push(e)})}getLatency(){return new Promise(e=>{this._onRequestLatency.fire(),this._pendingLatencyRequests.push(e)})}async refreshProperty(e){}async updateProperty(e,t){}};GF=T([v(3,BT)],GF);let IV=class{constructor(e,t,i,n,s,o,a,c,d,l,u,h){this._extHostContext=e,this._terminalService=t,this._terminalLinkProviderService=i,this._terminalQuickFixService=n,this._instantiationService=s,this._environmentVariableService=o,this._logService=a,this._terminalProfileResolverService=c,this._terminalGroupService=l,this._terminalEditorService=u,this._terminalProfileService=h,this._store=new me,this._extHostTerminals=new Map,this._terminalProcessProxies=new Map,this._profileProviders=new Map,this._quickFixProviders=new Map,this._dataEventTracker=new Hr,this._os=dc,this._proxy=e.getProxy(fe.ExtHostTerminalService),this._store.add(t.onDidCreateInstance(m=>{this._onTerminalOpened(m),this._onInstanceDimensionsChanged(m)})),this._store.add(t.onDidDisposeInstance(m=>this._onTerminalDisposed(m))),this._store.add(t.onDidReceiveProcessId(m=>this._onTerminalProcessIdReady(m))),this._store.add(t.onDidChangeInstanceDimensions(m=>this._onInstanceDimensionsChanged(m))),this._store.add(t.onDidMaximumDimensionsChange(m=>this._onInstanceMaximumDimensionsChanged(m))),this._store.add(t.onDidRequestStartExtensionTerminal(m=>this._onRequestStartExtensionTerminal(m))),this._store.add(t.onDidChangeActiveInstance(m=>this._onActiveTerminalChanged(m?m.instanceId:null))),this._store.add(t.onDidChangeInstanceTitle(m=>m&&this._onTitleChanged(m.instanceId,m.title))),this._store.add(t.onDidInputInstanceData(m=>this._proxy.$acceptTerminalInteraction(m.instanceId)));for(const m of this._terminalService.instances)this._onTerminalOpened(m),m.processReady.then(()=>this._onTerminalProcessIdReady(m));const g=this._terminalService.activeInstance;if(g&&this._proxy.$acceptActiveTerminalChanged(g.instanceId),this._environmentVariableService.collections.size>0){const y=[...this._environmentVariableService.collections.entries()].map(_=>[_[0],$$(_[1].map)]);this._proxy.$initEnvironmentVariableCollections(y)}d.getEnvironment().then(async m=>{this._os=(m==null?void 0:m.os)||dc,this._updateDefaultProfile()}),this._store.add(this._terminalProfileService.onDidChangeAvailableProfiles(()=>this._updateDefaultProfile()))}dispose(){var e;this._store.dispose(),(e=this._linkProvider)==null||e.dispose();for(const t of this._profileProviders.values())t.dispose();for(const t of this._quickFixProviders.values())t.dispose()}async _updateDefaultProfile(){const e=ii(this._extHostContext.remoteAuthority),t=this._terminalProfileResolverService.getDefaultProfile({remoteAuthority:e,os:this._os}),i=this._terminalProfileResolverService.getDefaultProfile({remoteAuthority:e,os:this._os,allowAutomationShell:!0});this._proxy.$acceptDefaultProfile(...await Promise.all([t,i]))}async _getTerminalInstance(e){return typeof e=="string"?this._extHostTerminals.get(e):this._terminalService.getInstanceFromId(e)}async $createTerminal(e,t){const i={name:t.name,executable:t.shellPath,args:t.shellArgs,cwd:typeof t.cwd=="string"?t.cwd:k.revive(t.cwd),icon:t.icon,color:t.color,initialText:t.initialText,waitOnExit:t.waitOnExit,ignoreConfigurationCwd:!0,env:t.env,strictEnv:t.strictEnv,hideFromUser:t.hideFromUser,customPtyImplementation:t.isExtensionCustomPtyTerminal?(o,a,c)=>new GF(o,a,c,this._terminalService):void 0,extHostTerminalId:e,isFeatureTerminal:t.isFeatureTerminal,isExtensionOwnedTerminal:t.isExtensionOwnedTerminal,useShellEnvironment:t.useShellEnvironment,isTransient:t.isTransient},n=Sn.withAsyncBody(async o=>{const a=await this._terminalService.createTerminal({config:i,location:await this._deserializeParentTerminal(t.location)});o(a)});this._extHostTerminals.set(e,n);const s=await n;this._store.add(s.onDisposed(()=>{this._extHostTerminals.delete(e)}))}async _deserializeParentTerminal(e){if(typeof e=="object"&&"parentTerminal"in e){const t=await this._extHostTerminals.get(e.parentTerminal.toString());return t?{parentTerminal:t}:void 0}return e}async $show(e,t){const i=await this._getTerminalInstance(e);i&&(this._terminalService.setActiveInstance(i),i.target===om.Editor?await this._terminalEditorService.revealActiveEditor(t):await this._terminalGroupService.showPanel(!t))}async $hide(e){const t=await this._getTerminalInstance(e),i=this._terminalService.activeInstance;i&&i.instanceId===(t==null?void 0:t.instanceId)&&i.target!==om.Editor&&this._terminalGroupService.hidePanel()}async $dispose(e){var t;(t=await this._getTerminalInstance(e))==null||t.dispose($h.Extension)}async $sendText(e,t,i){const n=await this._getTerminalInstance(e);await(n==null?void 0:n.sendText(t,i))}$sendProcessExit(e,t){var i;(i=this._terminalProcessProxies.get(e))==null||i.emitExit(t)}$startSendingDataEvents(){if(!this._dataEventTracker.value){this._dataEventTracker.value=this._instantiationService.createInstance(zF,(e,t)=>{this._onTerminalData(e,t)});for(const e of this._terminalService.instances)for(const t of e.initialDataEvents||[])this._onTerminalData(e.instanceId,t)}}$stopSendingDataEvents(){this._dataEventTracker.clear()}$startLinkProvider(){var e;(e=this._linkProvider)==null||e.dispose(),this._linkProvider=this._terminalLinkProviderService.registerLinkProvider(new xve(this._proxy))}$stopLinkProvider(){var e;(e=this._linkProvider)==null||e.dispose(),this._linkProvider=void 0}$registerProcessSupport(e){this._terminalService.registerProcessSupport(e)}$registerProfileProvider(e,t){this._profileProviders.set(e,this._terminalProfileService.registerTerminalProfileProvider(t,e,{createContributedTerminalProfile:async i=>this._proxy.$createContributedProfileTerminal(e,i)}))}$unregisterProfileProvider(e){var t;(t=this._profileProviders.get(e))==null||t.dispose(),this._profileProviders.delete(e)}async $registerQuickFixProvider(e,t){this._quickFixProviders.set(e,this._terminalQuickFixService.registerQuickFixProvider(e,{provideTerminalQuickFixes:async(i,n,s,o)=>{var u;if(o.isCancellationRequested)return;(u=s.outputMatcher)!=null&&u.length&&s.outputMatcher.length>40&&(s.outputMatcher.length=40,this._logService.warn("Cannot exceed output matcher length of 40"));const a=i.command.match(s.commandLineMatcher);if(!a)return;const c=s.outputMatcher;let d;if(c&&(d=Dve(n,c)),!d)return;const l={commandLineMatch:a,outputMatch:d,commandLine:i.command};if(l){const h=await this._proxy.$provideTerminalQuickFixes(e,l,o);if(h&&Array.isArray(h))return h.map(g=>RV(e,t,g));if(h)return RV(e,t,h)}}}))}$unregisterQuickFixProvider(e){var t;(t=this._quickFixProviders.get(e))==null||t.dispose(),this._quickFixProviders.delete(e)}_onActiveTerminalChanged(e){this._proxy.$acceptActiveTerminalChanged(e)}_onTerminalData(e,t){this._proxy.$acceptTerminalProcessData(e,t)}_onTitleChanged(e,t){this._proxy.$acceptTerminalTitleChange(e,t)}_onTerminalDisposed(e){this._proxy.$acceptTerminalClosed(e.instanceId,e.exitCode,e.exitReason??$h.Unknown)}_onTerminalOpened(e){const t=e.shellLaunchConfig.extHostTerminalId,i={name:e.shellLaunchConfig.name,executable:e.shellLaunchConfig.executable,args:e.shellLaunchConfig.args,cwd:e.shellLaunchConfig.cwd,env:e.shellLaunchConfig.env,hideFromUser:e.shellLaunchConfig.hideFromUser};this._proxy.$acceptTerminalOpened(e.instanceId,t,e.title,i)}_onTerminalProcessIdReady(e){e.processId!==void 0&&this._proxy.$acceptTerminalProcessId(e.instanceId,e.processId)}_onInstanceDimensionsChanged(e){this._proxy.$acceptTerminalDimensions(e.instanceId,e.cols,e.rows)}_onInstanceMaximumDimensionsChanged(e){this._proxy.$acceptTerminalMaximumDimensions(e.instanceId,e.maxCols,e.maxRows)}_onRequestStartExtensionTerminal(e){const t=e.proxy;this._terminalProcessProxies.set(t.instanceId,t);const i=e.cols&&e.rows?{columns:e.cols,rows:e.rows}:void 0;this._proxy.$startExtensionTerminal(t.instanceId,i).then(e.callback),t.onInput(n=>this._proxy.$acceptProcessInput(t.instanceId,n)),t.onShutdown(n=>this._proxy.$acceptProcessShutdown(t.instanceId,n)),t.onRequestCwd(()=>this._proxy.$acceptProcessRequestCwd(t.instanceId)),t.onRequestInitialCwd(()=>this._proxy.$acceptProcessRequestInitialCwd(t.instanceId)),t.onRequestLatency(()=>this._onRequestLatency(t.instanceId))}$sendProcessData(e,t){var i;(i=this._terminalProcessProxies.get(e))==null||i.emitData(t)}$sendProcessReady(e,t,i,n){var s;(s=this._terminalProcessProxies.get(e))==null||s.emitReady(t,i,n)}$sendProcessProperty(e,t){var i;if(t.type==="title"){const n=this._terminalService.getInstanceFromId(e);n==null||n.rename(t.value)}(i=this._terminalProcessProxies.get(e))==null||i.emitProcessProperty(t)}async _onRequestLatency(e){var n;let i=0;for(let s=0;s<2;s++){const o=Tr.create();await this._proxy.$acceptProcessRequestLatency(e),o.stop(),i+=o.elapsed()}(n=this._getTerminalProcess(e))==null||n.emitLatency(i/2)}_getTerminalProcess(e){const t=this._terminalProcessProxies.get(e);if(!t){this._logService.error(`Unknown terminal: ${e}`);return}return t}$setEnvironmentVariableCollection(e,t,i,n){if(i){const s={persistent:t,map:k5(i),descriptionMap:T5(n)};this._environmentVariableService.set(e,s)}else this._environmentVariableService.delete(e)}};IV=T([gt(ce.MainThreadTerminalService),v(1,BT),v(2,f4),v(3,g4),v(4,Te),v(5,p4),v(6,ze),v(7,w$),v(8,Wa),v(9,c4),v(10,a4),v(11,l4)],IV);let zF=class extends ne{constructor(e,t){super(),this._callback=e,this._terminalService=t,this._register(this._bufferer=new I5(this._callback));for(const i of this._terminalService.instances)this._registerInstance(i);this._register(this._terminalService.onDidCreateInstance(i=>this._registerInstance(i))),this._register(this._terminalService.onDidDisposeInstance(i=>this._bufferer.stopBuffering(i.instanceId)))}_registerInstance(e){this._register(this._bufferer.startBuffering(e.instanceId,e.onData))}};zF=T([v(1,BT)],zF);class xve{constructor(e){this._proxy=e}async provideLinks(e,t){const i=this._proxy;return(await i.$provideLinks(e.instanceId,t)).map(s=>({id:s.id,startIndex:s.startIndex,length:s.length,label:s.label,activate:()=>i.$activateLink(e.instanceId,s.id)}))}}function Dve(r,e){const t=r.join(`
`).match(e.lineMatcher);return t?{regexMatch:t,outputLines:r}:void 0}function RV(r,e,t){let i=s_.Command;return"uri"in t&&(t.uri=k.revive(t.uri),i=s_.Opener),{id:r,type:i,source:e,...t}}let PV=class{constructor(e,t){this._themeService=t,this._proxy=e.getProxy(fe.ExtHostTheming),this._themeChangeListener=this._themeService.onDidColorThemeChange(i=>{this._proxy.$onColorThemeChange(this._themeService.getColorTheme().type)}),this._proxy.$onColorThemeChange(this._themeService.getColorTheme().type)}dispose(){this._themeChangeListener.dispose()}};PV=T([gt(ce.MainThreadTheming),v(1,Fi)],PV);let AV=class extends ne{constructor(e,t,i,n,s){super(),this.viewsService=t,this.notificationService=i,this.extensionService=n,this.logService=s,this._dataProviders=new Map,this._dndControllers=new Map,this._proxy=e.getProxy(fe.ExtHostTreeViews)}async $registerTreeViewDataProvider(e,t){this.logService.trace("MainThreadTreeViews#$registerTreeViewDataProvider",e,t),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{const i=new Tve(e,this._proxy,this.notificationService);this._dataProviders.set(e,i);const n=t.hasHandleDrag||t.hasHandleDrop?new kve(e,t.dropMimeTypes,t.dragMimeTypes,t.hasHandleDrag,this._proxy):void 0,s=this.getTreeView(e);s?(s.showCollapseAllAction=t.showCollapseAll,s.canSelectMany=t.canSelectMany,s.manuallyManageCheckboxes=t.manuallyManageCheckboxes,s.dragAndDropController=n,n&&this._dndControllers.set(e,n),s.dataProvider=i,this.registerListeners(e,s),this._proxy.$setVisible(e,s.visible)):this.notificationService.error("No view is registered with id: "+e)})}$reveal(e,t,i){return this.logService.trace("MainThreadTreeViews#$reveal",e,t==null?void 0:t.item,t==null?void 0:t.parentChain,i),this.viewsService.openView(e,i.focus).then(()=>{const n=this.getTreeView(e);if(n&&t)return this.reveal(n,this._dataProviders.get(e),t.item,t.parentChain,i)})}$refresh(e,t){this.logService.trace("MainThreadTreeViews#$refresh",e,t);const i=this.getTreeView(e),n=this._dataProviders.get(e);if(i&&n){const s=n.getItemsToRefresh(t);return i.refresh(s.length?s:void 0)}return Promise.resolve()}$setMessage(e,t){this.logService.trace("MainThreadTreeViews#$setMessage",e,t);const i=this.getTreeView(e);i&&(i.message=t)}$setTitle(e,t,i){this.logService.trace("MainThreadTreeViews#$setTitle",e,t,i);const n=this.getTreeView(e);n&&(n.title=t,n.description=i)}$setBadge(e,t){this.logService.trace("MainThreadTreeViews#$setBadge",e,t==null?void 0:t.value,t==null?void 0:t.tooltip);const i=this.getTreeView(e);i&&(i.badge=t)}$resolveDropFileData(e,t,i){const n=this._dndControllers.get(e);if(!n)throw new Error("Unknown tree");return n.resolveDropFileData(t,i)}async $disposeTree(e){const t=this.getTreeView(e);t&&(t.dataProvider=void 0)}async reveal(e,t,i,n,s){s=s||{select:!1,focus:!1};const o=Wo(s.select)?!1:s.select,a=Wo(s.focus)?!1:s.focus;let c=Math.min(pr(s.expand)?s.expand:s.expand===!0?1:0,3);t.isEmpty()&&await e.refresh();for(const l of n){const u=t.getItem(l.handle);u&&await e.expand(u)}const d=t.getItem(i.handle);if(d){await e.reveal(d),o&&e.setSelection([d]),a===!1?e.setFocus():a&&e.setFocus(d);let l=[d];for(;l.length>0&&c>0;c--)await e.expand(l),l=l.reduce((u,h)=>{const g=t.getItem(h.handle);return g&&g.children&&g.children.length&&u.push(...g.children),u},[])}}registerListeners(e,t){this._register(t.onDidExpandItem(i=>this._proxy.$setExpanded(e,i.handle,!0))),this._register(t.onDidCollapseItem(i=>this._proxy.$setExpanded(e,i.handle,!1))),this._register(t.onDidChangeSelection(i=>this._proxy.$setSelection(e,i.map(({handle:n})=>n)))),this._register(t.onDidChangeFocus(i=>this._proxy.$setFocus(e,i.handle))),this._register(t.onDidChangeVisibility(i=>this._proxy.$setVisible(e,i))),this._register(t.onDidChangeCheckboxState(i=>{this._proxy.$changeCheckboxState(e,i.map(n=>{var s;return{treeItemHandle:n.handle,newState:((s=n.checkbox)==null?void 0:s.isChecked)??!1}}))}))}getTreeView(e){const t=st.as(Xo.ViewsRegistry).getView(e);return t?t.treeView:null}dispose(){this._dataProviders.forEach((e,t)=>{const i=this.getTreeView(t);i&&(i.dataProvider=void 0)}),this._dataProviders.clear(),this._dndControllers.clear(),super.dispose()}};AV=T([gt(ce.MainThreadTreeViews),v(1,ko),v(2,on),v(3,yr),v(4,ze)],AV);class kve{constructor(e,t,i,n,s){this.treeViewId=e,this.dropMimeTypes=t,this.dragMimeTypes=i,this.hasWillDrop=n,this._proxy=s,this.dataTransfersCache=new rW}async handleDrop(e,t,i,n,s,o){const a=this.dataTransfersCache.add(e);try{const c=await Qo.from(e);return i.isCancellationRequested?void 0:await this._proxy.$handleDrop(this.treeViewId,a.id,c,t==null?void 0:t.handle,i,n,s,o)}finally{a.dispose()}}async handleDrag(e,t,i){if(!this.hasWillDrop)return;const n=await this._proxy.$handleDrag(this.treeViewId,e,t,i);if(!n)return;const s=new vG;return n.items.forEach(([o,a])=>{s.replace(o,mG(a.asString))}),s}resolveDropFileData(e,t){return this.dataTransfersCache.resolveFileData(e,t)}}class Tve{constructor(e,t,i){this.treeViewId=e,this._proxy=t,this.notificationService=i,this.itemsMap=new Map,this.hasResolve=this._proxy.$hasResolve(this.treeViewId)}getChildren(e){return this._proxy.$getChildren(this.treeViewId,e?e.handle:void 0).then(t=>this.postGetChildren(t),t=>(oa.is(t)||this.notificationService.error(t),[]))}getItemsToRefresh(e){const t=[];if(e)for(const i of Object.keys(e)){const n=this.getItem(i);if(n){const s=e[i];if(this.updateTreeItem(n,s),i===s.handle)t.push(n);else{this.itemsMap.delete(i),this.itemsMap.set(n.handle,n);const o=s.parentHandle?this.itemsMap.get(s.parentHandle):null;o&&t.push(o)}}}return t}getItem(e){return this.itemsMap.get(e)}isEmpty(){return this.itemsMap.size===0}async postGetChildren(e){if(e===void 0)return;const t=[],i=await this.hasResolve;if(e)for(const n of e){const s=new PR(n,i?o=>this._proxy.$resolve(this.treeViewId,n.handle,o):void 0);this.itemsMap.set(n.handle,s),t.push(s)}return t}updateTreeItem(e,t){if(t.children=t.children?t.children:void 0,e){const i=Mf([...Object.keys(e instanceof PR?e.asTreeItem():e),...Object.keys(t)]);for(const n of i)e[n]=t[n];e instanceof PR&&e.resetResolve()}}}let MV=class extends ne{constructor(e,t){super(),this.downloadService=t}$download(e,t){return this.downloadService.download(k.revive(e),k.revive(t))}};MV=T([gt(ce.MainThreadDownloadService),v(1,N4)],MV);class Ive{constructor(e,t,i,n){this.proxy=e,this.handle=t,this.extensionId=i,this.extensionDisplayName=n}handleURL(e,t){return fn.equals(this.extensionId,e.authority)?Promise.resolve(this.proxy.$handleExternalUri(this.handle,e)).then(()=>!0):Promise.resolve(!1)}}let LV=class{constructor(e,t,i){this.urlService=t,this.extensionUrlHandler=i,this.handlers=new Map,this.proxy=e.getProxy(fe.ExtHostUrls)}$registerUriHandler(e,t,i){const n=new Ive(this.proxy,e,t,i),s=this.urlService.registerHandler(n);return this.handlers.set(e,{extensionId:t,disposable:s}),this.extensionUrlHandler.registerExtensionHandler(t,n),Promise.resolve(void 0)}$unregisterUriHandler(e){const t=this.handlers.get(e);if(!t)return Promise.resolve(void 0);const{extensionId:i,disposable:n}=t;return this.extensionUrlHandler.unregisterExtensionHandler(i),this.handlers.delete(e),n.dispose(),Promise.resolve(void 0)}async $createAppUri(e){return this.urlService.create(e)}dispose(){this.handlers.forEach(({disposable:e})=>e.dispose()),this.handlers.clear()}};LV=T([gt(ce.MainThreadUrls),v(1,k$),v(2,$4)],LV);let lD=class W8 extends ne{constructor(e,t){super(),this._extensionService=t,this._openers=new Map,this._memento=new Rn(W8.STORAGE_ID,e),this._mementoObject=this._memento.getMemento(0,1);for(const[i,n]of Object.entries(this._mementoObject||{}))this.add(i,n.extensionId,{isCurrentlyRegistered:!1});this.invalidateOpenersOnExtensionsChanged(),this._register(this._extensionService.onDidChangeExtensions(()=>this.invalidateOpenersOnExtensionsChanged())),this._register(this._extensionService.onDidChangeExtensionsStatus(()=>this.invalidateOpenersOnExtensionsChanged()))}didRegisterOpener(e,t){this.add(e,t,{isCurrentlyRegistered:!0})}add(e,t,i){const n=this._openers.get(e);if(n){n.isCurrentlyRegistered=n.isCurrentlyRegistered||i.isCurrentlyRegistered;return}const s={extensionId:t,isCurrentlyRegistered:i.isCurrentlyRegistered};this._openers.set(e,s),this._mementoObject[e]=s,this._memento.saveMemento(),this.updateSchema()}delete(e){this._openers.delete(e),delete this._mementoObject[e],this._memento.saveMemento(),this.updateSchema()}async invalidateOpenersOnExtensionsChanged(){await this._extensionService.whenInstalledExtensionsRegistered();const e=this._extensionService.extensions;for(const[t,i]of this._openers){const n=e.find(s=>s.identifier.value===i.extensionId);n?this._extensionService.canRemoveExtension(n)||i.isCurrentlyRegistered||this.delete(t):this.delete(t)}}updateSchema(){const e=[],t=[];for(const[i,n]of this._openers)e.push(i),t.push(n.extensionId);lue(e,t)}};lD.STORAGE_ID="externalUriOpeners";lD=T([v(0,ri),v(1,yr)],lD);let FV=class extends ne{constructor(e,t,i,n,s,o){super(),this.extensionService=n,this.openerService=s,this.notificationService=o,this._registeredOpeners=new Map,this.proxy=e.getProxy(fe.ExtHostUriOpeners),this._register(i.registerExternalOpenerProvider(this)),this._contributedExternalUriOpenersStore=this._register(new lD(t,n))}async*getOpeners(e){if(!(e.scheme!==pe.http&&e.scheme!==pe.https)){await this.extensionService.activateByEvent(`onOpenExternalUri:${e.scheme}`);for(const[t,i]of this._registeredOpeners)i.schemes.has(e.scheme)&&(yield this.createOpener(t,i))}}createOpener(e,t){return{id:e,label:t.label,canOpen:(i,n)=>this.proxy.$canOpenUri(e,i,n),openExternalUri:async(i,n,s)=>{try{await this.proxy.$openUri(e,{resolvedUri:i,sourceUri:n.sourceUri},s)}catch(o){if(!Ur(o)){const a=new Zn("default",p("openerFailedUseDefault","Open using default opener"),void 0,void 0,async()=>{await this.openerService.open(i,{allowTunneling:!1,allowContributedOpeners:Cy})});a.tooltip=i.toString(),this.notificationService.notify({severity:wn.Error,message:p({key:"openerFailedMessage",comment:["{0} is the id of the opener. {1} is the url being opened."]},"Could not open uri with '{0}': {1}",e,o.toString()),actions:{primary:[a]}})}}return!0}}}async $registerUriOpener(e,t,i,n){if(this._registeredOpeners.has(e))throw new Error(`Opener with id '${e}' already registered`);this._registeredOpeners.set(e,{schemes:new Set(t),label:n,extensionId:i}),this._contributedExternalUriOpenersStore.didRegisterOpener(e,i.value)}async $unregisterUriOpener(e){this._registeredOpeners.delete(e),this._contributedExternalUriOpenersStore.delete(e)}dispose(){super.dispose(),this._registeredOpeners.clear()}};FV=T([gt(ce.MainThreadUriOpeners),v(1,ri),v(2,P4),v(3,yr),v(4,us),v(5,on)],FV);let OV=class{constructor(e,t,i,n){this.hostService=t,this.openerService=i,this.userActivityService=n,this.disposables=new me,this.proxy=e.getProxy(fe.ExtHostWindow),F.latch(t.onDidChangeFocus)(this.proxy.$onDidChangeWindowFocus,this.proxy,this.disposables),n.onDidChangeIsActive(this.proxy.$onDidChangeWindowActive,this.proxy,this.disposables)}dispose(){this.disposables.dispose()}$getInitialState(){return Promise.resolve({isFocused:this.hostService.hasFocus,isActive:this.userActivityService.isActive})}async $openUri(e,t,i){const n=k.from(e);let s;return t&&k.parse(t).toString()===n.toString()?s=t:s=n,this.openerService.open(s,{openExternal:!0,allowTunneling:i.allowTunneling,allowContributedOpeners:i.allowContributedOpeners})}async $asExternalUri(e,t){return(await this.openerService.resolveExternalUri(k.revive(e),t)).resolved}};OV=T([gt(ce.MainThreadWindow),v(1,bu),v(2,us),v(3,E4)],OV);let KF=class H8 extends ne{static async create(e,t,i){return e.invokeFunction(async n=>{const o=await n.get(or).createModelReference(i);return e.createInstance(H8,t,i,o)})}constructor(e,t,i,n){super(),this.viewType=e,this._resource=t,this._model=i,this.textFileService=n,this._onDidChangeOrphaned=this._register(new A),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this._onDidChangeReadonly=this._register(new A),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this._onDidChangeDirty=this._register(new A),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeContent=this._register(new A),this.onDidChangeContent=this._onDidChangeContent.event,this._register(i),this._textFileModel=this.textFileService.files.get(t),this._textFileModel&&(this._register(this._textFileModel.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire())),this._register(this._textFileModel.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))),this._register(this.textFileService.files.onDidChangeDirty(s=>{si(this.resource,s.resource)&&(this._onDidChangeDirty.fire(),this._onDidChangeContent.fire())}))}get resource(){return this._resource}isReadonly(){return this._model.object.isReadonly()}get backupId(){}isDirty(){return this.textFileService.isDirty(this.resource)}isOrphaned(){var e;return!!((e=this._textFileModel)!=null&&e.hasState(4))}async revert(e){return this.textFileService.revert(this.resource,e)}saveCustomEditor(e){return this.textFileService.save(this.resource,e)}async saveCustomEditorAs(e,t,i){return!!await this.textFileService.saveAs(e,t,i)}};KF=T([v(3,Dn)],KF);let QF=class extends ne{constructor(e,t){super(),this.resource=e,this.fileService=t,this._onDidChangeOrphaned=this._register(new A),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this.orphaned=!1,this._onWillDispose=this._register(new A),this.onWillDispose=this._onWillDispose.event,this.disposed=!1,this._register(this.fileService.onDidFilesChange(i=>this.onDidFilesChange(i)))}isOrphaned(){return this.orphaned}async onDidFilesChange(e){let t=!1,i;if(this.orphaned?e.contains(this.resource,1)&&(i=!1,t=!0):e.contains(this.resource,2)&&(i=!0,t=!0),t&&this.orphaned!==i){let n=!1;i&&(await zs(100),this.isDisposed()?n=!0:n=!await this.fileService.exists(this.resource)),this.orphaned!==n&&!this.isDisposed()&&this.setOrphaned(n)}}setOrphaned(e){this.orphaned!==e&&(this.orphaned=e,this._onDidChangeOrphaned.fire())}isDisposed(){return this.disposed}dispose(){this.disposed=!0,this.orphaned=!1,this._onWillDispose.fire(),super.dispose()}isModified(){return this.isDirty()}};QF=T([v(1,at)],QF);let YF=class extends ne{constructor(e,t,i,n,s,o,a,c,d,l,u,h){super(),this.mainThreadWebview=t,this.mainThreadWebviewPanels=i,this._customEditorService=c,this._editorGroupService=d,this._editorService=l,this._instantiationService=u,this._webviewWorkbenchService=h,this._editorProviders=this._register(new mr),this._editorRenameBackups=new Map,this._webviewOriginStore=new qE("mainThreadCustomEditors.origins",s),this._proxyCustomEditors=e.getProxy(fe.ExtHostCustomEditors),this._register(a.registerWorkingCopyProvider(g=>{const m=[];for(const y of o.workingCopies)y instanceof eg&&Ff(g,y.editorResource)&&m.push(y);return m})),this._register(h.registerResolver({canResolve:g=>(g instanceof Gh&&n.activateByEvent(`onCustomEditor:${g.viewType}`),!1),resolveWebview:()=>{throw new Error("not implemented")}})),this._register(a.onWillRunWorkingCopyFileOperation(async g=>this.onWillRunWorkingCopyFileOperation(g)))}$registerTextEditorProvider(e,t,i,n,s){this.registerEditorProvider(1,Yx(e),t,i,n,!0,s)}$registerCustomEditorProvider(e,t,i,n,s){this.registerEditorProvider(0,Yx(e),t,i,{},n,s)}registerEditorProvider(e,t,i,n,s,o,a){if(this._editorProviders.has(i))throw new Error(`Provider for ${i} already registered`);const c=new me;c.add(this._customEditorService.registerCustomEditorCapabilities(i,{supportsMultipleEditorsPerDocument:o})),c.add(this._webviewWorkbenchService.registerResolver({canResolve:d=>d instanceof Gh&&d.viewType===i,resolveWebview:async(d,l)=>{const u=Nn(),h=d.resource;d.webview.origin=this._webviewOriginStore.getOrigin(i,t.id),this.mainThreadWebviewPanels.addWebviewInput(u,d,{serializeBuffersForPostMessage:a}),d.webview.options=n,d.webview.extension=t;let g=d.backupId;if(d.oldResource&&!d.backupId){const y=this._editorRenameBackups.get(d.oldResource.toString());g=y==null?void 0:y.backupId,this._editorRenameBackups.delete(d.oldResource.toString())}let m;try{m=await this.getOrCreateCustomEditorModel(e,h,i,{backupId:g},l)}catch(y){en(y),d.webview.setHtml(this.mainThreadWebview.getWebviewResolvedFailedContent(i));return}if(l.isCancellationRequested){m.dispose();return}d.webview.onDidDispose(()=>{if(m.object.isDirty()){const y=m.object.onDidChangeDirty(()=>{m.object.isDirty()||(y.dispose(),m.dispose())});return}m.dispose()}),s.supportsMove&&d.onMove(async y=>{const _=m;m=await this.getOrCreateCustomEditorModel(e,y,i,{},_t.None),this._proxyCustomEditors.$onMoveCustomEditor(u,y,i),_.dispose()});try{await this._proxyCustomEditors.$resolveCustomEditor(h,u,i,{title:d.getTitle(),contentOptions:d.webview.contentOptions,options:d.webview.options,active:d===this._editorService.activeEditor},gu(this._editorGroupService,d.group||0),l)}catch(y){en(y),d.webview.setHtml(this.mainThreadWebview.getWebviewResolvedFailedContent(i)),m.dispose();return}}})),this._editorProviders.set(i,c)}$unregisterEditorProvider(e){if(!this._editorProviders.has(e))throw new Error(`No provider for ${e} registered`);this._editorProviders.deleteAndDispose(e),this._customEditorService.models.disposeAllModelsForView(e)}async getOrCreateCustomEditorModel(e,t,i,n,s){const o=this._customEditorService.models.tryRetain(t,i);if(o)return o;switch(e){case 1:{const a=KF.create(this._instantiationService,i,t);return this._customEditorService.models.add(t,i,a)}case 0:{const a=eg.create(this._instantiationService,this._proxyCustomEditors,i,t,n,()=>Array.from(this.mainThreadWebviewPanels.webviewInputs).filter(c=>c instanceof Gh&&si(c.resource,t)),s);return this._customEditorService.models.add(t,i,a)}}}async $onDidEdit(e,t,i,n){(await this.getCustomEditorModel(e,t)).pushEdit(i,n)}async $onContentChange(e,t){(await this.getCustomEditorModel(e,t)).changeContent()}async getCustomEditorModel(e,t){const i=k.revive(e),n=await this._customEditorService.models.get(i,t);if(!n||!(n instanceof eg))throw new Error("Could not find model for webview editor");return n}async onWillRunWorkingCopyFileOperation(e){e.operation===2&&e.waitUntil((async()=>{const t=[];for(const i of e.files)i.source&&t.push(...await this._customEditorService.models.getAllModels(i.source));for(const i of t)if(i instanceof eg&&i.isDirty()){const n=await i.backup(_t.None);n.meta&&this._editorRenameBackups.set(i.editorResource.toString(),n.meta)}})())}};YF=T([v(3,yr),v(4,ri),v(5,Od),v(6,$a),v(7,x$),v(8,it),v(9,Ke),v(10,Te),v(11,ub)],YF);var ih;(function(r){(function(t){t[t.Allowed=0]="Allowed",t[t.NotAllowed=1]="NotAllowed",t[t.Pending=2]="Pending"})(r.Type||(r.Type={})),r.Allowed=Object.freeze({type:0}),r.NotAllowed=Object.freeze({type:1});class e{constructor(i){this.operation=i,this.type=2}}r.Pending=e})(ih||(ih={}));let eg=class XF extends QF{static async create(e,t,i,n,s,o,a){const c=o();let d;c.length!==0&&(d=c[0].untitledDocumentData);const{editable:l}=await t.$createCustomDocument(n,i,s.backupId,d,a);return e.createInstance(XF,t,i,n,!!s.backupId,l,!!d,o)}constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y){super(XF.toWorkingCopyResource(t,i),d),this._proxy=e,this._viewType=t,this._editorResource=i,this._editable=s,this._getEditors=a,this._fileDialogService=c,this._labelService=l,this._undoService=u,this._environmentService=h,this._pathService=m,this._fromBackup=!1,this._hotExitState=ih.Allowed,this._currentEditIndex=-1,this._savePoint=-1,this._edits=[],this._isDirtyFromContentChange=!1,this.typeId=HT,this._onDidChangeDirty=this._register(new A),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeContent=this._register(new A),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidSave=this._register(new A),this.onDidSave=this._onDidSave.event,this.onDidChangeReadonly=F.None,this._fromBackup=n,s&&(this._register(g.registerWorkingCopy(this)),this._register(y.onWillStop(_=>{this.isDirty()&&_.veto((async()=>!await this.save())(),p("vetoExtHostRestart","Custom editor '{0}' could not be saved.",this.name))}))),o&&(this._isDirtyFromContentChange=!0)}get editorResource(){return this._editorResource}dispose(){this._editable&&this._undoService.removeElements(this._editorResource),this._proxy.$disposeCustomDocument(this._editorResource,this._viewType),super.dispose()}static toWorkingCopyResource(e,t){const i=e.replace(/[^a-z0-9\-_]/gi,"-"),n=`/${t_(t.with({query:null,fragment:null}).toString(!0))}`;return k.from({scheme:pe.vscodeCustomEditor,authority:i,path:n,query:JSON.stringify(t.toJSON())})}get name(){return Yn(this._labelService.getUriLabel(this._editorResource))}get capabilities(){return this.isUntitled()?2:0}isDirty(){return this._isDirtyFromContentChange?!0:this._edits.length>0?this._savePoint!==this._currentEditIndex:this._fromBackup}isUntitled(){return this._editorResource.scheme===pe.untitled}isReadonly(){return!this._editable}get viewType(){return this._viewType}get backupId(){return this._backupId}pushEdit(e,t){if(!this._editable)throw new Error("Document is not editable");this.change(()=>{this.spliceEdits(e),this._currentEditIndex=this._edits.length-1}),this._undoService.pushElement({type:0,resource:this._editorResource,label:t??p("defaultEditLabel","Edit"),code:"undoredo.customEditorEdit",undo:()=>this.undo(),redo:()=>this.redo()})}changeContent(){this.change(()=>{this._isDirtyFromContentChange=!0})}async undo(){if(!this._editable||this._currentEditIndex<0)return;const e=this._edits[this._currentEditIndex];this.change(()=>{--this._currentEditIndex}),await this._proxy.$undo(this._editorResource,this.viewType,e,this.isDirty())}async redo(){if(!this._editable||this._currentEditIndex>=this._edits.length-1)return;const e=this._edits[this._currentEditIndex+1];this.change(()=>{++this._currentEditIndex}),await this._proxy.$redo(this._editorResource,this.viewType,e,this.isDirty())}spliceEdits(e){const t=this._currentEditIndex+1,i=this._edits.length-this._currentEditIndex,n=typeof e=="number"?this._edits.splice(t,i,e):this._edits.splice(t,i);n.length&&this._proxy.$disposeEdits(this._editorResource,this._viewType,n)}change(e){const t=this.isDirty();e(),this._onDidChangeContent.fire(),this.isDirty()!==t&&this._onDidChangeDirty.fire()}async revert(e){this._editable&&(this._currentEditIndex===this._savePoint&&!this._isDirtyFromContentChange&&!this._fromBackup||(e!=null&&e.soft||this._proxy.$revert(this._editorResource,this.viewType,_t.None),this.change(()=>{this._isDirtyFromContentChange=!1,this._fromBackup=!1,this._currentEditIndex=this._savePoint,this.spliceEdits()})))}async save(e){const t=!!await this.saveCustomEditor(e);return t&&this._onDidSave.fire({reason:e==null?void 0:e.reason,source:e==null?void 0:e.source}),t}async saveCustomEditor(e){var i;if(!this._editable)return;if(this.isUntitled()){const n=await this.suggestUntitledSavePath(e);return n?(await this.saveCustomEditorAs(this._editorResource,n,e),n):void 0}const t=cd(n=>this._proxy.$onSave(this._editorResource,this.viewType,n));(i=this._ongoingSave)==null||i.cancel(),this._ongoingSave=t;try{await t,this._ongoingSave===t&&this.change(()=>{this._isDirtyFromContentChange=!1,this._savePoint=this._currentEditIndex,this._fromBackup=!1})}finally{this._ongoingSave===t&&(this._ongoingSave=void 0)}return this._editorResource}suggestUntitledSavePath(e){if(!this.isUntitled())throw new Error("Resource is not untitled");const t=this._environmentService.remoteAuthority,i=zy(this._editorResource,t,this._pathService.defaultUriScheme);return this._fileDialogService.pickFileToSave(i,e==null?void 0:e.availableFileSystems)}async saveCustomEditorAs(e,t,i){return this._editable?(await cd(n=>this._proxy.$onSaveAs(this._editorResource,this.viewType,t,n)),this.change(()=>{this._savePoint=this._currentEditIndex}),!0):(await this.fileService.copy(e,t,!1),!0)}async backup(e){const t=this._getEditors();if(!t.length)throw new Error("No editors found for resource, cannot back up");const i=t[0],s={meta:{viewType:this.viewType,editorResource:this._editorResource,backupId:"",extension:i.extension?{id:i.extension.id.value,location:i.extension.location}:void 0,webview:{origin:i.webview.origin,options:i.webview.options,state:i.webview.state}}};if(!this._editable)return s;this._hotExitState.type===2&&this._hotExitState.operation.cancel();const o=new ih.Pending(cd(c=>this._proxy.$backup(this._editorResource.toJSON(),this.viewType,c)));this._hotExitState=o,e.onCancellationRequested(()=>{o.operation.cancel()});let a="";try{const c=await o.operation;this._hotExitState===o&&(this._hotExitState=ih.Allowed,s.meta.backupId=c,this._backupId=c)}catch(c){if(Ur(c))throw c;this._hotExitState===o&&(this._hotExitState=ih.NotAllowed),c.message&&(a=c.message)}if(this._hotExitState===ih.Allowed)return s;throw new Error(`Cannot back up in this state: ${a}`)}};eg=T([v(7,ia),v(8,at),v(9,Qi),v(10,o1),v(11,Ar),v(12,Od),v(13,ta),v(14,yr)],eg);class Rve{constructor(){this._handlesToInputs=new Map,this._inputsToHandles=new Map}add(e,t){this._handlesToInputs.set(e,t),this._inputsToHandles.set(t,e)}getHandleForInput(e){return this._inputsToHandles.get(e)}getInputForHandle(e){return this._handlesToInputs.get(e)}delete(e){const t=this.getInputForHandle(e);this._handlesToInputs.delete(e),t&&this._inputsToHandles.delete(t)}get size(){return this._handlesToInputs.size}[Symbol.iterator](){return this._handlesToInputs.values()}}class Pve{constructor(e){this.prefix=e}fromExternal(e){return this.prefix+e}toExternal(e){return e.startsWith(this.prefix)?e.substr(this.prefix.length):void 0}}let JF=class extends ne{constructor(e,t,i,n,s,o,a,c,d){super(),this._mainThreadWebviews=t,this._configurationService=i,this._editorGroupService=n,this._editorService=s,this._telemetryService=c,this._webviewWorkbenchService=d,this.webviewPanelViewType=new Pve("mainThreadWebview-"),this._webviewInputs=new Rve,this._revivers=this._register(new mr),this.webviewOriginStore=new qE("mainThreadWebviewPanel.origins",a),this._proxy=e.getProxy(fe.ExtHostWebviewPanels),this._register(F.any(s.onDidActiveEditorChange,s.onDidVisibleEditorsChange,n.onDidAddGroup,n.onDidRemoveGroup,n.onDidMoveGroup)(()=>{this.updateWebviewViewStates(this._editorService.activeEditor)})),this._register(d.onDidChangeActiveWebviewEditor(l=>{this.updateWebviewViewStates(l)})),this._register(d.registerResolver({canResolve:l=>{const u=this.webviewPanelViewType.toExternal(l.viewType);return typeof u=="string"&&o.activateByEvent(`onWebviewPanel:${u}`),!1},resolveWebview:()=>{throw new Error("not implemented")}}))}get webviewInputs(){return this._webviewInputs}addWebviewInput(e,t,i){this._webviewInputs.add(e,t),this._mainThreadWebviews.addWebview(e,t.webview,i),t.webview.onDidDispose(()=>{this._proxy.$onDidDisposeWebviewPanel(e).finally(()=>{this._webviewInputs.delete(e)})})}$createWebviewPanel(e,t,i,n,s){const o=this.getTargetGroupFromShowOptions(s),a=s?{preserveFocus:!!s.preserveFocus,group:o}:{},c=Yx(e),d=this.webviewOriginStore.getOrigin(i,c.id),l=this._webviewWorkbenchService.openWebview({origin:d,providedViewType:i,title:n.title,options:Mve(n.panelOptions),contentOptions:Xx(n.webviewOptions),extension:c},this.webviewPanelViewType.fromExternal(i),n.title,a);this.addWebviewInput(t,l,{serializeBuffersForPostMessage:n.serializeBuffersForPostMessage});const u={extensionId:c.id.value,viewType:i};this._telemetryService.publicLog2("webviews:createWebviewPanel",u)}$disposeWebview(e){const t=this.tryGetWebviewInput(e);t&&t.dispose()}$setTitle(e,t){var i;(i=this.tryGetWebviewInput(e))==null||i.setName(t)}$setIconPath(e,t){const i=this.tryGetWebviewInput(e);i&&(i.iconPath=Ave(t))}$reveal(e,t){const i=this.tryGetWebviewInput(e);if(!i||i.isDisposed())return;const n=this.getTargetGroupFromShowOptions(t);this._webviewWorkbenchService.revealWebview(i,n,!!t.preserveFocus)}getTargetGroupFromShowOptions(e){if(typeof e.viewColumn>"u"||e.viewColumn===Vl||this._editorGroupService.count===1&&this._editorGroupService.activeGroup.isEmpty)return Vl;if(e.viewColumn===Ed)return Ed;if(e.viewColumn>=0){const t=this._editorGroupService.getGroups(2)[e.viewColumn];if(t)return t.id;const i=this._editorGroupService.findGroup({location:1});if(i){const n=Vf(this._configurationService);return this._editorGroupService.addGroup(i,n)}}return Vl}$registerSerializer(e,t){if(this._revivers.has(e))throw new Error(`Reviver for ${e} already registered`);this._revivers.set(e,this._webviewWorkbenchService.registerResolver({canResolve:i=>i.viewType===this.webviewPanelViewType.fromExternal(e),resolveWebview:async i=>{const n=this.webviewPanelViewType.toExternal(i.viewType);if(!n){i.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(i.viewType));return}const s=Nn();this.addWebviewInput(s,i,t);let o;if(i.webview.state)try{o=JSON.parse(i.webview.state)}catch(a){console.error("Could not load webview state",a,i.webview.state)}try{await this._proxy.$deserializeWebviewPanel(s,n,{title:i.getTitle(),state:o,panelOptions:i.webview.options,webviewOptions:i.webview.contentOptions,active:i===this._editorService.activeEditor},gu(this._editorGroupService,i.group||0))}catch(a){en(a),i.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(n))}}}))}$unregisterSerializer(e){if(!this._revivers.has(e))throw new Error(`No reviver for ${e} registered`);this._revivers.deleteAndDispose(e)}updateWebviewViewStates(e){if(!this._webviewInputs.size)return;const t={},i=(n,s,o)=>{if(!(o instanceof qs))return;o.updateGroup(n.id);const a=this._webviewInputs.getHandleForInput(o);a&&(t[a]={visible:s===n.activeEditor,active:o===e,position:gu(this._editorGroupService,n.id)})};for(const n of this._editorGroupService.groups)for(const s of n.editors)s instanceof Ss?(i(n,s,s.primary),i(n,s,s.secondary)):i(n,s,s);Object.keys(t).length&&this._proxy.$onDidChangeWebviewPanelViewStates(t)}tryGetWebviewInput(e){return this._webviewInputs.getInputForHandle(e)}};JF=T([v(2,We),v(3,it),v(4,Ke),v(5,yr),v(6,ri),v(7,gi),v(8,ub)],JF);function Ave(r){if(r)return{light:k.revive(r.light),dark:k.revive(r.dark)}}function Mve(r){return{enableFindWidget:r.enableFindWidget,retainContextWhenHidden:r.retainContextWhenHidden}}let ZF=class extends ne{constructor(e,t,i,n){super(),this.mainThreadWebviews=t,this._telemetryService=i,this._webviewViewService=n,this._webviewViews=this._register(new mr),this._webviewViewProviders=this._register(new mr),this._proxy=e.getProxy(fe.ExtHostWebviewViews)}$setWebviewViewTitle(e,t){const i=this.getWebviewView(e);i.title=t}$setWebviewViewDescription(e,t){const i=this.getWebviewView(e);i.description=t}$setWebviewViewBadge(e,t){const i=this.getWebviewView(e);i.badge=t}$show(e,t){this.getWebviewView(e).show(t)}$registerWebviewViewProvider(e,t,i){if(this._webviewViewProviders.has(t))throw new Error(`View provider for ${t} already registered`);const n=Yx(e),s=this._webviewViewService.register(t,{resolve:async(o,a)=>{const c=Nn();this._webviewViews.set(c,o),this.mainThreadWebviews.addWebview(c,o.webview,{serializeBuffersForPostMessage:i.serializeBuffersForPostMessage});let d;if(o.webview.state)try{d=JSON.parse(o.webview.state)}catch(l){console.error("Could not load webview state",l,o.webview.state)}o.webview.extension=n,i&&(o.webview.options=i),o.onDidChangeVisibility(l=>{this._proxy.$onDidChangeWebviewViewVisibility(c,l)}),o.onDispose(()=>{this._proxy.$disposeWebviewView(c),this._webviewViews.deleteAndDispose(c)}),this._telemetryService.publicLog2("webviews:createWebviewView",{extensionId:n.id.value,id:t});try{await this._proxy.$resolveWebviewView(c,t,o.title,d,a)}catch(l){en(l),o.webview.setHtml(this.mainThreadWebviews.getWebviewResolvedFailedContent(t))}}});this._webviewViewProviders.set(t,s)}$unregisterWebviewViewProvider(e){if(!this._webviewViewProviders.has(e))throw new Error(`No view provider for ${e} registered`);this._webviewViewProviders.deleteAndDispose(e)}getWebviewView(e){const t=this._webviewViews.get(e);if(!t)throw new Error("unknown webview view");return t}};ZF=T([v(2,gi),v(3,R4)],ZF);let NV=class extends ne{constructor(e,t){super();const i=this._register(t.createInstance(Qx,e));e.set(ce.MainThreadWebviews,i);const n=this._register(t.createInstance(JF,e,i));e.set(ce.MainThreadWebviewPanels,n);const s=this._register(t.createInstance(YF,e,i,n));e.set(ce.MainThreadCustomEditors,s);const o=this._register(t.createInstance(ZF,e,i));e.set(ce.MainThreadWebviewViews,o)}};NV=T([Eu,v(1,Te)],NV);let $V=class{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y){this._searchService=t,this._contextService=i,this._editSessionIdentityService=n,this._canonicalUriService=s,this._editorService=o,this._workspaceEditingService=a,this._notificationService=c,this._requestService=d,this._instantiationService=l,this._labelService=u,this._environmentService=h,this._workspaceTrustManagementService=m,this._workspaceTrustRequestService=y,this._toDispose=new me,this._activeCancelTokens=Object.create(null),this._queryBuilder=this._instantiationService.createInstance(rx),this.registeredEditSessionProviders=new Map,this.registeredCanonicalUriProviders=new Map,this._proxy=e.getProxy(fe.ExtHostWorkspace);const _=this._contextService.getWorkspace();_.configuration&&!d1&&!g.hasProvider(_.configuration)?this._proxy.$initializeWorkspace(this.getWorkspaceData(_),this.isWorkspaceTrusted()):this._contextService.getCompleteWorkspace().then(b=>this._proxy.$initializeWorkspace(this.getWorkspaceData(b),this.isWorkspaceTrusted())),this._contextService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspace,this,this._toDispose),this._contextService.onDidChangeWorkbenchState(this._onDidChangeWorkspace,this,this._toDispose),this._workspaceTrustManagementService.onDidChangeTrust(this._onDidGrantWorkspaceTrust,this,this._toDispose)}dispose(){this._toDispose.dispose();for(const e in this._activeCancelTokens)this._activeCancelTokens[e].cancel()}$updateWorkspaceFolders(e,t,i,n){const s=n.map(o=>({uri:k.revive(o.uri),name:o.name}));return this._notificationService.status(this.getStatusMessage(e,s.length,i),{hideAfter:10*1e3}),this._workspaceEditingService.updateFolders(t,i,s,!0)}getStatusMessage(e,t,i){let n;const s=t>0,o=i>0;return s&&!o?t===1?n=p("folderStatusMessageAddSingleFolder","Extension '{0}' added 1 folder to the workspace",e):n=p("folderStatusMessageAddMultipleFolders","Extension '{0}' added {1} folders to the workspace",e,t):o&&!s?i===1?n=p("folderStatusMessageRemoveSingleFolder","Extension '{0}' removed 1 folder from the workspace",e):n=p("folderStatusMessageRemoveMultipleFolders","Extension '{0}' removed {1} folders from the workspace",e,i):n=p("folderStatusChangeFolder","Extension '{0}' changed folders of the workspace",e),n}_onDidChangeWorkspace(){this._proxy.$acceptWorkspaceData(this.getWorkspaceData(this._contextService.getWorkspace()))}getWorkspaceData(e){return this._contextService.getWorkbenchState()===1?null:{configuration:e.configuration||void 0,isUntitled:e.configuration?Q7(e.configuration,this._environmentService):!1,folders:e.folders,id:e.id,name:this._labelService.getWorkspaceLabel(e),transient:e.transient}}$startFileSearch(e,t,i,n,s){const o=k.revive(t),a=this._contextService.getWorkspace(),c=this._queryBuilder.file(o?[o]:a.folders,{maxResults:ii(n),disregardExcludeSettings:i===!1||void 0,disregardSearchExcludeSettings:!0,disregardIgnoreFiles:!0,includePattern:ii(e),excludePattern:typeof i=="string"?i:void 0,_reason:"startFileSearch"});return this._searchService.fileSearch(c,s).then(d=>d.results.map(l=>l.resource),d=>Ur(d)?null:Promise.reject(d))}$startTextSearch(e,t,i,n,s){const o=k.revive(t),a=this._contextService.getWorkspace(),c=o?[o]:a.folders.map(h=>h.uri),d=this._queryBuilder.text(e,c,i);d._reason="startTextSearch";const l=h=>{h.results&&this._proxy.$handleTextSearchResult(h,n)};return this._searchService.textSearch(d,s,l).then(h=>({limitHit:h.limitHit}),h=>Ur(h)?null:Promise.reject(h))}$checkExists(e,t,i){return this._instantiationService.invokeFunction(n=>l5(n,e,t,i))}async $save(e,t){const i=k.revive(e),n=[...this._editorService.findEditors(i,{supportSideBySide:Ui.PRIMARY})],s=await this._editorService.save(n,{reason:1,saveAs:t.saveAs,force:!t.saveAs});return Zh(this._saveResultToUris(s))}_saveResultToUris(e){return e.success?fi(e.editors.map(t=>Vn.getCanonicalUri(t,{supportSideBySide:Ui.PRIMARY}))):[]}$saveAll(e){return this._editorService.saveAll({includeUntitled:e}).then(t=>t.success)}$resolveProxy(e){return this._requestService.resolveProxy(e)}$requestWorkspaceTrust(e){return this._workspaceTrustRequestService.requestWorkspaceTrust(e)}isWorkspaceTrusted(){return this._workspaceTrustManagementService.isWorkspaceTrusted()}_onDidGrantWorkspaceTrust(){this._proxy.$onDidGrantWorkspaceTrust()}$registerEditSessionIdentityProvider(e,t){const i=this._editSessionIdentityService.registerEditSessionIdentityProvider({scheme:t,getEditSessionIdentifier:async(n,s)=>this._proxy.$getEditSessionIdentifier(n.uri,s),provideEditSessionIdentityMatch:async(n,s,o,a)=>this._proxy.$provideEditSessionIdentityMatch(n.uri,s,o,a)});this.registeredEditSessionProviders.set(e,i),this._toDispose.add(i)}$unregisterEditSessionIdentityProvider(e){const t=this.registeredEditSessionProviders.get(e);t==null||t.dispose(),this.registeredEditSessionProviders.delete(e)}$registerCanonicalUriProvider(e,t){const i=this._canonicalUriService.registerCanonicalUriProvider({scheme:t,provideCanonicalUri:async(n,s,o)=>{const a=await this._proxy.$provideCanonicalUri(n,s,o);return a&&k.revive(a)}});this.registeredCanonicalUriProviders.set(e,i),this._toDispose.add(i)}$unregisterCanonicalUriProvider(e){const t=this.registeredCanonicalUriProviders.get(e);t==null||t.dispose(),this.registeredCanonicalUriProviders.delete(e)}};$V=T([gt(ce.MainThreadWorkspace),v(1,cb),v(2,oi),v(3,X1),v(4,x4),v(5,Ke),v(6,Zm),v(7,on),v(8,P3),v(9,Te),v(10,Qi),v(11,ls),v(12,at),v(13,Y7),v(14,Oq)],$V);var Lve=".comments-panel .comments-panel-container{height:100%}.comments-panel .comments-panel-container .hidden{display:none}.comments-panel .comments-panel-container .tree-container{height:100%}.comments-panel .comments-panel-container .tree-container.hidden{display:none;visibility:hidden}.comments-panel .comments-panel-container .tree-container .comment-thread-container{display:block}.comments-panel .comments-panel-container .tree-container .comment-thread-container div{overflow:hidden}.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-metadata-container,.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-snippet-container,.comments-panel .comments-panel-container .tree-container .resource-container{display:flex;overflow:hidden;text-overflow:ellipsis}.comments-panel .count,.comments-panel .user{padding-right:5px}.comments-panel .comments-panel-container .tree-container .comment-thread-container .icon{min-width:fit-content;padding-right:5px;padding-top:4px}.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-metadata-container .user,.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-snippet-container .count{min-width:fit-content}.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-snippet-container .text{display:flex;flex:1;min-width:0}.comments-panel .comments-panel-container .tree-container .comment-thread-container .reply-detail,.comments-panel .comments-panel-container .tree-container .comment-thread-container .timestamp{display:block;font-size:.9em;opacity:.8;overflow:hidden;padding-right:5px;text-overflow:ellipsis}.comments-panel .comments-panel-container .tree-container .comment-thread-container .text *{margin:0;max-width:500px;overflow:hidden;padding-right:5px;text-overflow:ellipsis}.comments-panel .comments-panel-container .tree-container .comment-thread-container .range{opacity:.8}.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-snippet-container .text code{font-family:var(--monaco-monospace-font)}.comments-panel .comments-panel-container .tree-container .comment-thread-container .separator{opacity:.8;padding-right:5px}.comments-panel .comments-panel-container .message-box-container{height:inherit;line-height:22px;padding-left:20px}.comments-panel .comments-panel-container .tree-container .count-badge-wrapper{margin-left:10px}.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-metadata-container,.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-snippet-container{line-height:22px;margin-right:5px}.comments-panel .comments-panel-container .tree-container .comment-thread-container .comment-snippet-container{padding-left:16px}.comments-panel .hide{display:none}";Ic(Lve,{});let Rm=class{constructor(e,t,i,n,s,o){this.replies=[],this.owner=e,this.threadId=t,this.comment=n,this.resource=i,this.range=s,this.isRoot=!1,this.threadState=o}hasReply(){return this.replies&&this.replies.length!==0}};class kr{constructor(e,t,i){this.owner=e,this.id=t.toString(),this.resource=t,this.commentThreads=i.filter(n=>n.comments&&n.comments.length).map(n=>kr.createCommentNode(e,t,n))}static createCommentNode(e,t,i){const{threadId:n,comments:s,range:o}=i,a=s.map(c=>new Rm(e,n,t,c,o,i.state));return a.length>1&&(a[0].replies=a.slice(1,a.length)),a[0].isRoot=!0,a[0]}}class Pm{constructor(){this.resourceCommentThreads=[],this.commentThreadsMap=new Map}updateResourceCommentThreads(){this.resourceCommentThreads=[...this.commentThreadsMap.values()].flat(),this.resourceCommentThreads.sort((e,t)=>e.resource.toString()>t.resource.toString()?1:-1)}setCommentThreads(e,t){this.commentThreadsMap.set(e,this.groupByResource(e,t)),this.updateResourceCommentThreads()}deleteCommentsByOwner(e){e?this.commentThreadsMap.set(e,[]):this.commentThreadsMap.clear(),this.updateResourceCommentThreads()}updateCommentThreads(e){const{owner:t,removed:i,changed:n,added:s}=e,o=this.commentThreadsMap.get(t)||[];return i.forEach(a=>{const c=o.findIndex(u=>u.id===a.resource),d=c>=0?o[c]:void 0,l=(d==null?void 0:d.commentThreads.findIndex(u=>u.threadId===a.threadId))??0;l>=0&&(d==null||d.commentThreads.splice(l,1)),(d==null?void 0:d.commentThreads.length)===0&&o.splice(c,1)}),n.forEach(a=>{const c=o.findIndex(u=>u.id===a.resource),d=o[c],l=d.commentThreads.findIndex(u=>u.threadId===a.threadId);l>=0?d.commentThreads[l]=kr.createCommentNode(t,k.parse(d.id),a):a.comments&&a.comments.length&&d.commentThreads.push(kr.createCommentNode(t,k.parse(d.id),a))}),s.forEach(a=>{const c=o.filter(d=>d.resource.toString()===a.resource);if(c.length){const d=c[0];a.comments&&a.comments.length&&d.commentThreads.push(kr.createCommentNode(t,d.resource,a))}else o.push(new kr(t,k.parse(a.resource),[a]))}),this.commentThreadsMap.set(t,o),this.updateResourceCommentThreads(),i.length>0||n.length>0||s.length>0}hasCommentThreads(){return!!this.resourceCommentThreads.length}getMessage(){return this.resourceCommentThreads.length?"":p("noComments","There are no comments in this workspace yet.")}groupByResource(e,t){const i=[],n=new Map;for(const s of yk(t,Pm._compareURIs))n.set(s[0].resource,new kr(e,k.parse(s[0].resource),s));return n.forEach((s,o,a)=>{i.push(s)}),i}static _compareURIs(e,t){const i=e.resource.toString(),n=t.resource.toString();return i<n?-1:i>n?1:0}}function za(r){if(!(!r||!r.resource))return k.isUri(r.resource)?r.resource:r.resource.primary}const Fve={onDidChangeVisibility:F.None};let Am=class extends ne{constructor(e,t,i,n,s,o,a,c,d,l){super(),this.instantiationService=t,this.configurationService=i,this.modelService=n,this.workspaceService=s,this.languageService=o,this.decorationsService=a,this.themeService=c,this.labelService=d,this.textFileService=l,this._onDidChangeDecorations=this._register(new A),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this.widgets=[],this.labels=[],this.registerListeners(e)}registerListeners(e){this._register(e.onDidChangeVisibility(t=>{this.widgets.forEach(i=>i.notifyVisibilityChanged(t))})),this._register(this.languageService.onDidChange(()=>this.widgets.forEach(t=>t.notifyExtensionsRegistered()))),this._register(this.modelService.onModelLanguageChanged(t=>{t.model.uri&&this.widgets.forEach(i=>i.notifyModelLanguageChanged(t.model))})),this._register(this.modelService.onModelAdded(t=>{t.uri&&this.widgets.forEach(i=>i.notifyModelAdded(t))})),this._register(this.workspaceService.onDidChangeWorkspaceFolders(()=>{this.widgets.forEach(t=>t.notifyWorkspaceFoldersChange())})),this._register(this.decorationsService.onDidChangeDecorations(t=>{let i=!1;this.widgets.forEach(n=>{n.notifyFileDecorationsChanges(t)&&(i=!0)}),i&&this._onDidChangeDecorations.fire()})),this._register(this.themeService.onDidColorThemeChange(()=>this.widgets.forEach(t=>t.notifyThemeChange()))),this._register(this.configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration(KN)&&this.widgets.forEach(i=>i.notifyFileAssociationsChange())})),this._register(this.labelService.onDidChangeFormatters(t=>{this.widgets.forEach(i=>i.notifyFormattersChange(t.scheme))})),this._register(this.textFileService.untitled.onDidChangeLabel(t=>{this.widgets.forEach(i=>i.notifyUntitledLabelChange(t.resource))}))}get(e){return this.labels[e]}create(e,t){const i=this.instantiationService.createInstance(eO,e,t),n={element:i.element,onDidRender:i.onDidRender,setLabel:(s,o,a)=>i.setLabel(s,o,a),setResource:(s,o)=>i.setResource(s,o),setFile:(s,o)=>i.setFile(s,o),clear:()=>i.clear(),dispose:()=>this.disposeWidget(i)};return this.labels.push(n),this.widgets.push(i),n}disposeWidget(e){const t=this.widgets.indexOf(e);t>-1&&(this.widgets.splice(t,1),this.labels.splice(t,1)),vt(e)}clear(){this.widgets=vt(this.widgets),this.labels=[]}dispose(){super.dispose(),this.clear()}};Am=T([v(1,Te),v(2,We),v(3,_i),v(4,oi),v(5,ji),v(6,Su),v(7,Fi),v(8,Qi),v(9,Dn)],Am);let WV=class extends Am{get element(){return this.label}constructor(e,t,i,n,s,o,a,c,d,l,u){super(Fve,i,n,s,o,a,c,d,l,u),this.label=this._register(this.create(e,t))}};WV=T([v(2,Te),v(3,We),v(4,_i),v(5,oi),v(6,ji),v(7,Su),v(8,Fi),v(9,Qi),v(10,Dn)],WV);var nh;(function(r){r[r.Basic=1]="Basic",r[r.Full=2]="Full"})(nh||(nh={}));let eO=class extends X7{constructor(e,t,i,n,s,o,a,c){super(e,t),this.languageService=i,this.modelService=n,this.decorationsService=s,this.labelService=o,this.textFileService=a,this.contextService=c,this._onDidRender=this._register(new A),this.onDidRender=this._onDidRender.event,this.label=void 0,this.decoration=this._register(new Hr),this.options=void 0,this.computedIconClasses=void 0,this.computedLanguageId=void 0,this.computedPathLabel=void 0,this.computedWorkspaceFolderLabel=void 0,this.needsRedraw=void 0,this.isHidden=!1}notifyVisibilityChanged(e){e===this.isHidden&&(this.isHidden=!e,e&&this.needsRedraw&&(this.render({updateIcon:this.needsRedraw===nh.Full,updateDecoration:this.needsRedraw===nh.Full}),this.needsRedraw=void 0))}notifyModelLanguageChanged(e){this.handleModelEvent(e)}notifyModelAdded(e){this.handleModelEvent(e)}handleModelEvent(e){const t=za(this.label);t&&si(e.uri,t)&&this.computedLanguageId!==e.getLanguageId()&&(this.computedLanguageId=e.getLanguageId(),this.render({updateIcon:!0,updateDecoration:!1}))}notifyFileDecorationsChanges(e){if(!this.options)return!1;const t=za(this.label);return t&&this.options.fileDecorations&&e.affectsResource(t)?this.render({updateIcon:!1,updateDecoration:!0}):!1}notifyExtensionsRegistered(){this.render({updateIcon:!0,updateDecoration:!1})}notifyThemeChange(){this.render({updateIcon:!1,updateDecoration:!1})}notifyFileAssociationsChange(){this.render({updateIcon:!0,updateDecoration:!1})}notifyFormattersChange(e){var t;((t=za(this.label))==null?void 0:t.scheme)===e&&this.render({updateIcon:!1,updateDecoration:!1})}notifyUntitledLabelChange(e){si(e,za(this.label))&&this.render({updateIcon:!1,updateDecoration:!1})}notifyWorkspaceFoldersChange(){var e;if(typeof this.computedWorkspaceFolderLabel=="string"){const t=za(this.label);k.isUri(t)&&((e=this.label)==null?void 0:e.name)===this.computedWorkspaceFolderLabel&&this.setFile(t,this.options)}}setFile(e,t){const i=t==null?void 0:t.hideLabel;let n;if(!i){if((t==null?void 0:t.fileKind)===el.ROOT_FOLDER){const o=this.contextService.getWorkspaceFolder(e);o&&(n=o.name,this.computedWorkspaceFolderLabel=n)}n||(n=Xu(Xc(e)))}let s;t!=null&&t.hidePath||(s=this.labelService.getUriLabel(pn(e),{relative:!0})),this.setResource({resource:e,name:n,description:s},t)}setResource(e,t=Object.create(null)){const i=za(e),n=(e==null?void 0:e.resource)&&!k.isUri(e.resource);if(!t.forceLabel&&!n&&(i==null?void 0:i.scheme)===pe.untitled){const c=this.textFileService.untitled.get(i);if(c&&!c.hasAssociatedFilePath){if(typeof e.name=="string"&&(e.name=c.name),typeof e.description=="string"){const l=c.resource.path;e.name!==l?e.description=l:e.description=void 0}const d=c.resource.path;c.name!==d?t.title=`${c.name} • ${d}`:t.title=d}}const s=this.hasResourceChanged(e),o=s||this.hasPathLabelChanged(e),a=this.hasFileKindChanged(t);this.label=e,this.options=t,s&&(this.computedLanguageId=void 0),o&&(this.computedPathLabel=void 0),this.render({updateIcon:s||a,updateDecoration:s||a})}hasFileKindChanged(e){var n;const t=e==null?void 0:e.fileKind,i=(n=this.options)==null?void 0:n.fileKind;return t!==i}hasResourceChanged(e){const t=za(e),i=za(this.label);return t&&i?t.toString()!==i.toString():!(!t&&!i)}hasPathLabelChanged(e){const t=za(e);return!!t&&this.computedPathLabel!==this.labelService.getUriLabel(t)}clear(){this.label=void 0,this.options=void 0,this.computedLanguageId=void 0,this.computedIconClasses=void 0,this.computedPathLabel=void 0,this.setLabel("")}render(e){var s,o,a,c,d,l,u,h,g,m,y,_,b;if(this.isHidden)return this.needsRedraw!==nh.Full&&(this.needsRedraw=e.updateIcon||e.updateDecoration?nh.Full:nh.Basic),!1;if(e.updateIcon&&(this.computedIconClasses=void 0),!this.label)return!1;const t={title:"",italic:(s=this.options)==null?void 0:s.italic,strikethrough:(o=this.options)==null?void 0:o.strikethrough,matches:(a=this.options)==null?void 0:a.matches,descriptionMatches:(c=this.options)==null?void 0:c.descriptionMatches,extraClasses:[],separator:(d=this.options)==null?void 0:d.separator,domId:(l=this.options)==null?void 0:l.domId,disabledCommand:(u=this.options)==null?void 0:u.disabledCommand,labelEscapeNewLines:(h=this.options)==null?void 0:h.labelEscapeNewLines},i=za(this.label),n=this.label.name;if(((g=this.options)==null?void 0:g.title)!==void 0&&(t.title=this.options.title),i&&i.scheme!==pe.data&&(!((m=this.options)!=null&&m.title)||typeof this.options.title!="string"&&!this.options.title.markdownNotSupportedFallback)&&(this.computedPathLabel||(this.computedPathLabel=this.labelService.getUriLabel(i)),!t.title||typeof t.title=="string"?t.title=this.computedPathLabel:t.title.markdownNotSupportedFallback||(t.title.markdownNotSupportedFallback=this.computedPathLabel)),this.options&&!this.options.hideIcon&&(this.computedIconClasses||(this.computedIconClasses=yG(this.modelService,this.languageService,i,this.options.fileKind)),t.extraClasses=this.computedIconClasses.slice(0)),(y=this.options)!=null&&y.extraClasses&&t.extraClasses.push(...this.options.extraClasses),(_=this.options)!=null&&_.fileDecorations&&i){e.updateDecoration&&(this.decoration.value=this.decorationsService.getDecoration(i,this.options.fileKind!==el.FILE));const E=this.decoration.value;if(E){if(E.tooltip){if(typeof t.title=="string")t.title=`${t.title} • ${E.tooltip}`;else if(typeof((b=t.title)==null?void 0:b.markdown)=="string"){const D=`${t.title.markdown} • ${E.tooltip}`;t.title={markdown:D,markdownNotSupportedFallback:D}}}E.strikethrough&&(t.strikethrough=!0),this.options.fileDecorations.colors&&t.extraClasses.push(E.labelClassName),this.options.fileDecorations.badges&&(t.extraClasses.push(E.badgeClassName),t.extraClasses.push(E.iconClassName))}}return this.setLabel(n||"",this.label.description,t),this._onDidRender.fire(),!0}dispose(){super.dispose(),this.label=void 0,this.options=void 0,this.computedLanguageId=void 0,this.computedIconClasses=void 0,this.computedPathLabel=void 0,this.computedWorkspaceFolderLabel=void 0}};eO=T([v(2,ji),v(3,_i),v(4,Su),v(5,Qi),v(6,Dn),v(7,oi)],eO);const uD="comments";class tO extends ne{constructor(e,t,i){super(),this.configurationService=e,this._date=Fe(t,Ve("span.timestamp")),this._date.style.display="none",this._useRelativeTime=this.useRelativeTimeSetting,this.setTimestamp(i)}get useRelativeTimeSetting(){return this.configurationService.getValue(uD).useRelativeTime}async setTimestamp(e){(e!==this._timestamp||this.useRelativeTimeSetting!==this._useRelativeTime)&&this.updateDate(e),this._timestamp=e,this._useRelativeTime=this.useRelativeTimeSetting}updateDate(e){if(!e)this._date.textContent="",this._date.style.display="none";else if(e!==this._timestamp||this.useRelativeTimeSetting!==this._useRelativeTime){this._date.style.display="";let t,i;this.useRelativeTimeSetting?(t=this.getRelative(e),i=this.getDateString(e)):t=this.getDateString(e),this._date.textContent=t,i&&(this._date.title=i)}}getRelative(e){return f$(e,!0,!0)}getDateString(e){return e.toLocaleString(Ig)}}const iO=ee("commentsView.resolvedIcon",{dark:IH,light:IH,hcDark:yt,hcLight:yt},p("resolvedCommentIcon","Icon color for resolved comments.")),nO=ee("commentsView.unresolvedIcon",{dark:RH,light:RH,hcDark:yt,hcLight:yt},p("unresolvedCommentIcon","Icon color for unresolved comments.")),Ove=ee("editorCommentsWidget.resolvedBorder",{dark:iO,light:iO,hcDark:yt,hcLight:yt},p("resolvedCommentBorder","Color of borders and arrow for resolved comments.")),Wr=ee("editorCommentsWidget.unresolvedBorder",{dark:nO,light:nO,hcDark:yt,hcLight:yt},p("unresolvedCommentBorder","Color of borders and arrow for unresolved comments."));ee("editorCommentsWidget.rangeBackground",{dark:Xe(Wr,.1),light:Xe(Wr,.1),hcDark:Xe(Wr,.1),hcLight:Xe(Wr,.1)},p("commentThreadRangeBackground","Color of background for comment ranges."));ee("editorCommentsWidget.rangeBorder",{dark:Xe(Wr,.4),light:Xe(Wr,.4),hcDark:Xe(Wr,.4),hcLight:Xe(Wr,.4)},p("commentThreadRangeBorder","Color of border for comment ranges."));ee("editorCommentsWidget.rangeActiveBackground",{dark:Xe(Wr,.1),light:Xe(Wr,.1),hcDark:Xe(Wr,.1),hcLight:Xe(Wr,.1)},p("commentThreadActiveRangeBackground","Color of background for currently selected or hovered comment range."));ee("editorCommentsWidget.rangeActiveBorder",{dark:Xe(Wr,.4),light:Xe(Wr,.4),hcDark:Xe(Wr,.4),hcLight:Xe(Wr,.2)},p("commentThreadActiveRangeBorder","Color of border for currently selected or hovered comment range."));const Nve=new Map([[Ks.Unresolved,Wr],[Ks.Resolved,Ove]]),$ve=new Map([[Ks.Unresolved,nO],[Ks.Resolved,iO]]),j8="--comment-thread-state-color",HV="--comment-view-thread-state-color",B8="--comment-thread-state-background-color";function U8(r,e,t){const i=r!==void 0?t.get(r):void 0;return i!==void 0?e.getColor(i):void 0}function Wve(r,e){return U8(r,e,Nve)}function Hve(r,e){return U8(r,e,$ve)}class Yc{constructor(e,t,i){this.filter=e,this.showResolved=!0,this.showUnresolved=!0,e=e.trim(),this.showResolved=t,this.showUnresolved=i;const n=e.startsWith("!");this.textFilter={text:(n?J7(e,"!"):e).trim(),negate:n}}}Yc._filter=Z7;Yc._messageFilter=eX;const cn="workbench.panel.comments",jve="Comments",rO=p("comments.view.title","Comments"),sg=class sg{getHeight(e){return e instanceof Rm&&e.hasReply()?44:22}getTemplateId(e){return e instanceof kr?sg.RESOURCE_ID:e instanceof Rm?sg.COMMENT_ID:""}};mi(sg,"RESOURCE_ID","resource-with-comments"),mi(sg,"COMMENT_ID","comment-node");let sO=sg;class Bve{constructor(e){this.labels=e,this.templateId="resource-with-comments"}renderTemplate(e){const t=Fe(e,Ve(".resource-container"));return{resourceLabel:this.labels.create(t)}}renderElement(e,t,i,n){i.resourceLabel.setFile(e.element.resource)}disposeTemplate(e){e.resourceLabel.dispose()}}let oO=class{constructor(e,t,i){this.openerService=e,this.configurationService=t,this.themeService=i,this.templateId="comment-node"}renderTemplate(e){const t=Fe(e,Ve(".comment-thread-container")),i=Fe(t,Ve(".comment-metadata-container")),n={icon:Fe(i,Ve(".icon")),userNames:Fe(i,Ve(".user")),timestamp:new tO(this.configurationService,Fe(i,Ve(".timestamp-container"))),separator:Fe(i,Ve(".separator")),commentPreview:Fe(i,Ve(".text")),range:Fe(i,Ve(".range"))};n.separator.innerText="·";const s=Fe(t,Ve(".comment-snippet-container")),o={container:s,icon:Fe(s,Ve(".icon")),count:Fe(s,Ve(".count")),lastReplyDetail:Fe(s,Ve(".reply-detail")),separator:Fe(s,Ve(".separator")),timestamp:new tO(this.configurationService,Fe(s,Ve(".timestamp-container")))};o.separator.innerText="·",o.icon.classList.add(...Si.asClassNameArray(jt.indent));const a=[n.timestamp,o.timestamp];return{threadMetadata:n,repliesMetadata:o,disposables:a}}getCountString(e){return e>1?p("commentsCount","{0} comments",e):p("commentCount","1 comment")}getRenderedComment(e,t){const i=tX(e,{inline:!0,actionHandler:{callback:s=>iX(this.openerService,s,e.isTrusted),disposables:t}}),n=i.element.getElementsByTagName("img");for(let s=0;s<n.length;s++){const o=n[s],a=Ve("");a.textContent=o.alt?p("imageWithLabel","Image: {0}",o.alt):p("image","Image"),o.parentNode.replaceChild(a,o)}return i}getIcon(e){return e===Ks.Unresolved?jt.commentUnresolved:jt.comment}renderElement(e,t,i,n){const s=e.element.replies.length+1;if(i.threadMetadata.icon.classList.remove(...Array.from(i.threadMetadata.icon.classList.values()).filter(c=>c.startsWith("codicon"))),i.threadMetadata.icon.classList.add(...Si.asClassNameArray(this.getIcon(e.element.threadState))),e.element.threadState!==void 0){const c=this.getCommentThreadWidgetStateColor(e.element.threadState,this.themeService.getColorTheme());i.threadMetadata.icon.style.setProperty(HV,`${c}`),i.threadMetadata.icon.style.color=`var(${HV})`}i.threadMetadata.userNames.textContent=e.element.comment.userName,i.threadMetadata.timestamp.setTimestamp(e.element.comment.timestamp?new Date(e.element.comment.timestamp):void 0);const o=e.element;if(i.threadMetadata.commentPreview.innerText="",i.threadMetadata.commentPreview.style.height="22px",typeof o.comment.body=="string")i.threadMetadata.commentPreview.innerText=o.comment.body;else{const c=new me;i.disposables.push(c);const d=this.getRenderedComment(o.comment.body,c);i.disposables.push(d),i.threadMetadata.commentPreview.appendChild(d.element.firstElementChild??d.element),i.threadMetadata.commentPreview.title=d.element.textContent??""}if(e.element.range&&(e.element.range.startLineNumber===e.element.range.endLineNumber?i.threadMetadata.range.textContent=p("commentLine","[Ln {0}]",e.element.range.startLineNumber):i.threadMetadata.range.textContent=p("commentRange","[Ln {0}-{1}]",e.element.range.startLineNumber,e.element.range.endLineNumber)),!e.element.hasReply()){i.repliesMetadata.container.style.display="none";return}i.repliesMetadata.container.style.display="",i.repliesMetadata.count.textContent=this.getCountString(s);const a=e.element.replies[e.element.replies.length-1].comment;i.repliesMetadata.lastReplyDetail.textContent=p("lastReplyFrom","Last reply from {0}",a.userName),i.repliesMetadata.timestamp.setTimestamp(a.timestamp?new Date(a.timestamp):void 0)}getCommentThreadWidgetStateColor(e,t){return e!==void 0?Hve(e,t):void 0}disposeTemplate(e){e.disposables.forEach(t=>t.dispose())}};oO=T([v(0,us),v(1,We),v(2,Fi)],oO);class Uve{constructor(e){this.options=e}filter(e,t){return this.options.filter===""&&this.options.showResolved&&this.options.showUnresolved?1:e instanceof kr?this.filterResourceMarkers(e):this.filterCommentNode(e,t)}filterResourceMarkers(e){if(this.options.textFilter.text&&!this.options.textFilter.negate){const t=Yc._filter(this.options.textFilter.text,Mt(e.resource));if(t)return{visibility:!0,data:{type:0,uriMatches:t||[]}}}return 2}filterCommentNode(e,t){if(!(e.threadState===void 0||this.options.showResolved&&Ks.Resolved===e.threadState||this.options.showUnresolved&&Ks.Unresolved===e.threadState))return!1;if(!this.options.textFilter.text)return!0;const n=Yc._messageFilter(this.options.textFilter.text,typeof e.comment.body=="string"?e.comment.body:e.comment.body.value)||Yc._messageFilter(this.options.textFilter.text,e.comment.userName)||e.replies.map(s=>Yc._messageFilter(this.options.textFilter.text,s.comment.userName)||Yc._messageFilter(this.options.textFilter.text,typeof s.comment.body=="string"?s.comment.body:s.comment.body.value)).filter(s=>!!s).flat();return n.length&&!this.options.textFilter.negate?{visibility:!0,data:{type:1,textMatches:n}}:n.length&&this.options.textFilter.negate&&t===2?!1:n.length===0&&this.options.textFilter.negate&&t===2?!0:t}}let aO=class extends nX{constructor(e,t,i,n,s,o,a,c){const d=new sO,l=[a.createInstance(Bve,e),a.createInstance(oO)];super("CommentsTree",t,d,l,{accessibilityProvider:i.accessibilityProvider,identityProvider:{getId:u=>u instanceof Pm?"root":u instanceof kr?`${u.owner}-${u.id}`:u instanceof Rm?`${u.owner}-${u.resource.toString()}-${u.threadId}-${u.comment.uniqueIdInThread}`+(u.isRoot?"-root":""):""},expandOnlyOnTwistieClick:u=>!(u instanceof Pm||u instanceof kr),collapseByDefault:!1,overrideStyles:i.overrideStyles,filter:i.filter,findWidgetEnabled:!1},a,n,s,c)}filterComments(){this.refilter()}getVisibleItemCount(){let e=0;const t=this.getNode();for(const i of t.children)for(const n of i.children)n.visible&&i.visible&&e++;return e}};aO=T([v(3,It),v(4,_G),v(5,Fi),v(6,Te),v(7,We)],aO);const oW=new G("commentsFilterFocus",!1),V8=new G("commentsView.showResolvedFilter",!0),q8=new G("commentsView.showUnResolvedFilter",!0);class Vve extends ne{constructor(e,t){super(),this.contextKeyService=t,this._onDidChange=this._register(new A),this.onDidChange=this._onDidChange.event,this._showUnresolved=q8.bindTo(this.contextKeyService),this._showResolved=V8.bindTo(this.contextKeyService),this._showResolved.set(e.showResolved),this._showUnresolved.set(e.showUnresolved)}get showUnresolved(){return!!this._showUnresolved.get()}set showUnresolved(e){this._showUnresolved.get()!==e&&(this._showUnresolved.set(e),this._onDidChange.fire({showUnresolved:!0}))}get showResolved(){return!!this._showResolved.get()}set showResolved(e){this._showResolved.get()!==e&&(this._showResolved.set(e),this._onDidChange.fire({showResolved:!0}))}}Nt(class extends Yf{constructor(){super({id:"commentsFocusViewFromFilter",title:p("focusCommentsList","Focus Comments view"),keybinding:{when:oW,weight:200,primary:2066},viewId:cn})}async runInView(r,e){e.focus()}});Nt(class extends Yf{constructor(){super({id:"commentsClearFilterText",title:p("commentsClearFilterText","Clear filter text"),keybinding:{when:oW,weight:200,primary:9},viewId:cn})}async runInView(r,e){e.clearFilterText()}});Nt(class extends Yf{constructor(){super({id:"commentsFocusFilter",title:p("focusCommentsFilter","Focus comments filter"),keybinding:{when:nv.isEqualTo(cn),weight:200,primary:2084},viewId:cn})}async runInView(r,e){e.focusFilter()}});Nt(class extends Yf{constructor(){super({id:`workbench.actions.${cn}.toggleUnResolvedComments`,title:p("toggle unresolved","Toggle Unresolved Comments"),category:p("comments","Comments"),toggled:{condition:q8,title:p("unresolved","Show Unresolved")},menu:{id:lI,group:"1_filter",when:nt.equals("view",cn),order:1},viewId:cn})}async runInView(r,e){e.filters.showUnresolved=!e.filters.showUnresolved}});Nt(class extends Yf{constructor(){super({id:`workbench.actions.${cn}.toggleResolvedComments`,title:p("toggle resolved","Toggle Resolved Comments"),category:p("comments","Comments"),toggled:{condition:V8,title:p("resolved","Show Resolved")},menu:{id:lI,group:"1_filter",when:nt.equals("view",cn),order:1},viewId:cn})}async runInView(r,e){e.filters.showResolved=!e.filters.showResolved}});var qve='.review-widget{position:absolute;width:100%}.monaco-editor .review-widget{background-color:var(--vscode-peekViewResult-background)}.review-widget .hidden{display:none!important}.review-widget .body{overflow:hidden}.review-widget .body .review-comment{display:flex;padding:8px 16px 8px 20px}@keyframes monaco-review-widget-focus{0%{background:var(--vscode-peekViewResult-selectionBackground)}to{background:transparent}}.review-widget .body .review-comment.focus{animation:monaco-review-widget-focus 3s ease 0s}.review-widget .body .review-comment .comment-actions{margin-left:auto}.review-widget .body .review-comment .comment-actions .monaco-toolbar{height:22px}.review-widget .body .review-comment .comment-title .comment-header-info{overflow:hidden;text-overflow:ellipsis}.review-widget .body .review-comment .comment-title{display:flex;width:100%}.review-widget .body .review-comment .comment-title .action-label.codicon{line-height:18px}.review-widget .body .review-comment .comment-title .monaco-dropdown .toolbar-toggle-more{height:18px;line-height:18px;vertical-align:middle;width:16px}.review-widget .body .comment-body blockquote{border-left-style:solid;border-left-width:5px;margin:0 7px 0 5px;padding:0 16px 0 10px}.review-widget .body .review-comment .avatar-container{margin-top:4px!important}.review-widget .body .review-comment .avatar-container img.avatar{border-radius:3px;border-style:none;display:inline-block;height:28px;line-height:1;overflow:hidden;vertical-align:middle;width:28px}.review-widget .body .comment-reactions .monaco-text-button{background-color:transparent;border:1px solid grey;border-radius:3px;margin:0 7px 0 0;width:30px}.review-widget .body .review-comment .review-comment-contents{overflow:hidden;padding-left:20px;user-select:text;-webkit-user-select:text;width:100%}.review-widget .body pre{word-wrap:normal;overflow:auto;white-space:pre}.review-widget .body .review-comment .review-comment-contents .author{line-height:22px}.review-widget .body .review-comment .review-comment-contents .isPending{font-style:italic;line-height:22px;margin:0 5px;padding:0 2px}.review-widget .body .review-comment .review-comment-contents .timestamp{line-height:22px;margin:0 5px;padding:0 2px}.review-widget .body .review-comment .review-comment-contents .comment-body .comment-body-plainstring{white-space:pre-wrap}.review-widget .body .review-comment .review-comment-contents .comment-body{padding-top:4px}.review-widget .body .review-comment .review-comment-contents .comment-body-max-height{max-height:20em}.review-widget .body .review-comment .review-comment-contents .comment-reactions{margin-top:8px;min-height:25px}.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item .action-label{display:flex;font-size:12px;padding:1px 4px;text-align:center;white-space:pre}.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item .action-label .reaction-icon{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-position:0;background-repeat:no-repeat;background-size:14px;display:inline-block;margin-right:4px;width:14px}.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item .action-label .reaction-label{line-height:20px;margin-right:4px}.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label.toolbar-toggle-pickReactions{background-position:50%;background-repeat:no-repeat;background-size:16px;border:none;display:none;font-size:16px;height:16px;margin-top:3px;width:26px}.review-widget .body .review-comment .review-comment-contents .comment-reactions:hover .action-item a.action-label.toolbar-toggle-pickReactions{background-size:16px;display:inline-block}.review-widget .body .review-comment .comment-title .action-label{background-position:50%;background-repeat:no-repeat;background-size:16px;display:block;height:16px;line-height:16px}.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label{border:1px solid}.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label.disabled{opacity:.6}.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label.active:hover{background-color:var(--vscode-statusBarItem-hoverBackground)}.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label:active{background-color:var(--vscode-statusBarItem-activeBackground);border:1px solid transparent}.review-widget .body .review-comment .review-comment-contents a{cursor:pointer}.review-widget .body .comment-body p,.review-widget .body .comment-body ul{margin:8px 0}.review-widget .body .comment-body p:first-child,.review-widget .body .comment-body ul:first-child{margin-top:0}.review-widget .body .comment-body p:last-child,.review-widget .body.comment-body ul:last-child{margin-bottom:0}.review-widget .body .comment-body ul{padding-left:20px}.review-widget .body .comment-body li>p{margin-bottom:0}.review-widget .body .comment-body li>ul{margin-top:0}.review-widget .body .comment-body code{border-radius:3px;padding:0 .4em}.review-widget .body .comment-body span{white-space:pre}.review-widget .body .comment-body img{max-width:100%}.review-widget .body .comment-form{margin:8px 20px}.review-widget .validation-error{word-wrap:break-word;box-sizing:border-box;display:inline-block;font-size:12px;line-height:17px;margin-left:-1px;margin-top:-1px;min-height:34px;overflow:hidden;padding:.4em;text-align:left;width:100%}.review-widget .body .comment-additional-actions{margin:10px 20px}.review-widget .body .comment-additional-actions .section-separator{border-top:1px solid var(--vscode-menu-separatorBackground);margin:10px 0 14px}.review-widget .body .comment-additional-actions .button-bar{display:flex;white-space:nowrap}.review-widget .body .comment-additional-actions .monaco-button,.review-widget .body .comment-additional-actions .monaco-button-dropdown,.review-widget .body .comment-additional-actions .monaco-text-button{display:flex;width:auto}.review-widget .body .comment-additional-actions .button-bar>.monaco-button-dropdown,.review-widget .body .comment-additional-actions .button-bar>.monaco-text-button{margin:0 10px 0 0}.review-widget .body .comment-additional-actions .button-bar .monaco-text-button{padding:4px 10px}.review-widget .body .comment-additional-actions .codicon-drop-down-button{align-items:center}.review-widget .body .monaco-editor{color:var(--vscode-editor-foreground)}.review-widget .body .comment-form.expand .review-thread-reply-button{display:none}.review-widget .body .comment-form.expand .form-actions,.review-widget .body .comment-form.expand .monaco-editor{box-sizing:content-box;display:block}.review-widget .body .comment-form .review-thread-reply-button{background-color:var(--vscode-peekViewTitle-background);border:0;border-radius:0;box-sizing:border-box;color:var(--vscode-editor-foreground);display:block;font-family:var(--monaco-monospace-font);font-size:inherit;font-weight:600;line-height:20px;outline:1px solid transparent;padding:6px 12px;resize:vertical;text-align:left;white-space:nowrap;width:100%}.review-widget .body .comment-form .review-thread-reply-button:focus{outline-style:solid;outline-width:1px}.review-widget .body .comment-form .monaco-editor,.review-widget .body .edit-container .monaco-editor{border:0;border-radius:3px;box-sizing:content-box;max-height:500px;min-height:90px;padding:6px 0 6px 12px;width:100%}.review-widget .body .comment-form .form-actions,.review-widget .body .comment-form .monaco-editor{display:none}.review-widget .body .comment-form .form-actions,.review-widget .body .edit-container .form-actions{margin:10px 0;overflow:auto}.review-widget .body .edit-container .form-actions{padding-top:10px}.review-widget .body .edit-textarea{height:90px;margin:5px 12px 10px 0}.review-widget .body .comment-form .monaco-text-button,.review-widget .body .edit-container .monaco-text-button{margin-left:5px;padding:4px 10px;width:auto}.review-widget .body .form-actions .monaco-text-button{float:right}.review-widget .head{box-sizing:border-box;display:flex;height:100%}.review-widget .head .review-title{cursor:default;display:inline-block;font-size:13px;margin-left:20px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.review-widget .head .review-title .dirname:not(:empty){font-size:.9em;margin-left:.5em}.review-widget .head .review-actions{flex:1;padding-right:2px;text-align:right}.review-widget .head .review-actions>.monaco-action-bar{display:inline-block}.review-widget .head .review-actions>.monaco-action-bar,.review-widget .head .review-actions>.monaco-action-bar>.actions-container{height:100%}.review-widget .action-item{margin-left:4px;min-height:20px;min-width:18px}.review-widget .head .review-actions>.monaco-action-bar .action-label{background-position:50%;background-repeat:no-repeat;line-height:inherit;margin:0}.review-widget .head .review-actions>.monaco-action-bar .action-label.codicon{margin:0}.review-widget>.body{border-top:1px solid;position:relative}.monaco-editor .comment-range-glyph{cursor:pointer;margin-left:10px;width:4px!important;z-index:10}div.preview.inline .monaco-editor .comment-range-glyph{display:none!important}.monaco-editor .comment-diff-added{border-left-style:solid;border-left-width:3px}.monaco-editor .comment-diff-added,.monaco-editor .comment-range-glyph.multiline-add{border-left-color:var(--vscode-editorGutter-commentRangeForeground)}.monaco-editor .comment-diff-added:before,.monaco-editor .comment-range-glyph.line-hover:before,.monaco-editor .comment-thread-unresolved:before,.monaco-editor .comment-thread:before{background:var(--vscode-editorGutter-commentRangeForeground)}.monaco-editor .comment-thread-range,.monaco-editor .comment-thread-range-current{border-style:solid;border-width:1px;box-sizing:border-box}.monaco-editor .comment-thread-range{background-color:var(--vscode-editorCommentsWidget-rangeBackground);border-color:var(--vscode-editorCommentsWidget-rangeBorder)}.monaco-editor .comment-thread-range-current{background-color:var(--vscode-editorCommentsWidget-rangeActiveBackground);border-color:var(--vscode-editorCommentsWidget-rangeActiveBorder)}.monaco-editor .margin-view-overlays .comment-range-glyph.comment-thread,.monaco-editor .margin-view-overlays .comment-range-glyph.comment-thread-unresolved,.monaco-editor .margin-view-overlays .comment-range-glyph.line-hover{margin-left:13px}.monaco-editor .comment-range-glyph.comment-thread-unresolved:before,.monaco-editor .comment-range-glyph.comment-thread:before,.monaco-editor .margin-view-overlays .comment-range-glyph.line-hover:before,.monaco-editor .margin-view-overlays>div:hover>.comment-range-glyph.comment-diff-added:before{align-items:center;color:var(--vscode-editorGutter-commentGlyphForeground);display:flex;flex-direction:row;height:100%;justify-content:center;left:-6px;position:absolute;text-align:center;width:9px;z-index:10}.monaco-editor .comment-range-glyph.comment-thread-unresolved:before{color:var(--vscode-editorGutter-commentUnresolvedGlyphForeground)}.monaco-editor .margin-view-overlays .comment-range-glyph.multiline-add{border-left-style:dotted;border-left-width:3px;height:16px;margin-top:2px}.monaco-editor .margin-view-overlays .comment-range-glyph.line-hover:before,.monaco-editor .margin-view-overlays>div:hover>.comment-range-glyph.comment-diff-added:before{border-radius:3px;content:"\\ea60";font-family:codicon;margin-left:-5px;padding-left:1px;width:18px!important}.monaco-editor .comment-range-glyph.comment-thread,.monaco-editor .comment-range-glyph.comment-thread-unresolved{z-index:20}.monaco-editor .comment-range-glyph.comment-thread-unresolved:before,.monaco-editor .comment-range-glyph.comment-thread:before{border-radius:3px;font-family:codicon;font-size:13px;line-height:100%;margin-left:-5px;padding-left:1px;padding-top:1px;width:18px!important;z-index:20}.monaco-editor .comment-range-glyph.comment-thread:before{content:"\\ea6b"}.monaco-editor .comment-range-glyph.comment-thread-unresolved:before{content:"\\ec0a"}.monaco-editor.inline-comment .margin-view-overlays .codicon-folding-collapsed,.monaco-editor.inline-comment .margin-view-overlays .codicon-folding-expanded{margin-left:11px}.monaco-editor.inline-comment .margin-view-overlays .dirty-diff-glyph{margin-left:25px}';Ic(qve,{});const cS=ee("editorGutter.commentRangeForeground",{dark:PH(AH,jn),light:rf(PH(AH,jn),.05),hcDark:Ue.white,hcLight:Ue.black},p("editorGutterCommentRangeForeground","Editor gutter decoration color for commenting ranges. This color should be opaque.")),py=ee("editorOverviewRuler.commentForeground",{dark:cS,light:cS,hcDark:cS,hcLight:cS},p("editorOverviewRuler.commentForeground","Editor overview ruler decoration color for resolved comments. This color should be opaque.")),Gve=ee("editorOverviewRuler.commentUnresolvedForeground",{dark:py,light:py,hcDark:py,hcLight:py},p("editorOverviewRuler.commentUnresolvedForeground","Editor overview ruler decoration color for unresolved comments. This color should be opaque.")),dS=ee("editorGutter.commentGlyphForeground",{dark:yd,light:yd,hcDark:Ue.black,hcLight:Ue.white},p("editorGutterCommentGlyphForeground","Editor gutter decoration color for commenting glyphs."));ee("editorGutter.commentUnresolvedGlyphForeground",{dark:dS,light:dS,hcDark:dS,hcLight:dS},p("editorGutterCommentUnresolvedGlyphForeground","Editor gutter decoration color for commenting glyphs for unresolved comment threads."));class rv{constructor(e,t){this._commentsOptions=this.createDecorationOptions(),this._editor=e,this._commentsDecorations=this._editor.createDecorationsCollection(),this.setLineNumber(t)}createDecorationOptions(){const e=this._threadState===Ks.Unresolved,t={description:rv.description,isWholeLine:!0,overviewRuler:{color:Ky(e?Gve:py),position:Qw.Center},collapseOnReplaceEdit:!0,linesDecorationsClassName:`comment-range-glyph comment-thread${e?"-unresolved":""}`};return ba.createDynamic(t)}setThreadState(e){this._threadState!==e&&(this._threadState=e,this._commentsOptions=this.createDecorationOptions(),this._updateDecorations())}_updateDecorations(){const e=[{range:{startLineNumber:this._lineNumber,startColumn:1,endLineNumber:this._lineNumber,endColumn:1},options:this._commentsOptions}];this._commentsDecorations.set(e)}setLineNumber(e){this._lineNumber=e,this._updateDecorations()}getPosition(){const e=this._commentsDecorations.length>0?this._commentsDecorations.getRange(0):null;return{position:{lineNumber:e?e.endLineNumber:this._lineNumber,column:1},preference:[0]}}dispose(){this._commentsDecorations.clear()}}rv.description="comment-glyph-widget";class _w{constructor(e,t,i){this.container=e,this.actionHandler=t,this.maxActions=i,this._buttonElements=[],this._toDispose=new me,this._actions=[]}setActions(e,t=!1){this._toDispose.clear(),this._buttonElements.forEach(s=>s.remove()),this._buttonElements=[];const i=e.getActions({shouldForwardArgs:!0});let n=!t;for(const s of i){const[,o]=s;this._actions=o;for(const a of o){const c=new nG(this.container,{secondary:!n,...rG});if(n=!1,this._buttonElements.push(c.element),this._toDispose.add(c),this._toDispose.add(c.onDidClick(()=>this.actionHandler(a))),c.enabled=a.enabled,c.label=a.label,this.maxActions!==void 0&&this._buttonElements.length>=this.maxActions){console.warn("An extension has contributed more than the allowable number of actions to a comments menu.");return}}}}triggerDefaultAction(){if(this._actions.length){const e=this._actions[0];if(e.enabled)return this.actionHandler(e)}}dispose(){this._toDispose.dispose()}}var Xl;(function(r){r.commentThreadIsEmpty=new G("commentThreadIsEmpty",!1,{type:"boolean",description:p("commentThreadIsEmpty","Set when the comment thread has no comments")}),r.commentIsEmpty=new G("commentIsEmpty",!1,{type:"boolean",description:p("commentIsEmpty","Set when the comment has no input")}),r.commentContext=new G("comment",void 0,{type:"string",description:p("comment","The context value of the comment")}),r.commentThreadContext=new G("commentThread",void 0,{type:"string",description:p("commentThread","The context value of the comment thread")}),r.commentControllerContext=new G("commentController",void 0,{type:"string",description:p("commentController","The comment controller id associated with a comment thread")})})(Xl||(Xl={}));const zve=new G("commentEditorFocused",!1);let Mm=class extends QN{constructor(e,t,i,n,s,o,a,c,d,l,u,h){const g={contributions:[{id:cm.ID,ctor:cm,instantiation:2},{id:EP.ID,ctor:EP,instantiation:2},{id:xP.ID,ctor:xP,instantiation:0},{id:nf.ID,ctor:nf,instantiation:4},{id:Pa.ID,ctor:Pa,instantiation:0}]};super(e,t,g,s,o,a,i,c,d,l,u,h),this._commentEditorFocused=zve.bindTo(i),this._commentEditorEmpty=Xl.commentIsEmpty.bindTo(i),this._commentEditorEmpty.set(!this.getValue()),this._parentThread=n,this._register(this.onDidFocusEditorWidget(m=>this._commentEditorFocused.set(!0))),this._register(this.onDidChangeModelContent(m=>this._commentEditorEmpty.set(!this.getValue()))),this._register(this.onDidBlurEditorWidget(m=>this._commentEditorFocused.reset()))}getParentThread(){return this._parentThread}_getActions(){return hk.getEditorActions()}static getEditorOptions(e){return{wordWrap:"on",glyphMargin:!1,lineNumbers:"off",folding:!1,selectOnLineNumbers:!1,scrollbar:{vertical:"visible",verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1},overviewRulerLanes:2,lineDecorationsWidth:0,scrollBeyondLastLine:!1,renderLineHighlight:"none",fixedOverflowWidgets:!0,acceptSuggestionOnEnter:"smart",minimap:{enabled:!1},autoClosingBrackets:e.getValue("editor.autoClosingBrackets"),quickSuggestions:!1}}};Mm=T([v(4,Te),v(5,En),v(6,un),v(7,Fi),v(8,on),v(9,Af),v(10,Bm),v(11,Lf)],Mm);const Kve="comment";let Qve=0;const G8="commenteditordecoration";let cO=class extends ne{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y){super(),this.owner=e,this._commentThread=i,this._scopedInstatiationService=n,this._contextKeyService=s,this._commentMenus=o,this._commentOptions=a,this._pendingComment=c,this._parentThread=d,this._actionRunDelegate=l,this.commentService=u,this.languageService=h,this.modelService=g,this.themeService=m,this._commentThreadDisposables=[],this.form=Fe(t,Ve(".comment-form")),this.commentEditor=this._register(this._scopedInstatiationService.createInstance(Mm,this.form,Mm.getEditorOptions(y),s,this._parentThread)),this.commentEditorIsEmpty=Xl.commentIsEmpty.bindTo(this._contextKeyService),this.commentEditorIsEmpty.set(!this._pendingComment);const _=this._commentThread.comments&&this._commentThread.comments.length>0,b=Nn()+"-"+(_?this._commentThread.threadId:++Qve),E=JSON.stringify({extensionId:this._commentThread.extensionId,commentThreadId:this._commentThread.threadId});let D=k.parse(`${Kve}://${this._commentThread.extensionId}/commentinput-${b}.md?${E}`);const R=this.commentService.getCommentController(e);R&&(D=D.with({authority:R.id}));const M=this.modelService.createModel(this._pendingComment||"",this.languageService.createByFilepathOrFirstLine(D),D,!1);this._register(M),this.commentEditor.setModel(M),this._register(this.commentEditor.getModel().onDidChangeContent(()=>{var L;this.setCommentEditorDecorations(),(L=this.commentEditorIsEmpty)==null||L.set(!this.commentEditor.getValue())})),this.createTextModelListener(this.commentEditor,this.form),this.setCommentEditorDecorations(),_?this.createReplyButton(this.commentEditor,this.form):this._commentThread.comments&&this._commentThread.comments.length===0&&this.expandReplyArea(),this._error=Fe(this.form,Ve(".validation-error.hidden"));const O=Fe(this.form,Ve(".form-actions"));this._formActions=Fe(O,Ve(".other-actions")),this.createCommentWidgetFormActions(this._formActions,M),this._editorActions=Fe(O,Ve(".editor-actions")),this.createCommentWidgetEditorActions(this._editorActions,M)}updateCommentThread(e){const t=this.commentEditor.hasTextFocus();this._reviewThreadReplyButton||this.createReplyButton(this.commentEditor,this.form),this._commentThread.comments&&this._commentThread.comments.length===0&&this.expandReplyArea(),t&&this.commentEditor.focus()}getPendingComment(){const e=this.commentEditor.getModel();if(e&&e.getValueLength()>0)return e.getValue()}layout(e){this.commentEditor.layout({height:5*18,width:e-54})}focusIfNeeded(){!this._commentThread.comments||!this._commentThread.comments.length?this.commentEditor.focus():this.commentEditor.getModel().getValueLength()>0&&this.expandReplyArea()}focusCommentEditor(){this.commentEditor.focus()}getCommentModel(){return this.commentEditor.getModel()}updateCanReply(){this._commentThread.canReply?this.form.style.display="block":this.form.style.display="none"}async submitComment(){var e;return(e=this._commentFormActions)==null?void 0:e.triggerDefaultAction()}setCommentEditorDecorations(){var t,i,n;const e=this.commentEditor.getModel();if(e){const s=e.getValueLength(),o=this._commentThread.comments&&this._commentThread.comments.length>0,a=s>0?"":o?((t=this._commentOptions)==null?void 0:t.placeHolder)||p("reply","Reply..."):((i=this._commentOptions)==null?void 0:i.placeHolder)||p("newComment","Type a new comment"),c=[{range:{startLineNumber:0,endLineNumber:0,startColumn:0,endColumn:1},renderOptions:{after:{contentText:a,color:`${(n=rX(yd,this.themeService.getColorTheme()))==null?void 0:n.transparent(.4)}`}}}];this.commentEditor.setDecorationsByType("review-zone-widget",G8,c)}}createTextModelListener(e,t){this._commentThreadDisposables.push(e.onDidFocusEditorWidget(()=>{this._commentThread.input={uri:e.getModel().uri,value:e.getValue()},this.commentService.setActiveCommentThread(this._commentThread)})),this._commentThreadDisposables.push(e.getModel().onDidChangeContent(()=>{const i=e.getValue();if(this._commentThread.input&&this._commentThread.input.uri===e.getModel().uri&&this._commentThread.input.value!==i){const n=this._commentThread.input;n.value=i,this._commentThread.input=n}this.commentService.setActiveCommentThread(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeInput(i=>{const n=this._commentThread,s=e.getModel();n.input&&s&&n.input.uri!==s.uri||i&&e.getValue()!==i.value&&(e.setValue(i.value),i.value===""&&(this._pendingComment="",t.classList.remove("expand"),e.getDomNode().style.outline="",this._error.textContent="",this._error.classList.add("hidden")))}))}createCommentWidgetFormActions(e,t){const i=this._commentMenus.getCommentThreadActions(this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{this._commentFormActions.setActions(i)})),this._commentFormActions=new _w(e,async n=>{var s;(s=this._actionRunDelegate)==null||s.call(this),n.run({thread:this._commentThread,text:this.commentEditor.getValue(),$mid:9}),this.hideReplyArea()}),this._register(this._commentFormActions),this._commentFormActions.setActions(i)}createCommentWidgetEditorActions(e,t){const i=this._commentMenus.getCommentEditorActions(this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{this._commentEditorActions.setActions(i)})),this._commentEditorActions=new _w(e,async n=>{var s;(s=this._actionRunDelegate)==null||s.call(this),n.run({thread:this._commentThread,text:this.commentEditor.getValue(),$mid:9}),this.focusCommentEditor()}),this._register(this._commentEditorActions),this._commentEditorActions.setActions(i,!0)}get isReplyExpanded(){return this.form.classList.contains("expand")}expandReplyArea(){this.isReplyExpanded||(this.form.classList.add("expand"),this.commentEditor.focus(),this.commentEditor.layout())}clearAndExpandReplyArea(){this.isReplyExpanded||(this.commentEditor.setValue(""),this.expandReplyArea())}hideReplyArea(){this.commentEditor.getDomNode().style.outline="",this.commentEditor.setValue(""),this._pendingComment="",this.form.classList.remove("expand"),this._error.textContent="",this._error.classList.add("hidden")}createReplyButton(e,t){var i,n;this._reviewThreadReplyButton=Fe(t,Ve(`button.review-thread-reply-button.${$P}`)),this._reviewThreadReplyButton.title=((i=this._commentOptions)==null?void 0:i.prompt)||p("reply","Reply..."),this._reviewThreadReplyButton.textContent=((n=this._commentOptions)==null?void 0:n.prompt)||p("reply","Reply..."),this._register(Ci(this._reviewThreadReplyButton,"click",s=>this.clearAndExpandReplyArea())),this._register(Ci(this._reviewThreadReplyButton,"focus",s=>this.clearAndExpandReplyArea())),e.onDidBlurEditorWidget(()=>{e.getModel().getValueLength()===0&&t.classList.contains("expand")&&t.classList.remove("expand")})}};cO=T([v(10,Nd),v(11,ji),v(12,_i),v(13,Fi),v(14,We)],cO);class dl extends Zn{constructor(e,t){super(dl.ID,t||p("pickReactions","Pick Reactions..."),"toggle-reactions",!0),this._menuActions=[],this.toggleDropdownMenu=e}run(){return this.toggleDropdownMenu(),Promise.resolve(!0)}get menuActions(){return this._menuActions}set menuActions(e){this._menuActions=e}}dl.ID="toolbar.toggle.pickReactions";class Yve extends wG{constructor(e){super(null,e,{})}updateLabel(){if(!this.label)return;const e=this.action;if(e.class&&this.label.classList.add(e.class),e.icon){const t=Fe(this.label,Ve(".reaction-icon")),i=k.revive(e.icon);t.style.backgroundImage=Qy(i),t.title=e.label}else{const t=Fe(this.label,Ve("span.reaction-label"));t.innerText=e.label}if(e.count){const t=Fe(this.label,Ve("span.reaction-count"));t.innerText=`${e.count}`}}getTooltip(){const e=this.action,t=e.enabled?p("comment.toggleableReaction","Toggle reaction, "):"";if(e.count===void 0)return p({key:"comment.reactionLabelNone",comment:["This is a tooltip for an emoji button so that the current user can toggle their reaction to a comment.",`The first arg is localized message "Toggle reaction" or empty if the user doesn't have permission to toggle the reaction, the second is the name of the reaction.`]},"{0}{1} reaction",t,e.label);if(e.count===1)return p({key:"comment.reactionLabelOne",comment:['This is a tooltip for an emoji that is a "reaction" to a comment where the count of the reactions is 1.',"The emoji is also a button so that the current user can also toggle their own emoji reaction.",`The first arg is localized message "Toggle reaction" or empty if the user doesn't have permission to toggle the reaction, the second is the name of the reaction.`]},"{0}1 reaction with {1}",t,e.label);if(e.count>1)return p({key:"comment.reactionLabelMany",comment:['This is a tooltip for an emoji that is a "reaction" to a comment where the count of the reactions is greater than 1.',"The emoji is also a button so that the current user can also toggle their own emoji reaction.",`The first arg is localized message "Toggle reaction" or empty if the user doesn't have permission to toggle the reaction, the second is number of users who have reacted with that reaction, and the third is the name of the reaction.`]},"{0}{1} reactions with {2}",t,e.count,e.label)}}class gI extends Zn{constructor(e,t="",i="",n=!0,s,o,a){super(gI.ID,t,i,n,s),this.icon=o,this.count=a}}gI.ID="toolbar.toggle.reaction";class jV extends tb{async runAction(e,t){await e.run(...t)}}let dO=class extends ne{get domNode(){return this._domNode}constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y){var b;super(),this.commentThread=e,this.comment=t,this.pendingEdit=i,this.owner=n,this.resource=s,this.parentThread=o,this.markdownRenderer=a,this.instantiationService=c,this.commentService=d,this.modelService=l,this.languageService=u,this.notificationService=h,this.contextMenuService=g,this.configurationService=y,this._editAction=null,this._commentEditContainer=null,this._commentEditor=null,this._commentEditorDisposables=[],this._commentEditorModel=null,this._commentFormActions=null,this._commentEditorActions=null,this._onDidClick=new A,this.isEditing=!1,this._domNode=Ve("div.review-comment"),this._contextKeyService=m.createScoped(this._domNode),this._commentContextValue=Xl.commentContext.bindTo(this._contextKeyService),this.comment.contextValue&&this._commentContextValue.set(this.comment.contextValue),this._commentMenus=this.commentService.getCommentMenus(this.owner),this._domNode.tabIndex=-1;const _=Fe(this._domNode,Ve("div.avatar-container"));if(t.userIconPath){const E=Fe(_,Ve("img.avatar"));E.src=wh.uriToBrowserUri(k.revive(t.userIconPath)).toString(!0),E.onerror=D=>E.remove()}this._commentDetailsContainer=Fe(this._domNode,Ve(".review-comment-contents")),this.createHeader(this._commentDetailsContainer),this._body=document.createElement("div"),this._body.classList.add("comment-body",$P),((b=y.getValue(uD))==null?void 0:b.maxHeight)!==!1&&this._body.classList.add("comment-body-max-height"),this.createScroll(this._commentDetailsContainer,this._body),this.updateCommentBody(this.comment.body),this.comment.commentReactions&&this.comment.commentReactions.length&&this.comment.commentReactions.filter(E=>!!E.count).length&&this.createReactionsContainer(this._commentDetailsContainer),this._domNode.setAttribute("aria-label",`${t.userName}, ${this.commentBodyValue}`),this._domNode.setAttribute("role","treeitem"),this._clearTimeout=null,this._register(Ci(this._domNode,sn.CLICK,()=>this.isEditing||this._onDidClick.fire(this))),this._register(Ci(this._domNode,sn.CONTEXT_MENU,E=>this.onContextMenu(E))),i&&this.switchToEditMode()}createScroll(e,t){this._scrollable=new sX({forceIntegerValues:!0,smoothScrollDuration:125,scheduleAtNextAnimationFrame:n=>MH(n)}),this._scrollableElement=this._register(new oX(t,{horizontal:3,vertical:3},this._scrollable)),this._register(this._scrollableElement.onScroll(n=>{n.scrollLeftChanged&&(t.scrollLeft=n.scrollLeft),n.scrollTopChanged&&(t.scrollTop=n.scrollTop)}));const i=this._register(new gk(t,"scroll")).event;this._register(i(n=>{const s=this._scrollableElement.getScrollPosition(),o=Math.abs(t.scrollLeft-s.scrollLeft)<=1?void 0:t.scrollLeft,a=Math.abs(t.scrollTop-s.scrollTop)<=1?void 0:t.scrollTop;(o!==void 0||a!==void 0)&&this._scrollableElement.setScrollPosition({scrollLeft:o,scrollTop:a})})),e.appendChild(this._scrollableElement.getDomNode())}updateCommentBody(e){this._body.innerText="",this._md=void 0,this._plainText=void 0,typeof e=="string"?(this._plainText=Fe(this._body,Ve(".comment-body-plainstring")),this._plainText.innerText=e):(this._md=this.markdownRenderer.render(e).element,this._body.appendChild(this._md))}get onDidClick(){return this._onDidClick.event}createTimestamp(e){this._timestamp=Fe(e,Ve("span.timestamp-container")),this.updateTimestamp(this.comment.timestamp)}updateTimestamp(e){var i;if(!this._timestamp)return;const t=e!==void 0?new Date(e):void 0;t?this._timestampWidget?this._timestampWidget.setTimestamp(t):(this._timestampWidget=new tO(this.configurationService,this._timestamp,t),this._register(this._timestampWidget)):(i=this._timestampWidget)==null||i.dispose()}createHeader(e){const t=Fe(e,Ve(`div.comment-title.${$P}`)),i=Fe(t,Ve("comment-header-info")),n=Fe(i,Ve("strong.author"));n.innerText=this.comment.userName,this.createTimestamp(i),this._isPendingLabel=Fe(i,Ve("span.isPending")),this.comment.label?this._isPendingLabel.innerText=this.comment.label:this._isPendingLabel.innerText="",this._actionsToolbarContainer=Fe(t,Ve(".comment-actions.hidden")),this.createActionsToolbar()}getToolbarActions(e){const t=e.getActions({shouldForwardArgs:!0}),s={primary:[],secondary:[]};return Xve(t,s,!1,o=>/^inline/.test(o)),s}get commentNodeContext(){return[{thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,$mid:10},{commentControlHandle:this.commentThread.controllerHandle,commentThreadHandle:this.commentThread.commentThreadHandle,$mid:7}]}createToolbar(){this.toolbar=new aX(this._actionsToolbarContainer,this.contextMenuService,{actionViewItemProvider:e=>e.id===dl.ID?new jI(e,e.menuActions,this.contextMenuService,{actionViewItemProvider:t=>this.actionViewItemProvider(t),actionRunner:this.actionRunner,classNames:["toolbar-toggle-pickReactions",...Si.asClassNameArray(jt.reactions)],anchorAlignmentProvider:()=>1}):this.actionViewItemProvider(e),orientation:0}),this.toolbar.context=this.commentNodeContext,this.toolbar.actionRunner=new jV,this.registerActionBarListeners(this._actionsToolbarContainer),this._register(this.toolbar)}createActionsToolbar(){const e=[];if(this.commentService.hasReactionHandler(this.owner)){const o=this.createReactionPicker(this.comment.commentReactions||[]);e.push(o)}const i=this._commentMenus.getCommentTitleActions(this.comment,this._contextKeyService);this._register(i),this._register(i.onDidChange(o=>{const{primary:a,secondary:c}=this.getToolbarActions(i);!this.toolbar&&(a.length||c.length)&&this.createToolbar(),this.toolbar.setActions(a,c)}));const{primary:n,secondary:s}=this.getToolbarActions(i);e.push(...n),(e.length||s.length)&&(this.createToolbar(),this.toolbar.setActions(e,s))}actionViewItemProvider(e){let t={};return e.id===dl.ID?t={label:!1,icon:!0}:t={label:!1,icon:!0},e.id===gI.ID?new Yve(e):e instanceof l1?this.instantiationService.createInstance(cX,e,void 0):e instanceof wk?this.instantiationService.createInstance(iG,e,void 0):new wG({},e,t)}async submitComment(){this._commentEditor&&this._commentFormActions&&this._commentFormActions.triggerDefaultAction()}createReactionPicker(e){const t=this._register(new dl(()=>{n==null||n.show()},p("commentToggleReaction","Toggle Reaction")));let i=[];e&&e.length&&(i=e.map(s=>new Zn(`reaction.command.${s.label}`,`${s.label}`,"",!0,async()=>{try{await this.commentService.toggleReaction(this.owner,this.resource,this.commentThread,this.comment,s)}catch(o){const a=o.message?p("commentToggleReactionError","Toggling the comment reaction failed: {0}.",o.message):p("commentToggleReactionDefaultError","Toggling the comment reaction failed");this.notificationService.error(a)}}))),t.menuActions=i;const n=new jI(t,t.menuActions,this.contextMenuService,{actionViewItemProvider:s=>s.id===dl.ID?n:this.actionViewItemProvider(s),actionRunner:this.actionRunner,classNames:"toolbar-toggle-pickReactions",anchorAlignmentProvider:()=>1});return t}createReactionsContainer(e){if(this._reactionActionsContainer=Fe(e,Ve("div.comment-reactions")),this._reactionsActionBar=new Sk(this._reactionActionsContainer,{actionViewItemProvider:i=>i.id===dl.ID?new jI(i,i.menuActions,this.contextMenuService,{actionViewItemProvider:n=>this.actionViewItemProvider(n),actionRunner:this.actionRunner,classNames:["toolbar-toggle-pickReactions",...Si.asClassNameArray(jt.reactions)],anchorAlignmentProvider:()=>1}):this.actionViewItemProvider(i)}),this._register(this._reactionsActionBar),this.commentService.hasReactionHandler(this.owner)){const i=this.createReactionPicker(this.comment.commentReactions||[]);this._reactionsActionBar.push(i,{label:!1,icon:!0})}}get commentBodyValue(){return typeof this.comment.body=="string"?this.comment.body:this.comment.body.value}createCommentEditor(e){const t=Fe(e,Ve(".edit-textarea"));this._commentEditor=this.instantiationService.createInstance(Mm,t,Mm.getEditorOptions(this.configurationService),this._contextKeyService,this.parentThread);const i=k.parse(`comment:commentinput-${this.comment.uniqueIdInThread}-${Date.now()}.md`);this._commentEditorModel=this.modelService.createModel("",this.languageService.createByFilepathOrFirstLine(i),i,!1),this._commentEditor.setModel(this._commentEditorModel),this._commentEditor.setValue(this.pendingEdit??this.commentBodyValue),this.pendingEdit=void 0,this._commentEditor.layout({width:t.clientWidth-14,height:90}),this._commentEditor.focus(),MH(()=>{this._commentEditor.layout({width:t.clientWidth-14,height:90}),this._commentEditor.focus()});const n=this._commentEditorModel.getLineCount(),s=this._commentEditorModel.getLineContent(n).length+1;this._commentEditor.setSelection(new ef(n,s,n,s));const o=this.commentThread;o.input={uri:this._commentEditor.getModel().uri,value:this.commentBodyValue},this.commentService.setActiveCommentThread(o),this._commentEditorDisposables.push(this._commentEditor.onDidFocusEditorWidget(()=>{o.input={uri:this._commentEditor.getModel().uri,value:this.commentBodyValue},this.commentService.setActiveCommentThread(o)})),this._commentEditorDisposables.push(this._commentEditor.onDidChangeModelContent(a=>{if(o.input&&this._commentEditor&&this._commentEditor.getModel().uri===o.input.uri){const c=this._commentEditor.getValue();if(c!==o.input.value){const d=o.input;d.value=c,o.input=d,this.commentService.setActiveCommentThread(o)}}})),this._register(this._commentEditor),this._register(this._commentEditorModel)}getPendingEdit(){var t;const e=(t=this._commentEditor)==null?void 0:t.getModel();if(e&&e.getValueLength()>0)return e.getValue()}removeCommentEditor(){var e;this.isEditing=!1,this._editAction&&(this._editAction.enabled=!0),this._body.classList.remove("hidden"),(e=this._commentEditorModel)==null||e.dispose(),this._commentEditorDisposables.forEach(t=>t.dispose()),this._commentEditorDisposables=[],this._commentEditor&&(this._commentEditor.dispose(),this._commentEditor=null),this._commentEditContainer.remove()}layout(){var s;(s=this._commentEditor)==null||s.layout();const e=this._body.scrollWidth,t=dX(this._body),i=this._body.scrollHeight,n=lX(this._body)+4;this._scrollableElement.setScrollDimensions({width:t,scrollWidth:e,height:n,scrollHeight:i})}switchToEditMode(){if(this.isEditing)return;this.isEditing=!0,this._body.classList.add("hidden"),this._commentEditContainer=Fe(this._commentDetailsContainer,Ve(".edit-container")),this.createCommentEditor(this._commentEditContainer);const e=Fe(this._commentEditContainer,Ve(".form-actions")),t=Fe(e,Ve(".other-actions"));this.createCommentWidgetFormActions(t);const i=Fe(e,Ve(".editor-actions"));this.createCommentWidgetEditorActions(i)}createCommentWidgetFormActions(e){const i=this.commentService.getCommentMenus(this.owner).getCommentActions(this.comment,this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{var n;(n=this._commentFormActions)==null||n.setActions(i)})),this._commentFormActions=new _w(e,n=>{const s=this._commentEditor.getValue();n.run({thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,text:s,$mid:11}),this.removeCommentEditor()}),this._register(this._commentFormActions),this._commentFormActions.setActions(i)}createCommentWidgetEditorActions(e){const i=this.commentService.getCommentMenus(this.owner).getCommentEditorActions(this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{var n;(n=this._commentEditorActions)==null||n.setActions(i)})),this._commentEditorActions=new _w(e,n=>{var o;const s=this._commentEditor.getValue();n.run({thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,text:s,$mid:11}),(o=this._commentEditor)==null||o.focus()}),this._register(this._commentEditorActions),this._commentEditorActions.setActions(i,!0)}setFocus(e,t=!1){var i;e?(this._domNode.focus(),this._actionsToolbarContainer.classList.remove("hidden"),this._actionsToolbarContainer.classList.add("tabfocused"),this._domNode.tabIndex=0,this.comment.mode===PC.Editing&&((i=this._commentEditor)==null||i.focus())):(this._actionsToolbarContainer.classList.contains("tabfocused")&&!this._actionsToolbarContainer.classList.contains("mouseover")&&(this._actionsToolbarContainer.classList.add("hidden"),this._domNode.tabIndex=-1),this._actionsToolbarContainer.classList.remove("tabfocused"))}registerActionBarListeners(e){this._register(Ci(this._domNode,"mouseenter",()=>{e.classList.remove("hidden"),e.classList.add("mouseover")})),this._register(Ci(this._domNode,"mouseleave",()=>{e.classList.contains("mouseover")&&!e.classList.contains("tabfocused")&&e.classList.add("hidden"),e.classList.remove("mouseover")}))}update(e){var i,n;e.body!==this.comment.body&&this.updateCommentBody(e.body);const t=e.mode!==void 0&&e.mode!==this.comment.mode;this.comment=e,t&&(e.mode===PC.Editing?this.switchToEditMode():this.removeCommentEditor()),e.label?this._isPendingLabel.innerText=e.label:this._isPendingLabel.innerText="",(i=this._reactionActionsContainer)==null||i.remove(),(n=this._reactionsActionBar)==null||n.clear(),this.comment.commentReactions&&this.comment.commentReactions.some(s=>!!s.count)&&this.createReactionsContainer(this._commentDetailsContainer),this.comment.contextValue?this._commentContextValue.set(this.comment.contextValue):this._commentContextValue.reset(),this.comment.timestamp&&this.updateTimestamp(this.comment.timestamp)}onContextMenu(e){this.contextMenuService.showContextMenu({getAnchor:()=>e,menuId:Ee.CommentThreadCommentContext,menuActionOptions:{shouldForwardArgs:!0},contextKeyService:this._contextKeyService,actionRunner:new jV,getActionsContext:()=>this.commentNodeContext})}focus(){this.domNode.focus(),this._clearTimeout||(this.domNode.classList.add("focus"),this._clearTimeout=setTimeout(()=>{this.domNode.classList.remove("focus")},3e3))}};dO=T([v(7,Te),v(8,Nd),v(9,_i),v(10,ji),v(11,on),v(12,eo),v(13,It),v(14,We)],dO);function Xve(r,e,t,i=n=>n==="navigation"){for(const n of r){let[s,o]=n;if(t&&(o=o.map(a=>a instanceof l1&&a.alt?a.alt:a)),i(s))(Array.isArray(e)?e:e.primary).unshift(...o);else{const a=Array.isArray(e)?e:e.secondary;a.length>0&&a.push(new bG),a.push(...o)}}}let lO=class extends ne{get length(){return this._commentThread.comments?this._commentThread.comments.length:0}get activeComment(){return this._commentElements.filter(e=>e.isEditing)[0]}constructor(e,t,i,n,s,o,a,c,d,l,u){super(),this.owner=e,this.parentResourceUri=t,this.container=i,this._options=n,this._commentThread=s,this._pendingEdits=o,this._scopedInstatiationService=a,this._parentCommentThreadWidget=c,this.commentService=d,this.openerService=l,this.languageService=u,this._commentElements=[],this._focusedComment=void 0,this._onDidResize=new A,this.onDidResize=this._onDidResize.event,this._commentDisposable=new Map,this._register(Ci(i,sn.FOCUS_IN,h=>{this.commentService.setActiveCommentThread(this._commentThread)})),this._markdownRenderer=this._register(new uX(this._options,this.languageService,this.openerService))}focus(){this._commentsElement.focus()}display(){if(this._commentsElement=Fe(this.container,Ve("div.comments-container")),this._commentsElement.setAttribute("role","presentation"),this._commentsElement.tabIndex=0,this._updateAriaLabel(),this._register(Ci(this._commentsElement,sn.KEY_DOWN,e=>{const t=new e_(e);if(t.equals(16)||t.equals(18)){const i=n=>{if(this._focusedComment===void 0&&n>=0)return 0;if(this._focusedComment===void 0&&n<0)return this._commentElements.length-1;const s=this._focusedComment+n;return Math.min(Math.max(0,s),this._commentElements.length-1)};this._setFocusedComment(t.equals(16)?i(-1):i(1))}})),this._commentElements=[],this._commentThread.comments)for(const e of this._commentThread.comments){const t=this.createNewCommentNode(e);this._commentElements.push(t),this._commentsElement.appendChild(t.domNode),e.mode===PC.Editing&&t.switchToEditMode()}this._resizeObserver=new MutationObserver(this._refresh.bind(this)),this._resizeObserver.observe(this.container,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}_refresh(){const e=TP(this.container);this._onDidResize.fire(e)}getDimensions(){return TP(this.container)}layout(){this._commentElements.forEach(e=>{e.layout()})}getPendingEdits(){const e={};return this._commentElements.forEach(t=>{if(t.isEditing){const i=t.getPendingEdit();i&&(e[t.comment.uniqueIdInThread]=i)}}),e}getCommentCoords(e){const t=this._commentElements.filter(i=>i.comment.uniqueIdInThread===e);if(t&&t.length){const i=LH(this._commentElements[0].domNode),n=LH(t[0].domNode);return{thread:i,comment:n}}}updateCommentThread(e){var d;const t=this._commentElements.length,i=e.comments?e.comments.length:0,n=[],s=[];for(let l=0;l<t;l++){const u=this._commentElements[l].comment,h=e.comments?e.comments.filter(g=>g.uniqueIdInThread===u.uniqueIdInThread):[];h.length?this._commentElements[l].update(h[0]):(s.push(l),n.push(this._commentElements[l]))}for(let l=n.length-1;l>=0;l--){const u=n[l];(d=this._commentDisposable.get(u))==null||d.dispose(),this._commentDisposable.delete(u),this._commentElements.splice(s[l],1),this._commentsElement.removeChild(u.domNode)}let o=null;const a=[],c=[];for(let l=i-1;l>=0;l--){const u=e.comments[l],h=this._commentElements.filter(g=>g.comment.uniqueIdInThread===u.uniqueIdInThread);if(h.length)o=h[0].domNode,a.unshift(h[0]);else{const g=this.createNewCommentNode(u);a.unshift(g),o?(this._commentsElement.insertBefore(g.domNode,o),o=g.domNode):(this._commentsElement.appendChild(g.domNode),o=g.domNode),u.mode===PC.Editing&&(g.switchToEditMode(),c.push(g))}}if(this._commentThread=e,this._commentElements=a,c.length){const l=this._commentElements.indexOf(c[c.length-1]);this._focusedComment=l}this._updateAriaLabel(),this._setFocusedComment(this._focusedComment)}_updateAriaLabel(){var e,t,i;this._commentThread.isDocumentCommentThread()?this._commentThread.range?this._commentsElement.ariaLabel=p("commentThreadAria.withRange","Comment thread with {0} comments on lines {1} through {2}. {3}.",(e=this._commentThread.comments)==null?void 0:e.length,this._commentThread.range.startLineNumber,this._commentThread.range.endLineNumber,this._commentThread.label):this._commentsElement.ariaLabel=p("commentThreadAria.document","Comment thread with {0} comments on the entire document. {1}.",(t=this._commentThread.comments)==null?void 0:t.length,this._commentThread.label):this._commentsElement.ariaLabel=p("commentThreadAria","Comment thread with {0} comments. {1}.",(i=this._commentThread.comments)==null?void 0:i.length,this._commentThread.label)}_setFocusedComment(e){var t;this._focusedComment!==void 0&&((t=this._commentElements[this._focusedComment])==null||t.setFocus(!1)),this._commentElements.length===0||e===void 0?this._focusedComment=void 0:(this._focusedComment=Math.min(e,this._commentElements.length-1),this._commentElements[this._focusedComment].setFocus(!0))}createNewCommentNode(e){const t=this._scopedInstatiationService.createInstance(dO,this._commentThread,e,this._pendingEdits?this._pendingEdits[e.uniqueIdInThread]:void 0,this.owner,this.parentResourceUri,this._parentCommentThreadWidget,this._markdownRenderer);return this._register(t),this._commentDisposable.set(t,t.onDidClick(i=>this._setFocusedComment(this._commentElements.findIndex(n=>n.comment.uniqueIdInThread===i.comment.uniqueIdInThread)))),t}dispose(){super.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this._commentDisposable.forEach(e=>e.dispose())}};lO=T([v(8,Nd),v(9,us),v(10,ji)],lO);const Jve=Tc("review-comment-collapse",jt.chevronUp,p("collapseIcon","Icon to collapse a review comment.")),Zve="expand-review-action "+Si.asClassName(Jve);class eye extends ne{constructor(e,t,i,n,s,o,a){super(),this._delegate=t,this._commentMenus=i,this._commentThread=n,this._contextKeyService=s,this.instantiationService=o,this._contextMenuService=a,this._headElement=Ve(".head"),e.appendChild(this._headElement),this._fillHead()}_fillHead(){const e=Fe(this._headElement,Ve(".review-title"));this._headingLabel=Fe(e,Ve("span.filename")),this.createThreadLabel();const t=Fe(this._headElement,Ve(".review-actions"));this._actionbarWidget=new Sk(t,{actionViewItemProvider:n1.bind(void 0,this.instantiationService)}),this._register(this._actionbarWidget),this._collapseAction=new Zn("review.expand",p("label.collapse","Collapse"),Zve,!0,()=>this._delegate.collapse());const i=this._commentMenus.getCommentThreadTitleActions(this._contextKeyService);this.setActionBarActions(i),this._register(i),this._register(i.onDidChange(n=>{this.setActionBarActions(i)})),this._register(Ci(this._headElement,sn.CONTEXT_MENU,n=>this.onContextMenu(n))),this._actionbarWidget.context=this._commentThread}setActionBarActions(e){const t=e.getActions({shouldForwardArgs:!0}).reduce((i,[,n])=>[...i,...n],[]);this._actionbarWidget.clear(),this._actionbarWidget.push([...t,this._collapseAction],{label:!1,icon:!0})}updateCommentThread(e){this._commentThread=e,this._actionbarWidget.context=this._commentThread,this.createThreadLabel()}createThreadLabel(){let e;e=this._commentThread.label,e===void 0&&(this._commentThread.comments&&this._commentThread.comments.length||(e=p("startThread","Start discussion"))),e&&(this._headingLabel.textContent=lG(e),this._headingLabel.setAttribute("aria-label",e))}updateHeight(e){this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height}onContextMenu(e){const t=this._commentMenus.getCommentThreadTitleContextActions(this._contextKeyService).getActions({shouldForwardArgs:!0}).map(i=>i[1]).flat();t.length&&this._contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>t,actionRunner:new tb,getActionsContext:()=>({commentControlHandle:this._commentThread.controllerHandle,commentThreadHandle:this._commentThread.commentThreadHandle,$mid:7})})}}class tye extends ne{constructor(e,t,i,n,s){super(),this._commentThread=t,this._contextKeyService=i,this._commentMenus=n,this._actionRunDelegate=s,this._container=Fe(e,Ve(".comment-additional-actions")),Fe(this._container,Ve(".section-separator")),this._buttonBar=Fe(this._container,Ve(".button-bar")),this._createAdditionalActions(this._buttonBar)}_showMenu(){var e;(e=this._container)==null||e.classList.remove("hidden")}_hideMenu(){var e;(e=this._container)==null||e.classList.add("hidden")}_enableDisableMenu(e){const t=e.getActions({shouldForwardArgs:!0});for(const i of t){const[,n]=i;for(const s of n){if(s.enabled){this._showMenu();return}for(const o of s.actions??[])if(o.enabled){this._showMenu();return}}}this._hideMenu()}_createAdditionalActions(e){const t=this._commentMenus.getCommentThreadAdditionalActions(this._contextKeyService);this._register(t),this._register(t.onDidChange(()=>{this._commentFormActions.setActions(t,!0),this._enableDisableMenu(t)})),this._commentFormActions=new _w(e,async i=>{var n;(n=this._actionRunDelegate)==null||n.call(this),i.run({thread:this._commentThread,$mid:8})},4),this._register(this._commentFormActions),this._commentFormActions.setActions(t,!0),this._enableDisableMenu(t)}}let uO=class extends ne{get commentThread(){return this._commentThread}constructor(e,t,i,n,s,o,a,c,d,l,u,h,g){super(),this.container=e,this._owner=t,this._parentResourceUri=i,this._contextKeyService=n,this._scopedInstatiationService=s,this._commentThread=o,this._pendingComment=a,this._pendingEdits=c,this._markdownOptions=d,this._commentOptions=l,this._containerDelegate=u,this.commentService=h,this._commentThreadDisposables=[],this._onDidResize=new A,this.onDidResize=this._onDidResize.event,this._threadIsEmpty=Xl.commentThreadIsEmpty.bindTo(this._contextKeyService),this._threadIsEmpty.set(!o.comments||!o.comments.length),this._commentMenus=this.commentService.getCommentMenus(this._owner),this._header=new eye(e,{collapse:this.collapse.bind(this)},this._commentMenus,this._commentThread,this._contextKeyService,this._scopedInstatiationService,g),this._header.updateCommentThread(this._commentThread);const m=Ve(".body");e.appendChild(m),this._body=this._scopedInstatiationService.createInstance(lO,this._owner,this._parentResourceUri,m,this._markdownOptions,this._commentThread,this._pendingEdits,this._scopedInstatiationService,this),this._register(this._body),this._styleElement=Jw(this.container),this._commentThreadContextValue=Xl.commentThreadContext.bindTo(this._contextKeyService),this._commentThreadContextValue.set(o.contextValue);const y=Xl.commentControllerContext.bindTo(this._contextKeyService),_=this.commentService.getCommentController(this._owner);_!=null&&_.contextValue&&y.set(_.contextValue),this.currentThreadListeners()}updateCurrentThread(e,t){e||t?this.commentService.setCurrentCommentThread(this.commentThread):this.commentService.setCurrentCommentThread(void 0)}currentThreadListeners(){let e=!1,t=!1;this._register(Ci(this.container,sn.MOUSE_ENTER,i=>{i.toElement===this.container&&(e=!0,this.updateCurrentThread(e,t))},!0)),this._register(Ci(this.container,sn.MOUSE_LEAVE,i=>{i.fromElement===this.container&&(e=!1,this.updateCurrentThread(e,t))},!0)),this._register(Ci(this.container,sn.FOCUS_IN,()=>{t=!0,this.updateCurrentThread(e,t)},!0)),this._register(Ci(this.container,sn.FOCUS_OUT,()=>{t=!1,this.updateCurrentThread(e,t)},!0))}updateCommentThread(e){var t;this._commentThread=e,vt(this._commentThreadDisposables),this._commentThreadDisposables=[],this._bindCommentThreadListeners(),this._body.updateCommentThread(e),this._threadIsEmpty.set(!this._body.length),this._header.updateCommentThread(e),(t=this._commentReply)==null||t.updateCommentThread(e),this._commentThread.contextValue?this._commentThreadContextValue.set(this._commentThread.contextValue):this._commentThreadContextValue.reset()}display(e){const t=Math.ceil(e*1.2);this._header.updateHeight(t),this._body.display(),this._commentThread.canReply&&this._createCommentForm(),this._createAdditionalActions(),this._register(this._body.onDidResize(i=>{this._refresh(i)})),this._commentThread.canReply&&this._commentReply&&this._commentReply.focusIfNeeded(),this._bindCommentThreadListeners()}_refresh(e){this._body.layout(),this._onDidResize.fire(e)}dispose(){super.dispose(),this.updateCurrentThread(!1,!1)}_bindCommentThreadListeners(){this._commentThreadDisposables.push(this._commentThread.onDidChangeCanReply(()=>{this._commentReply?this._commentReply.updateCanReply():this._commentThread.canReply&&this._createCommentForm()})),this._commentThreadDisposables.push(this._commentThread.onDidChangeComments(async e=>{await this.updateCommentThread(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeLabel(e=>{this._header.createThreadLabel()}))}_createCommentForm(){this._commentReply=this._scopedInstatiationService.createInstance(cO,this._owner,this._body.container,this._commentThread,this._scopedInstatiationService,this._contextKeyService,this._commentMenus,this._commentOptions,this._pendingComment,this,this._containerDelegate.actionRunner),this._register(this._commentReply)}_createAdditionalActions(){this._additionalActions=this._scopedInstatiationService.createInstance(tye,this._body.container,this._commentThread,this._contextKeyService,this._commentMenus,this._containerDelegate.actionRunner),this._register(this._additionalActions)}getCommentCoords(e){return this._body.getCommentCoords(e)}getPendingEdits(){return this._body.getPendingEdits()}getPendingComment(){if(this._commentReply)return this._commentReply.getPendingComment()}getDimensions(){return this._body.getDimensions()}layout(e){var t;this._body.layout(),e!==void 0&&((t=this._commentReply)==null||t.layout(e))}focusCommentEditor(){var e;(e=this._commentReply)==null||e.focusCommentEditor()}focus(){this._body.focus()}async submitComment(){var t,i,n;const e=this._body.activeComment;if(e)return e.submitComment();if((((i=(t=this._commentReply)==null?void 0:t.getPendingComment())==null?void 0:i.length)??0)>0)return(n=this._commentReply)==null?void 0:n.submitComment()}collapse(){this._containerDelegate.collapse()}applyTheme(e,t){var b,E,D,R;const i=[];i.push(`.monaco-editor .review-widget > .body { border-top: 1px solid var(${j8}) }`),i.push(`.monaco-editor .review-widget > .head { background-color: var(${B8}) }`);const n=e.getColor($p);n&&i.push(`.review-widget .body .comment-body a { color: ${n} }`);const s=e.getColor(SG);s&&i.push(`.review-widget .body .comment-body a:hover, a:active { color: ${s} }`);const o=e.getColor(hl);o&&(i.push(`.review-widget .body .comment-body a:focus { outline: 1px solid ${o}; }`),i.push(`.review-widget .body .monaco-editor.focused { outline: 1px solid ${o}; }`));const a=e.getColor(hX);a&&i.push(`.review-widget .body .review-comment blockquote { background: ${a}; }`);const c=e.getColor(fX);c&&i.push(`.review-widget .body .review-comment blockquote { border-color: ${c}; }`);const d=e.getColor(nd);d&&i.push(`.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label { border-color: ${d}; }`);const l=e.getColor(yt);l&&(i.push(`.review-widget .body .comment-form .review-thread-reply-button { outline-color: ${l}; }`),i.push(`.review-widget .body .monaco-editor { outline: 1px solid ${l}; }`));const u=e.getColor(pX);u&&i.push(`.review-widget .validation-error { border: 1px solid ${u}; }`);const h=e.getColor(gX);h&&i.push(`.review-widget .validation-error { background: ${h}; }`);const g=e.getColor(mX);g&&i.push(`.review-widget .body .comment-form .validation-error { color: ${g}; }`);const m="--comment-thread-editor-font-family",y="--comment-thread-editor-font-size",_="--comment-thread-editor-font-weight";(b=this.container)==null||b.style.setProperty(m,t.fontFamily),(E=this.container)==null||E.style.setProperty(y,`${t.fontSize}px`),(D=this.container)==null||D.style.setProperty(_,t.fontWeight),i.push(`.review-widget .body code {
			font-family: var(${m});
			font-weight: var(${_});
		}`),this._styleElement.textContent=i.join(`
`),(R=this._commentReply)==null||R.setCommentEditorDecorations()}};uO=T([v(11,Nd),v(12,eo)],uO);function BV(r,e){return Wve(r,e)??e.getColor(CG)}function iye(r){const e=r.target.range;if(!e||!r.event.leftButton||r.target.type!==4)return null;const t=r.target.detail;return t.offsetX-t.glyphMarginWidth-t.lineNumbersWidth-t.glyphMarginLeft>20?null:{lineNumber:e.startLineNumber}}function nye(r,e){if(!r)return null;const{lineNumber:t}=r;return e.target.range?t:null}let hO=class extends vX{get owner(){return this._owner}get commentThread(){return this._commentThread}get expanded(){return this._isExpanded}constructor(e,t,i,n,s,o,a,c,d){super(e,{keepEditorSelection:!0}),this._owner=t,this._commentThread=i,this._pendingComment=n,this._pendingEdits=s,this.themeService=a,this.commentService=c,this._onDidClose=new A,this._onDidCreateThread=new A,this._globalToDispose=new me,this._commentThreadDisposables=[],this._contextKeyService=d.createScoped(this.domNode),this._scopedInstantiationService=o.createChild(new Of([It,this._contextKeyService]));const l=this.commentService.getCommentController(this._owner);l&&(this._commentOptions=l.options),this._initialCollapsibleState=i.initialCollapsibleState,this._isExpanded=i.initialCollapsibleState===Kn.Expanded,this._commentThreadDisposables=[],this.create(),this._globalToDispose.add(this.themeService.onDidColorThemeChange(this._applyTheme,this)),this._globalToDispose.add(this.editor.onDidChangeConfiguration(u=>{u.hasChanged(48)&&this._applyTheme(this.themeService.getColorTheme())})),this._applyTheme(this.themeService.getColorTheme())}get onDidClose(){return this._onDidClose.event}get onDidCreateThread(){return this._onDidCreateThread.event}getPosition(){if(this.position)return this.position;if(this._commentGlyph)return ii(this._commentGlyph.getPosition().position)}revealRange(){}reveal(e,t=!1){if(this._isExpanded||this.show(this.arrowPosition(this._commentThread.range),2),e!==void 0){const i=this.editor.getLayoutInfo().height,n=this._commentThreadWidget.getCommentCoords(e);if(n){let s=1;if(this._commentThread.range){const o=n.thread,a=n.comment;s=this.editor.getTopForLineNumber(this._commentThread.range.startLineNumber)-i/2+a.top-o.top}this.editor.setScrollTop(s);return}}this.editor.revealRangeInCenter(this._commentThread.range??new qe(1,1,1,1)),t&&this._commentThreadWidget.focus()}getPendingComments(){return{newComment:this._commentThreadWidget.getPendingComment(),edits:this._commentThreadWidget.getPendingEdits()}}_fillContainer(e){this.setCssClass("review-widget"),this._commentThreadWidget=this._scopedInstantiationService.createInstance(uO,e,this._owner,this.editor.getModel().uri,this._contextKeyService,this._scopedInstantiationService,this._commentThread,this._pendingComment,this._pendingEdits,{editor:this.editor,codeBlockFontSize:""},this._commentOptions,{actionRunner:()=>{if(!this._commentThread.comments||!this._commentThread.comments.length){const t=this.getPosition();if(t){const i=this._commentThread.range;if(!i)return;let n;if(t.lineNumber!==i.endLineNumber){const s=t.lineNumber-i.endLineNumber;n=new qe(i.startLineNumber+s,i.startColumn,i.endLineNumber+s,i.endColumn)}else n=new qe(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn);this.commentService.updateCommentThreadTemplate(this.owner,this._commentThread.commentThreadHandle,n)}}},collapse:()=>{this.collapse()}}),this._disposables.add(this._commentThreadWidget)}arrowPosition(e){if(e)return{lineNumber:e.endLineNumber,column:e.endLineNumber===e.startLineNumber?(e.startColumn+e.endColumn+1)/2:1}}deleteCommentThread(){this.dispose(),this.commentService.disposeCommentThread(this.owner,this._commentThread.threadId)}collapse(){this._commentThread.collapsibleState=Kn.Collapsed}expand(){this._commentThread.collapsibleState=Kn.Expanded}getGlyphPosition(){return this._commentGlyph?this._commentGlyph.getPosition().position.lineNumber:0}toggleExpand(){this._isExpanded?this._commentThread.collapsibleState=Kn.Collapsed:this._commentThread.collapsibleState=Kn.Expanded}async update(e){var n;this._commentThread!==e&&(this._commentThreadDisposables.forEach(s=>s.dispose()),this._commentThread=e,this._commentThreadDisposables=[],this.bindCommentThreadListeners()),this._commentThreadWidget.updateCommentThread(e);const t=((n=this._commentThread.range)==null?void 0:n.endLineNumber)??1;let i=!1;this._commentGlyph&&(this._commentGlyph.setThreadState(e.state),this._commentGlyph.getPosition().position.lineNumber!==t&&(i=!0,this._commentGlyph.setLineNumber(t))),i&&this._isExpanded&&this.show(this.arrowPosition(this._commentThread.range),2),this._commentThread.collapsibleState===Kn.Expanded?this.show(this.arrowPosition(this._commentThread.range),2):this.hide()}_onWidth(e){this._commentThreadWidget.layout(e)}_doLayout(e,t){this._commentThreadWidget.layout(t)}display(e){e&&(this._commentGlyph=new rv(this.editor,(e==null?void 0:e.endLineNumber)??-1),this._commentGlyph.setThreadState(this._commentThread.state)),this._commentThreadWidget.display(this.editor.getOption(64)),this._disposables.add(this._commentThreadWidget.onDidResize(t=>{this._refresh(t)})),(this._commentThread.collapsibleState===Kn.Expanded||e===void 0)&&this.show(this.arrowPosition(e),2),this._commentThread.canReply&&this._commentThread.isTemplate&&(!this._commentThread.comments||this._commentThread.comments.length===0)&&this.reveal(),this.bindCommentThreadListeners()}bindCommentThreadListeners(){if(this._commentThreadDisposables.push(this._commentThread.onDidChangeComments(async e=>{await this.update(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeRange(e=>{var n;const t=((n=this._commentThread.range)==null?void 0:n.startLineNumber)??1;let i=!1;this._commentGlyph&&this._commentGlyph.getPosition().position.lineNumber!==t&&(i=!0,this._commentGlyph.setLineNumber(t)),i&&this._isExpanded&&this.show(this.arrowPosition(this._commentThread.range),2)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeCollapsibleState(e=>{if(e===Kn.Expanded&&!this._isExpanded){this.show(this.arrowPosition(this._commentThread.range),2);return}if(e===Kn.Collapsed&&this._isExpanded){this.hide();return}})),this._initialCollapsibleState===void 0){const e=this._commentThread.onDidChangeInitialCollapsibleState(t=>{this._initialCollapsibleState=this._commentThread.range?t:Kn.Expanded,this._commentThread.collapsibleState=this._initialCollapsibleState,e.dispose()});this._commentThreadDisposables.push(e)}this._commentThreadDisposables.push(this._commentThread.onDidChangeState(()=>{var t,i;const e=BV(this._commentThread.state,this.themeService.getColorTheme())||Ue.transparent;this.style({frameColor:e,arrowColor:e}),(t=this.container)==null||t.style.setProperty(j8,`${e}`),(i=this.container)==null||i.style.setProperty(B8,`${e.transparent(.1)}`)}))}async submitComment(){return this._commentThreadWidget.submitComment()}_refresh(e){var t;if(e.height===0&&e.width===0){this.commentThread.collapsibleState=Kn.Collapsed;return}if(this._isExpanded){this._commentThreadWidget.layout();const i=Math.ceil(this.editor.getOption(64)*1.2),n=this.editor.getOption(64),s=Math.round(n/3),o=Math.round(n/9)*2,a=Math.ceil((i+e.height+s+o+8)/n);if(((t=this._viewZone)==null?void 0:t.heightInLines)===a)return;const c=this.getPosition();this._viewZone&&c&&c.lineNumber!==this._viewZone.afterLineNumber&&this._viewZone.afterLineNumber!==0&&(this._viewZone.afterLineNumber=c.lineNumber),(!this._commentThread.comments||!this._commentThread.comments.length)&&this._commentThreadWidget.focusCommentEditor(),this._relayout(a)}}_applyTheme(e){const t=BV(this._commentThread.state,this.themeService.getColorTheme())||Ue.transparent;this.style({arrowColor:t,frameColor:t});const i=this.editor.getOption(48);this._commentThreadWidget.applyTheme(e,i)}show(e,t){this._isExpanded=!0,super.show(e??new qe(0,0,0,0),t),this._commentThread.collapsibleState=Kn.Expanded,this._refresh(this._commentThreadWidget.getDimensions())}hide(){this._isExpanded&&(this._isExpanded=!1,this.editor.hasWidgetFocus()&&this.editor.focus(),(!this._commentThread.comments||!this._commentThread.comments.length)&&this.deleteCommentThread()),super.hide()}dispose(){super.dispose(),this._commentGlyph&&(this._commentGlyph.dispose(),this._commentGlyph=void 0),this._globalToDispose.dispose(),this._commentThreadDisposables.forEach(e=>e.dispose()),this._onDidClose.fire(void 0)}};hO=T([v(5,Te),v(6,Fi),v(7,Nd),v(8,It)],hO);class UV{get id(){return this._decorationId}set id(e){this._decorationId=e}constructor(e,t){this.range=e,this.options=t}}class ww extends ne{constructor(e){super(),this.decorationIds=[],this.activeDecorationIds=[],this.threadCollapseStateListeners=[];const t={description:ww.description,isWholeLine:!1,zIndex:20,className:"comment-thread-range"};this.decorationOptions=ba.createDynamic(t);const i={description:ww.description,isWholeLine:!1,zIndex:20,className:"comment-thread-range-current"};this.activeDecorationOptions=ba.createDynamic(i),this._register(e.onDidChangeCurrentCommentThread(n=>{this.updateCurrent(n)})),this._register(e.onDidUpdateCommentThreads(()=>{this.updateCurrent(void 0)}))}updateCurrent(e){var i,n,s;if(!this.editor||e!=null&&e.resource&&((i=e.resource)==null?void 0:i.toString())!==((n=this.editor.getModel())==null?void 0:n.uri.toString()))return;(s=this.currentThreadCollapseStateListener)==null||s.dispose();const t=[];if(e){const o=e.range;o&&!(o.startLineNumber===o.endLineNumber&&o.startColumn===o.endColumn)&&e.collapsibleState===Kn.Expanded&&(this.currentThreadCollapseStateListener=e.onDidChangeCollapsibleState(a=>{a===Kn.Collapsed&&this.updateCurrent(void 0)}),t.push(new UV(o,this.activeDecorationOptions)))}this.editor.changeDecorations(o=>{this.activeDecorationIds=o.deltaDecorations(this.activeDecorationIds,t),t.forEach((a,c)=>a.id=this.decorationIds[c])})}update(e,t){const i=e==null?void 0:e.getModel();if(!e||!i)return;vt(this.threadCollapseStateListeners),this.editor=e;const n=[];for(const s of t)s.threads.forEach(o=>{if(o.isDisposed)return;const a=o.range;!a||a.startLineNumber===a.endLineNumber&&a.startColumn===a.endColumn||(this.threadCollapseStateListeners.push(o.onDidChangeCollapsibleState(()=>{this.update(e,t)})),o.collapsibleState!==Kn.Collapsed&&n.push(new UV(a,this.decorationOptions)))});e.changeDecorations(s=>{this.decorationIds=s.deltaDecorations(this.decorationIds,n),n.forEach((o,a)=>o.id=this.decorationIds[a])})}dispose(){var e;vt(this.threadCollapseStateListeners),(e=this.currentThreadCollapseStateListener)==null||e.dispose(),super.dispose()}}ww.description="comment-thread-range-decorator";const rye="editor.contrib.review";class Qd{get id(){return this._decorationId}set id(e){this._decorationId=e}get range(){return{startLineNumber:this._startLineNumber,startColumn:1,endLineNumber:this._endLineNumber,endColumn:1}}constructor(e,t,i,n,s,o,a,c=!1){this._editor=e,this._ownerId=t,this._extensionId=i,this._label=n,this._range=s,this.options=o,this.commentingRangesInfo=a,this.isHover=c,this._startLineNumber=s.startLineNumber,this._endLineNumber=s.endLineNumber}getCommentAction(){return{extensionId:this._extensionId,label:this._label,ownerId:this._ownerId,commentingRangesInfo:this.commentingRangesInfo}}getOriginalRange(){return this._range}getActiveRange(){return this.id?this._editor.getModel().getDecorationRange(this.id):void 0}}const og=class og{constructor(){this.commentingRangeDecorations=[],this.decorationIds=[],this._lastHover=-1,this._onDidChangeDecorationsCount=new A,this.onDidChangeDecorationsCount=this._onDidChangeDecorationsCount.event;const e={description:og.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph comment-diff-added"};this.decorationOptions=ba.createDynamic(e);const t={description:og.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph line-hover"};this.hoverDecorationOptions=ba.createDynamic(t);const i={description:og.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph multiline-add"};this.multilineDecorationOptions=ba.createDynamic(i)}updateHover(e){this._editor&&this._infos&&e!==this._lastHover&&this._doUpdate(this._editor,this._infos,e),this._lastHover=e??-1}updateSelection(e,t=new qe(0,0,0,0)){this._lastSelection=t.isEmpty()?void 0:t,this._lastSelectionCursor=t.isEmpty()?void 0:e,this._editor&&this._infos&&this._doUpdate(this._editor,this._infos,e,t)}update(e,t,i,n){e&&(this._editor=e,this._infos=t,this._doUpdate(e,t,i,n))}_lineHasThread(e,t){var i;return(i=e.getDecorationsInRange(t))==null?void 0:i.find(n=>n.options.description===rv.description)}_doUpdate(e,t,i=-1,n=this._lastSelection){if(!e.getModel())return;i=this._lastSelectionCursor??i;const o=[];for(const c of t)c.commentingRanges.ranges.forEach(d=>{const l=new qe(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn);let u=n?l.intersectRanges(n):void 0;if(n&&i>=0&&u&&!(u.startLineNumber===u.endLineNumber&&i===u.startLineNumber)){let h;i<=u.startLineNumber?(h=u.collapseToStart(),u=new qe(u.startLineNumber+1,1,u.endLineNumber,1)):(h=new qe(u.endLineNumber,1,u.endLineNumber,1),u=new qe(u.startLineNumber,1,u.endLineNumber-1,1)),o.push(new Qd(e,c.owner,c.extensionId,c.label,u,this.multilineDecorationOptions,c.commentingRanges,!0)),this._lineHasThread(e,h)||o.push(new Qd(e,c.owner,c.extensionId,c.label,h,this.hoverDecorationOptions,c.commentingRanges,!0));const g=Math.min(h.startLineNumber,u.startLineNumber)-1,m=l.startLineNumber<=g,y=Math.max(h.endLineNumber,u.endLineNumber)+1,_=l.endLineNumber>=y;if(m){const b=new qe(d.startLineNumber,1,g,1);o.push(new Qd(e,c.owner,c.extensionId,c.label,b,this.decorationOptions,c.commentingRanges,!0))}if(_){const b=new qe(y,1,d.endLineNumber,1);o.push(new Qd(e,c.owner,c.extensionId,c.label,b,this.decorationOptions,c.commentingRanges,!0))}}else if(l.startLineNumber<=i&&i<=l.endLineNumber){if(l.startLineNumber<i){const g=new qe(d.startLineNumber,1,i-1,1);o.push(new Qd(e,c.owner,c.extensionId,c.label,g,this.decorationOptions,c.commentingRanges,!0))}const h=new qe(i,1,i,1);if(this._lineHasThread(e,h)||o.push(new Qd(e,c.owner,c.extensionId,c.label,h,this.hoverDecorationOptions,c.commentingRanges,!0)),i<l.endLineNumber){const g=new qe(i+1,1,d.endLineNumber,1);o.push(new Qd(e,c.owner,c.extensionId,c.label,g,this.decorationOptions,c.commentingRanges,!0))}}else o.push(new Qd(e,c.owner,c.extensionId,c.label,d,this.decorationOptions,c.commentingRanges))});e.changeDecorations(c=>{this.decorationIds=c.deltaDecorations(this.decorationIds,o),o.forEach((d,l)=>d.id=this.decorationIds[l])});const a=this.commentingRangeDecorations.length-o.length;this.commentingRangeDecorations=o,a&&this._onDidChangeDecorationsCount.fire(this.commentingRangeDecorations.length)}getMatchedCommentAction(e){var i;if(e===void 0){const n=(i=this._infos)==null?void 0:i.filter(s=>s.commentingRanges.fileComments);return n?n.map(s=>({ownerId:s.owner,extensionId:s.extensionId,label:s.label,commentingRangesInfo:s.commentingRanges})):[]}const t=new Map;for(const n of this.commentingRangeDecorations){const s=n.getActiveRange();if(s&&(s.startLineNumber<=e.startLineNumber||e.endLineNumber<=s.endLineNumber)){const o=n.getCommentAction(),a=t.get(o.ownerId);if((a==null?void 0:a.action.commentingRangesInfo)===o.commentingRangesInfo){const c=new qe(s.startLineNumber<a.range.startLineNumber?s.startLineNumber:a.range.startLineNumber,s.startColumn<a.range.startColumn?s.startColumn:a.range.startColumn,s.endLineNumber>a.range.endLineNumber?s.endLineNumber:a.range.endLineNumber,s.endColumn>a.range.endColumn?s.endColumn:a.range.endColumn);t.set(o.ownerId,{range:c,action:o})}else t.set(o.ownerId,{range:s,action:o})}}return Array.from(t.values()).filter(n=>n.range.startLineNumber<=e.startLineNumber&&e.endLineNumber<=n.range.endLineNumber).map(n=>n.action)}dispose(){this.commentingRangeDecorations=[]}};mi(og,"description","commenting-range-decorator");let hD=og;const sye=new G("activeCursorHasCommentingRange",!1,{description:p("hasCommentingRange","Whether the position at the active cursor has a commenting range"),type:"boolean"});let fD=class{constructor(e,t,i,n,s,o,a,c,d,l){this.commentService=t,this.instantiationService=i,this.codeEditorService=n,this.contextMenuService=s,this.quickInputService=o,this.viewsService=a,this.configurationService=c,this.editorService=l,this.globalToDispose=new me,this.localToDispose=new me,this.mouseDownInfo=null,this._commentingRangeSpaceReserved=!1,this._emptyThreadsToAddQueue=[],this._editorDisposables=[],this._commentInfos=[],this._commentWidgets=[],this._pendingNewCommentCache={},this._pendingEditsCache={},this._computePromise=null,this._activeCursorHasCommentingRange=sye.bindTo(d),!(e instanceof EG)&&(this.editor=e,this._commentingRangeDecorator=new hD,this.globalToDispose.add(this._commentingRangeDecorator.onDidChangeDecorationsCount(u=>{u===0?this.clearEditorListeners():this._editorDisposables.length===0&&this.registerEditorListeners()})),this.globalToDispose.add(this._commentThreadRangeDecorator=new ww(this.commentService)),this.globalToDispose.add(this.commentService.onDidDeleteDataProvider(u=>{u?(delete this._pendingNewCommentCache[u],delete this._pendingEditsCache[u]):(this._pendingNewCommentCache={},this._pendingEditsCache={}),this.beginCompute()})),this.globalToDispose.add(this.commentService.onDidSetDataProvider(u=>this.beginCompute())),this.globalToDispose.add(this.commentService.onDidUpdateCommentingRanges(u=>this.beginCompute())),this.globalToDispose.add(this.commentService.onDidSetResourceCommentInfos(u=>{const h=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;h&&h.toString()===u.resource.toString()&&this.setComments(u.commentInfos.filter(g=>g!==null))})),this.globalToDispose.add(this.commentService.onDidChangeCommentingEnabled(u=>{u?(this.registerEditorListeners(),this.beginCompute()):(this.tryUpdateReservedSpace(),this.clearEditorListeners(),this._commentingRangeDecorator.update(this.editor,[]),this._commentThreadRangeDecorator.update(this.editor,[]),vt(this._commentWidgets),this._commentWidgets=[])})),this.globalToDispose.add(this.editor.onDidChangeModel(u=>this.onModelChanged())),this.globalToDispose.add(this.configurationService.onDidChangeConfiguration(u=>{u.affectsConfiguration("diffEditor.renderSideBySide")&&this.beginCompute()})),this.onModelChanged(),this.codeEditorService.registerDecorationType("comment-controller",G8,{}),this.beginCompute())}registerEditorListeners(){this._editorDisposables=[],this.editor&&(this._editorDisposables.push(this.editor.onMouseMove(e=>this.onEditorMouseMove(e))),this._editorDisposables.push(this.editor.onDidChangeCursorPosition(e=>this.onEditorChangeCursorPosition(e.position))),this._editorDisposables.push(this.editor.onDidFocusEditorWidget(()=>{var e;return this.onEditorChangeCursorPosition(ol((e=this.editor)==null?void 0:e.getPosition()))})),this._editorDisposables.push(this.editor.onDidChangeCursorSelection(e=>this.onEditorChangeCursorSelection(e))),this._editorDisposables.push(this.editor.onDidBlurEditorWidget(()=>this.onEditorChangeCursorSelection())))}clearEditorListeners(){vt(this._editorDisposables),this._editorDisposables=[]}onEditorMouseMove(e){var i;const t=(i=e.target.position)==null?void 0:i.lineNumber;e.event.leftButton.valueOf()&&t&&this.mouseDownInfo?this._commentingRangeDecorator.updateSelection(t,new qe(this.mouseDownInfo.lineNumber,1,t,1)):this._commentingRangeDecorator.updateHover(t)}onEditorChangeCursorSelection(e){var i,n;const t=(n=(i=this.editor)==null?void 0:i.getPosition())==null?void 0:n.lineNumber;t&&this._commentingRangeDecorator.updateSelection(t,e==null?void 0:e.selection)}onEditorChangeCursorPosition(e){var n;const t=e?(n=this.editor)==null?void 0:n.getDecorationsInRange(qe.fromPositions(e,{column:-1,lineNumber:e.lineNumber})):void 0;let i=!1;if(t)for(const s of t)if(s.options.description===rv.description){i=!1;break}else s.options.description===hD.description&&(i=!0);this._activeCursorHasCommentingRange.set(i)}isEditorInlineOriginal(e){return this.configurationService.getValue("diffEditor.renderSideBySide")?!1:!!this.editorService.visibleTextEditorControls.find(i=>i.getEditorType()===yX.IDiffEditor?i.getOriginalEditor()===e:!1)}beginCompute(){return this._computePromise=cd(e=>{const t=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;return t?this.commentService.getDocumentComments(t):Promise.resolve([])}),this._computePromise.then(e=>{this.setComments(fi(e)),this._computePromise=null},e=>console.log(e))}beginComputeCommentingRanges(){this._computeCommentingRangeScheduler&&(this._computeCommentingRangePromise&&(this._computeCommentingRangePromise.cancel(),this._computeCommentingRangePromise=null),this._computeCommentingRangeScheduler.trigger(()=>{const e=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;return e?this.commentService.getDocumentComments(e):Promise.resolve([])}).then(e=>{var t,i,n;if(this.commentService.isCommentingEnabled){const s=fi(e);this._commentingRangeDecorator.update(this.editor,s,(i=(t=this.editor)==null?void 0:t.getPosition())==null?void 0:i.lineNumber,ii((n=this.editor)==null?void 0:n.getSelection()))}},e=>(en(e),null)))}static get(e){return e.getContribution(rye)}revealCommentThread(e,t,i){const n=this._commentWidgets.filter(s=>s.commentThread.threadId===e);n.length===1?n[0].reveal(t):i&&(this._computePromise?this._computePromise.then(s=>{this.revealCommentThread(e,t,!1)}):this.beginCompute().then(s=>{this.revealCommentThread(e,t,!1)}))}collapseAll(){for(const e of this._commentWidgets)e.collapse()}expandAll(){for(const e of this._commentWidgets)e.expand()}expandUnresolved(){for(const e of this._commentWidgets)e.commentThread.state===Ks.Unresolved&&e.expand()}nextCommentThread(){this._findNearestCommentThread()}_findNearestCommentThread(e){var o;if(!this._commentWidgets.length||!((o=this.editor)!=null&&o.hasModel()))return;const t=this.editor.getSelection().getEndPosition(),i=this._commentWidgets.sort((a,c)=>{if(e){const d=a;a=c,c=d}return a.commentThread.range===void 0?-1:c.commentThread.range===void 0?1:a.commentThread.range.startLineNumber<c.commentThread.range.startLineNumber?-1:a.commentThread.range.startLineNumber>c.commentThread.range.startLineNumber?1:a.commentThread.range.startColumn<c.commentThread.range.startColumn?-1:a.commentThread.range.startColumn>c.commentThread.range.startColumn?1:0}),n=_X(i,a=>{var h,g,m,y;const c=e?t.lineNumber:((h=a.commentThread.range)==null?void 0:h.startLineNumber)??0,d=e?((g=a.commentThread.range)==null?void 0:g.startLineNumber)??0:t.lineNumber,l=e?t.column:((m=a.commentThread.range)==null?void 0:m.startColumn)??0,u=e?((y=a.commentThread.range)==null?void 0:y.startColumn)??0:t.column;return c>d?!0:c<d?!1:l>u});let s;n===this._commentWidgets.length?s=this._commentWidgets[0]:s=i[n],this.editor.setSelection(s.commentThread.range??new qe(1,1,1,1)),s.reveal(void 0,!0)}previousCommentThread(){this._findNearestCommentThread(!0)}dispose(){this.globalToDispose.dispose(),this.localToDispose.dispose(),vt(this._editorDisposables),vt(this._commentWidgets),this.editor=null}onModelChanged(){this.localToDispose.clear(),this.removeCommentWidgetsAndStoreCache(),this.editor&&(this.localToDispose.add(this.editor.onMouseDown(e=>this.onEditorMouseDown(e))),this.localToDispose.add(this.editor.onMouseUp(e=>this.onEditorMouseUp(e))),this._editorDisposables.length&&(this.clearEditorListeners(),this.registerEditorListeners()),this._computeCommentingRangeScheduler=new Jq(200),this.localToDispose.add({dispose:()=>{var e;(e=this._computeCommentingRangeScheduler)==null||e.cancel(),this._computeCommentingRangeScheduler=null}}),this.localToDispose.add(this.editor.onDidChangeModelContent(async()=>{this.beginComputeCommentingRanges()})),this.localToDispose.add(this.commentService.onDidUpdateCommentThreads(async e=>{const t=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;if(!t||!this.commentService.isCommentingEnabled)return;this._computePromise&&await this._computePromise;const i=this._commentInfos.filter(a=>a.owner===e.owner);if(!i||!i.length)return;const n=e.added.filter(a=>a.resource&&a.resource.toString()===t.toString()),s=e.removed.filter(a=>a.resource&&a.resource.toString()===t.toString()),o=e.changed.filter(a=>a.resource&&a.resource.toString()===t.toString());s.forEach(a=>{const c=this._commentWidgets.filter(l=>l.owner===e.owner&&l.commentThread.threadId===a.threadId&&l.commentThread.threadId!=="");if(c.length){const l=c[0],u=this._commentWidgets.indexOf(l);this._commentWidgets.splice(u,1),l.dispose()}const d=this._commentInfos.filter(l=>l.owner===e.owner)[0].threads;for(let l=0;l<d.length;l++)d[l]===a&&(d.splice(l,1),l--)}),o.forEach(a=>{const c=this._commentWidgets.filter(d=>d.owner===e.owner&&d.commentThread.threadId===a.threadId);c.length&&(c[0].update(a),this.openCommentsView(a))}),n.forEach(a=>{if(this._commentWidgets.filter(h=>h.owner===e.owner&&h.commentThread.threadId===a.threadId).length)return;const d=this._commentWidgets.filter(h=>h.owner===e.owner&&h.commentThread.commentThreadHandle===-1&&qe.equalsRange(h.commentThread.range,a.range));if(d.length){d[0].update(a);return}const l=this._pendingNewCommentCache[e.owner]&&this._pendingNewCommentCache[e.owner][a.threadId],u=this._pendingEditsCache[e.owner]&&this._pendingEditsCache[e.owner][a.threadId];this.displayCommentThread(e.owner,a,l,u),this._commentInfos.filter(h=>h.owner===e.owner)[0].threads.push(a),this.tryUpdateReservedSpace()}),this._commentThreadRangeDecorator.update(this.editor,i)})),this.beginCompute())}async openCommentsView(e){var t;if(e.comments&&e.comments.length>0){if(this.configurationService.getValue(uD).openView==="file")return this.viewsService.openView(cn);if(this.configurationService.getValue(uD).openView==="firstFile"&&!((t=this.viewsService.getViewWithId(cn))==null?void 0:t.hasRendered))return this.viewsService.openView(cn)}}displayCommentThread(e,t,i,n){if(!this.editor||this.isEditorInlineOriginal(this.editor))return;const s=this.instantiationService.createInstance(hO,this.editor,e,t,i,n);s.display(t.range),this._commentWidgets.push(s),this.openCommentsView(t)}onEditorMouseDown(e){this.mouseDownInfo=iye(e)}onEditorMouseUp(e){const t=nye(this.mouseDownInfo,e);if(this.mouseDownInfo=null,!this.editor||t===null||!e.target.element)return;const i=e.target.element.className.indexOf("comment-range-glyph")>=0,n=e.target.position.lineNumber;let s,o;t!==n?t>n?o=new qe(t,this.editor.getModel().getLineLength(t)+1,n,1):o=new qe(t,1,n,this.editor.getModel().getLineLength(n)+1):i&&(o=this.editor.getSelection()),o&&o.startLineNumber<=n&&n<=o.endLineNumber?(s=o,this.editor.setSelection(new qe(o.endLineNumber,1,o.endLineNumber,1))):i&&(s=new qe(n,1,n,1)),s&&this.addOrToggleCommentAtLine(s,e)}async addOrToggleCommentAtLine(e,t){if(this._addInProgress)this._emptyThreadsToAddQueue.push([e,t]);else{this._addInProgress=!0;const i=this._commentWidgets.filter(n=>n.getGlyphPosition()===(e?e.endLineNumber:0));if(i.length){const n=i.every(s=>s.expanded);i.forEach(n?s=>s.collapse():s=>s.expand()),this.processNextThreadToAdd();return}else this.addCommentAtLine(e,t)}}processNextThreadToAdd(){this._addInProgress=!1;const e=this._emptyThreadsToAddQueue.shift();e&&this.addOrToggleCommentAtLine(e[0],e[1])}addCommentAtLine(e,t){var n;const i=this._commentingRangeDecorator.getMatchedCommentAction(e);if(!i.length||!((n=this.editor)!=null&&n.hasModel()))return this._addInProgress=!1,Promise.resolve();if(i.length>1)if(t&&e){const s={x:t.event.posx,y:t.event.posy};return this.contextMenuService.showContextMenu({getAnchor:()=>s,getActions:()=>this.getContextMenuActions(i,e),getActionsContext:()=>i.length?i[0]:void 0,onHide:()=>{this._addInProgress=!1}}),Promise.resolve()}else{const s=this.getCommentProvidersQuickPicks(i);return this.quickInputService.pick(s,{placeHolder:p("pickCommentService","Select Comment Provider"),matchOnDescription:!0}).then(o=>{if(!o)return;const a=i.filter(c=>c.ownerId===o.id);if(a.length){const{ownerId:c}=a[0];this.addCommentAtLine2(e,c)}}).then(()=>{this._addInProgress=!1})}else{const{ownerId:s}=i[0];this.addCommentAtLine2(e,s)}return Promise.resolve()}getCommentProvidersQuickPicks(e){return e.map(i=>{const{ownerId:n,extensionId:s,label:o}=i;return{label:o||s,id:n}})}getContextMenuActions(e,t){const i=[];return e.forEach(n=>{const{ownerId:s,extensionId:o,label:a}=n;i.push(new Zn("addCommentThread",`${a||o}`,void 0,!0,()=>(this.addCommentAtLine2(t,s),Promise.resolve())))}),i}addCommentAtLine2(e,t){this.editor&&(this.commentService.createCommentThreadTemplate(t,this.editor.getModel().uri,e),this.processNextThreadToAdd())}getExistingCommentEditorOptions(e){const t=e.getOption(63);let i=[];const n=e.getRawOptions().extraEditorClassName;return n&&(i=n.split(" ")),{lineDecorationsWidth:t,extraEditorClassName:i}}getWithoutCommentsEditorOptions(e,t,i){let n=i;const s=t.findIndex(a=>a==="inline-comment");s>=0&&t.splice(s,1);const o=e.getOptions();return o.get(41)&&o.get(107)!=="never"&&(n+=11),n-=24,{extraEditorClassName:t,lineDecorationsWidth:n}}getWithCommentsEditorOptions(e,t,i){let n=i;const s=e.getOptions();return s.get(41)&&s.get(107)!=="never"&&(n-=11),n+=24,t.push("inline-comment"),{lineDecorationsWidth:n,extraEditorClassName:t}}updateEditorLayoutOptions(e,t,i){e.updateOptions({extraEditorClassName:t.join(" "),lineDecorationsWidth:i})}tryUpdateReservedSpace(){if(!this.editor)return;const e=this._commentInfos.some(t=>!!(t.commentingRanges&&(Array.isArray(t.commentingRanges)?t.commentingRanges:t.commentingRanges.ranges).length)||t.threads.length>0);if(e&&!this._commentingRangeSpaceReserved&&this.commentService.isCommentingEnabled){this._commentingRangeSpaceReserved=!0;const{lineDecorationsWidth:t,extraEditorClassName:i}=this.getExistingCommentEditorOptions(this.editor),n=this.getWithCommentsEditorOptions(this.editor,i,t);this.updateEditorLayoutOptions(this.editor,n.extraEditorClassName,n.lineDecorationsWidth)}else if((!e||!this.commentService.isCommentingEnabled)&&this._commentingRangeSpaceReserved){this._commentingRangeSpaceReserved=!1;const{lineDecorationsWidth:t,extraEditorClassName:i}=this.getExistingCommentEditorOptions(this.editor),n=this.getWithoutCommentsEditorOptions(this.editor,i,t);this.updateEditorLayoutOptions(this.editor,n.extraEditorClassName,n.lineDecorationsWidth)}}setComments(e){!this.editor||!this.commentService.isCommentingEnabled||(this._commentInfos=e,this.tryUpdateReservedSpace(),this.removeCommentWidgetsAndStoreCache(),this._commentInfos.forEach(t=>{const i=this._pendingNewCommentCache[t.owner],n=this._pendingEditsCache[t.owner];t.threads=t.threads.filter(s=>!s.isDisposed),t.threads.forEach(s=>{let o;i&&(o=i[s.threadId]);let a;n&&(a=n[s.threadId]),(o||a)&&(s.collapsibleState=Kn.Expanded),this.displayCommentThread(t.owner,s,o,a)})}),this._commentingRangeDecorator.update(this.editor,this._commentInfos),this._commentThreadRangeDecorator.update(this.editor,this._commentInfos))}closeWidget(){var e;(e=this._commentWidgets)==null||e.forEach(t=>t.hide()),this.editor&&(this.editor.focus(),this.editor.revealRangeInCenter(this.editor.getSelection()))}removeCommentWidgetsAndStoreCache(){this._commentWidgets&&this._commentWidgets.forEach(e=>{const t=e.getPendingComments(),i=t.newComment,n=this._pendingNewCommentCache[e.owner];let s;if(e.commentThread.comments&&e.commentThread.comments.length){const c=e.commentThread.comments[e.commentThread.comments.length-1];typeof c.body=="string"?s=c.body:s=c.body.value}i&&i!==s?(n||(this._pendingNewCommentCache[e.owner]={}),this._pendingNewCommentCache[e.owner][e.commentThread.threadId]=i):n&&delete n[e.commentThread.threadId];const o=t.edits,a=this._pendingEditsCache[e.owner];Object.keys(o).length>0?(a||(this._pendingEditsCache[e.owner]={}),this._pendingEditsCache[e.owner][e.commentThread.threadId]=o):a&&delete a[e.commentThread.threadId],e.dispose()}),this._commentWidgets=[]}};fD=T([v(1,Nd),v(2,Te),v(3,En),v(4,eo),v(5,ss),v(6,ko),v(7,We),v(8,It),v(9,Ke)],fD);const aW=new G("commentsView.hasComments",!1),cW=new G("commentsView.someCommentsExpanded",!1),oye="commentsViewState";function VV(r){return Go.map(r.resourceCommentThreads,e=>{const t=Go.from(e.commentThreads),i=Go.map(t,n=>({element:n}));return{element:e,children:i}})}let fO=class extends vF{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y){const _=new Rn(oye,y),b=_.getMemento(1,1);super({...e,filterOptions:{placeholder:p("comments.filter.placeholder","Filter (e.g. text, author)"),ariaLabel:p("comments.filter.ariaLabel","Filter comments"),history:b.filterHistory||[],text:b.filter||"",focusContextKey:oW.key}},c,a,s,o,i,t,d,l,h),this.editorService=n,this.commentService=u,this.uriIdentityService=g,this.activityService=m,this.totalComments=0,this.totalUnresolved=0,this.activity=this._register(new Hr),this.currentHeight=0,this.currentWidth=0,this.cachedFilterStats=void 0,this.onDidChangeVisibility=this.onDidChangeBodyVisibility,this.hasCommentsContextKey=aW.bindTo(o),this.someCommentsExpandedContextKey=cW.bindTo(o),this.stateMemento=_,this.viewState=b,this.filters=this._register(new Vve({showResolved:this.viewState.showResolved!==!1,showUnresolved:this.viewState.showUnresolved!==!1},this.contextKeyService)),this.filter=new Uve(new Yc(this.filterWidget.getFilterText(),this.filters.showResolved,this.filters.showUnresolved)),this._register(this.filters.onDidChange(E=>{(E.showResolved||E.showUnresolved)&&this.updateFilter()})),this._register(this.filterWidget.onDidChangeFilterText(()=>this.updateFilter()))}updateBadge(e){if(e===this.totalUnresolved)return;this.totalUnresolved=e;const t=p("totalUnresolvedComments","{0} Unresolved Comments",this.totalUnresolved);this.activity.value=this.activityService.showViewActivity(this.id,{badge:new Wce(this.totalUnresolved,()=>t)})}saveState(){this.viewState.filter=this.filterWidget.getFilterText(),this.viewState.filterHistory=this.filterWidget.getHistory(),this.viewState.showResolved=this.filters.showResolved,this.viewState.showUnresolved=this.filters.showUnresolved,this.stateMemento.saveMemento(),super.saveState()}focusFilter(){this.filterWidget.focus()}clearFilterText(){this.filterWidget.setFilterText("")}getFilterStats(){var e;return this.cachedFilterStats||(this.cachedFilterStats={total:this.totalComments,filtered:((e=this.tree)==null?void 0:e.getVisibleItemCount())??0}),this.cachedFilterStats}updateFilter(){var i;this.filter.options=new Yc(this.filterWidget.getFilterText(),this.filters.showResolved,this.filters.showUnresolved),(i=this.tree)==null||i.filterComments(),this.cachedFilterStats=void 0;const{total:e,filtered:t}=this.getFilterStats();this.filterWidget.updateBadge(e===t||e===0?void 0:p("showing filtered results","Showing {0} of {1}",t,e)),this.filterWidget.checkMoreFilters(!this.filters.showResolved||!this.filters.showUnresolved)}renderBody(e){super.renderBody(e),e.classList.add("comments-panel");const t=Fe(e,Ve(".comments-panel-container"));this.treeContainer=Fe(t,Ve(".tree-container")),this.treeContainer.classList.add("file-icon-themable-tree","show-file-icons"),this.commentsModel=new Pm,this.cachedFilterStats=void 0,this.createTree(),this.createMessageBox(t),this._register(this.commentService.onDidSetAllCommentThreads(this.onAllCommentsChanged,this)),this._register(this.commentService.onDidUpdateCommentThreads(this.onCommentsUpdated,this)),this._register(this.commentService.onDidDeleteDataProvider(this.onDataProviderDeleted,this));const i=Jw(e);this.applyStyles(i),this._register(this.themeService.onDidColorThemeChange(n=>this.applyStyles(i))),this._register(this.onDidChangeBodyVisibility(n=>{n&&this.refresh()})),this.renderComments()}focus(){this.tree&&this.tree.getHTMLElement()===document.activeElement||(!this.commentsModel.hasCommentThreads()&&this.messageBoxContainer?this.messageBoxContainer.focus():this.tree&&this.tree.domFocus())}applyStyles(e){const t=[],i=this.themeService.getColorTheme(),n=i.getColor($p);n&&t.push(`.comments-panel .comments-panel-container a { color: ${n}; }`);const s=i.getColor(SG);s&&t.push(`.comments-panel .comments-panel-container a:hover, a:active { color: ${s}; }`);const o=i.getColor(hl);o&&t.push(`.comments-panel .comments-panel-container a:focus { outline-color: ${o}; }`);const a=i.getColor(wX);a&&t.push(`.comments-panel .comments-panel-container .text code { color: ${a}; }`),e.textContent=t.join(`
`)}async renderComments(){var e;this.treeContainer.classList.toggle("hidden",!this.commentsModel.hasCommentThreads()),this.renderMessage(),await((e=this.tree)==null?void 0:e.setChildren(null,VV(this.commentsModel)))}collapseAll(){this.tree&&(this.tree.collapseAll(),this.tree.setSelection([]),this.tree.setFocus([]),this.tree.domFocus(),this.tree.focusFirst())}expandAll(){this.tree&&(this.tree.expandAll(),this.tree.setSelection([]),this.tree.setFocus([]),this.tree.domFocus(),this.tree.focusFirst())}get hasRendered(){return!!this.tree}layoutBodyContent(e=this.currentHeight,t=this.currentWidth){var i;this.messageBoxContainer&&(this.messageBoxContainer.style.height=`${e}px`),(i=this.tree)==null||i.layout(e,t),this.currentHeight=e,this.currentWidth=t}createMessageBox(e){this.messageBoxContainer=Fe(e,Ve(".message-box-container")),this.messageBoxContainer.setAttribute("tabIndex","0")}renderMessage(){this.messageBoxContainer.textContent=this.commentsModel.getMessage(),this.messageBoxContainer.classList.toggle("hidden",this.commentsModel.hasCommentThreads())}createTree(){this.treeLabels=this._register(this.instantiationService.createInstance(Am,this)),this.tree=this._register(this.instantiationService.createInstance(aO,this.treeLabels,this.treeContainer,{overrideStyles:{listBackground:this.getBackgroundColor()},selectionNavigation:!0,filter:this.filter,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:e=>{}},accessibilityProvider:{getAriaLabel(e){return e instanceof Pm?p("rootCommentsLabel","Comments for current workspace"):e instanceof kr?p("resourceWithCommentThreadsLabel","Comments in {0}, full path {1}",Mt(e.resource),e.resource.fsPath):e instanceof Rm?e.range?p("resourceWithCommentLabel","Comment from ${0} at line {1} column {2} in {3}, source: {4}",e.comment.userName,e.range.startLineNumber,e.range.startColumn,Mt(e.resource),typeof e.comment.body=="string"?e.comment.body:e.comment.body.value):p("resourceWithCommentLabelFile","Comment from ${0} in {1}, source: {2}",e.comment.userName,Mt(e.resource),typeof e.comment.body=="string"?e.comment.body:e.comment.body.value):""},getWidgetAriaLabel(){return rO}}})),this._register(this.tree.onDidOpen(e=>{this.openFile(e.element,e.editorOptions.pinned,e.editorOptions.preserveFocus,e.sideBySide)})),this._register(this.tree.onDidChangeModel(()=>{this.updateSomeCommentsExpanded()})),this._register(this.tree.onDidChangeCollapseState(()=>{this.updateSomeCommentsExpanded()}))}openFile(e,t,i,n){if(!e||!(e instanceof kr||e instanceof Rm))return!1;this.commentService.isCommentingEnabled||this.commentService.enableCommenting(!0);const s=e instanceof kr?e.commentThreads[0].range:e.range,o=this.editorService.activeTextEditorControl,a=s1(o)?[o.getOriginalEditor(),o.getModifiedEditor()]:o?[o]:[];for(const l of a){const u=l.getModel();if(u instanceof bX&&this.uriIdentityService.extUri.isEqual(e.resource,u.uri)){const h=e instanceof kr?e.commentThreads[0].threadId:e.threadId,g=e instanceof kr?e.commentThreads[0].comment.uniqueIdInThread:e.comment.uniqueIdInThread;if(h&&Ch(l)){const m=fD.get(l);m==null||m.revealCommentThread(h,g,!0)}return!0}}const c=e instanceof kr?e.commentThreads[0].threadId:e.threadId,d=e instanceof kr?e.commentThreads[0].comment:e.comment;return this.editorService.openEditor({resource:e.resource,options:{pinned:t,preserveFocus:i,selection:s??new qe(1,1,1,1)}},n?Ed:Vl).then(l=>{if(l){const u=l.getControl();if(c&&Ch(u)){const h=fD.get(u);h==null||h.revealCommentThread(c,d.uniqueIdInThread,!0)}}}),!0}async refresh(){var e;if(this.tree&&this.isVisible()&&(this.hasCommentsContextKey.set(this.commentsModel.hasCommentThreads()),this.treeContainer.classList.toggle("hidden",!this.commentsModel.hasCommentThreads()),this.cachedFilterStats=void 0,this.renderMessage(),(e=this.tree)==null||e.setChildren(null,VV(this.commentsModel)),this.tree.getSelection().length===0&&this.commentsModel.hasCommentThreads())){const t=this.commentsModel.resourceCommentThreads[0].commentThreads[0];t&&(this.tree.setFocus([t]),this.tree.setSelection([t]))}}onAllCommentsChanged(e){this.cachedFilterStats=void 0,this.commentsModel.setCommentThreads(e.ownerId,e.commentThreads),this.totalComments+=e.commentThreads.length;let t=0;for(const i of e.commentThreads)i.state===Ks.Unresolved&&t++;this.updateBadge(t),this.refresh()}onCommentsUpdated(e){this.cachedFilterStats=void 0;const t=this.commentsModel.updateCommentThreads(e);this.totalComments+=e.added.length,this.totalComments-=e.removed.length;let i=0;for(const n of this.commentsModel.resourceCommentThreads)for(const s of n.commentThreads)s.threadState===Ks.Unresolved&&i++;this.updateBadge(i),t&&this.refresh()}onDataProviderDeleted(e){this.cachedFilterStats=void 0,this.commentsModel.deleteCommentsByOwner(e),this.totalComments=0,this.refresh()}updateSomeCommentsExpanded(){this.someCommentsExpandedContextKey.set(this.isSomeCommentsExpanded())}areAllCommentsExpanded(){if(!this.tree)return!1;const e=this.tree.navigate();for(;e.next();)if(this.tree.isCollapsed(e.current()))return!1;return!0}isSomeCommentsExpanded(){if(!this.tree)return!1;const e=this.tree.navigate();for(;e.next();)if(!this.tree.isCollapsed(e.current()))return!0;return!1}};fO=T([v(1,Te),v(2,to),v(3,Ke),v(4,We),v(5,It),v(6,eo),v(7,Ts),v(8,us),v(9,Fi),v(10,Nd),v(11,gi),v(12,Hi),v(13,b3),v(14,ri)],fO);Gt.registerCommand({id:"workbench.action.focusCommentsPanel",handler:async r=>{r.get(ko).openView(cn,!0)}});Nt(class extends Yf{constructor(){super({viewId:cn,id:"comments.collapse",title:p("collapseAll","Collapse All"),f1:!1,icon:jt.collapseAll,menu:{id:Ee.ViewTitle,group:"navigation",when:nt.and(nt.and(nt.equals("view",cn),aW),cW),order:100}})}runInView(e,t){t.collapseAll()}});Nt(class extends Yf{constructor(){super({viewId:cn,id:"comments.expand",title:p("expandAll","Expand All"),f1:!1,icon:jt.expandAll,menu:{id:Ee.ViewTitle,group:"navigation",when:nt.and(nt.and(nt.equals("view",cn),aW),nt.not(cW.key)),order:100}})}runInView(e,t){t.expandAll()}});class aye{get input(){return this._input}set input(e){this._input=e,this._onDidChangeInput.fire(e)}get onDidChangeInput(){return this._onDidChangeInput.event}get label(){return this._label}set label(e){this._label=e,this._onDidChangeLabel.fire(this._label)}get contextValue(){return this._contextValue}set contextValue(e){this._contextValue=e}get comments(){return this._comments}set comments(e){this._comments=e,this._onDidChangeComments.fire(this._comments)}get onDidChangeComments(){return this._onDidChangeComments.event}set range(e){this._range=e,this._onDidChangeRange.fire(this._range)}get range(){return this._range}get onDidChangeCanReply(){return this._onDidChangeCanReply.event}set canReply(e){this._canReply=e,this._onDidChangeCanReply.fire(this._canReply)}get canReply(){return this._canReply}get collapsibleState(){return this._collapsibleState}set collapsibleState(e){this._collapsibleState=e,this._onDidChangeCollapsibleState.fire(this._collapsibleState)}get initialCollapsibleState(){return this._initialCollapsibleState}set initialCollapsibleState(e){this._initialCollapsibleState=e,this.collapsibleState===void 0&&(this.collapsibleState=this.initialCollapsibleState),this._onDidChangeInitialCollapsibleState.fire(e)}get isDisposed(){return this._isDisposed}isDocumentCommentThread(){return this._range===void 0||qe.isIRange(this._range)}get state(){return this._state}set state(e){this._state=e,this._onDidChangeState.fire(this._state)}get isTemplate(){return this._isTemplate}constructor(e,t,i,n,s,o,a,c){this.commentThreadHandle=e,this.controllerHandle=t,this.extensionId=i,this.threadId=n,this.resource=s,this._range=o,this._canReply=a,this._isTemplate=c,this._onDidChangeInput=new A,this._onDidChangeLabel=new A,this.onDidChangeLabel=this._onDidChangeLabel.event,this._onDidChangeComments=new A,this._onDidChangeCanReply=new A,this._onDidChangeRange=new A,this.onDidChangeRange=this._onDidChangeRange.event,this._onDidChangeCollapsibleState=new A,this.onDidChangeCollapsibleState=this._onDidChangeCollapsibleState.event,this._onDidChangeInitialCollapsibleState=new A,this.onDidChangeInitialCollapsibleState=this._onDidChangeInitialCollapsibleState.event,this._onDidChangeState=new A,this.onDidChangeState=this._onDidChangeState.event,this._isDisposed=!1,c&&(this.comments=[])}batchUpdate(e){const t=i=>Object.prototype.hasOwnProperty.call(e,i);t("range")&&(this._range=e.range),t("label")&&(this._label=e.label),t("contextValue")&&(this._contextValue=e.contextValue===null?void 0:e.contextValue),t("comments")&&(this._comments=e.comments),t("collapseState")&&(this.initialCollapsibleState=e.collapseState),t("canReply")&&(this.canReply=e.canReply),t("state")&&(this.state=e.state),t("isTemplate")&&(this._isTemplate=e.isTemplate)}dispose(){this._isDisposed=!0,this._onDidChangeCollapsibleState.dispose(),this._onDidChangeComments.dispose(),this._onDidChangeInput.dispose(),this._onDidChangeLabel.dispose(),this._onDidChangeRange.dispose(),this._onDidChangeState.dispose()}toJSON(){return{$mid:7,commentControlHandle:this.controllerHandle,commentThreadHandle:this.commentThreadHandle}}}class cye{get handle(){return this._handle}get id(){return this._id}get contextValue(){return this._id}get proxy(){return this._proxy}get label(){return this._label}get reactions(){return this._reactions}set reactions(e){this._reactions=e}get options(){return this._features.options}get features(){return this._features}constructor(e,t,i,n,s,o,a){this._proxy=e,this._commentService=t,this._handle=i,this._uniqueId=n,this._id=s,this._label=o,this._features=a,this._threads=new Map}updateFeatures(e){this._features=e}createCommentThread(e,t,i,n,s,o){const a=new aye(t,this.handle,e,i,k.revive(n).toString(),s,!0,o);return this._threads.set(t,a),a.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[a],removed:[],changed:[]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[a],removed:[],changed:[]}),a}updateCommentThread(e,t,i,n){const s=this.getKnownThread(e);s.batchUpdate(n),s.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[],removed:[],changed:[s]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[],removed:[],changed:[s]})}deleteCommentThread(e){const t=this.getKnownThread(e);this._threads.delete(e),t.dispose(),t.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[],removed:[t],changed:[]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[],removed:[t],changed:[]})}deleteCommentThreadMain(e){this._threads.forEach(t=>{t.threadId===e&&this._proxy.$deleteCommentThread(this._handle,t.commentThreadHandle)})}updateInput(e){const t=this.activeCommentThread;if(t&&t.input){const i=t.input;i.value=e,t.input=i}}updateCommentingRanges(){this._commentService.updateCommentingRanges(this._uniqueId)}getKnownThread(e){const t=this._threads.get(e);if(!t)throw new Error("unknown thread");return t}async getDocumentComments(e,t){if(e.scheme===pe.vscodeNotebookCell)return{owner:this._uniqueId,label:this.label,threads:[],commentingRanges:{resource:e,ranges:[],fileComments:!1}};const i=[];for(const s of[...this._threads.keys()]){const o=this._threads.get(s);o.resource===e.toString()&&i.push(o)}const n=await this._proxy.$provideCommentingRanges(this.handle,e,t);return{owner:this._uniqueId,label:this.label,threads:i,commentingRanges:{resource:e,ranges:(n==null?void 0:n.ranges)||[],fileComments:n==null?void 0:n.fileComments}}}async getNotebookComments(e,t){if(e.scheme!==pe.vscodeNotebookCell)return{owner:this._uniqueId,label:this.label,threads:[]};const i=[];for(const n of[...this._threads.keys()]){const s=this._threads.get(n);s.resource===e.toString()&&i.push(s)}return{owner:this._uniqueId,label:this.label,threads:i}}async toggleReaction(e,t,i,n,s){return this._proxy.$toggleReaction(this._handle,t.commentThreadHandle,e,i,n)}getAllComments(){const e=[];for(const t of[...this._threads.keys()])e.push(this._threads.get(t));return e}createCommentThreadTemplate(e,t){this._proxy.$createCommentThreadTemplate(this.handle,e,t)}async updateCommentThreadTemplate(e,t){await this._proxy.$updateCommentThreadTemplate(this.handle,e,t)}toJSON(){return{$mid:6,handle:this.handle}}}const qV=Tc("comments-view-icon",jt.commentDiscussion,p("commentsViewIcon","View icon of the comments view."));let GV=class extends ne{constructor(e,t,i,n){super(),this._commentService=t,this._viewsService=i,this._viewDescriptorService=n,this._handlers=new Map,this._commentControllers=new Map,this._activeCommentThreadDisposables=this._register(new me),this._openViewListener=null,this._proxy=e.getProxy(fe.ExtHostComments),this._commentService.unregisterCommentController(),this._register(this._commentService.onDidChangeActiveCommentThread(async s=>{const o=s.controllerHandle,a=this._commentControllers.get(o);a&&(this._activeCommentThreadDisposables.clear(),this._activeCommentThread=s,a.activeCommentThread=this._activeCommentThread)}))}$registerCommentController(e,t,i){const n=Nn();this._handlers.set(e,n);const s=new cye(this._proxy,this._commentService,e,n,t,i,{});this._commentService.registerCommentController(n,s),this._commentControllers.set(e,s);const o=!!this._viewDescriptorService.getViewDescriptorById(cn);o||this.registerView(o),this.registerViewListeners(o),this._commentService.setWorkspaceComments(String(e),[])}$unregisterCommentController(e){const t=this._handlers.get(e);this._handlers.delete(e),this._commentControllers.delete(e),typeof t=="string"&&this._commentService.unregisterCommentController(t)}$updateCommentControllerFeatures(e,t){const i=this._commentControllers.get(e);i&&i.updateFeatures(t)}$createCommentThread(e,t,i,n,s,o,a){const c=this._commentControllers.get(e);if(c)return c.createCommentThread(o.value,t,i,n,s,a)}$updateCommentThread(e,t,i,n,s){const o=this._commentControllers.get(e);if(o)return o.updateCommentThread(t,i,n,s)}$deleteCommentThread(e,t){const i=this._commentControllers.get(e);if(i)return i.deleteCommentThread(t)}$updateCommentingRanges(e){const t=this._commentControllers.get(e);t&&t.updateCommentingRanges()}registerView(e){if(!e){const t=st.as(Xo.ViewContainersRegistry).registerViewContainer({id:cn,title:rO,ctorDescriptor:new er(vw,[cn,{mergeViewWithContainerWhenSingleView:!0}]),storageId:jve,hideIfEmpty:!0,icon:qV,order:10},1);st.as(Xo.ViewsRegistry).registerViews([{id:cn,name:rO,canToggleVisibility:!1,ctorDescriptor:new er(fO),canMoveView:!0,containerIcon:qV,focusCommand:{id:"workbench.action.focusCommentsPanel"}}],t)}}setComments(){[...this._commentControllers.keys()].forEach(e=>{const t=this._commentControllers.get(e).getAllComments();if(t.length){const i=this.getHandler(e);this._commentService.setWorkspaceComments(i,t)}})}registerViewOpenedListener(){this._openViewListener||(this._openViewListener=this._viewsService.onDidChangeViewVisibility(e=>{e.id===cn&&e.visible&&(this.setComments(),this._openViewListener&&(this._openViewListener.dispose(),this._openViewListener=null))}))}registerViewListeners(e){e||this.registerViewOpenedListener(),this._register(this._viewDescriptorService.onDidChangeContainer(t=>{t.views.find(i=>i.id===cn)&&(this.setComments(),this.registerViewOpenedListener())})),this._register(this._viewDescriptorService.onDidChangeContainerLocation(t=>{const i=this._viewDescriptorService.getViewContainerByViewId(cn);t.viewContainer.id===(i==null?void 0:i.id)&&(this.setComments(),this.registerViewOpenedListener())}))}getHandler(e){if(!this._handlers.has(e))throw new Error("Unknown handler");return this._handlers.get(e)}};GV=T([gt(ce.MainThreadComments),v(1,Nd),v(2,ko),v(3,to)],GV);var Gs;(function(r){function e(g){return{mime:g.mime,valueBytes:g.data}}r.toNotebookOutputItemDto=e;function t(g){return{outputId:g.outputId,metadata:g.metadata,items:g.outputs.map(e)}}r.toNotebookOutputDto=t;function i(g){return{cellKind:g.cellKind,language:g.language,mime:g.mime,source:g.source,internalMetadata:g.internalMetadata,metadata:g.metadata,outputs:g.outputs.map(t)}}r.toNotebookCellDataDto=i;function n(g){return{metadata:g.metadata,cells:g.cells.map(i)}}r.toNotebookDataDto=n;function s(g){return{mime:g.mime,data:g.valueBytes}}r.fromNotebookOutputItemDto=s;function o(g){return{outputId:g.outputId,metadata:g.metadata,outputs:g.items.map(s)}}r.fromNotebookOutputDto=o;function a(g){return{cellKind:g.cellKind,language:g.language,mime:g.mime,source:g.source,outputs:g.outputs.map(o),metadata:g.metadata,internalMetadata:g.internalMetadata}}r.fromNotebookCellDataDto=a;function c(g){return{metadata:g.metadata,cells:g.cells.map(a)}}r.fromNotebookDataDto=c;function d(g){return{handle:g.handle,uri:g.uri,source:g.textBuffer.getLinesContent(),eol:g.textBuffer.getEOL(),language:g.language,cellKind:g.cellKind,outputs:g.outputs.map(t),metadata:g.metadata,internalMetadata:g.internalMetadata}}r.toNotebookCellDto=d;function l(g){return g.editType===xl.Output?{editType:g.editType,cellHandle:g.cellHandle,append:g.append,outputs:g.outputs.map(o)}:g.editType===xl.OutputItems?{editType:g.editType,append:g.append,outputId:g.outputId,items:g.items.map(s)}:g}r.fromCellExecuteUpdateDto=l;function u(g){return g}r.fromCellExecuteCompleteDto=u;function h(g){return g.editType===1?{editType:g.editType,index:g.index,count:g.count,cells:g.cells.map(a)}:g}r.fromCellEditOperationDto=h})(Gs||(Gs={}));let zV=class{constructor(e,t,i,n){this._notebookService=t,this._cellStatusBarService=i,this._logService=n,this._disposables=new me,this._notebookSerializer=new Map,this._notebookCellStatusBarRegistrations=new Map,this._proxy=e.getProxy(fe.ExtHostNotebook)}dispose(){this._disposables.dispose(),vt(this._notebookSerializer.values())}$registerNotebookSerializer(e,t,i,n,s){const o=new me;o.add(this._notebookService.registerNotebookSerializer(i,t,{options:n,dataToNotebook:async a=>{const c=new Tr;let d;if(a.byteLength===0&&i==="interactive")d=Gs.fromNotebookDataDto({cells:[],metadata:{}});else{const l=await this._proxy.$dataToNotebook(e,a,_t.None);d=Gs.fromNotebookDataDto(l.value)}return this._logService.trace(`[NotebookSerializer] dataToNotebook DONE after ${c.elapsed()}ms`,{viewType:i,extensionId:t.id.value}),d},notebookToData:a=>{const c=new Tr,d=this._proxy.$notebookToData(e,new rs(Gs.toNotebookDataDto(a)),_t.None);return this._logService.trace(`[NotebookSerializer] notebookToData DONE after ${c.elapsed()}`,{viewType:i,extensionId:t.id.value}),d},save:async(a,c,d,l)=>({...await this._proxy.$saveNotebook(e,a,c,d,l),children:void 0,resource:a})})),s&&o.add(this._notebookService.registerContributedNotebookType(i,s)),this._notebookSerializer.set(e,o),this._logService.trace("[NotebookSerializer] registered notebook serializer",{viewType:i,extensionId:t.id.value})}$unregisterNotebookSerializer(e){var t;(t=this._notebookSerializer.get(e))==null||t.dispose(),this._notebookSerializer.delete(e)}$emitCellStatusBarEvent(e){const t=this._notebookCellStatusBarRegistrations.get(e);t instanceof A&&t.fire(void 0)}async $registerNotebookCellStatusBarItemProvider(e,t,i){const n=this,s={async provideCellStatusBarItems(a,c,d){const l=await n._proxy.$provideNotebookCellStatusBarItems(e,a,c,d);return{items:(l==null?void 0:l.items)??[],dispose(){l&&n._proxy.$releaseNotebookCellStatusBarItems(l.cacheId)}}},viewType:i};if(typeof t=="number"){const a=new A;this._notebookCellStatusBarRegistrations.set(t,a),s.onDidChangeStatusBarItems=a.event}const o=this._cellStatusBarService.registerCellStatusBarItemProvider(s);this._notebookCellStatusBarRegistrations.set(e,o)}async $unregisterNotebookCellStatusBarItemProvider(e,t){const i=n=>{var o;this._notebookCellStatusBarRegistrations.get(n)&&((o=this._notebookCellStatusBarRegistrations.get(n))==null||o.dispose(),this._notebookCellStatusBarRegistrations.delete(n))};i(e),typeof t=="number"&&i(t)}};zV=T([gt(ce.MainThreadNotebook),v(1,qf),v(2,W4),v(3,ze)],zV);Gt.registerCommand("_executeDataToNotebook",async(r,...e)=>{const[t,i]=e;yo(typeof t=="string","string"),yo(i instanceof De,"VSBuffer");const s=await r.get(qf).withNotebookDataProvider(t);if(!(s instanceof S$))return;const o=await s.serializer.dataToNotebook(i);return new rs(Gs.toNotebookDataDto(o))});Gt.registerCommand("_executeNotebookToData",async(r,...e)=>{const[t,i]=e;yo(typeof t=="string","string"),yo(typeof i=="object");const s=await r.get(qf).withNotebookDataProvider(t);if(!(s instanceof S$))return;const o=Gs.fromNotebookDataDto(i.value);return await s.serializer.notebookToData(o)});class dye{get preloadUris(){return this.preloads.map(e=>e.uri)}get preloadProvides(){return this.preloads.map(e=>e.provides).flat()}constructor(e,t){var i;this._languageService=t,this._onDidChange=new A,this.onDidChange=this._onDidChange.event,this.id=e.id,this.viewType=e.notebookType,this.extension=e.extensionId,this.implementsInterrupt=e.supportsInterrupt??!1,this.label=e.label,this.description=e.description,this.detail=e.detail,this.supportedLanguages=Pr(e.supportedLanguages)?e.supportedLanguages:t.getRegisteredLanguageIds(),this.implementsExecutionOrder=e.supportsExecutionOrder??!1,this.localResourceRoot=k.revive(e.extensionLocation),this.preloads=((i=e.preloads)==null?void 0:i.map(n=>({uri:k.revive(n.uri),provides:n.provides})))??[]}update(e){const t=Object.create(null);e.label!==void 0&&(this.label=e.label,t.label=!0),e.description!==void 0&&(this.description=e.description,t.description=!0),e.detail!==void 0&&(this.detail=e.detail,t.detail=!0),e.supportedLanguages!==void 0&&(this.supportedLanguages=Pr(e.supportedLanguages)?e.supportedLanguages:this._languageService.getRegisteredLanguageIds(),t.supportedLanguages=!0),e.supportsExecutionOrder!==void 0&&(this.implementsExecutionOrder=e.supportsExecutionOrder,t.hasExecutionOrder=!0),e.supportsInterrupt!==void 0&&(this.implementsInterrupt=e.supportsInterrupt,t.hasInterruptHandler=!0),this._onDidChange.fire(t)}}class lye{constructor(e){this.notebookType=e}}let KV=class{constructor(e,t,i,n,s,o){this._languageService=t,this._notebookKernelService=i,this._notebookExecutionStateService=n,this._notebookService=s,this._editors=new mr,this._disposables=new me,this._kernels=new Map,this._kernelDetectionTasks=new Map,this._kernelSourceActionProviders=new Map,this._kernelSourceActionProvidersEventRegistrations=new Map,this._executions=new Map,this._notebookExecutions=new Map,this._proxy=e.getProxy(fe.ExtHostNotebookKernels),o.listNotebookEditors().forEach(this._onEditorAdd,this),o.onDidAddNotebookEditor(this._onEditorAdd,this,this._disposables),o.onDidRemoveNotebookEditor(this._onEditorRemove,this,this._disposables),this._disposables.add(ot(()=>{this._executions.forEach(a=>{a.complete({})}),this._notebookExecutions.forEach(a=>a.complete())})),this._disposables.add(this._notebookExecutionStateService.onDidChangeExecution(a=>{var c;a.type===k0.cell&&this._proxy.$cellExecutionChanged(a.notebook,a.cellHandle,(c=a.changed)==null?void 0:c.state)}))}dispose(){this._disposables.dispose();for(const[,e]of this._kernels.values())e.dispose();for(const[,e]of this._kernelDetectionTasks.values())e.dispose();for(const[,e]of this._kernelSourceActionProviders.values())e.dispose();this._editors.dispose()}_onEditorAdd(e){const t=e.onDidReceiveMessage(i=>{if(!e.hasModel())return;const{selected:n}=this._notebookKernelService.getMatchingKernel(e.textModel);if(n){for(const[s,o]of this._kernels)if(o[0]===n){this._proxy.$acceptKernelMessageFromRenderer(s,e.getId(),i.message);break}}});this._editors.set(e,t)}_onEditorRemove(e){this._editors.deleteAndDispose(e)}async $postMessage(e,t,i){const n=this._kernels.get(e);if(!n)throw new Error("kernel already disposed");const[s]=n;let o=!1;for(const[a]of this._editors)if(a.hasModel()&&this._notebookKernelService.getMatchingKernel(a.textModel).selected===s){if(t===void 0)a.postMessage(i),o=!0;else if(a.getId()===t){a.postMessage(i),o=!0;break}}return o}async $addKernel(e,t){const i=this,n=new class extends dye{async executeNotebookCellsRequest(a,c){await i._proxy.$executeCells(e,a,c)}async cancelNotebookCellExecution(a,c){await i._proxy.$cancelCells(e,a,c)}}(t,this._languageService),s=this._notebookKernelService.onDidChangeSelectedNotebooks(a=>{a.oldKernel===n.id?this._proxy.$acceptNotebookAssociation(e,a.notebook,!1):a.newKernel===n.id&&this._proxy.$acceptNotebookAssociation(e,a.notebook,!0)}),o=this._notebookKernelService.registerKernel(n);this._kernels.set(e,[n,Da(s,o)])}$updateKernel(e,t){const i=this._kernels.get(e);i&&i[0].update(t)}$removeKernel(e){const t=this._kernels.get(e);t&&(t[1].dispose(),this._kernels.delete(e))}$updateNotebookPriority(e,t,i){const n=this._kernels.get(e);n&&this._notebookKernelService.updateKernelNotebookAffinity(n[0],k.revive(t),i)}$createExecution(e,t,i,n){var d;const s=k.revive(i),o=this._notebookService.getNotebookTextModel(s);if(!o)throw new Error(`Notebook not found: ${s.toString()}`);const a=this._notebookKernelService.getMatchingKernel(o);if(!a.selected||a.selected.id!==t)throw new Error(`Kernel is not selected: ${(d=a.selected)==null?void 0:d.id} !== ${t}`);const c=this._notebookExecutionStateService.createCellExecution(s,n);c.confirm(),this._executions.set(e,c)}$updateExecution(e,t){const i=t.value;try{const n=this._executions.get(e);n==null||n.update(i.map(Gs.fromCellExecuteUpdateDto))}catch(n){en(n)}}$completeExecution(e,t){try{const i=this._executions.get(e);i==null||i.complete(Gs.fromCellExecuteCompleteDto(t.value))}catch(i){en(i)}finally{this._executions.delete(e)}}$createNotebookExecution(e,t,i){var c;const n=k.revive(i),s=this._notebookService.getNotebookTextModel(n);if(!s)throw new Error(`Notebook not found: ${n.toString()}`);const o=this._notebookKernelService.getMatchingKernel(s);if(!o.selected||o.selected.id!==t)throw new Error(`Kernel is not selected: ${(c=o.selected)==null?void 0:c.id} !== ${t}`);const a=this._notebookExecutionStateService.createExecution(n);a.confirm(),this._notebookExecutions.set(e,a)}$beginNotebookExecution(e){try{const t=this._notebookExecutions.get(e);t==null||t.begin()}catch(t){en(t)}}$completeNotebookExecution(e){try{const t=this._notebookExecutions.get(e);t==null||t.complete()}catch(t){en(t)}finally{this._notebookExecutions.delete(e)}}async $addKernelDetectionTask(e,t){const i=new lye(t),n=this._notebookKernelService.registerNotebookKernelDetectionTask(i);this._kernelDetectionTasks.set(e,[i,n])}$removeKernelDetectionTask(e){const t=this._kernelDetectionTasks.get(e);t&&(t[1].dispose(),this._kernelDetectionTasks.delete(e))}async $addKernelSourceActionProvider(e,t,i){const n={viewType:i,provideKernelSourceActions:async()=>(await this._proxy.$provideKernelSourceActions(e,_t.None)).map(a=>{let c=a.documentation;return a.documentation&&typeof a.documentation!="string"&&(c=k.revive(a.documentation)),{label:a.label,command:a.command,description:a.description,detail:a.detail,documentation:c}})};if(typeof t=="number"){const o=new A;this._kernelSourceActionProvidersEventRegistrations.set(t,o),n.onDidChangeSourceActions=o.event}const s=this._notebookKernelService.registerKernelSourceActionProvider(i,n);this._kernelSourceActionProviders.set(e,[n,s])}$removeKernelSourceActionProvider(e,t){const i=this._kernelSourceActionProviders.get(e);i&&(i[1].dispose(),this._kernelSourceActionProviders.delete(e)),typeof t=="number"&&this._kernelSourceActionProvidersEventRegistrations.delete(t)}$emitNotebookKernelSourceActionsChangeEvent(e){const t=this._kernelSourceActionProvidersEventRegistrations.get(e);t instanceof A&&t.fire(void 0)}};KV=T([gt(ce.MainThreadNotebookKernels),v(1,ji),v(2,H4),v(3,X4),v(4,qf),v(5,zf)],KV);let pO=class{constructor(e,t,i){this._notebookEditorModelResolverService=t,this._uriIdentityService=i,this._disposables=new me,this._documentEventListenersMapping=new ki,this._proxy=e.getProxy(fe.ExtHostNotebookDocuments),this._modelReferenceCollection=new R8(this._uriIdentityService.extUri),this._disposables.add(this._notebookEditorModelResolverService.onDidChangeDirty(n=>this._proxy.$acceptDirtyStateChanged(n.resource,n.isDirty()))),this._disposables.add(this._notebookEditorModelResolverService.onDidSaveNotebook(n=>this._proxy.$acceptModelSaved(n))),this._disposables.add(t.onWillFailWithConflict(n=>{this._modelReferenceCollection.remove(n.resource)}))}dispose(){this._disposables.dispose(),this._modelReferenceCollection.dispose(),vt(this._documentEventListenersMapping.values())}handleNotebooksAdded(e){for(const t of e){const i=new me;i.add(t.onDidChangeContent(n=>{const s={versionId:n.versionId,rawEvents:[]};for(const a of n.rawEvents)switch(a.kind){case _n.ModelChange:s.rawEvents.push({kind:a.kind,changes:a.changes.map(c=>[c[0],c[1],c[2].map(d=>Gs.toNotebookCellDto(d))])});break;case _n.Move:s.rawEvents.push({kind:a.kind,index:a.index,length:a.length,newIdx:a.newIdx});break;case _n.Output:s.rawEvents.push({kind:a.kind,index:a.index,outputs:a.outputs.map(Gs.toNotebookOutputDto)});break;case _n.OutputItem:s.rawEvents.push({kind:a.kind,index:a.index,outputId:a.outputId,outputItems:a.outputItems.map(Gs.toNotebookOutputItemDto),append:a.append});break;case _n.ChangeCellLanguage:case _n.ChangeCellContent:case _n.ChangeCellMetadata:case _n.ChangeCellInternalMetadata:s.rawEvents.push(a);break}const o=n.rawEvents.find(a=>a.kind===_n.ChangeDocumentMetadata);this._proxy.$acceptModelChanged(t.uri,new rs(s),this._notebookEditorModelResolverService.isDirty(t.uri),o?t.metadata:void 0)})),this._documentEventListenersMapping.set(t.uri,i)}}handleNotebooksRemoved(e){var t;for(const i of e)(t=this._documentEventListenersMapping.get(i))==null||t.dispose(),this._documentEventListenersMapping.delete(i)}async $tryCreateNotebook(e){const t=await this._notebookEditorModelResolverService.resolve({untitledResource:void 0},e.viewType);if(t.object.notebook.onWillDispose(()=>{t.dispose()}),this._proxy.$acceptDirtyStateChanged(t.object.resource,!0),e.content){const i=Gs.fromNotebookDataDto(e.content);t.object.notebook.reset(i.cells,i.metadata,t.object.notebook.transientOptions)}return t.object.resource}async $tryOpenNotebook(e){const t=k.revive(e),i=await this._notebookEditorModelResolverService.resolve(t,void 0);return this._modelReferenceCollection.add(t,i),t}async $trySaveNotebook(e){const t=k.revive(e),i=await this._notebookEditorModelResolverService.resolve(t),n=await i.object.save();return i.dispose(),n}};pO=T([v(1,C$),v(2,Hi)],pO);class uye{constructor(e,t){this.editor=e,this.disposables=t}dispose(){this.disposables.dispose()}}let gO=class{constructor(e,t,i,n,s){this._editorService=t,this._notebookEditorService=i,this._editorGroupService=n,this._configurationService=s,this._disposables=new me,this._mainThreadEditors=new Map,this._proxy=e.getProxy(fe.ExtHostNotebookEditors),this._editorService.onDidActiveEditorChange(()=>this._updateEditorViewColumns(),this,this._disposables),this._editorGroupService.onDidRemoveGroup(()=>this._updateEditorViewColumns(),this,this._disposables),this._editorGroupService.onDidMoveGroup(()=>this._updateEditorViewColumns(),this,this._disposables)}dispose(){this._disposables.dispose(),vt(this._mainThreadEditors.values())}handleEditorsAdded(e){for(const t of e){const i=new me;i.add(t.onDidChangeVisibleRanges(()=>{this._proxy.$acceptEditorPropertiesChanged(t.getId(),{visibleRanges:{ranges:t.visibleRanges}})})),i.add(t.onDidChangeSelection(()=>{this._proxy.$acceptEditorPropertiesChanged(t.getId(),{selections:{selections:t.getSelections()}})}));const n=new uye(t,i);this._mainThreadEditors.set(t.getId(),n)}}handleEditorsRemoved(e){var t;for(const i of e)(t=this._mainThreadEditors.get(i))==null||t.dispose(),this._mainThreadEditors.delete(i)}_updateEditorViewColumns(){const e=Object.create(null);for(const t of this._editorService.visibleEditorPanes){const i=fg(t);i&&this._mainThreadEditors.has(i.getId())&&(e[i.getId()]=gu(this._editorGroupService,t.group))}xa(e,this._currentViewColumnInfo)||(this._currentViewColumnInfo=e,this._proxy.$acceptEditorViewColumns(e))}async $tryShowNotebookDocument(e,t,i){const n={cellSelections:i.selections,preserveFocus:i.preserveFocus,pinned:i.pinned,activation:i.preserveFocus?Yy.RESTORE:void 0,override:t},s=await this._editorService.openEditor({resource:k.revive(e),options:n},qh(this._editorGroupService,this._configurationService,i.position)),o=fg(s);if(o)return o.getId();throw new Error(`Notebook Editor creation failure for document ${JSON.stringify(e)}`)}async $tryRevealRange(e,t,i){const n=this._notebookEditorService.getNotebookEditor(e);if(!n)return;const s=n;if(!s.hasModel()||t.start>=s.getLength())return;const o=s.cellAt(t.start);switch(i){case zp.Default:return s.revealCellRangeInView(t);case zp.InCenter:return s.revealInCenter(o);case zp.InCenterIfOutsideViewport:return s.revealInCenterIfOutsideViewport(o);case zp.AtTop:return s.revealInViewAtTop(o)}}$trySetSelections(e,t){const i=this._notebookEditorService.getNotebookEditor(e);i&&(i.setSelections(t),t.length&&i.setFocus({start:t[0].start,end:t[0].start+1}))}};gO=T([v(1,Ke),v(2,zf),v(3,it),v(4,We)],gO);var aC;class QV{static delta(e,t){if(!e)return{addedDocuments:[...t.documents],removedDocuments:[],addedEditors:[...t.textEditors.values()],removedEditors:[],visibleEditors:[...t.visibleEditors].map(a=>a[0])};const i=i1(e.documents,t.documents),n=OP(e.textEditors,t.textEditors),s=e.activeEditor!==t.activeEditor?t.activeEditor:void 0,o=OP(e.visibleEditors,t.visibleEditors);return{addedDocuments:i.added,removedDocuments:i.removed.map(a=>a.uri),addedEditors:n.added,removedEditors:n.removed.map(a=>a.getId()),newActiveEditor:s,visibleEditors:o.added.length===0&&o.removed.length===0?void 0:[...t.visibleEditors].map(a=>a[0])}}constructor(e,t,i,n){this.documents=e,this.textEditors=t,this.activeEditor=i,this.visibleEditors=n}}let YV=aC=class{constructor(e,t,i,n,s,o,a){this._notebookService=i,this._notebookEditorService=n,this._editorService=s,this._editorGroupService=o,this._logService=a,this._disposables=new me,this._editorListeners=new mr,this._proxy=e.getProxy(fe.ExtHostNotebook),this._mainThreadNotebooks=t.createInstance(pO,e),this._mainThreadEditors=t.createInstance(gO,e),e.set(ce.MainThreadNotebookDocuments,this._mainThreadNotebooks),e.set(ce.MainThreadNotebookEditors,this._mainThreadEditors),this._notebookService.onWillAddNotebookDocument(()=>this._updateState(),this,this._disposables),this._notebookService.onDidRemoveNotebookDocument(()=>this._updateState(),this,this._disposables),this._editorService.onDidActiveEditorChange(()=>this._updateState(),this,this._disposables),this._editorService.onDidVisibleEditorsChange(()=>this._updateState(),this,this._disposables),this._notebookEditorService.onDidAddNotebookEditor(this._handleEditorAdd,this,this._disposables),this._notebookEditorService.onDidRemoveNotebookEditor(this._handleEditorRemove,this,this._disposables),this._updateState()}dispose(){this._mainThreadNotebooks.dispose(),this._mainThreadEditors.dispose(),this._disposables.dispose(),this._editorListeners.dispose()}_handleEditorAdd(e){this._editorListeners.set(e.getId(),Da(e.onDidChangeModel(()=>this._updateState()),e.onDidFocusWidget(()=>this._updateState(e)))),this._updateState()}_handleEditorRemove(e){this._editorListeners.deleteAndDispose(e.getId()),this._updateState()}_updateState(e){const t=new Map,i=new Map;for(const a of this._notebookEditorService.listNotebookEditors())a.hasModel()&&t.set(a.getId(),a);const n=fg(this._editorService.activeEditorPane);let s=null;n?s=n.getId():e!=null&&e.textModel&&(s=e.getId()),s&&!t.has(s)&&(this._logService.trace("MainThreadNotebooksAndEditors#_updateState: active editor is not in editors list",s,t.keys()),s=null);for(const a of this._editorService.visibleEditorPanes){const c=fg(a);c!=null&&c.hasModel()&&t.has(c.getId())&&i.set(c.getId(),c)}const o=new QV(new Set(this._notebookService.listNotebookDocuments()),t,s,i);this._onDelta(QV.delta(this._currentState,o)),this._currentState=o}_onDelta(e){if(aC._isDeltaEmpty(e))return;const t={removedDocuments:e.removedDocuments,removedEditors:e.removedEditors,newActiveEditor:e.newActiveEditor,visibleEditors:e.visibleEditors,addedDocuments:e.addedDocuments.map(aC._asModelAddData),addedEditors:e.addedEditors.map(this._asEditorAddData,this)};this._proxy.$acceptDocumentAndEditorsDelta(new rs(t)),this._mainThreadEditors.handleEditorsRemoved(e.removedEditors),this._mainThreadNotebooks.handleNotebooksRemoved(e.removedDocuments),this._mainThreadNotebooks.handleNotebooksAdded(e.addedDocuments),this._mainThreadEditors.handleEditorsAdded(e.addedEditors)}static _isDeltaEmpty(e){return!(e.addedDocuments!==void 0&&e.addedDocuments.length>0||e.removedDocuments!==void 0&&e.removedDocuments.length>0||e.addedEditors!==void 0&&e.addedEditors.length>0||e.removedEditors!==void 0&&e.removedEditors.length>0||e.visibleEditors!==void 0&&e.visibleEditors.length>0||e.newActiveEditor!==void 0)}static _asModelAddData(e){return{viewType:e.viewType,uri:e.uri,metadata:e.metadata,versionId:e.versionId,cells:e.cells.map(Gs.toNotebookCellDto)}}_asEditorAddData(e){const t=this._editorService.visibleEditorPanes.find(i=>fg(i)===e);return{id:e.getId(),documentUri:e.textModel.uri,selections:e.getSelections(),visibleRanges:e.visibleRanges,viewColumn:t&&gu(this._editorGroupService,t.group)}}};YV=aC=T([Eu,v(1,Te),v(2,qf),v(3,zf),v(4,Ke),v(5,it),v(6,ze)],YV);let XV=class extends ne{constructor(e,t){super(),this.messaging=t,this.proxy=e.getProxy(fe.ExtHostNotebookRenderers),this._register(t.onShouldPostMessage(i=>{this.proxy.$postRendererMessage(i.editorId,i.rendererId,i.message)}))}$postMessage(e,t,i){return this.messaging.receiveMessage(e,t,i)}};XV=T([gt(ce.MainThreadNotebookRenderers),v(1,j4)],XV);class hye extends ne{constructor(e,t,i){super(),this._notebookModel=e,this._notebookService=t,this._configurationService=i,this._onDidChangeContent=this._register(new A),this.onDidChangeContent=this._onDidChangeContent.event,this.configuration=void 0,this.onWillDispose=e.onWillDispose.bind(e),this._register(e.onDidChangeContent(n=>{for(const s of n.rawEvents)if(s.kind!==_n.Initialize&&!s.transient){this._onDidChangeContent.fire({isRedoing:!1,isUndoing:!1,isInitial:!1});break}})),e.uri.scheme===pe.vscodeRemote&&(this.configuration={backupDelay:1e4},this._configurationService.getValue("notebook.experimental.remoteSave")&&(this.save=async(n,s)=>{const o=await this.getNotebookSerializer();if(s.isCancellationRequested)throw new yh;return await o.save(this._notebookModel.uri,this._notebookModel.versionId,n,s)}))}dispose(){this._notebookModel.dispose(),super.dispose()}get notebookModel(){return this._notebookModel}async snapshot(e){const t=await this.getNotebookSerializer(),i={metadata:xC(this._notebookModel.metadata,s=>!t.options.transientDocumentMetadata[s]),cells:[]};for(const s of this._notebookModel.cells){const o={cellKind:s.cellKind,language:s.language,mime:s.mime,source:s.getValue(),outputs:[],internalMetadata:s.internalMetadata};o.outputs=t.options.transientOutputs?[]:s.outputs,o.metadata=xC(s.metadata,a=>!t.options.transientCellMetadata[a]),i.cells.push(o)}const n=await t.notebookToData(i);if(e.isCancellationRequested)throw new yh;return jm(n)}async update(e,t){const i=await this.getNotebookSerializer(),n=await yy(e),s=await i.dataToNotebook(n);if(t.isCancellationRequested)throw new yh;this._notebookModel.reset(s.cells,s.metadata,i.options)}async getNotebookSerializer(){const e=await this._notebookService.withNotebookDataProvider(this.notebookModel.viewType);if(!(e instanceof S$))throw new Error("CANNOT open file notebook with this provider");return e.serializer}get versionId(){return this._notebookModel.alternativeVersionId}pushStackElement(){this._notebookModel.pushStackElement("save",void 0,void 0)}}class fye{constructor(e){this._proxy=e.getProxy(fe.ExtHostNotebookDocumentSaveParticipant)}async participate(e,t,i,n){if(!e.model||!(e.model instanceof hye))return;let s;const o=new Promise((a,c)=>{s=setTimeout(()=>c(new Error(p("timeout.onWillSave","Aborted onWillSaveNotebookDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(e.resource,t.reason,n).then(d=>{clearTimeout(s)}).then(a,c)});return mk(o,n)}}let JV=class{constructor(e,t,i){this.workingCopyFileService=i,this._saveParticipantDisposable=this.workingCopyFileService.addSaveParticipant(t.createInstance(fye,e))}dispose(){this._saveParticipantDisposable.dispose()}};JV=T([Eu,v(1,Te),v(2,$a)],JV);let ZV=class{constructor(e,t){this._disposables=new me,this._proxy=e.getProxy(fe.ExtHostInteractive),this._disposables.add(t.onWillAddInteractiveDocument(i=>{this._proxy.$willAddInteractiveDocument(i.inputUri,`
`,fo,i.notebookUri)})),this._disposables.add(t.onWillRemoveInteractiveDocument(i=>{this._proxy.$willRemoveInteractiveDocument(i.inputUri,i.notebookUri)}))}dispose(){this._disposables.dispose()}};ZV=T([gt(ce.MainThreadInteractive),v(1,R$)],ZV);let e2=class{constructor(e,t,i){this._inlineChatService=t,this._uriIdentService=i,this._registrations=new mr,this._proxy=e.getProxy(fe.ExtHostInlineChat)}dispose(){this._registrations.dispose()}async $registerInteractiveEditorProvider(e,t,i){const n=this._inlineChatService.addProvider({debugName:t,prepareInlineChatSession:async(s,o,a)=>{const c=await this._proxy.$prepareSession(e,s.uri,o,a);if(c)return{...c,dispose:()=>{this._proxy.$releaseSession(e,c.id)}}},provideResponse:async(s,o,a)=>{const c=await this._proxy.$provideResponse(e,s,o,a);return(c==null?void 0:c.type)==="bulkEdit"&&(c.edits=Ql(c.edits,this._uriIdentService)),c},handleInlineChatResponseFeedback:i?async(s,o,a)=>{this._proxy.$handleFeedback(e,s.id,o.id,a)}:void 0});this._registrations.set(e,n)}async $unregisterInteractiveEditorProvider(e){this._registrations.deleteAndDispose(e)}};e2=T([gt(ce.MainThreadInlineChat),v(1,B4),v(2,Hi)],e2);let t2=class extends ne{constructor(e,t,i,n){super(),this._chatService=t,this._chatWidgetService=i,this.chatContribService=n,this._providerRegistrations=this._register(new mr),this._activeRequestProgressCallbacks=new Map,this._stateEmitters=new Map,this._proxy=e.getProxy(fe.ExtHostChat),this._register(this._chatService.onDidPerformUserAction(s=>{this._proxy.$onDidPerformUserAction(s)}))}async $registerSlashCommandProvider(e,t){const i=this._chatService.registerSlashCommandProvider({chatProviderId:t,provideSlashCommands:async n=>this._proxy.$provideProviderSlashCommands(e,n),resolveSlashCommand:async(n,s)=>this._proxy.$resolveSlashCommand(e,n,s)});this._providerRegistrations.set(e,i)}async $unregisterSlashCommandProvider(e){this._providerRegistrations.deleteAndDispose(e)}$transferChatSession(e,t){this._chatService.transferChatSession(e,k.revive(t))}async $registerChatProvider(e,t){const i=this.chatContribService.registeredProviders.find(s=>s.id===t);if(!i)throw new Error(`Provider ${t} must be declared in the package.json.`);const n=this._chatService.registerProvider({id:t,displayName:i.label,prepareSession:async(s,o)=>{const a=await this._proxy.$prepareChat(e,s,o);if(!a)return;const c=a.responderAvatarIconUri?k.revive(a.responderAvatarIconUri):i.extensionIcon,d=new A;return this._stateEmitters.set(a.id,d),{id:a.id,requesterUsername:a.requesterUsername,requesterAvatarIconUri:k.revive(a.requesterAvatarIconUri),responderUsername:a.responderUsername,responderAvatarIconUri:c,inputPlaceholder:a.inputPlaceholder,onDidChangeState:d.event,dispose:()=>{d.dispose(),this._stateEmitters.delete(a.id),this._proxy.$releaseSession(a.id)}}},resolveRequest:async(s,o,a)=>{const c=await this._proxy.$resolveRequest(e,s.id,o,a);return{session:s,...c}},provideReply:async(s,o,a)=>{const c=`${e}_${s.session.id}`;this._activeRequestProgressCallbacks.set(c,o);try{const d={message:s.message},l=await this._proxy.$provideReply(e,s.session.id,d,a);return{session:s.session,...l}}finally{this._activeRequestProgressCallbacks.delete(c)}},provideWelcomeMessage:s=>this._proxy.$provideWelcomeMessage(e,s),provideSlashCommands:(s,o)=>this._proxy.$provideSlashCommands(e,s.id,o),provideFollowups:(s,o)=>this._proxy.$provideFollowups(e,s.id,o),removeRequest:(s,o)=>this._proxy.$removeRequest(e,s.id,o)});this._providerRegistrations.set(e,n)}$acceptResponseProgress(e,t,i){var s;const n=`${e}_${t}`;(s=this._activeRequestProgressCallbacks.get(n))==null||s(i)}async $acceptChatState(e,t){var i;(i=this._stateEmitters.get(e))==null||i.fire(t)}$addRequest(e){this._chatService.addRequest(e)}async $sendRequestToProvider(e,t){const i=await this._chatWidgetService.revealViewForProvider(e);i&&i.viewModel&&this._chatService.sendRequestToProvider(i.viewModel.sessionId,t)}async $unregisterChatProvider(e){this._providerRegistrations.deleteAndDispose(e)}};t2=T([gt(ce.MainThreadChat),v(1,D4),v(2,U4),v(3,J4)],t2);const pye={type:"object",additionalProperties:!1,properties:{type:{type:"string",description:p("TaskDefinition.description","The actual task type. Please note that types starting with a '$' are reserved for internal usage.")},required:{type:"array",items:{type:"string"}},properties:{type:"object",description:p("TaskDefinition.properties","Additional properties of the task type"),additionalProperties:{$ref:"http://json-schema.org/draft-07/schema#"}},when:{type:"string",markdownDescription:p("TaskDefinition.when","Condition which must be true to enable this type of task. Consider using `shellExecutionSupported`, `processExecutionSupported`, and `customExecutionSupported` as appropriate for this task definition. See the [API documentation](https://code.visualstudio.com/api/extension-guides/task-provider#when-clause) for more information."),default:""}}};var mO;(function(r){function e(t,i,n){if(!t)return;const s=Rt(t.type)?t.type:void 0;if(!s||s.length===0){n.error(p("TaskTypeConfiguration.noType","The task type configuration is missing the required 'taskType' property"));return}const o=[];if(Array.isArray(t.required))for(const a of t.required)Rt(a)&&o.push(a);return{extensionId:i.value,taskType:s,required:o,properties:t.properties?Gi(t.properties):{},when:t.when?nt.deserialize(t.when):void 0}}r.from=e})(mO||(mO={}));const gye=io.registerExtensionPoint({extensionPoint:"taskDefinitions",activationEventsGenerator:(r,e)=>{for(const t of r)t.type&&e.push(`onTaskType:${t.type}`)},jsonSchema:{description:p("TaskDefinitionExtPoint","Contributes task kinds"),type:"array",items:pye}});class mye{constructor(){this._onDefinitionsChanged=new A,this.onDefinitionsChanged=this._onDefinitionsChanged.event,this.taskTypes=Object.create(null),this.readyPromise=new Promise((e,t)=>{gye.setHandler((i,n)=>{this._schema=void 0;try{for(const s of n.removed){const o=s.value;for(const a of o)this.taskTypes&&a.type&&this.taskTypes[a.type]&&delete this.taskTypes[a.type]}for(const s of n.added){const o=s.value;for(const a of o){const c=mO.from(a,s.description.identifier,s.collector);c&&(this.taskTypes[c.taskType]=c)}}(n.removed.length>0||n.added.length>0)&&this._onDefinitionsChanged.fire()}catch{}e(void 0)})})}onReady(){return this.readyPromise}get(e){return this.taskTypes[e]}all(){return Object.keys(this.taskTypes).map(e=>this.taskTypes[e])}getJsonSchema(){if(this._schema===void 0){const e=[];for(const t of this.all()){const i={type:"object",additionalProperties:!1};t.required.length>0&&(i.required=t.required.slice(0)),t.properties!==void 0?i.properties=Gi(t.properties):i.properties=Object.create(null),i.properties.type={type:"string",enum:[t.taskType]},e.push(i)}this._schema={oneOf:e}}return this._schema}}const vye=new mye,z8="settings",K8="$customized";var bw;(function(r){r.defaults={cwd:"${workspaceFolder}"}})(bw||(bw={}));var Sw;(function(r){r[r.Always=1]="Always",r[r.Silent=2]="Silent",r[r.Never=3]="Never"})(Sw||(Sw={}));(function(r){function e(t){switch(t.toLowerCase()){case"always":return r.Always;case"silent":return r.Silent;case"never":return r.Never;default:return r.Always}}r.fromString=e})(Sw||(Sw={}));var Cw;(function(r){r[r.Never=1]="Never",r[r.OnProblem=2]="OnProblem",r[r.Always=3]="Always"})(Cw||(Cw={}));(function(r){function e(t){switch(t.toLowerCase()){case"always":return r.Always;case"never":return r.Never;case"onproblem":return r.OnProblem;default:return r.OnProblem}}r.fromString=e})(Cw||(Cw={}));var Ew;(function(r){r[r.Shared=1]="Shared",r[r.Dedicated=2]="Dedicated",r[r.New=3]="New"})(Ew||(Ew={}));(function(r){function e(t){switch(t.toLowerCase()){case"shared":return r.Shared;case"dedicated":return r.Dedicated;case"new":return r.New;default:return r.Shared}}r.fromString=e})(Ew||(Ew={}));var pD;(function(r){r.defaults={echo:!0,reveal:Sw.Always,revealProblems:Cw.Never,focus:!1,panel:Ew.Shared,showReuseMessage:!0,clear:!1}})(pD||(pD={}));var go;(function(r){r[r.Shell=1]="Shell",r[r.Process=2]="Process",r[r.CustomExecution=3]="CustomExecution"})(go||(go={}));(function(r){function e(i){switch(i.toLowerCase()){case"shell":return r.Shell;case"process":return r.Process;case"customExecution":return r.CustomExecution;default:return r.Process}}r.fromString=e;function t(i){switch(i){case r.Shell:return"shell";case r.Process:return"process";case r.CustomExecution:return"customExecution";default:return"process"}}r.toString=t})(go||(go={}));var md;(function(r){r.Workspace="workspace",r.Extension="extension",r.InMemory="inMemory",r.WorkspaceFile="workspaceFile",r.User="user";function e(t){switch(t){case r.User:return 2;case r.WorkspaceFile:return 5;default:return 6}}r.toConfigurationTarget=e})(md||(md={}));var vO;(function(r){r[r.default=1]="default",r[r.folderOpen=2]="folderOpen"})(vO||(vO={}));var gD;(function(r){r.defaults={reevaluateOnRerun:!0,runOn:vO.default,instanceLimit:1}})(gD||(gD={}));class dW{constructor(e,t,i,n,s,o){this._label="",this._id=e,t&&(this._label=t),i&&(this.type=i),this.runOptions=n,this.configurationProperties=s,this._source=o}getDefinition(e){}getMapKey(){return this._id}getRecentlyUsedKey(){}getCommonTaskId(){const e={folder:this.getFolderId(),id:this._id};return JSON.stringify(e)}clone(){return this.fromObject(Object.assign({},this))}getWorkspaceFolder(){}getWorkspaceFileName(){}getTelemetryKind(){return"unknown"}matches(e,t=!1){if(e===void 0)return!1;if(Rt(e))return e===this._label||e===this.configurationProperties.identifier||t&&e===this._id;const i=this.getDefinition(!0);return i!==void 0&&i._key===e._key}getQualifiedLabel(){const e=this.getWorkspaceFolder();return e?`${this._label} (${e.name})`:this._label}getTaskExecution(){return{id:this._id,task:this}}addTaskLoadMessages(e){this._taskLoadMessages===void 0&&(this._taskLoadMessages=[]),e&&(this._taskLoadMessages=this._taskLoadMessages.concat(e))}get taskLoadMessages(){return this._taskLoadMessages}}class Ay extends dW{constructor(e,t,i,n,s,o,a,c){super(e,i,void 0,a,c,t),this.command={},this._source=t,this.hasDefinedMatchers=o,s&&(this.command=s)}clone(){return new Ay(this._id,this._source,this._label,this.type,this.command,this.hasDefinedMatchers,this.runOptions,this.configurationProperties)}customizes(){if(this._source&&this._source.customizes)return this._source.customizes}getDefinition(e=!1){if(e&&this._source.customizes!==void 0)return this._source.customizes;{let t;switch(this.command?this.command.runtime:void 0){case go.Shell:t="shell";break;case go.Process:t="process";break;case go.CustomExecution:t="customExecution";break;case void 0:t="$composite";break;default:throw new Error("Unexpected task runtime")}return{type:t,_key:this._id,id:this._id}}}static is(e){return e instanceof Ay}getMapKey(){const e=this._source.config.workspaceFolder;return e?`${e.uri.toString()}|${this._id}|${this.instance}`:`${this._id}|${this.instance}`}getFolderId(){var e;return this._source.kind===md.User?z8:(e=this._source.config.workspaceFolder)==null?void 0:e.uri.toString()}getCommonTaskId(){return this._source.customizes?super.getCommonTaskId():this.getRecentlyUsedKey()??super.getCommonTaskId()}getRecentlyUsedKey(){const e=this.getFolderId();if(!e)return;let t=this.configurationProperties.identifier;return this._source.kind!==md.Workspace&&(t+=this._source.kind),JSON.stringify({type:K8,folder:e,id:t})}getWorkspaceFolder(){return this._source.config.workspaceFolder}getWorkspaceFileName(){return this._source.config.workspace&&this._source.config.workspace.configuration?Mt(this._source.config.workspace.configuration):void 0}getTelemetryKind(){return this._source.customizes?"workspace>extension":"workspace"}fromObject(e){return new Ay(e._id,e._source,e._label,e.type,e.command,e.hasDefinedMatchers,e.runOptions,e.configurationProperties)}}class My extends dW{constructor(e,t,i,n,s,o,a){super(e,i,n,o,a,t),this._source=t,this.configures=s}static is(e){return e instanceof My}fromObject(e){return e}getDefinition(){return this.configures}getWorkspaceFileName(){return this._source.config.workspace&&this._source.config.workspace.configuration?Mt(this._source.config.workspace.configuration):void 0}getWorkspaceFolder(){return this._source.config.workspaceFolder}getFolderId(){var e;return this._source.kind===md.User?z8:(e=this._source.config.workspaceFolder)==null?void 0:e.uri.toString()}getRecentlyUsedKey(){const e=this.getFolderId();if(!e)return;let t=this.configurationProperties.identifier;return this._source.kind!==md.Workspace&&(t+=this._source.kind),JSON.stringify({type:K8,folder:e,id:t})}}class zh extends dW{constructor(e,t,i,n,s,o,a,c,d){super(e,i,n,c,d,t),this.defines=s,this.hasDefinedMatchers=a,this.command=o,this.icon=d.icon,this.hide=d.hide}clone(){return new zh(this._id,this._source,this._label,this.type,this.defines,this.command,this.hasDefinedMatchers,this.runOptions,this.configurationProperties)}getDefinition(){return this.defines}static is(e){return e instanceof zh}getMapKey(){const e=this._source.workspaceFolder;return e?`${this._source.scope.toString()}|${e.uri.toString()}|${this._id}|${this.instance}`:`${this._source.scope.toString()}|${this._id}|${this.instance}`}getFolderId(){if(this._source.scope===3&&this._source.workspaceFolder)return this._source.workspaceFolder.uri.toString()}getRecentlyUsedKey(){const e={type:"contributed",scope:this._source.scope,id:this._id};return e.folder=this.getFolderId(),JSON.stringify(e)}getWorkspaceFolder(){return this._source.workspaceFolder}getTelemetryKind(){return"extension"}fromObject(e){return new zh(e._id,e._source,e._label,e.type,e.defines,e.command,e.hasDefinedMatchers,e.runOptions,e.configurationProperties)}}var mD;(function(r){function e(i){const n=Object.keys(i).sort();let s="";for(const o of n){let a=i[o];a instanceof Object?a=e(a):typeof a=="string"&&(a=a.replace(/,/g,",,")),s+=o+","+a+","}return s}function t(i){const s={_key:e(i),type:i.taskType};return Object.assign(s,i),s}r.create=t})(mD||(mD={}));var yO;(function(r){function e(t,i){const n=vye.get(t.type);if(n===void 0){const c=Gi(t);return delete c._key,mD.create(c)}const s=Object.create(null);s.type=n.taskType;const o=new Set;n.required.forEach(c=>o.add(c));const a=n.properties;for(const c of Object.keys(a)){const d=t[c];if(d!=null)s[c]=d;else if(o.has(c)){const l=a[c];if(l.default!==void 0)s[c]=Gi(l.default);else switch(l.type){case"boolean":s[c]=!1;break;case"number":case"integer":s[c]=0;break;case"string":s[c]="";break;default:i.error(p("TaskDefinition.missingRequiredProperty","Error: the task identifier '{0}' is missing the required property '{1}'. The task identifier will be ignored.",JSON.stringify(t,void 0,0),c));return}}}return mD.create(s)}r.createTaskIdentifier=e})(yO||(yO={}));var vD;(function(r){function e(t){return{id:t.id,task:Ns.from(t.task)}}r.from=e})(vD||(vD={}));var _O;(function(r){function e(t,i){return{id:t.id,processId:i}}r.from=e})(_O||(_O={}));var wO;(function(r){function e(t,i){return{id:t.id,exitCode:i}}r.from=e})(wO||(wO={}));var yD;(function(r){function e(i){const n=Object.assign(Object.create(null),i);return delete n._key,n}r.from=e;function t(i,n){let s=yO.createTaskIdentifier(i,console);return s===void 0&&n&&(s={_key:Nn(),type:"$executeOnly"}),s}r.to=t})(yD||(yD={}));var _D;(function(r){function e(i){if(i!=null)return Object.assign(Object.create(null),i)}r.from=e;function t(i){return i==null?pD.defaults:Object.assign(Object.create(null),pD.defaults,i)}r.to=t})(_D||(_D={}));var wD;(function(r){function e(i){if(i!=null)return Object.assign(Object.create(null),i)}r.from=e;function t(i){return i==null?gD.defaults:Object.assign(Object.create(null),gD.defaults,i)}r.to=t})(wD||(wD={}));var bD;(function(r){function e(i){if(i!=null)return{cwd:i.cwd,env:i.env}}r.from=e;function t(i){return i==null?bw.defaults:{cwd:i.cwd||bw.defaults.cwd,env:i.env}}r.to=t})(bD||(bD={}));var Ly;(function(r){function e(n){const s=n;return s&&!!s.process}r.is=e;function t(n){const s=Rt(n.name)?n.name:n.name.value,o=n.args?n.args.map(c=>Rt(c)?c:c.value):[],a={process:s,args:o};return n.options&&(a.options=bD.from(n.options)),a}r.from=t;function i(n){const s={runtime:go.Process,name:n.process,args:n.args,presentation:void 0};return s.options=bD.to(n.options),s}r.to=i})(Ly||(Ly={}));var SD;(function(r){function e(i){if(i==null)return;const n={cwd:i.cwd||bw.defaults.cwd,env:i.env};return i.shell&&(n.executable=i.shell.executable,n.shellArgs=i.shell.args,n.shellQuoting=i.shell.quoting),n}r.from=e;function t(i){if(i==null)return;const n={cwd:i.cwd,env:i.env};return i.executable&&(n.shell={executable:i.executable},i.shellArgs&&(n.shell.args=i.shellArgs),i.shellQuoting&&(n.shell.quoting=i.shellQuoting)),n}r.to=t})(SD||(SD={}));var Fy;(function(r){function e(n){const s=n;return s&&(!!s.commandLine||!!s.command)}r.is=e;function t(n){const s={};return n.name&&Rt(n.name)&&(n.args===void 0||n.args===null||n.args.length===0)?s.commandLine=n.name:(s.command=n.name,s.args=n.args),n.options&&(s.options=SD.from(n.options)),s}r.from=t;function i(n){const s={runtime:go.Shell,name:n.commandLine?n.commandLine:n.command,args:n.args,presentation:void 0};return n.options&&(s.options=SD.to(n.options)),s}r.to=i})(Fy||(Fy={}));var mh;(function(r){function e(n){const s=n;return s&&s.customExecution==="customExecution"}r.is=e;function t(n){return{customExecution:"customExecution"}}r.from=t;function i(n){return{runtime:go.CustomExecution,presentation:void 0}}r.to=i})(mh||(mh={}));var CD;(function(r){function e(i){const n={label:i.label};return i.kind===md.Extension?(n.extensionId=i.extension,i.workspaceFolder?n.scope=i.workspaceFolder.uri:n.scope=i.scope):i.kind===md.Workspace&&(n.extensionId="$core",n.scope=i.config.workspaceFolder?i.config.workspaceFolder.uri:1),n}r.from=e;function t(i,n){let s,o;return i.scope===void 0||typeof i.scope=="number"&&i.scope!==1?n.getWorkspace().folders.length===0?(s=1,o=void 0):(s=3,o=n.getWorkspace().folders[0]):typeof i.scope=="number"?s=i.scope:(s=3,o=ii(n.getWorkspaceFolder(k.revive(i.scope)))),{kind:md.Extension,label:i.label,extension:i.extensionId,scope:s,workspaceFolder:o}}r.to=t})(CD||(CD={}));var ED;(function(r){function e(t){const i=t;return i&&Rt(i.id)&&!!i.workspaceFolder}r.is=e})(ED||(ED={}));var Ns;(function(r){function e(i){if(i==null||!Ay.is(i)&&!zh.is(i)&&!My.is(i))return;const n={_id:i._id,name:i.configurationProperties.name,definition:yD.from(i.getDefinition(!0)),source:CD.from(i._source),execution:void 0,presentationOptions:!My.is(i)&&i.command?_D.from(i.command.presentation):void 0,isBackground:i.configurationProperties.isBackground,problemMatchers:[],hasDefinedMatchers:zh.is(i)?i.hasDefinedMatchers:!1,runOptions:wD.from(i.runOptions)};if(n.group=bO.from(i.configurationProperties.group),i.configurationProperties.detail&&(n.detail=i.configurationProperties.detail),!My.is(i)&&i.command)switch(i.command.runtime){case go.Process:n.execution=Ly.from(i.command);break;case go.Shell:n.execution=Fy.from(i.command);break;case go.CustomExecution:n.execution=mh.from(i.command);break}if(i.configurationProperties.problemMatchers)for(const s of i.configurationProperties.problemMatchers)Rt(s)&&n.problemMatchers.push(s);return n}r.from=e;function t(i,n,s,o,a){if(!i||typeof i.name!="string")return;let c;if(i.execution&&(Fy.is(i.execution)?c=Fy.to(i.execution):Ly.is(i.execution)?c=Ly.to(i.execution):mh.is(i.execution)&&(c=mh.to(i.execution))),!c)return;c.presentation=_D.to(i.presentationOptions);const d=CD.to(i.source,n),l=p("task.label","{0}: {1}",d.label,i.name),u=yD.to(i.definition,s),h=mh.is(i.execution)&&i._id?i._id:`${i.source.extensionId}.${u._key}`;return new zh(h,d,l,u.type,u,c,i.hasDefinedMatchers,wD.to(i.runOptions),{name:i.name,identifier:l,group:i.group,isBackground:!!i.isBackground,problemMatchers:i.problemMatchers.slice(),detail:i.detail,icon:o,hide:a})}r.to=t})(Ns||(Ns={}));var bO;(function(r){function e(t){if(t!==void 0)return{_id:typeof t=="string"?t:t._id,isDefault:typeof t=="string"||typeof t.isDefault=="string"?!1:t.isDefault}}r.from=e})(bO||(bO={}));var SO;(function(r){function e(i){return i}r.from=e;function t(i){return i}r.to=t})(SO||(SO={}));let i2=class{constructor(e,t,i,n){this._taskService=t,this._workspaceContextServer=i,this._configurationResolverService=n,this._proxy=e.getProxy(fe.ExtHostTask),this._providers=new Map,this._taskService.onDidStateChange(async s=>{var a;const o=s.__task;if(s.kind==="start"){const c=vD.from(o.getTaskExecution());let d=c.task.definition;if((a=c.task)!=null&&a.execution&&mh.is(c.task.execution)&&s.resolvedVariables){const l={};for(const[u,h]of s.resolvedVariables.entries())l[u]=h;d=await this._configurationResolverService.resolveAnyAsync(o.getWorkspaceFolder(),c.task.definition,l)}this._proxy.$onDidStartTask(c,s.terminalId,d)}else s.kind==="processStarted"?this._proxy.$onDidStartTaskProcess(_O.from(o.getTaskExecution(),s.processId)):s.kind==="processEnded"?this._proxy.$onDidEndTaskProcess(wO.from(o.getTaskExecution(),s.exitCode)):s.kind==="end"&&this._proxy.$OnDidEndTask(vD.from(o.getTaskExecution()))})}dispose(){for(const e of this._providers.values())e.disposable.dispose();this._providers.clear()}$createTaskId(e){return new Promise((t,i)=>{const n=Ns.to(e,this._workspaceContextServer,!0);n?t(n._id):i(new Error("Task could not be created from DTO"))})}$registerTaskProvider(e,t){const i={provideTasks:s=>Promise.resolve(this._proxy.$provideTasks(e,s)).then(o=>{const a=[];for(const c of o.tasks){const d=Ns.to(c,this._workspaceContextServer,!0);d?a.push(d):console.error(`Task System: can not convert task: ${JSON.stringify(c.definition,void 0,0)}. Task will be dropped`)}return{tasks:a,extension:o.extension}}),resolveTask:s=>{const o=Ns.from(s);return o?(o.name=o.name===void 0?"":o.name,Promise.resolve(this._proxy.$resolveTask(e,o)).then(a=>{if(a)return Ns.to(a,this._workspaceContextServer,!0,s.configurationProperties.icon,s.configurationProperties.hide)})):Promise.resolve(void 0)}},n=this._taskService.registerTaskProvider(i,t);return this._providers.set(e,{disposable:n,provider:i}),Promise.resolve(void 0)}$unregisterTaskProvider(e){const t=this._providers.get(e);return t&&(t.disposable.dispose(),this._providers.delete(e)),Promise.resolve(void 0)}$fetchTasks(e){return this._taskService.tasks(SO.to(e)).then(t=>{const i=[];for(const n of t){const s=Ns.from(n);s&&i.push(s)}return i})}getWorkspace(e){var i;let t;if(typeof e=="string")t=e;else{const n=this._workspaceContextServer.getWorkspace(),s=k.revive(e);((i=n.configuration)==null?void 0:i.toString())===s.toString()?t=n:t=this._workspaceContextServer.getWorkspaceFolder(s)}return t}async $getTaskExecution(e){if(ED.is(e)){const t=this.getWorkspace(e.workspaceFolder);if(t){const i=await this._taskService.getTask(t,e.id,!0);if(i)return{id:i._id,task:Ns.from(i)};throw new Error("Task not found")}else throw new Error("No workspace folder")}else{const t=Ns.to(e,this._workspaceContextServer,!0);return{id:t._id,task:Ns.from(t)}}}$executeTask(e){return new Promise((t,i)=>{if(ED.is(e)){const n=this.getWorkspace(e.workspaceFolder);n?this._taskService.getTask(n,e.id,!0).then(s=>{if(!s)i(new Error("Task not found"));else{const o={id:e.id,task:Ns.from(s)};this._taskService.run(s).then(a=>{((a==null?void 0:a.exitCode)===void 0||a.exitCode!==0)&&this._proxy.$OnDidEndTask(o)},a=>{}),t(o)}},s=>{i(new Error("Task not found"))}):i(new Error("No workspace folder"))}else{const n=Ns.to(e,this._workspaceContextServer,!0);this._taskService.run(n).then(void 0,o=>{});const s={id:n._id,task:Ns.from(n)};t(s)}})}$customExecutionComplete(e,t){return new Promise((i,n)=>{this._taskService.getActiveTasks().then(s=>{for(const o of s)if(e===o._id){this._taskService.extensionCallbackTaskComplete(o,t).then(a=>{i(void 0)},a=>{n(a)});return}n(new Error("Task to mark as complete not found"))})})}$terminateTask(e){return new Promise((t,i)=>{this._taskService.getActiveTasks().then(n=>{for(const s of n)if(e===s._id){this._taskService.terminate(s).then(o=>{t(void 0)},o=>{i(void 0)});return}i(new rc("Task to terminate not found"))})})}$registerTaskSystem(e,t){let i;switch(t.platform){case"Web":i=0;break;case"win32":i=3;break;case"darwin":i=1;break;case"linux":i=2;break;default:i=SX}this._taskService.registerTaskSystem(e,{platform:i,uriProvider:n=>k.from({scheme:t.scheme,authority:t.authority,path:n}),context:this._extHostContext,resolveVariables:(n,s,o)=>{const a=[];return s.variables.forEach(c=>a.push(c)),Promise.resolve(this._proxy.$resolveVariables(n.uri,{process:s.process,variables:a})).then(c=>{const d=Array.from(Object.values(c.variables));return new Promise((l,u)=>{this._configurationResolverService.resolveWithInteraction(n,d,"tasks",void 0,o).then(h=>{h||l(void 0);const g={process:void 0,variables:new Map};for(let m=0;m<d.length;m++){const y=a[m].substring(2,a[m].length-1);if(h&&c.variables[a[m]]===a[m]){const _=h.get(y);typeof _=="string"&&g.variables.set(y,_)}else g.variables.set(y,d[m])}Rt(c.process)&&(g.process=c.process),l(g)},h=>{u(h)})})})},findExecutable:(n,s,o)=>this._proxy.$findExecutable(n,s,o)})}async $registerSupportedExecutions(e,t,i){return this._taskService.registerSupportedExecutions(e,t,i)}};i2=T([gt(ce.MainThreadTask),v(1,C3),v(2,oi),v(3,E3)],i2);let n2=class extends ne{constructor(e,t){super(),this._labelService=t,this._resourceLabelFormatters=this._register(new mr)}$registerResourceLabelFormatter(e,t){t.priority=!0;const i=this._labelService.registerCachedFormatter(t);this._resourceLabelFormatters.set(e,i)}$unregisterResourceLabelFormatter(e){this._resourceLabelFormatters.deleteAndDispose(e)}};n2=T([gt(ce.MainThreadLabelService),v(1,Qi)],n2);let r2=class extends ne{constructor(e,t,i,n,s,o,a){super(),this.remoteExplorerService=t,this.tunnelService=i,this.notificationService=n,this.configurationService=s,this.logService=o,this.remoteAgentService=a,this.elevateionRetry=!1,this.portsAttributesProviders=new Map,this._alreadyRegistered=!1,this._proxy=e.getProxy(fe.ExtHostTunnelService),this._register(i.onTunnelOpened(()=>this._proxy.$onDidTunnelsChange())),this._register(i.onTunnelClosed(()=>this._proxy.$onDidTunnelsChange()))}processFindingEnabled(){return(!!this.configurationService.getValue(jR)||this.tunnelService.hasTunnelProvider)&&this.configurationService.getValue(PB)!==AB}async $setRemoteTunnelService(e){this.remoteExplorerService.namedProcesses.set(e,"Code Extension Host"),this.remoteExplorerService.portsFeaturesEnabled?this._proxy.$registerCandidateFinder(this.processFindingEnabled()):this._register(this.remoteExplorerService.onEnabledPortsFeatures(()=>this._proxy.$registerCandidateFinder(this.configurationService.getValue(jR)))),this._register(this.configurationService.onDidChangeConfiguration(async t=>{if(t.affectsConfiguration(jR)||t.affectsConfiguration(PB))return this._proxy.$registerCandidateFinder(this.processFindingEnabled())})),this._register(this.tunnelService.onAddedTunnelProvider(()=>this._proxy.$registerCandidateFinder(this.processFindingEnabled())))}async $registerPortsAttributesProvider(e,t){this.portsAttributesProviders.set(t,e),this._alreadyRegistered||(this.remoteExplorerService.tunnelModel.addAttributesProvider(this),this._alreadyRegistered=!0)}async $unregisterPortsAttributesProvider(e){this.portsAttributesProviders.delete(e)}async providePortAttributes(e,t,i,n){if(this.portsAttributesProviders.size===0)return[];const s=Array.from(this.portsAttributesProviders.entries()).filter(o=>{const a=o[1],c=typeof a.portRange=="number"?[a.portRange,a.portRange+1]:a.portRange,d=c?e.some(u=>c[0]<=u&&u<c[1]):!0,l=!a.commandPattern||i&&i.match(a.commandPattern);return d&&l}).map(o=>o[0]);return s.length===0?[]:this._proxy.$providePortAttributes(s,e,t,i,n)}async $openTunnel(e,t){const i=await this.remoteExplorerService.forward({remote:e.remoteAddress,local:e.localAddressPort,name:e.label,source:{source:la.Extension,description:t},elevateIfNeeded:!1});if(i)return!this.elevateionRetry&&e.localAddressPort!==void 0&&i.tunnelLocalPort!==void 0&&this.tunnelService.isPortPrivileged(e.localAddressPort)&&i.tunnelLocalPort!==e.localAddressPort&&this.tunnelService.canElevate&&this.elevationPrompt(e,i,t),bL.fromServiceTunnel(i)}async elevationPrompt(e,t,i){return this.notificationService.prompt(wn.Info,p("remote.tunnel.openTunnel","The extension {0} has forwarded port {1}. You'll need to run as superuser to use port {2} locally.",i,e.remoteAddress.port,e.localAddressPort),[{label:p("remote.tunnelsView.elevationButton","Use Port {0} as Sudo...",t.tunnelRemotePort),run:async()=>{this.elevateionRetry=!0,await this.remoteExplorerService.close({host:t.tunnelRemoteHost,port:t.tunnelRemotePort},Hh.Other),await this.remoteExplorerService.forward({remote:e.remoteAddress,local:e.localAddressPort,name:e.label,source:{source:la.Extension,description:i},elevateIfNeeded:!0}),this.elevateionRetry=!1}}])}async $closeTunnel(e){return this.remoteExplorerService.close(e,Hh.Other)}async $getTunnels(){return(await this.tunnelService.tunnels).map(e=>({remoteAddress:{port:e.tunnelRemotePort,host:e.tunnelRemoteHost},localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol}))}async $onFoundNewCandidates(e){this.remoteExplorerService.onFoundNewCandidates(e)}async $setTunnelProvider(e){const t={forwardPort:(i,n)=>this._proxy.$forwardPort(i,n).then(o=>{if(this.logService.trace(`ForwardedPorts: (MainThreadTunnelService) New tunnel established by tunnel provider: ${o==null?void 0:o.remoteAddress.host}:${o==null?void 0:o.remoteAddress.port}`),!!o)return{tunnelRemotePort:o.remoteAddress.port,tunnelRemoteHost:o.remoteAddress.host,localAddress:typeof o.localAddress=="string"?o.localAddress:ys(o.localAddress.host,o.localAddress.port),tunnelLocalPort:typeof o.localAddress!="string"?o.localAddress.port:void 0,public:o.public,privacy:o.privacy,protocol:o.protocol??co.Http,dispose:async a=>(this.logService.trace(`ForwardedPorts: (MainThreadTunnelService) Closing tunnel from tunnel provider: ${o==null?void 0:o.remoteAddress.host}:${o==null?void 0:o.remoteAddress.port}`),this._proxy.$closeTunnel({host:o.remoteAddress.host,port:o.remoteAddress.port},a))}})};this.tunnelService.setTunnelProvider(t),e&&this.tunnelService.setTunnelFeatures(e)}async $setCandidateFilter(){this.remoteExplorerService.setCandidateFilter(e=>this._proxy.$applyCandidateFilter(e))}async $setCandidatePortSource(e){this.remoteAgentService.getEnvironment().then(()=>{switch(e){case X_.None:{st.as(ks.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPorts":!1}}]);break}case X_.Output:{st.as(ks.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPortsSource":AB}}]);break}}}).catch(()=>{})}};r2=T([gt(ce.MainThreadTunnelService),v(1,V4),v(2,Z1),v(3,on),v(4,We),v(5,ze),v(6,Wa)],r2);function yye(r){return`onAuthenticationRequest:${r}`}function CO(r,e,t){const i=`${e}-${t}-usages`,n=r.get(i,-1);let s=[];if(n)try{s=JSON.parse(n)}catch{}return s}function _ye(r,e,t){const i=`${e}-${t}-usages`;r.remove(i,-1)}function s2(r,e,t,i,n){const s=`${e}-${t}-usages`,o=CO(r,e,t),a=o.findIndex(c=>c.extensionId===i);a>-1?o.splice(a,1,{extensionId:i,extensionName:n,lastUsed:Date.now()}):o.push({extensionId:i,extensionName:n,lastUsed:Date.now()}),r.store(s,JSON.stringify(o),-1,1)}async function L1e(r,e){const t=await r.getPassword(`${e.urlProtocol}.login`,"account");if(t)try{const i=JSON.parse(t);if(i&&Rt(i.id)&&Rt(i.accessToken)&&Rt(i.providerId))return i}catch{}}function wye(r,e,t){let i=[];try{const n=r.get(`${e}-${t}`,-1);n&&(i=JSON.parse(n))}catch{}return i}Gt.registerCommand("workbench.getCodeExchangeProxyEndpoints",function(r,e){var i;return(i=r.get(Cu).options)==null?void 0:i.codeExchangeProxyEndpoints});Un.appendMenuItem(Ee.AccountsContext,{command:{id:"noAuthenticationProviders",title:p("authentication.Placeholder","No accounts requested yet..."),precondition:nt.false()}});class bye extends ne{constructor(e,t,i,n,s,o,a,c){super(),this._proxy=e,this.id=t,this.label=i,this.supportsMultipleAccounts=n,this.notificationService=s,this.storageService=o,this.quickInputService=a,this.dialogService=c}manageTrustedExtensions(e){const t=wye(this.storageService,this.id,e);if(!t.length){this.dialogService.info(p("noTrustedExtensions","This account has not been used by any extensions."));return}const i=this.quickInputService.createQuickPick();i.canSelectMany=!0,i.customButton=!0,i.customLabel=p("manageTrustedExtensions.cancel","Cancel");const n=CO(this.storageService,this.id,e),s=t.map(o=>{const a=n.find(c=>o.id===c.extensionId);return{label:o.name,description:a?p({key:"accountLastUsedDate",comment:['The placeholder {0} is a string with time information, such as "3 days ago"']},"Last used this account {0}",f$(a.lastUsed,!0)):p("notUsed","Has not used this account"),extension:o}});i.items=s,i.selectedItems=s.filter(o=>o.extension.allowed===void 0||o.extension.allowed),i.title=p("manageTrustedExtensions","Manage Trusted Extensions"),i.placeholder=p("manageExtensions","Choose which extensions can access this account"),i.onDidAccept(()=>{const o=i.items.map(a=>a.extension);this.storageService.store(`${this.id}-${e}`,JSON.stringify(o),-1,0),i.dispose()}),i.onDidChangeSelection(o=>{i.items.forEach(a=>{a.extension&&(a.extension.allowed=!1)}),o.forEach(a=>a.extension.allowed=!0)}),i.onDidHide(()=>{i.dispose()}),i.onDidCustom(()=>{i.hide()}),i.show()}async removeAccountSessions(e,t){const i=CO(this.storageService,this.id,e),{confirmed:n}=await this.dialogService.confirm({type:yi.Info,message:i.length?p("signOutMessage",`The account '{0}' has been used by: 

{1}

 Sign out from these extensions?`,e,i.map(s=>s.extensionName).join(`
`)):p("signOutMessageSimple","Sign out of '{0}'?",e),primaryButton:p({key:"signOut",comment:["&& denotes a mnemonic"]},"&&Sign Out")});if(n){const s=t.map(o=>this.removeSession(o.id));await Promise.all(s),_ye(this.storageService,this.id,e),this.storageService.remove(`${this.id}-${e}`,-1)}}async getSessions(e){return this._proxy.$getSessions(this.id,e)}createSession(e,t){return this._proxy.$createSession(this.id,e,t)}async removeSession(e){await this._proxy.$removeSession(this.id,e),this.notificationService.info(p("signedOut","Successfully signed out."))}}let o2=class extends ne{constructor(e,t,i,n,s,o,a,c){super(),this.authenticationService=t,this.dialogService=i,this.storageService=n,this.notificationService=s,this.quickInputService=o,this.extensionService=a,this.telemetryService=c,this._proxy=e.getProxy(fe.ExtHostAuthentication),this._register(this.authenticationService.onDidChangeSessions(d=>{this._proxy.$onDidChangeAuthenticationSessions(d.providerId,d.label)})),this._proxy.$setProviders(this.authenticationService.declaredProviders),this._register(this.authenticationService.onDidChangeDeclaredProviders(d=>{this._proxy.$setProviders(d)}))}async $registerAuthenticationProvider(e,t,i){const n=new bye(this._proxy,e,t,i,this.notificationService,this.storageService,this.quickInputService,this.dialogService);this.authenticationService.registerAuthenticationProvider(e,n)}$unregisterAuthenticationProvider(e){this.authenticationService.unregisterAuthenticationProvider(e)}$ensureProvider(e){return this.extensionService.activateByEvent(yye(e),1)}$sendDidChangeSessions(e,t){this.authenticationService.sessionsUpdate(e,t)}$removeSession(e,t){return this.authenticationService.removeSession(e,t)}async loginPrompt(e,t,i,n){const s=i?p("confirmRelogin","The extension '{0}' wants you to sign in again using {1}.",t,e):p("confirmLogin","The extension '{0}' wants to sign in using {1}.",t,e),{confirmed:o}=await this.dialogService.confirm({type:yi.Info,message:s,detail:n,primaryButton:p({key:"allow",comment:["&& denotes a mnemonic"]},"&&Allow")});return o}async doGetSession(e,t,i,n,s){const o=await this.authenticationService.getSessions(e,t,!0),a=this.authenticationService.supportsMultipleAccounts(e);if(s.forceNewSession&&s.createIfNone)throw new Error("Invalid combination of options. Please remove one of the following: forceNewSession, createIfNone");if(s.forceNewSession&&s.silent)throw new Error("Invalid combination of options. Please remove one of the following: forceNewSession, silent");if(s.createIfNone&&s.silent)throw new Error("Invalid combination of options. Please remove one of the following: createIfNone, silent");if(!s.forceNewSession&&o.length){if(a)if(s.clearSessionPreference)this.authenticationService.removeSessionPreference(e,i,t);else{const d=this.authenticationService.getSessionPreference(e,i,t);if(d){const l=o.find(u=>u.id===d);if(l&&this.authenticationService.isAccessAllowed(e,l.account.label,i))return l}}else if(this.authenticationService.isAccessAllowed(e,o[0].account.label,i))return o[0]}if(s.createIfNone||s.forceNewSession){const d=this.authenticationService.getLabel(e),l=typeof s.forceNewSession=="object"?s.forceNewSession.detail:void 0,u=!!(s.forceNewSession&&o.length);if(!await this.loginPrompt(d,n,u,l))throw new Error("User did not consent to login.");let g;if(o!=null&&o.length&&!s.forceNewSession&&a)g=await this.authenticationService.selectSession(e,i,n,t,o);else{let m;if(typeof s.forceNewSession=="object"&&s.forceNewSession.sessionToRecreate)m=s.forceNewSession.sessionToRecreate;else{const y=this.authenticationService.getSessionPreference(e,i,t);m=y?o.find(_=>_.id===y):void 0}g=await this.authenticationService.createSession(e,t,{activateImmediate:!0,sessionToRecreate:m})}return this.authenticationService.updateAllowedExtension(e,g.account.label,i,n,!0),this.authenticationService.updateSessionPreference(e,i,g),g}const c=o.find(d=>this.authenticationService.isAccessAllowed(e,d.account.label,i));if(c)return this.authenticationService.getSessionPreference(e,i,t)||(this.storageService.get(`${n}-${e}`,-1)&&this.storageService.remove(`${n}-${e}`,-1),this.authenticationService.updateAllowedExtension(e,c.account.label,i,n,!0),this.authenticationService.updateSessionPreference(e,i,c)),c;s.silent||(o.length?this.authenticationService.requestSessionAccess(e,i,n,t,o):await this.authenticationService.requestNewSession(e,t,i,n))}async $getSession(e,t,i,n,s){const o=await this.doGetSession(e,t,i,n,s);return o&&(this.sendProviderUsageTelemetry(i,e),s2(this.storageService,e,o.account.label,i,n)),o}async $getSessions(e,t,i,n){const o=(await this.authenticationService.getSessions(e,[...t],!0)).filter(a=>this.authenticationService.isAccessAllowed(e,a.account.label,i));if(o.length){this.sendProviderUsageTelemetry(i,e);for(const a of o)s2(this.storageService,e,a.account.label,i,n)}return o}sendProviderUsageTelemetry(e,t){this.telemetryService.publicLog2("authentication.providerUsage",{providerId:t,extensionId:e})}};o2=T([gt(ce.MainThreadAuthentication),v(1,q4),v(2,ar),v(3,ri),v(4,on),v(5,ss),v(6,yr),v(7,gi)],o2);let a2=class{constructor(e,t,i){this.logService=t,this._timelineService=i,this._providerEmitters=new Map,this._proxy=e.getProxy(fe.ExtHostTimeline)}$registerTimelineProvider(e){this.logService.trace(`MainThreadTimeline#registerTimelineProvider: id=${e.id}`);const t=this._proxy,i=this._providerEmitters;let n=i.get(e.id);n===void 0&&(n=new A,i.set(e.id,n)),this._timelineService.registerTimelineProvider({...e,onDidChange:n.event,async provideTimeline(s,o,a){return Ta(await t.$getTimeline(e.id,s,o,a))},dispose(){i.delete(e.id),n==null||n.dispose()}})}$unregisterTimelineProvider(e){this.logService.trace(`MainThreadTimeline#unregisterTimelineProvider: id=${e}`),this._timelineService.unregisterTimelineProvider(e)}$emitTimelineChangeEvent(e){var i;this.logService.trace(`MainThreadTimeline#emitChangeEvent: id=${e.id}, uri=${(i=e.uri)==null?void 0:i.toString(!0)}`);const t=this._providerEmitters.get(e.id);t==null||t.fire(e)}dispose(){}};a2=T([gt(ce.MainThreadTimeline),v(1,ze),v(2,G4)],a2);class xw extends ne{get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this.changeEmitter.fire(e))}static stored(e,t){const i=new xw(e.get(t));return i.onDidChange(n=>e.store(n)),i}constructor(e){super(),this._value=e,this.changeEmitter=this._register(new A),this.onDidChange=this.changeEmitter.event}}class Sye{constructor(e){this.accessor=e}async getAllFiles(e=_t.None){this.fileCoverage||(this.fileCoverage=this.accessor.provideFileCoverage(e));try{return await this.fileCoverage}catch(t){throw this.fileCoverage=void 0,t}}async getUri(e,t=_t.None){return(await this.getAllFiles(t)).find(n=>n.uri.toString()===e.toString())}}const qo={2:6,6:5,4:4,1:3,3:2,0:0,5:1};Object.entries(qo).reduce((r,[e,t])=>{const i=Number(e);return r[i]={statusNode:!0,state:i,priority:t},r},{});const Cye=(r,e)=>qo[e]-qo[r],Q8=(...r)=>{switch(r.length){case 0:return 0;case 1:return r[0];case 2:return qo[r[0]]>qo[r[1]]?r[0]:r[1];default:{let e=r[0];for(let t=1;t<r.length;t++)qo[e]<qo[r[t]]&&(e=r[t]);return e}}},Eye=Object.keys(qo).map(r=>Number(r)).sort(Cye),c2={3:0,5:1,4:2,6:3},xye=r=>"getOwnDuration"in r,EO=(r,e,t=!1)=>{let i=r.getCurrentComputedState(e);if(i===void 0||t){i=r.getOwnState(e)??0;for(const n of r.getChildren(e)){const s=EO(r,n);i=s===5&&i===0?5:Q8(i,s)}r.setComputedState(e,i)}return i},Y8=(r,e,t=!1)=>{let i=r.getCurrentComputedDuration(e);if(i===void 0||t){const n=r.getOwnDuration(e);if(n!==void 0)i=n;else{i=void 0;for(const s of r.getChildren(e)){const o=Y8(r,s);o!==void 0&&(i=(i||0)+o)}}r.setComputedDuration(e,i)}return i},Dye=(r,e,t,i=!0)=>{const n=r.getCurrentComputedState(e),s=qo[n],o=t??EO(r,e,!0),a=qo[o],c=new Set;if(a!==s){if(r.setComputedState(e,o),c.add(e),a>s)for(const d of r.getParents(e)){const l=r.getCurrentComputedState(d);if(l!==void 0&&qo[l]>=a)break;r.setComputedState(d,o),c.add(d)}else if(a<s)for(const d of r.getParents(e)){const l=r.getCurrentComputedState(d);if(l===void 0||qo[l]>s)break;r.setComputedState(d,EO(r,d,!0)),c.add(d)}}if(xye(r)&&i)for(const d of Go.concat(Go.single(e),r.getParents(e))){const l=r.getCurrentComputedDuration(d),u=Y8(r,d,!0);if(l===u)break;r.setComputedDuration(d,u),c.add(d)}return c};F.None,Promise.resolve();class kye{constructor(){this.writeDataEmitter=new A,this.endDeferred=new Hm,this.offset=0,this.onDidWriteData=this.writeDataEmitter.event,this.endPromise=this.endDeferred.p,this.buffers=[]}get length(){return this.offset}getRange(e,t){const i=De.alloc(t);let n=0,s=0;for(const o of this.buffers){if(s+o.byteLength<=e){s+=o.byteLength;continue}const a=Math.max(0,e-s),c=Math.min(o.byteLength,a+t-n);if(i.buffer.set(o.buffer.subarray(a,c),n),n+=c-a,s+=o.byteLength,n===i.byteLength)break}return n<t?i.slice(0,n):i}append(e,t){let i=this.offset;if(t!==void 0){const n=De.fromString(d2(t,!0)),s=De.fromString(d2(t,!1));i+=n.byteLength,e=De.concat([n,e,s])}return this.buffers.push(e),this.writeDataEmitter.fire(e),this.offset+=e.byteLength,i}end(){this.endDeferred.complete()}}const Tye=()=>{const r={};for(const e of Eye)r[e]=0;return r},d2=(r,e)=>`\x1B]633;SetMark;Id=${nfe(r,e)};Hidden\x07`,Iye=(r,e,t)=>({controllerId:r,expand:0,item:{...e},children:[],tasks:[],ownComputedState:0,computedState:0});class dP{get completedAt(){return this._completedAt}get tests(){return this.testById.values()}constructor(e,t,i){this.id=e,this.persist=t,this.request=i,this.completeEmitter=new A,this.newTaskEmitter=new A,this.endTaskEmitter=new A,this.changeEmitter=new A,this.testById=new Map,this.testMarkerCounter=0,this.onChange=this.changeEmitter.event,this.onComplete=this.completeEmitter.event,this.onNewTask=this.newTaskEmitter.event,this.onEndTask=this.endTaskEmitter.event,this.tasks=[],this.name=p("runFinished","Test run at {0}",new Date().toLocaleString(Ig)),this.counts=Tye(),this.computedStateAccessor={getOwnState:n=>n.ownComputedState,getCurrentComputedState:n=>n.computedState,setComputedState:(n,s)=>n.computedState=s,getChildren:n=>n.children,getParents:n=>{const{testById:s}=this;return function*(){const o=Et.fromString(n.item.extId).parentId;if(o)for(const a of o.idsToRoot())yield s.get(a.toString())}()}},this.doSerialize=new Tg(()=>({id:this.id,completedAt:this.completedAt,tasks:this.tasks.map(n=>({id:n.id,name:n.name})),name:this.name,request:this.request,items:[...this.testById.values()].map(dx.serializeWithoutMessages)})),this.doSerializeWithMessages=new Tg(()=>({id:this.id,completedAt:this.completedAt,tasks:this.tasks.map(n=>({id:n.id,name:n.name})),name:this.name,request:this.request,items:[...this.testById.values()].map(dx.serialize)}))}getStateById(e){return this.testById.get(e)}appendOutput(e,t,i,n){var u;const s=e.byteLength>100?e.slice(0,100).toString()+"…":e.toString();let o;(n||i)&&(o=this.testMarkerCounter++);const a=this.mustGetTaskIndex(t),c=this.tasks[a],d=c.output.append(e,o),l={location:i,message:CX(s),offset:d,length:e.byteLength,marker:o,type:1};n?(u=this.testById.get(n))==null||u.tasks[a].messages.push(l):c.otherMessages.push(l)}addTask(e){this.tasks.push({...e,coverage:new xw(void 0),otherMessages:[],output:new kye});for(const t of this.tests)t.tasks.push({duration:void 0,messages:[],state:0});this.newTaskEmitter.fire(this.tasks.length-1)}addTestChainToRun(e,t){let i=this.testById.get(t[0].extId);i||(i=this.addTestToRun(e,t[0],null));for(let n=1;n<t.length;n++)i=this.addTestToRun(e,t[n],i.item.extId)}updateState(e,t,i,n){const s=this.testById.get(e);if(!s)return;const o=this.mustGetTaskIndex(t),a=c2[s.tasks[o].state],c=c2[i];a!==void 0&&(c===void 0||c<a)||this.fireUpdateAndRefresh(s,o,i,n)}appendMessage(e,t,i){const n=this.testById.get(e);n&&(n.tasks[this.mustGetTaskIndex(t)].messages.push(i),this.changeEmitter.fire({item:n,result:this,reason:1,previousState:n.ownComputedState,previousOwnDuration:n.ownDuration}))}markTaskComplete(e){const t=this.mustGetTaskIndex(e),i=this.tasks[t];i.running=!1,i.output.end(),this.setAllToState(0,e,n=>n.state===1||n.state===2),this.endTaskEmitter.fire(t)}markComplete(){if(this._completedAt!==void 0)throw new Error("cannot complete a test result multiple times");for(const e of this.tasks)e.running&&this.markTaskComplete(e.id);this._completedAt=Date.now(),this.completeEmitter.fire()}markRetired(e){for(const[t,i]of this.testById)(!i.retired&&t===e||Et.isChild(e,t))&&(i.retired=!0,this.changeEmitter.fire({reason:0,item:i,result:this}))}toJSON(){return this.completedAt&&this.persist?this.doSerialize.value:void 0}toJSONWithMessages(){return this.completedAt&&this.persist?this.doSerializeWithMessages.value:void 0}setAllToState(e,t,i){const n=this.mustGetTaskIndex(t);for(const s of this.testById.values())i(s.tasks[n],s)&&this.fireUpdateAndRefresh(s,n,e)}fireUpdateAndRefresh(e,t,i,n){const s=e.ownComputedState,o=e.ownDuration,a={item:e,result:this,reason:1,previousState:s,previousOwnDuration:o};e.tasks[t].state=i,n!==void 0&&(e.tasks[t].duration=n,e.ownDuration=Math.max(e.ownDuration||0,n));const c=Q8(...e.tasks.map(d=>d.state));if(c===s){n!==o&&this.changeEmitter.fire(a);return}e.ownComputedState=c,this.counts[s]--,this.counts[c]++,Dye(this.computedStateAccessor,e).forEach(d=>this.changeEmitter.fire(d===e?a:{item:d,result:this,reason:0}))}addTestToRun(e,t,i){var s;const n=Iye(e,t);if(this.testById.set(t.extId,n),this.counts[0]++,i&&((s=this.testById.get(i))==null||s.children.push(n)),this.tasks.length)for(let o=0;o<this.tasks.length;o++)n.tasks.push({duration:void 0,messages:[],state:0});return n}mustGetTaskIndex(e){const t=this.tasks.findIndex(i=>i.id===e);if(t===-1)throw new Error(`Unknown task ${e} in updateState`);return t}}let l2=class extends ne{constructor(e,t,i,n){super(),this.testService=t,this.testProfiles=i,this.resultService=n,this.diffListener=this._register(new Hr),this.testProviderRegistrations=new Map,this.proxy=e.getProxy(fe.ExtHostTesting),this._register(this.testService.onDidCancelTestRun(({runId:s})=>{this.proxy.$cancelExtensionTestRun(s)})),this._register(n.onResultsChanged(s=>{const o="completed"in s?s.completed:"inserted"in s?s.inserted:void 0,a=o==null?void 0:o.toJSONWithMessages();a&&this.proxy.$publishTestResults([a])}))}$markTestRetired(e){for(const t of this.resultService.results)t instanceof dP&&t.markRetired(e)}$publishTestRunProfile(e){const t=this.testProviderRegistrations.get(e.controllerId);t&&this.testProfiles.addProfile(t.instance,e)}$updateTestRunConfig(e,t,i){this.testProfiles.updateProfile(e,t,i)}$removeTestProfile(e,t){this.testProfiles.removeProfile(e,t)}$addTestsToRun(e,t,i){this.withLiveRun(t,n=>n.addTestChainToRun(e,i.map(Z_.deserialize)))}$signalCoverageAvailable(e,t){this.withLiveRun(e,i=>{const n=i.tasks.find(s=>s.id===t);n&&(n.coverage.value=new Sye({provideFileCoverage:async s=>Ta(await this.proxy.$provideFileCoverage(e,t,s)),resolveFileCoverage:(s,o)=>this.proxy.$resolveFileCoverage(e,t,s,o)}))})}$startedExtensionTestRun(e){this.resultService.createLiveResult(e)}$startedTestRunTask(e,t){this.withLiveRun(e,i=>i.addTask(t))}$finishedTestRunTask(e,t){this.withLiveRun(e,i=>i.markTaskComplete(t))}$finishedExtensionTestRun(e){this.withLiveRun(e,t=>t.markComplete())}$updateTestStateInRun(e,t,i,n,s){this.withLiveRun(e,o=>o.updateState(i,t,n,s))}$appendOutputToRun(e,t,i,n,s){const o=n&&{uri:k.revive(n.uri),range:qe.lift(n.range)};this.withLiveRun(e,a=>a.appendOutput(i,t,o,s))}$appendTestMessagesInRun(e,t,i,n){const s=this.resultService.getResult(e);if(s&&s instanceof dP)for(const o of n)s.appendMessage(i,t,J_.deserialize(o))}$registerTestController(e,t,i){const n=new me,s=n.add(new xw(t)),o=n.add(new xw(i)),a={id:e,label:s,canRefresh:o,syncTests:()=>this.proxy.$syncTests(),refreshTests:c=>this.proxy.$refreshTests(e,c),configureRunProfile:c=>this.proxy.$configureRunProfile(e,c),runTests:(c,d)=>this.proxy.$runControllerTests(c,d),startContinuousRun:(c,d)=>this.proxy.$startContinuousRun(c,d),expandTest:(c,d)=>this.proxy.$expandTest(c,isFinite(d)?d:-1)};n.add(ot(()=>this.testProfiles.removeProfile(e))),n.add(this.testService.registerTestController(e,a)),this.testProviderRegistrations.set(e,{instance:a,label:s,canRefresh:o,disposable:n})}$updateController(e,t){const i=this.testProviderRegistrations.get(e);i&&(t.label!==void 0&&(i.label.value=t.label),t.canRefresh!==void 0&&(i.canRefresh.value=t.canRefresh))}$unregisterTestController(e){var t;(t=this.testProviderRegistrations.get(e))==null||t.disposable.dispose(),this.testProviderRegistrations.delete(e)}$subscribeToDiffs(){this.proxy.$acceptDiff(this.testService.collection.getReviverDiff().map(pm.serialize)),this.diffListener.value=this.testService.onDidProcessDiff(this.proxy.$acceptDiff,this.proxy)}$unsubscribeFromDiffs(){this.diffListener.clear()}$publishDiff(e,t){this.testService.publishDiff(e,t.map(pm.deserialize))}async $runTests(e,t){return(await this.testService.runResolvedTests(e,t)).id}dispose(){super.dispose();for(const e of this.testProviderRegistrations.values())e.disposable.dispose();this.testProviderRegistrations.clear()}withLiveRun(e,t){const i=this.resultService.getResult(e);return i&&i instanceof dP?t(i):void 0}};l2=T([gt(ce.MainThreadTesting),v(1,z4),v(2,Z4),v(3,t5)],l2);class Rye extends ne{constructor(e,t,i,n){super(),this._proxy=e,this.credentialsService=t,this.encryptionService=i,this.logService=n,this.secretStoragePrefix=this.credentialsService.getSecretStoragePrefix(),this._register(this.credentialsService.onDidChangePassword(async s=>{var a;const o=(a=s.service)==null?void 0:a.substring((await this.secretStoragePrefix).length);o&&this._proxy.$onDidChangePassword({extensionId:o,key:s.account})}))}async getFullKey(e){return`${await this.secretStoragePrefix}${e}`}async $getPassword(e,t){this.logService.trace(`MainThreadSecretState#getPassword: Getting password for ${e} extension: `,t);const i=await this.getFullKey(e),n=await this.credentialsService.getPassword(i,t);if(!n){this.logService.trace("MainThreadSecretState#getPassword: No password found for: ",t);return}let s;try{this.logService.trace("MainThreadSecretState#getPassword: Decrypting password for: ",t),s=await this.encryptionService.decrypt(n)}catch(o){this.logService.error(o),this.logService.trace("MainThreadSecretState#getPassword: Trying migration for: ",t);const a=await this.encryptionService.encrypt(n);await this.credentialsService.setPassword(i,t,a);const c=await this.credentialsService.getPassword(i,t);s=c&&await this.encryptionService.decrypt(c)}if(s)try{const o=JSON.parse(s);if(o.extensionId===e)return this.logService.trace("MainThreadSecretState#getPassword: Password found for: ",t),o.content}catch(o){throw this.logService.error(o),new Error("Unable to parse decrypted password")}this.logService.trace("MainThreadSecretState#getPassword: No password found for: ",t)}async $setPassword(e,t,i){this.logService.trace(`MainThreadSecretState#setPassword: Setting password for ${e} extension: `,t);const n=await this.getFullKey(e),s=JSON.stringify({extensionId:e,content:i});this.logService.trace("MainThreadSecretState#setPassword: Encrypting password for: ",t);const o=await this.encryptionService.encrypt(s);return this.logService.trace("MainThreadSecretState#setPassword: Storing password for: ",t),await this.credentialsService.setPassword(n,t,o)}async $deletePassword(e,t){try{const i=await this.getFullKey(e);await this.credentialsService.deletePassword(i,t)}catch{throw new Error("Cannot delete password")}}}let u2=class extends ne{constructor(e,t,i,n,s,o){var a;super(),this.secretStorageService=t,this.logService=i,this.credentialsService=n,this.encryptionService=s,this._sequencer=new EX,this.secretStoragePrefix=this.credentialsService.getSecretStoragePrefix(),this._proxy=e.getProxy(fe.ExtHostSecretState),(a=o.options)!=null&&a.credentialsProvider&&(this._oldMainThreadSecretState=this._register(new Rye(this._proxy,n,s,i))),this._register(this.secretStorageService.onDidChangeSecret(c=>{try{const{extensionId:d,key:l}=this.parseKey(c);d&&l&&this._proxy.$onDidChangePassword({extensionId:d,key:l})}catch{}}))}$getPassword(e,t){return this.logService.trace(`[mainThreadSecretState] Getting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doGetPassword(e,t))}async doGetPassword(e,t){if(this._oldMainThreadSecretState)return await this._oldMainThreadSecretState.$getPassword(e,t);const i=this.getKey(e,t),n=await this.secretStorageService.get(i);return n?(this.logService.trace("[mainThreadSecretState] Password found for: ",e,t),n):(this.logService.trace("[mainThreadSecretState] No password found for: ",e,t),await this.getAndDeleteOldPassword(e,t))}$setPassword(e,t,i){return this.logService.trace(`[mainThreadSecretState] Setting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doSetPassword(e,t,i))}async doSetPassword(e,t,i){if(this._oldMainThreadSecretState)return await this._oldMainThreadSecretState.$setPassword(e,t,i);const n=this.getKey(e,t);await this.secretStorageService.set(n,i),this.logService.trace("[mainThreadSecretState] Password set for: ",e,t)}$deletePassword(e,t){return this.logService.trace(`[mainThreadSecretState] Deleting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doDeletePassword(e,t))}async doDeletePassword(e,t){if(this._oldMainThreadSecretState)return await this._oldMainThreadSecretState.$deletePassword(e,t);const i=this.getKey(e,t);await this.secretStorageService.delete(i),this.logService.trace("[mainThreadSecretState] Password deleted for: ",e,t)}getKey(e,t){return JSON.stringify({extensionId:e,key:t})}parseKey(e){return JSON.parse(e)}async getAndDeleteOldPassword(e,t){const i=await this.getOldPassword(e,t);if(i){const n=this.getKey(e,t);this.logService.trace("[mainThreadSecretState] Setting old password to new location for: ",e,t),await this.secretStorageService.set(n,i),this.logService.trace("[mainThreadSecretState] Old Password set to new location for: ",e,t),this.secretStorageService.type==="persisted"&&(this.logService.trace("[mainThreadSecretState] Deleting old password for since it was persisted in the new location: ",e,t),await this.deleteOldPassword(e,t))}return i}async getOldPassword(e,t){this.logService.trace(`[mainThreadSecretState] Getting old password for ${e} extension: `,t);const i=`${await this.secretStoragePrefix}${e}`,n=await this.credentialsService.getPassword(i,t);if(!n){this.logService.trace("[mainThreadSecretState] No old password found for: ",e,t);return}let s;try{this.logService.trace("[mainThreadSecretState] Decrypting old password for: ",e,t),s=await this.encryptionService.decrypt(n)}catch(o){this.logService.error(o),this.logService.trace("[mainThreadSecretState] Trying old migration for: ",e,t);const a=await this.encryptionService.encrypt(n);await this.credentialsService.setPassword(i,t,a);const c=await this.credentialsService.getPassword(i,t);s=c&&await this.encryptionService.decrypt(c)}if(s)try{const o=JSON.parse(s);if(o.extensionId===e)return this.logService.trace("[mainThreadSecretState] Old password found for: ",e,t),o.content}catch(o){this.logService.error(o);return}this.logService.trace("[mainThreadSecretState] No old password found for: ",e,t)}async deleteOldPassword(e,t){try{const i=`${await this.secretStoragePrefix}${e}`;this.logService.trace(`[mainThreadSecretState] Deleting old password for ${e} extension: `,t),await this.credentialsService.deletePassword(i,t),this.logService.trace("[mainThreadSecretState] Old password deleted for: ",e,t)}catch{throw new Error("Cannot delete password")}}};u2=T([gt(ce.MainThreadSecretState),v(1,K4),v(2,ze),v(3,T$),v(4,e5),v(5,Cu)],u2);let h2=class{constructor(e,t){this.shareService=t,this.providers=new Map,this.providerDisposables=new Map,this.proxy=e.getProxy(fe.ExtHostShare)}$registerShareProvider(e,t,i,n,s){const o={id:i,label:n,selector:t,priority:s,provideShare:async c=>{const d=await this.proxy.$provideShare(e,c,new Xt().token);return typeof d=="string"?d:k.revive(d)}};this.providers.set(e,o);const a=this.shareService.registerShareProvider(o);this.providerDisposables.set(e,a)}$unregisterShareProvider(e){this.providers.has(e)&&this.providers.delete(e),this.providerDisposables.has(e)&&this.providerDisposables.delete(e)}dispose(){this.providers.clear(),vt(this.providerDisposables.values()),this.providerDisposables.clear()}};h2=T([gt(ce.MainThreadShare),v(1,Q4)],h2);let f2=class extends ne{constructor(e,t){super(),this.userDataProfileImportExportService=t,this.registeredHandlers=this._register(new mr),this.proxy=e.getProxy(fe.ExtHostProfileContentHandlers)}async $registerProfileContentHandler(e,t,i,n){this.registeredHandlers.set(e,this.userDataProfileImportExportService.registerProfileContentHandler(e,{name:t,description:i,extensionId:n,saveProfile:async(s,o,a)=>{const c=await this.proxy.$saveProfile(e,s,o,a);return c?Ta(c):null},readProfile:async(s,o)=>this.proxy.$readProfile(e,s,o)}))}async $unregisterProfileContentHandler(e){this.registeredHandlers.deleteAndDispose(e)}};f2=T([gt(ce.MainThreadProfileContentHandlers),v(1,_3)],f2);let p2=class extends ne{constructor(e,t){super(),this._semanticSimilarityService=t,this._registrations=this._register(new mr),this._proxy=e.getProxy(fe.ExtHostSemanticSimilarity)}$registerSemanticSimilarityProvider(e){const t={provideSimilarityScore:(i,n,s)=>this._proxy.$provideSimilarityScore(e,i,n,s)};this._registrations.set(e,this._semanticSimilarityService.registerSemanticSimilarityProvider(t))}$unregisterSemanticSimilarityProvider(e){this._registrations.deleteAndDispose(e)}};p2=T([gt(ce.MainThreadSemanticSimilarity),v(1,r4)],p2);let g2=class extends ne{constructor(e,t){super(),this._issueService=t,this._registrations=this._register(new mr),this._proxy=e.getProxy(fe.ExtHostIssueReporter)}$registerIssueUriRequestHandler(e){const t={provideIssueUrl:async i=>{const n=await this._proxy.$getIssueReporterUri(e,i);return k.from(n)}};this._registrations.set(e,this._issueService.registerIssueUriRequestHandler(e,t))}$unregisterIssueUriRequestHandler(e){this._registrations.deleteAndDispose(e)}};g2=T([gt(ce.MainThreadIssueReporter),v(1,Y4)],g2);let xO=class extends XN{constructor(e,t){super(t.logLevel,t.logsLocation,t.loggers.map(i=>Ta(i))),this._proxy=e.getProxy(ce.MainThreadLogger)}$setLogLevel(e,t){t?this.setLogLevel(k.revive(t),e):this.setLogLevel(e)}setVisibility(e,t){super.setVisibility(e,t),this._proxy.$setVisibility(e,t)}doCreateLogger(e,t,i){return new Pye(this._proxy,e,t,i)}};xO=T([v(0,Ii),v(1,Gr)],xO);class Pye extends vk{constructor(e,t,i,n){super((n==null?void 0:n.logLevel)==="always"),this.proxy=e,this.file=t,this.isLoggerCreated=!1,this.buffer=[],this.setLevel(i),this.proxy.$createLogger(t,n).then(()=>{this.doLog(this.buffer),this.isLoggerCreated=!0})}log(e,t){const i=[[e,t]];this.isLoggerCreated?this.doLog(i):this.buffer.push(...i)}doLog(e){this.proxy.$log(this.file,e)}flush(){this.proxy.$flush(this.file)}}ie(H$,xL,1);ie(Is,xO,1);ie(iI,$L,1);ie(N5,IL,0);ie(Wd,mL,0);ie(YT,_L,0);ie(o8,KL,0);ie(Y5,dw,0);ie(gb,PL,0);ie(j$,DL,0);ie(iv,efe,0);ie(W5,ML,1);ie(a8,QL,0);ie(F$,E5,0);ie(X5,VL,0);ie(pb,EL,0);ie(N$,SL,0);ie(Q5,Nx,0);ie($d,gL,0);ie(W$,P5,0);ie(XT,TL,0);ie(mb,qL,0);ie(U$,GL,0);function Aye(){const r=new Zu,e=new Zu;class t{constructor(n,s){this.emitterIn=n,this.emitterOut=s,this.onMessage=this.emitterIn.event}send(n){this.emitterOut.fire(n)}}return[new t(r,e),new t(e,r)]}class X8 extends Age{constructor(){super(...arguments),this._extApiImpl=new Ln}async getApi(e){const[t,i]=await Promise.all([this.getExtensionRegistry(),this._extHostConfiguration.getConfigProvider()]),n={mine:t,all:this._globalRegistry},s=e!=null?t.getExtensionDescription(e):void 0;if(s!=null){let o=this._extApiImpl.get(s.identifier);return o==null&&(o=this._apiFactory(s,n,i),this._extApiImpl.set(s.identifier,o)),o}return this._defaultApiImpl==null&&(this._defaultApiImpl=this._apiFactory(v3,n,i)),this._defaultApiImpl}}ie(xu,X8,0);ie(O$,wL,0);const Mye=new class{constructor(){this.pid=void 0,this.exit=w}async exists(r){return!0}async realpath(r){return r}},J8=new Hm,Lye=J8.p;let DO=class{constructor(e,t,i,n,s,o,a,c,d,l,u){this.runningLocation=e,this.startup=t,this._initDataProvider=i,this._telemetryService=n,this._contextService=s,this._labelService=o,this._logService=a,this._loggerService=c,this._environmentService=d,this._productService=l,this._userDataProfilesService=u,this.remoteAuthority=null,this.extensions=new FT,this.onExit=F.None,this._protocolPromise=null,this._extensionHostLogsLocation=pt(this._environmentService.extHostLogsPath,"local")}async start(){return this._protocolPromise==null&&(this._protocolPromise=this._start()),this._protocolPromise}async _start(){const[e,t]=Aye(),i=await this._createExtHostInitData(),n=new G$(t,i,Mye,null);return await J8.complete(n.getExtHostExtensionService()),e}async _createExtHostInitData(){var o;const e=await this._initDataProvider.getInitData(),t=this._contextService.getWorkspace(),i=this.extensions.set(e.allExtensions,e.myExtensions),n=(o=this._productService.extensionsGallery)==null?void 0:o.nlsBaseUrl;let s;return n!=null&&this._productService.commit!=null&&!wC.isDefaultVariant()&&(s=k.joinPath(k.parse(n),this._productService.commit,this._productService.version,wC.value())),{commit:this._productService.commit,version:this._productService.version,quality:this._productService.quality,parentPid:0,environment:{isExtensionDevelopmentDebug:this._environmentService.debugRenderer,appName:this._productService.nameLong,appHost:this._productService.embedderIdentifier??(ln?"web":"desktop"),appUriScheme:this._productService.urlProtocol,appLanguage:Ig,extensionTelemetryLogResource:this._environmentService.extHostTelemetryLogFile,isExtensionTelemetryLoggingOnly:M1(this._productService,this._environmentService),extensionDevelopmentLocationURI:this._environmentService.extensionDevelopmentLocationURI,extensionTestsLocationURI:this._environmentService.extensionTestsLocationURI,globalStorageHome:this._userDataProfilesService.defaultProfile.globalStorageHome,workspaceStorageHome:this._environmentService.workspaceStorageHome,extensionLogLevel:this._environmentService.extensionLogLevel},workspace:this._contextService.getWorkbenchState()===1?void 0:{configuration:t.configuration??void 0,id:t.id,name:this._labelService.getWorkspaceLabel(t),transient:t.transient},consoleForward:{includeStack:!1,logNative:this._environmentService.debugRenderer},allExtensions:i.toAdd,activationEvents:i.addActivationEvents,myExtensions:i.myToAdd,nlsBaseUrl:s,telemetryInfo:{sessionId:this._telemetryService.sessionId,machineId:this._telemetryService.machineId,firstSessionDate:this._telemetryService.firstSessionDate,msftInternal:this._telemetryService.msftInternal},logLevel:this._logService.getLevel(),loggers:[...this._loggerService.getRegisteredLoggers()],logsLocation:this._extensionHostLogsLocation,autoStart:this.startup===1,remote:{authority:this._environmentService.remoteAuthority,connectionData:null,isRemote:!1},uiKind:ln?Yo.Web:Yo.Desktop}}getInspectPort(){}enableInspectPort(){return Promise.resolve(!1)}dispose(){}};DO=T([v(3,gi),v(4,oi),v(5,Qi),v(6,ze),v(7,Is),v(8,Cu),v(9,Rs),v(10,Pf)],DO);let kO=class extends sx{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m){super(t,i,n,s,o,a,c,d,l,u,h,g,m),this.workerConfig=e}async _getWebWorkerExtensionHostIframeSrc(){const e=new URL(await super._getWebWorkerExtensionHostIframeSrc(),window.location.href);return e.searchParams.set("vscodeExtHostWorkerSrc",this.workerConfig.url),this.workerConfig.options!=null&&e.searchParams.set("vscodeExtHostWorkerOptions",JSON.stringify(this.workerConfig.options)),e.searchParams.set("parentOrigin",window.origin),e.toString()}};kO=T([v(4,gi),v(5,oi),v(6,Qi),v(7,ze),v(8,Is),v(9,Cu),v(10,Pf),v(11,Rs),v(12,uk),v(13,ri)],kO);let TO=class extends U0{constructor(e,t,i,n,s,o,a,c){super(t,i,n,s,o,a,c),this.workerConfig=e}createExtensionHost(e,t,i){switch(t.kind){case 1:return this._instantiationService.createInstance(DO,t,1,this._createLocalExtensionHostDataProvider(e,t,i));case 2:{if(this.workerConfig==null)return null;const n=i?2:1;return this._instantiationService.createInstance(kO,this.workerConfig,t,n,this._createLocalExtensionHostDataProvider(e,t,i))}case 3:return super.createExtensionHost(e,t,i)}}};TO=T([v(4,Te),v(5,Wa),v(6,wu),v(7,ev)],TO);let IO=class extends V0{constructor(e,t){super(t),this.allowedExtHostKinds=e,this.extensionHostKinds=new Map}pickExtensionHostKind(e,t,i,n,s){const o=this.extensionHostKinds.get(e.value);if(o!=null)return o;const a=super.pickExtensionHostKind(e,t,i,n,s);return a!=null&&!this.allowedExtHostKinds.includes(a)?this.allowedExtHostKinds[0]??null:a}setForcedExtensionHostKind(e,t){this.extensionHostKinds.set(e,t)}removeForcedExtensionHostKind(e){this.extensionHostKinds.delete(e)}};IO=T([v(1,ze)],IO);let xD=class extends N0{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y,_,b,E,D){const R=t.createInstance(W0),M=new TO(e,R,async()=>[],()=>this._getExtensions(),t,m,b,o);super(R,M,new IO(e!=null?[2,1]:[1],g),t,i,n,s,o,a,c,d,l,u,h,g,m,y,_,b,D),_.when(2).then(async()=>(await E.initializeInstalledExtensions(t),this._initialize())),this._initFetchFileSystem()}_initFetchFileSystem(){const e=new Zhe;this._register(this._fileService.registerProvider(pe.http,e)),this._register(this._fileService.registerProvider(pe.https,e))}async deltaExtensions(e,t){const i=this._extensionHostKindPicker;for(const n of e)n.extHostKind!=null&&i.setForcedExtensionHostKind(n.identifier.id,n.extHostKind);for(const n of t)i.removeForcedExtensionHostKind(n.identifier.id);await this._handleDeltaExtensions(new Yv(e,t))}async _resolveExtensions(){return new Che([],[],!1,!1)}async _scanSingleExtension(e){return Mce(e)}_onExtensionHostExit(){this._doStopExtensionHosts()}_resolveAuthority(e){return this._resolveAuthorityOnExtensionHosts(2,e)}};xD=T([v(1,Te),v(2,on),v(3,Cu),v(4,gi),v(5,ev),v(6,at),v(7,Rs),v(8,J1),v(9,oi),v(10,We),v(11,hb),v(12,ze),v(13,Wa),v(14,D$),v(15,ea),v(16,wu),v(17,OT),v(18,ar)],xD);let RO;vme({"vs/workbench/services/extensions/worker/webWorkerExtensionHostIframe.html":()=>S8(new URL("/assets/webWorkerExtensionHostIframe-1656b228.html",self.location).href,RO)});function Z8(r,e){e!=null&&(RO=e);const t=r!=null?{...r,url:S8(r.url,RO)}:void 0;return{...b8(),[yr.toString()]:new er(xD,[t]),[hb.toString()]:new er(x0)}}function e6(){return Lye}const Fye=Object.freeze(Object.defineProperty({__proto__:null,get ExtensionHostKind(){return P0},LocalExtHostExtensionService:X8,get SimpleExtensionService(){return xD},default:Z8,getLocalExtHostExtensionService:e6},Symbol.toStringTag,{value:"Module"})),t6=[];function Q1e(r){t6.push(r)}async function Oye(r){const e=ka.initialize({...i5(),...n5(),...Z8(),...r});return await e.invokeFunction(async t=>{const i=t.get(ea);await Promise.all(t6.map(n=>n(t))),i.phase=2}),e}const i6=new A,Y1e=i6.event,Nye=new Cs;async function $ye(r){const e=await Oye(r);Nye.open(),e.invokeFunction(t=>{const i=t.get(ea);st.as(Js.Workbench).start(t),i6.fire(t),i.phase=3,new Ys(()=>{Vy(()=>{i.phase=4},2500)},2500).schedule()})}async function Wye(r,e,t,i,n,s){let o;try{await Hye(r,e,t,i,n,s)}catch(a){o=a}finally{o&&n.errorTransformer&&(o=n.errorTransformer(o)),typeof o<"u"&&t.error(o),t.end()}}async function Hye(r,e,t,i,n,s){lP(s);const o=await r.open(e,{create:!1});try{lP(s);let a=0,c=0,d=n&&typeof n.length=="number"?n.length:void 0,l=De.alloc(Math.min(n.bufferSize,typeof d=="number"?d:n.bufferSize)),u=n&&typeof n.position=="number"?n.position:0,h=0;do c=await r.read(o,u,l.buffer,h,l.byteLength-h),u+=c,h+=c,a+=c,typeof d=="number"&&(d-=c),h===l.byteLength&&(await t.write(i(l)),l=De.alloc(Math.min(n.bufferSize,typeof d=="number"?d:n.bufferSize)),h=0);while(c>0&&(typeof d!="number"||d>0)&&lP(s)&&jye(a,n));if(h>0){let g=h;typeof d=="number"&&(g=Math.min(h,d)),t.write(i(l.slice(0,g)))}}catch(a){throw $u(a)}finally{await r.close(o)}}function lP(r){if(r.isCancellationRequested)throw Ll();return!0}function jye(r,e){var t;if(typeof((t=e==null?void 0:e.limits)==null?void 0:t.size)=="number"&&r>e.limits.size)throw An(p("fileTooLargeError","File is too large to open"),lt.FileTooLarge);return!0}let PO=class extends ne{constructor(e){super(),this.logService=e,this.BUFFER_SIZE=256*1024,this._onDidChangeFileSystemProviderRegistrations=this._register(new A),this.onDidChangeFileSystemProviderRegistrations=this._onDidChangeFileSystemProviderRegistrations.event,this._onWillActivateFileSystemProvider=this._register(new A),this.onWillActivateFileSystemProvider=this._onWillActivateFileSystemProvider.event,this._onDidChangeFileSystemProviderCapabilities=this._register(new A),this.onDidChangeFileSystemProviderCapabilities=this._onDidChangeFileSystemProviderCapabilities.event,this.provider=new Map,this._onDidRunOperation=this._register(new A),this.onDidRunOperation=this._onDidRunOperation.event,this._onDidFilesChange=this._register(new A),this.onDidFilesChange=this._onDidFilesChange.event,this._onDidWatchError=this._register(new A),this.onDidWatchError=this._onDidWatchError.event,this.activeWatchers=new Map,this.writeQueue=this._register(new ak)}registerProvider(e,t){if(this.provider.has(e))throw new Error(`A filesystem provider for the scheme '${e}' is already registered.`);qt(`code/registerFilesystem/${e}`);const i=new me;return this.provider.set(e,t),this._onDidChangeFileSystemProviderRegistrations.fire({added:!0,scheme:e,provider:t}),i.add(t.onDidChangeFile(n=>this._onDidFilesChange.fire(new xX(n,!this.isPathCaseSensitive(t))))),typeof t.onDidWatchError=="function"&&i.add(t.onDidWatchError(n=>this._onDidWatchError.fire(new Error(n)))),i.add(t.onDidChangeCapabilities(()=>this._onDidChangeFileSystemProviderCapabilities.fire({provider:t,scheme:e}))),ot(()=>{this._onDidChangeFileSystemProviderRegistrations.fire({added:!1,scheme:e,provider:t}),this.provider.delete(e),vt(i)})}getProvider(e){return this.provider.get(e)}async activateProvider(e){const t=[];this._onWillActivateFileSystemProvider.fire({scheme:e,join(i){t.push(i)}}),!this.provider.has(e)&&await Sn.settled(t)}async canHandleResource(e){return await this.activateProvider(e.scheme),this.hasProvider(e)}hasProvider(e){return this.provider.has(e.scheme)}hasCapability(e,t){const i=this.provider.get(e.scheme);return!!(i&&i.capabilities&t)}listCapabilities(){return Go.map(this.provider,([e,t])=>({scheme:e,capabilities:t.capabilities}))}async withProvider(e){if(!Wq(e))throw new Fs(p("invalidPath","Unable to resolve filesystem provider with relative file path '{0}'",this.resourceForError(e)),8);await this.activateProvider(e.scheme);const t=this.provider.get(e.scheme);if(!t){const i=new rc;throw i.message=p("noProviderFound","ENOPRO: No file system provider found for resource '{0}'",e.toString()),i}return t}async withReadProvider(e){const t=await this.withProvider(e);if(Vd(t)||Mc(t)||BI(t))return t;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite, FileReadStream nor FileOpenReadWriteClose capability which is needed for the read operation.`)}async withWriteProvider(e){const t=await this.withProvider(e);if(Vd(t)||Mc(t))return t;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite nor FileOpenReadWriteClose capability which is needed for the write operation.`)}async resolve(e,t){try{return await this.doResolveFile(e,t)}catch(i){throw bh(i)===lt.FileNotFound?new Fs(p("fileNotFoundError","Unable to resolve nonexistent file '{0}'",this.resourceForError(e)),1):$u(i)}}async doResolveFile(e,t){const i=await this.withProvider(e),n=this.isPathCaseSensitive(i),s=t==null?void 0:t.resolveTo,o=t==null?void 0:t.resolveSingleChildDescendants,a=t==null?void 0:t.resolveMetadata,c=await i.stat(e);let d;return this.toFileStat(i,e,c,void 0,!!a,(l,u)=>(d||(d=pc.forUris(()=>!n),d.set(e,!0),s&&d.fill(!0,s)),d.get(l.resource)||d.findSuperstr(l.resource.with({query:null,fragment:null}))?!0:l.isDirectory&&o?u===1:!1))}async toFileStat(e,t,i,n,s,o){const{providerExtUri:a}=this.getExtUri(e),c={resource:t,name:a.basename(t),isFile:(i.type&Or.File)!==0,isDirectory:(i.type&Or.Directory)!==0,isSymbolicLink:(i.type&Or.SymbolicLink)!==0,mtime:i.mtime,ctime:i.ctime,size:i.size,readonly:!!((i.permissions??0)&ad.Readonly)||!!(e.capabilities&2048),locked:!!((i.permissions??0)&ad.Locked),etag:MP({mtime:i.mtime,size:i.size}),children:void 0};if(c.isDirectory&&o(c,n)){try{const d=await e.readdir(t),l=await Sn.settled(d.map(async([u,h])=>{try{const g=a.joinPath(t,u),m=s?await e.stat(g):{type:h};return await this.toFileStat(e,g,m,d.length,s,o)}catch(g){return this.logService.trace(g),null}}));c.children=fi(l)}catch(d){this.logService.trace(d),c.children=[]}return c}return c}async resolveAll(e){return Sn.settled(e.map(async t=>{try{return{stat:await this.doResolveFile(t.resource,t.options),success:!0}}catch(i){return this.logService.trace(i),{stat:void 0,success:!1}}}))}async stat(e){const t=await this.withProvider(e),i=await t.stat(e);return this.toFileStat(t,e,i,void 0,!0,()=>!1)}async exists(e){const t=await this.withProvider(e);try{return!!await t.stat(e)}catch{return!1}}async canCreateFile(e,t){try{await this.doValidateCreateFile(e,t)}catch(i){return i}return!0}async doValidateCreateFile(e,t){if(!(t!=null&&t.overwrite)&&await this.exists(e))throw new Fs(p("fileExists","Unable to create file '{0}' that already exists when overwrite flag is not set",this.resourceForError(e)),3,t)}async createFile(e,t=De.fromString(""),i){await this.doValidateCreateFile(e,i);const n=await this.writeFile(e,t);return this._onDidRunOperation.fire(new ip(e,0,n)),n}async writeFile(e,t,i){var o;const n=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e),{providerExtUri:s}=this.getExtUri(n);try{await this.validateWriteFile(n,e,i)||await this.mkdirp(n,s.dirname(e));let c;if(Mc(n)&&!(t instanceof De))if(vy(t)){const d=await vq(t,3);d.ended?c=De.concat(d.buffer):c=d}else c=DX(t,d=>De.concat(d),3);else c=t;if(!Vd(n)||Mc(n)&&c instanceof De)await this.doWriteUnbuffered(n,e,i,c);else{const d=c instanceof De?gq(c):c;(i==null?void 0:i.atomic)!==!1&&((o=i==null?void 0:i.atomic)!=null&&o.postfix)?await this.doWriteBufferedAtomic(n,e,pt(pn(e),`${Mt(e)}${i.atomic.postfix}`),i,d):await this.doWriteBuffered(n,e,i,d)}this._onDidRunOperation.fire(new ip(e,4))}catch(a){throw new Fs(p("err.write","Unable to write file '{0}' ({1})",this.resourceForError(e),$u(a).toString()),FH(a),i)}return this.resolve(e,{resolveMetadata:!0})}async validateWriteFile(e,t,i){const n=!!(i!=null&&i.unlock);if(n&&!(e.capabilities&8192))throw new Error(p("writeFailedUnlockUnsupported","Unable to unlock file '{0}' because provider does not support it.",this.resourceForError(t)));if(!!(i!=null&&i.atomic)){if(!(e.capabilities&32768))throw new Error(p("writeFailedAtomicUnsupported","Unable to atomically write file '{0}' because provider does not support it.",this.resourceForError(t)));if(n)throw new Error(p("writeFailedAtomicUnlock","Unable to unlock file '{0}' because atomic write is enabled.",this.resourceForError(t)))}let o;try{o=await e.stat(t)}catch{return}if(o.type&Or.Directory)throw new Fs(p("fileIsDirectoryWriteError","Unable to write file '{0}' that is actually a directory",this.resourceForError(t)),0,i);if(this.throwIfFileIsReadonly(t,o),typeof(i==null?void 0:i.mtime)=="number"&&typeof i.etag=="string"&&i.etag!==oh&&typeof o.mtime=="number"&&typeof o.size=="number"&&i.mtime<o.mtime&&i.etag!==MP({mtime:i.mtime,size:o.size}))throw new Fs(p("fileModifiedError","File Modified Since"),3,i);return o}async readFile(e,t,i){const n=await this.withReadProvider(e);return t!=null&&t.atomic?this.doReadFileAtomic(n,e,t,i):this.doReadFile(n,e,t,i)}async doReadFileAtomic(e,t,i,n){return new Promise((s,o)=>{this.writeQueue.queueFor(t,this.getExtUri(e).providerExtUri).queue(async()=>{try{const a=await this.doReadFile(e,t,i,n);s(a)}catch(a){o(a)}})})}async doReadFile(e,t,i,n){const s=await this.doReadFileStream(e,t,{...i,preferUnbuffered:!0},n);return{...s,value:await yy(s.value)}}async readFileStream(e,t,i){const n=await this.withReadProvider(e);return this.doReadFileStream(n,e,t,i)}async doReadFileStream(e,t,i,n){const s=new Xt(n),o=this.validateReadFile(t,i).then(c=>c,c=>{throw s.cancel(),c});let a;try{return typeof(i==null?void 0:i.etag)=="string"&&i.etag!==oh&&await o,i!=null&&i.atomic&&OH(e)||!(Vd(e)||BI(e))||Mc(e)&&(i!=null&&i.preferUnbuffered)?a=this.readFileUnbuffered(e,t,i):BI(e)?a=this.readFileStreamed(e,t,s.token,i):a=this.readFileBuffered(e,t,s.token,i),{...await o,value:a}}catch(c){throw a&&await wq(a),this.restoreReadError(c,t,i)}}restoreReadError(e,t,i){const n=p("err.read","Unable to read file '{0}' ({1})",this.resourceForError(t),$u(e).toString());return e instanceof fS?new fS(n,e.stat,i):e instanceof gS?new gS(n,e.fileOperationResult,e.size,e.options):new Fs(n,FH(e),i)}readFileStreamed(e,t,i,n=Object.create(null)){const s=e.readFileStream(t,n,i);return kX(s,{data:o=>o instanceof De?o:De.wrap(o),error:o=>this.restoreReadError(o,t,n)},o=>De.concat(o))}readFileBuffered(e,t,i,n=Object.create(null)){const s=xG();return Wye(e,t,s,o=>o,{...n,bufferSize:this.BUFFER_SIZE,errorTransformer:o=>this.restoreReadError(o,t,n)},i),s}readFileUnbuffered(e,t,i){const n=pq(s=>De.concat(s));return(async()=>{try{let s;i!=null&&i.atomic&&OH(e)?s=await e.readFile(t,{atomic:!0}):s=await e.readFile(t),typeof(i==null?void 0:i.position)=="number"&&(s=s.slice(i.position)),typeof(i==null?void 0:i.length)=="number"&&(s=s.slice(0,i.length)),this.validateReadFileLimits(t,s.byteLength,i),n.end(De.wrap(s))}catch(s){n.error(s),n.end()}})(),n}async validateReadFile(e,t){const i=await this.resolve(e,{resolveMetadata:!0});if(i.isDirectory)throw new Fs(p("fileIsDirectoryReadError","Unable to read file '{0}' that is actually a directory",this.resourceForError(e)),0,t);if(typeof(t==null?void 0:t.etag)=="string"&&t.etag!==oh&&t.etag===i.etag)throw new fS(p("fileNotModifiedError","File not modified since"),i,t);return this.validateReadFileLimits(e,i.size,t),i}validateReadFileLimits(e,t,i){var n;if(typeof((n=i==null?void 0:i.limits)==null?void 0:n.size)=="number"&&t>i.limits.size)throw new gS(p("fileTooLargeError","Unable to read file '{0}' that is too large to open",this.resourceForError(e)),7,t,i)}async canMove(e,t,i){return this.doCanMoveCopy(e,t,"move",i)}async canCopy(e,t,i){return this.doCanMoveCopy(e,t,"copy",i)}async doCanMoveCopy(e,t,i,n){if(e.toString()!==t.toString())try{const s=i==="move"?this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e):await this.withReadProvider(e),o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t);await this.doValidateMoveCopy(s,e,o,t,i,n)}catch(s){return s}return!0}async move(e,t,i){const n=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e),s=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t),o=await this.doMoveCopy(n,e,s,t,"move",!!i),a=await this.resolve(t,{resolveMetadata:!0});return this._onDidRunOperation.fire(new ip(e,o==="move"?2:3,a)),a}async copy(e,t,i){const n=await this.withReadProvider(e),s=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t),o=await this.doMoveCopy(n,e,s,t,"copy",!!i),a=await this.resolve(t,{resolveMetadata:!0});return this._onDidRunOperation.fire(new ip(e,o==="copy"?3:2,a)),a}async doMoveCopy(e,t,i,n,s,o){if(t.toString()===n.toString())return s;const{exists:a,isSameResourceWithDifferentPathCase:c}=await this.doValidateMoveCopy(e,t,i,n,s,o);if(a&&!c&&o&&await this.del(n,{recursive:!0}),await this.mkdirp(i,this.getExtUri(i).providerExtUri.dirname(n)),s==="copy"){if(e===i&&NH(e))await e.copy(t,n,{overwrite:o});else{const d=await this.resolve(t);d.isDirectory?await this.doCopyFolder(e,d,i,n):await this.doCopyFile(e,t,i,n)}return s}else return e===i?(await e.rename(t,n,{overwrite:o}),s):(await this.doMoveCopy(e,t,i,n,"copy",o),await this.del(t,{recursive:!0}),"copy")}async doCopyFile(e,t,i,n){if(Vd(e)&&Vd(i))return this.doPipeBuffered(e,t,i,n);if(Vd(e)&&Mc(i))return this.doPipeBufferedToUnbuffered(e,t,i,n);if(Mc(e)&&Vd(i))return this.doPipeUnbufferedToBuffered(e,t,i,n);if(Mc(e)&&Mc(i))return this.doPipeUnbuffered(e,t,i,n)}async doCopyFolder(e,t,i,n){await i.mkdir(n),Array.isArray(t.children)&&await Sn.settled(t.children.map(async s=>{const o=this.getExtUri(i).providerExtUri.joinPath(n,s.name);return s.isDirectory?this.doCopyFolder(e,await this.resolve(s.resource),i,o):this.doCopyFile(e,s.resource,i,o)}))}async doValidateMoveCopy(e,t,i,n,s,o){let a=!1;if(e===i){const{providerExtUri:d,isPathCaseSensitive:l}=this.getExtUri(e);if(l||(a=d.isEqual(t,n)),a&&s==="copy")throw new Error(p("unableToMoveCopyError1","Unable to copy when source '{0}' is same as target '{1}' with different path case on a case insensitive file system",this.resourceForError(t),this.resourceForError(n)));if(!a&&d.isEqualOrParent(n,t))throw new Error(p("unableToMoveCopyError2","Unable to move/copy when source '{0}' is parent of target '{1}'.",this.resourceForError(t),this.resourceForError(n)))}const c=await this.exists(n);if(c&&!a){if(!o)throw new Fs(p("unableToMoveCopyError3","Unable to move/copy '{0}' because target '{1}' already exists at destination.",this.resourceForError(t),this.resourceForError(n)),4);if(e===i){const{providerExtUri:d}=this.getExtUri(e);if(d.isEqualOrParent(t,n))throw new Error(p("unableToMoveCopyError4","Unable to move/copy '{0}' into '{1}' since a file would replace the folder it is contained in.",this.resourceForError(t),this.resourceForError(n)))}}return{exists:c,isSameResourceWithDifferentPathCase:a}}getExtUri(e){const t=this.isPathCaseSensitive(e);return{providerExtUri:t?Yw:bC,isPathCaseSensitive:t}}isPathCaseSensitive(e){return!!(e.capabilities&1024)}async createFolder(e){const t=this.throwIfFileSystemIsReadonly(await this.withProvider(e),e);await this.mkdirp(t,e);const i=await this.resolve(e,{resolveMetadata:!0});return this._onDidRunOperation.fire(new ip(e,0,i)),i}async mkdirp(e,t){const i=[],{providerExtUri:n}=this.getExtUri(e);for(;!n.isEqual(t,n.dirname(t));)try{if(!((await e.stat(t)).type&Or.Directory))throw new Error(p("mkdirExistsError","Unable to create folder '{0}' that already exists but is not a directory",this.resourceForError(t)));break}catch(s){if(bh(s)!==lt.FileNotFound)throw s;i.push(n.basename(t)),t=n.dirname(t)}for(let s=i.length-1;s>=0;s--){t=n.joinPath(t,i[s]);try{await e.mkdir(t)}catch(o){if(bh(o)!==lt.FileExists)throw o}}}async canDelete(e,t){try{await this.doValidateDelete(e,t)}catch(i){return i}return!0}async doValidateDelete(e,t){const i=this.throwIfFileSystemIsReadonly(await this.withProvider(e),e),n=!!(t!=null&&t.useTrash);if(n&&!(i.capabilities&4096))throw new Error(p("deleteFailedTrashUnsupported","Unable to delete file '{0}' via trash because provider does not support it.",this.resourceForError(e)));const s=t==null?void 0:t.atomic;if(s&&!(i.capabilities&65536))throw new Error(p("deleteFailedAtomicUnsupported","Unable to delete file '{0}' atomically because provider does not support it.",this.resourceForError(e)));if(n&&s)throw new Error(p("deleteFailedTrashAndAtomicUnsupported","Unable to atomically delete file '{0}' because using trash is enabled.",this.resourceForError(e)));let o;try{o=await i.stat(e)}catch{}if(o)this.throwIfFileIsReadonly(e,o);else throw new Fs(p("deleteFailedNotFound","Unable to delete nonexistent file '{0}'",this.resourceForError(e)),1);if(!!!(t!=null&&t.recursive)){const c=await this.resolve(e);if(c.isDirectory&&Array.isArray(c.children)&&c.children.length>0)throw new Error(p("deleteFailedNonEmptyFolder","Unable to delete non-empty folder '{0}'.",this.resourceForError(e)))}return i}async del(e,t){const i=await this.doValidateDelete(e,t),n=!!(t!=null&&t.useTrash),s=!!(t!=null&&t.recursive),o=(t==null?void 0:t.atomic)??!1;await i.delete(e,{recursive:s,useTrash:n,atomic:o}),this._onDidRunOperation.fire(new ip(e,1))}async cloneFile(e,t){const i=await this.withProvider(e),n=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t);if(i===n&&this.getExtUri(i).providerExtUri.isEqual(e,t))return;if(i===n&&TX(i))return i.cloneFile(e,t);await this.mkdirp(n,this.getExtUri(n).providerExtUri.dirname(t));const s=this.writeQueue.queueFor(e,this.getExtUri(i).providerExtUri);return i===n&&NH(i)?s.queue(()=>i.copy(e,t,{overwrite:!0})):s.queue(()=>this.doCopyFile(i,e,n,t))}watch(e,t={recursive:!1,excludes:[]}){const i=new me;let n=!1,s=()=>{n=!0};return i.add(ot(()=>s())),(async()=>{try{const o=await this.doWatch(e,t);n?vt(o):s=()=>vt(o)}catch(o){this.logService.error(o)}})(),i}async doWatch(e,t){const i=await this.withProvider(e),n=yc([this.getExtUri(i).providerExtUri.getComparisonKey(e),t]);let s=this.activeWatchers.get(n);return s||(s={count:0,disposable:i.watch(e,t)},this.activeWatchers.set(n,s)),s.count+=1,ot(()=>{s&&(s.count--,s.count===0&&(vt(s.disposable),this.activeWatchers.delete(n)))})}dispose(){super.dispose();for(const[,e]of this.activeWatchers)vt(e.disposable);this.activeWatchers.clear()}async doWriteBufferedAtomic(e,t,i,n,s){await this.doWriteBuffered(e,i,n,s);try{await e.rename(i,t,{overwrite:!0})}catch(o){try{await e.delete(i,{recursive:!1,useTrash:!1,atomic:!1})}catch{}throw o}}async doWriteBuffered(e,t,i,n){return this.writeQueue.queueFor(t,this.getExtUri(e).providerExtUri).queue(async()=>{const s=await e.open(t,{create:!0,unlock:(i==null?void 0:i.unlock)??!1});try{vy(n)||UI(n)?await this.doWriteStreamBufferedQueued(e,s,n):await this.doWriteReadableBufferedQueued(e,s,n)}catch(o){throw $u(o)}finally{await e.close(s)}})}async doWriteStreamBufferedQueued(e,t,i){let n=0,s;if(UI(i)){if(i.buffer.length>0){const o=De.concat(i.buffer);await this.doWriteBuffer(e,t,o,o.byteLength,n,0),n+=o.byteLength}if(i.ended)return;s=i.stream}else s=i;return new Promise((o,a)=>{VN(s,{onData:async c=>{s.pause();try{await this.doWriteBuffer(e,t,c,c.byteLength,n,0)}catch(d){return a(d)}n+=c.byteLength,setTimeout(()=>s.resume())},onError:c=>a(c),onEnd:()=>o()})})}async doWriteReadableBufferedQueued(e,t,i){let n=0,s;for(;(s=i.read())!==null;)await this.doWriteBuffer(e,t,s,s.byteLength,n,0),n+=s.byteLength}async doWriteBuffer(e,t,i,n,s,o){let a=0;for(;a<n;){const c=await e.write(t,s+a,i.buffer,o+a,n-a);a+=c}}async doWriteUnbuffered(e,t,i,n){return this.writeQueue.queueFor(t,this.getExtUri(e).providerExtUri).queue(()=>this.doWriteUnbufferedQueued(e,t,i,n))}async doWriteUnbufferedQueued(e,t,i,n){let s;n instanceof De?s=n:vy(n)?s=await yy(n):UI(n)?s=await IX(n):s=yq(n),await e.writeFile(t,s.buffer,{create:!0,overwrite:!0,unlock:(i==null?void 0:i.unlock)??!1,atomic:(i==null?void 0:i.atomic)??!1})}async doPipeBuffered(e,t,i,n){return this.writeQueue.queueFor(n,this.getExtUri(i).providerExtUri).queue(()=>this.doPipeBufferedQueued(e,t,i,n))}async doPipeBufferedQueued(e,t,i,n){let s,o;try{s=await e.open(t,{create:!1}),o=await i.open(n,{create:!0,unlock:!1});const a=De.alloc(this.BUFFER_SIZE);let c=0,d=0,l=0;do l=await e.read(s,c,a.buffer,d,a.byteLength-d),await this.doWriteBuffer(i,o,a,l,c,d),c+=l,d+=l,d===a.byteLength&&(d=0);while(l>0)}catch(a){throw $u(a)}finally{await Sn.settled([typeof s=="number"?e.close(s):Promise.resolve(),typeof o=="number"?i.close(o):Promise.resolve()])}}async doPipeUnbuffered(e,t,i,n){return this.writeQueue.queueFor(n,this.getExtUri(i).providerExtUri).queue(()=>this.doPipeUnbufferedQueued(e,t,i,n))}async doPipeUnbufferedQueued(e,t,i,n){return i.writeFile(n,await e.readFile(t),{create:!0,overwrite:!0,unlock:!1,atomic:!1})}async doPipeUnbufferedToBuffered(e,t,i,n){return this.writeQueue.queueFor(n,this.getExtUri(i).providerExtUri).queue(()=>this.doPipeUnbufferedToBufferedQueued(e,t,i,n))}async doPipeUnbufferedToBufferedQueued(e,t,i,n){const s=await i.open(n,{create:!0,unlock:!1});try{const o=await e.readFile(t);await this.doWriteBuffer(i,s,De.wrap(o),o.byteLength,0,0)}catch(o){throw $u(o)}finally{await i.close(s)}}async doPipeBufferedToUnbuffered(e,t,i,n){const s=await yy(this.readFileBuffered(e,t,_t.None));await this.doWriteUnbuffered(i,n,void 0,s)}throwIfFileSystemIsReadonly(e,t){if(e.capabilities&2048)throw new Fs(p("err.readonly","Unable to modify read-only file '{0}'",this.resourceForError(t)),6);return e}throwIfFileIsReadonly(e,t){if((t.permissions??0)&ad.Readonly)throw new Fs(p("err.readonly","Unable to modify read-only file '{0}'",this.resourceForError(e)),6)}resourceForError(e){return e.scheme===pe.file?e.fsPath:e.toString(!0)}};PO=T([v(0,ze)],PO);class m2{constructor(e){this.type=Or.File,this.ctime=Date.now(),this.mtime=Date.now(),this.size=0,this.name=e}}class $v{constructor(e){this.type=Or.Directory,this.ctime=Date.now(),this.mtime=Date.now(),this.size=0,this.name=e,this.entries=new Map}}class rh extends ne{constructor(){super(...arguments),this._onDidChangeCapabilities=this._register(new A),this.onDidChangeCapabilities=this._onDidChangeCapabilities.event,this._capabilities=1026,this.root=new $v(""),this._onDidChangeFile=this._register(new A),this.onDidChangeFile=this._onDidChangeFile.event,this._bufferedChanges=[]}get capabilities(){return this._capabilities}setReadOnly(e){const t=!!(this._capabilities&2048);e!==t&&(this._capabilities=e?3074:1026,this._onDidChangeCapabilities.fire())}async stat(e){return this._lookup(e,!1)}async readdir(e){const t=this._lookupAsDirectory(e,!1),i=[];return t.entries.forEach((n,s)=>i.push([s,n.type])),i}async readFile(e){const t=this._lookupAsFile(e,!1).data;if(t)return t;throw An("file not found",lt.FileNotFound)}async writeFile(e,t,i){const n=Mt(e),s=this._lookupParentDirectory(e);let o=s.entries.get(n);if(o instanceof $v)throw An("file is directory",lt.FileIsADirectory);if(!o&&!i.create)throw An("file not found",lt.FileNotFound);if(o&&i.create&&!i.overwrite)throw An("file exists already",lt.FileExists);o||(o=new m2(n),s.entries.set(n,o),this._fireSoon({type:1,resource:e})),o.mtime=Date.now(),o.size=t.byteLength,o.data=t,this._fireSoon({type:0,resource:e})}async rename(e,t,i){if(!i.overwrite&&this._lookup(t,!0))throw An("file exists already",lt.FileExists);const n=this._lookup(e,!1),s=this._lookupParentDirectory(e),o=this._lookupParentDirectory(t),a=Mt(t);s.entries.delete(n.name),n.name=a,o.entries.set(a,n),this._fireSoon({type:2,resource:e},{type:1,resource:t})}async delete(e,t){const i=pn(e),n=Mt(e),s=this._lookupAsDirectory(i,!1);s.entries.has(n)&&(s.entries.delete(n),s.mtime=Date.now(),s.size-=1,this._fireSoon({type:0,resource:i},{resource:e,type:2}))}async mkdir(e){if(this._lookup(e,!0))throw An("file exists already",lt.FileExists);const t=Mt(e),i=pn(e),n=this._lookupAsDirectory(i,!1),s=new $v(t);n.entries.set(s.name,s),n.mtime=Date.now(),n.size+=1,this._fireSoon({type:0,resource:i},{type:1,resource:e})}_lookup(e,t){const i=e.path.split("/");let n=this.root;for(const s of i){if(!s)continue;let o;if(n instanceof $v&&(o=n.entries.get(s)),!o){if(t)return;throw An("file not found",lt.FileNotFound)}n=o}return n}_lookupAsDirectory(e,t){const i=this._lookup(e,t);if(i instanceof $v)return i;throw An("file not a directory",lt.FileNotADirectory)}_lookupAsFile(e,t){const i=this._lookup(e,t);if(i instanceof m2)return i;throw An("file is a directory",lt.FileIsADirectory)}_lookupParentDirectory(e){const t=pn(e);return this._lookupAsDirectory(t,!1)}watch(e,t){return ne.None}_fireSoon(...e){this._bufferedChanges.push(...e),this._fireSoonHandle&&clearTimeout(this._fireSoonHandle),this._fireSoonHandle=setTimeout(()=>{this._onDidChangeFile.fire(this._bufferedChanges),this._bufferedChanges.length=0},5)}}var Jl;(function(r){r[r.Unknown=0]="Unknown",r[r.File=1]="File",r[r.Directory=2]="Directory",r[r.SymbolicLink=64]="SymbolicLink"})(Jl||(Jl={}));var Lm;(function(r){r[r.Readonly=1]="Readonly",r[r.Locked=2]="Locked"})(Lm||(Lm={}));var AO;(function(r){r[r.None=0]="None",r[r.FileReadWrite=2]="FileReadWrite",r[r.FileOpenReadWriteClose=4]="FileOpenReadWriteClose",r[r.FileReadStream=16]="FileReadStream",r[r.FileFolderCopy=8]="FileFolderCopy",r[r.PathCaseSensitive=1024]="PathCaseSensitive",r[r.Readonly=2048]="Readonly",r[r.Trash=4096]="Trash",r[r.FileWriteUnlock=8192]="FileWriteUnlock",r[r.FileAtomicRead=16384]="FileAtomicRead",r[r.FileAtomicWrite=32768]="FileAtomicWrite",r[r.FileAtomicDelete=65536]="FileAtomicDelete",r[r.FileClone=131072]="FileClone"})(AO||(AO={}));var MO;(function(r){r[r.UPDATED=0]="UPDATED",r[r.ADDED=1]="ADDED",r[r.DELETED=2]="DELETED"})(MO||(MO={}));var Bye=".explorer-folders-view{height:100%}.explorer-item-hover{cursor:pointer!important;font-size:13px!important;height:22px;padding-left:6px;user-select:none!important}.explorer-folders-view .monaco-list-row{padding-left:4px}.explorer-folders-view .explorer-folders-view.highlight .monaco-list .explorer-item:not(.explorer-item-edited),.explorer-folders-view .explorer-folders-view.highlight .monaco-list .monaco-tl-twistie{opacity:.3}.explorer-folders-view .editor-group,.explorer-folders-view .explorer-item{height:22px;line-height:22px}.explorer-folders-view .explorer-item{display:flex;flex-wrap:nowrap}.explorer-folders-view .editor-group,.explorer-folders-view .explorer-item>a{overflow:hidden;text-overflow:ellipsis}.explorer-folders-view .explorer-item,.explorer-folders-view .explorer-item .monaco-inputbox{flex:1}.explorer-folders-view .explorer-item.cut{opacity:.5}.explorer-folders-view .explorer-item.explorer-item-edited .label-name{flex:0}.explorer-folders-view .pane-header .count{align-items:center;display:flex;min-width:fit-content}.pane-header .dirty-count.monaco-count-badge.hidden,.pane.horizontal:not(.expanded) .pane-header .dirty-count.monaco-count-badge{display:none}.dirty-count.monaco-count-badge{margin-left:6px;min-height:auto;padding:2px 4px}.explorer-folders-view .explorer-item.nonexistent-root{opacity:.5}.explorer-folders-view .explorer-item .monaco-inputbox{line-height:normal;width:100%}.explorer-folders-view .explorer-item .monaco-icon-name-container.multiple>.label-name>.monaco-highlighted-label{border-radius:3px}.explorer-folders-view .explorer-item .monaco-icon-name-container.multiple>.label-name:hover>.monaco-highlighted-label,.explorer-folders-view .monaco-list .monaco-list-row.focused .explorer-item .monaco-icon-name-container.multiple>.label-name.active>.monaco-highlighted-label{text-decoration:underline}.explorer-folders-view .explorer-item .monaco-icon-name-container.multiple>.label-name.drop-target>.monaco-highlighted-label{background-color:var(--vscode-list-dropBackground)}.explorer-folders-view .explorer-item.align-nest-icon-with-parent-icon{margin-left:var(--vscode-explorer-align-offset-margin-left)}.monaco-workbench.linux .explorer-folders-view .explorer-item .monaco-inputbox,.monaco-workbench.mac .explorer-folders-view .explorer-item .monaco-inputbox{height:22px}.monaco-workbench .explorer-folders-view .explorer-item .monaco-inputbox>.ibwrapper>.input{height:20px;padding:0}.monaco-workbench.hc-black .explorer-folders-view .explorer-item,.monaco-workbench.hc-light .explorer-folders-view .explorer-item{line-height:20px}.monaco-workbench .explorer-folders-view .explorer-item .monaco-inputbox input[type=text]{opacity:1;outline-color:var(--vscode-focusBorder);outline-offset:-1px;outline-style:solid;outline-width:1px}.monaco-workbench.context-menu-visible .explorer-folders-view.highlight .monaco-list-row{outline:none!important}";Ic(Bye,{});const Uye="revealInExplorer",J1e="workbench.action.files.revert",Z1e="explorer.openToSide",e$e="explorer.openWith",t$e="selectForCompare",i$e="compareSelected",n$e="compareFiles",r$e="workbench.files.action.compareWithSaved",s$e="copyFilePath",o$e="copyRelativeFilePath",a$e="workbench.action.files.saveAs",c$e=p("saveAs","Save As..."),d$e="workbench.action.files.save",l$e=p("save","Save"),u$e="workbench.action.files.saveWithoutFormatting",h$e=p("saveWithoutFormatting","Save without Formatting"),f$e="saveAll",Vye="workbench.files.action.saveAllInGroup",p$e="workbench.action.files.saveFiles",qye=new G("groupFocusedInOpenEditors",!1),Gye=new G("dirtyEditorFocusedInOpenEditors",!1),zye=new G("readonlyEditorFocusedInOpenEditors",!1),g$e=new G("resourceSelectedForCompare",!1),m$e="removeRootFolder",v$e=p("removeFolderFromWorkspace","Remove Folder from Workspace"),y$e="previousCompressedFolder",_$e="nextCompressedFolder",w$e="firstCompressedFolder",b$e="lastCompressedFolder",Kye="workbench.action.files.newUntitledFile",S$e=p("newUntitledFile","New Untitled Text File"),C$e="workbench.action.files.newFile";let Zl=class cC extends km{get scopedContextKeyService(){if(!this.diffEditorControl)return;const e=this.diffEditorControl.getOriginalEditor(),t=this.diffEditorControl.getModifiedEditor();return(e.hasTextFocus()?e:t).invokeWithinContext(i=>i.get(It))}constructor(e,t,i,n,s,o,a,c,d){super(cC.ID,e,t,i,n,o,s,a,c),this.preferencesService=d,this.diffEditorControl=void 0,this.diffNavigatorDisposables=this._register(new me),this.inputLifecycleStopWatch=void 0}getTitle(){return this.input?this.input.getName():p("textDiffEditor","Text Diff Editor")}createEditorControl(e,t){cC.widgetCounter++;let i=this.textResourceConfigurationService.getValue(void 0,"diffEditor.experimental.useVersion2");i==="first"&&(i=cC.widgetCounter===1),i?this.diffEditorControl=this._register(this.instantiationService.createInstance(RX,e,t,{})):this.diffEditorControl=this._register(this.instantiationService.createInstance(PX,e,t,{}))}updateEditorControlOptions(e){var t;(t=this.diffEditorControl)==null||t.updateOptions(e)}getMainControl(){var e;return(e=this.diffEditorControl)==null?void 0:e.getModifiedEditor()}async setInput(e,t,i,n){var s,o;this.inputLifecycleStopWatch=void 0,this.diffNavigatorDisposables.clear(),await super.setInput(e,t,i,n);try{const a=await e.resolve(t);if(n.isCancellationRequested)return;if(!(a instanceof B3)){this.openAsBinary(e,t);return}const c=Mi(this.diffEditorControl),d=a,l=d.textDiffEditorModel?c.createViewModel(d.textDiffEditorModel):null;await(l==null?void 0:l.waitForDiff()),c.setModel(l);let u=!1;LT(t==null?void 0:t.viewState)||(u=this.restoreTextDiffEditorViewState(e,t,i,c));let h=!1;t&&(h=Bx(t,c,1)),!h&&!u&&c.revealFirstDiff(),c.updateOptions({...this.getReadonlyConfiguration((s=d.modifiedModel)==null?void 0:s.isReadonly()),originalEditable:!((o=d.originalModel)!=null&&o.isReadonly())}),this.inputLifecycleStopWatch=new Tr(!1)}catch(a){await this.handleSetInputError(a,e,t)}}async handleSetInputError(e,t,i){if(this.isFileBinaryError(e))return this.openAsBinary(t,i);if(e.fileOperationResult===7&&this.group){let n;throw e instanceof gS?n=p("fileTooLargeForHeapErrorWithSize","At least one file is not displayed in the text compare editor because it is very large ({0}).",_s.formatSize(e.size)):n=p("fileTooLargeForHeapErrorWithoutSize","At least one file is not displayed in the text compare editor because it is very large."),vce(this.group,t,i,n,this.preferencesService)}throw e}restoreTextDiffEditorViewState(e,t,i,n){const s=this.loadEditorViewState(e,i);return s?(t!=null&&t.selection&&s.modified&&(s.modified.cursorState=[]),n.restoreViewState(s),!0):!1}openAsBinary(e,t){var a,c;const i=e.original,n=e.modified,s=this.instantiationService.createInstance(Ss,e.getName(),e.getDescription(),i,n,!0),o=st.as(au.EditorFactory).getFileEditorFactory();o.isFileEditor(i)&&i.setForceOpenAsBinary(),o.isFileEditor(n)&&n.setForceOpenAsBinary(),(this.group??this.editorGroupService.activeGroup).replaceEditors([{editor:e,replacement:s,options:{...t,activation:Yy.PRESERVE,pinned:(a=this.group)==null?void 0:a.isPinned(e),sticky:(c=this.group)==null?void 0:c.isSticky(e)}}])}setOptions(e){super.setOptions(e),e&&Bx(e,Mi(this.diffEditorControl),0)}shouldHandleConfigurationChangeEvent(e,t){return super.shouldHandleConfigurationChangeEvent(e,t)?!0:e.affectsConfiguration(t,"diffEditor")}computeConfiguration(e){const t=super.computeConfiguration(e);if(bn(e.diffEditor)){const i=Gi(e.diffEditor);i.diffCodeLens=i.codeLens,delete i.codeLens,i.diffWordWrap=i.wordWrap,delete i.wordWrap,Object.assign(t,i)}return t}getConfigurationOverrides(){var e;return{...super.getConfigurationOverrides(),...this.getReadonlyConfiguration((e=this.input)==null?void 0:e.isReadonly()),originalEditable:this.input instanceof Ss&&!this.input.original.isReadonly(),lineDecorationsWidth:"2ch"}}updateReadonly(e){var t;e instanceof Ss?(t=this.diffEditorControl)==null||t.updateOptions({...this.getReadonlyConfiguration(e.isReadonly()),originalEditable:!e.original.isReadonly()}):super.updateReadonly(e)}isFileBinaryError(e){return Array.isArray(e)?e.some(i=>this.isFileBinaryError(i)):e.textFileOperationResult===0}clearInput(){var t,i,n,s,o;super.clearInput();const e=(t=this.inputLifecycleStopWatch)==null?void 0:t.elapsed();this.inputLifecycleStopWatch=void 0,typeof e=="number"&&this.logInputLifecycleTelemetry(e,(s=(n=(i=this.getControl())==null?void 0:i.getModel())==null?void 0:n.modified)==null?void 0:s.getLanguageId()),this.diffNavigatorDisposables.clear(),(o=this.diffEditorControl)==null||o.setModel(null)}logInputLifecycleTelemetry(e,t){this.telemetryService.publicLog2("diffEditor.editorVisibleTime",{editorVisibleTimeMs:e,languageId:t??""})}getControl(){return this.diffEditorControl}focus(){var e;(e=this.diffEditorControl)==null||e.focus()}hasFocus(){var e;return((e=this.diffEditorControl)==null?void 0:e.hasTextFocus())||super.hasFocus()}setEditorVisible(e,t){var i,n;super.setEditorVisible(e,t),e?(i=this.diffEditorControl)==null||i.onVisible():(n=this.diffEditorControl)==null||n.onHide()}layout(e){var t;(t=this.diffEditorControl)==null||t.layout(e)}setBoundarySashes(e){var t;(t=this.diffEditorControl)==null||t.setBoundarySashes(e)}tracksEditorViewState(e){return e instanceof Ss}computeEditorViewState(e){if(!this.diffEditorControl)return;const t=this.diffEditorControl.getModel();if(!t||!t.modified||!t.original)return;const i=this.toEditorViewStateResource(t);if(i&&si(i,e))return ii(this.diffEditorControl.saveViewState())}toEditorViewStateResource(e){let t,i;if(e instanceof Ss?(t=e.original.resource,i=e.modified.resource):gr(e)||(t=e.original.uri,i=e.modified.uri),!(!t||!i))return k.from({scheme:"diff",path:`${t_(t.toString())}${t_(i.toString())}`})}};Zl.ID=c3;Zl.widgetCounter=0;Zl=T([v(0,gi),v(1,Te),v(2,ri),v(3,Do),v(4,Ke),v(5,Fi),v(6,it),v(7,at),v(8,Q1)],Zl);var Qye='.quick-input-list .quick-input-list-entry.has-actions:hover .quick-input-list-entry-action-bar .action-label.dirty-editor:before{content:"\\ea76"}';Ic(Qye,{});let Dw=class extends AX{constructor(e,t,i,n,s){super(e,{canAcceptInBackground:!0,noResultsPick:{label:p("noViewResults","No matching editors"),groupId:-1}}),this.editorGroupService=t,this.editorService=i,this.modelService=n,this.languageService=s,this.pickState=new class{constructor(){this.scorerCache=Object.create(null),this.isQuickNavigating=void 0}reset(o){o||(this.scorerCache=Object.create(null)),this.isQuickNavigating=o}}}provide(e,t){return this.pickState.reset(!!e.quickNavigate),super.provide(e,t)}_getPicks(e){const t=MX(e),i=this.doGetEditorPickItems().filter(s=>{if(!t.normalized)return!0;const o=LX(s,t,!0,$H,this.pickState.scorerCache);return o.score?(s.highlights={label:o.labelMatch,description:o.descriptionMatch},!0):!1});if(t.normalized){const s=this.editorGroupService.getGroups(2).map(o=>o.id);i.sort((o,a)=>o.groupId!==a.groupId?s.indexOf(o.groupId)-s.indexOf(a.groupId):FX(o,a,t,!0,$H,this.pickState.scorerCache))}const n=[];if(this.editorGroupService.count>1){let s;for(const o of i){if(typeof s!="number"||s!==o.groupId){const a=this.editorGroupService.getGroup(o.groupId);a&&n.push({type:"separator",label:a.label}),s=o.groupId}n.push(o)}}else n.push(...i);return n}doGetEditorPickItems(){const e=this.doGetEditors(),t=new Map;for(const{groupId:i}of e)if(!t.has(i)){const n=this.editorGroupService.getGroup(i);n&&t.set(i,n.ariaLabel)}return this.doGetEditors().map(({editor:i,groupId:n})=>{var d;const s=Vn.getOriginalUri(i,{supportSideBySide:Ui.PRIMARY}),o=i.isDirty()&&!i.isSaving(),a=i.getDescription(),c=a?`${i.getName()} ${a}`:i.getName();return{groupId:n,resource:s,label:i.getName(),ariaLabel:(()=>t.size>1?o?p("entryAriaLabelWithGroupDirty","{0}, unsaved changes, {1}",c,t.get(n)):p("entryAriaLabelWithGroup","{0}, {1}",c,t.get(n)):o?p("entryAriaLabelDirty","{0}, unsaved changes",c):c)(),description:a,iconClasses:yG(this.modelService,this.languageService,s).concat(i.getLabelExtraClasses()),italic:!((d=this.editorGroupService.getGroup(n))!=null&&d.isPinned(i)),buttons:(()=>[{iconClass:o?"dirty-editor "+Si.asClassName(jt.closeDirty):Si.asClassName(jt.close),tooltip:p("closeEditor","Close Editor"),alwaysVisible:o}])(),trigger:async()=>{const l=this.editorGroupService.getGroup(n);return l&&(await l.closeEditor(i,{preserveFocus:!0}),!l.contains(i))?WH.REMOVE_ITEM:WH.NO_ACTION},accept:(l,u)=>{var h;return(h=this.editorGroupService.getGroup(n))==null?void 0:h.openEditor(i,{preserveFocus:u.inBackground})}}})}};Dw=T([v(1,it),v(2,Ke),v(3,_i),v(4,ji)],Dw);let kf=class n6 extends Dw{constructor(e,t,i,n){super(n6.PREFIX,e,t,i,n)}doGetEditors(){const e=this.editorGroupService.activeGroup;return e.getEditors(0).map(t=>({editor:t,groupId:e.id}))}};kf.PREFIX="edt active ";kf=T([v(0,it),v(1,Ke),v(2,_i),v(3,ji)],kf);let DD=class r6 extends Dw{constructor(e,t,i,n){super(r6.PREFIX,e,t,i,n)}doGetEditors(){const e=[];for(const t of this.editorGroupService.getGroups(2))for(const i of t.getEditors(1))e.push({editor:i,groupId:t.id});return e}};DD.PREFIX="edt ";DD=T([v(0,it),v(1,Ke),v(2,_i),v(3,ji)],DD);let Fm=class s6 extends Dw{constructor(e,t,i,n){super(s6.PREFIX,e,t,i,n)}doGetEditors(){const e=[];for(const t of this.editorService.getEditors(0))e.push(t);return e}};Fm.PREFIX="edt mru ";Fm=T([v(0,it),v(1,Ke),v(2,_i),v(3,ji)],Fm);var Yye=".side-by-side-editor-container{height:100%;width:100%}";Ic(Yye,{});function Xye(r){const e=r;return typeof(e==null?void 0:e.primary)=="object"&&typeof e.secondary=="object"}let Ca=class Lp extends Ux{get minimumPrimaryWidth(){return this.primaryEditorPane?this.primaryEditorPane.minimumWidth:0}get maximumPrimaryWidth(){return this.primaryEditorPane?this.primaryEditorPane.maximumWidth:Number.POSITIVE_INFINITY}get minimumPrimaryHeight(){return this.primaryEditorPane?this.primaryEditorPane.minimumHeight:0}get maximumPrimaryHeight(){return this.primaryEditorPane?this.primaryEditorPane.maximumHeight:Number.POSITIVE_INFINITY}get minimumSecondaryWidth(){return this.secondaryEditorPane?this.secondaryEditorPane.minimumWidth:0}get maximumSecondaryWidth(){return this.secondaryEditorPane?this.secondaryEditorPane.maximumWidth:Number.POSITIVE_INFINITY}get minimumSecondaryHeight(){return this.secondaryEditorPane?this.secondaryEditorPane.minimumHeight:0}get maximumSecondaryHeight(){return this.secondaryEditorPane?this.secondaryEditorPane.maximumHeight:Number.POSITIVE_INFINITY}set minimumWidth(e){}set maximumWidth(e){}set minimumHeight(e){}set maximumHeight(e){}get minimumWidth(){return this.minimumPrimaryWidth+this.minimumSecondaryWidth}get maximumWidth(){return this.maximumPrimaryWidth+this.maximumSecondaryWidth}get minimumHeight(){return this.minimumPrimaryHeight+this.minimumSecondaryHeight}get maximumHeight(){return this.maximumPrimaryHeight+this.maximumSecondaryHeight}constructor(e,t,i,n,s,o,a,c){super(Lp.ID,Lp.VIEW_STATE_PREFERENCE_KEY,e,t,n,o,i,a,c),this.configurationService=s,this.onDidCreateEditors=this._register(new A),this._onDidChangeSizeConstraints=this._register(new OX),this.onDidChangeSizeConstraints=F.any(this.onDidCreateEditors.event,this._onDidChangeSizeConstraints.event),this._onDidChangeSelection=this._register(new A),this.onDidChangeSelection=this._onDidChangeSelection.event,this.primaryEditorPane=void 0,this.secondaryEditorPane=void 0,this.splitviewDisposables=this._register(new me),this.editorDisposables=this._register(new me),this.orientation=this.configurationService.getValue(Lp.SIDE_BY_SIDE_LAYOUT_SETTING)==="vertical"?0:1,this.dimension=new Fl(0,0),this.lastFocusedSide=void 0,this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e)))}onConfigurationUpdated(e){e.affectsConfiguration(Lp.SIDE_BY_SIDE_LAYOUT_SETTING)&&(this.orientation=this.configurationService.getValue(Lp.SIDE_BY_SIDE_LAYOUT_SETTING)==="vertical"?0:1,this.splitview&&this.recreateSplitview())}recreateSplitview(){const e=Mi(this.getContainer()),t=this.getSplitViewRatio();this.splitview&&(e.removeChild(this.splitview.el),this.splitviewDisposables.clear()),this.createSplitView(e,t),this.layout(this.dimension)}getSplitViewRatio(){let e;if(this.splitview){const t=this.splitview.getViewSize(0),i=this.splitview.getViewSize(1);if(Math.abs(t-i)>1){const n=this.splitview.orientation===1?this.dimension.width:this.dimension.height;e=t/n}}return e}createEditor(e){e.classList.add("side-by-side-editor"),this.secondaryEditorContainer=Ve(".side-by-side-editor-container.editor-instance"),this.primaryEditorContainer=Ve(".side-by-side-editor-container.editor-instance"),this.createSplitView(e)}createSplitView(e,t){var a,c,d;this.splitview=this.splitviewDisposables.add(new LP(e,{orientation:this.orientation})),this.splitviewDisposables.add(this.splitview.onDidSashReset(()=>{var l;return(l=this.splitview)==null?void 0:l.distributeViewSizes()})),this.orientation===1?this.splitview.orthogonalEndSash=(a=this._boundarySashes)==null?void 0:a.bottom:(this.splitview.orthogonalStartSash=(c=this._boundarySashes)==null?void 0:c.left,this.splitview.orthogonalEndSash=(d=this._boundarySashes)==null?void 0:d.right);let i=FP.Distribute,n=FP.Distribute;if(t){const l=this.splitview.orientation===1?this.dimension.width:this.dimension.height;i=Math.round(l*t),n=l-i,this.splitview.layout(this.orientation===1?this.dimension.width:this.dimension.height)}const s=Mi(this.secondaryEditorContainer);this.splitview.addView({element:s,layout:l=>this.layoutPane(this.secondaryEditorPane,l),minimumSize:this.orientation===1?qp.width:qp.height,maximumSize:Number.POSITIVE_INFINITY,onDidChange:F.None},i);const o=Mi(this.primaryEditorContainer);this.splitview.addView({element:o,layout:l=>this.layoutPane(this.primaryEditorPane,l),minimumSize:this.orientation===1?qp.width:qp.height,maximumSize:Number.POSITIVE_INFINITY,onDidChange:F.None},n),this.updateStyles()}getTitle(){return this.input?this.input.getName():p("sideBySideEditor","Side by Side Editor")}async setInput(e,t,i,n){var d,l,u;const s=this.input;await super.setInput(e,t,i,n),(!s||!e.matches(s))&&(s&&this.disposeEditors(),this.createEditors(e));const{primary:o,secondary:a,viewState:c}=this.loadViewState(e,t,i);if(this.lastFocusedSide=c==null?void 0:c.focus,typeof(c==null?void 0:c.ratio)=="number"&&this.splitview){const h=this.splitview.orientation===1?this.dimension.width:this.dimension.height;this.splitview.resizeView(0,Math.round(h*c.ratio))}else(d=this.splitview)==null||d.distributeViewSizes();await Promise.all([(l=this.secondaryEditorPane)==null?void 0:l.setInput(e.secondary,a,i,n),(u=this.primaryEditorPane)==null?void 0:u.setInput(e.primary,o,i,n)]),typeof(t==null?void 0:t.target)=="number"&&(this.lastFocusedSide=t.target)}loadViewState(e,t,i){const n=Xye(t==null?void 0:t.viewState)?t==null?void 0:t.viewState:this.loadEditorViewState(e,i);let s=Object.create(null),o;return(t==null?void 0:t.target)===Ui.SECONDARY?o={...t}:s={...t},s.viewState=n==null?void 0:n.primary,n!=null&&n.secondary&&(o?o.viewState=n==null?void 0:n.secondary:o={viewState:n.secondary}),{primary:s,secondary:o,viewState:n}}createEditors(e){this.secondaryEditorPane=this.doCreateEditor(e.secondary,Mi(this.secondaryEditorContainer)),this.primaryEditorPane=this.doCreateEditor(e.primary,Mi(this.primaryEditorContainer)),this.layout(this.dimension),this._onDidChangeSizeConstraints.input=F.any(F.map(this.secondaryEditorPane.onDidChangeSizeConstraints,()=>{}),F.map(this.primaryEditorPane.onDidChangeSizeConstraints,()=>{})),this.onDidCreateEditors.fire(void 0),this.editorDisposables.add(this.primaryEditorPane.onDidFocus(()=>this.onDidFocusChange(Ui.PRIMARY))),this.editorDisposables.add(this.secondaryEditorPane.onDidFocus(()=>this.onDidFocusChange(Ui.SECONDARY)))}doCreateEditor(e,t){const i=st.as(au.EditorPane).getEditorPane(e);if(!i)throw new Error("No editor pane descriptor for editor found");const n=i.instantiate(this.instantiationService);return n.create(t),n.setVisible(this.isVisible(),this.group),Aj(n)&&this.editorDisposables.add(n.onDidChangeSelection(s=>this._onDidChangeSelection.fire(s))),this.editorDisposables.add(n),n}onDidFocusChange(e){this.lastFocusedSide=e,this._onDidChangeControl.fire()}getSelection(){const e=this.getLastFocusedEditorPane();if(Aj(e)){const t=e.getSelection();if(t)return new lW(t,e===this.primaryEditorPane?Ui.PRIMARY:Ui.SECONDARY)}}setOptions(e){var t;super.setOptions(e),typeof(e==null?void 0:e.target)=="number"&&(this.lastFocusedSide=e.target),(t=this.getLastFocusedEditorPane())==null||t.setOptions(e)}setEditorVisible(e,t){var i,n;(i=this.primaryEditorPane)==null||i.setVisible(e,t),(n=this.secondaryEditorPane)==null||n.setVisible(e,t),super.setEditorVisible(e,t)}clearInput(){var e,t;super.clearInput(),(e=this.primaryEditorPane)==null||e.clearInput(),(t=this.secondaryEditorPane)==null||t.clearInput(),this.disposeEditors()}focus(){var e;(e=this.getLastFocusedEditorPane())==null||e.focus()}getLastFocusedEditorPane(){return this.lastFocusedSide===Ui.SECONDARY?this.secondaryEditorPane:this.primaryEditorPane}layout(e){this.dimension=e,Mi(this.splitview).layout(this.orientation===1?e.width:e.height)}setBoundarySashes(e){this._boundarySashes=e,this.splitview&&(this.splitview.orthogonalEndSash=e.bottom)}layoutPane(e,t){e==null||e.layout(this.orientation===1?new Fl(t,this.dimension.height):new Fl(this.dimension.width,t))}getControl(){var e;return(e=this.getLastFocusedEditorPane())==null?void 0:e.getControl()}getPrimaryEditorPane(){return this.primaryEditorPane}getSecondaryEditorPane(){return this.secondaryEditorPane}tracksEditorViewState(e){return e instanceof ns}computeEditorViewState(e){var n,s;if(!this.input||!si(e,this.toEditorViewStateResource(this.input)))return;const t=(n=this.primaryEditorPane)==null?void 0:n.getViewState(),i=(s=this.secondaryEditorPane)==null?void 0:s.getViewState();if(!(!t||!i))return{primary:t,secondary:i,focus:this.lastFocusedSide,ratio:this.getSplitViewRatio()}}toEditorViewStateResource(e){let t,i;if(e instanceof ns&&(t=e.primary.resource,i=e.secondary.resource),!(!i||!t))return k.from({scheme:"sideBySide",path:`${t_(i.toString())}${t_(t.toString())}`})}updateStyles(){super.updateStyles(),this.primaryEditorContainer&&(this.orientation===1?(this.primaryEditorContainer.style.borderLeftWidth="1px",this.primaryEditorContainer.style.borderLeftStyle="solid",this.primaryEditorContainer.style.borderLeftColor=this.getColor(qge)??"",this.primaryEditorContainer.style.borderTopWidth="0"):(this.primaryEditorContainer.style.borderTopWidth="1px",this.primaryEditorContainer.style.borderTopStyle="solid",this.primaryEditorContainer.style.borderTopColor=this.getColor(Vge)??"",this.primaryEditorContainer.style.borderLeftWidth="0"))}dispose(){this.disposeEditors(),super.dispose()}disposeEditors(){this.editorDisposables.clear(),this.secondaryEditorPane=void 0,this.primaryEditorPane=void 0,this.lastFocusedSide=void 0,this.secondaryEditorContainer&&Rg(this.secondaryEditorContainer),this.primaryEditorContainer&&Rg(this.primaryEditorContainer)}};Ca.ID=uce;Ca.SIDE_BY_SIDE_LAYOUT_SETTING="workbench.editor.splitInGroupLayout";Ca.VIEW_STATE_PREFERENCE_KEY="sideBySideEditorViewState";Ca=T([v(0,gi),v(1,Te),v(2,Fi),v(3,ri),v(4,We),v(5,Do),v(6,Ke),v(7,it)],Ca);class lW{constructor(e,t){this.selection=e,this.side=t}compare(e){return!(e instanceof lW)||this.side!==e.side?3:this.selection.compare(e.selection)}restore(e){const t={...e,target:this.side};return this.selection.restore(t)}}const Jye="workbench.action.closeUnmodifiedEditors",Zye="workbench.action.closeEditorsInGroup",o6="workbench.action.closeEditorsAndGroup",e_e="workbench.action.closeEditorsToTheRight",a6="workbench.action.closeActiveEditor",t_e="workbench.action.closeActivePinnedEditor",i_e="workbench.action.closeGroup",n_e="workbench.action.closeOtherEditors",Ha="moveActiveEditor",Hd="copyActiveEditor",jd="layoutEditorGroups",r_e="workbench.action.keepEditor",s_e="workbench.action.toggleKeepEditors",o_e="workbench.action.toggleEditorGroupLock",a_e="workbench.action.lockEditorGroup",c_e="workbench.action.unlockEditorGroup",d_e="workbench.action.showEditorsInGroup",l_e="workbench.action.reopenWithEditor",u_e="workbench.action.pinEditor",c6="workbench.action.unpinEditor",v2="toggle.diff.renderSideBySide",h_e="workbench.action.compareEditor.nextChange",f_e="workbench.action.compareEditor.previousChange",d6="workbench.action.compareEditor.focusPrimarySide",l6="workbench.action.compareEditor.focusSecondarySide",u6="workbench.action.compareEditor.focusOtherSide",p_e="workbench.action.compareEditor.openSide",g_e="toggle.diff.ignoreTrimWhitespace",LO="workbench.action.splitEditorUp",FO="workbench.action.splitEditorDown",OO="workbench.action.splitEditorLeft",NO="workbench.action.splitEditorRight",m_e="workbench.action.splitEditorInGroup",v_e="workbench.action.toggleSplitEditorInGroup",y_e="workbench.action.joinEditorInGroup",__e="workbench.action.toggleSplitEditorInGroupLayout",w_e="workbench.action.focusFirstSideEditor",b_e="workbench.action.focusSecondSideEditor",S_e="workbench.action.focusOtherSideEditor",C_e="workbench.action.focusLeftGroupWithoutWrap",E_e="workbench.action.focusRightGroupWithoutWrap",x_e="workbench.action.focusAboveGroupWithoutWrap",D_e="workbench.action.focusBelowGroupWithoutWrap",y2="workbench.action.openEditorAtIndex",_2="_workbench.open",w2="_workbench.diff",k_e="_workbench.openWith",b2=function(r){return!(!bn(r)||!Rt(r.to)||!kP(r.by)&&!Rt(r.by)||!kP(r.value)&&!pr(r.value))};function T_e(){const r={type:"object",required:["to"],properties:{to:{type:"string",enum:["left","right"]},by:{type:"string",enum:["tab","group"]},value:{type:"number"}}};Xi.registerCommandAndKeybindingRule({id:Ha,weight:200,when:vo.editorTextFocus,primary:0,handler:(n,s)=>e(!0,s,n),description:{description:p("editorCommand.activeEditorMove.description","Move the active editor by tabs or groups"),args:[{name:p("editorCommand.activeEditorMove.arg.name","Active editor move argument"),description:p("editorCommand.activeEditorMove.arg.description",`Argument Properties:
	* 'to': String value providing where to move.
	* 'by': String value providing the unit for move (by tab or by group).
	* 'value': Number value providing how many positions or an absolute position to move.`),constraint:b2,schema:r}]}}),Xi.registerCommandAndKeybindingRule({id:Hd,weight:200,when:vo.editorTextFocus,primary:0,handler:(n,s)=>e(!1,s,n),description:{description:p("editorCommand.activeEditorCopy.description","Copy the active editor by groups"),args:[{name:p("editorCommand.activeEditorCopy.arg.name","Active editor copy argument"),description:p("editorCommand.activeEditorCopy.arg.description",`Argument Properties:
	* 'to': String value providing where to copy.
	* 'value': Number value providing how many positions or an absolute position to copy.`),constraint:b2,schema:r}]}});function e(n,s=Object.create(null),o){s.to=s.to||"right",s.by=s.by||"tab",s.value=typeof s.value=="number"?s.value:1;const a=o.get(Ke).activeEditorPane;if(a)switch(s.by){case"tab":if(n)return t(s,a);break;case"group":return i(n,s,a,o)}}function t(n,s){const o=s.group;let a=o.getIndexOfEditor(s.input);switch(n.to){case"first":a=0;break;case"last":a=o.count-1;break;case"left":a=a-n.value;break;case"right":a=a+n.value;break;case"center":a=Math.round(o.count/2)-1;break;case"position":a=n.value-1;break}a=a<0?0:a>=o.count?o.count-1:a,o.moveEditor(s.input,o,{index:a})}function i(n,s,o,a){const c=a.get(it),d=a.get(We),l=o.group;let u;switch(s.to){case"left":u=c.findGroup({direction:2},l),u||(u=c.addGroup(l,2));break;case"right":u=c.findGroup({direction:3},l),u||(u=c.addGroup(l,3));break;case"up":u=c.findGroup({direction:0},l),u||(u=c.addGroup(l,0));break;case"down":u=c.findGroup({direction:1},l),u||(u=c.addGroup(l,1));break;case"first":u=c.findGroup({location:0},l);break;case"last":u=c.findGroup({location:1},l);break;case"previous":u=c.findGroup({location:3},l);break;case"next":u=c.findGroup({location:2},l),u||(u=c.addGroup(l,Vf(d)));break;case"center":u=c.getGroups(2)[c.count/2-1];break;case"position":u=c.getGroups(2)[s.value-1];break}u&&(n?l.moveEditor(o.input,u):l.id!==u.id&&l.copyEditor(o.input,u),u.focus())}}function I_e(){function r(e,t){if(!t||typeof t!="object")return;e.get(it).applyLayout(t)}Gt.registerCommand(jd,(e,t)=>{r(e,t)}),Gt.registerCommand({id:"vscode.setEditorLayout",handler:(e,t)=>r(e,t),description:{description:"Set Editor Layout",args:[{name:"args",schema:{type:"object",required:["groups"],properties:{orientation:{type:"number",default:0,enum:[0,1]},groups:{$ref:"#/definitions/editorGroupsSchema",default:[{},{}]}}}}]}}),Gt.registerCommand({id:"vscode.getEditorLayout",handler:e=>e.get(it).getLayout(),description:{description:"Get Editor Layout",args:[],returns:"An editor layout object, in the same format as vscode.setEditorLayout"}})}function R_e(){Xi.registerCommandAndKeybindingRule({id:h_e,weight:200,when:LU,primary:575,handler:o=>e(o,!0)}),Xi.registerCommandAndKeybindingRule({id:f_e,weight:200,when:LU,primary:1599,handler:o=>e(o,!1)});function r(o){const a=o.get(Ke);for(const c of[a.activeEditorPane,...a.visibleEditorPanes])if(c instanceof Zl)return c}function e(o,a){var d;const c=r(o);c&&((d=c.getControl())==null||d.goToDiff(a?"next":"previous"))}let t;(function(o){o[o.Original=0]="Original",o[o.Modified=1]="Modified",o[o.Toggle=2]="Toggle"})(t||(t={}));function i(o,a){var d,l,u;const c=r(o);if(c)switch(a){case t.Original:(d=c.getControl())==null||d.getOriginalEditor().focus();break;case t.Modified:(l=c.getControl())==null||l.getModifiedEditor().focus();break;case t.Toggle:return(u=c.getControl())!=null&&u.getModifiedEditor().hasWidgetFocus()?i(o,t.Original):i(o,t.Modified)}}function n(o){const a=o.get(We),c=!a.getValue("diffEditor.renderSideBySide");a.updateValue("diffEditor.renderSideBySide",c)}function s(o){const a=o.get(We),c=!a.getValue("diffEditor.ignoreTrimWhitespace");a.updateValue("diffEditor.ignoreTrimWhitespace",c)}Xi.registerCommandAndKeybindingRule({id:v2,weight:200,when:void 0,primary:void 0,handler:o=>n(o)}),Xi.registerCommandAndKeybindingRule({id:d6,weight:200,when:void 0,primary:void 0,handler:o=>i(o,t.Modified)}),Xi.registerCommandAndKeybindingRule({id:l6,weight:200,when:void 0,primary:void 0,handler:o=>i(o,t.Original)}),Xi.registerCommandAndKeybindingRule({id:u6,weight:200,when:void 0,primary:void 0,handler:o=>i(o,t.Toggle)}),Un.appendMenuItem(Ee.CommandPalette,{command:{id:v2,title:{value:p("toggleInlineView","Toggle Inline View"),original:"Compare: Toggle Inline View"},category:p("compare","Compare")},when:Kl}),Xi.registerCommandAndKeybindingRule({id:g_e,weight:200,when:void 0,primary:void 0,handler:o=>s(o)})}function P_e(){function r(e,t,i){return e?[{...e.editorOptions,...t??Object.create(null)},e.sideBySide?Ed:i]:[t,i]}Gt.registerCommand({id:"vscode.open",handler:(e,t)=>{e.get(un).executeCommand(_2,t)},description:{description:"Opens the provided resource in the editor.",args:[{name:"Uri"}]}}),Gt.registerCommand(_2,async function(e,t,i,n,s){const o=e.get(Ke),a=e.get(it),c=e.get(us),d=e.get(ta),l=e.get(We),u=e.get(tv),h=typeof t=="string"?t:k.from(t,!0),[g,m]=i??[];if(m||typeof g=="number"||Xy(h,pe.untitled)){const[y,_]=r(s,m,g),b=k.isUri(h)?h:k.parse(h);let E;u.isUntitledWithAssociatedResource(b)?E={resource:b.with({scheme:d.defaultUriScheme}),forceUntitled:!0,options:y,label:n}:E={resource:b,options:y,label:n},await o.openEditor(E,qh(a,l,_))}else{if(Xy(h,pe.command))return;await c.open(h,{openToSide:s==null?void 0:s.sideBySide,editorOptions:s==null?void 0:s.editorOptions})}}),Gt.registerCommand({id:"vscode.diff",handler:(e,t,i,n)=>{e.get(un).executeCommand(w2,t,i,n)},description:{description:"Opens the provided resources in the diff editor to compare their contents.",args:[{name:"left",description:"Left-hand side resource of the diff editor"},{name:"right",description:"Right-hand side resource of the diff editor"},{name:"title",description:"Human readable title for the diff editor"}]}}),Gt.registerCommand(w2,async function(e,t,i,n,s,o){const a=e.get(Ke),c=e.get(it),d=e.get(We),[l,u]=s??[],[h,g]=r(o,u,l);let m,y;typeof n=="string"?m=n:n&&(m=n.label,y=n.description),await a.openEditor({original:{resource:k.from(t,!0)},modified:{resource:k.from(i,!0)},label:m,description:y,options:h},qh(c,d,g))}),Gt.registerCommand(k_e,(e,t,i,n)=>{const s=e.get(Ke),o=e.get(it),a=e.get(We),[c,d]=n??[];return s.openEditor({resource:k.from(t,!0),options:{...d,pinned:!0,override:i}},qh(o,a,c))})}function A_e(){const r=(t,i)=>{const n=t.get(Ke),s=n.activeEditorPane;if(s){const o=s.group.getEditorByIndex(i);o&&n.openEditor(o)}};Gt.registerCommand({id:y2,handler:r});for(let t=0;t<9;t++){const i=t,n=t+1;Xi.registerCommandAndKeybindingRule({id:y2+n,weight:200,when:void 0,primary:512|e(n),mac:{primary:256|e(n)},handler:s=>r(s,i)})}function e(t){switch(t){case 0:return 21;case 1:return 22;case 2:return 23;case 3:return 24;case 4:return 25;case 5:return 26;case 6:return 27;case 7:return 28;case 8:return 29;case 9:return 30}throw new Error("invalid index")}}function M_e(){for(let t=1;t<8;t++)Xi.registerCommandAndKeybindingRule({id:r(t),weight:200,when:void 0,primary:2048|e(t),handler:i=>{const n=i.get(it),s=i.get(We);if(t>n.count)return;const o=n.getGroups(2);if(o[t])return o[t].focus();const a=Vf(s),c=n.findGroup({location:1});if(!c)return;n.addGroup(c,a).focus()}});function r(t){switch(t){case 1:return"workbench.action.focusSecondEditorGroup";case 2:return"workbench.action.focusThirdEditorGroup";case 3:return"workbench.action.focusFourthEditorGroup";case 4:return"workbench.action.focusFifthEditorGroup";case 5:return"workbench.action.focusSixthEditorGroup";case 6:return"workbench.action.focusSeventhEditorGroup";case 7:return"workbench.action.focusEighthEditorGroup"}throw new Error("Invalid index")}function e(t){switch(t){case 1:return 23;case 2:return 24;case 3:return 25;case 4:return 26;case 5:return 27;case 6:return 28;case 7:return 29}throw new Error("Invalid index")}}function h6(r,e,t){let i;if(t&&typeof t.groupId=="number"?i=r.getGroup(t.groupId):i=r.activeGroup,!i)return;const n=r.addGroup(i,e);let s;t&&typeof t.editorIndex=="number"?s=i.getEditorByIndex(t.editorIndex):s=ii(i.activeEditor),s&&!s.hasCapability(8)&&i.copyEditor(s,n,{preserveFocus:t==null?void 0:t.preserveFocus}),n.focus()}function L_e(){[{id:LO,direction:0},{id:FO,direction:1},{id:OO,direction:2},{id:NO,direction:3}].forEach(({id:r,direction:e})=>{Gt.registerCommand(r,function(t,i,n){h6(t.get(it),e,Bs(i,n))})})}function F_e(){function r(e,t,i,n){var l;const s=e.get(it),o=e.get(Ke);let a=!0;if((t||i||n)&&(a=!1),a&&!i&&!n){const u=s.activeGroup,h=u.activeEditor;if(h&&u.isSticky(h)){const g=u.getEditors(0,{excludeSticky:!0})[0];if(g)return u.openEditor(g);const m=o.getEditors(0,{excludeSticky:!0})[0];if(m)return Promise.resolve((l=s.getGroup(m.groupId))==null?void 0:l.openEditor(m.editor))}}const{editors:c,groups:d}=lS(e,i,n);return Promise.all(d.map(async u=>{if(u){const h=fi(c.filter(g=>g.groupId===u.id).map(g=>typeof g.editorIndex=="number"?u.getEditorByIndex(g.editorIndex):u.activeEditor)).filter(g=>!a||!u.isSticky(g));await u.closeEditors(h,{preserveFocus:n==null?void 0:n.preserveFocus})}}))}Xi.registerCommandAndKeybindingRule({id:a6,weight:200,when:void 0,primary:2101,win:{primary:2110,secondary:[2101]},handler:(e,t,i)=>r(e,!1,t,i)}),Gt.registerCommand(t_e,(e,t,i)=>r(e,!0,t,i)),Xi.registerCommandAndKeybindingRule({id:Zye,weight:200,when:void 0,primary:Bt(2089,53),handler:(e,t,i)=>Promise.all(lS(e,t,i).groups.map(async n=>{if(n){await n.closeAllEditors({excludeSticky:!0});return}}))}),Xi.registerCommandAndKeybindingRule({id:i_e,weight:200,when:nt.and(Q$,eC),primary:2101,win:{primary:2110,secondary:[2101]},handler:(e,t,i)=>{const n=e.get(it),s=Bs(t,i);let o;s&&typeof s.groupId=="number"?o=n.getGroup(s.groupId):o=n.activeGroup,o&&n.removeGroup(o)}}),Xi.registerCommandAndKeybindingRule({id:Jye,weight:200,when:void 0,primary:Bt(2089,51),handler:(e,t,i)=>Promise.all(lS(e,t,i).groups.map(async n=>{n&&await n.closeEditors({savedOnly:!0,excludeSticky:!0},{preserveFocus:i==null?void 0:i.preserveFocus})}))}),Xi.registerCommandAndKeybindingRule({id:n_e,weight:200,when:void 0,primary:void 0,mac:{primary:2610},handler:(e,t,i)=>{const{editors:n,groups:s}=lS(e,t,i);return Promise.all(s.map(async o=>{if(o){const a=n.filter(d=>d.groupId===o.id).map(d=>typeof d.editorIndex=="number"?o.getEditorByIndex(d.editorIndex):o.activeEditor),c=o.getEditors(1,{excludeSticky:!0}).filter(d=>!a.includes(d));for(const d of a)d&&o.pinEditor(d);await o.closeEditors(c,{preserveFocus:i==null?void 0:i.preserveFocus})}}))}}),Xi.registerCommandAndKeybindingRule({id:e_e,weight:200,when:void 0,primary:void 0,handler:async(e,t,i)=>{const n=e.get(it),{group:s,editor:o}=fc(n,Bs(t,i));s&&o&&(s.activeEditor&&s.pinEditor(s.activeEditor),await s.closeEditors({direction:1,except:o,excludeSticky:!0},{preserveFocus:i==null?void 0:i.preserveFocus}))}}),Xi.registerCommandAndKeybindingRule({id:l_e,weight:200,when:void 0,primary:void 0,handler:async(e,t,i)=>{var h,g,m;const n=e.get(it),s=e.get(Ke),o=e.get(lb),a=e.get(gi),{group:c,editor:d}=fc(n,Bs(t,i));if(!d)return;const l=d.toUntyped();if(!l)return;l.options={...(h=s.activeEditorPane)==null?void 0:h.options,override:uG.PICK};const u=await o.resolveEditor(l,c);_ce(u)&&(await u.group.replaceEditors([{editor:d,replacement:u.editor,forceReplaceDirty:((g=d.resource)==null?void 0:g.scheme)===pe.untitled,options:u.options}]),a.publicLog2("workbenchEditorReopen",{scheme:((m=d.resource)==null?void 0:m.scheme)??"",ext:d.resource?Xw(d.resource):"",from:d.editorId??"",to:u.editor.editorId??""}),await u.group.openEditor(u.editor))}}),Gt.registerCommand(o6,async(e,t,i)=>{const n=e.get(it),{group:s}=fc(n,Bs(t,i));s&&(await s.closeAllEditors(),s.count===0&&n.getGroup(s.id)&&n.removeGroup(s))})}function O_e(){const r=[{id:C_e,direction:2},{id:E_e,direction:3},{id:x_e,direction:0},{id:D_e,direction:1}];for(const e of r)Gt.registerCommand(e.id,async t=>{const i=t.get(it),n=i.findGroup({direction:e.direction},i.activeGroup,!1);n==null||n.focus()})}function N_e(){async function r(t,i,n){const s=t.get(it),o=t.get(Te),{group:a,editor:c}=fc(s,Bs(i,n));c&&await a.replaceEditors([{editor:c,replacement:o.createInstance(ns,void 0,void 0,c,c),forceReplaceDirty:!0}])}Nt(class extends Le{constructor(){super({id:m_e,title:{value:p("splitEditorInGroup","Split Editor in Group"),original:"Split Editor in Group"},category:ye.View,precondition:nP,f1:!0,keybinding:{weight:200,when:nP,primary:Bt(2089,3165)}})}run(t,i,n){return r(t,i,n)}});async function e(t,i,n){const s=t.get(it),{group:o,editor:a}=fc(s,Bs(i,n));if(!(a instanceof ns))return;let c;const d=o.activeEditorPane;if(d instanceof Ca&&o.activeEditor===a){for(const l of[d.getPrimaryEditorPane(),d.getSecondaryEditorPane()])if(l!=null&&l.hasFocus()){c={viewState:l.getViewState()};break}}await o.replaceEditors([{editor:a,replacement:a.primary,options:c}])}Nt(class extends Le{constructor(){super({id:y_e,title:{value:p("joinEditorInGroup","Join Editor in Group"),original:"Join Editor in Group"},category:ye.View,precondition:ph,f1:!0,keybinding:{weight:200,when:ph,primary:Bt(2089,3165)}})}run(t,i,n){return e(t,i,n)}}),Nt(class extends Le{constructor(){super({id:v_e,title:{value:p("toggleJoinEditorInGroup","Toggle Split Editor in Group"),original:"Toggle Split Editor in Group"},category:ye.View,precondition:nt.or(nP,ph),f1:!0})}async run(t,i,n){const s=t.get(it),{editor:o}=fc(s,Bs(i,n));o instanceof ns?await e(t,i,n):o&&await r(t,i,n)}}),Nt(class extends Le{constructor(){super({id:__e,title:{value:p("toggleSplitEditorInGroupLayout","Toggle Layout of Split Editor in Group"),original:"Toggle Layout of Split Editor in Group"},category:ye.View,precondition:ph,f1:!0})}async run(t){const i=t.get(We),n=i.getValue(Ca.SIDE_BY_SIDE_LAYOUT_SETTING);let s;return n!=="horizontal"?s="horizontal":s="vertical",i.updateValue(Ca.SIDE_BY_SIDE_LAYOUT_SETTING,s)}})}function $_e(){Nt(class extends Le{constructor(){super({id:w_e,title:{value:p("focusLeftSideEditor","Focus First Side in Active Editor"),original:"Focus First Side in Active Editor"},category:ye.View,precondition:nt.or(ph,Kl),f1:!0})}async run(r){var n;const e=r.get(Ke),t=r.get(un),i=e.activeEditorPane;i instanceof Ca?(n=i.getSecondaryEditorPane())==null||n.focus():i instanceof Zl&&await t.executeCommand(l6)}}),Nt(class extends Le{constructor(){super({id:b_e,title:{value:p("focusRightSideEditor","Focus Second Side in Active Editor"),original:"Focus Second Side in Active Editor"},category:ye.View,precondition:nt.or(ph,Kl),f1:!0})}async run(r){var n;const e=r.get(Ke),t=r.get(un),i=e.activeEditorPane;i instanceof Ca?(n=i.getPrimaryEditorPane())==null||n.focus():i instanceof Zl&&await t.executeCommand(d6)}}),Nt(class extends Le{constructor(){super({id:S_e,title:{value:p("focusOtherSideEditor","Focus Other Side in Active Editor"),original:"Focus Other Side in Active Editor"},category:ye.View,precondition:nt.or(ph,Kl),f1:!0})}async run(r){var n,s,o;const e=r.get(Ke),t=r.get(un),i=e.activeEditorPane;i instanceof Ca?(n=i.getPrimaryEditorPane())!=null&&n.hasFocus()?(s=i.getSecondaryEditorPane())==null||s.focus():(o=i.getPrimaryEditorPane())==null||o.focus():i instanceof Zl&&await t.executeCommand(u6)}})}function W_e(){Xi.registerCommandAndKeybindingRule({id:r_e,weight:200,when:void 0,primary:Bt(2089,3),handler:async(e,t,i)=>{const n=e.get(it),{group:s,editor:o}=fc(n,Bs(t,i));if(s&&o)return s.pinEditor(o)}}),Gt.registerCommand({id:s_e,handler:e=>{const t=e.get(We),n=t.getValue("workbench.editor.enablePreview")!==!0;t.updateValue("workbench.editor.enablePreview",n)}});function r(e,t,i,n){const s=e.get(it),{group:o}=fc(s,Bs(t,i));o==null||o.lock(n??!o.isLocked)}Nt(class extends Le{constructor(){super({id:o_e,title:{value:p("toggleEditorGroupLock","Toggle Editor Group Lock"),original:"Toggle Editor Group Lock"},category:ye.View,precondition:eC,f1:!0})}async run(e,t,i){r(e,t,i)}}),Nt(class extends Le{constructor(){super({id:a_e,title:{value:p("lockEditorGroup","Lock Editor Group"),original:"Lock Editor Group"},category:ye.View,precondition:nt.and(eC,FU.toNegated()),f1:!0})}async run(e,t,i){r(e,t,i,!0)}}),Nt(class extends Le{constructor(){super({id:c_e,title:{value:p("unlockEditorGroup","Unlock Editor Group"),original:"Unlock Editor Group"},precondition:nt.and(eC,FU),category:ye.View,f1:!0})}async run(e,t,i){r(e,t,i,!1)}}),Xi.registerCommandAndKeybindingRule({id:u_e,weight:200,when:MU.toNegated(),primary:Bt(2089,1027),handler:async(e,t,i)=>{const n=e.get(it),{group:s,editor:o}=fc(n,Bs(t,i));if(s&&o)return s.stickEditor(o)}}),Xi.registerCommandAndKeybindingRule({id:p_e,weight:200,when:vo.inDiffEditor,primary:Bt(2089,1069),handler:async e=>{const t=e.get(Ke),i=e.get(it),n=t.activeEditor,s=t.activeTextEditorControl;if(!s1(s)||!(n instanceof Ss))return;let o;return s.getOriginalEditor().hasTextFocus()?o=n.original:o=n.modified,i.activeGroup.openEditor(o)}}),Xi.registerCommandAndKeybindingRule({id:c6,weight:200,when:MU,primary:Bt(2089,1027),handler:async(e,t,i)=>{const n=e.get(it),{group:s,editor:o}=fc(n,Bs(t,i));if(s&&o)return s.unstickEditor(o)}}),Xi.registerCommandAndKeybindingRule({id:d_e,weight:200,when:void 0,primary:void 0,handler:(e,t,i)=>{const n=e.get(it),s=e.get(ss),o=Bs(t,i);if(o&&typeof o.groupId=="number"){const a=n.getGroup(o.groupId);a&&n.activateGroup(a)}return s.quickAccess.show(kf.PREFIX)}})}function lS(r,e,t){const i=r.get(it),n=r.get(_G),s=H_e(Bs(e,t),n,i),o=i.activeGroup;return s.length===0&&o.activeEditor&&s.push({groupId:o.id,editorIndex:o.getIndexOfEditor(o.activeEditor)}),{editors:s,groups:Mf(s.map(a=>a.groupId)).map(a=>i.getGroup(a))}}function Bs(r,e){if(k.isUri(r))return e;if(r&&typeof r.groupId=="number")return r;if(e&&typeof e.groupId=="number")return e}function fc(r,e){let t=e&&typeof e.groupId=="number"?r.getGroup(e.groupId):void 0,i=t&&e&&typeof e.editorIndex=="number"?ii(t.getEditorByIndex(e.editorIndex)):void 0;return t||(t=r.activeGroup),i||(i=ii(t.activeEditor)),{group:t,editor:i}}function H_e(r,e,t){const i=e.lastFocusedList;if(i instanceof dk&&i.getHTMLElement()===document.activeElement){const n=c=>{if(ES(c))return{groupId:c.id,editorIndex:void 0};const d=t.getGroup(c.groupId);return{groupId:c.groupId,editorIndex:d?d.getIndexOfEditor(c.editor):-1}},s=c=>ES(c)||DM(c),o=i.getFocusedElements().filter(s),a=r||(o.length?o.map(n)[0]:void 0);if(a){const c=i.getSelectedElements().filter(s);return c!=null&&c.some(d=>{if(ES(d))return d.id===a.groupId;const l=t.getGroup(d.groupId);return d.groupId===a.groupId&&(l?l.getIndexOfEditor(d.editor):-1)===a.editorIndex})?c.map(n):[a]}}return r?[r]:[]}function x$e(){T_e(),I_e(),R_e(),P_e(),A_e(),F_e(),W_e(),N_e(),$_e(),M_e(),L_e(),O_e()}let kw=class $O{constructor(e,t,i,n,s){this.progressService=e,this.dialogService=t,this.explorerService=i,this.editorService=n,this.fileService=s}upload(e,t){const i=new Xt,n=this.progressService.withProgress({location:10,delay:800,cancellable:!0,title:p("uploadingFiles","Uploading")},async s=>this.doUpload(e,this.toTransfer(t),s,i.token),()=>i.dispose(!0));return this.progressService.withProgress({location:Qs,delay:500},()=>n),n}toTransfer(e){if(e instanceof DragEvent)return e.dataTransfer;const t={items:[]};for(const i of e)t.items.push({webkitGetAsEntry:()=>({name:i.name,isDirectory:!1,isFile:!0,createReader:()=>{throw new Error("Unsupported for files")},file:n=>n(i)})});return t}async doUpload(e,t,i,n){const s=t.items,o=[];for(const u of s)o.push(u.webkitGetAsEntry());const a=[],c={startTime:Date.now(),progressScheduler:new DG(u=>{i.report(u[u.length-1])},1e3),filesTotal:o.length,filesUploaded:0,totalBytesUploaded:0},d=new HH($O.MAX_PARALLEL_UPLOADS);await Sn.settled(o.map(u=>d.queue(async()=>{var g;if(n.isCancellationRequested)return;if(e&&u.name&&e.getChild(u.name)){const{confirmed:m}=await this.dialogService.confirm(uW(u.name));if(!m||(await this.explorerService.applyBulkEdit([new zo(pt(e.resource,u.name),void 0,{recursive:!0,folder:(g=e.getChild(u.name))==null?void 0:g.isDirectory})],{undoLabel:p("overwrite","Overwrite {0}",u.name),progressLabel:p("overwriting","Overwriting {0}",u.name)}),n.isCancellationRequested))return}const h=await this.doUploadEntry(u,e.resource,e,i,c,n);h&&a.push(h)}))),c.progressScheduler.dispose();const l=a[0];!n.isCancellationRequested&&(l!=null&&l.isFile)&&await this.editorService.openEditor({resource:l.resource,options:{pinned:!0}})}async doUploadEntry(e,t,i,n,s,o){if(o.isCancellationRequested||!e.name||!e.isFile&&!e.isDirectory)return;let a=0;const c=(l,u)=>{a+=u,s.totalBytesUploaded+=u;const h=s.totalBytesUploaded/((Date.now()-s.startTime)/1e3);let g;l<_s.MB?s.filesTotal===1?g=`${e.name}`:g=p("uploadProgressSmallMany","{0} of {1} files ({2}/s)",s.filesUploaded,s.filesTotal,_s.formatSize(h)):g=p("uploadProgressLarge","{0} ({1} of {2}, {3}/s)",e.name,_s.formatSize(a),_s.formatSize(l),_s.formatSize(h)),s.progressScheduler.work({message:g})};s.filesUploaded++,c(0,0);const d=pt(t,e.name);if(e.isFile){const l=await new Promise((u,h)=>e.file(u,h));return o.isCancellationRequested?void 0:(typeof l.stream=="function"&&l.size>_s.MB?await this.doUploadFileBuffered(d,l,c,o):await this.doUploadFileUnbuffered(d,l,c),{isFile:!0,resource:d})}else{if(await this.fileService.createFolder(d),o.isCancellationRequested)return;const l=e.createReader(),u=[];let h=!1;do{const b=await new Promise((E,D)=>l.readEntries(E,D));b.length>0?u.push(...b):h=!0}while(!h&&!o.isCancellationRequested);s.filesTotal+=u.length;const g=i&&i.getChild(e.name)||void 0,m=[],y=[];for(const b of u)b.isFile?m.push(b):b.isDirectory&&y.push(b);const _=new HH($O.MAX_PARALLEL_UPLOADS);await Sn.settled(m.map(b=>_.queue(()=>this.doUploadEntry(b,d,g,n,s,o))));for(const b of y)await this.doUploadEntry(b,d,g,n,s,o);return{isFile:!1,resource:d}}}async doUploadFileBuffered(e,t,i,n){const s=xG({highWaterMark:10}),o=this.fileService.writeFile(e,s);try{const a=t.stream().getReader();let c=await a.read();for(;!c.done&&!n.isCancellationRequested;){const d=De.wrap(c.value);if(await s.write(d),n.isCancellationRequested)break;i(t.size,d.byteLength),c=await a.read()}s.end(void 0)}catch(a){s.error(a),s.end()}n.isCancellationRequested||await o}doUploadFileUnbuffered(e,t,i){return new Promise((n,s)=>{const o=new FileReader;o.onload=async a=>{var c;try{if(((c=a.target)==null?void 0:c.result)instanceof ArrayBuffer){const d=De.wrap(new Uint8Array(a.target.result));await this.fileService.writeFile(e,d),i(t.size,d.byteLength)}else throw new Error("Could not read from dropped file.");n()}catch(d){s(d)}},o.readAsArrayBuffer(t)})}};kw.MAX_PARALLEL_UPLOADS=20;kw=T([v(0,kc),v(1,ar),v(2,mn),v(3,Ke),v(4,at)],kw);let WO=class{constructor(e,t,i,n,s,o,a,c,d,l,u){this.fileService=e,this.hostService=t,this.contextService=i,this.configurationService=n,this.dialogService=s,this.workspaceEditingService=o,this.explorerService=a,this.editorService=c,this.progressService=d,this.notificationService=l,this.instantiationService=u}async import(e,t){const i=new Xt,n=this.progressService.withProgress({location:10,delay:800,cancellable:!0,title:p("copyingFiles","Copying...")},async()=>await this.doImport(e,t,i.token),()=>i.dispose(!0));return this.progressService.withProgress({location:Qs,delay:500},()=>n),n}async doImport(e,t,i){const n=fi((await this.instantiationService.invokeFunction(c=>oG(c,t))).map(c=>c.resource));await Promise.all(n.map(c=>this.fileService.activateProvider(c.scheme)));const s=fi(n.filter(c=>this.fileService.hasProvider(c))),o=await this.fileService.resolveAll(s.map(c=>({resource:c})));if(i.isCancellationRequested)return;this.hostService.focus();const a=o.filter(c=>{var d;return c.success&&((d=c.stat)==null?void 0:d.isDirectory)}).map(c=>({uri:c.stat.resource}));if(a.length>0&&e.isRoot){let c;(function(g){g[g.Copy=1]="Copy",g[g.Add=2]="Add"})(c||(c={}));const d=[{label:a.length>1?p("copyFolders","&&Copy Folders"):p("copyFolder","&&Copy Folder"),run:()=>c.Copy}];let l;const u=this.contextService.getWorkspace().folders.map(g=>g.uri.scheme);a.some(g=>u.indexOf(g.uri.scheme)>=0)?(d.unshift({label:a.length>1?p("addFolders","&&Add Folders to Workspace"):p("addFolder","&&Add Folder to Workspace"),run:()=>c.Add}),l=a.length>1?p("dropFolders","Do you want to copy the folders or add the folders to the workspace?"):p("dropFolder","Do you want to copy '{0}' or add '{0}' as a folder to the workspace?",Mt(a[0].uri))):l=a.length>1?p("copyfolders","Are you sure to want to copy folders?"):p("copyfolder","Are you sure to want to copy '{0}'?",Mt(a[0].uri));const{result:h}=await this.dialogService.prompt({type:wn.Info,message:l,buttons:d,cancelButton:!0});if(h===c.Add)return this.workspaceEditingService.addFolders(a);if(h===c.Copy)return this.importResources(e,s,i)}else if(e instanceof hn)return this.importResources(e,s,i)}async importResources(e,t,i){if(t&&t.length>0){const n=await this.fileService.resolve(e.resource);if(i.isCancellationRequested)return;const s=new Set,o=this.fileService.hasCapability(e.resource,1024);n.children&&n.children.forEach(u=>{s.add(o?u.name:u.name.toLowerCase())});let a=0;const c=fi(await Sn.settled(t.map(async u=>{if(!await this.fileService.exists(u)){a++;return}if(!(s.has(o?Mt(u):Mt(u).toLowerCase())&&!(await this.dialogService.confirm(uW(Mt(u)))).confirmed))return u})));a>0&&this.notificationService.error(a>1?p("filesInaccessible","Some or all of the dropped files could not be accessed for import."):p("fileInaccessible","The dropped file could not be accessed for import."));const d=c.map(u=>{const h=Mt(u),g=pt(e.resource,h);return new zo(u,g,{overwrite:!0,copy:!0})}),l=this.configurationService.getValue().explorer.confirmUndo;if(await this.explorerService.applyBulkEdit(d,{undoLabel:c.length===1?p({comment:["substitution will be the name of the file that was imported"],key:"importFile"},"Import {0}",Mt(c[0])):p({comment:["substitution will be the number of files that were imported"],key:"importnFile"},"Import {0} resources",c.length),progressLabel:c.length===1?p({comment:["substitution will be the name of the file that was copied"],key:"copyingFile"},"Copying {0}",Mt(c[0])):p({comment:["substitution will be the number of files that were copied"],key:"copyingnFile"},"Copying {0} resources",c.length),progressLocation:10,confirmBeforeUndo:l==="verbose"||l==="default"}),d.length===1){const u=this.explorerService.findClosest(d[0].newResource);u&&!u.isDirectory&&this.editorService.openEditor({resource:u.resource,options:{pinned:!0}})}}}};WO=T([v(0,at),v(1,bu),v(2,oi),v(3,We),v(4,ar),v(5,Zm),v(6,mn),v(7,Ke),v(8,kc),v(9,on),v(10,Te)],WO);let kD=class HO{constructor(e,t,i,n,s,o){this.fileService=e,this.explorerService=t,this.progressService=i,this.logService=n,this.fileDialogService=s,this.storageService=o}download(e){const t=new Xt,i=this.progressService.withProgress({location:10,delay:800,cancellable:ln,title:p("downloadingFiles","Downloading")},async n=>this.doDownload(e,n,t),()=>t.dispose(!0));return this.progressService.withProgress({location:Qs,delay:500},()=>i),i}async doDownload(e,t,i){for(const n of e){if(i.token.isCancellationRequested)return;ln?await this.doDownloadBrowser(n.resource,t,i):await this.doDownloadNative(n,t,i)}}async doDownloadBrowser(e,t,i){const n=await this.fileService.resolve(e,{resolveMetadata:!0});if(i.token.isCancellationRequested)return;const s=32*_s.MB;if((n.isDirectory||n.size>s)&&kG.supported(window))try{const a=await window.showDirectoryPicker(),c={startTime:Date.now(),progressScheduler:new DG(d=>{t.report(d[d.length-1])},1e3),filesTotal:n.isDirectory?0:1,filesDownloaded:0,totalBytesDownloaded:0,fileBytesDownloaded:0};if(n.isDirectory){const d=await a.getDirectoryHandle(n.name,{create:!0});await this.downloadFolderBrowser(n,d,c,i.token)}else await this.downloadFileBrowser(a,n,c,i.token);c.progressScheduler.dispose()}catch(a){this.logService.warn(a),i.cancel()}else if(n.isFile){let a;try{a=(await this.fileService.readFile(n.resource,{limits:{size:s}},i.token)).value.buffer}catch{a=wh.uriToBrowserUri(n.resource)}i.token.isCancellationRequested||NX(a,n.name)}}async downloadFileBufferedBrowser(e,t,i,n){const s=await this.fileService.readFileStream(e,void 0,n);if(n.isCancellationRequested){t.close();return}return new Promise((o,a)=>{const c=s.value,d=new me;d.add(ot(()=>t.close())),d.add(eb(n.onCancellationRequested)(()=>{d.dispose(),a(Ll())})),d.add(VN(c,{onData:l=>{t.write(l.buffer),this.reportProgress(s.name,s.size,l.byteLength,i)},onError:l=>{d.dispose(),a(l)},onEnd:()=>{d.dispose(),o()}}))})}async downloadFileUnbufferedBrowser(e,t,i,n){const s=await this.fileService.readFile(e,void 0,n);n.isCancellationRequested||(t.write(s.value.buffer),this.reportProgress(s.name,s.size,s.value.byteLength,i)),t.close()}async downloadFileBrowser(e,t,i,n){i.filesDownloaded++,i.fileBytesDownloaded=0,this.reportProgress(t.name,0,0,i);const o=await(await e.getFileHandle(t.name,{create:!0})).createWritable();return t.size>_s.MB?this.downloadFileBufferedBrowser(t.resource,o,i,n):this.downloadFileUnbufferedBrowser(t.resource,o,i,n)}async downloadFolderBrowser(e,t,i,n){if(e.children){i.filesTotal+=e.children.map(s=>s.isFile).length;for(const s of e.children){if(n.isCancellationRequested)return;if(s.isFile)await this.downloadFileBrowser(t,s,i,n);else{const o=await t.getDirectoryHandle(s.name,{create:!0}),a=await this.fileService.resolve(s.resource,{resolveMetadata:!0});await this.downloadFolderBrowser(a,o,i,n)}}}}reportProgress(e,t,i,n){n.fileBytesDownloaded+=i,n.totalBytesDownloaded+=i;const s=n.totalBytesDownloaded/((Date.now()-n.startTime)/1e3);let o;t<_s.MB?n.filesTotal===1?o=e:o=p("downloadProgressSmallMany","{0} of {1} files ({2}/s)",n.filesDownloaded,n.filesTotal,_s.formatSize(s)):o=p("downloadProgressLarge","{0} ({1} of {2}, {3}/s)",e,_s.formatSize(n.fileBytesDownloaded),_s.formatSize(t),_s.formatSize(s)),n.progressScheduler.work({message:o})}async doDownloadNative(e,t,i){t.report({message:e.name});let n;const s=this.storageService.get(HO.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY,-1);s?n=pt(k.file(s),e.name):n=pt(e.isDirectory?await this.fileDialogService.defaultFolderPath(pe.file):await this.fileDialogService.defaultFilePath(pe.file),e.name);const o=await this.fileDialogService.showSaveDialog({availableFileSystems:[pe.file],saveLabel:$X(p("downloadButton","Download")),title:p("chooseWhereToDownload","Choose Where to Download"),defaultUri:n});o?(this.storageService.store(HO.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY,pn(o).fsPath,-1,1),await this.explorerService.applyBulkEdit([new zo(e.resource,o,{overwrite:!0,copy:!0})],{undoLabel:p("downloadBulkEdit","Download {0}",e.name),progressLabel:p("downloadingBulkEdit","Downloading {0}",e.name),progressLocation:10})):i.cancel()}};kD.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY="workbench.explorer.downloadPath";kD=T([v(0,at),v(1,mn),v(2,kc),v(3,ze),v(4,ia),v(5,ri)],kD);function uW(r){return{message:p("confirmOverwrite","A file or folder with the name '{0}' already exists in the destination folder. Do you want to replace it?",r),detail:p("irreversible","This action is irreversible!"),primaryButton:p({key:"replaceButtonLabel",comment:["&& denotes a mnemonic"]},"&&Replace"),type:"warning"}}function j_e(r){return r.length>1?{message:p("confirmManyOverwrites","The following {0} files and/or folders already exist in the destination folder. Do you want to replace them?",r.length),detail:ql(r)+`
`+p("irreversible","This action is irreversible!"),primaryButton:p({key:"replaceButtonLabel",comment:["&& denotes a mnemonic"]},"&&Replace"),type:"warning"}:uW(Mt(r[0]))}const hW="explorer.newFile",k$e=p("newFile","New File..."),f6="explorer.newFolder",T$e=p("newFolder","New Folder..."),I$e=p("rename","Rename..."),R$e=p("delete","Delete"),P$e=p("copyFile","Copy"),A$e=p("pasteFile","Paste"),B_e=new G("fileCopied",!1),U_e="explorer.download",M$e=p("download","Download..."),V_e="explorer.upload",L$e=p("upload","Upload..."),S2="explorer.confirmDelete",q_e=5e6;function p6(r,e){e.message==="string"&&(e=e.message),r.error(La(e,!1))}async function g6(r,e){r&&(r.indexOf("/")>=0||r.indexOf("\\")>=0)&&await e.refresh()}async function fW(r,e,t,i,n,s,o=!1,a=!1){let c;s?c=wa?p("deleteButtonLabelRecycleBin","&&Move to Recycle Bin"):p({key:"deleteButtonLabelTrash",comment:["&& denotes a mnemonic"]},"&&Move to Trash"):c=p({key:"deleteButtonLabel",comment:["&& denotes a mnemonic"]},"&&Delete");const d=h1(n,m=>m.resource),l=new Set;for(const m of d)for(const y of e.getDirty(m.resource))l.add(y);let u=!0;if(l.size){let m;d.length>1?m=p("dirtyMessageFilesDelete","You are deleting files with unsaved changes. Do you want to continue?"):d[0].isDirectory?l.size===1?m=p("dirtyMessageFolderOneDelete","You are deleting a folder {0} with unsaved changes in 1 file. Do you want to continue?",d[0].name):m=p("dirtyMessageFolderDelete","You are deleting a folder {0} with unsaved changes in {1} files. Do you want to continue?",d[0].name,l.size):m=p("dirtyMessageFileDelete","You are deleting {0} with unsaved changes. Do you want to continue?",d[0].name),(await t.confirm({type:"warning",message:m,detail:p("dirtyWarning","Your changes will be lost if you don't save them."),primaryButton:c})).confirmed?o=!0:u=!1}if(!u)return;let h;const g=d.some(m=>m.isDirectory)?p("irreversible","This action is irreversible!"):d.length>1?p("restorePlural","You can restore these files using the Undo command"):p("restore","You can restore this file using the Undo command");if(o||s&&i.getValue(S2)===!1)h={confirmed:!0};else if(s){let{message:m,detail:y}=G_e(d);y+=y?`
`:"",wa?y+=d.length>1?p("undoBinFiles","You can restore these files from the Recycle Bin."):p("undoBin","You can restore this file from the Recycle Bin."):y+=d.length>1?p("undoTrashFiles","You can restore these files from the Trash."):p("undoTrash","You can restore this file from the Trash."),h=await t.confirm({message:m,detail:y,primaryButton:c,checkbox:{label:p("doNotAskAgain","Do not ask me again")}})}else{let{message:m,detail:y}=z_e(d);y+=y?`
`:"",y+=g,h=await t.confirm({type:"warning",message:m,detail:y,primaryButton:c})}if(h.confirmed&&h.checkboxChecked===!0&&await i.updateValue(S2,!1),!!h.confirmed)try{const m=d.map(_=>new zo(_.resource,void 0,{recursive:!0,folder:_.isDirectory,ignoreIfNotExists:a,skipTrashBin:!s,maxSize:q_e})),y={undoLabel:d.length>1?p({key:"deleteBulkEdit",comment:["Placeholder will be replaced by the number of files deleted"]},"Delete {0} files",d.length):p({key:"deleteFileBulkEdit",comment:["Placeholder will be replaced by the name of the file deleted"]},"Delete {0}",d[0].name),progressLabel:d.length>1?p({key:"deletingBulkEdit",comment:["Placeholder will be replaced by the number of files deleted"]},"Deleting {0} files",d.length):p({key:"deletingFileBulkEdit",comment:["Placeholder will be replaced by the name of the file deleted"]},"Deleting {0}",d[0].name)};await r.applyBulkEdit(m,y)}catch(m){let y,_,b;if(s?(y=wa?p("binFailed","Failed to delete using the Recycle Bin. Do you want to permanently delete instead?"):p("trashFailed","Failed to delete using the Trash. Do you want to permanently delete instead?"),_=g,b=p({key:"deletePermanentlyButtonLabel",comment:["&& denotes a mnemonic"]},"&&Delete Permanently")):(y=La(m,!1),b=p({key:"retryButtonLabel",comment:["&& denotes a mnemonic"]},"&&Retry")),(await t.confirm({type:"warning",message:y,detail:_,primaryButton:b})).confirmed)return s&&(s=!1),o=!0,a=!0,fW(r,e,t,i,n,s,o,a)}}function G_e(r){return m6(r)?{message:p("confirmMoveTrashMessageFilesAndDirectories","Are you sure you want to delete the following {0} files/directories and their contents?",r.length),detail:ql(r.map(e=>e.resource))}:r.length>1?r[0].isDirectory?{message:p("confirmMoveTrashMessageMultipleDirectories","Are you sure you want to delete the following {0} directories and their contents?",r.length),detail:ql(r.map(e=>e.resource))}:{message:p("confirmMoveTrashMessageMultiple","Are you sure you want to delete the following {0} files?",r.length),detail:ql(r.map(e=>e.resource))}:r[0].isDirectory&&!r[0].isSymbolicLink?{message:p("confirmMoveTrashMessageFolder","Are you sure you want to delete '{0}' and its contents?",r[0].name),detail:""}:{message:p("confirmMoveTrashMessageFile","Are you sure you want to delete '{0}'?",r[0].name),detail:""}}function z_e(r){return m6(r)?{message:p("confirmDeleteMessageFilesAndDirectories","Are you sure you want to permanently delete the following {0} files/directories and their contents?",r.length),detail:ql(r.map(e=>e.resource))}:r.length>1?r[0].isDirectory?{message:p("confirmDeleteMessageMultipleDirectories","Are you sure you want to permanently delete the following {0} directories and their contents?",r.length),detail:ql(r.map(e=>e.resource))}:{message:p("confirmDeleteMessageMultiple","Are you sure you want to permanently delete the following {0} files?",r.length),detail:ql(r.map(e=>e.resource))}:r[0].isDirectory?{message:p("confirmDeleteMessageFolder","Are you sure you want to permanently delete '{0}' and its contents?",r[0].name),detail:""}:{message:p("confirmDeleteMessageFile","Are you sure you want to permanently delete '{0}'?",r[0].name),detail:""}}function m6(r){const e=r.find(i=>i.isDirectory),t=r.find(i=>!i.isDirectory);return!!e&&!!t}async function v6(r,e,t,i,n,s){let o=Xc(n.resource),a=pt(i.resource,o);if(!(s==="disabled"&&!await Q_e(e,t,a))){for(;!n.allowOverwrite&&r.findClosest(a);)s!=="disabled"&&(o=K_e(o,!!n.isDirectory,s)),a=pt(i.resource,o);return a}}function K_e(r,e,t){if(t==="simple"){let u=r,h="";e||(h=kg(r),u=Yn(r,h));const g=/^(.+ copy)( \d+)?$/;return g.test(u)?u.replace(g,(m,y,_)=>{const b=_?parseInt(_):1;return b===0?`${y}`:b<1073741824?`${y} ${b+1}`:`${y}${_} copy`})+h:`${u} copy${h}`}const i="[\\.\\-_]",n=1073741824,s=RegExp("(.*"+i+")(\\d+)(\\..*)$");if(!e&&r.match(s))return r.replace(s,(u,h,g,m)=>{const y=parseInt(g);return y<n?h+String(y+1).padStart(g.length,"0")+m:`${h}${g}.1${m}`});const o=RegExp("(\\d+)("+i+".*)(\\..*)$");if(!e&&r.match(o))return r.replace(o,(u,h,g,m)=>{const y=parseInt(h);return y<n?String(y+1).padStart(h.length,"0")+g+m:`${h}${g}.1${m}`});const a=RegExp("(\\d+)(\\..*)$");if(!e&&r.match(a))return r.replace(a,(u,h,g)=>{const m=parseInt(h);return m<n?String(m+1).padStart(h.length,"0")+g:`${h}.1${g}`});const c=r.lastIndexOf(".");if(!e&&c>=0)return`${r.substr(0,c)}.1${r.substr(c)}`;const d=RegExp("(\\d+)$");if(!e&&c===-1&&r.match(d))return r.replace(d,(u,h)=>{const g=parseInt(h);return g<n?String(g+1).padStart(h.length,"0"):`${h}.1`});const l=RegExp("(.*)(\\d*)$");return!e&&c===-1&&r.match(l)?r.replace(l,(u,h,g)=>{let m=parseInt(g);return isNaN(m)&&(m=0),m<n?h+String(m+1).padStart(g.length,"0"):`${h}${g}.1`}):e&&r.match(/(\d+)$/)?r.replace(/(\d+)$/,(u,...h)=>{const g=parseInt(h[0]);return g<n?String(g+1).padStart(h[0].length,"0"):`${h[0]}.1`}):e&&r.match(/^(\d+)/)?r.replace(/^(\d+)(.*)$/,(u,...h)=>{const g=parseInt(h[0]);return g<n?String(g+1).padStart(h[0].length,"0")+h[1]:`${h[0]}${h[1]}.1`}):`${r}.1`}async function Q_e(r,e,t){if(!await r.exists(t))return!0;const{confirmed:n}=await e.confirm({type:wn.Warning,message:p("confirmOverwrite","A file or folder with the name '{0}' already exists in the destination folder. Do you want to replace it?",Yn(t.path)),primaryButton:p("replaceButtonLabel","&&Replace")});return n}class Tw extends Le{constructor(){super({id:Tw.ID,title:{value:Tw.LABEL,original:"Compare Active File With..."},f1:!0,category:ye.File,precondition:hme})}async run(e){const t=e.get(Ke),i=e.get(or),n=e.get(ss),s=t.activeEditor,o=Vn.getOriginalUri(s);if(o&&i.canHandleResource(o)){const a=await n.quickAccess.pick("",{itemActivation:u1.SECOND});if((a==null?void 0:a.length)===1){const c=a[0].resource;k.isUri(c)&&i.canHandleResource(c)&&t.openEditor({original:{resource:o},modified:{resource:c},options:{pinned:!0}})}}}}Tw.ID="workbench.files.action.compareFileWith";Tw.LABEL=p("globalCompareFile","Compare Active File With...");class Iw extends Le{constructor(){super({id:Iw.ID,title:{value:Iw.LABEL,original:"Toggle Auto Save"},f1:!0,category:ye.File})}run(e){return e.get(qr).toggleAutoSave()}}Iw.ID="workbench.action.toggleAutoSave";Iw.LABEL=p("toggleAutoSave","Toggle Auto Save");let jO=class extends Zn{constructor(e,t,i,n,s){super(e,t),this.commandService=i,this.notificationService=n,this.workingCopyService=s,this.lastDirtyState=this.workingCopyService.hasDirty,this.enabled=this.lastDirtyState,this.registerListeners()}registerListeners(){this._register(this.workingCopyService.onDidChangeDirty(e=>this.updateEnablement(e)))}updateEnablement(e){const t=e.isDirty()||this.workingCopyService.hasDirty;this.lastDirtyState!==t&&(this.enabled=t,this.lastDirtyState=this.enabled)}async run(e){try{await this.doRun(e)}catch(t){p6(this.notificationService,t)}}};jO=T([v(2,un),v(3,on),v(4,Od)],jO);class Oy extends jO{get class(){return"explorer-action "+Si.asClassName(jt.saveAll)}doRun(e){return this.commandService.executeCommand(Vye,{},e)}}Oy.ID="workbench.files.action.saveAllInGroup";Oy.LABEL=p("saveAllInGroup","Save All in Group");let Kh=class extends Zn{constructor(e,t,i){super(e,t,Si.asClassName(jt.closeAll)),this.commandService=i}run(e){return this.commandService.executeCommand(o6,{},e)}};Kh.ID="workbench.files.action.closeGroup";Kh.LABEL=p("closeGroup","Close Group");Kh=T([v(2,un)],Kh);class Rw extends Le{constructor(){super({id:Rw.ID,title:{value:Rw.LABEL,original:"Focus on Files Explorer"},f1:!0,category:ye.File})}async run(e){await e.get(Jm).openPaneComposite(z_,0,!0)}}Rw.ID="workbench.files.action.focusFilesExplorer";Rw.LABEL=p("focusFilesExplorer","Focus on Files Explorer");class Pw extends Le{constructor(){super({id:Pw.ID,title:{value:Pw.LABEL,original:"Reveal Active File in Explorer View"},f1:!0,category:ye.File})}async run(e){const t=e.get(un),i=e.get(Ke),n=Vn.getOriginalUri(i.activeEditor,{supportSideBySide:Ui.PRIMARY});n&&t.executeCommand(Uye,n)}}Pw.ID="workbench.files.action.showActiveFileInExplorer";Pw.LABEL=p("showInExplorer","Reveal Active File in Explorer View");class Aw extends Le{constructor(){super({id:Aw.ID,title:{value:Aw.LABEL,original:"Open Active File in New Window"},f1:!0,category:ye.File,keybinding:{primary:Bt(2089,45),weight:200},precondition:dme})}async run(e){const t=e.get(Ke),i=e.get(bu),n=e.get(ar),s=e.get(at),o=Vn.getOriginalUri(t.activeEditor,{supportSideBySide:Ui.PRIMARY});o&&(s.hasProvider(o)?i.openWindow([{fileUri:o}],{forceNewWindow:!0}):n.error(p("openFileToShowInNewWindow.unsupportedschema","The active editor must contain an openable resource.")))}}Aw.ID="workbench.action.files.showOpenedFileInNewWindow";Aw.LABEL=p("openFileInNewWindow","Open Active File in New Window");function y6(r,e,t,i){if(t=X_e(t),!t||t.length===0||/^\s+$/.test(t))return{content:p("emptyFileNameError","A file or folder name must be provided."),severity:wn.Error};if(t[0]==="/"||t[0]==="\\")return{content:p("fileNameStartsWithSlashError","A file or folder name cannot start with a slash."),severity:wn.Error};const n=fi(t.split(/[\\/]/)),s=e.parent;if(t!==e.name){const o=s==null?void 0:s.getChild(t);if(o&&o!==e)return{content:p("fileNameExistsError","A file or folder **{0}** already exists at this location. Please choose a different name.",t),severity:wn.Error}}if(n.some(o=>!r.hasValidBasename(e.resource,i,o))){const o=t.replace(/\*/g,"\\*");return{content:p("invalidFileNameError","The name **{0}** is not valid as a file or folder name. Please choose a different name.",Y_e(o)),severity:wn.Error}}return n.some(o=>/^\s|\s$/.test(o))?{content:p("fileNameWhitespaceWarning","Leading or trailing whitespace detected in file or folder name."),severity:wn.Warning}:null}function Y_e(r){return(r==null?void 0:r.length)>255?`${r.substr(0,255)}...`:r}function X_e(r){return r&&(r=HX(r,"	"),r=tf(r,"/"),r=tf(r,"\\"),r)}class Mw extends Le{constructor(){super({id:Mw.ID,title:{value:Mw.LABEL,original:"Compare New Untitled Text Files"},f1:!0,category:ye.File})}async run(e){await e.get(Ke).openEditor({original:{resource:void 0},modified:{resource:void 0},options:{pinned:!0}})}}Mw.ID="workbench.files.action.compareNewUntitledTextFiles";Mw.LABEL=p("compareNewUntitledTextFiles","Compare New Untitled Text Files");class Qh extends Le{constructor(){super({id:Qh.ID,title:{value:Qh.LABEL,original:"Compare Active File with Clipboard"},f1:!0,category:ye.File,keybinding:{primary:Bt(2089,33),weight:200}})}async run(e){const t=e.get(Ke),i=e.get(Te),n=e.get(or),s=e.get(at),o=Vn.getOriginalUri(t.activeEditor,{supportSideBySide:Ui.PRIMARY}),a=`clipboardCompare${Qh.SCHEME_COUNTER++}`;if(o&&(s.hasProvider(o)||o.scheme===pe.untitled)){if(!this.registrationDisposal){const l=i.createInstance(BO);this.registrationDisposal=n.registerTextModelContentProvider(a,l)}const c=Mt(o),d=p("clipboardComparisonLabel","Clipboard ↔ {0}",c);await t.openEditor({original:{resource:o.with({scheme:a})},modified:{resource:o},label:d,options:{pinned:!0}}).finally(()=>{vt(this.registrationDisposal),this.registrationDisposal=void 0})}}dispose(){vt(this.registrationDisposal),this.registrationDisposal=void 0}}Qh.ID="workbench.files.action.compareWithClipboard";Qh.LABEL=p("compareWithClipboard","Compare Active File with Clipboard");Qh.SCHEME_COUNTER=0;let BO=class{constructor(e,t,i){this.clipboardService=e,this.languageService=t,this.modelService=i}async provideTextContent(e){const t=await this.clipboardService.readText();return this.modelService.createModel(t,this.languageService.createByFilepathOrFirstLine(e),e)}};BO=T([v(0,Vm),v(1,ji),v(2,_i)],BO);function J_e(r,e,t){r.prompt(wn.Error,La(e,!1),[{label:p("retry","Retry"),run:()=>t()}])}async function _6(r,e){var R;const t=r.get(mn),i=r.get(at),n=r.get(We),s=r.get(qr),o=r.get(Ke),a=r.get(ko),c=r.get(on),d=r.get(Wa),l=r.get(un),u=r.get(ta),h=!a.isViewVisible(Qs),g=await a.openView(Qs,!0);if(h&&await zs(500),!g){if(e)throw new Error("Open a folder or workspace first.");return l.executeCommand(Kye)}const m=t.getContext(!1),y=m.length>0?m[0]:void 0;let _;if(y?_=y.isDirectory?y:y.parent||t.roots[0]:_=t.roots[0],_.isReadonly)throw new Error("Parent folder is readonly.");const b=new jT(i,n,s,_,e);_.addChild(b);const E=async M=>{try{const O=pt(_.resource,M);M.endsWith("/")&&(e=!0),await t.applyBulkEdit([new zo(void 0,O,{folder:e})],{undoLabel:p("createBulkEdit","Create {0}",M),progressLabel:p("creatingBulkEdit","Creating {0}",M),confirmBeforeUndo:!0}),await g6(M,t),e?await t.select(O,!0):await o.openEditor({resource:O,options:{pinned:!0}})}catch(O){J_e(c,O,()=>E(M))}},D=((R=await d.getEnvironment())==null?void 0:R.os)??dc;await t.setEditable(b,{validationMessage:M=>y6(u,b,M,D),onFinish:async(M,O)=>{_.removeChild(b),await t.setEditable(b,null),O&&E(M)}})}Gt.registerCommand({id:hW,handler:async r=>{await _6(r,!1)}});Gt.registerCommand({id:f6,handler:async r=>{await _6(r,!0)}});const $$e=async r=>{var d;const e=r.get(mn),t=r.get(on),i=r.get(Wa),n=r.get(ta),s=r.get(We),o=e.getContext(!1),a=o.length>0?o[0]:void 0;if(!a)return;const c=((d=await i.getEnvironment())==null?void 0:d.os)??dc;await e.setEditable(a,{validationMessage:l=>y6(n,a,l,c),onFinish:async(l,u)=>{if(u){const h=a.parent.resource,g=pt(h,l);if(a.resource.toString()!==g.toString())try{await e.applyBulkEdit([new zo(a.resource,g)],{confirmBeforeUndo:s.getValue().explorer.confirmUndo==="verbose",undoLabel:p("renameBulkEdit","Rename {0} to {1}",a.name,l),progressLabel:p("renamingBulkEdit","Renaming {0} to {1}",a.name,l)}),await g6(l,e)}catch(m){t.error(m)}}await e.setEditable(a,null)}})},W$e=async r=>{const t=r.get(mn).getContext(!0).filter(i=>!i.isRoot);t.length&&await fW(r.get(mn),r.get($a),r.get(ar),r.get(We),t,!0)},H$e=async r=>{const t=r.get(mn).getContext(!0).filter(i=>!i.isRoot);t.length&&await fW(r.get(mn),r.get($a),r.get(ar),r.get(We),t,!1)};let tg=!1;const j$e=async r=>{const e=r.get(mn),t=e.getContext(!0);t.length>0&&(await e.setToCopy(t,!1),tg=!1)},B$e=async r=>{const e=r.get(mn),t=e.getContext(!0);t.length>0&&(await e.setToCopy(t,!0),tg=!0)},Z_e=async r=>{const e=r.get(mn),t=r.get(on),i=r.get(Te),n=e.getContext(!0),s=n.length?n:e.roots,o=i.createInstance(kD);try{await o.download(s)}catch(a){throw t.error(a),a}};Gt.registerCommand({id:U_e,handler:Z_e});const ewe=async r=>{const e=r.get(mn),t=r.get(on),i=r.get(Te),n=e.getContext(!0),s=n.length?n[0]:e.roots[0];try{const o=await WX();o&&await i.createInstance(kw).upload(s,o)}catch(o){throw t.error(o),o}};Gt.registerCommand({id:V_e,handler:ewe});const U$e=async r=>{const e=r.get(Vm),t=r.get(mn),i=r.get(at),n=r.get(on),s=r.get(Ke),o=r.get(We),a=r.get(Hi),c=r.get(ar),d=t.getContext(!0),l=h1(await e.readResources(),g=>g),u=d.length?d[0]:t.roots[0],h=o.getValue().explorer.incrementalNaming;try{const g=fi(await Promise.all(l.map(async m=>{if(u.resource.toString()!==m.toString()&&Ff(u.resource,m))throw new Error(p("fileIsAncestor","File to paste is an ancestor of the destination folder"));const y=await i.stat(m);let _;a.extUri.isEqual(u.resource,m)?_=u.parent:_=u.isDirectory?u:u.parent;const b=await v6(t,i,c,_,{resource:m,isDirectory:y.isDirectory,allowOverwrite:tg||h==="disabled"},h);if(b)return{source:m,target:b}})));if(g.length>=1){if(tg){const y=g.map(b=>new zo(b.source,b.target,{overwrite:h==="disabled"})),_={confirmBeforeUndo:o.getValue().explorer.confirmUndo==="verbose",progressLabel:g.length>1?p({key:"movingBulkEdit",comment:["Placeholder will be replaced by the number of files being moved"]},"Moving {0} files",g.length):p({key:"movingFileBulkEdit",comment:["Placeholder will be replaced by the name of the file moved."]},"Moving {0}",Xc(g[0].target)),undoLabel:g.length>1?p({key:"moveBulkEdit",comment:["Placeholder will be replaced by the number of files being moved"]},"Move {0} files",g.length):p({key:"moveFileBulkEdit",comment:["Placeholder will be replaced by the name of the file moved."]},"Move {0}",Xc(g[0].target))};await t.applyBulkEdit(y,_)}else{const y=g.map(E=>new zo(E.source,E.target,{copy:!0,overwrite:h==="disabled"})),_=o.getValue().explorer.confirmUndo,b={confirmBeforeUndo:_==="default"||_==="verbose",progressLabel:g.length>1?p({key:"copyingBulkEdit",comment:["Placeholder will be replaced by the number of files being copied"]},"Copying {0} files",g.length):p({key:"copyingFileBulkEdit",comment:["Placeholder will be replaced by the name of the file copied."]},"Copying {0}",Xc(g[0].target)),undoLabel:g.length>1?p({key:"copyBulkEdit",comment:["Placeholder will be replaced by the number of files being copied"]},"Paste {0} files",g.length):p({key:"copyFileBulkEdit",comment:["Placeholder will be replaced by the name of the file copied."]},"Paste {0}",Xc(g[0].target))};await t.applyBulkEdit(y,b)}const m=g[0];if(await t.select(m.target),g.length===1){const y=t.findClosest(m.target);y&&!y.isDirectory&&await s.openEditor({resource:y.resource,options:{pinned:!0,preserveFocus:!0}})}}}catch(g){p6(n,new Error(p("fileDeleted","The file(s) to paste have been deleted or moved since you copied them. {0}",UN(g))))}finally{tg&&(await t.setToCopy([],!1),tg=!1)}},V$e=async r=>{const e=r.get(Ke),i=r.get(mn).getContext(!0);await e.openEditors(i.filter(n=>!n.isDirectory).map(n=>({resource:n.resource,options:{preserveFocus:!0}})))};class mI extends Le{constructor(e,t,i){super({id:e,title:t,f1:!0,category:ye.File,precondition:ume}),this.newReadonlyState=i}async run(e){const t=e.get(Ke),i=e.get(qr),n=Vn.getOriginalUri(t.activeEditor,{supportSideBySide:Ui.PRIMARY});n&&await i.updateReadonly(n,this.newReadonlyState)}}class Lw extends mI{constructor(){super(Lw.ID,{value:Lw.LABEL,original:"Set Active Editor Readonly in Session"},!0)}}Lw.ID="workbench.action.files.setActiveEditorReadonlyInSession";Lw.LABEL=p("setActiveEditorReadonlyInSession","Set Active Editor Read-only in Session");class Fw extends mI{constructor(){super(Fw.ID,{value:Fw.LABEL,original:"Set Active Editor Writeable in Session"},!1)}}Fw.ID="workbench.action.files.setActiveEditorWriteableInSession";Fw.LABEL=p("setActiveEditorWriteableInSession","Set Active Editor Writeable in Session");class Ow extends mI{constructor(){super(Ow.ID,{value:Ow.LABEL,original:"Toggle Active Editor Readonly in Session"},"toggle")}}Ow.ID="workbench.action.files.toggleActiveEditorReadonlyInSession";Ow.LABEL=p("toggleActiveEditorReadonlyInSession","Toggle Active Editor Read-only in Session");class Nw extends mI{constructor(){super(Nw.ID,{value:Nw.LABEL,original:"Reset Active Editor Readonly in Session"},"reset")}}Nw.ID="workbench.action.files.resetActiveEditorReadonlyInSession";Nw.LABEL=p("resetActiveEditorReadonlyInSession","Reset Active Editor Read-only in Session");class twe{constructor(e,t,i){if(this.location=t,this.parent=i,t[t.length-1]==="\\")throw Error("Unexpected path format, do not use trailing backslashes");t[t.length-1]!=="/"&&(t+="/"),this.isPathIgnored=this.parseIgnoreFile(e,this.location,this.parent)}updateContents(e){this.isPathIgnored=this.parseIgnoreFile(e,this.location,this.parent)}isPathIncludedInTraversal(e,t){if(e[0]!=="/"||e[e.length-1]==="/")throw Error("Unexpected path format, expectred to begin with slash and end without. got:"+e);return!this.isPathIgnored(e,t)}isArbitraryPathIgnored(e,t){if(e[0]!=="/"||e[e.length-1]==="/")throw Error("Unexpected path format, expectred to begin with slash and end without. got:"+e);const i=e.split("/").filter(o=>o);let n=!1,s="";for(let o=0;o<i.length;o++){const a=o===i.length-1,c=i[o];if(s=s+"/"+c,!this.isPathIncludedInTraversal(s,a?t:!0)){n=!0;break}}return n}gitignoreLinesToExpression(e,t,i){const n=e.map(o=>this.gitignoreLineToGlob(o,t)),s=Object.create(null);for(const o of n)s[o]=!0;return vd(s,{trimForExclusions:i})}parseIgnoreFile(e,t,i){const n=e.split(`
`).map(y=>y.trim()).filter(y=>y&&y[0]!=="#"),s=n.filter(y=>!y.endsWith("/")),o=s.filter(y=>!y.includes("!")),a=this.gitignoreLinesToExpression(o,t,!0),c=s.filter(y=>y.includes("!")).map(y=>y.replace(/!/g,"")),d=this.gitignoreLinesToExpression(c,t,!1),l=n.filter(y=>!y.includes("!")),u=this.gitignoreLinesToExpression(l,t,!0),h=n.filter(y=>y.includes("!")).map(y=>y.replace(/!/g,"")),g=this.gitignoreLinesToExpression(h,t,!1);return(y,_)=>y.startsWith(t)?_&&u(y)&&!g(y)||a(y)&&!d(y)?!0:i?i.isPathIgnored(y,_):!1:!1}gitignoreLineToGlob(e,t){const i=e.indexOf("/");return i===-1||i===e.length-1?e="**/"+e:(i===0?t.slice(-1)==="/"&&(e=e.slice(1)):t.slice(-1)!=="/"&&(e="/"+e),e=t+e),e}}class $w{getHeight(e){return $w.ITEM_HEIGHT}getTemplateId(e){return Ww.ID}}$w.ITEM_HEIGHT=22;const UO=new A;let VO=class{constructor(e,t,i,n,s,o,a,c,d){this.fileFilter=e,this.progressService=t,this.configService=i,this.notificationService=n,this.layoutService=s,this.fileService=o,this.explorerService=a,this.contextService=c,this.filesConfigService=d}hasChildren(e){return Array.isArray(e)||e.hasChildren(t=>this.fileFilter.filter(t,1))}getChildren(e){if(Array.isArray(e))return e;const t=e.error,i=this.explorerService.sortOrderConfiguration.sortOrder,n=e.fetchChildren(i);if(Array.isArray(n))return n;const s=n.then(o=>(e instanceof hn&&e.isRoot&&!e.error&&t&&this.contextService.getWorkbenchState()!==2&&UO.fire(e.resource),o),o=>{if(e instanceof hn&&e.isRoot)if(this.contextService.getWorkbenchState()===2){const a=new hn(e.resource,this.fileService,this.configService,this.filesConfigService,void 0,void 0,!1);return a.error=o,[a]}else UO.fire(e.resource);else this.notificationService.error(o);return[]});return this.progressService.withProgress({location:1,delay:this.layoutService.isRestored()?800:1500},o=>s),s}};VO=T([v(1,kc),v(2,We),v(3,on),v(4,Kf),v(5,at),v(6,mn),v(7,oi),v(8,qr)],VO);class qO{get index(){return this._index}get count(){return this.items.length}get current(){return this.items[this._index]}get currentId(){return`${this.id}_${this.index}`}get labels(){return this._labels}constructor(e,t,i,n,s){this.id=e,this.items=t,this.depth=n,this.collapsed=s,this._onDidChange=new A,this.onDidChange=this._onDidChange.event,this._index=t.length-1,this.updateLabels(i),this._updateLabelDisposable=i.label.onDidRender(()=>this.updateLabels(i))}updateLabels(e){this._labels=Array.from(e.container.querySelectorAll(".label-name"));let t="";for(let i=0;i<this.labels.length;i++){const n=t.length?`${this.items[i].name}, compact, ${t}`:this.items[i].name;this.labels[i].setAttribute("aria-label",n),this.labels[i].setAttribute("aria-level",`${this.depth+i}`),t=t.length?`${this.items[i].name} ${t}`:this.items[i].name}this.updateCollapsed(this.collapsed),this._index<this.labels.length&&this.labels[this._index].classList.add("active")}previous(){this._index<=0||this.setIndex(this._index-1)}next(){this._index>=this.items.length-1||this.setIndex(this._index+1)}first(){this._index!==0&&this.setIndex(0)}last(){this._index!==this.items.length-1&&this.setIndex(this.items.length-1)}setIndex(e){e<0||e>=this.items.length||(this.labels[this._index].classList.remove("active"),this._index=e,this.labels[this._index].classList.add("active"),this._onDidChange.fire())}updateCollapsed(e){this.collapsed=e;for(let t=0;t<this.labels.length;t++)this.labels[t].setAttribute("aria-expanded",e?"false":"true")}dispose(){this._onDidChange.dispose(),this._updateLabelDisposable.dispose()}}qO.ID=0;let Ww=class w6{constructor(e,t,i,n,s,o,a,c,d,l,u){this.labels=t,this.updateWidth=i,this.contextViewService=n,this.themeService=s,this.configurationService=o,this.explorerService=a,this.labelService=c,this.contextService=d,this.contextMenuService=l,this.hoverService=u,this.compressedNavigationControllers=new Map,this._onDidChangeActiveDescendant=new jX,this.onDidChangeActiveDescendant=this._onDidChangeActiveDescendant.event,this.hoverDelegate=new class{get delay(){return Date.now()-this.lastHoverHideTime<500?0:this.configurationService.getValue("workbench.hover.delay")}constructor(g,m){this.configurationService=g,this.hoverService=m,this.lastHoverHideTime=0,this.hiddenFromClick=!1,this.placement="element"}showHover(g,m){let y;g.target instanceof HTMLElement?y=g.target:y=g.target.targetElements[0];const _=y.closest(".monaco-tl-row"),b=_==null?void 0:_.closest(".monaco-list-row"),E=y.querySelector("div.monaco-icon-label-container"),D=E==null?void 0:E.querySelector("span.monaco-icon-name-container");let R=!1;if(D&&E){const L=E.clientWidth,W=D.offsetWidth;R=L<=W}const M=g.content.toString().includes("•");R=R||M;const O=_==null?void 0:_.querySelector(".monaco-tl-indent");if(O)return R?this.hoverService.showHover({...g,target:O,compact:!0,container:b,additionalClasses:["explorer-item-hover"],skipFadeInAnimation:!0,showPointer:!1,hoverPosition:1},m):void 0}onDidHideHover(){this.hiddenFromClick||(this.lastHoverHideTime=Date.now()),this.hiddenFromClick=!1}}(this.configurationService,this.hoverService),this.config=this.configurationService.getValue();const h=()=>{const g=this.configurationService.getValue("workbench.tree.indent"),m=Math.max(22-g,0);e.style.setProperty("--vscode-explorer-align-offset-margin-left",`${m}px`)};this.configListener=this.configurationService.onDidChangeConfiguration(g=>{g.affectsConfiguration("explorer")&&(this.config=this.configurationService.getValue()),g.affectsConfiguration("workbench.tree.indent")&&h()}),h()}getWidgetAriaLabel(){return p("treeAriaLabel","Files Explorer")}get templateId(){return w6.ID}renderTemplate(e){const t=new me,i=this.configurationService.getValue("explorer.experimental.hover"),n=t.add(this.labels.create(e,{supportHighlights:!0,hoverDelegate:i?this.hoverDelegate:void 0}));t.add(n.onDidRender(()=>{try{s.currentContext&&this.updateWidth(s.currentContext)}catch{}}));const s={templateDisposables:t,elementDisposables:t.add(new me),label:n,container:e};return s}renderElement(e,t,i){const n=e.element;i.currentContext=n;const s=this.explorerService.getEditableData(n);i.label.element.classList.remove("compressed"),s?(i.label.element.style.display="none",i.elementDisposables.add(this.renderInputBox(i.container,n,s))):(i.label.element.style.display="flex",this.renderStat(n,n.name,void 0,e.filterData,i))}renderCompressedElements(e,t,i,n){const s=e.element.elements[e.element.elements.length-1];i.currentContext=s;const o=e.element.elements.filter(c=>this.explorerService.isEditable(c)),a=o.length===0?void 0:this.explorerService.getEditableData(o[0]);if(a)i.label.element.classList.remove("compressed"),i.label.element.style.display="none",i.elementDisposables.add(this.renderInputBox(i.container,o[0],a));else{i.label.element.classList.add("compressed"),i.label.element.style.display="flex";const c=`compressed-explorer_${qO.ID++}`,d=e.element.elements.map(u=>u.name);this.renderStat(s,d,c,e.filterData,i);const l=new qO(c,e.element.elements,i,e.depth,e.collapsed);i.elementDisposables.add(l),this.compressedNavigationControllers.set(s,l),i.elementDisposables.add(this._onDidChangeActiveDescendant.add(l.onDidChange)),i.elementDisposables.add(Ci(i.container,"mousedown",u=>{const h=ID(u.target);h&&l.setIndex(h.index)})),i.elementDisposables.add(ot(()=>this.compressedNavigationControllers.delete(s)))}}renderStat(e,t,i,n,s){var h,g;s.label.element.style.display="flex";const o=["explorer-item"];this.explorerService.isCut(e)&&o.push("cut");const a=this.themeService.getFileIconTheme(),c=(g=(h=s.container.parentElement)==null?void 0:h.parentElement)==null?void 0:g.querySelector(".monaco-tl-twistie");c==null||c.classList.toggle("force-twistie",e.hasNests&&a.hidesExplorerArrows);const d=a.hasFileIcons&&(a.hidesExplorerArrows||!a.hasFolderIcons),l=e.nestedParent&&d,u=this.configurationService.getValue("explorer.experimental.hover");s.label.setResource({resource:e.resource,name:t},{title:u?$N(t)?t[0]:t:void 0,fileKind:e.isRoot?el.ROOT_FOLDER:e.isDirectory?el.FOLDER:el.FILE,extraClasses:l?[...o,"align-nest-icon-with-parent-icon"]:o,fileDecorations:this.config.explorer.decorations,matches:BX(n),separator:this.labelService.getSeparator(e.resource.scheme,e.resource.authority),domId:i})}renderInputBox(e,t,i){const n=this.labels.create(e),s=["explorer-item","explorer-item-edited"],o=t.isRoot?el.ROOT_FOLDER:t.isDirectory?el.FOLDER:el.FILE,a=this.themeService.getFileIconTheme(),c=a.hasFileIcons&&(a.hidesExplorerArrows||!a.hasFolderIcons),d=t.nestedParent&&c,l={hidePath:!0,hideLabel:!0,fileKind:o,extraClasses:d?[...s,"align-nest-icon-with-parent-icon"]:s},u=t.name?pn(t.resource):t.resource,h=t.name||"";n.setFile(pt(u,h||" "),l),n.element.firstElementChild.style.display="none";const g=new UX(n.element,this.contextViewService,{validationOptions:{validation:D=>{const R=i.validationMessage(D);return!R||R.severity!==wn.Error?null:{content:R.content,formatContent:!0,type:3}}},ariaLabel:p("fileInputAriaLabel","Type file name. Press Enter to confirm or Escape to cancel."),inputBoxStyles:Zq}),m=h.lastIndexOf(".");let y="prefix";g.value=h,g.focus(),g.select({start:0,end:m>0&&!t.isDirectory?m:h.length});const _=eb((D,R)=>{n.element.style.display="none";const M=g.value;vt(E),n.element.remove(),R&&i.onFinish(M,D)}),b=()=>{if(g.isInputValid()){const D=i.validationMessage(g.value);D?g.showMessage({content:D.content,formatContent:!0,type:D.severity===wn.Info?1:D.severity===wn.Warning?2:3}):g.hideMessage()}};b();const E=[g,g.onDidChange(D=>{n.setFile(pt(u,D||" "),l)}),Wp(g.inputElement,sn.KEY_DOWN,D=>{if(D.equals(60)){const R=g.value.lastIndexOf(".");if(t.isDirectory||R===-1)return;y==="prefix"?(y="all",g.select({start:0,end:g.value.length})):y==="all"?(y="suffix",g.select({start:R+1,end:g.value.length})):(y="prefix",g.select({start:0,end:R}))}else D.equals(3)?g.validate()||_(!0,!0):D.equals(9)&&_(!1,!0)}),Wp(g.inputElement,sn.KEY_UP,D=>{b()}),Ci(g.inputElement,sn.BLUR,async()=>{for(;await zs(0),!!document.hasFocus();){if(document.activeElement===g.inputElement)return;if(document.activeElement instanceof HTMLElement&&VX(document.activeElement,"context-view"))await F.toPromise(this.contextMenuService.onDidHideContextMenu);else break}_(g.isInputValid(),!0)}),n];return ot(()=>{_(!1,!1)})}disposeElement(e,t,i){i.currentContext=void 0,i.elementDisposables.clear()}disposeCompressedElements(e,t,i){i.currentContext=void 0,i.elementDisposables.clear()}disposeTemplate(e){e.templateDisposables.dispose()}getCompressedNavigationController(e){return this.compressedNavigationControllers.get(e)}getAriaLabel(e){return e.name}getAriaLevel(e){let t=0,i=e.parent;for(;i;)i=i.parent,t++;return this.contextService.getWorkbenchState()===3&&(t=t+1),t}getActiveDescendantId(e){const t=this.compressedNavigationControllers.get(e);return t==null?void 0:t.currentId}dispose(){this.configListener.dispose()}};Ww.ID="file";Ww=T([v(3,fk),v(4,Fi),v(5,We),v(6,mn),v(7,Qi),v(8,oi),v(9,eo),v(10,Z3)],Ww);let GO=class{constructor(e,t,i,n,s,o){this.contextService=e,this.configurationService=t,this.explorerService=i,this.editorService=n,this.uriIdentityService=s,this.fileService=o,this.hiddenExpressionPerRoot=new Map,this.editorsAffectingFilter=new Set,this._onDidChange=new A,this.toDispose=[],this.ignoreFileResourcesPerRoot=new Map,this.ignoreTreesPerRoot=new Map,this.toDispose.push(this.contextService.onDidChangeWorkspaceFolders(()=>this.updateConfiguration())),this.toDispose.push(this.configurationService.onDidChangeConfiguration(a=>{(a.affectsConfiguration("files.exclude")||a.affectsConfiguration("explorer.excludeGitIgnore"))&&this.updateConfiguration()})),this.toDispose.push(this.fileService.onDidFilesChange(a=>{for(const[c,d]of this.ignoreFileResourcesPerRoot.entries())d.forEach(async l=>{var u;a.contains(l,0)&&await this.processIgnoreFile(c,l,!0),a.contains(l,2)&&((u=this.ignoreTreesPerRoot.get(c))==null||u.delete(pn(l)),d.delete(l),this._onDidChange.fire())})})),this.toDispose.push(this.editorService.onDidVisibleEditorsChange(()=>{const a=this.editorService.visibleEditors;let c=!1;for(const d of a){if(!d.resource)continue;const l=this.explorerService.findClosest(d.resource);if(l&&l.isExcluded){c=!0;break}}for(const d of this.editorsAffectingFilter)if(!a.includes(d)){c=!0;break}c&&(this.editorsAffectingFilter.clear(),this._onDidChange.fire())})),this.updateConfiguration()}get onDidChange(){return this._onDidChange.event}updateConfiguration(){let e=!1,t=!1;this.contextService.getWorkspace().folders.forEach(i=>{var c;const n=this.configurationService.getValue({resource:i.uri}),s=((c=n==null?void 0:n.files)==null?void 0:c.exclude)||Object.create(null),o=n.explorer.excludeGitIgnore;if(o&&!this.ignoreTreesPerRoot.has(i.uri.toString())&&(t=!0,this.ignoreFileResourcesPerRoot.set(i.uri.toString(),new sk),this.ignoreTreesPerRoot.set(i.uri.toString(),pc.forUris(d=>this.uriIdentityService.extUri.ignorePathCasing(d)))),!o&&this.ignoreTreesPerRoot.has(i.uri.toString())&&(t=!0,this.ignoreFileResourcesPerRoot.delete(i.uri.toString()),this.ignoreTreesPerRoot.delete(i.uri.toString())),!e){const d=this.hiddenExpressionPerRoot.get(i.uri.toString());e=!d||!xa(d.original,s)}const a=Gi(s);this.hiddenExpressionPerRoot.set(i.uri.toString(),{original:a,parsed:vd(a)})}),(e||t)&&(this.editorsAffectingFilter.clear(),this._onDidChange.fire())}async processIgnoreFile(e,t,i){var a,c;const n=pn(t),s=this.ignoreTreesPerRoot.get(e);if(!s||!i&&s.has(n))return;const o=await this.fileService.readFile(t);if(i){const d=s.get(n);d==null||d.updateContents(o.value.toString())}else{const d=s.findSubstr(n),l=new twe(o.value.toString(),n.path,d);s.set(n,l),(a=this.ignoreFileResourcesPerRoot.get(e))!=null&&a.has(t)||(c=this.ignoreFileResourcesPerRoot.get(e))==null||c.add(t)}this._onDidChange.fire()}filter(e,t){return e.name===".gitignore"&&this.ignoreTreesPerRoot.has(e.root.resource.toString())?(this.processIgnoreFile(e.root.resource.toString(),e.resource,!1),!0):this.isVisible(e,t)}isVisible(e,t){var c,d;if(e.isExcluded=!1,t===0)return e.isExcluded=!0,!1;if(this.explorerService.getEditableData(e))return!0;const i=this.hiddenExpressionPerRoot.get(e.root.resource.toString()),n=i==null?void 0:i.parsed(Sg(e.root.resource.path,e.resource.path),e.name,l=>!!(e.parent&&e.parent.getChild(l))),s=n||(c=this.ignoreTreesPerRoot.get(e.root.resource.toString()))==null?void 0:c.findSubstr(e.resource),o=s==null?void 0:s.isPathIncludedInTraversal(e.resource.path,e.isDirectory);if((o===void 0?!1:!o)||n||(d=e.parent)!=null&&d.isExcluded){e.isExcluded=!0;const u=this.editorService.visibleEditors.find(h=>h.resource&&this.uriIdentityService.extUri.isEqualOrParent(h.resource,e.resource));return u&&e.root===this.explorerService.findClosestRoot(e.resource)?(this.editorsAffectingFilter.add(u),!0):!1}return!0}dispose(){vt(this.toDispose)}};GO=T([v(0,oi),v(1,We),v(2,mn),v(3,Ke),v(4,Hi),v(5,at)],GO);let zO=class{constructor(e,t){this.explorerService=e,this.contextService=t}compare(e,t){if(e.isRoot){if(t.isRoot){const a=this.contextService.getWorkspaceFolder(e.resource),c=this.contextService.getWorkspaceFolder(t.resource);return a&&c?a.index-c.index:-1}return-1}if(t.isRoot)return 1;const i=this.explorerService.sortOrderConfiguration.sortOrder,n=this.explorerService.sortOrderConfiguration.lexicographicOptions;let s,o;switch(n){case"upper":s=XX,o=JX;break;case"lower":s=QX,o=YX;break;case"unicode":s=zX,o=KX;break;default:s=HP,o=GX}switch(i){case"type":if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;if(e.isDirectory&&t.isDirectory)return s(e.name,t.name);break;case"filesFirst":if(e.isDirectory&&!t.isDirectory)return 1;if(t.isDirectory&&!e.isDirectory)return-1;break;case"foldersNestsFiles":if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;if(e.hasNests&&!t.hasNests)return-1;if(t.hasNests&&!e.hasNests)return 1;break;case"mixed":break;default:if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;break}switch(i){case"type":return o(e.name,t.name);case"modified":return e.mtime!==t.mtime?e.mtime&&t.mtime&&e.mtime<t.mtime?1:-1:s(e.name,t.name);default:return s(e.name,t.name)}}};zO=T([v(0,mn),v(1,oi)],zO);let TD=class Za{constructor(e,t,i,n,s,o,a,c,d,l){this.isCollapsed=e,this.explorerService=t,this.editorService=i,this.dialogService=n,this.contextService=s,this.fileService=o,this.configurationService=a,this.instantiationService=c,this.workspaceEditingService=d,this.uriIdentityService=l,this.compressedDropTargetDisposable=ne.None,this.dropEnabled=!1,this.toDispose=[];const u=h=>{(!h||h.affectsConfiguration("explorer.enableDragAndDrop"))&&(this.dropEnabled=this.configurationService.getValue("explorer.enableDragAndDrop"))};u(void 0),this.toDispose.push(this.configurationService.onDidChangeConfiguration(h=>u(h)))}onDragOver(e,t,i,n){if(!this.dropEnabled)return!1;if(t){const s=Za.getCompressedStatFromDragEvent(t,n);if(s){const o=ID(n.target);if(o&&o.index<o.count-1){const a=this.handleDragOver(e,s,i,n);return a?(o.element!==this.compressedDragOverElement&&(this.compressedDragOverElement=o.element,this.compressedDropTargetDisposable.dispose(),this.compressedDropTargetDisposable=ot(()=>{o.element.classList.remove("drop-target"),this.compressedDragOverElement=void 0}),o.element.classList.add("drop-target")),typeof a=="boolean"?a:{...a,feedback:[]}):(this.compressedDropTargetDisposable.dispose(),!1)}}}return this.compressedDropTargetDisposable.dispose(),this.handleDragOver(e,t,i,n)}handleDragOver(e,t,i,n){const s=n&&(n.ctrlKey&&!uc||n.altKey&&uc),o=e instanceof WP,a=o||s?0:1;if(o){if(!TG(n,ml.FILES,IC.FILES,ml.RESOURCES))return!1}else{if(e instanceof qX)return!1;{const c=Za.getStatsFromDragAndDropData(e);if(!t)return!s&&c.every(d=>!!d.parent&&d.parent.isRoot)?!1:{accept:!0,bubble:0,effect:a,autoExpand:!1};if(!Array.isArray(c)||!s&&c.every(d=>d.isReadonly)||c.some(d=>d.isRoot&&t instanceof hn&&!t.isRoot||this.uriIdentityService.extUri.isEqual(d.resource,t.resource)?!0:d.isRoot&&t instanceof hn&&t.isRoot?!1:!!(!s&&this.uriIdentityService.extUri.isEqual(pn(d.resource),t.resource)||this.uriIdentityService.extUri.isEqualOrParent(t.resource,d.resource))))return!1}}if(t){if(t.isDirectory)return t.isReadonly?!1:{accept:!0,bubble:0,effect:a,autoExpand:!0};if(this.contextService.getWorkspace().folders.every(c=>c.uri.toString()!==t.resource.toString()))return{accept:!0,bubble:1,effect:a}}else return{accept:!0,bubble:0,effect:a};return!1}getDragURI(e){return this.explorerService.isEditable(e)?null:e.resource.toString()}getDragLabel(e,t){return e.length===1?Za.getCompressedStatFromDragEvent(e[0],t).name:String(e.length)}onDragStart(e,t){const i=Za.getStatsFromDragAndDropData(e,t);if(i&&i.length&&t.dataTransfer){this.instantiationService.invokeFunction(s=>Y$(s,i,t));const n=i.filter(s=>s.resource.scheme===pe.file).map(s=>s.resource.fsPath);n.length&&t.dataTransfer.setData(IC.FILES,JSON.stringify(n))}}async drop(e,t,i,n){if(this.compressedDropTargetDisposable.dispose(),t){const o=Za.getCompressedStatFromDragEvent(t,n);o&&(t=o)}if(t||(t=this.explorerService.roots[this.explorerService.roots.length-1]),!t.isDirectory&&t.parent&&(t=t.parent),t.isReadonly)return;const s=t;if(s)try{e instanceof WP?!ln||r1(this.contextService.getWorkspace())&&kG.supported(window)?await this.instantiationService.createInstance(WO).import(s,n):await this.instantiationService.createInstance(kw).upload(t,n):await this.handleExplorerDrop(e,s,n)}catch(o){this.dialogService.error(La(o))}}async handleExplorerDrop(e,t,i){const n=Za.getStatsFromDragAndDropData(e),s=new Map(n.map(l=>[l,this.isCollapsed(l)]));for(const[l,u]of s)if(u){const h=l.nestedChildren;if(h)for(const g of h)s.set(g,!0)}const o=h1([...s.keys()],l=>l.resource),a=i.ctrlKey&&!uc||i.altKey&&uc;if(!a&&this.configurationService.getValue(Za.CONFIRM_DND_SETTING_KEY)){const l=o.length>1&&o.every(g=>g.isRoot)?p("confirmRootsMove","Are you sure you want to change the order of multiple root folders in your workspace?"):o.length>1?p("confirmMultiMove","Are you sure you want to move the following {0} files into '{1}'?",o.length,t.name):o[0].isRoot?p("confirmRootMove","Are you sure you want to change the order of root folder '{0}' in your workspace?",o[0].name):p("confirmMove","Are you sure you want to move '{0}' into '{1}'?",o[0].name,t.name),u=o.length>1&&!o.every(g=>g.isRoot)?ql(o.map(g=>g.resource)):void 0,h=await this.dialogService.confirm({message:l,detail:u,checkbox:{label:p("doNotAskAgain","Do not ask me again")},primaryButton:p({key:"moveButtonLabel",comment:["&& denotes a mnemonic"]},"&&Move")});if(!h.confirmed)return;h.checkboxChecked===!0&&await this.configurationService.updateValue(Za.CONFIRM_DND_SETTING_KEY,!1)}await this.doHandleRootDrop(o.filter(l=>l.isRoot),t);const d=o.filter(l=>!l.isRoot);return a?this.doHandleExplorerDropOnCopy(d,t):this.doHandleExplorerDropOnMove(d,t)}async doHandleRootDrop(e,t){if(e.length===0)return;const i=this.contextService.getWorkspace().folders;let n;const s=[],o=[];for(let a=0;a<i.length;a++){const c={uri:i[a].uri,name:i[a].name};t instanceof hn&&this.uriIdentityService.extUri.isEqual(i[a].uri,t.resource)&&(n=a),e.every(d=>d.resource.toString()!==i[a].uri.toString())?s.push(c):o.push(c)}return n===void 0&&(n=s.length),s.splice(n,0,...o),this.workspaceEditingService.updateFolders(0,s.length,s)}async doHandleExplorerDropOnCopy(e,t){const i=this.configurationService.getValue().explorer,n=[];for(const{resource:a,isDirectory:c}of e){const d=i.incrementalNaming==="disabled",l=await v6(this.explorerService,this.fileService,this.dialogService,t,{resource:a,isDirectory:c,allowOverwrite:d},i.incrementalNaming);if(!l)continue;const u=new zo(a,l,{copy:!0,overwrite:d});n.push(u)}const s=C2(e);await this.explorerService.applyBulkEdit(n,{confirmBeforeUndo:i.confirmUndo==="default"||i.confirmUndo==="verbose",undoLabel:p("copy","Copy {0}",s),progressLabel:p("copying","Copying {0}",s)});const o=n.filter(a=>{const c=a.newResource?this.explorerService.findClosest(a.newResource):void 0;return c&&!c.isDirectory}).map(a=>({resource:a.newResource,options:{pinned:!0}}));await this.editorService.openEditors(o)}async doHandleExplorerDropOnMove(e,t){const i=e.filter(o=>!o.isReadonly).map(o=>new zo(o.resource,pt(t.resource,o.name))),n=C2(e),s={confirmBeforeUndo:this.configurationService.getValue().explorer.confirmUndo==="verbose",undoLabel:p("move","Move {0}",n),progressLabel:p("moving","Moving {0}",n)};try{await this.explorerService.applyBulkEdit(i,s)}catch(o){if(o.fileOperationResult===4){const a=[];for(const l of i)l.newResource&&await this.fileService.exists(l.newResource)&&a.push(l.newResource);const c=j_e(a),{confirmed:d}=await this.dialogService.confirm(c);d&&await this.explorerService.applyBulkEdit(i.map(l=>new zo(l.oldResource,l.newResource,{overwrite:!0})),s)}else throw o}}static getStatsFromDragAndDropData(e,t){return e.context?e.context:t&&e.elements.length===1?(e.context=[Za.getCompressedStatFromDragEvent(e.elements[0],t)],e.context):e.elements}static getCompressedStatFromDragEvent(e,t){const i=document.elementFromPoint(t.clientX,t.clientY),n=ID(i);if(n){const{count:s,index:o}=n;let a=s-1;for(;a>o&&e.parent;)e=e.parent,a--;return e}return e}onDragEnd(){this.compressedDropTargetDisposable.dispose()}};TD.CONFIRM_DND_SETTING_KEY="explorer.confirmDragAndDrop";TD=T([v(1,mn),v(2,Ke),v(3,ar),v(4,oi),v(5,at),v(6,We),v(7,Te),v(8,Zm),v(9,Hi)],TD);function ID(r){if(!(r instanceof HTMLElement))return null;let e=r;for(;e&&!e.classList.contains("monaco-list-row");){if(e.classList.contains("label-name")&&e.hasAttribute("data-icon-label-count")){const t=Number(e.getAttribute("data-icon-label-count")),i=Number(e.getAttribute("data-icon-label-index"));if(pr(t)&&pr(i))return{element:e,count:t,index:i}}e=e.parentElement}return null}function iwe(r){return!!ID(r)}class nwe{isIncompressible(e){return e.isRoot||!e.isDirectory||e instanceof jT||!e.parent||e.parent.isRoot}}function C2(r){return r.length===1?r[0].name:r.every(e=>e.isDirectory)?p("numberOfFolders","{0} folders",r.length):r.every(e=>!e.isDirectory)?p("numberOfFiles","{0} files",r.length):`${r.length} files and folders`}function rwe(r){if(r.isRoot&&r.error)return{tooltip:p("canNotResolve","Unable to resolve workspace folder ({0})",La(r.error)),letter:"!",color:ZX};if(r.isSymbolicLink)return{tooltip:p("symbolicLlink","Symbolic Link"),letter:"⤷"};if(r.isUnknown)return{tooltip:p("unknown","Unknown File Type"),letter:"?"};if(r.isExcluded)return{color:eJ}}let KO=class{constructor(e,t){this.explorerService=e,this.label=p("label","Explorer"),this._onDidChange=new A,this.toDispose=new me,this.toDispose.add(this._onDidChange),this.toDispose.add(t.onDidChangeWorkspaceFolders(i=>{this._onDidChange.fire(i.changed.concat(i.added).map(n=>n.uri))})),this.toDispose.add(UO.event(i=>{this._onDidChange.fire([i])}))}get onDidChange(){return this._onDidChange.event}async provideDecorations(e){const t=this.explorerService.findClosest(e);if(!t)throw new Error("ExplorerItem not found");return rwe(t)}dispose(){this.toDispose.dispose()}};KO=T([v(0,mn),v(1,oi)],KO);function swe(r,e){for(const t of e)if(r.hasNode(t)&&!r.isCollapsed(t)){for(const[,i]of t.children.entries())if(r.hasNode(i)&&r.isCollapsible(i)&&!r.isCollapsed(i))return!0}return!1}function owe(r,e){for(const t of e)if(r.hasNode(t)&&!r.isCollapsed(t))return!0;return!1}const E2={getId:r=>r instanceof jT?`new:${r.getId()}`:r.getId()};function awe(r,e,t,i){let n;n=r.length?r[0]:void 0,t&&e.length>1&&(n=void 0);const s=n&&i.getCompressedNavigationController(n);n=s?s.current:n;const o=[];for(const a of e){const c=i.getCompressedNavigationController(a);if(c&&n&&c===s){a===n&&o.push(a);continue}c?o.push(...c.items):o.push(a)}return n?t&&o.indexOf(n)>=0?o:[n]:t?o:[]}let Dd=class QO extends pu{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g,m,y,_,b,E,D,R,M,O,L){super(e,l,t,h,u,i,n,L,y,_),this.contextService=s,this.progressService=o,this.editorService=a,this.editorResolverService=c,this.layoutService=d,this.decorationService=g,this.labelService=m,this.explorerService=b,this.storageService=E,this.clipboardService=D,this.fileService=R,this.uriIdentityService=M,this.commandService=O,this.autoReveal=!1,this.delegate=e.delegate,this.resourceContext=n.createInstance(Zs),this._register(this.resourceContext),this.folderContext=tle.bindTo(u),this.readonlyContext=e4.bindTo(u),this.availableEditorIdsContext=ile.bindTo(u),this.rootContext=nle.bindTo(u),this.resourceMoveableToTrash=sle.bindTo(u),this.compressedFocusContext=ale.bindTo(u),this.compressedFocusFirstContext=cle.bindTo(u),this.compressedFocusLastContext=dle.bindTo(u),this.viewHasSomeCollapsibleRootItem=lle.bindTo(u),this.viewVisibleContextKey=m$.bindTo(u),this.explorerService.registerView(this)}get name(){return this.labelService.getWorkspaceLabel(this.contextService.getWorkspace())}get title(){return this.name}set title(e){}setVisible(e){this.viewVisibleContextKey.set(e),super.setVisible(e)}get fileCopiedContextKey(){return B_e.bindTo(this.contextKeyService)}get resourceCutContextKey(){return rle.bindTo(this.contextKeyService)}renderHeader(e){super.renderHeader(e),this.dragHandler=new tJ(e,()=>this.setExpanded(!0));const t=e.querySelector(".title"),i=()=>{const s=this.contextService.getWorkspace().folders.map(o=>o.name).join();t.textContent=this.name,t.title=s,this.ariaHeaderLabel=p("explorerSection","Explorer Section: {0}",this.name),t.setAttribute("aria-label",this.ariaHeaderLabel)};this._register(this.contextService.onDidChangeWorkspaceName(i)),this._register(this.labelService.onDidChangeFormatters(i)),i()}layoutBody(e,t){super.layoutBody(e,t),this.tree.layout(e,t)}renderBody(e){super.renderBody(e),this.container=e,this.treeContainer=Fe(e,Ve(".explorer-folders-view")),this.createTree(this.treeContainer),this._register(this.labelService.onDidChangeFormatters(()=>{this._onDidChangeTitleArea.fire()})),this.onConfigurationUpdated(void 0),this._register(this.editorService.onDidActiveEditorChange(()=>{this.selectActiveFile()})),this._register(this.configurationService.onDidChangeConfiguration(t=>this.onConfigurationUpdated(t))),this._register(this.onDidChangeBodyVisibility(async t=>{t&&(await this.setTreeInput(),this.updateAnyCollapsedContext(),this.selectActiveFile(!0))}))}focus(){this.tree.domFocus();const e=this.tree.getFocus();e.length===1&&this.autoReveal&&this.tree.reveal(e[0],.5)}hasFocus(){return aG(document.activeElement,this.container)}getContext(e){return awe(this.tree.getFocus(),this.tree.getSelection(),e,this.renderer)}isItemVisible(e){return this.filter.filter(e,1)}isItemCollapsed(e){return this.tree.isCollapsed(e)}async setEditable(e,t){t?(this.horizontalScrolling=this.tree.options.horizontalScrolling,this.horizontalScrolling&&this.tree.updateOptions({horizontalScrolling:!1}),await this.tree.expand(e.parent)):(this.horizontalScrolling!==void 0&&this.tree.updateOptions({horizontalScrolling:this.horizontalScrolling}),this.horizontalScrolling=void 0,this.treeContainer.classList.remove("highlight")),await this.refresh(!1,e.parent,!1),t?(this.treeContainer.classList.add("highlight"),this.tree.reveal(e)):this.tree.domFocus()}selectActiveFile(e=this.autoReveal){if(this.autoReveal){const t=Vn.getCanonicalUri(this.editorService.activeEditor,{supportSideBySide:Ui.PRIMARY});if(t){const i=this.tree.getFocus(),n=this.tree.getSelection();if(i.length===1&&this.uriIdentityService.extUri.isEqual(i[0].resource,t)&&n.length===1&&this.uriIdentityService.extUri.isEqual(n[0].resource,t))return;this.explorerService.select(t,e)}}}createTree(e){this.filter=this.instantiationService.createInstance(GO),this._register(this.filter),this._register(this.filter.onDidChange(()=>this.refresh(!0)));const t=this.instantiationService.createInstance(Am,{onDidChangeVisibility:this.onDidChangeBodyVisibility});this._register(t);const i=a=>this.tree.updateWidth(a);this.renderer=this.instantiationService.createInstance(Ww,e,t,i),this._register(this.renderer),this._register(cwe(e,this.themeService));const n=()=>this.configurationService.getValue("explorer.compactFolders"),s=a=>this.configurationService.getValue({resource:a==null?void 0:a.root.resource}).explorer.fileNesting;this.tree=this.instantiationService.createInstance(iJ,"FileExplorer",e,new $w,new nwe,[this.renderer],this.instantiationService.createInstance(VO,this.filter),{compressionEnabled:n(),accessibilityProvider:this.renderer,identityProvider:E2,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:a=>{if(!this.explorerService.isEditable(a))return a.name},getCompressedNodeKeyboardNavigationLabel:a=>{if(!a.some(c=>this.explorerService.isEditable(c)))return a.map(c=>c.name).join("/")}},multipleSelectionSupport:!0,filter:this.filter,sorter:this.instantiationService.createInstance(zO),dnd:this.instantiationService.createInstance(TD,a=>this.isItemCollapsed(a)),collapseByDefault:a=>!(a instanceof hn&&a.hasNests&&s(a).expand),autoExpandSingleChildren:!0,expandOnlyOnTwistieClick:a=>{if(a instanceof hn){if(a.hasNests)return!0;if(this.configurationService.getValue("workbench.tree.expandMode")==="doubleClick")return!0}return!1},additionalScrollHeight:$w.ITEM_HEIGHT,overrideStyles:{listBackground:Gx}}),this._register(this.tree),this._register(this.themeService.onDidColorThemeChange(()=>this.tree.rerender()));const o=F.filter(this.configurationService.onDidChangeConfiguration,a=>a.affectsConfiguration("explorer.compactFolders"));this._register(o(a=>this.tree.updateOptions({compressionEnabled:n()}))),i4.bindTo(this.tree.contextKeyService),v$.bindTo(this.tree.contextKeyService),this._register(this.tree.onDidChangeFocus(a=>this.onFocusChanged(a.elements))),this.onFocusChanged([]),this._register(this.tree.onDidOpen(async a=>{var l,u;const c=a.element;if(!c)return;if(!(a.browserEvent instanceof KeyboardEvent&&a.browserEvent.shiftKey)){if(c.isDirectory||this.explorerService.isEditable(void 0))return;this.telemetryService.publicLog2("workbenchActionExecuted",{id:"workbench.files.openFile",from:"explorer"});try{(l=this.delegate)==null||l.willOpenElement(a.browserEvent),await this.editorService.openEditor({resource:c.resource,options:{preserveFocus:a.editorOptions.preserveFocus,pinned:a.editorOptions.pinned,source:nJ.USER}},a.sideBySide?Ed:Vl)}finally{(u=this.delegate)==null||u.didOpenElement()}}})),this._register(this.tree.onContextMenu(a=>this.onContextMenu(a))),this._register(this.tree.onDidScroll(async a=>{const c=this.explorerService.getEditable();a.scrollTopChanged&&c&&this.tree.getRelativeTop(c.stat)===null&&await c.data.onFinish("",!1)})),this._register(this.tree.onDidChangeCollapseState(a=>{var d;const c=(d=a.node.element)==null?void 0:d.element;if(c){const l=this.renderer.getCompressedNavigationController(c instanceof Array?c[0]:c);l==null||l.updateCollapsed(a.node.collapsed)}this.updateAnyCollapsedContext()})),this.updateAnyCollapsedContext(),this._register(this.tree.onMouseDblClick(a=>{const c=this.configurationService.getValue("workbench.list.scrollByPage");a.element===null&&!c&&this.commandService.executeCommand(hW)})),this._register(this.storageService.onWillSaveState(()=>{this.storageService.store(QO.TREE_VIEW_STATE_STORAGE_KEY,JSON.stringify(this.tree.getViewState()),1,1)}))}onConfigurationUpdated(e){var t;if(!e||e.affectsConfiguration("explorer.autoReveal")){const i=this.configurationService.getValue();this.autoReveal=(t=i==null?void 0:i.explorer)==null?void 0:t.autoReveal}e&&(e.affectsConfiguration("explorer.decorations.colors")||e.affectsConfiguration("explorer.decorations.badges"))&&this.refresh(!0)}setContextKeys(e){const t=this.contextService.getWorkspace().folders,i=e?e.resource:t[t.length-1].uri;if(e=e||this.explorerService.findClosest(i),this.resourceContext.set(i),this.folderContext.set(!!e&&e.isDirectory),this.readonlyContext.set(!!e&&!!e.isReadonly),this.rootContext.set(!!e&&e.isRoot),i){const n=i?this.editorResolverService.getEditors(i).map(s=>s.id):[];this.availableEditorIdsContext.set(n.join(","))}else this.availableEditorIdsContext.reset()}async onContextMenu(e){if(rJ(e.browserEvent.target))return;const t=e.element;let i=e.anchor;if(t){const a=this.renderer.getCompressedNavigationController(t);a&&(e.browserEvent instanceof KeyboardEvent||iwe(e.browserEvent.target)?i=a.labels[a.index]:a.last())}this.fileCopiedContextKey.set(await this.clipboardService.hasResources()),this.setContextKeys(t);const n=this.tree.getSelection(),s=this.explorerService.roots;let o;if(t instanceof hn){const a=this.renderer.getCompressedNavigationController(t);o=a?a.current.resource:t.resource}else o=s.length===1?s[0].resource:{};this.contextMenuService.showContextMenu({menuId:Ee.ExplorerContext,menuActionOptions:{arg:o,shouldForwardArgs:!0},contextKeyService:this.tree.contextKeyService,getAnchor:()=>i,onHide:a=>{a&&this.tree.domFocus()},getActionsContext:()=>t&&n&&n.indexOf(t)>=0?n.map(a=>a.resource):t instanceof hn?[t.resource]:[]})}onFocusChanged(e){const t=e&&e.length?e[0]:void 0;if(this.setContextKeys(t),t){const n=this.configurationService.getValue().files.enableTrash,s=this.fileService.hasCapability(t.resource,4096);this.resourceMoveableToTrash.set(n&&s)}else this.resourceMoveableToTrash.reset();const i=t&&this.renderer.getCompressedNavigationController(t);if(!i){this.compressedFocusContext.set(!1);return}this.compressedFocusContext.set(!0),this.updateCompressedNavigationContextKeys(i)}refresh(e,t,i=!0){if(!this.tree||!this.isBodyVisible()||t&&!this.tree.hasNode(t))return Promise.resolve(void 0);i&&this.explorerService.isEditable(void 0)&&this.tree.domFocus();const n=t||this.tree.getInput();return this.tree.updateChildren(n,e,!1,{diffIdentityProvider:E2})}getOptimalWidth(){const e=this.tree.getHTMLElement(),t=[].slice.call(e.querySelectorAll(".explorer-item .label-name"));return IG(e,t)}async setTreeInput(){if(!this.isBodyVisible())return Promise.resolve(void 0);const e=!this.tree.getInput();e&&qt("code/willResolveExplorer");const t=this.explorerService.roots;let i=t[0];(this.contextService.getWorkbenchState()!==2||t[0].error)&&(i=t);let n;if(this.tree&&this.tree.getInput())n=this.tree.getViewState();else{const a=this.storageService.get(QO.TREE_VIEW_STATE_STORAGE_KEY,1);a&&(n=JSON.parse(a))}const s=this.tree.getInput(),o=this.tree.setInput(i,n).then(async()=>{if(Array.isArray(i)){if(!n||s instanceof hn)for(let a=0;a<Math.min(i.length,5);a++)try{await this.tree.expand(i[a])}catch{}if(!s&&i.length===1&&this.configurationService.getValue().explorer.expandSingleFolderWorkspaces&&await this.tree.expand(i[0]).catch(()=>{}),Array.isArray(s)){const a=new ki;s.forEach(c=>a.set(c.resource,!0)),await Promise.all(i.map(async c=>{if(!a.has(c.resource))try{await this.tree.expand(c)}catch{}}))}}e&&qt("code/didResolveExplorer")});this.progressService.withProgress({location:1,delay:this.layoutService.isRestored()?800:1500},a=>o),await o,this.decorationsProvider||(this.decorationsProvider=new KO(this.explorerService,this.contextService),this._register(this.decorationService.registerDecorationsProvider(this.decorationsProvider)))}async selectResource(e,t=this.autoReveal,i=0){if(i===2||!e||!this.isBodyVisible())return;let n=this.explorerService.findClosestRoot(e);for(;n&&n.resource.toString()!==e.toString();){try{await this.tree.expand(n)}catch{return this.selectResource(e,t,i+1)}for(const s of n.children.values()){if(this.uriIdentityService.extUri.isEqualOrParent(e,s.resource)){n=s;break}n=null}}if(n){if(n===this.tree.getInput()){this.tree.setFocus([]),this.tree.setSelection([]);return}try{n.nestedParent&&await this.tree.expand(n.nestedParent),(t===!0||t==="force")&&this.tree.getRelativeTop(n)===null&&this.tree.reveal(n,.5),this.tree.setFocus([n]),this.tree.setSelection([n])}catch{return this.selectResource(e,t,i+1)}}}itemsCopied(e,t,i){this.fileCopiedContextKey.set(e.length>0),this.resourceCutContextKey.set(t&&e.length>0),i==null||i.forEach(n=>this.tree.rerender(n)),t&&e.forEach(n=>this.tree.rerender(n))}expandAll(){this.explorerService.isEditable(void 0)&&this.tree.domFocus(),this.tree.expandAll()}collapseAll(){this.explorerService.isEditable(void 0)&&this.tree.domFocus();const e=this.tree.getInput();if(Array.isArray(e)&&swe(this.tree,e)){e.forEach(t=>{t.children.forEach(i=>this.tree.hasNode(i)&&this.tree.collapse(i,!0))});return}this.tree.collapseAll()}previousCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;const t=this.renderer.getCompressedNavigationController(e[0]);t.previous(),this.updateCompressedNavigationContextKeys(t)}nextCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;const t=this.renderer.getCompressedNavigationController(e[0]);t.next(),this.updateCompressedNavigationContextKeys(t)}firstCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;const t=this.renderer.getCompressedNavigationController(e[0]);t.first(),this.updateCompressedNavigationContextKeys(t)}lastCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;const t=this.renderer.getCompressedNavigationController(e[0]);t.last(),this.updateCompressedNavigationContextKeys(t)}updateCompressedNavigationContextKeys(e){this.compressedFocusFirstContext.set(e.index===0),this.compressedFocusLastContext.set(e.index===e.count-1)}updateAnyCollapsedContext(){const e=this.tree.getInput();if(e===void 0)return;const t=Array.isArray(e)?e:Array.from(e.children.values());this.viewHasSomeCollapsibleRootItem.set(owe(this.tree,t))}dispose(){var e;(e=this.dragHandler)==null||e.dispose(),super.dispose()}};Dd.TREE_VIEW_STATE_STORAGE_KEY="workbench.explorer.treeViewState";Dd.__decorator=T([xt],Dd.prototype,"fileCopiedContextKey",null);Dd.__decorator=T([xt],Dd.prototype,"resourceCutContextKey",null);Dd=T([v(1,eo),v(2,to),v(3,Te),v(4,oi),v(5,kc),v(6,Ke),v(7,lb),v(8,Kf),v(9,Ts),v(10,It),v(11,We),v(12,Su),v(13,Qi),v(14,Fi),v(15,gi),v(16,mn),v(17,ri),v(18,Vm),v(19,at),v(20,Hi),v(21,un),v(22,us)],Dd);function cwe(r,e){r.classList.add("file-icon-themable-tree"),r.classList.add("show-file-icons");const t=i=>{r.classList.toggle("align-icons-and-twisties",i.hasFileIcons&&!i.hasFolderIcons),r.classList.toggle("hide-arrows",i.hidesExplorerArrows===!0)};return t(e.getFileIconTheme()),e.onDidFileIconThemeChange(t)}Nt(class extends Le{constructor(){super({id:"workbench.files.action.createFileFromExplorer",title:p("createNewFile","New File..."),f1:!1,icon:jt.newFile,precondition:t4,menu:{id:Ee.ViewTitle,group:"navigation",when:nt.equals("view",Qs),order:10}})}run(r){r.get(un).executeCommand(hW)}});Nt(class extends Le{constructor(){super({id:"workbench.files.action.createFolderFromExplorer",title:p("createNewFolder","New Folder..."),f1:!1,icon:jt.newFolder,precondition:t4,menu:{id:Ee.ViewTitle,group:"navigation",when:nt.equals("view",Qs),order:20}})}run(r){r.get(un).executeCommand(f6)}});Nt(class extends Le{constructor(){super({id:"workbench.files.action.refreshFilesExplorer",title:{value:p("refreshExplorer","Refresh Explorer"),original:"Refresh Explorer"},f1:!0,icon:jt.refresh,menu:{id:Ee.ViewTitle,group:"navigation",when:nt.equals("view",Qs),order:30}})}async run(r){const e=r.get(Jm),t=r.get(mn);await e.openPaneComposite(z_,0),await t.refresh()}});Nt(class extends Le{constructor(){super({id:"workbench.files.action.collapseExplorerFolders",title:{value:p("collapseExplorerFolders","Collapse Folders in Explorer"),original:"Collapse Folders in Explorer"},f1:!0,icon:jt.collapseAll,menu:{id:Ee.ViewTitle,group:"navigation",when:nt.equals("view",Qs),order:40}})}run(r){const t=r.get(ko).getViewWithId(Qs);t!==null&&t.collapseAll()}});let eu=class b6 extends pu{constructor(e,t,i,n,s,o,a,c,d,l,u,h){super(e,s,o,c,l,i,n,u,t,h),this.contextService=a,this.labelService=d,this._disposed=!1,this._register(this.contextService.onDidChangeWorkbenchState(()=>this.refreshTitle())),this._register(this.labelService.onDidChangeFormatters(()=>this.refreshTitle()))}shouldShowWelcome(){return!0}renderBody(e){super.renderBody(e),this._register(new RC(e,{onDrop:t=>{e.style.backgroundColor="",this.instantiationService.createInstance(Kx,{allowWorkspaceOpen:!ln||r1(this.contextService.getWorkspace())}).handleDrop(t,()=>{},()=>{})},onDragEnter:()=>{const t=this.themeService.getColorTheme().getColor(sJ);e.style.backgroundColor=t?t.toString():""},onDragEnd:()=>{e.style.backgroundColor=""},onDragLeave:()=>{e.style.backgroundColor=""},onDragOver:t=>{t.dataTransfer&&(t.dataTransfer.dropEffect="copy")}})),this.refreshTitle()}refreshTitle(){this._disposed||(this.contextService.getWorkbenchState()===3?this.updateTitle(b6.NAME):this.updateTitle(this.title))}dispose(){this._disposed=!0,super.dispose()}};eu.ID="workbench.explorer.emptyView";eu.NAME=p("noWorkspace","No Folder Opened");eu=T([v(1,Fi),v(2,to),v(3,Te),v(4,Ts),v(5,eo),v(6,oi),v(7,We),v(8,Qi),v(9,It),v(10,us),v(11,gi)],eu);var dwe='.open-editors .monaco-list .monaco-list-row.dirty>.monaco-action-bar,.open-editors .monaco-list .monaco-list-row.focused>.monaco-action-bar,.open-editors .monaco-list .monaco-list-row.sticky>.monaco-action-bar,.open-editors .monaco-list .monaco-list-row:hover>.monaco-action-bar{visibility:visible}.open-editors .monaco-list .monaco-list-row>.monaco-action-bar .action-label{display:block;padding:2px}.open-editors .monaco-list .monaco-list-row>.monaco-action-bar .codicon{color:inherit}.open-editors .monaco-list .monaco-list-row.dirty:not(:hover)>.monaco-action-bar .codicon-pinned:before{content:"\\ebb2"}.open-editors .monaco-list .monaco-list-row.dirty:not(:hover)>.monaco-action-bar .codicon-close:before{content:"\\ea71"}.open-editors .monaco-list .monaco-list-row>.monaco-action-bar .action-close-all-files,.open-editors .monaco-list .monaco-list-row>.monaco-action-bar .save-all{height:22px;width:23px}.open-editors .monaco-list .monaco-list-row>.editor-group,.open-editors .monaco-list .monaco-list-row>.open-editor{flex:1}.open-editors .monaco-list .monaco-list-row{display:flex;padding-left:22px}.open-editors .monaco-list .monaco-list-row>.monaco-action-bar{align-items:center;display:flex;visibility:hidden}.open-editors .monaco-list .monaco-list-row .editor-group{cursor:default;font-size:11px;font-weight:700;text-transform:uppercase}.composite:lang(ja) .open-editors .monaco-list .monaco-list-row .editor-group,.composite:lang(ko) .open-editors .monaco-list .monaco-list-row .editor-group,.composite:lang(zh-Hans) .open-editors .monaco-list .monaco-list-row .editor-group,.composite:lang(zh-Hant) .open-editors .monaco-list .monaco-list-row .editor-group{font-weight:400}.open-editors .editor-group,.open-editors .open-editor{height:22px;line-height:22px}.open-editors .editor-group,.open-editors .open-editor>a{overflow:hidden;text-overflow:ellipsis}.monaco-workbench.hc-black .open-editors .editor-group,.monaco-workbench.hc-black .open-editors .open-editor,.monaco-workbench.hc-light .open-editors .editor-group,.monaco-workbench.hc-light .open-editors .open-editor{line-height:20px}';Ic(dwe,{});class Vi extends Le{constructor(e,t,i){super(e),this.commandId=t,this.commandArgs=i}run(e){return e.get(un).executeCommand(this.commandId,this.commandArgs)}}class S6 extends Le{getDirection(e){return Vf(e)}async run(e,t){const i=e.get(it),n=e.get(We);h6(i,this.getDirection(n),t)}}class pW extends S6{constructor(){super({id:pW.ID,title:{value:p("splitEditor","Split Editor"),original:"Split Editor"},f1:!0,keybinding:{weight:200,primary:2141},category:ye.View})}}pW.ID="workbench.action.splitEditor";class Q$e extends S6{constructor(){super({id:"workbench.action.splitEditorOrthogonal",title:{value:p("splitEditorOrthogonal","Split Editor Orthogonal"),original:"Split Editor Orthogonal"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2141)},category:ye.View})}getDirection(e){return Vf(e)===3?1:3}}class Y$e extends Vi{constructor(){super({id:OO,title:{value:p("splitEditorGroupLeft","Split Editor Left"),original:"Split Editor Left"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2141)},category:ye.View},OO)}}class X$e extends Vi{constructor(){super({id:NO,title:{value:p("splitEditorGroupRight","Split Editor Right"),original:"Split Editor Right"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2141)},category:ye.View},NO)}}class lwe extends Vi{constructor(){super({id:LO,title:{value:p("splitEditorGroupUp","Split Editor Up"),original:"Split Editor Up"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2141)},category:ye.View},LO)}}lwe.LABEL=p("splitEditorGroupUp","Split Editor Up");class uwe extends Vi{constructor(){super({id:FO,title:{value:p("splitEditorGroupDown","Split Editor Down"),original:"Split Editor Down"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2141)},category:ye.View},FO)}}uwe.LABEL=p("splitEditorGroupDown","Split Editor Down");class J$e extends Le{constructor(){super({id:"workbench.action.joinTwoGroups",title:{value:p("joinTwoGroups","Join Editor Group with Next Group"),original:"Join Editor Group with Next Group"},f1:!0,category:ye.View})}async run(e,t){const i=e.get(it);let n;if(t&&typeof t.groupId=="number"?n=i.getGroup(t.groupId):n=i.activeGroup,n){const s=[3,1,2,0];for(const o of s){const a=i.findGroup({direction:o},n);if(a&&n!==a){i.mergeGroup(n,a);break}}}}}class Z$e extends Le{constructor(){super({id:"workbench.action.joinAllGroups",title:{value:p("joinAllGroups","Join All Editor Groups"),original:"Join All Editor Groups"},f1:!0,category:ye.View})}async run(e){e.get(it).mergeAllGroups()}}class eWe extends Le{constructor(){super({id:"workbench.action.navigateEditorGroups",title:{value:p("navigateEditorGroups","Navigate Between Editor Groups"),original:"Navigate Between Editor Groups"},f1:!0,category:ye.View})}async run(e){const t=e.get(it),i=t.findGroup({location:2},t.activeGroup,!0);i==null||i.focus()}}class tWe extends Le{constructor(){super({id:"workbench.action.focusActiveEditorGroup",title:{value:p("focusActiveEditorGroup","Focus Active Editor Group"),original:"Focus Active Editor Group"},f1:!0,category:ye.View})}async run(e){e.get(it).activeGroup.focus()}}class Du extends Le{constructor(e,t){super(e),this.scope=t}async run(e){const t=e.get(it),i=t.findGroup(this.scope,t.activeGroup,!0);i==null||i.focus()}}class iWe extends Du{constructor(){super({id:"workbench.action.focusFirstEditorGroup",title:{value:p("focusFirstEditorGroup","Focus First Editor Group"),original:"Focus First Editor Group"},f1:!0,keybinding:{weight:200,primary:2070},category:ye.View},{location:0})}}class nWe extends Du{constructor(){super({id:"workbench.action.focusLastEditorGroup",title:{value:p("focusLastEditorGroup","Focus Last Editor Group"),original:"Focus Last Editor Group"},f1:!0,category:ye.View},{location:1})}}class rWe extends Du{constructor(){super({id:"workbench.action.focusNextGroup",title:{value:p("focusNextGroup","Focus Next Editor Group"),original:"Focus Next Editor Group"},f1:!0,category:ye.View},{location:2})}}class sWe extends Du{constructor(){super({id:"workbench.action.focusPreviousGroup",title:{value:p("focusPreviousGroup","Focus Previous Editor Group"),original:"Focus Previous Editor Group"},f1:!0,category:ye.View},{location:3})}}class oWe extends Du{constructor(){super({id:"workbench.action.focusLeftGroup",title:{value:p("focusLeftGroup","Focus Left Editor Group"),original:"Focus Left Editor Group"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2063)},category:ye.View},{direction:2})}}class aWe extends Du{constructor(){super({id:"workbench.action.focusRightGroup",title:{value:p("focusRightGroup","Focus Right Editor Group"),original:"Focus Right Editor Group"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2065)},category:ye.View},{direction:3})}}class cWe extends Du{constructor(){super({id:"workbench.action.focusAboveGroup",title:{value:p("focusAboveGroup","Focus Editor Group Above"),original:"Focus Editor Group Above"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2064)},category:ye.View},{direction:0})}}class dWe extends Du{constructor(){super({id:"workbench.action.focusBelowGroup",title:{value:p("focusBelowGroup","Focus Editor Group Below"),original:"Focus Editor Group Below"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2066)},category:ye.View},{direction:1})}}let Yh=class extends Zn{constructor(e,t,i){super(e,t,Si.asClassName(jt.close)),this.commandService=i}run(e){return this.commandService.executeCommand(a6,void 0,e)}};Yh.ID="workbench.action.closeActiveEditor";Yh.LABEL=p("closeEditor","Close Editor");Yh=T([v(2,un)],Yh);let Xh=class extends Zn{constructor(e,t,i){super(e,t,Si.asClassName(jt.pinned)),this.commandService=i}run(e){return this.commandService.executeCommand(c6,void 0,e)}};Xh.ID="workbench.action.unpinActiveEditor";Xh.LABEL=p("unpinEditor","Unpin Editor");Xh=T([v(2,un)],Xh);let RD=class extends Zn{constructor(e,t,i){super(e,t,Si.asClassName(jt.close)),this.editorGroupService=i}async run(e){let t,i;if(e&&(t=this.editorGroupService.getGroup(e.groupId),t&&(i=e.editorIndex)),t||(t=this.editorGroupService.activeGroup),typeof i=="number"){const n=t.getEditorByIndex(i);if(n){await t.closeEditor(n,{preserveFocus:e==null?void 0:e.preserveFocus});return}}if(t.activeEditor){await t.closeEditor(t.activeEditor,{preserveFocus:e==null?void 0:e.preserveFocus});return}}};RD.ID="workbench.action.closeActiveEditor";RD.LABEL=p("closeOneEditor","Close");RD=T([v(2,it)],RD);class fWe extends Le{constructor(){super({id:"workbench.action.revertAndCloseActiveEditor",title:{value:p("revertAndCloseActiveEditor","Revert and Close Editor"),original:"Revert and Close Editor"},f1:!0,category:ye.View})}async run(e){const t=e.get(Ke),i=e.get(ze),n=t.activeEditorPane;if(n){const s=n.input,o=n.group;try{await t.revert({editor:s,groupId:o.id})}catch(a){i.error(a),await t.revert({editor:s,groupId:o.id},{soft:!0})}await o.closeEditor(s)}}}class pWe extends Le{constructor(){super({id:"workbench.action.closeEditorsToTheLeft",title:{value:p("closeEditorsToTheLeft","Close Editors to the Left in Group"),original:"Close Editors to the Left in Group"},f1:!0,category:ye.View})}async run(e,t){const i=e.get(it),{group:n,editor:s}=this.getTarget(i,t);n&&s&&await n.closeEditors({direction:0,except:s,excludeSticky:!0})}getTarget(e,t){return t?{editor:t.editor,group:e.getGroup(t.groupId)}:{group:e.activeGroup,editor:e.activeGroup.activeEditor}}}class C6 extends Le{groupsToClose(e){const t=[],i=e.getGroups(2);for(let n=i.length-1;n>=0;n--)t.push(i[n]);return t}async run(e){var l,u,h,g;const t=e.get(Ke),i=e.get(it),n=e.get(qr),s=e.get(ia),o=new Set,a=new Set,c=new Set,d=new Map;for(const{editor:m,groupId:y}of t.getEditors(1,{excludeSticky:this.excludeSticky})){let _=!1;if(m.closeHandler?_=m.closeHandler.showConfirm():_=m.isDirty()&&!m.isSaving(),!!_)if(typeof((l=m.closeHandler)==null?void 0:l.confirm)=="function"){let b=d.get(m.typeId);b||(b=new Set,d.set(m.typeId,b)),b.add({editor:m,groupId:y})}else n.getAutoSaveMode()===3&&!m.hasCapability(4)?a.add({editor:m,groupId:y}):d1&&(wa||ck)&&n.getAutoSaveMode()===4&&!m.hasCapability(4)?c.add({editor:m,groupId:y}):o.add({editor:m,groupId:y})}if(o.size>0){const m=Array.from(o.values());switch(await this.revealEditorsToConfirm(m,i),await s.showSaveConfirm(m.map(({editor:_})=>_ instanceof ns?_.primary.getName():_.getName()))){case 2:return;case 1:await t.revert(m,{soft:!0});break;case 0:await t.save(m,{reason:1});break}}for(const[,m]of d){const y=Array.from(m.values());await this.revealEditorsToConfirm(y,i);const _=await((g=(h=(u=Zh(y))==null?void 0:u.editor.closeHandler)==null?void 0:h.confirm)==null?void 0:g.call(h,y));if(typeof _=="number")switch(_){case 2:return;case 1:await t.revert(y,{soft:!0});break;case 0:await t.save(y,{reason:1});break}}if(a.size>0){const m=Array.from(a.values());await t.save(m,{reason:3})}if(c.size>0){const m=Array.from(c.values());await t.save(m,{reason:4})}return this.doCloseAll(i)}async revealEditorsToConfirm(e,t){try{const i=new Set;for(const{editor:n,groupId:s}of e){if(i.has(s))continue;i.add(s);const o=t.getGroup(s);await(o==null?void 0:o.openEditor(n))}}catch{}}async doCloseAll(e){await Promise.all(this.groupsToClose(e).map(t=>t.closeAllEditors({excludeSticky:this.excludeSticky})))}}class Hw extends C6{constructor(){super({id:Hw.ID,title:Hw.LABEL,f1:!0,keybinding:{weight:200,primary:Bt(2089,2101)},icon:jt.closeAll,category:ye.View})}get excludeSticky(){return!0}}Hw.ID="workbench.action.closeAllEditors";Hw.LABEL={value:p("closeAllEditors","Close All Editors"),original:"Close All Editors"};class gWe extends C6{constructor(){super({id:"workbench.action.closeAllGroups",title:{value:p("closeAllGroups","Close All Editor Groups"),original:"Close All Editor Groups"},f1:!0,keybinding:{weight:200,primary:Bt(2089,3125)},category:ye.View})}get excludeSticky(){return!1}async doCloseAll(e){await super.doCloseAll(e);for(const t of this.groupsToClose(e))e.removeGroup(t)}}class mWe extends Le{constructor(){super({id:"workbench.action.closeEditorsInOtherGroups",title:{value:p("closeEditorsInOtherGroups","Close Editors in Other Groups"),original:"Close Editors in Other Groups"},f1:!0,category:ye.View})}async run(e,t){const i=e.get(it),n=t?i.getGroup(t.groupId):i.activeGroup;await Promise.all(i.getGroups(1).map(async s=>{if(!(n&&s.id===n.id))return s.closeAllEditors({excludeSticky:!0})}))}}class vWe extends Le{constructor(){super({id:"workbench.action.closeEditorInAllGroups",title:{value:p("closeEditorInAllGroups","Close Editor in All Groups"),original:"Close Editor in All Groups"},f1:!0,category:ye.View})}async run(e){const t=e.get(Ke),i=e.get(it),n=t.activeEditor;n&&await Promise.all(i.getGroups(1).map(s=>s.closeEditor(n)))}}class E6 extends Le{constructor(e,t,i){super(e),this.direction=t,this.isMove=i}async run(e,t){const i=e.get(it);let n;if(t&&typeof t.groupId=="number"?n=i.getGroup(t.groupId):n=i.activeGroup,n){let s;if(this.isMove){const o=this.findTargetGroup(i,n);o&&(s=i.moveGroup(n,o,this.direction))}else s=i.copyGroup(n,n,this.direction);s&&i.activateGroup(s)}}findTargetGroup(e,t){const i=[this.direction];switch(this.direction){case 2:case 3:i.push(0,1);break;case 0:case 1:i.push(2,3);break}for(const n of i){const s=e.findGroup({direction:n},t);if(s)return s}}}class vI extends E6{constructor(e,t){super(e,t,!0)}}class yWe extends vI{constructor(){super({id:"workbench.action.moveActiveEditorGroupLeft",title:{value:p("moveActiveGroupLeft","Move Editor Group Left"),original:"Move Editor Group Left"},f1:!0,keybinding:{weight:200,primary:Bt(2089,15)},category:ye.View},2)}}class _We extends vI{constructor(){super({id:"workbench.action.moveActiveEditorGroupRight",title:{value:p("moveActiveGroupRight","Move Editor Group Right"),original:"Move Editor Group Right"},f1:!0,keybinding:{weight:200,primary:Bt(2089,17)},category:ye.View},3)}}class wWe extends vI{constructor(){super({id:"workbench.action.moveActiveEditorGroupUp",title:{value:p("moveActiveGroupUp","Move Editor Group Up"),original:"Move Editor Group Up"},f1:!0,keybinding:{weight:200,primary:Bt(2089,16)},category:ye.View},0)}}class bWe extends vI{constructor(){super({id:"workbench.action.moveActiveEditorGroupDown",title:{value:p("moveActiveGroupDown","Move Editor Group Down"),original:"Move Editor Group Down"},f1:!0,keybinding:{weight:200,primary:Bt(2089,18)},category:ye.View},1)}}class yI extends E6{constructor(e,t){super(e,t,!1)}}class SWe extends yI{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupLeft",title:{value:p("duplicateActiveGroupLeft","Duplicate Editor Group Left"),original:"Duplicate Editor Group Left"},f1:!0,category:ye.View},2)}}class CWe extends yI{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupRight",title:{value:p("duplicateActiveGroupRight","Duplicate Editor Group Right"),original:"Duplicate Editor Group Right"},f1:!0,category:ye.View},3)}}class EWe extends yI{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupUp",title:{value:p("duplicateActiveGroupUp","Duplicate Editor Group Up"),original:"Duplicate Editor Group Up"},f1:!0,category:ye.View},0)}}class xWe extends yI{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupDown",title:{value:p("duplicateActiveGroupDown","Duplicate Editor Group Down"),original:"Duplicate Editor Group Down"},f1:!0,category:ye.View},1)}}class DWe extends Le{constructor(){super({id:"workbench.action.minimizeOtherEditors",title:{value:p("minimizeOtherEditorGroups","Maximize Editor Group"),original:"Maximize Editor Group"},f1:!0,category:ye.View})}async run(e){e.get(it).arrangeGroups(0)}}class kWe extends Le{constructor(){super({id:"workbench.action.evenEditorWidths",title:{value:p("evenEditorGroups","Reset Editor Group Sizes"),original:"Reset Editor Group Sizes"},f1:!0,category:ye.View})}async run(e){e.get(it).arrangeGroups(1)}}class TWe extends Le{constructor(){super({id:"workbench.action.toggleEditorWidths",title:{value:p("toggleEditorWidths","Toggle Editor Group Sizes"),original:"Toggle Editor Group Sizes"},f1:!0,category:ye.View})}async run(e){e.get(it).arrangeGroups(2)}}class IWe extends Le{constructor(){super({id:"workbench.action.maximizeEditor",title:{value:p("maximizeEditor","Maximize Editor Group and Hide Side Bars"),original:"Maximize Editor Group and Hide Side Bars"},f1:!0,category:ye.View})}async run(e){const t=e.get(Kf),i=e.get(it);e.get(Ke).activeEditor&&(t.setPartHidden(!0,"workbench.parts.sidebar"),t.setPartHidden(!0,"workbench.parts.auxiliarybar"),i.arrangeGroups(0))}}class sv extends Le{async run(e){const t=e.get(it),i=this.navigate(t);if(!i)return;const{groupId:n,editor:s}=i;if(!s)return;const o=t.getGroup(n);o&&await o.openEditor(s)}}class RWe extends sv{constructor(){super({id:"workbench.action.nextEditor",title:{value:p("openNextEditor","Open Next Editor"),original:"Open Next Editor"},f1:!0,keybinding:{weight:200,primary:2060,mac:{primary:2577,secondary:[3166]}},category:ye.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(1),n=t.activeEditor?i.indexOf(t.activeEditor):-1;if(n+1<i.length)return{editor:i[n+1],groupId:t.id};const s=new Set;let o=e.activeGroup;for(;o&&!s.has(o.id);)if(o=e.findGroup({location:2},o,!0),o){s.add(o.id);const a=o.getEditors(1);if(a.length>0)return{editor:a[0],groupId:o.id}}}}class PWe extends sv{constructor(){super({id:"workbench.action.previousEditor",title:{value:p("openPreviousEditor","Open Previous Editor"),original:"Open Previous Editor"},f1:!0,keybinding:{weight:200,primary:2059,mac:{primary:2575,secondary:[3164]}},category:ye.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(1),n=t.activeEditor?i.indexOf(t.activeEditor):-1;if(n>0)return{editor:i[n-1],groupId:t.id};const s=new Set;let o=e.activeGroup;for(;o&&!s.has(o.id);)if(o=e.findGroup({location:3},o,!0),o){s.add(o.id);const a=o.getEditors(1);if(a.length>0)return{editor:a[a.length-1],groupId:o.id}}}}class AWe extends sv{constructor(){super({id:"workbench.action.nextEditorInGroup",title:{value:p("nextEditorInGroup","Open Next Editor in Group"),original:"Open Next Editor in Group"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2060),mac:{primary:Bt(2089,2577)}},category:ye.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(1),n=t.activeEditor?i.indexOf(t.activeEditor):-1;return{editor:n+1<i.length?i[n+1]:i[0],groupId:t.id}}}class MWe extends sv{constructor(){super({id:"workbench.action.previousEditorInGroup",title:{value:p("openPreviousEditorInGroup","Open Previous Editor in Group"),original:"Open Previous Editor in Group"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2059),mac:{primary:Bt(2089,2575)}},category:ye.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(1),n=t.activeEditor?i.indexOf(t.activeEditor):-1;return{editor:n>0?i[n-1]:i[i.length-1],groupId:t.id}}}class LWe extends sv{constructor(){super({id:"workbench.action.firstEditorInGroup",title:{value:p("firstEditorInGroup","Open First Editor in Group"),original:"Open First Editor in Group"},f1:!0,category:ye.View})}navigate(e){const t=e.activeGroup;return{editor:t.getEditors(1)[0],groupId:t.id}}}class FWe extends sv{constructor(){super({id:"workbench.action.lastEditorInGroup",title:{value:p("lastEditorInGroup","Open Last Editor in Group"),original:"Open Last Editor in Group"},f1:!0,keybinding:{weight:200,primary:533,secondary:[2078],mac:{primary:277,secondary:[2078]}},category:ye.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(1);return{editor:i[i.length-1],groupId:t.id}}}class _I extends Le{constructor(){super({id:_I.ID,title:{value:p("navigateForward","Go Forward"),original:"Go Forward",mnemonicTitle:p({key:"miForward",comment:["&& denotes a mnemonic"]},"&&Forward")},f1:!0,icon:jt.arrowRight,precondition:nt.has("canNavigateForward"),keybinding:{weight:200,win:{primary:529},mac:{primary:1368},linux:{primary:3160}},menu:[{id:Ee.MenubarGoMenu,group:"1_history_nav",order:2},{id:Ee.CommandCenter,order:2}]})}async run(e){await e.get(_r).goForward(0)}}_I.ID="workbench.action.navigateForward";_I.LABEL=p("navigateForward","Go Forward");class wI extends Le{constructor(){super({id:wI.ID,title:{value:p("navigateBack","Go Back"),original:"Go Back",mnemonicTitle:p({key:"miBack",comment:["&& denotes a mnemonic"]},"&&Back")},f1:!0,precondition:nt.has("canNavigateBack"),icon:jt.arrowLeft,keybinding:{weight:200,win:{primary:527},mac:{primary:344},linux:{primary:2648}},menu:[{id:Ee.MenubarGoMenu,group:"1_history_nav",order:1},{id:Ee.CommandCenter,order:1}]})}async run(e){await e.get(_r).goBack(0)}}wI.ID="workbench.action.navigateBack";wI.LABEL=p("navigateBack","Go Back");class OWe extends Le{constructor(){super({id:"workbench.action.navigateLast",title:{value:p("navigatePrevious","Go Previous"),original:"Go Previous"},f1:!0})}async run(e){await e.get(_r).goPrevious(0)}}class NWe extends Le{constructor(){super({id:"workbench.action.navigateForwardInEditLocations",title:{value:p("navigateForwardInEdits","Go Forward in Edit Locations"),original:"Go Forward in Edit Locations"},f1:!0})}async run(e){await e.get(_r).goForward(1)}}class $We extends Le{constructor(){super({id:"workbench.action.navigateBackInEditLocations",title:{value:p("navigateBackInEdits","Go Back in Edit Locations"),original:"Go Back in Edit Locations"},f1:!0})}async run(e){await e.get(_r).goBack(1)}}class WWe extends Le{constructor(){super({id:"workbench.action.navigatePreviousInEditLocations",title:{value:p("navigatePreviousInEdits","Go Previous in Edit Locations"),original:"Go Previous in Edit Locations"},f1:!0})}async run(e){await e.get(_r).goPrevious(1)}}class HWe extends Le{constructor(){super({id:"workbench.action.navigateToLastEditLocation",title:{value:p("navigateToLastEditLocation","Go to Last Edit Location"),original:"Go to Last Edit Location"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2095)}})}async run(e){await e.get(_r).goLast(1)}}class jWe extends Le{constructor(){super({id:"workbench.action.navigateForwardInNavigationLocations",title:{value:p("navigateForwardInNavigations","Go Forward in Navigation Locations"),original:"Go Forward in Navigation Locations"},f1:!0})}async run(e){await e.get(_r).goForward(2)}}class BWe extends Le{constructor(){super({id:"workbench.action.navigateBackInNavigationLocations",title:{value:p("navigateBackInNavigations","Go Back in Navigation Locations"),original:"Go Back in Navigation Locations"},f1:!0})}async run(e){await e.get(_r).goBack(2)}}class UWe extends Le{constructor(){super({id:"workbench.action.navigatePreviousInNavigationLocations",title:{value:p("navigatePreviousInNavigationLocations","Go Previous in Navigation Locations"),original:"Go Previous in Navigation Locations"},f1:!0})}async run(e){await e.get(_r).goPrevious(2)}}class VWe extends Le{constructor(){super({id:"workbench.action.navigateToLastNavigationLocation",title:{value:p("navigateToLastNavigationLocation","Go to Last Navigation Location"),original:"Go to Last Navigation Location"},f1:!0})}async run(e){await e.get(_r).goLast(2)}}class gW extends Le{constructor(){super({id:gW.ID,title:{value:p("reopenClosedEditor","Reopen Closed Editor"),original:"Reopen Closed Editor"},f1:!0,keybinding:{weight:200,primary:3122},category:ye.View})}async run(e){await e.get(_r).reopenLastClosedEditor()}}gW.ID="workbench.action.reopenClosedEditor";class mW extends Le{constructor(){super({id:mW.ID,title:{value:p("clearRecentFiles","Clear Recently Opened"),original:"Clear Recently Opened"},f1:!0,category:ye.File})}async run(e){const t=e.get(ar),i=e.get(c$),n=e.get(_r),{confirmed:s}=await t.confirm({type:"warning",message:p("confirmClearRecentsMessage","Do you want to clear all recently opened files and workspaces?"),detail:p("confirmClearDetail","This action is irreversible!"),primaryButton:p({key:"clearButtonLabel",comment:["&& denotes a mnemonic"]},"&&Clear")});s&&(i.clearRecentlyOpened(),n.clearRecentlyOpened())}}mW.ID="workbench.action.clearRecentFiles";class vW extends Le{constructor(){super({id:vW.ID,title:{value:p("showEditorsInActiveGroup","Show Editors in Active Group By Most Recently Used"),original:"Show Editors in Active Group By Most Recently Used"},f1:!0,category:ye.View})}async run(e){e.get(ss).quickAccess.show(kf.PREFIX)}}vW.ID="workbench.action.showEditorsInActiveGroup";class yW extends Le{constructor(){super({id:yW.ID,title:{value:p("showAllEditors","Show All Editors By Appearance"),original:"Show All Editors By Appearance"},f1:!0,keybinding:{weight:200,primary:Bt(2089,2094),mac:{primary:2562}},category:ye.File})}async run(e){e.get(ss).quickAccess.show(DD.PREFIX)}}yW.ID="workbench.action.showAllEditors";class _W extends Le{constructor(){super({id:_W.ID,title:{value:p("showAllEditorsByMostRecentlyUsed","Show All Editors By Most Recently Used"),original:"Show All Editors By Most Recently Used"},f1:!0,category:ye.View})}async run(e){e.get(ss).quickAccess.show(Fm.PREFIX)}}_W.ID="workbench.action.showAllEditorsByMostRecentlyUsed";class bI extends Le{constructor(e,t,i){super(e),this.prefix=t,this.itemActivation=i}async run(e){const t=e.get(Ts),i=e.get(ss),n=t.lookupKeybindings(this.desc.id);i.quickAccess.show(this.prefix,{quickNavigateConfiguration:{keybindings:n},itemActivation:this.itemActivation})}}class qWe extends bI{constructor(){super({id:"workbench.action.quickOpenPreviousRecentlyUsedEditor",title:{value:p("quickOpenPreviousRecentlyUsedEditor","Quick Open Previous Recently Used Editor"),original:"Quick Open Previous Recently Used Editor"},f1:!0,category:ye.View},Fm.PREFIX,void 0)}}class GWe extends bI{constructor(){super({id:"workbench.action.quickOpenLeastRecentlyUsedEditor",title:{value:p("quickOpenLeastRecentlyUsedEditor","Quick Open Least Recently Used Editor"),original:"Quick Open Least Recently Used Editor"},f1:!0,category:ye.View},Fm.PREFIX,void 0)}}class zWe extends bI{constructor(){super({id:"workbench.action.quickOpenPreviousRecentlyUsedEditorInGroup",title:{value:p("quickOpenPreviousRecentlyUsedEditorInGroup","Quick Open Previous Recently Used Editor in Group"),original:"Quick Open Previous Recently Used Editor in Group"},f1:!0,keybinding:{weight:200,primary:2050,mac:{primary:258}},precondition:Q$.toNegated(),category:ye.View},kf.PREFIX,void 0)}}class KWe extends bI{constructor(){super({id:"workbench.action.quickOpenLeastRecentlyUsedEditorInGroup",title:{value:p("quickOpenLeastRecentlyUsedEditorInGroup","Quick Open Least Recently Used Editor in Group"),original:"Quick Open Least Recently Used Editor in Group"},f1:!0,keybinding:{weight:200,primary:3074,mac:{primary:1282}},precondition:Q$.toNegated(),category:ye.View},kf.PREFIX,u1.LAST)}}class PD extends Le{constructor(){super({id:PD.ID,title:{value:p("navigateEditorHistoryByInput","Quick Open Previous Editor from History"),original:"Quick Open Previous Editor from History"},f1:!0})}async run(e){const t=e.get(Ts),i=e.get(ss),n=e.get(it),s=t.lookupKeybindings(PD.ID);let o;n.activeGroup.count===0&&(o=u1.FIRST),i.quickAccess.show("",{quickNavigateConfiguration:{keybindings:s},itemActivation:o})}}PD.ID="workbench.action.openPreviousEditorFromHistory";class QWe extends Le{constructor(){super({id:"workbench.action.openNextRecentlyUsedEditor",title:{value:p("openNextRecentlyUsedEditor","Open Next Recently Used Editor"),original:"Open Next Recently Used Editor"},f1:!0,category:ye.View})}async run(e){e.get(_r).openNextRecentlyUsedEditor()}}class YWe extends Le{constructor(){super({id:"workbench.action.openPreviousRecentlyUsedEditor",title:{value:p("openPreviousRecentlyUsedEditor","Open Previous Recently Used Editor"),original:"Open Previous Recently Used Editor"},f1:!0,category:ye.View})}async run(e){e.get(_r).openPreviouslyUsedEditor()}}class XWe extends Le{constructor(){super({id:"workbench.action.openNextRecentlyUsedEditorInGroup",title:{value:p("openNextRecentlyUsedEditorInGroup","Open Next Recently Used Editor In Group"),original:"Open Next Recently Used Editor In Group"},f1:!0,category:ye.View})}async run(e){const t=e.get(_r),i=e.get(it);t.openNextRecentlyUsedEditor(i.activeGroup.id)}}class JWe extends Le{constructor(){super({id:"workbench.action.openPreviousRecentlyUsedEditorInGroup",title:{value:p("openPreviousRecentlyUsedEditorInGroup","Open Previous Recently Used Editor In Group"),original:"Open Previous Recently Used Editor In Group"},f1:!0,category:ye.View})}async run(e){const t=e.get(_r),i=e.get(it);t.openPreviouslyUsedEditor(i.activeGroup.id)}}class ZWe extends Le{constructor(){super({id:"workbench.action.clearEditorHistory",title:{value:p("clearEditorHistory","Clear Editor History"),original:"Clear Editor History"},f1:!0})}async run(e){const t=e.get(ar),i=e.get(_r),{confirmed:n}=await t.confirm({type:"warning",message:p("confirmClearEditorHistoryMessage","Do you want to clear the history of recently opened editors?"),detail:p("confirmClearDetail","This action is irreversible!"),primaryButton:p({key:"clearButtonLabel",comment:["&& denotes a mnemonic"]},"&&Clear")});n&&i.clear()}}class eHe extends Vi{constructor(){super({id:"workbench.action.moveEditorLeftInGroup",title:{value:p("moveEditorLeft","Move Editor Left"),original:"Move Editor Left"},keybinding:{weight:200,primary:3083,mac:{primary:Bt(2089,3087)}},f1:!0,category:ye.View},Ha,{to:"left"})}}class tHe extends Vi{constructor(){super({id:"workbench.action.moveEditorRightInGroup",title:{value:p("moveEditorRight","Move Editor Right"),original:"Move Editor Right"},keybinding:{weight:200,primary:3084,mac:{primary:Bt(2089,3089)}},f1:!0,category:ye.View},Ha,{to:"right"})}}class iHe extends Vi{constructor(){super({id:"workbench.action.moveEditorToPreviousGroup",title:{value:p("moveEditorToPreviousGroup","Move Editor into Previous Group"),original:"Move Editor into Previous Group"},keybinding:{weight:200,primary:2575,mac:{primary:2319}},f1:!0,category:ye.View},Ha,{to:"previous",by:"group"})}}class nHe extends Vi{constructor(){super({id:"workbench.action.moveEditorToNextGroup",title:{value:p("moveEditorToNextGroup","Move Editor into Next Group"),original:"Move Editor into Next Group"},f1:!0,keybinding:{weight:200,primary:2577,mac:{primary:2321}},category:ye.View},Ha,{to:"next",by:"group"})}}class rHe extends Vi{constructor(){super({id:"workbench.action.moveEditorToAboveGroup",title:{value:p("moveEditorToAboveGroup","Move Editor into Group Above"),original:"Move Editor into Group Above"},f1:!0,category:ye.View},Ha,{to:"up",by:"group"})}}class sHe extends Vi{constructor(){super({id:"workbench.action.moveEditorToBelowGroup",title:{value:p("moveEditorToBelowGroup","Move Editor into Group Below"),original:"Move Editor into Group Below"},f1:!0,category:ye.View},Ha,{to:"down",by:"group"})}}class oHe extends Vi{constructor(){super({id:"workbench.action.moveEditorToLeftGroup",title:{value:p("moveEditorToLeftGroup","Move Editor into Left Group"),original:"Move Editor into Left Group"},f1:!0,category:ye.View},Ha,{to:"left",by:"group"})}}class aHe extends Vi{constructor(){super({id:"workbench.action.moveEditorToRightGroup",title:{value:p("moveEditorToRightGroup","Move Editor into Right Group"),original:"Move Editor into Right Group"},f1:!0,category:ye.View},Ha,{to:"right",by:"group"})}}class cHe extends Vi{constructor(){super({id:"workbench.action.moveEditorToFirstGroup",title:{value:p("moveEditorToFirstGroup","Move Editor into First Group"),original:"Move Editor into First Group"},f1:!0,keybinding:{weight:200,primary:1558,mac:{primary:2326}},category:ye.View},Ha,{to:"first",by:"group"})}}class dHe extends Vi{constructor(){super({id:"workbench.action.moveEditorToLastGroup",title:{value:p("moveEditorToLastGroup","Move Editor into Last Group"),original:"Move Editor into Last Group"},f1:!0,keybinding:{weight:200,primary:1566,mac:{primary:2334}},category:ye.View},Ha,{to:"last",by:"group"})}}class lHe extends Vi{constructor(){super({id:"workbench.action.splitEditorToPreviousGroup",title:{value:p("splitEditorToPreviousGroup","Split Editor into Previous Group"),original:"Split Editor into Previous Group"},f1:!0,category:ye.View},Hd,{to:"previous",by:"group"})}}class uHe extends Vi{constructor(){super({id:"workbench.action.splitEditorToNextGroup",title:{value:p("splitEditorToNextGroup","Split Editor into Next Group"),original:"Split Editor into Next Group"},f1:!0,category:ye.View},Hd,{to:"next",by:"group"})}}class hHe extends Vi{constructor(){super({id:"workbench.action.splitEditorToAboveGroup",title:{value:p("splitEditorToAboveGroup","Split Editor into Group Above"),original:"Split Editor into Group Above"},f1:!0,category:ye.View},Hd,{to:"up",by:"group"})}}class fHe extends Vi{constructor(){super({id:"workbench.action.splitEditorToBelowGroup",title:{value:p("splitEditorToBelowGroup","Split Editor into Group Below"),original:"Split Editor into Group Below"},f1:!0,category:ye.View},Hd,{to:"down",by:"group"})}}class x6 extends Vi{constructor(){super({id:"workbench.action.splitEditorToLeftGroup",title:{value:p("splitEditorToLeftGroup","Split Editor into Left Group"),original:"Split Editor into Left Group"},f1:!0,category:ye.View},Hd,{to:"left",by:"group"})}}x6.ID="workbench.action.splitEditorToLeftGroup";x6.LABEL=p("splitEditorToLeftGroup","Split Editor into Left Group");class pHe extends Vi{constructor(){super({id:"workbench.action.splitEditorToRightGroup",title:{value:p("splitEditorToRightGroup","Split Editor into Right Group"),original:"Split Editor into Right Group"},f1:!0,category:ye.View},Hd,{to:"right",by:"group"})}}class gHe extends Vi{constructor(){super({id:"workbench.action.splitEditorToFirstGroup",title:{value:p("splitEditorToFirstGroup","Split Editor into First Group"),original:"Split Editor into First Group"},f1:!0,category:ye.View},Hd,{to:"first",by:"group"})}}class mHe extends Vi{constructor(){super({id:"workbench.action.splitEditorToLastGroup",title:{value:p("splitEditorToLastGroup","Split Editor into Last Group"),original:"Split Editor into Last Group"},f1:!0,category:ye.View},Hd,{to:"last",by:"group"})}}class wW extends Vi{constructor(){super({id:wW.ID,title:{value:p("editorLayoutSingle","Single Column Editor Layout"),original:"Single Column Editor Layout"},f1:!0,category:ye.View},jd,{groups:[{}]})}}wW.ID="workbench.action.editorLayoutSingle";class bW extends Vi{constructor(){super({id:bW.ID,title:{value:p("editorLayoutTwoColumns","Two Columns Editor Layout"),original:"Two Columns Editor Layout"},f1:!0,category:ye.View},jd,{groups:[{},{}],orientation:0})}}bW.ID="workbench.action.editorLayoutTwoColumns";class SW extends Vi{constructor(){super({id:SW.ID,title:{value:p("editorLayoutThreeColumns","Three Columns Editor Layout"),original:"Three Columns Editor Layout"},f1:!0,category:ye.View},jd,{groups:[{},{},{}],orientation:0})}}SW.ID="workbench.action.editorLayoutThreeColumns";class CW extends Vi{constructor(){super({id:CW.ID,title:{value:p("editorLayoutTwoRows","Two Rows Editor Layout"),original:"Two Rows Editor Layout"},f1:!0,category:ye.View},jd,{groups:[{},{}],orientation:1})}}CW.ID="workbench.action.editorLayoutTwoRows";class EW extends Vi{constructor(){super({id:EW.ID,title:{value:p("editorLayoutThreeRows","Three Rows Editor Layout"),original:"Three Rows Editor Layout"},f1:!0,category:ye.View},jd,{groups:[{},{},{}],orientation:1})}}EW.ID="workbench.action.editorLayoutThreeRows";class xW extends Vi{constructor(){super({id:xW.ID,title:{value:p("editorLayoutTwoByTwoGrid","Grid Editor Layout (2x2)"),original:"Grid Editor Layout (2x2)"},f1:!0,category:ye.View},jd,{groups:[{groups:[{},{}]},{groups:[{},{}]}]})}}xW.ID="workbench.action.editorLayoutTwoByTwoGrid";class DW extends Vi{constructor(){super({id:DW.ID,title:{value:p("editorLayoutTwoColumnsBottom","Two Columns Bottom Editor Layout"),original:"Two Columns Bottom Editor Layout"},f1:!0,category:ye.View},jd,{groups:[{},{groups:[{},{}]}],orientation:1})}}DW.ID="workbench.action.editorLayoutTwoColumnsBottom";class kW extends Vi{constructor(){super({id:kW.ID,title:{value:p("editorLayoutTwoRowsRight","Two Rows Right Editor Layout"),original:"Two Rows Right Editor Layout"},f1:!0,category:ye.View},jd,{groups:[{},{groups:[{},{}]}],orientation:0})}}kW.ID="workbench.action.editorLayoutTwoRowsRight";class SI extends Le{constructor(e,t){super(e),this.direction=t}async run(e){const t=e.get(it);t.addGroup(t.activeGroup,this.direction,{activate:!0})}}class vHe extends SI{constructor(){super({id:"workbench.action.newGroupLeft",title:{value:p("newGroupLeft","New Editor Group to the Left"),original:"New Editor Group to the Left"},f1:!0,category:ye.View},2)}}class yHe extends SI{constructor(){super({id:"workbench.action.newGroupRight",title:{value:p("newGroupRight","New Editor Group to the Right"),original:"New Editor Group to the Right"},f1:!0,category:ye.View},3)}}class _He extends SI{constructor(){super({id:"workbench.action.newGroupAbove",title:{value:p("newGroupAbove","New Editor Group Above"),original:"New Editor Group Above"},f1:!0,category:ye.View},0)}}class wHe extends SI{constructor(){super({id:"workbench.action.newGroupBelow",title:{value:p("newGroupBelow","New Editor Group Below"),original:"New Editor Group Below"},f1:!0,category:ye.View},1)}}class bHe extends Le{constructor(){super({id:"workbench.action.toggleEditorType",title:{value:p("toggleEditorType","Toggle Editor Type"),original:"Toggle Editor Type"},f1:!0,category:ye.View,precondition:v8})}async run(e){const t=e.get(Ke),i=e.get(lb),n=t.activeEditorPane;if(!n)return;const s=Vn.getCanonicalUri(n.input);if(!s)return;const o=i.getEditors(s).map(a=>a.id).filter(a=>a!==n.input.editorId);o.length!==0&&await t.replaceEditors([{editor:n.input,replacement:{resource:s,options:{override:o[0]}}}],n.group)}}class SHe extends Le{constructor(){super({id:"workbench.action.reopenTextEditor",title:{value:p("reopenTextEditor","Reopen Editor With Text Editor"),original:"Reopen Editor With Text Editor"},f1:!0,category:ye.View,precondition:v8})}async run(e){const t=e.get(Ke),i=t.activeEditorPane;if(!i)return;const n=Vn.getCanonicalUri(i.input);n&&await t.replaceEditors([{editor:i.input,replacement:{resource:n,options:{override:fd.id}}}],i.group)}}const AD=Ve;let vc=class dC extends pu{constructor(e,t,i,n,s,o,a,c,d,l,u,h,g){super(e,a,n,o,c,i,t,g,d,l),this.editorGroupService=s,this.workingCopyService=u,this.filesConfigurationService=h,this.needsRefresh=!1,this.elements=[],this.structuralRefreshDelay=0,this.sortOrder=o.getValue("explorer.openEditors.sortOrder"),this.registerUpdateEvents(),this._register(this.configurationService.onDidChangeConfiguration(m=>this.onConfigurationChange(m))),this._register(this.workingCopyService.onDidChangeDirty(m=>this.updateDirtyIndicator(m)))}registerUpdateEvents(){const e=()=>{var n;if(!this.isBodyVisible()||!this.list){this.needsRefresh=!0;return}(n=this.listRefreshScheduler)==null||n.schedule(this.structuralRefreshDelay)},t=new Map,i=n=>{const s=n.onDidModelChange(o=>{var c;if((c=this.listRefreshScheduler)!=null&&c.isScheduled())return;if(!this.isBodyVisible()||!this.list){this.needsRefresh=!0;return}const a=this.getIndex(n,o.editor);switch(o.kind){case 6:case 0:this.focusActiveEditor();break;case 1:a>=0&&this.list.splice(a,1,[n]);break;case 11:case 10:case 8:case 9:case 7:this.list.splice(a,1,[new rn(o.editor,n)]),this.focusActiveEditor();break;case 3:case 5:case 4:e();break}});t.set(n.id,s),this._register(t.get(n.id))};this.editorGroupService.groups.forEach(n=>i(n)),this._register(this.editorGroupService.onDidAddGroup(n=>{i(n),e()})),this._register(this.editorGroupService.onDidMoveGroup(()=>e())),this._register(this.editorGroupService.onDidRemoveGroup(n=>{vt(t.get(n.id)),e()}))}renderHeaderTitle(e){super.renderHeaderTitle(e,this.title);const t=Fe(e,AD(".count"));this.dirtyCountElement=Fe(t,AD(".dirty-count.monaco-count-badge.long")),this.dirtyCountElement.style.backgroundColor=es(eG),this.dirtyCountElement.style.color=es(tG),this.dirtyCountElement.style.border=`1px solid ${es(yt)}`,this.updateDirtyIndicator()}renderBody(e){super.renderBody(e),e.classList.add("open-editors"),e.classList.add("show-file-icons");const t=new Ny;this.list&&this.list.dispose(),this.listLabels&&this.listLabels.clear(),this.listLabels=this.instantiationService.createInstance(Am,{onDidChangeVisibility:this.onDidChangeBodyVisibility}),this.list=this.instantiationService.createInstance(oJ,"OpenEditors",e,t,[new MD(this.keybindingService,this.instantiationService),new LD(this.listLabels,this.instantiationService,this.keybindingService,this.configurationService)],{identityProvider:{getId:s=>s instanceof rn?s.getId():s.id.toString()},dnd:new YO(this.instantiationService,this.editorGroupService),overrideStyles:{listBackground:this.getBackgroundColor()},accessibilityProvider:new fwe}),this._register(this.list),this._register(this.listLabels);let i=[];this.listRefreshScheduler=this._register(new Ys(()=>{if(!this.list)return;i=vt(i);const s=this.list.length,o=this.getElements();this.list.splice(0,this.list.length,o),this.focusActiveEditor(),s!==this.list.length&&this.updateSize(),this.needsRefresh=!1,(this.sortOrder==="alphabetical"||this.sortOrder==="fullPath")&&o.forEach(a=>{a instanceof rn&&i.push(a.editor.onDidChangeLabel(()=>{var c;return(c=this.listRefreshScheduler)==null?void 0:c.schedule()}))})},this.structuralRefreshDelay)),this.updateSize(),ole.bindTo(this.list.contextKeyService),v$.bindTo(this.list.contextKeyService),this.resourceContext=this.instantiationService.createInstance(Zs),this._register(this.resourceContext),this.groupFocusedContext=qye.bindTo(this.contextKeyService),this.dirtyEditorFocusedContext=Gye.bindTo(this.contextKeyService),this.readonlyEditorFocusedContext=zye.bindTo(this.contextKeyService),this._register(this.list.onContextMenu(s=>this.onListContextMenu(s))),this.list.onDidChangeFocus(s=>{this.resourceContext.reset(),this.groupFocusedContext.reset(),this.dirtyEditorFocusedContext.reset(),this.readonlyEditorFocusedContext.reset();const o=s.elements.length?s.elements[0]:void 0;if(o instanceof rn){const a=o.getResource();this.dirtyEditorFocusedContext.set(o.editor.isDirty()&&!o.editor.isSaving()),this.readonlyEditorFocusedContext.set(!!o.editor.isReadonly()),this.resourceContext.set(ol(a))}else o&&this.groupFocusedContext.set(!0)}),this._register(this.list.onMouseMiddleClick(s=>{s&&s.element instanceof rn&&s.element.group.closeEditor(s.element.editor,{preserveFocus:!0})})),this._register(this.list.onDidOpen(s=>{if(s.element)if(s.element instanceof rn){if(s.browserEvent instanceof MouseEvent&&s.browserEvent.button===1)return;this.openEditor(s.element,{preserveFocus:s.editorOptions.preserveFocus,pinned:s.editorOptions.pinned,sideBySide:s.sideBySide})}else this.editorGroupService.activateGroup(s.element);else return})),this.listRefreshScheduler.schedule(0),this._register(this.onDidChangeBodyVisibility(s=>{var o;s&&this.needsRefresh&&((o=this.listRefreshScheduler)==null||o.schedule(0))}));const n=this.viewDescriptorService.getViewContainerModel(this.viewDescriptorService.getViewContainerByViewId(this.id));this._register(n.onDidChangeAllViewDescriptors(()=>{this.updateSize()}))}focus(){super.focus(),this.list.domFocus()}getList(){return this.list}layoutBody(e,t){var i;super.layoutBody(e,t),(i=this.list)==null||i.layout(e,t)}get showGroups(){return this.editorGroupService.groups.length>1}getElements(){return this.elements=[],this.editorGroupService.getGroups(2).forEach(e=>{this.showGroups&&this.elements.push(e);let t=e.editors.map(i=>new rn(i,e));this.sortOrder==="alphabetical"?t=t.sort((i,n)=>HP(i.editor.getName(),n.editor.getName())):this.sortOrder==="fullPath"&&(t=t.sort((i,n)=>{const s=i.editor.resource,o=n.editor.resource;if(s===void 0&&o===void 0)return HP(i.editor.getName(),n.editor.getName());if(s===void 0)return-1;if(o===void 0)return 1;{const a=s.scheme,c=o.scheme;return a!==pe.file&&c!==pe.file?bC.compare(s,o):a!==pe.file?-1:c!==pe.file?1:bC.compare(s,o)}})),this.elements.push(...t)}),this.elements}getIndex(e,t){return t?this.elements.findIndex(i=>i instanceof rn&&i.editor===t&&i.group.id===e.id):this.elements.findIndex(i=>!(i instanceof rn)&&i.id===e.id)}openEditor(e,t){e&&(this.telemetryService.publicLog2("workbenchActionExecuted",{id:"workbench.files.openFile",from:"openEditors"}),t.sideBySide&&t.preserveFocus||this.editorGroupService.activateGroup(e.group),(t.sideBySide?this.editorGroupService.sideGroup:this.editorGroupService.activeGroup).openEditor(e.editor,t))}onListContextMenu(e){if(!e.element)return;const t=e.element;this.contextMenuService.showContextMenu({menuId:Ee.OpenEditorsContext,menuActionOptions:{shouldForwardArgs:!0,arg:t instanceof rn?Vn.getOriginalUri(t.editor):{}},contextKeyService:this.list.contextKeyService,getAnchor:()=>e.anchor,getActionsContext:()=>t instanceof rn?{groupId:t.groupId,editorIndex:t.group.getIndexOfEditor(t.editor)}:{groupId:t.id}})}focusActiveEditor(){if(this.list.length&&this.editorGroupService.activeGroup){const e=this.getIndex(this.editorGroupService.activeGroup,this.editorGroupService.activeGroup.activeEditor);if(e>=0){try{this.list.setFocus([e]),this.list.setSelection([e]),this.list.reveal(e)}catch{}return}}this.list.setFocus([]),this.list.setSelection([])}onConfigurationChange(e){var t;e.affectsConfiguration("explorer.openEditors")&&this.updateSize(),(e.affectsConfiguration("explorer.decorations")||e.affectsConfiguration("explorer.openEditors.sortOrder"))&&(this.sortOrder=this.configurationService.getValue("explorer.openEditors.sortOrder"),(t=this.listRefreshScheduler)==null||t.schedule())}updateSize(){this.minimumBodySize=this.orientation===0?this.getMinExpandedBodySize():170,this.maximumBodySize=this.orientation===0?this.getMaxExpandedBodySize():Number.POSITIVE_INFINITY}updateDirtyIndicator(e){if(e&&e.isDirty()&&!(e.capabilities&2)&&this.filesConfigurationService.getAutoSaveMode()===1)return;const t=this.workingCopyService.dirtyCount;t===0?this.dirtyCountElement.classList.add("hidden"):(this.dirtyCountElement.textContent=p("dirtyCounter","{0} unsaved",t),this.dirtyCountElement.classList.remove("hidden"))}get elementCount(){return this.editorGroupService.groups.map(e=>e.count).reduce((e,t)=>e+t,this.showGroups?this.editorGroupService.groups.length:0)}getMaxExpandedBodySize(){let e=this.configurationService.getValue("explorer.openEditors.minVisible");return typeof e!="number"&&(e=dC.DEFAULT_MIN_VISIBLE_OPEN_EDITORS),this.viewDescriptorService.getViewContainerModel(this.viewDescriptorService.getViewContainerByViewId(this.id)).visibleViewDescriptors.length<=1?Number.POSITIVE_INFINITY:Math.max(this.elementCount,e)*Ny.ITEM_HEIGHT}getMinExpandedBodySize(){let e=this.configurationService.getValue("explorer.openEditors.visible");return typeof e!="number"&&(e=dC.DEFAULT_VISIBLE_OPEN_EDITORS),this.computeMinExpandedBodySize(e)}computeMinExpandedBodySize(e=dC.DEFAULT_VISIBLE_OPEN_EDITORS){return Math.min(Math.max(e,1),this.elementCount)*Ny.ITEM_HEIGHT}setStructuralRefreshDelay(e){this.structuralRefreshDelay=e}getOptimalWidth(){const e=this.list.getHTMLElement(),t=[].slice.call(e.querySelectorAll(".open-editor > a"));return IG(e,t)}};vc.DEFAULT_VISIBLE_OPEN_EDITORS=9;vc.DEFAULT_MIN_VISIBLE_OPEN_EDITORS=0;vc.ID="workbench.explorer.openEditorsView";vc.NAME=p({key:"openEditors",comment:["Open is an adjective"]},"Open Editors");vc=T([v(1,Te),v(2,to),v(3,eo),v(4,it),v(5,We),v(6,Ts),v(7,It),v(8,Fi),v(9,gi),v(10,Od),v(11,qr),v(12,us)],vc);class hwe extends tb{async run(e){if(this.editor)return super.run(e,{groupId:this.editor.groupId,editorIndex:this.editor.group.getIndexOfEditor(this.editor.editor)})}}const YD=class YD{getHeight(e){return YD.ITEM_HEIGHT}getTemplateId(e){return e instanceof rn?LD.ID:MD.ID}};mi(YD,"ITEM_HEIGHT",22);let Ny=YD;const XD=class XD{constructor(e,t){this.keybindingService=e,this.instantiationService=t}get templateId(){return XD.ID}renderTemplate(e){const t=Object.create(null);t.root=Fe(e,AD(".editor-group")),t.name=Fe(t.root,AD("span.name")),t.actionBar=new Sk(e);const i=this.instantiationService.createInstance(Oy,Oy.ID,Oy.LABEL),n=this.keybindingService.lookupKeybinding(i.id);t.actionBar.push(i,{icon:!0,label:!1,keybinding:n?n.getLabel():void 0});const s=this.instantiationService.createInstance(Kh,Kh.ID,Kh.LABEL),o=this.keybindingService.lookupKeybinding(s.id);return t.actionBar.push(s,{icon:!0,label:!1,keybinding:o?o.getLabel():void 0}),t}renderElement(e,t,i){i.editorGroup=e,i.name.textContent=e.label,i.actionBar.context={groupId:e.id}}disposeTemplate(e){e.actionBar.dispose()}};mi(XD,"ID","editorgroup");let MD=XD;const JD=class JD{constructor(e,t,i,n){this.labels=e,this.instantiationService=t,this.keybindingService=i,this.configurationService=n,this.closeEditorAction=this.instantiationService.createInstance(Yh,Yh.ID,Yh.LABEL),this.unpinEditorAction=this.instantiationService.createInstance(Xh,Xh.ID,Xh.LABEL)}get templateId(){return JD.ID}renderTemplate(e){const t=Object.create(null);return t.container=e,t.actionRunner=new hwe,t.actionBar=new Sk(e,{actionRunner:t.actionRunner}),t.root=this.labels.create(e),t}renderElement(e,t,i){var o;const n=e.editor;i.actionRunner.editor=e,i.container.classList.toggle("dirty",n.isDirty()&&!n.isSaving()),i.container.classList.toggle("sticky",e.isSticky()),i.root.setResource({resource:Vn.getOriginalUri(n,{supportSideBySide:Ui.BOTH}),name:n.getName(),description:n.getDescription(1)},{italic:e.isPreview(),extraClasses:["open-editor"].concat(e.editor.getLabelExtraClasses()),fileDecorations:this.configurationService.getValue().explorer.decorations,title:n.getTitle(2)});const s=e.isSticky()?this.unpinEditorAction:this.closeEditorAction;i.actionBar.hasAction(s)||(i.actionBar.isEmpty()||i.actionBar.clear(),i.actionBar.push(s,{icon:!0,label:!1,keybinding:(o=this.keybindingService.lookupKeybinding(s.id))==null?void 0:o.getLabel()}))}disposeTemplate(e){e.actionBar.dispose(),e.root.dispose(),e.actionRunner.dispose()}};mi(JD,"ID","openeditor");let LD=JD;class YO{constructor(e,t){this.instantiationService=e,this.editorGroupService=t}get dropHandler(){return this.instantiationService.createInstance(Kx,{allowWorkspaceOpen:!1})}getDragURI(e){if(e instanceof rn){const t=e.getResource();if(t)return t.toString()}return null}getDragLabel(e){if(e.length>1)return String(e.length);const t=e[0];return t instanceof rn?t.editor.getName():t.label}onDragStart(e,t){const i=e.elements,n=[];if(i)for(const s of i)s instanceof rn&&n.push(s);n.length&&this.instantiationService.invokeFunction(Y$,n,t)}onDragOver(e,t,i,n){return e instanceof WP?TG(n,ml.FILES,IC.FILES):!0}drop(e,t,i,n){const s=t instanceof rn?t.group:t||this.editorGroupService.groups[this.editorGroupService.count-1],o=t instanceof rn?t.group.getIndexOfEditor(t.editor):0;e instanceof aJ?(e.elements.forEach((c,d)=>{c.group.moveEditor(c.editor,s,{index:o+d,preserveFocus:!0})}),this.editorGroupService.activateGroup(s)):this.dropHandler.handleDrop(n,()=>s,()=>s.focus(),o)}}YO.__decorator=T([xt],YO.prototype,"dropHandler",null);class fwe{getWidgetAriaLabel(){return p("openEditors","Open Editors")}getAriaLabel(e){return e instanceof rn?`${e.editor.getName()}, ${e.editor.getDescription()}`:e.ariaLabel}}const pwe="workbench.action.toggleEditorGroupLayout";Un.appendMenuItem(Ee.MenubarLayoutMenu,{group:"4_flip",command:{id:pwe,title:{original:"Flip Layout",value:p("miToggleEditorLayoutWithoutMnemonic","Flip Layout"),mnemonicTitle:p({key:"miToggleEditorLayout",comment:["&& denotes a mnemonic"]},"Flip &&Layout")}},order:1});const gwe="addRootFolder",mwe={value:p("addFolderToWorkspace","Add Folder to Workspace..."),original:"Add Folder to Workspace..."},vwe="setRootFolder",ywe="_workbench.pickWorkspaceFolder",D6={value:p("workspaces","Workspaces"),original:"Workspaces"};class TW extends Le{constructor(){super({id:TW.ID,title:{value:p("openFile","Open File..."),original:"Open File..."},category:ye.File,f1:!0,precondition:RG.toNegated(),keybinding:{weight:200,primary:2093}})}async run(e,t){return e.get(ia).pickFileAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}TW.ID="workbench.action.files.openFile";class CI extends Le{constructor(){super({id:CI.ID,title:{value:p("openFolder","Open Folder..."),original:"Open Folder..."},category:ye.File,f1:!0,precondition:K$,keybinding:{weight:200,primary:void 0,linux:{primary:Bt(2089,2093)},win:{primary:Bt(2089,2093)}}})}async run(e,t){return e.get(ia).pickFolderAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}CI.ID="workbench.action.files.openFolder";class IW extends Le{constructor(){super({id:IW.ID,title:{value:p("openFolder","Open Folder..."),original:"Open Folder..."},category:ye.File,f1:!0,precondition:nt.and(K$.toNegated(),gw.isEqualTo("workspace")),keybinding:{weight:200,primary:2093}})}run(e){return e.get(un).executeCommand(vwe)}}IW.ID="workbench.action.files.openFolderViaWorkspace";class Om extends Le{constructor(){super({id:Om.ID,title:Om.LABEL,category:ye.File,f1:!0,precondition:nt.and(RG,K$),keybinding:{weight:200,primary:2093}})}async run(e,t){return e.get(ia).pickFileFolderAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}Om.ID="workbench.action.files.openFileFolder";Om.LABEL={value:p("openFileFolder","Open..."),original:"Open..."};class RW extends Le{constructor(){super({id:RW.ID,title:mwe,category:D6,f1:!0,precondition:nt.or(m8,gw.isEqualTo("workspace"))})}run(e){return e.get(un).executeCommand(gwe)}}RW.ID="workbench.action.addRootFolder";class PW extends Le{constructor(){super({id:PW.ID,title:{value:p("globalRemoveFolderFromWorkspace","Remove Folder from Workspace..."),original:"Remove Folder from Workspace..."},category:D6,f1:!0,precondition:nt.and(cme.notEqualsTo("0"),nt.or(m8,gw.isEqualTo("workspace")))})}async run(e){const t=e.get(un),i=e.get(Zm),n=await t.executeCommand(ywe);n&&await i.removeFolders([n.uri])}}PW.ID="workbench.action.removeRootFolder";const XO=Tc("explorer-view-icon",jt.files,p("explorerViewIcon","View icon of the explorer view.")),_we=Tc("open-editors-view-icon",jt.book,p("openEditorsIcon","View icon of the open editors view."));let x2=class extends ne{constructor(e,t){super(),this.workspaceContextService=e,t.withProgress({location:1},()=>e.getCompleteWorkspace()).finally(()=>{this.registerViews(),this._register(e.onDidChangeWorkbenchState(()=>this.registerViews())),this._register(e.onDidChangeWorkspaceFolders(()=>this.registerViews()))})}registerViews(){qt("code/willRegisterExplorerViews");const e=lC.getViews(uP),t=[],i=[];this.createOpenEditorsViewDescriptor();const n=this.createExplorerViewDescriptor(),s=e.find(c=>c.id===n.id),o=this.createEmptyViewDescriptor(),a=e.find(c=>c.id===o.id);this.workspaceContextService.getWorkbenchState()===1||this.workspaceContextService.getWorkspace().folders.length===0?(s&&i.push(s),a||t.push(o)):(a&&i.push(a),s||t.push(n)),t.length&&lC.registerViews(t,uP),i.length&&lC.deregisterViews(i,uP),qt("code/didRegisterExplorerViews")}createOpenEditorsViewDescriptor(){return{id:vc.ID,name:vc.NAME,ctorDescriptor:new er(vc),containerIcon:_we,order:0,canToggleVisibility:!0,canMoveView:!0,collapsed:!1,hideByDefault:!0,focusCommand:{id:"workbench.files.action.focusOpenEditorsView",keybindings:{primary:Bt(2089,35)}}}}createEmptyViewDescriptor(){return{id:eu.ID,name:eu.NAME,containerIcon:XO,ctorDescriptor:new er(eu),order:1,canToggleVisibility:!0,focusCommand:{id:"workbench.explorer.fileView.focus"}}}createExplorerViewDescriptor(){return{id:Qs,name:p("folders","Folders"),containerIcon:XO,ctorDescriptor:new er(Dd),order:1,canMoveView:!0,canToggleVisibility:!1,focusCommand:{id:"workbench.explorer.fileView.focus"}}}};x2=T([v(0,oi),v(1,kc)],x2);let JO=class extends vw{constructor(e,t,i,n,s,o,a,c,d,l,u){super(z_,{mergeViewWithContainerWhenSingleView:!0},o,s,e,d,t,l,c,n,i,u),this.viewletVisibleContextKey=ele.bindTo(a),this._register(this.contextService.onDidChangeWorkspaceName(h=>this.updateTitleArea()))}create(e){super.create(e),e.classList.add("explorer-viewlet")}createView(e,t){return e.id===Qs?this.instantiationService.createInstance(Dd,{...t,delegate:{willOpenElement:i=>{var s,o;if(!(i instanceof MouseEvent))return;const n=this.getOpenEditorsView();if(n){let a=0;(o=(s=this.configurationService.getValue().workbench)==null?void 0:s.editor)!=null&&o.enablePreview&&(a=250),n.setStructuralRefreshDelay(a)}},didOpenElement:i=>{if(!(i instanceof MouseEvent))return;const n=this.getOpenEditorsView();n==null||n.setStructuralRefreshDelay(0)}}}):super.createView(e,t)}getExplorerView(){return this.getView(Qs)}getOpenEditorsView(){return this.getView(vc.ID)}setVisible(e){this.viewletVisibleContextKey.set(e),super.setVisible(e)}focus(){const e=this.getView(Qs);e&&this.panes.every(t=>!t.isExpanded())&&e.setExpanded(!0),e!=null&&e.isExpanded()?e.focus():super.focus()}};JO=T([v(0,Kf),v(1,gi),v(2,oi),v(3,ri),v(4,We),v(5,Te),v(6,It),v(7,Fi),v(8,eo),v(9,yr),v(10,to)],JO);const wwe=st.as(Xo.ViewContainersRegistry),uP=wwe.registerViewContainer({id:z_,title:p("explore","Explorer"),ctorDescriptor:new er(JO),storageId:"workbench.explorer.views.state",icon:XO,alwaysUseContainerInfo:!0,hideIfEmpty:!0,order:0,openCommandActionDescriptor:{id:z_,title:{value:p("explore","Explorer"),original:"Explorer"},mnemonicTitle:p({key:"miViewExplorer",comment:["&& denotes a mnemonic"]},"&&Explorer"),keybindings:{primary:3107},order:0}},0,{isDefault:!0}),bwe=p("openFolder","Open Folder"),Swe=`[${bwe}](command:${uc&&!ln?Om.ID:CI.ID})`,lC=st.as(Xo.ViewsRegistry);var tq;lC.registerViewWelcomeContent(eu.ID,{content:p({key:"noFolderHelp",comment:['Please do not translate the word "commmand", it is part of our internal syntax which must not change']},`You have not yet opened a folder.
{0}`,Swe),when:nt.and((tq=nt.has("editorIsOpen"))==null?void 0:tq.negate(),nt.or(nt.and(gw.notEqualsTo("workspace"),lme.isEqualTo("")),nt.and(gw.notEqualsTo("workspace"),Fq))),group:B_.Open,order:1});const AW=st.as(ks.Configuration),Cwe=d1?{type:"string",scope:1,enum:[Xr.OFF,Xr.ON_EXIT,Xr.ON_EXIT_AND_WINDOW_CLOSE],default:Xr.ON_EXIT,markdownEnumDescriptions:[p("hotExit.off","Disable hot exit. A prompt will show when attempting to close a window with editors that have unsaved changes."),p("hotExit.onExit","Hot exit will be triggered when the last window is closed on Windows/Linux or when the `workbench.action.quit` command is triggered (command palette, keybinding, menu). All windows without folders opened will be restored upon next launch. A list of previously opened windows with unsaved files can be accessed via `File > Open Recent > More...`"),p("hotExit.onExitAndWindowClose","Hot exit will be triggered when the last window is closed on Windows/Linux or when the `workbench.action.quit` command is triggered (command palette, keybinding, menu), and also for any window with a folder opened regardless of whether it's the last window. All windows without folders opened will be restored upon next launch. A list of previously opened windows with unsaved files can be accessed via `File > Open Recent > More...`")],description:p("hotExit","Controls whether unsaved files are remembered between sessions, allowing the save prompt when exiting the editor to be skipped.",Xr.ON_EXIT,Xr.ON_EXIT_AND_WINDOW_CLOSE)}:{type:"string",scope:1,enum:[Xr.OFF,Xr.ON_EXIT_AND_WINDOW_CLOSE],default:Xr.ON_EXIT_AND_WINDOW_CLOSE,markdownEnumDescriptions:[p("hotExit.off","Disable hot exit. A prompt will show when attempting to close a window with editors that have unsaved changes."),p("hotExit.onExitAndWindowCloseBrowser","Hot exit will be triggered when the browser quits or the window or tab is closed.")],description:p("hotExit","Controls whether unsaved files are remembered between sessions, allowing the save prompt when exiting the editor to be skipped.",Xr.ON_EXIT,Xr.ON_EXIT_AND_WINDOW_CLOSE)};AW.registerConfiguration({id:"files",order:9,title:p("filesConfigurationTitle","Files"),type:"object",properties:{[cJ]:{type:"object",markdownDescription:p("exclude","Configure [glob patterns](https://aka.ms/vscode-glob-patterns) for excluding files and folders. For example, the File Explorer decides which files and folders to show or hide based on this setting. Refer to the `#search.exclude#` setting to define search-specific excludes. Refer to the `#explorer.excludeGitIgnore#` setting for ignoring files based on your `.gitignore`."),default:{"**/.git":!0,"**/.svn":!0,"**/.hg":!0,"**/CVS":!0,"**/.DS_Store":!0,"**/Thumbs.db":!0,...ln?{"**/*.crswap":!0}:void 0},scope:4,additionalProperties:{anyOf:[{type:"boolean",enum:[!0,!1],enumDescriptions:[p("trueDescription","Enable the pattern."),p("falseDescription","Disable the pattern.")],description:p("files.exclude.boolean","The glob pattern to match file paths against. Set to true or false to enable or disable the pattern.")},{type:"object",properties:{when:{type:"string",pattern:"\\w*\\$\\(basename\\)\\w*",default:"$(basename).ext",markdownDescription:p({key:"files.exclude.when",comment:["\\$(basename) should not be translated"]},"Additional check on the siblings of a matching file. Use \\$(basename) as variable for the matching file name.")}}}]}},[KN]:{type:"object",markdownDescription:p("associations",'Configure file associations to languages (for example `"*.extension": "html"`). These have precedence over the default associations of the languages installed.'),additionalProperties:{type:"string"}},"files.encoding":{type:"string",enum:Object.keys(Dv),default:"utf8",description:p("encoding","The default character set encoding to use when reading and writing files. This setting can also be configured per language."),scope:5,enumDescriptions:Object.keys(Dv).map(r=>Dv[r].labelLong),enumItemLabels:Object.keys(Dv).map(r=>Dv[r].labelLong)},"files.autoGuessEncoding":{type:"boolean",default:!1,markdownDescription:p("autoGuessEncoding","When enabled, the editor will attempt to guess the character set encoding when opening files. This setting can also be configured per language. Note, this setting is not respected by text search. Only {0} is respected.","`#files.encoding#`"),scope:5},"files.eol":{type:"string",enum:[`
`,`\r
`,"auto"],enumDescriptions:[p("eol.LF","LF"),p("eol.CRLF","CRLF"),p("eol.auto","Uses operating system specific end of line character.")],default:"auto",description:p("eol","The default end of line character."),scope:5},"files.enableTrash":{type:"boolean",default:!0,description:p("useTrash","Moves files/folders to the OS trash (recycle bin on Windows) when deleting. Disabling this will delete files/folders permanently.")},"files.trimTrailingWhitespace":{type:"boolean",default:!1,description:p("trimTrailingWhitespace","When enabled, will trim trailing whitespace when saving a file."),scope:5},"files.insertFinalNewline":{type:"boolean",default:!1,description:p("insertFinalNewline","When enabled, insert a final new line at the end of the file when saving it."),scope:5},"files.trimFinalNewlines":{type:"boolean",default:!1,description:p("trimFinalNewlines","When enabled, will trim all new lines after the final new line at the end of the file when saving it."),scope:5},"files.autoSave":{type:"string",enum:[Pn.OFF,Pn.AFTER_DELAY,Pn.ON_FOCUS_CHANGE,Pn.ON_WINDOW_CHANGE],markdownEnumDescriptions:[p({comment:["This is the description for a setting. Values surrounded by single quotes are not to be translated."],key:"files.autoSave.off"},"An editor with changes is never automatically saved."),p({comment:["This is the description for a setting. Values surrounded by single quotes are not to be translated."],key:"files.autoSave.afterDelay"},"An editor with changes is automatically saved after the configured `#files.autoSaveDelay#`."),p({comment:["This is the description for a setting. Values surrounded by single quotes are not to be translated."],key:"files.autoSave.onFocusChange"},"An editor with changes is automatically saved when the editor loses focus."),p({comment:["This is the description for a setting. Values surrounded by single quotes are not to be translated."],key:"files.autoSave.onWindowChange"},"An editor with changes is automatically saved when the window loses focus.")],default:ln?Pn.AFTER_DELAY:Pn.OFF,markdownDescription:p({comment:["This is the description for a setting. Values surrounded by single quotes are not to be translated."],key:"autoSave"},"Controls [auto save](https://code.visualstudio.com/docs/editor/codebasics#_save-auto-save) of editors that have unsaved changes.",Pn.OFF,Pn.AFTER_DELAY,Pn.ON_FOCUS_CHANGE,Pn.ON_WINDOW_CHANGE,Pn.AFTER_DELAY)},"files.autoSaveDelay":{type:"number",default:1e3,minimum:0,markdownDescription:p({comment:["This is the description for a setting. Values surrounded by single quotes are not to be translated."],key:"autoSaveDelay"},"Controls the delay in milliseconds after which an editor with unsaved changes is saved automatically. Only applies when `#files.autoSave#` is set to `{0}`.",Pn.AFTER_DELAY)},"files.watcherExclude":{type:"object",patternProperties:{".*":{type:"boolean"}},default:{"**/.git/objects/**":!0,"**/.git/subtree-cache/**":!0,"**/node_modules/*/**":!0,"**/.hg/store/**":!0},markdownDescription:p("watcherExclude","Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) to exclude from file watching. Paths can either be relative to the watched folder or absolute. Glob patterns are matched relative from the watched folder. When you experience the file watcher process consuming a lot of CPU, make sure to exclude large folders that are of less interest (such as build output folders)."),scope:4},"files.watcherInclude":{type:"array",items:{type:"string"},default:[],description:p("watcherInclude","Configure extra paths to watch for changes inside the workspace. By default, all workspace folders will be watched recursively, except for folders that are symbolic links. You can explicitly add absolute or relative paths to support watching folders that are symbolic links. Relative paths will be resolved to an absolute path using the currently opened workspace."),scope:4},"files.hotExit":Cwe,"files.defaultLanguage":{type:"string",markdownDescription:p("defaultLanguage","The default language identifier that is assigned to new files. If configured to `${activeEditorLanguage}`, will use the language identifier of the currently active text editor if any.")},[hq]:{type:"object",patternProperties:{".*":{type:"boolean"}},default:{},markdownDescription:p("filesReadonlyInclude","Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) to mark as read-only. Glob patterns are always evaluated relative to the path of the workspace folder unless they are absolute paths. You can exclude matching paths via the `#files.readonlyExclude#` setting. Files from readonly file system providers will always be read-only independent of this setting."),scope:4},[fq]:{type:"object",patternProperties:{".*":{type:"boolean"}},default:{},markdownDescription:p("filesReadonlyExclude","Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) to exclude from being marked as read-only if they match as a result of the `#files.readonlyInclude#` setting. Glob patterns are always evaluated relative to the path of the workspace folder unless they are absolute paths. Files from readonly file system providers will always be read-only independent of this setting."),scope:4},[dJ]:{type:"boolean",markdownDescription:p("filesReadonlyFromPermissions","Marks files as read-only when their file permissions indicate as such. This can be overridden via `#files.readonlyInclude#` and `#files.readonlyExclude#` settings."),default:!1},"files.restoreUndoStack":{type:"boolean",description:p("files.restoreUndoStack","Restore the undo stack when a file is reopened."),default:!0},"files.saveConflictResolution":{type:"string",enum:["askUser","overwriteFileOnDisk"],enumDescriptions:[p("askUser","Will refuse to save and ask for resolving the save conflict manually."),p("overwriteFileOnDisk","Will resolve the save conflict by overwriting the file on disk with the changes in the editor.")],description:p("files.saveConflictResolution","A save conflict can occur when a file is saved to disk that was changed by another program in the meantime. To prevent data loss, the user is asked to compare the changes in the editor with the version on disk. This setting should only be changed if you frequently encounter save conflict errors and may result in data loss if used without caution."),default:"askUser",scope:5},"files.dialog.defaultPath":{type:"string",pattern:"^((\\/|\\\\\\\\|[a-zA-Z]:\\\\).*)?$",patternErrorMessage:p("defaultPathErrorMessage","Default path for file dialogs must be an absolute path (e.g. C:\\\\myFolder or /myFolder)."),description:p("fileDialogDefaultPath","Default path for file dialogs, overriding user's home path. Only used in the absence of a context-specific path, such as most recently opened file or folder."),scope:2},"files.simpleDialog.enable":{type:"boolean",description:p("files.simpleDialog.enable","Enables the simple file dialog for opening and saving files and folders. The simple file dialog replaces the system file dialog when enabled."),default:!1},"files.participants.timeout":{type:"number",default:6e4,markdownDescription:p("files.participants.timeout","Timeout in milliseconds after which file participants for create, rename, and delete are cancelled. Use `0` to disable participants.")}}});AW.registerConfiguration({...f1,properties:{"editor.formatOnSave":{type:"boolean",description:p("formatOnSave","Format a file on save. A formatter must be available, the file must not be saved after delay, and the editor must not be shutting down."),scope:5},"editor.formatOnSaveMode":{type:"string",default:"file",enum:["file","modifications","modificationsIfAvailable"],enumDescriptions:[p({key:"everything",comment:["This is the description of an option"]},"Format the whole file."),p({key:"modification",comment:["This is the description of an option"]},"Format modifications (requires source control)."),p({key:"modificationIfAvailable",comment:["This is the description of an option"]},"Will attempt to format modifications only (requires source control). If source control can't be used, then the whole file will be formatted.")],markdownDescription:p("formatOnSaveMode","Controls if format on save formats the whole file or only modifications. Only applies when `#editor.formatOnSave#` is enabled."),scope:5}}});AW.registerConfiguration({id:"explorer",order:10,title:p("explorerConfigurationTitle","File Explorer"),type:"object",properties:{"explorer.openEditors.visible":{type:"number",description:p({key:"openEditorsVisible",comment:["Open is an adjective"]},"The initial maximum number of editors shown in the Open Editors pane. Exceeding this limit will show a scroll bar and allow resizing the pane to display more items."),default:9,minimum:1},"explorer.openEditors.minVisible":{type:"number",description:p({key:"openEditorsVisibleMin",comment:["Open is an adjective"]},"The minimum number of editor slots pre-allocated in the Open Editors pane. If set to 0 the Open Editors pane will dynamically resize based on the number of editors."),default:0,minimum:0},"explorer.openEditors.sortOrder":{type:"string",enum:["editorOrder","alphabetical","fullPath"],description:p({key:"openEditorsSortOrder",comment:["Open is an adjective"]},"Controls the sorting order of editors in the Open Editors pane."),enumDescriptions:[p("sortOrder.editorOrder","Editors are ordered in the same order editor tabs are shown."),p("sortOrder.alphabetical","Editors are ordered alphabetically by tab name inside each editor group."),p("sortOrder.fullPath","Editors are ordered alphabetically by full path inside each editor group.")],default:"editorOrder"},"explorer.autoReveal":{type:["boolean","string"],enum:[!0,!1,"focusNoScroll"],default:!0,enumDescriptions:[p("autoReveal.on","Files will be revealed and selected."),p("autoReveal.off","Files will not be revealed and selected."),p("autoReveal.focusNoScroll","Files will not be scrolled into view, but will still be focused.")],description:p("autoReveal","Controls whether the Explorer should automatically reveal and select files when opening them.")},"explorer.autoRevealExclude":{type:"object",markdownDescription:p("autoRevealExclude","Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) for excluding files and folders from being revealed and selected in the Explorer when they are opened. Glob patterns are always evaluated relative to the path of the workspace folder unless they are absolute paths."),default:{"**/node_modules":!0,"**/bower_components":!0},additionalProperties:{anyOf:[{type:"boolean",description:p("explorer.autoRevealExclude.boolean","The glob pattern to match file paths against. Set to true or false to enable or disable the pattern.")},{type:"object",properties:{when:{type:"string",pattern:"\\w*\\$\\(basename\\)\\w*",default:"$(basename).ext",description:p("explorer.autoRevealExclude.when","Additional check on the siblings of a matching file. Use $(basename) as variable for the matching file name.")}}}]}},"explorer.enableDragAndDrop":{type:"boolean",description:p("enableDragAndDrop","Controls whether the Explorer should allow to move files and folders via drag and drop. This setting only effects drag and drop from inside the Explorer."),default:!0},"explorer.confirmDragAndDrop":{type:"boolean",description:p("confirmDragAndDrop","Controls whether the Explorer should ask for confirmation to move files and folders via drag and drop."),default:!0},"explorer.confirmDelete":{type:"boolean",description:p("confirmDelete","Controls whether the Explorer should ask for confirmation when deleting a file via the trash."),default:!0},"explorer.enableUndo":{type:"boolean",description:p("enableUndo","Controls whether the Explorer should support undoing file and folder operations."),default:!0},"explorer.confirmUndo":{type:"string",enum:["verbose","default","light"],description:p("confirmUndo","Controls whether the Explorer should ask for confirmation when undoing."),default:"default",enumDescriptions:[p("enableUndo.verbose","Explorer will prompt before all undo operations."),p("enableUndo.default","Explorer will prompt before destructive undo operations."),p("enableUndo.light","Explorer will not prompt before undo operations when focused.")]},"explorer.expandSingleFolderWorkspaces":{type:"boolean",description:p("expandSingleFolderWorkspaces","Controls whether the Explorer should expand multi-root workspaces containing only one folder during initialization"),default:!0},"explorer.sortOrder":{type:"string",enum:["default","mixed","filesFirst","type","modified","foldersNestsFiles"],default:"default",enumDescriptions:[p("sortOrder.default","Files and folders are sorted by their names. Folders are displayed before files."),p("sortOrder.mixed","Files and folders are sorted by their names. Files are interwoven with folders."),p("sortOrder.filesFirst","Files and folders are sorted by their names. Files are displayed before folders."),p("sortOrder.type","Files and folders are grouped by extension type then sorted by their names. Folders are displayed before files."),p("sortOrder.modified","Files and folders are sorted by last modified date in descending order. Folders are displayed before files."),p("sortOrder.foldersNestsFiles","Files and folders are sorted by their names. Folders are displayed before files. Files with nested children are displayed before other files.")],markdownDescription:p("sortOrder","Controls the property-based sorting of files and folders in the Explorer. When `#explorer.fileNesting.enabled#` is enabled, also controls sorting of nested files.")},"explorer.sortOrderLexicographicOptions":{type:"string",enum:["default","upper","lower","unicode"],default:"default",enumDescriptions:[p("sortOrderLexicographicOptions.default","Uppercase and lowercase names are mixed together."),p("sortOrderLexicographicOptions.upper","Uppercase names are grouped together before lowercase names."),p("sortOrderLexicographicOptions.lower","Lowercase names are grouped together before uppercase names."),p("sortOrderLexicographicOptions.unicode","Names are sorted in Unicode order.")],description:p("sortOrderLexicographicOptions","Controls the lexicographic sorting of file and folder names in the Explorer.")},"explorer.decorations.colors":{type:"boolean",description:p("explorer.decorations.colors","Controls whether file decorations should use colors."),default:!0},"explorer.decorations.badges":{type:"boolean",description:p("explorer.decorations.badges","Controls whether file decorations should use badges."),default:!0},"explorer.incrementalNaming":{type:"string",enum:["simple","smart","disabled"],enumDescriptions:[p("simple",'Appends the word "copy" at the end of the duplicated name potentially followed by a number.'),p("smart","Adds a number at the end of the duplicated name. If some number is already part of the name, tries to increase that number."),p("disabled","Disables incremental naming. If two files with the same name exist you will be prompted to overwrite the existing file.")],description:p("explorer.incrementalNaming","Controls what naming strategy to use when a giving a new name to a duplicated Explorer item on paste."),default:"simple"},"explorer.compactFolders":{type:"boolean",description:p("compressSingleChildFolders","Controls whether the Explorer should render folders in a compact form. In such a form, single child folders will be compressed in a combined tree element. Useful for Java package structures, for example."),default:!0},"explorer.copyRelativePathSeparator":{type:"string",enum:["/","\\","auto"],enumDescriptions:[p("copyRelativePathSeparator.slash","Use slash as path separation character."),p("copyRelativePathSeparator.backslash","Use backslash as path separation character."),p("copyRelativePathSeparator.auto","Uses operating system specific path separation character.")],description:p("copyRelativePathSeparator","The path separation character used when copying relative file paths."),default:"auto"},"explorer.excludeGitIgnore":{type:"boolean",markdownDescription:p("excludeGitignore","Controls whether entries in .gitignore should be parsed and excluded from the Explorer. Similar to {0}.","`#files.exclude#`"),default:!1,scope:4},"explorer.fileNesting.enabled":{type:"boolean",scope:4,markdownDescription:p("fileNestingEnabled","Controls whether file nesting is enabled in the Explorer. File nesting allows for related files in a directory to be visually grouped together under a single parent file."),default:!1},"explorer.fileNesting.expand":{type:"boolean",markdownDescription:p("fileNestingExpand","Controls whether file nests are automatically expanded. {0} must be set for this to take effect.","`#explorer.fileNesting.enabled#`"),default:!0},"explorer.fileNesting.patterns":{type:"object",scope:4,markdownDescription:p("fileNestingPatterns","Controls nesting of files in the Explorer. {0} must be set for this to take effect. Each __Item__ represents a parent pattern and may contain a single `*` character that matches any string. Each __Value__ represents a comma separated list of the child patterns that should be shown nested under a given parent. Child patterns may contain several special tokens:\n- `${capture}`: Matches the resolved value of the `*` from the parent pattern\n- `${basename}`: Matches the parent file's basename, the `file` in `file.ts`\n- `${extname}`: Matches the parent file's extension, the `ts` in `file.ts`\n- `${dirname}`: Matches the parent file's directory name, the `src` in `src/file.ts`\n- `*`:  Matches any string, may only be used once per child pattern","`#explorer.fileNesting.enabled#`"),patternProperties:{"^[^*]*\\*?[^*]*$":{markdownDescription:p("fileNesting.description","Each key pattern may contain a single `*` character which will match any string."),type:"string",pattern:"^([^,*]*\\*?[^,*]*)(, ?[^,*]*\\*?[^,*]*)*$"}},additionalProperties:!1,default:{"*.ts":"${capture}.js","*.js":"${capture}.js.map, ${capture}.min.js, ${capture}.d.ts","*.jsx":"${capture}.js","*.tsx":"${capture}.ts","tsconfig.json":"tsconfig.*.json","package.json":"package-lock.json, yarn.lock, pnpm-lock.yaml"}}}});class MW{constructor(e,t){this.uri=e,this.readonly=t,this._onDidChange=new A,this.onDidChange=this._onDidChange.event,this._onDidDelete=new A,this.onDidDelete=this._onDidDelete.event,this._onDidRename=new A,this.onDidRename=this._onDidRename.event,this.ctime=Date.now(),this.mtime=Date.now(),this.type=Jl.File}async stats(){return{ctime:this.ctime,mtime:this.mtime,size:await this.getSize(),type:Jl.File,permissions:this.readonly?Lm.Readonly:void 0}}async getSize(){return(await this.read()).length}async delete(){this._onDidDelete.fire()}async rename(e){const t=this.uri;this.uri=e,this._onDidRename.fire({from:t,to:e})}}class k6 extends MW{constructor(e,t){super(e,!0),this.read=t}write(){throw An("Not allowed",lt.FileWriteLocked)}async delete(){throw An("Not allowed",lt.FileWriteLocked)}async rename(){throw An("Not allowed",lt.FileWriteLocked)}}class Ewe extends MW{constructor(e,t){super(e,!1),this.content=t}async read(){return this.content}async write(e){this.content=e,this._onDidChange.fire()}}const xwe=new TextEncoder,Dwe=new TextDecoder;class T6 extends ne{constructor(e){super(),this.onDidChangeCapabilities=F.None,this._onDidChangeFile=new A,this.onDidChangeFile=this._onDidChangeFile.event,this.files=new Map,this.capabilities=1026,e&&(this.capabilities|=2048)}registerFile(e){this.files.set(e.uri.toString(),e),this._onDidChangeFile.fire([{resource:e.uri,type:1}]);const t=new me;return t.add(ot(()=>{this.files.get(e.uri.toString())===e&&(this.files.delete(e.uri.toString()),this._onDidChangeFile.fire([{resource:e.uri,type:2}]))})),t.add(e.onDidDelete(()=>{t.dispose()})),t.add(e.onDidChange(()=>{this._onDidChangeFile.fire([{resource:e.uri,type:0}])})),t.add(e.onDidRename(({from:i,to:n})=>{this.files.get(i.toString())===e&&(this.files.delete(i.toString()),this._onDidChangeFile.fire([{resource:i,type:2}]),this.files.set(n.toString(),e),this._onDidChangeFile.fire([{resource:n,type:1}]))})),t}async stat(e){const t=e.toString(),i=this.files.get(t);if(i!=null)return i.stats();const n=Array.from(this.files.keys());for(const s of n)if(s.startsWith(t+"/"))return{ctime:Date.now(),mtime:Date.now(),size:0,type:Jl.Directory};throw An("file not found",lt.FileNotFound)}async readdir(e){const t=Array.from(this.files.keys()).map(s=>Sg(e.path,k.parse(s).path)).filter(s=>!s.startsWith("..")),i=t.filter(s=>!s.includes("/")),n=t.filter(s=>s.includes("/")).map(s=>s.slice(0,s.indexOf("/")));return[...i.map(s=>[s,Jl.File]),...n.map(s=>[s,Jl.Directory])]}async readFile(e){const t=this.files.get(e.toString());if(t!=null){const i=await t.read();return i instanceof Uint8Array?i:xwe.encode(i)}throw Zy.create("file not found",lt.FileNotFound)}watch(){return ne.None}async writeFile(e,t){const i=this.files.get(e.toString());if((i==null?void 0:i.write)!=null){await i.write(Dwe.decode(t));return}throw An("Not allowed",lt.NoPermissions)}async delete(e){const t=this.files.get(e.toString());if(t!=null){await t.delete();return}throw An("File not found",lt.FileNotFound)}async rename(e,t){const i=this.files.get(e.toString());if(i!=null){await i.rename(t);return}throw An("File not found",lt.FileNotFound)}async mkdir(){throw An("Not allowed",lt.NoPermissions)}}function D2(r){return r.status==="fulfilled"}class kwe{constructor(){this.providers=[],this.onDidChangeCapabilities=F.None,this._onDidChangeFile=new A,this.onDidChangeFile=this._onDidChangeFile.event,this._onDidChangeOverlays=new A,this.onDidChangeOverlays=this._onDidChangeOverlays.event,this.capabilities=1026}register(e,t){const i={priority:e,provider:t};this.providers.push(i),this.providers.sort((s,o)=>o.priority-s.priority);const n=new me;return n.add(t.onDidChangeFile(s=>{this._onDidChangeFile.fire(s)})),n.add({dispose:()=>{const s=this.providers.indexOf(i);s>=0&&(this.providers.splice(s,1),this._onDidChangeOverlays.fire())}}),this._onDidChangeOverlays.fire(),n}get delegates(){return this.providers.map(({provider:e})=>e)}async readFromDelegates(e){let t;for(const i of this.delegates)try{return await e(i)}catch(n){if(t??(t=n),n instanceof Zy&&[lt.NoPermissions,lt.FileNotFound,lt.Unavailable].includes(n.code))continue;throw n}throw t}async writeToDelegates(e,t){for(const i of this.delegates)if(!((i.capabilities&2048)>0))try{return await t(i)}catch(n){if(n instanceof Zy&&[lt.NoPermissions,lt.FileNotFound,lt.Unavailable].includes(n.code))continue;throw n}throw An("Not allowed",lt.NoPermissions)}async stat(e){return this.readFromDelegates(async t=>{const i=await t.stat(e),n=(t.capabilities&2048)>0;return{...i,permissions:i.permissions??(n?Lm.Readonly:void 0)}})}async readFile(e){return this.readFromDelegates(t=>t.readFile(e))}async readdir(e){const t=await Promise.allSettled(this.delegates.map(i=>i.readdir(e)));if(!t.some(D2))throw t[0].reason;return Object.entries(Object.fromEntries(t.filter(D2).map(i=>i.value).flat()))}watch(e,t){const i=new me;for(const n of this.delegates)i.add(n.watch(e,t));return i}async writeFile(e,t,i){await this.writeToDelegates(e,async n=>{try{if((((await n.stat(e)).permissions??0)&Lm.Readonly)>0)throw An("Not allowed",lt.NoPermissions)}catch{}return n.writeFile(e,t,i)})}async mkdir(e){await this.writeToDelegates(e,t=>t.mkdir(e))}async delete(e,t){await this.writeToDelegates(e,i=>i.delete(e,t))}async rename(e,t,i){await this.writeToDelegates(e,n=>n.rename(e,t,i))}}class Twe extends rh{async writeFile(e,t,i){return await ka.get(at).mkdirp(this,Yw.dirname(e)),super.writeFile(e,t,i)}}const $y=new kwe;$y.register(0,new Twe);const I6=new T6(!0);let ZO=class extends PO{constructor(e){super(e);const t=new rh;this.registerProvider("user",t),this.registerProvider("extension",I6),this.registerProvider("cache",new rh),this.registerProvider("logs",new rh),this.registerProvider(pe.vscodeUserData,new rh),this.registerProvider(pe.tmp,new rh);let i=this.registerProvider("file",$y);$y.onDidChangeOverlays(()=>{i.dispose(),i=this.registerProvider("file",$y)})}};ZO=T([v(0,ze)],ZO);function Iwe(){return{[at.toString()]:new er(ZO)}}function Rwe(r,e,t){return I6.registerFile(new k6(pt(r,e),t))}function Pwe(r,e){return $y.register(r,e)}const Awe=Object.freeze(Object.defineProperty({__proto__:null,get FileChangeType(){return MO},get FilePermission(){return Lm},get FileSystemProviderCapabilities(){return AO},FileSystemProviderError:Zy,get FileSystemProviderErrorCode(){return lt},get FileType(){return Jl},HTMLFileSystemProvider:see,InMemoryFileSystemProvider:rh,RegisteredFile:MW,RegisteredFileSystemProvider:T6,RegisteredMemoryFile:Ewe,RegisteredReadOnlyFile:k6,default:Iwe,registerExtensionFile:Rwe,registerFileSystemOverlay:Pwe},Symbol.toStringTag,{value:"Module"})),Mwe=new Cs;async function Lwe(){await e6().then(async r=>{Sz(await r.getApi()),Mwe.open()})}const Fwe=async r=>{await Owe(r),(r==null?void 0:r.debugLogging)===!0&&console.log("initializeMonacoService completed successfully"),await Lwe(),(r==null?void 0:r.debugLogging)===!0&&console.log("initializeVscodeExtensions completed successfully"),window.MonacoEnvironment||(window.MonacoEnvironment={createTrustedTypesPolicy:e=>{}}),window.MonacoEnvironment.vscodeApiInitialised=!0},Owe=async r=>{var u,h,g;const e=[],t=[],i=r??{},n=i.userServices??{},s=(m,y)=>{e.push(y),t.push(m)};i.enableFilesService===!0&&s("files",bi(()=>Promise.resolve().then(()=>Awe),void 0)),i.enableExtensionsService===!0&&s("extensions",bi(()=>Promise.resolve().then(()=>Fye),void 0)),i.enableModelService===!0&&s("model",bi(()=>import("./model-47441a5d.js"),["assets/model-47441a5d.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"])),i.configureEditorOrViewsServiceConfig!==void 0&&(i.configureEditorOrViewsServiceConfig.enableViewsService?s("views",bi(()=>import("./views-62f10955.js"),["assets/views-62f10955.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/viewsService-285340a8.js","assets/editor-11bcb270.js","assets/simpleIconLabel-0ce5eb95.js","assets/quickaccess-f6b93953.js","assets/window-103210be.js","assets/workbench.contribution-30154607.js","assets/style-dfdd0949.js","assets/views-73bfa014.css"])):s("editor",bi(()=>import("./editor-aa65dc04.js"),["assets/editor-aa65dc04.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/editor-11bcb270.js","assets/simpleIconLabel-0ce5eb95.js","assets/quickaccess-f6b93953.js"]))),i.configureConfigurationServiceConfig!==void 0&&s("configuration",bi(()=>import("./configuration-b7664253.js"),["assets/configuration-b7664253.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/configuration-e4f2850d.js"])),i.enableDialogService===!0&&s("dialogs",bi(()=>import("./dialogs-10c92f8a.js"),["assets/dialogs-10c92f8a.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/window-103210be.js","assets/dialogs-d9fa739f.css"])),i.enableNotificationService===!0&&s("notifications",bi(()=>import("./notifications-3f3649c6.js"),["assets/notifications-3f3649c6.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"])),i.enableThemeService===!0&&s("theme",bi(()=>import("./theme-23ad1f3c.js"),["assets/theme-23ad1f3c.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"])),i.enableTextmateService===!0&&s("textmate",bi(()=>import("./textmate-c51ac2fe.js"),["assets/textmate-c51ac2fe.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"])),i.enableKeybindingsService===!0&&s("keybindings",bi(()=>import("./keybindings-d4d4841a.js"),["assets/keybindings-d4d4841a.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/workbench.contribution-30154607.js","assets/logConstants-d978bbc0.js"])),i.enableLanguagesService===!0&&s("languages",bi(()=>import("./languages-b139aa85.js"),["assets/languages-b139aa85.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"])),i.enableAudioCueService===!0&&s("audioCue",bi(()=>import("./audioCue-c0e01785.js"),["assets/audioCue-c0e01785.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"])),i.enableDebugService===!0&&s("debug",bi(()=>import("./debug-6abb8bcc.js"),["assets/debug-6abb8bcc.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/configuration-e4f2850d.js","assets/debugCommands-240ed907.js","assets/markers-5a26ad77.js","assets/dropdownWithPrimaryActionViewItem-7c22356c.js"])),i.enablePreferencesService===!0&&s("preferences",bi(()=>import("./preferences-f331a594.js"),["assets/preferences-f331a594.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/configuration-e4f2850d.js","assets/style-dfdd0949.js","assets/simpleIconLabel-0ce5eb95.js"])),i.enableSnippetsService===!0&&s("snippets",bi(()=>import("./snippets-1b230cfe.js"),["assets/snippets-1b230cfe.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"])),i.enableQuickaccessService===!0&&s("quickaccess",bi(()=>import("./quickaccess-62ee4f80.js"),["assets/quickaccess-62ee4f80.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/quickaccess-f6b93953.js","assets/gotoSymbolQuickAccess-e33e825e.js"])),i.enableOutputService===!0&&s("output",bi(()=>Promise.resolve().then(()=>mme),void 0)),i.configureTerminalServiceConfig!==void 0&&s("terminal",bi(()=>import("./terminal-6e375bab.js"),["assets/terminal-6e375bab.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/quickPickPin-32344b17.js","assets/logConstants-d978bbc0.js","assets/viewsService-285340a8.js","assets/quickaccess-f6b93953.js","assets/dropdownWithPrimaryActionViewItem-7c22356c.js","assets/accessibilityContribution-303aed9a.js"])),i.enableSearchService===!0&&s("search",bi(()=>import("./search-e97e4c35.js"),["assets/search-e97e4c35.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/quickaccess-f6b93953.js","assets/gotoSymbolQuickAccess-e33e825e.js","assets/debugCommands-240ed907.js","assets/quickPickPin-32344b17.js"])),i.enableMarkersService===!0&&s("markers",bi(()=>import("./markers-84bb995a.js"),["assets/markers-84bb995a.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/markers-5a26ad77.js"])),i.enableAccessibilityService===!0&&s("accessibility",bi(()=>import("./accessibility-7d2ae94a.js"),["assets/accessibility-7d2ae94a.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/accessibilityContribution-303aed9a.js"])),i.enableEnvironmentService===!0&&s("environment",bi(()=>Promise.resolve().then(()=>Vue),void 0)),i.enableLayoutService===!0&&s("layout",bi(()=>Promise.resolve().then(()=>Uue),void 0)),i.enableLanguageDetectionWorkerService===!0&&s("languageDetectionWorker",bi(()=>import("./languageDetectionWorker-b7e2f666.js"),["assets/languageDetectionWorker-b7e2f666.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css"]));const o=(m,y,_)=>{for(const b of Object.keys(m))y&&console.log(_?`Loading ${_} service: ${b}`:`Loading service: ${b}`)},a=(m,y)=>{for(const[_,b]of Object.entries(m))y[_]=b};let c=0;const d=await Promise.all(Object.values(e)),l={};if(n&&(a(n,l),o(n,i.debugLogging===!0,"user")),(t.includes("theme")||Object.keys(l).includes("themeService"))&&!(t.includes("textmate")||Object.keys(l).includes("textMateTokenizationFeature")))throw new Error('"theme" requires "textmate" service. Please add it to the "initServices" config.');if((t.includes("quickaccess")||Object.keys(l).includes("quickInputService"))&&!(t.includes("keybindings")||Object.keys(l).includes("keybindingService")))throw new Error('"quickaccess" requires "keybindings" service. Please add it to the "initServices" config.');if(t.includes("markers")&&!(t.includes("views")||Object.keys(l).includes("viewsService")))throw new Error('"markers" requires "views" service. Please add it to the "initServices" config.');for(const m of d){const y=t[c];i.debugLogging===!0&&console.log(`Initialising provided service: ${y}`);let _={};if(y==="editor"||y==="views")if(i.configureEditorOrViewsServiceConfig.useDefaultOpenEditorFunction){const b=async(E,D,R)=>{console.log("Trying to open a model",E,D,R)};_=m.default(b)}else(u=i.configureEditorOrViewsServiceConfig)!=null&&u.openEditorFunc&&(_=m.default(i.configureEditorOrViewsServiceConfig.openEditorFunc));else if(y==="configuration"){if((h=i.configureConfigurationServiceConfig)!=null&&h.defaultWorkspaceUri){const b=PG.file(i.configureConfigurationServiceConfig.defaultWorkspaceUri);_=m.default(b)}}else y==="terminal"?(g=i.configureTerminalServiceConfig)!=null&&g.backendImpl&&(_=m.default(i.configureTerminalServiceConfig.backendImpl)):_=m.default();a(_,l),o(_,i.debugLogging===!0),c++}await $ye(l),i.logLevel&&ka.get(ze).setLevel(i.logLevel)};var eN={},tN={};(function(r){var e=Jn&&Jn.__createBinding||(Object.create?function(n,s,o,a){a===void 0&&(a=o);var c=Object.getOwnPropertyDescriptor(s,o);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(n,a,c)}:function(n,s,o,a){a===void 0&&(a=o),n[a]=s[o]}),t=Jn&&Jn.__exportStar||function(n,s){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,n,o)};Object.defineProperty(r,"__esModule",{value:!0}),r.DiagnosticPullMode=r.vsdiag=void 0,t(Lt,r),t(Pi,r);var i=tT;Object.defineProperty(r,"vsdiag",{enumerable:!0,get:function(){return i.vsdiag}}),Object.defineProperty(r,"DiagnosticPullMode",{enumerable:!0,get:function(){return i.DiagnosticPullMode}}),t(D1,r)})(tN);var k2=Lt;(function(r){var e=Jn&&Jn.__createBinding||(Object.create?function(o,a,c,d){d===void 0&&(d=c);var l=Object.getOwnPropertyDescriptor(a,c);(!l||("get"in l?!a.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return a[c]}}),Object.defineProperty(o,d,l)}:function(o,a,c,d){d===void 0&&(d=c),o[d]=a[c]}),t=Jn&&Jn.__exportStar||function(o,a){for(var c in o)c!=="default"&&!Object.prototype.hasOwnProperty.call(a,c)&&e(a,o,c)};Object.defineProperty(r,"__esModule",{value:!0}),r.LanguageClient=void 0;const i=tN,n=k2;t(k2,r),t(tN,r);class s extends i.BaseLanguageClient{constructor(a,c,d,l){super(a,c,d),this.worker=l}createMessageTransports(a){const c=new n.BrowserMessageReader(this.worker),d=new n.BrowserMessageWriter(this.worker);return Promise.resolve({reader:c,writer:d})}}r.LanguageClient=s})(eN);class Nwe extends N1.AbstractMessageReader{constructor(t){super();mi(this,"socket");mi(this,"state","initial");mi(this,"callback");mi(this,"events",[]);this.socket=t,this.socket.onMessage(i=>this.readMessage(i)),this.socket.onError(i=>this.fireError(i)),this.socket.onClose((i,n)=>{if(i!==1e3){const s={name:""+i,message:`Error during socket reconnect: code = ${i}, reason = ${n}`};this.fireError(s)}this.fireClose()})}listen(t){if(this.state==="initial")for(this.state="listening",this.callback=t;this.events.length!==0;){const i=this.events.pop();i.message?this.readMessage(i.message):i.error?this.fireError(i.error):this.fireClose()}return{dispose:()=>{this.callback===t&&(this.callback=void 0)}}}readMessage(t){if(this.state==="initial")this.events.splice(0,0,{message:t});else if(this.state==="listening")try{const i=JSON.parse(t);this.callback(i)}catch(i){const n={name:"400",message:`Error during message parsing, reason = ${typeof i=="object"?i.message:"unknown"}`};this.fireError(n)}}fireError(t){this.state==="initial"?this.events.splice(0,0,{error:t}):this.state==="listening"&&super.fireError(t)}fireClose(){this.state==="initial"?this.events.splice(0,0,{}):this.state==="listening"&&super.fireClose(),this.state="closed"}}class $we extends $1.AbstractMessageWriter{constructor(t){super();mi(this,"socket");mi(this,"errorCount",0);this.socket=t}end(){}async write(t){try{const i=JSON.stringify(t);this.socket.send(i)}catch(i){this.errorCount++,this.fireError(i,t,this.errorCount)}}}function Wwe(r){return{send:e=>r.send(e),onMessage:e=>{r.onmessage=t=>e(t.data)},onError:e=>{r.onerror=t=>{"message"in t&&e(t.message)}},onClose:e=>{r.onclose=t=>e(t.code,t.reason)},dispose:()=>r.close()}}class Hwe{constructor(){this._values=[]}_read(e){return this._values[e]}get(e){return this._values[e]}_write(e,t){this._values[e]=t}}class jwe{constructor(){this._values=[]}_read(e){if(e>=this._values.length)throw new Error("Cannot read uninitialized value");return this._values[e]}get(e){return this._read(e)}_write(e,t){this._values[e]=t}}class FD{static validateOptions(e){const t=new Hwe;for(const i of Fb){const n=i.name==="_never_"?void 0:e[i.name];t._write(i.id,i.validate(n))}return t}static computeOptions(e,t){const i=new jwe;for(const n of Fb)i._write(n.id,n.compute(t,i,e._read(n.id)));return i}static _deepEquals(e,t){if(typeof e!="object"||typeof t!="object"||!e||!t)return e===t;if(Array.isArray(e)||Array.isArray(t))return Array.isArray(e)&&Array.isArray(t)?Ds(e,t):!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!FD._deepEquals(e[i],t[i]))return!1;return!0}static checkEquals(e,t){const i=[];let n=!1;for(const s of Fb){const o=!FD._deepEquals(e._read(s.id),t._read(s.id));i[s.id]=o,o&&(n=!0)}return n?new lJ(i):null}static applyUpdate(e,t){let i=!1;for(const n of Fb)if(t.hasOwnProperty(n.name)){const s=n.applyUpdate(e[n.name],t[n.name]);e[n.name]=s.newValue,i=i||s.didChange}return i}}const T2=io.registerExtensionPoint({extensionPoint:"jsonValidation",defaultExtensionKind:["workspace","web"],jsonSchema:{description:p("contributes.jsonValidation","Contributes json schema configuration."),type:"array",defaultSnippets:[{body:[{fileMatch:"${1:file.json}",url:"${2:url}"}]}],items:{type:"object",defaultSnippets:[{body:{fileMatch:"${1:file.json}",url:"${2:url}"}}],properties:{fileMatch:{type:["string","array"],description:p("contributes.jsonValidation.fileMatch",`The file pattern (or an array of patterns) to match, for example "package.json" or "*.launch". Exclusion patterns start with '!'`),items:{type:["string"]}},url:{description:p("contributes.jsonValidation.url","A schema URL ('http:', 'https:') or relative path to the extension folder ('./')."),type:"string"}}}}});class Bwe{constructor(){T2.setHandler(e=>{for(const t of e){const i=t.value,n=t.collector,s=t.description.extensionLocation;if(!i||!Array.isArray(i)){n.error(p("invalid.jsonValidation","'configuration.jsonValidation' must be a array"));return}i.forEach(o=>{if(!Rt(o.fileMatch)&&!(Array.isArray(o.fileMatch)&&o.fileMatch.every(Rt))){n.error(p("invalid.fileMatch","'configuration.jsonValidation.fileMatch' must be defined as a string or an array of strings."));return}const a=o.url;if(!Rt(a)){n.error(p("invalid.url","'configuration.jsonValidation.url' must be a URL or relative path"));return}if(a.startsWith("./"))try{const c=pt(s,a);Ff(c,s)||n.warn(p("invalid.path.1","Expected `contributes.{0}.url` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",T2.name,c.toString(),s.path))}catch(c){n.error(p("invalid.url.fileschema","'configuration.jsonValidation.url' is an invalid relative URL: {0}",c.message))}else if(!/^[^:/?#]+:\/\//.test(a)){n.error(p("invalid.url.schema","'configuration.jsonValidation.url' must be an absolute URL or start with './'  to reference schemas located in the extension."));return}})}})}}class iN{static _readModifiers(e){e=e.toLowerCase().trim();let t=!1,i=!1,n=!1,s=!1,o;do o=!1,/^ctrl(\+|\-)/.test(e)&&(t=!0,e=e.substr(5),o=!0),/^shift(\+|\-)/.test(e)&&(i=!0,e=e.substr(6),o=!0),/^alt(\+|\-)/.test(e)&&(n=!0,e=e.substr(4),o=!0),/^meta(\+|\-)/.test(e)&&(s=!0,e=e.substr(5),o=!0),/^win(\+|\-)/.test(e)&&(s=!0,e=e.substr(4),o=!0),/^cmd(\+|\-)/.test(e)&&(s=!0,e=e.substr(4),o=!0);while(o);let a;const c=e.indexOf(" ");return c>0?(a=e.substring(0,c),e=e.substring(c)):(a=e,e=""),{remains:e,ctrl:t,shift:i,alt:n,meta:s,key:a}}static parseChord(e){const t=this._readModifiers(e),i=t.key.match(/^\[([^\]]+)\]$/);if(i){const s=i[1],o=jP.lowerCaseToEnum(s);return[new BP(t.ctrl,t.shift,t.alt,t.meta,o),t.remains]}const n=AG.fromUserSettings(t.key);return[new my(t.ctrl,t.shift,t.alt,t.meta,n),t.remains]}static parseKeybinding(e){if(!e)return null;const t=[];let i;for(;e.length>0;)[i,e]=this.parseChord(e),t.push(i);return t.length>0?new uq(t):null}}const R6=[{key:"commandPalette",id:Ee.CommandPalette,description:p("menus.commandPalette","The Command Palette"),supportsSubmenus:!1},{key:"touchBar",id:Ee.TouchBarContext,description:p("menus.touchBar","The touch bar (macOS only)"),supportsSubmenus:!1},{key:"editor/title",id:Ee.EditorTitle,description:p("menus.editorTitle","The editor title menu")},{key:"editor/title/run",id:Ee.EditorTitleRun,description:p("menus.editorTitleRun","Run submenu inside the editor title menu")},{key:"editor/context",id:Ee.EditorContext,description:p("menus.editorContext","The editor context menu")},{key:"editor/context/copy",id:Ee.EditorContextCopy,description:p("menus.editorContextCopyAs","'Copy as' submenu in the editor context menu")},{key:"editor/context/share",id:Ee.EditorContextShare,description:p("menus.editorContextShare","'Share' submenu in the editor context menu"),proposed:"contribShareMenu"},{key:"explorer/context",id:Ee.ExplorerContext,description:p("menus.explorerContext","The file explorer context menu")},{key:"explorer/context/share",id:Ee.ExplorerContextShare,description:p("menus.explorerContextShare","'Share' submenu in the file explorer context menu"),proposed:"contribShareMenu"},{key:"editor/title/context",id:Ee.EditorTitleContext,description:p("menus.editorTabContext","The editor tabs context menu")},{key:"editor/title/context/share",id:Ee.EditorTitleContextShare,description:p("menus.editorTitleContextShare","'Share' submenu inside the editor title context menu"),proposed:"contribShareMenu"},{key:"debug/callstack/context",id:Ee.DebugCallStackContext,description:p("menus.debugCallstackContext","The debug callstack view context menu")},{key:"debug/variables/context",id:Ee.DebugVariablesContext,description:p("menus.debugVariablesContext","The debug variables view context menu")},{key:"debug/toolBar",id:Ee.DebugToolBar,description:p("menus.debugToolBar","The debug toolbar menu")},{key:"menuBar/home",id:Ee.MenubarHomeMenu,description:p("menus.home","The home indicator context menu (web only)"),proposed:"contribMenuBarHome",supportsSubmenus:!1},{key:"menuBar/edit/copy",id:Ee.MenubarCopy,description:p("menus.opy","'Copy as' submenu in the top level Edit menu")},{key:"scm/title",id:Ee.SCMTitle,description:p("menus.scmTitle","The Source Control title menu")},{key:"scm/sourceControl",id:Ee.SCMSourceControl,description:p("menus.scmSourceControl","The Source Control menu")},{key:"scm/resourceState/context",id:Ee.SCMResourceContext,description:p("menus.resourceStateContext","The Source Control resource state context menu")},{key:"scm/resourceFolder/context",id:Ee.SCMResourceFolderContext,description:p("menus.resourceFolderContext","The Source Control resource folder context menu")},{key:"scm/resourceGroup/context",id:Ee.SCMResourceGroupContext,description:p("menus.resourceGroupContext","The Source Control resource group context menu")},{key:"scm/change/title",id:Ee.SCMChangeContext,description:p("menus.changeTitle","The Source Control inline change menu")},{key:"statusBar/remoteIndicator",id:Ee.StatusBarRemoteIndicatorMenu,description:p("menus.statusBarRemoteIndicator","The remote indicator menu in the status bar"),supportsSubmenus:!1},{key:"view/title",id:Ee.ViewTitle,description:p("view.viewTitle","The contributed view title menu")},{key:"view/item/context",id:Ee.ViewItemContext,description:p("view.itemContext","The contributed view item context menu")},{key:"comments/comment/editorActions",id:Ee.CommentEditorActions,description:p("commentThread.editorActions","The contributed comment editor actions"),proposed:"contribCommentEditorActionsMenu"},{key:"comments/commentThread/title",id:Ee.CommentThreadTitle,description:p("commentThread.title","The contributed comment thread title menu")},{key:"comments/commentThread/context",id:Ee.CommentThreadActions,description:p("commentThread.actions","The contributed comment thread context menu, rendered as buttons below the comment editor"),supportsSubmenus:!1},{key:"comments/commentThread/additionalActions",id:Ee.CommentThreadAdditionalActions,description:p("commentThread.actions","The contributed comment thread context menu, rendered as buttons below the comment editor"),supportsSubmenus:!1,proposed:"contribCommentThreadAdditionalMenu"},{key:"comments/commentThread/title/context",id:Ee.CommentThreadTitleContext,description:p("commentThread.titleContext","The contributed comment thread title's peek context menu, rendered as a right click menu on the comment thread's peek title."),proposed:"contribCommentPeekContext"},{key:"comments/comment/title",id:Ee.CommentTitle,description:p("comment.title","The contributed comment title menu")},{key:"comments/comment/context",id:Ee.CommentActions,description:p("comment.actions","The contributed comment context menu, rendered as buttons below the comment editor"),supportsSubmenus:!1},{key:"comments/commentThread/comment/context",id:Ee.CommentThreadCommentContext,description:p("comment.commentContext","The contributed comment context menu, rendered as a right click menu on the an individual comment in the comment thread's peek view."),proposed:"contribCommentPeekContext"},{key:"notebook/toolbar",id:Ee.NotebookToolbar,description:p("notebook.toolbar","The contributed notebook toolbar menu")},{key:"notebook/kernelSource",id:Ee.NotebookKernelSource,description:p("notebook.kernelSource","The contributed notebook kernel sources menu"),proposed:"notebookKernelSource"},{key:"notebook/cell/title",id:Ee.NotebookCellTitle,description:p("notebook.cell.title","The contributed notebook cell title menu")},{key:"notebook/cell/execute",id:Ee.NotebookCellExecute,description:p("notebook.cell.execute","The contributed notebook cell execution menu")},{key:"interactive/toolbar",id:Ee.InteractiveToolbar,description:p("interactive.toolbar","The contributed interactive toolbar menu")},{key:"interactive/cell/title",id:Ee.InteractiveCellTitle,description:p("interactive.cell.title","The contributed interactive cell title menu")},{key:"testing/item/context",id:Ee.TestItem,description:p("testing.item.context","The contributed test item menu")},{key:"testing/item/gutter",id:Ee.TestItemGutter,description:p("testing.item.gutter.title","The menu for a gutter decoration for a test item")},{key:"extension/context",id:Ee.ExtensionContext,description:p("menus.extensionContext","The extension context menu")},{key:"timeline/title",id:Ee.TimelineTitle,description:p("view.timelineTitle","The Timeline view title menu")},{key:"timeline/item/context",id:Ee.TimelineItemContext,description:p("view.timelineContext","The Timeline view item context menu")},{key:"ports/item/context",id:Ee.TunnelContext,description:p("view.tunnelContext","The Ports view item context menu")},{key:"ports/item/origin/inline",id:Ee.TunnelOriginInline,description:p("view.tunnelOriginInline","The Ports view item origin inline menu")},{key:"ports/item/port/inline",id:Ee.TunnelPortInline,description:p("view.tunnelPortInline","The Ports view item port inline menu")},{key:"file/newFile",id:Ee.NewFile,description:p("file.newFile","The 'New File...' quick pick, shown on welcome page and File menu."),supportsSubmenus:!1},{key:"webview/context",id:Ee.WebviewContext,description:p("webview.context","The webview context menu")},{key:"file/share",id:Ee.MenubarShare,description:p("menus.share","Share submenu shown in the top level File menu."),proposed:"contribShareMenu"},{key:"editor/inlineCompletions/actions",id:Ee.InlineCompletionsActions,description:p("inlineCompletions.actions","The actions shown when hovering on an inline completion"),supportsSubmenus:!1,proposed:"inlineCompletionsAdditions"},{key:"editor/content",id:Ee.EditorContent,description:p("merge.toolbar","The prominent button in an editor, overlays its content"),proposed:"contribEditorContentMenu"},{key:"editor/lineNumber/context",id:Ee.EditorLineNumberContext,description:p("editorLineNumberContext","The contributed editor line number context menu")},{key:"mergeEditor/result/title",id:Ee.MergeInputResultToolbar,description:p("menus.mergeEditorResult","The result toolbar of the merge editor"),proposed:"contribMergeEditorMenus"}];var kd;(function(r){function e(g){return typeof g.command=="string"}r.isMenuItem=e;function t(g,m){return typeof g.command!="string"?(m.error(p("requirestring","property `{0}` is mandatory and must be of type `string`","command")),!1):g.alt&&typeof g.alt!="string"?(m.error(p("optstring","property `{0}` can be omitted or must be of type `string`","alt")),!1):g.when&&typeof g.when!="string"?(m.error(p("optstring","property `{0}` can be omitted or must be of type `string`","when")),!1):g.group&&typeof g.group!="string"?(m.error(p("optstring","property `{0}` can be omitted or must be of type `string`","group")),!1):!0}r.isValidMenuItem=t;function i(g,m){return typeof g.submenu!="string"?(m.error(p("requirestring","property `{0}` is mandatory and must be of type `string`","submenu")),!1):g.when&&typeof g.when!="string"?(m.error(p("optstring","property `{0}` can be omitted or must be of type `string`","when")),!1):g.group&&typeof g.group!="string"?(m.error(p("optstring","property `{0}` can be omitted or must be of type `string`","group")),!1):!0}r.isValidSubmenuItem=i;function n(g,m){if(!Array.isArray(g))return m.error(p("requirearray","submenu items must be an array")),!1;for(const y of g)if(e(y)){if(!t(y,m))return!1}else if(!i(y,m))return!1;return!0}r.isValidItems=n;function s(g,m){return typeof g!="object"?(m.error(p("require","submenu items must be an object")),!1):typeof g.id!="string"?(m.error(p("requirestring","property `{0}` is mandatory and must be of type `string`","id")),!1):typeof g.label!="string"?(m.error(p("requirestring","property `{0}` is mandatory and must be of type `string`","label")),!1):!0}r.isValidSubmenu=s;const o={type:"object",required:["command"],properties:{command:{description:p("vscode.extension.contributes.menuItem.command","Identifier of the command to execute. The command must be declared in the 'commands'-section"),type:"string"},alt:{description:p("vscode.extension.contributes.menuItem.alt","Identifier of an alternative command to execute. The command must be declared in the 'commands'-section"),type:"string"},when:{description:p("vscode.extension.contributes.menuItem.when","Condition which must be true to show this item"),type:"string"},group:{description:p("vscode.extension.contributes.menuItem.group","Group into which this item belongs"),type:"string"}}},a={type:"object",required:["submenu"],properties:{submenu:{description:p("vscode.extension.contributes.menuItem.submenu","Identifier of the submenu to display in this item."),type:"string"},when:{description:p("vscode.extension.contributes.menuItem.when","Condition which must be true to show this item"),type:"string"},group:{description:p("vscode.extension.contributes.menuItem.group","Group into which this item belongs"),type:"string"}}},c={type:"object",required:["id","label"],properties:{id:{description:p("vscode.extension.contributes.submenu.id","Identifier of the menu to display as a submenu."),type:"string"},label:{description:p("vscode.extension.contributes.submenu.label","The label of the menu item which leads to this submenu."),type:"string"},icon:{description:p({key:"vscode.extension.contributes.submenu.icon",comment:["do not translate or change `\\$(zap)`, \\ in front of $ is important."]},"(Optional) Icon which is used to represent the submenu in the UI. Either a file path, an object with file paths for dark and light themes, or a theme icon references, like `\\$(zap)`"),anyOf:[{type:"string"},{type:"object",properties:{light:{description:p("vscode.extension.contributes.submenu.icon.light","Icon path when a light theme is used"),type:"string"},dark:{description:p("vscode.extension.contributes.submenu.icon.dark","Icon path when a dark theme is used"),type:"string"}}}]}}};r.menusContribution={description:p("vscode.extension.contributes.menus","Contributes menu items to the editor"),type:"object",properties:uJ(R6,g=>g.key,g=>({markdownDescription:g.proposed?p("proposed",'Proposed API, requires `enabledApiProposal: ["{0}"]` - {1}',g.proposed,g.description):g.description,type:"array",items:g.supportsSubmenus===!1?o:{oneOf:[o,a]}})),additionalProperties:{description:"Submenu",type:"array",items:{oneOf:[o,a]}}},r.submenusContribution={description:p("vscode.extension.contributes.submenus","Contributes submenu items to the editor"),type:"array",items:c};function d(g,m){return g?ga(g.command)?(m.error(p("requirestring","property `{0}` is mandatory and must be of type `string`","command")),!1):!u(g.title,m,"title")||g.shortTitle&&!u(g.shortTitle,m,"shortTitle")?!1:g.enablement&&typeof g.enablement!="string"?(m.error(p("optstring","property `{0}` can be omitted or must be of type `string`","precondition")),!1):!(g.category&&!u(g.category,m,"category")||!l(g.icon,m)):(m.error(p("nonempty","expected non-empty value.")),!1)}r.isValidCommand=d;function l(g,m){return typeof g>"u"||typeof g=="string"||typeof g.dark=="string"&&typeof g.light=="string"?!0:(m.error(p("opticon","property `icon` can be omitted or must be either a string or a literal like `{dark, light}`")),!1)}function u(g,m,y){return typeof g>"u"?(m.error(p("requireStringOrObject","property `{0}` is mandatory and must be of type `string` or `object`",y)),!1):typeof g=="string"&&ga(g)?(m.error(p("requirestring","property `{0}` is mandatory and must be of type `string`",y)),!1):typeof g!="string"&&(ga(g.original)||ga(g.value))?(m.error(p("requirestrings","properties `{0}` and `{1}` are mandatory and must be of type `string`",`${y}.value`,`${y}.original`)),!1):!0}const h={type:"object",required:["command","title"],properties:{command:{description:p("vscode.extension.contributes.commandType.command","Identifier of the command to execute"),type:"string"},title:{description:p("vscode.extension.contributes.commandType.title","Title by which the command is represented in the UI"),type:"string"},shortTitle:{markdownDescription:p("vscode.extension.contributes.commandType.shortTitle","(Optional) Short title by which the command is represented in the UI. Menus pick either `title` or `shortTitle` depending on the context in which they show commands."),type:"string"},category:{description:p("vscode.extension.contributes.commandType.category","(Optional) Category string by which the command is grouped in the UI"),type:"string"},enablement:{description:p("vscode.extension.contributes.commandType.precondition","(Optional) Condition which must be true to enable the command in the UI (menu and keybindings). Does not prevent executing the command by other means, like the `executeCommand`-api."),type:"string"},icon:{description:p({key:"vscode.extension.contributes.commandType.icon",comment:["do not translate or change `\\$(zap)`, \\ in front of $ is important."]},"(Optional) Icon which is used to represent the command in the UI. Either a file path, an object with file paths for dark and light themes, or a theme icon references, like `\\$(zap)`"),anyOf:[{type:"string"},{type:"object",properties:{light:{description:p("vscode.extension.contributes.commandType.icon.light","Icon path when a light theme is used"),type:"string"},dark:{description:p("vscode.extension.contributes.commandType.icon.dark","Icon path when a dark theme is used"),type:"string"}}}]}}};r.commandsContribution={description:p("vscode.extension.contributes.commands","Contributes commands to the command palette."),oneOf:[h,{type:"array",items:h}]}})(kd||(kd={}));const I2=new me,P6=io.registerExtensionPoint({extensionPoint:"commands",jsonSchema:kd.commandsContribution,activationEventsGenerator:(r,e)=>{for(const t of r)t.command&&e.push(`onCommand:${t.command}`)}});P6.setHandler(r=>{function e(t,i){if(!kd.isValidCommand(t,i.collector))return;const{icon:n,enablement:s,category:o,title:a,shortTitle:c,command:d}=t;let l;n&&(typeof n=="string"?l=Si.fromString(n)??{dark:pt(i.description.extensionLocation,n),light:pt(i.description.extensionLocation,n)}:l={dark:pt(i.description.extensionLocation,n.dark),light:pt(i.description.extensionLocation,n.light)});const u=Un.getCommand(d);u&&(u.source?i.collector.info(p("dup1","Command `{0}` already registered by {1} ({2})",t.command,u.source.title,u.source.id)):i.collector.info(p("dup0","Command `{0}` already registered",t.command))),I2.add(Un.addCommand({id:d,title:a,source:{id:i.description.identifier.value,title:i.description.displayName??i.description.name},shortTitle:c,tooltip:a,category:o,precondition:nt.deserialize(s),icon:l}))}I2.clear();for(const t of r){const{value:i}=t;if(Array.isArray(i))for(const n of i)e(n,t);else e(i,t)}});const Wy=new Map,A6=io.registerExtensionPoint({extensionPoint:"submenus",jsonSchema:kd.submenusContribution});A6.setHandler(r=>{Wy.clear();for(const e of r){const{value:t,collector:i}=e;for(const[,n]of Object.entries(t)){if(!kd.isValidSubmenu(n,i))continue;if(!n.id){i.warn(p("submenuId.invalid.id","`{0}` is not a valid submenu identifier",n.id));continue}if(Wy.has(n.id)){i.info(p("submenuId.duplicate.id","The `{0}` submenu was already previously registered.",n.id));continue}if(!n.label){i.warn(p("submenuId.invalid.label","`{0}` is not a valid submenu label",n.label));continue}let s;n.icon&&(typeof n.icon=="string"?s=Si.fromString(n.icon)||{dark:pt(e.description.extensionLocation,n.icon)}:s={dark:pt(e.description.extensionLocation,n.icon.dark),light:pt(e.description.extensionLocation,n.icon.light)});const o={id:Ee.for(`api:${n.id}`),label:n.label,icon:s};Wy.set(n.id,o)}}});const Uwe=new Map(R6.map(r=>[r.key,r])),R2=new me,hP=new Map,Vwe=io.registerExtensionPoint({extensionPoint:"menus",jsonSchema:kd.menusContribution,deps:[A6]});Vwe.setHandler(r=>{R2.clear(),hP.clear();for(const e of r){const{value:t,collector:i}=e;for(const n of Object.entries(t)){if(!kd.isValidItems(n[1],i))continue;let s=Uwe.get(n[0]);if(!s){const o=Wy.get(n[0]);o&&(s={key:n[0],id:o.id,description:""})}if(s){if(s.proposed&&!ts(e.description,s.proposed)){i.error(p("proposedAPI.invalid",`{0} is a proposed menu identifier. It requires 'package.json#enabledApiProposals: ["{1}"]' and is only available when running out of dev or with the following command line switch: --enable-proposed-api {2}`,n[0],s.proposed,e.description.identifier.value));continue}for(const o of n[1]){let a;if(kd.isMenuItem(o)){const c=Un.getCommand(o.command),d=o.alt&&Un.getCommand(o.alt)||void 0;if(!c){i.error(p("missing.command","Menu item references a command `{0}` which is not defined in the 'commands' section.",o.command));continue}o.alt&&!d&&i.warn(p("missing.altCommand","Menu item references an alt-command `{0}` which is not defined in the 'commands' section.",o.alt)),o.command===o.alt&&i.info(p("dupe.command","Menu item references the same command as default and alt-command")),a={command:c,alt:d,group:void 0,order:void 0,when:void 0}}else{if(s.supportsSubmenus===!1){i.error(p("unsupported.submenureference","Menu item references a submenu for a menu which doesn't have submenu support."));continue}const c=Wy.get(o.submenu);if(!c){i.error(p("missing.submenu","Menu item references a submenu `{0}` which is not defined in the 'submenus' section.",o.submenu));continue}let d=hP.get(s.id.id);if(d||(d=new Set,hP.set(s.id.id,d)),d.has(c.id.id)){i.warn(p("submenuItem.duplicate","The `{0}` submenu was already contributed to the `{1}` menu.",o.submenu,n[0]));continue}d.add(c.id.id),a={submenu:c.id,icon:c.icon,title:c.label,group:void 0,order:void 0,when:void 0}}if(o.group){const c=o.group.lastIndexOf("@");c>0?(a.group=o.group.substr(0,c),a.order=Number(o.group.substr(c+1))||void 0):a.group=o.group}a.when=nt.deserialize(o.when),R2.add(Un.appendMenuItem(s.id,a))}}}}});function qwe(r){const e=[],t=new Map,i=(n,s)=>{if(!t.has(n)&&(t.set(n,!0),!(n[0]==="_"||n.indexOf("vscode.")===0)&&r.get(n)!==!0)){if(!s){const o=Gt.getCommand(n);if(o&&typeof o.description=="object"&&Pr(o.description.args))return}e.push(n)}};for(const n of Un.getMenuItems(Ee.CommandPalette))hJ(n)&&i(n.command.id,!0);for(const n of hk.getEditorActions())i(n.id,!0);for(const n of Gt.getCommands().keys())i(n,!1);return e}class M6{static writeKeybindingItem(e,t){if(!t.resolvedKeybinding)return;const i=JSON.stringify(t.resolvedKeybinding.getUserSettingsLabel());e.write(`{ "key": ${Gwe(i+",",25)} "command": `);const n=t.when?JSON.stringify(t.when.serialize()):"",s=JSON.stringify(t.command);n.length>0?(e.write(`${s},`),e.writeLine(),e.write(`                                     "when": ${n}`)):e.write(`${s}`),t.commandArgs&&(e.write(","),e.writeLine(),e.write(`                                     "args": ${JSON.stringify(t.commandArgs)}`)),e.write(" }")}static readUserKeybindingItem(e){const t="key"in e&&typeof e.key=="string"?iN.parseKeybinding(e.key):null,i="when"in e&&typeof e.when=="string"?nt.deserialize(e.when):void 0,n="command"in e&&typeof e.command=="string"?e.command:null,s="args"in e&&typeof e.args<"u"?e.args:void 0;return{keybinding:t,command:n,commandArgs:s,when:i,_sourceKey:"key"in e&&typeof e.key=="string"?e.key:void 0}}}function Gwe(r,e){return r.length<e?r+new Array(e-r.length).join(" "):r}class zwe{constructor(){this._lines=[],this._currentLine=""}write(e){this._currentLine+=e}writeLine(e=""){this._lines.push(this._currentLine+e),this._currentLine=""}toString(){return this.writeLine(),this._lines.join(`
`)}}function Kwe(r,e){return r?typeof r.command!="string"?(e.push(p("requirestring","property `{0}` is mandatory and must be of type `string`","command")),!1):r.key&&typeof r.key!="string"?(e.push(p("optstring","property `{0}` can be omitted or must be of type `string`","key")),!1):r.when&&typeof r.when!="string"?(e.push(p("optstring","property `{0}` can be omitted or must be of type `string`","when")),!1):r.mac&&typeof r.mac!="string"?(e.push(p("optstring","property `{0}` can be omitted or must be of type `string`","mac")),!1):r.linux&&typeof r.linux!="string"?(e.push(p("optstring","property `{0}` can be omitted or must be of type `string`","linux")),!1):r.win&&typeof r.win!="string"?(e.push(p("optstring","property `{0}` can be omitted or must be of type `string`","win")),!1):!0:(e.push(p("nonempty","expected non-empty value.")),!1)}const P2={type:"object",default:{command:"",key:""},properties:{command:{description:p("vscode.extension.contributes.keybindings.command","Identifier of the command to run when keybinding is triggered."),type:"string"},args:{description:p("vscode.extension.contributes.keybindings.args","Arguments to pass to the command to execute.")},key:{description:p("vscode.extension.contributes.keybindings.key","Key or key sequence (separate keys with plus-sign and sequences with space, e.g. Ctrl+O and Ctrl+L L for a chord)."),type:"string"},mac:{description:p("vscode.extension.contributes.keybindings.mac","Mac specific key or key sequence."),type:"string"},linux:{description:p("vscode.extension.contributes.keybindings.linux","Linux specific key or key sequence."),type:"string"},win:{description:p("vscode.extension.contributes.keybindings.win","Windows specific key or key sequence."),type:"string"},when:{description:p("vscode.extension.contributes.keybindings.when","Condition when the key is active."),type:"string"}}},A2=io.registerExtensionPoint({extensionPoint:"keybindings",deps:[P6],jsonSchema:{description:p("vscode.extension.contributes.keybindings","Contributes keybindings."),oneOf:[P2,{type:"array",items:P2}]}}),Qwe=[90,91,92,93,95,96,97,98,99,100,101,102,103,104,105],ja=new Map;ja.set(95,22);ja.set(96,23);ja.set(97,24);ja.set(98,25);ja.set(99,26);ja.set(100,27);ja.set(101,28);ja.set(102,29);ja.set(103,30);ja.set(104,21);let nN=class uC extends fJ{constructor(e,t,i,n,s,o,a,c,d,l){super(e,t,i,n,d),this.hostService=o,this.keyboardLayoutService=l,this._contributions=[],this.isComposingGlobalContextKey=e.createKey("isComposing",!1),this.kbsJsonSchema=new rN,this.updateKeybindingsJsonSchema(),this._keyboardMapper=this.keyboardLayoutService.getKeyboardMapper(),this.keyboardLayoutService.onDidChangeKeyboardLayout(()=>{this._keyboardMapper=this.keyboardLayoutService.getKeyboardMapper(),this.updateResolver()}),this._cachedResolver=null,this.userKeybindings=this._register(new Ywe(s,c,d)),this.userKeybindings.initialize().then(()=>{this.userKeybindings.keybindings.length&&this.updateResolver()}),this._register(this.userKeybindings.onDidChange(()=>{d.debug("User keybindings changed"),this.updateResolver()})),A2.setHandler(u=>{const h=[];for(const g of u)this._handleKeybindingsExtensionPointUser(g.description.identifier,g.description.isBuiltin,g.value,g.collector,h);Xi.setExtensionKeybindings(h),this.updateResolver()}),this.updateKeybindingsJsonSchema(),this._register(a.onDidRegisterExtensions(()=>this.updateKeybindingsJsonSchema())),this._register(Ci(window,sn.KEY_DOWN,u=>{this.isComposingGlobalContextKey.set(u.isComposing);const h=new e_(u);this._log(`/ Received  keydown event - ${pJ(u)}`),this._log(`| Converted keydown event - ${gJ(h)}`),this._dispatch(h,h.target)&&h.preventDefault(),this.isComposingGlobalContextKey.set(!1)})),this._register(Ci(window,sn.KEY_UP,u=>{this.isComposingGlobalContextKey.set(u.isComposing);const h=new e_(u);this._singleModifierDispatch(h,h.target)&&h.preventDefault(),this.isComposingGlobalContextKey.set(!1)})),this._register(mJ(()=>{const u=navigator.keyboard;VI.keyboard!==2&&(jH()?u==null||u.lock(["Escape"]):u==null||u.unlock(),this._cachedResolver=null,this._onDidUpdateKeybindings.fire())}))}registerSchemaContribution(e){this._contributions.push(e),e.onDidChange&&this._register(e.onDidChange(()=>this.updateKeybindingsJsonSchema())),this.updateKeybindingsJsonSchema()}updateKeybindingsJsonSchema(){this.kbsJsonSchema.updateSchema(this._contributions.flatMap(e=>e.getSchemaAdditions()))}_printKeybinding(e){return vJ.toLabel(dc,e.chords,t=>t instanceof my?AG.toString(t.keyCode):jP.toString(t.scanCode))||"[null]"}_printResolvedKeybinding(e){return e.getDispatchChords().map(t=>t||"[null]").join(" ")}_printResolvedKeybindings(e,t,i){const s=`${t.padStart(35," ")} => `;if(i.length===0){e.push(`${s}${"[NO BINDING]".padStart(35," ")}`);return}for(const o of i)e.push(`${s}${this._printResolvedKeybinding(o).padStart(35," ")}`)}_dumpResolveKeybindingDebugInfo(){const e=new Set,t=[];t.push("Default Resolved Keybindings (unique only):");for(const i of Xi.getDefaultKeybindings()){if(!i.keybinding)continue;const n=this._printKeybinding(i.keybinding);if(e.has(n))continue;e.add(n);const s=this._keyboardMapper.resolveKeybinding(i.keybinding);this._printResolvedKeybindings(t,n,s)}t.push("User Resolved Keybindings (unique only):");for(const i of this.userKeybindings.keybindings){if(!i.keybinding)continue;const n=i._sourceKey??"Impossible: missing source key, but has keybinding";if(e.has(n))continue;e.add(n);const s=this._keyboardMapper.resolveKeybinding(i.keybinding);this._printResolvedKeybindings(t,n,s)}return t.join(`
`)}_dumpDebugInfo(){const e=JSON.stringify(this.keyboardLayoutService.getCurrentKeyboardLayout(),null,"	"),t=this._keyboardMapper.dumpDebugInfo(),i=this._dumpResolveKeybindingDebugInfo(),n=JSON.stringify(this.keyboardLayoutService.getRawKeyboardMapping(),null,"	");return`Layout info:
${e}

${i}

${t}

Raw mapping:
${n}`}_dumpDebugInfoJSON(){const e={layout:this.keyboardLayoutService.getCurrentKeyboardLayout(),rawMapping:this.keyboardLayoutService.getRawKeyboardMapping()};return JSON.stringify(e,null,"	")}customKeybindingsCount(){return this.userKeybindings.keybindings.length}updateResolver(){this._cachedResolver=null,this._onDidUpdateKeybindings.fire()}_getResolver(){if(!this._cachedResolver){const e=this._resolveKeybindingItems(Xi.getDefaultKeybindings(),!0),t=this._resolveUserKeybindingItems(this.userKeybindings.keybindings,!1);this._cachedResolver=new MG(e,t,i=>this._log(i))}return this._cachedResolver}_documentHasFocus(){return this.hostService.hasFocus}_resolveKeybindingItems(e,t){const i=[];let n=0;for(const s of e){const o=s.when||void 0,a=s.keybinding;if(!a)i[n++]=new Ob(void 0,s.command,s.commandArgs,o,t,s.extensionId,s.isBuiltinExtension);else{if(this._assertBrowserConflicts(a))continue;const c=this._keyboardMapper.resolveKeybinding(a);for(let d=c.length-1;d>=0;d--){const l=c[d];i[n++]=new Ob(l,s.command,s.commandArgs,o,t,s.extensionId,s.isBuiltinExtension)}}}return i}_resolveUserKeybindingItems(e,t){const i=[];let n=0;for(const s of e){const o=s.when||void 0;if(!s.keybinding)i[n++]=new Ob(void 0,s.command,s.commandArgs,o,t,null,!1);else{const a=this._keyboardMapper.resolveKeybinding(s.keybinding);for(const c of a)i[n++]=new Ob(c,s.command,s.commandArgs,o,t,null,!1)}}return i}_assertBrowserConflicts(e){if(VI.keyboard===0||VI.keyboard===1&&jH())return!1;for(const t of e.chords){if(!t.metaKey&&!t.altKey&&!t.ctrlKey&&!t.shiftKey)continue;const i=3584;let n=0;if(t.metaKey&&(n|=2048),t.shiftKey&&(n|=1024),t.altKey&&(n|=512),t.ctrlKey&&dc===2&&(n|=256),(n&i)===2560&&(t instanceof BP&&(t.scanCode===86||t.scanCode===85)||t instanceof my&&(t.keyCode===15||t.keyCode===17))||(n&i)===2048&&(t instanceof BP&&t.scanCode>=36&&t.scanCode<=45||t instanceof my&&t.keyCode>=21&&t.keyCode<=30))return!0}return!1}resolveKeybinding(e){return this._keyboardMapper.resolveKeybinding(e)}resolveKeyboardEvent(e){return this.keyboardLayoutService.validateCurrentKeyboardMapping(e),this._keyboardMapper.resolveKeyboardEvent(e)}resolveUserBinding(e){const t=iN.parseKeybinding(e);return t?this._keyboardMapper.resolveKeybinding(t):[]}_handleKeybindingsExtensionPointUser(e,t,i,n,s){if(Array.isArray(i))for(let o=0,a=i.length;o<a;o++)this._handleKeybinding(e,t,o+1,i[o],n,s);else this._handleKeybinding(e,t,1,i,n,s)}_handleKeybinding(e,t,i,n,s,o){const a=[];if(Kwe(n,a)){const c=this._asCommandRule(e,t,i++,n);c&&o.push(c)}a.length>0&&s.error(p("invalid.keybindings","Invalid `contributes.{0}`: {1}",A2.name,a.join(`
`)))}static bindToCurrentPlatform(e,t,i,n){if(dc===1&&n){if(n)return n}else if(dc===2){if(t)return t}else if(i)return i;return e}_asCommandRule(e,t,i,n){const{command:s,args:o,when:a,key:c,mac:d,linux:l,win:u}=n,h=uC.bindToCurrentPlatform(c,d,l,u);if(!h)return;let g;t?g=300+i:g=400+i;const m=Un.getCommand(s),y=m&&m.precondition;let _;return a&&y?_=nt.and(y,nt.deserialize(a)):a?_=nt.deserialize(a):y&&(_=y),{id:s,args:o,when:_,weight:g,keybinding:iN.parseKeybinding(h),extensionId:e.value,isBuiltinExtension:t}}getDefaultKeybindingsContent(){const e=this._getResolver(),t=e.getDefaultKeybindings(),i=e.getDefaultBoundCommands();return uC._getDefaultKeybindings(t)+`

`+uC._getAllCommandsAsComment(i)}static _getDefaultKeybindings(e){const t=new zwe;t.writeLine("[");const i=e.length-1;return e.forEach((n,s)=>{M6.writeKeybindingItem(t,n),s!==i?t.writeLine(","):t.writeLine()}),t.writeLine("]"),t.toString()}static _getAllCommandsAsComment(e){const i=qwe(e).sort().join(`
// - `);return"// "+p("unboundCommands","Here are other available commands: ")+`
// - `+i}mightProducePrintableCharacter(e){if(e.ctrlKey||e.metaKey||e.altKey)return!1;const t=jP.toEnum(e.code);if(Qwe.indexOf(t)!==-1)return!!(e.keyCode===BH[t]||uc&&e.keyCode===ja.get(t));if(BH[t]!==-1)return!1;const n=this.keyboardLayoutService.getRawKeyboardMapping();if(!n)return!1;const s=n[e.code];return!(!s||!s.value||/\s/.test(s.value))}};nN=T([v(0,It),v(1,un),v(2,gi),v(3,on),v(4,NT),v(5,bu),v(6,yr),v(7,at),v(8,ze),v(9,y3)],nN);class Ywe extends ne{get keybindings(){return this._keybindings}constructor(e,t,i){super(),this.userDataProfileService=e,this.fileService=t,this._rawKeybindings=[],this._keybindings=[],this.watchDisposables=this._register(new me),this._onDidChange=this._register(new A),this.onDidChange=this._onDidChange.event,this.watch(),this.reloadConfigurationScheduler=this._register(new Ys(()=>this.reload().then(n=>{n&&this._onDidChange.fire()}),50)),this._register(F.filter(this.fileService.onDidFilesChange,n=>n.contains(this.userDataProfileService.currentProfile.keybindingsResource))(()=>{i.debug("Keybindings file changed"),this.reloadConfigurationScheduler.schedule()})),this._register(this.fileService.onDidRunOperation(n=>{n.operation===4&&n.resource.toString()===this.userDataProfileService.currentProfile.keybindingsResource.toString()&&(i.debug("Keybindings file written"),this.reloadConfigurationScheduler.schedule())})),this._register(e.onDidChangeCurrentProfile(n=>n.join(this.whenCurrentProfileChanged(n))))}async whenCurrentProfileChanged(e){this.watch(),this.reloadConfigurationScheduler.schedule()}watch(){this.watchDisposables.clear(),this.watchDisposables.add(this.fileService.watch(pn(this.userDataProfileService.currentProfile.keybindingsResource))),this.watchDisposables.add(this.fileService.watch(this.userDataProfileService.currentProfile.keybindingsResource))}async initialize(){await this.reload()}async reload(){const e=await this.readUserKeybindings();return xa(this._rawKeybindings,e)?!1:(this._rawKeybindings=e,this._keybindings=this._rawKeybindings.map(t=>M6.readUserKeybindingItem(t)),!0)}async readUserKeybindings(){try{const e=await this.fileService.readFile(this.userDataProfileService.currentProfile.keybindingsResource),t=sc(e.value.toString());return Array.isArray(t)?t.filter(i=>i&&typeof i=="object"):[]}catch{return[]}}}const ag=class ag{constructor(){this.commandsSchemas=[],this.commandsEnum=[],this.removalCommandsEnum=[],this.commandsEnumDescriptions=[],this.schema={id:ag.schemaId,type:"array",title:p("keybindings.json.title","Keybindings configuration"),allowTrailingCommas:!0,allowComments:!0,definitions:{editorGroupsSchema:{type:"array",items:{type:"object",properties:{groups:{$ref:"#/definitions/editorGroupsSchema",default:[{},{}]},size:{type:"number",default:.5}}}},commandNames:{type:"string",enum:this.commandsEnum,enumDescriptions:this.commandsEnumDescriptions,description:p("keybindings.json.command","Name of the command to execute")},commandType:{anyOf:[{$ref:"#/definitions/commandNames"},{type:"string",enum:this.removalCommandsEnum,enumDescriptions:this.commandsEnumDescriptions,description:p("keybindings.json.removalCommand","Name of the command to remove keyboard shortcut for")},{type:"string"}]},commandsSchemas:{allOf:this.commandsSchemas}},items:{required:["key"],type:"object",defaultSnippets:[{body:{key:"$1",command:"$2",when:"$3"}}],properties:{key:{type:"string",description:p("keybindings.json.key","Key or key sequence (separated by space)")},command:{anyOf:[{if:{type:"array"},then:{not:{type:"array"},errorMessage:p("keybindings.commandsIsArray",`Incorrect type. Expected "{0}". The field 'command' does not support running multiple commands. Use command 'runCommands' to pass it multiple commands to run.`,"string")},else:{$ref:"#/definitions/commandType"}},{$ref:"#/definitions/commandType"}]},when:{type:"string",description:p("keybindings.json.when","Condition when the key is active.")},args:{description:p("keybindings.json.args","Arguments to pass to the command to execute.")}},$ref:"#/definitions/commandsSchemas"}},this.schemaRegistry=st.as(lk.JSONContribution),this.schemaRegistry.registerSchema(ag.schemaId,this.schema)}updateSchema(e){this.commandsSchemas.length=0,this.commandsEnum.length=0,this.removalCommandsEnum.length=0,this.commandsEnumDescriptions.length=0;const t=new Set,i=(o,a)=>{/^_/.test(o)||t.has(o)||(t.add(o),this.commandsEnum.push(o),this.commandsEnumDescriptions.push(a),this.removalCommandsEnum.push(`-${o}`))},n=Gt.getCommands();for(const[o,a]of n){const c=a.description;if(i(o,c?c.description:void 0),!c||!c.args||c.args.length!==1||!c.args[0].schema)continue;const d=c.args[0].schema,l=typeof c.args[0].isOptional<"u"?!c.args[0].isOptional:Array.isArray(d.required)&&d.required.length>0,u={if:{required:["command"],properties:{command:{const:o}}},then:{required:[].concat(l?["args"]:[]),properties:{args:d}}};this.commandsSchemas.push(u)}const s=Un.getCommands();for(const o of s.keys())i(o);this.commandsSchemas.push(...e),this.schemaRegistry.notifySchemaChanged(ag.schemaId)}};mi(ag,"schemaId","vscode://schemas/keybindings");let rN=ag;function Xwe(r,e){return r.invokeFunction(t=>yJ.getServiceDependencies(e).sort((i,n)=>i.index-n.index).map(i=>t.get(i.id)))}function Jwe(r){const e=r;return class extends e{constructor(...t){super(...t.slice(1),...Xwe(t[0],r))}}}let sN=class extends LG{constructor(e,t,i,n,s,o,a){super(!1,e,t,i,n,s,o,a)}};sN=T([v(1,It),v(2,En),v(3,on),v(4,Te),v(5,ri),v(6,We)],sN);Rd(LG.ID,sN,4);let OD=class oN extends ne{constructor(e){super(),this.editorService=e,this._onHighlightRemoved=this._register(new A),this.onHighlightRemoved=this._onHighlightRemoved.event,this.rangeHighlightDecorationId=null,this.editor=null,this.editorDisposables=this._register(new me)}removeHighlightRange(){if(this.editor&&this.rangeHighlightDecorationId){const e=this.rangeHighlightDecorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e)}),this._onHighlightRemoved.fire()}this.rangeHighlightDecorationId=null}highlightRange(e,t){t=t??this.getEditor(e),Ch(t)?this.doHighlightRange(t,e):_J(t)&&Ch(t.activeCodeEditor)&&this.doHighlightRange(t.activeCodeEditor,e)}doHighlightRange(e,t){this.removeHighlightRange(),e.changeDecorations(i=>{this.rangeHighlightDecorationId=i.addDecoration(t.range,this.createRangeHighlightDecoration(t.isWholeLine))}),this.setEditor(e)}getEditor(e){var i;const t=(i=this.editorService.activeEditor)==null?void 0:i.resource;if(t&&si(t,e.resource)&&Ch(this.editorService.activeTextEditorControl))return this.editorService.activeTextEditorControl}setEditor(e){this.editor!==e&&(this.editorDisposables.clear(),this.editor=e,this.editorDisposables.add(this.editor.onDidChangeCursorPosition(t=>{(t.reason===0||t.reason===3||t.reason===5||t.reason===6)&&this.removeHighlightRange()})),this.editorDisposables.add(this.editor.onDidChangeModel(()=>{this.removeHighlightRange()})),this.editorDisposables.add(this.editor.onDidDispose(()=>{this.removeHighlightRange(),this.editor=null})))}createRangeHighlightDecoration(e=!0){return e?oN._WHOLE_LINE_RANGE_HIGHLIGHT:oN._RANGE_HIGHLIGHT}dispose(){var e;super.dispose(),(e=this.editor)!=null&&e.getModel()&&(this.removeHighlightRange(),this.editor=null)}};OD._WHOLE_LINE_RANGE_HIGHLIGHT=ba.register({description:"codeeditor-range-highlight-whole",stickiness:1,className:"rangeHighlight",isWholeLine:!0});OD._RANGE_HIGHLIGHT=ba.register({description:"codeeditor-range-highlight",stickiness:1,className:"rangeHighlight"});OD=T([v(0,Ke)],OD);let ND=class extends Xq{constructor(e,t,i,n){if(super(),this.editor=e,this.label=t,this._onClick=this._register(new A),this.onClick=this._onClick.event,this._domNode=Ve(".floating-click-widget"),this._domNode.style.padding="6px 11px",this._domNode.style.borderRadius="2px",this._domNode.style.cursor="pointer",this._domNode.style.zIndex="1",i){const s=n.lookupKeybinding(i);s&&(this.label+=` (${s.getLabel()})`)}}getId(){return"editor.overlayWidget.floatingClickWidget"}getDomNode(){return this._domNode}getPosition(){return{preference:1}}render(){Rg(this._domNode),this._domNode.style.backgroundColor=UH(wJ,es(jn)),this._domNode.style.color=UH(bJ,es(yd)),this._domNode.style.border=`1px solid ${es(yt)}`,Fe(this._domNode,Ve("")).textContent=this.label,this.onclick(this._domNode,e=>this._onClick.fire()),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}};ND=T([v(3,Ts)],ND);let aN=class extends ne{constructor(e,t,i,n){if(super(),!(e instanceof EG)){const s=i.createMenu(Ee.EditorContent,n),o=new me,a=()=>{if(o.clear(),!e.hasModel()||e.getOption(59))return;const c=[];if(_k(s,{renderShortTitle:!0,shouldForwardArgs:!0},c),c.length===0)return;const[d]=c,l=t.createInstance(ND,e,d.label,d.id);o.add(l),o.add(l.onClick(()=>d.run(e.getModel().uri))),l.render()};this._store.add(s),this._store.add(o),this._store.add(s.onDidChange(a)),a()}}};aN.ID="editor.contrib.floatingClickMenu";aN=T([v(1,Te),v(2,ib),v(3,It)],aN);let jw=class extends ne{constructor(e,t,i,n){super(),this._diffEditor=e,this._instantiationService=t,this._configurationService=i,this._notificationService=n,this._helperWidget=null,this._helperWidgetListener=null,this._state=0,this._diffEditor instanceof p1||this._register(this._diffEditor.onDidUpdateDiff(()=>{const s=this._diffEditor.getDiffComputationResult();this._setState(this._deduceState(s)),s&&s.quitEarly&&this._notificationService.prompt(wn.Warning,p("hintTimeout","The diff algorithm was stopped early (after {0} ms.)",this._diffEditor.maxComputationTime),[{label:p("removeTimeout","Remove Limit"),run:()=>{this._configurationService.updateValue("diffEditor.maxComputationTime",0)}}],{})}))}_deduceState(e){return e&&this._diffEditor.ignoreTrimWhitespace&&e.changes.length===0&&!e.identical?1:0}_setState(e){this._state!==e&&(this._state=e,this._helperWidgetListener&&(this._helperWidgetListener.dispose(),this._helperWidgetListener=null),this._helperWidget&&(this._helperWidget.dispose(),this._helperWidget=null),this._state===1&&(this._helperWidget=this._instantiationService.createInstance(ND,this._diffEditor.getModifiedEditor(),p("hintWhitespace","Show Whitespace Differences"),null),this._helperWidgetListener=this._helperWidget.onClick(()=>this._onDidClickHelperWidget()),this._helperWidget.render()))}_onDidClickHelperWidget(){this._state===1&&this._configurationService.updateValue("diffEditor.ignoreTrimWhitespace",!1)}dispose(){super.dispose()}};jw.ID="editor.contrib.diffEditorHelper";jw=T([v(1,Te),v(2,We),v(3,on)],jw);FG(jw.ID,jw);let Bw=class extends ne{constructor(e,t,i){super(),this._editor=e,this._notificationService=t,this._configurationService=i,this._register(this._editor.onDidChangeModel(n=>this._update())),this._update()}_update(){const e=this._editor.getModel();if(e&&e.isTooLargeForTokenization()){const t=p({key:"largeFile",comment:["Variable 0 will be a file name."]},"{0}: tokenization, wrapping and folding have been turned off for this large file in order to reduce memory usage and avoid freezing or crashing.",Yn(e.uri.path));this._notificationService.prompt(wn.Info,t,[{label:p("removeOptimizations","Forcefully Enable Features"),run:()=>{this._configurationService.updateValue("editor.largeFileOptimizations",!1).then(()=>{this._notificationService.info(p("reopenFilePrompt","Please reopen file in order for this setting to take effect."))},i=>{this._notificationService.error(i)})}}],{neverShowAgain:{id:"editor.contrib.largeFileOptimizationsWarner"}})}}};Bw.ID="editor.contrib.largeFileOptimizationsWarner";Bw=T([v(1,on),v(2,We)],Bw);Rd(Bw.ID,Bw,1);var Zwe=".token-inspect-widget{border:1px solid var(--vscode-editorHoverWidget-border);padding:10px;user-select:text;-webkit-user-select:text;z-index:50}.hc-black .tokens-inspect-widget,.hc-light .tokens-inspect-widget{border-width:2px}.monaco-editor .token-inspect-widget{background-color:var(--vscode-editorHoverWidget-background)}.monaco-editor .token-inspect-widget .tiw-metadata-separator{background-color:var(--vscode-editorHoverWidget-border)}.tiw-token{font-family:var(--monaco-monospace-font)}.tiw-metadata-separator{border:0;height:1px}.tiw-token-length{float:right;font-size:60%;font-weight:400}.tiw-metadata-table{width:100%}.tiw-metadata-value{font-family:var(--monaco-monospace-font);word-break:break-word}.tiw-metadata-values{list-style:none;margin-right:-10px;max-height:300px;overflow-y:auto;padding-left:0}.tiw-metadata-values>.tiw-metadata-value{margin-right:10px}.tiw-metadata-key{min-width:150px;padding-right:10px;vertical-align:top;white-space:nowrap;width:1px}.tiw-metadata-semantic{font-style:italic}.tiw-metadata-scopes{line-height:normal}.tiw-theme-selector{font-family:var(--monaco-monospace-font)}";Ic(Zwe,{});function ebe(r,e,t=!0){for(let i=e.length-1;i>=0;i--){const n=e.slice(0,i),s=e[i],o=tbe(r,s,n,t);if(o)return o}return null}function tbe(r,e,t,i){let n=null;for(let s=r.tokenColors.length-1;s>=0;s--){const o=r.tokenColors[s];if(i&&!o.settings.foreground)continue;let a;if(typeof o.scope=="string")a=o.scope.split(/,/).map(c=>c.trim());else if(Array.isArray(o.scope))a=o.scope;else continue;for(let c=0,d=a.length;c<d;c++){const l=a[c],u=new $D(l,o.settings);u.matches(e,t)&&u.isMoreSpecific(n)&&(n=u)}}return n}class $D{constructor(e,t){this.rawSelector=e,this.settings=t;const i=this.rawSelector.split(/ /);this.scope=i[i.length-1],this.parentScopes=i.slice(0,i.length-1)}matches(e,t){return $D._matches(this.scope,this.parentScopes,e,t)}static _cmp(e,t){if(e===null&&t===null)return 0;if(e===null)return-1;if(t===null)return 1;if(e.scope.length!==t.scope.length)return e.scope.length-t.scope.length;const i=e.parentScopes.length,n=t.parentScopes.length;if(i!==n)return i-n;for(let s=0;s<i;s++){const o=e.parentScopes[s].length,a=t.parentScopes[s].length;if(o!==a)return o-a}return 0}isMoreSpecific(e){return $D._cmp(this,e)>0}static _matchesOne(e,t){const i=e+".";return e===t||t.substring(0,i.length)===i}static _matches(e,t,i,n){if(!this._matchesOne(e,i))return!1;let s=t.length-1,o=n.length-1;for(;s>=0&&o>=0;)this._matchesOne(t[s],n[o])&&s--,o--;return s===-1}}const ibe=Rf(Fi),PHe="vs",AHe="vs-dark",MHe="hc-black",LHe="hc-light",FHe="[",OHe="]",NHe="*",$He=/\[(.+?)\]/g;var M2;(function(r){r.COLOR_THEME="workbench.colorTheme",r.FILE_ICON_THEME="workbench.iconTheme",r.PRODUCT_ICON_THEME="workbench.productIconTheme",r.COLOR_CUSTOMIZATIONS="workbench.colorCustomizations",r.TOKEN_COLOR_CUSTOMIZATIONS="editor.tokenColorCustomizations",r.SEMANTIC_TOKEN_COLOR_CUSTOMIZATIONS="editor.semanticTokenColorCustomizations",r.PREFERRED_DARK_THEME="workbench.preferredDarkColorTheme",r.PREFERRED_LIGHT_THEME="workbench.preferredLightColorTheme",r.PREFERRED_HC_DARK_THEME="workbench.preferredHighContrastColorTheme",r.PREFERRED_HC_LIGHT_THEME="workbench.preferredHighContrastLightColorTheme",r.DETECT_COLOR_SCHEME="window.autoDetectColorScheme",r.DETECT_HC="window.autoDetectHighContrast"})(M2||(M2={}));var L2;(function(r){r.COLOR_THEME_DARK="Default Dark Modern",r.COLOR_THEME_LIGHT="Default Light Modern",r.COLOR_THEME_HC_DARK="Default High Contrast",r.COLOR_THEME_HC_LIGHT="Default High Contrast Light",r.COLOR_THEME_DARK_OLD="Default Dark+",r.COLOR_THEME_LIGHT_OLD="Default Light+",r.FILE_ICON_THEME="vs-seti",r.PRODUCT_ICON_THEME="Default"})(L2||(L2={}));const WHe={"activityBar.background":"#181818","statusBar.background":"#181818","statusBar.noFolderBackground":"#1f1f1f"},HHe={"activityBar.background":"#f8f8f8","statusBar.background":"#f8f8f8","statusBar.noFolderBackground":"#f8f8f8"};var F2;(function(r){function e(n){return n&&{_extensionId:n.extensionId,_extensionIsBuiltin:n.extensionIsBuiltin,_extensionName:n.extensionName,_extensionPublisher:n.extensionPublisher}}r.toJSONObject=e;function t(n){if(n&&Rt(n._extensionId)&&DP(n._extensionIsBuiltin)&&Rt(n._extensionName)&&Rt(n._extensionPublisher))return{extensionId:n._extensionId,extensionIsBuiltin:n._extensionIsBuiltin,extensionName:n._extensionName,extensionPublisher:n._extensionPublisher}}r.fromJSONObject=t;function i(n,s,o=!1){return{extensionPublisher:n,extensionId:`${n}.${s}`,extensionName:s,extensionIsBuiltin:o}}r.fromName=i})(F2||(F2={}));const ft=Ve;let Tf=class L6 extends ne{static get(e){return e.getContribution(L6.ID)}constructor(e,t,i,n,s,o,a){super(),this._editor=e,this._textMateService=t,this._themeService=n,this._languageService=i,this._notificationService=s,this._configurationService=o,this._languageFeaturesService=a,this._widget=null,this._register(this._editor.onDidChangeModel(c=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(c=>this.stop())),this._register(this._editor.onKeyUp(c=>c.keyCode===9&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&this._editor.getModel().uri.scheme!==pe.vscodeNotebookCell&&(this._widget=new cN(this._editor,this._textMateService,this._languageService,this._themeService,this._notificationService,this._configurationService,this._languageFeaturesService))}stop(){this._widget&&(this._widget.dispose(),this._widget=null)}toggle(){this._widget?this.stop():this.launch()}};Tf.ID="editor.contrib.inspectEditorTokens";Tf=T([v(1,w3),v(2,ji),v(3,ibe),v(4,on),v(5,We),v(6,Lf)],Tf);class nbe extends $f{constructor(){super({id:"editor.action.inspectTMScopes",label:p("inspectEditorTokens","Developer: Inspect Editor Tokens and Scopes"),alias:"Developer: Inspect Editor Tokens and Scopes",precondition:void 0})}run(e,t){const i=Tf.get(t);i==null||i.toggle()}}function O2(r){r.length>40&&(r=r.substr(0,20)+"…"+r.substr(r.length-20));let e="";for(let t=0,i=r.length;t<i;t++){const n=r.charCodeAt(t);switch(n){case 9:e+="→";break;case 32:e+="·";break;default:e+=String.fromCharCode(n)}}return e}const ZD=class ZD extends ne{constructor(e,t,i,n,s,o,a){super(),this.allowEditorOverflow=!0,this._isDisposed=!1,this._editor=e,this._languageService=i,this._themeService=n,this._textMateService=t,this._notificationService=s,this._configurationService=o,this._languageFeaturesService=a,this._model=this._editor.getModel(),this._domNode=document.createElement("div"),this._domNode.className="token-inspect-widget",this._currentRequestCancellationTokenSource=new Xt,this._beginCompute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(c=>this._beginCompute(this._editor.getPosition()))),this._register(n.onDidColorThemeChange(c=>this._beginCompute(this._editor.getPosition()))),this._register(o.onDidChangeConfiguration(c=>c.affectsConfiguration("editor.semanticHighlighting.enabled")&&this._beginCompute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._isDisposed=!0,this._editor.removeContentWidget(this),this._currentRequestCancellationTokenSource.cancel(),super.dispose()}getId(){return ZD._ID}_beginCompute(e){const t=this._textMateService.createGrammar(this._model.getLanguageId()),i=this._computeSemanticTokens(e);Rg(this._domNode),this._domNode.appendChild(document.createTextNode(p("inspectTMScopesWidget.loading","Loading..."))),Promise.all([t,i]).then(([n,s])=>{this._isDisposed||(this._compute(n,s,e),this._domNode.style.maxWidth=`${Math.max(this._editor.getLayoutInfo().width*.66,500)}px`,this._editor.layoutContentWidget(this))},n=>{this._notificationService.warn(n),setTimeout(()=>{var s;(s=Tf.get(this._editor))==null||s.stop()})})}_isSemanticColoringEnabled(){var t;const e=(t=this._configurationService.getValue(SJ,{overrideIdentifier:this._model.getLanguageId(),resource:this._model.uri}))==null?void 0:t.enabled;return typeof e=="boolean"?e:this._themeService.getColorTheme().semanticHighlighting}_compute(e,t,i){var u;const n=e&&this._getTokensAtPosition(e,i),s=t&&this._getSemanticTokenAtPosition(t,i);if(!n&&!s){TC(this._domNode,"No grammar or semantic tokens available.");return}const o=n==null?void 0:n.metadata,a=s==null?void 0:s.metadata,c=s&&O2(this._model.getValueInRange(s.range)),d=n&&O2(this._model.getLineContent(i.lineNumber).substring(n.token.startIndex,n.token.endIndex)),l=c||d||"";if(TC(this._domNode,ft("h2.tiw-token",void 0,l,ft("span.tiw-token-length",void 0,`${l.length} ${l.length===1?"char":"chars"}`))),Fe(this._domNode,ft("hr.tiw-metadata-separator",{style:"clear:both"})),Fe(this._domNode,ft("table.tiw-metadata-table",void 0,ft("tbody",void 0,ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"language"),ft("td.tiw-metadata-value",void 0,(o==null?void 0:o.languageId)||"")),ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"standard token type"),ft("td.tiw-metadata-value",void 0,this._tokenTypeToString((o==null?void 0:o.tokenType)||0))),...this._formatMetadata(a,o)))),s){Fe(this._domNode,ft("hr.tiw-metadata-separator"));const h=Fe(this._domNode,ft("table.tiw-metadata-table",void 0)),g=Fe(h,ft("tbody",void 0,ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"semantic token type"),ft("td.tiw-metadata-value",void 0,s.type))));if(s.modifiers.length&&Fe(g,ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"modifiers"),ft("td.tiw-metadata-value",void 0,s.modifiers.join(" ")))),s.metadata){const m=["foreground","bold","italic","underline","strikethrough"],y={},_=new Array;for(const b of m)if(s.metadata[b]!==void 0){const E=s.definitions[b],D=this._renderTokenStyleDefinition(E,b),R=D.map(O=>O instanceof HTMLElement?O.outerHTML:O).join();let M=y[R];M||(y[R]=M=[],_.push([D,R])),M.push(b)}for(const[b,E]of _)Fe(g,ft("tr",void 0,ft("td.tiw-metadata-key",void 0,y[E].join(", ")),ft("td.tiw-metadata-value",void 0,...b)))}}if(n){const h=this._themeService.getColorTheme();Fe(this._domNode,ft("hr.tiw-metadata-separator"));const g=Fe(this._domNode,ft("table.tiw-metadata-table")),m=Fe(g,ft("tbody"));d&&d!==l&&Fe(m,ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"textmate token"),ft("td.tiw-metadata-value",void 0,`${d} (${d.length})`)));const y=new Array;for(let E=n.token.scopes.length-1;E>=0;E--)y.push(n.token.scopes[E]),E>0&&y.push(ft("br"));Fe(m,ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"textmate scopes"),ft("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...y)));const _=ebe(h,n.token.scopes,!1),b=(u=s==null?void 0:s.metadata)==null?void 0:u.foreground;if(_){if(b!==n.metadata.foreground){let E=ft("code.tiw-theme-selector",void 0,_.rawSelector,ft("br"),JSON.stringify(_.settings,null,"	"));b&&(E=ft("s",void 0,E)),Fe(m,ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"foreground"),ft("td.tiw-metadata-value",void 0,E)))}}else b||Fe(m,ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"foreground"),ft("td.tiw-metadata-value",void 0,"No theme selector")))}}_formatMetadata(e,t){const i=new Array;function n(d){const l=(e==null?void 0:e[d])||(t==null?void 0:t[d]);if(l!==void 0){const u=e!=null&&e[d]?"tiw-metadata-semantic":"";i.push(ft("tr",void 0,ft("td.tiw-metadata-key",void 0,d),ft(`td.tiw-metadata-value.${u}`,void 0,l)))}return l}const s=n("foreground"),o=n("background");if(s&&o){const d=Ue.fromHex(o),l=Ue.fromHex(s);d.isOpaque()?i.push(ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"contrast ratio"),ft("td.tiw-metadata-value",void 0,d.getContrastRatio(l.makeOpaque(d)).toFixed(2)))):i.push(ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"Contrast ratio cannot be precise for background colors that use transparency"),ft("td.tiw-metadata-value")))}const a=new Array;function c(d){let l;e&&e[d]?l=ft("span.tiw-metadata-semantic",void 0,d):t&&t[d]&&(l=d),l&&(a.length&&a.push(" "),a.push(l))}return c("bold"),c("italic"),c("underline"),c("strikethrough"),a.length&&i.push(ft("tr",void 0,ft("td.tiw-metadata-key",void 0,"font style"),ft("td.tiw-metadata-value",void 0,...a))),i}_decodeMetadata(e){const t=this._themeService.getColorTheme().tokenColorMap,i=hv.getLanguageId(e),n=hv.getTokenType(e),s=hv.getFontStyle(e),o=hv.getForeground(e),a=hv.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(i),tokenType:n,bold:s&2?!0:void 0,italic:s&1?!0:void 0,underline:s&4?!0:void 0,strikethrough:s&8?!0:void 0,foreground:t[o],background:t[a]}}_tokenTypeToString(e){switch(e){case 0:return"Other";case 1:return"Comment";case 2:return"String";case 3:return"RegEx";default:return"??"}}_getTokensAtPosition(e,t){const i=t.lineNumber,n=this._getStateBeforeLine(e,i),s=e.tokenizeLine(this._model.getLineContent(i),n),o=e.tokenizeLine2(this._model.getLineContent(i),n);let a=0;for(let d=s.tokens.length-1;d>=0;d--){const l=s.tokens[d];if(t.column-1>=l.startIndex){a=d;break}}let c=0;for(let d=o.tokens.length>>>1;d>=0;d--)if(t.column-1>=o.tokens[d<<1]){c=d;break}return{token:s.tokens[a],metadata:this._decodeMetadata(o.tokens[(c<<1)+1])}}_getStateBeforeLine(e,t){let i=null;for(let n=1;n<t;n++)i=e.tokenizeLine(this._model.getLineContent(n),i).ruleStack;return i}isSemanticTokens(e){return e&&e.data}async _computeSemanticTokens(e){if(!this._isSemanticColoringEnabled())return null;const t=this._languageFeaturesService.documentSemanticTokensProvider.ordered(this._model);if(t.length){const n=t[0],s=await Promise.resolve(n.provideDocumentSemanticTokens(this._model,null,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(s))return{tokens:s,legend:n.getLegend()}}const i=this._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(this._model);if(i.length){const n=i[0],s=e.lineNumber,o=new qe(s,1,s,this._model.getLineMaxColumn(s)),a=await Promise.resolve(n.provideDocumentRangeSemanticTokens(this._model,o,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(a))return{tokens:a,legend:n.getLegend()}}return null}_getSemanticTokenAtPosition(e,t){const i=e.tokens.data,n=this._model.getLanguageId();let s=0,o=0;const a=t.lineNumber-1,c=t.column-1;for(let d=0;d<i.length;d+=5){const l=i[d],u=i[d+1],h=i[d+2],g=i[d+3],m=i[d+4],y=s+l,_=l===0?o+u:u;if(a===y&&_<=c&&c<_+h){const b=e.legend.tokenTypes[g]||"not in legend (ignored)",E=[];let D=m;for(let K=0;D>0&&K<e.legend.tokenModifiers.length;K++)D&1&&E.push(e.legend.tokenModifiers[K]),D=D>>1;D>0&&E.push("not in legend (ignored)");const R=new qe(y+1,_+1,y+1,_+1+h),M={},O=this._themeService.getColorTheme().tokenColorMap,W=this._themeService.getColorTheme().getTokenStyleMetadata(b,E,n,!0,M);let Z;return W&&(Z={languageId:void 0,tokenType:0,bold:W==null?void 0:W.bold,italic:W==null?void 0:W.italic,underline:W==null?void 0:W.underline,strikethrough:W==null?void 0:W.strikethrough,foreground:O[(W==null?void 0:W.foreground)||0],background:void 0}),{type:b,modifiers:E,range:R,metadata:Z,definitions:M}}s=y,o=_}return null}_renderTokenStyleDefinition(e,t){const i=new Array;if(e===void 0)return i;const n=this._themeService.getColorTheme();if(Array.isArray(e)){const s={};n.resolveScopes(e,s);const o=s[t];if(o&&s.scope){const a=ft("ul.tiw-metadata-values"),c=Array.isArray(o.scope)?o.scope:[String(o.scope)];for(const d of c)a.appendChild(ft("li.tiw-metadata-value.tiw-metadata-scopes",void 0,d));return i.push(s.scope.join(" "),a,ft("code.tiw-theme-selector",void 0,JSON.stringify(o.settings,null,"	"))),i}return i}else if(xF.is(e)){const s=n.getTokenStylingRuleScope(e);return s==="setting"?(i.push(`User settings: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),i):(s==="theme"&&i.push(`Color theme: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),i)}else{const s=n.resolveTokenStyleValue(e);return i.push(`Default: ${s?this._renderStyleProperty(s,t):""}`),i}}_renderStyleProperty(e,t){switch(t){case"foreground":return e.foreground?Ue.Format.CSS.formatHexA(e.foreground,!0):"";default:return e[t]!==void 0?String(e[t]):""}}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[2,1]}}};mi(ZD,"_ID","editor.contrib.inspectEditorTokensWidget");let cN=ZD;Rd(Tf.ID,Tf,4);Nf(nbe);var rbe='.monaco-editor .dirty-diff-glyph{margin-left:5px;z-index:5}.monaco-editor .dirty-diff-glyph:before{content:"";height:100%;left:-2px;position:absolute;width:0}.monaco-workbench:not(.reduce-motion) .monaco-editor .dirty-diff-glyph:before{transition:width 80ms linear,left 80ms linear,transform 80ms linear}.monaco-editor.modified-in-monaco-diff-editor .margin-view-overlays>div>.dirty-diff-glyph{display:none}.monaco-editor .dirty-diff-added{border-left-color:var(--vscode-editorGutter-addedBackground);border-left-style:solid}.monaco-editor .dirty-diff-added:before{background:var(--vscode-editorGutter-addedBackground)}.monaco-editor .dirty-diff-added-pattern{background-repeat:repeat-y}.monaco-editor .dirty-diff-added-pattern,.monaco-editor .dirty-diff-added-pattern:before{background-image:linear-gradient(-45deg,var(--vscode-editorGutter-addedBackground) 25%,var(--vscode-editorGutter-background) 25%,var(--vscode-editorGutter-background) 50%,var(--vscode-editorGutter-addedBackground) 50%,var(--vscode-editorGutter-addedBackground) 75%,var(--vscode-editorGutter-background) 75%,var(--vscode-editorGutter-background))}.monaco-editor .dirty-diff-added-pattern:before{transform:translateX(3px)}.monaco-editor .dirty-diff-modified{border-left-color:var(--vscode-editorGutter-modifiedBackground);border-left-style:solid}.monaco-editor .dirty-diff-modified:before{background:var(--vscode-editorGutter-modifiedBackground)}.monaco-editor .dirty-diff-modified-pattern{background-image:linear-gradient(-45deg,var(--vscode-editorGutter-modifiedBackground) 25%,var(--vscode-editorGutter-background) 25%,var(--vscode-editorGutter-background) 50%,var(--vscode-editorGutter-modifiedBackground) 50%,var(--vscode-editorGutter-modifiedBackground) 75%,var(--vscode-editorGutter-background) 75%,var(--vscode-editorGutter-background));background-repeat:repeat-y}.monaco-workbench:not(.reduce-motion) .monaco-editor .dirty-diff-added,.monaco-workbench:not(.reduce-motion) .monaco-editor .dirty-diff-added-pattern,.monaco-workbench:not(.reduce-motion) .monaco-editor .dirty-diff-modified,.monaco-workbench:not(.reduce-motion) .monaco-editor .dirty-diff-modified-pattern{transition:opacity .5s}.monaco-editor .dirty-diff-modified-pattern:before{background-image:linear-gradient(-45deg,var(--vscode-editorGutter-modifiedBackground) 25%,var(--vscode-editorGutter-background) 25%,var(--vscode-editorGutter-background) 50%,var(--vscode-editorGutter-modifiedBackground) 50%,var(--vscode-editorGutter-modifiedBackground) 75%,var(--vscode-editorGutter-background) 75%,var(--vscode-editorGutter-background));transform:translateX(3px)}.monaco-editor .margin:hover .dirty-diff-added,.monaco-editor .margin:hover .dirty-diff-added-pattern,.monaco-editor .margin:hover .dirty-diff-modified,.monaco-editor .margin:hover .dirty-diff-modified-pattern{opacity:1}.monaco-editor .dirty-diff-deleted:after{border-bottom:4px solid transparent;border-left:4px solid var(--vscode-editorGutter-deletedBackground);border-top:4px solid transparent;bottom:-4px;box-sizing:border-box;content:"";height:0;pointer-events:none;position:absolute;width:4px;z-index:9}.monaco-workbench:not(.reduce-motion) .monaco-editor .dirty-diff-deleted:after{transition:border-top-width 80ms linear,border-bottom-width 80ms linear,bottom 80ms linear,opacity .5s}.monaco-editor .dirty-diff-deleted:before{background:var(--vscode-editorGutter-deletedBackground);bottom:0;height:0;margin-left:3px}.monaco-workbench:not(.reduce-motion) .monaco-editor .dirty-diff-deleted:before{transition:height 80ms linear}.dirty-diff .peekview-title .dropdown{margin-right:10px}.dirty-diff .peekview-title .dropdown.select-container{cursor:default}.dirty-diff .peekview-title .dropdown .monaco-select-box{cursor:pointer;min-height:18px;min-width:100px;padding:0 23px 0 8px}';Ic(rbe,{});let dN=class extends CJ{constructor(e,t,i,n,s){const o=t.map(g=>({provider:g,text:g}));let a=t.indexOf(i);a===-1&&(a=0);const c={...EJ},d=s.getColorTheme(),l=d.getColor(jn),u=d.getColor(OG),h=(u==null?void 0:u.makeOpaque(l))??l;c.selectBackground=h.lighten(.6).toString(),super(null,e,o,a,n,c,{ariaLabel:p("remotes","Switch quick diff base")}),this.optionsItems=o}setSelection(e){const t=this.optionsItems.findIndex(i=>i.provider===e);this.select(t)}getActionContext(e,t){return this.optionsItems[t]}render(e){super.render(e),this.setFocusable(!0)}};dN=T([v(3,fk),v(4,Fi)],dN);class Nm extends Zn{constructor(e){super(Nm.ID,Nm.LABEL,void 0,void 0),this.callback=e}async run(e){return this.callback(e)}}Nm.ID="quickDiff.base.switch";Nm.LABEL=p("quickDiff.base.switch","Switch Quick Diff Base");class sbe extends tb{runAction(e,t){return e instanceof l1?e.run(...t):super.runAction(e,t)}}const F6=new G("dirtyDiffVisible",!1);function obe(r){const e=r.modifiedEndLineNumber-r.modifiedStartLineNumber+1,t=r.originalEndLineNumber-r.originalStartLineNumber+1;return r.originalEndLineNumber===0?e:r.modifiedEndLineNumber===0?t:e+t}function abe(r){return r.modifiedEndLineNumber===0?r.modifiedStartLineNumber===0?1:r.modifiedStartLineNumber:r.modifiedEndLineNumber}function cbe(r,e){return r===1&&e.modifiedStartLineNumber===0&&e.modifiedEndLineNumber===0?!0:r>=e.modifiedStartLineNumber&&r<=(e.modifiedEndLineNumber||e.modifiedStartLineNumber)}let Hy=class extends Zn{constructor(e,t,i,n,s){const o=n.lookupKeybinding(t.id),a=t.label+(o?` (${o.getLabel()})`:"");super(t.id,a,i),this.instantiationService=s,this.action=t,this.editor=e}run(){return Promise.resolve(this.instantiationService.invokeFunction(e=>this.action.run(e,this.editor,null)))}};Hy=T([v(3,Ts),v(4,Te)],Hy);var Ea;(function(r){r[r.Modify=0]="Modify",r[r.Add=1]="Add",r[r.Delete=2]="Delete"})(Ea||(Ea={}));function O6(r){return r.originalEndLineNumber===0?Ea.Add:r.modifiedEndLineNumber===0?Ea.Delete:Ea.Modify}function dbe(r,e){switch(e){case Ea.Modify:return r.getColor(rd);case Ea.Add:return r.getColor(sd);case Ea.Delete:return r.getColor(od)}}function yb(r){const e=r.get(En).listDiffEditors();for(const t of e)if(t.hasTextFocus()&&t instanceof p1)return t.getParentEditor();return xJ(r)}let lN=class extends DJ{constructor(e,t,i,n,s,o){super(e,{isResizeable:!0,frameWidth:1,keepEditorSelection:!0,className:"dirty-diff"},n),this.model=t,this.themeService=i,this.menuService=s,this.contextKeyService=o,this._index=0,this._provider="",this.height=void 0,this._disposables.add(i.onDidColorThemeChange(this._applyTheme,this)),this._applyTheme(i.getColorTheme()),this.model.original.length>0&&(o=o.createOverlay([["originalResourceScheme",this.model.original[0].uri.scheme],["originalResourceSchemes",this.model.original.map(a=>a.uri.scheme)]])),this.create(),e.hasModel()?this.title=Mt(e.getModel().uri):this.title="",this.setTitle(this.title)}get provider(){return this._provider}get index(){return this._index}get visibleRange(){const e=this.diffEditor.getModifiedEditor().getVisibleRanges();return e.length>=0?e[0]:void 0}showChange(e,t=!0){var b;const i=this.model.changes[e],n=i.change;if(this._index=e,this.contextKeyService.createKey("originalResourceScheme",this.model.changes[e].uri.scheme),this.updateActions(),this._provider=i.label,this.change=n,!this.model.original)return;F.once(this.diffEditor.onDidUpdateDiff)(()=>setTimeout(()=>this.revealChange(n),0));const a=this.model.getDiffEditorModel(i.uri.toString());if(!a)return;this.diffEditor.setModel(a),(b=this.dropdown)==null||b.setSelection(i.label);const c=new Us(abe(n),1),d=this.editor.getOption(64),l=this.editor.getLayoutInfo().height,u=Math.floor(l/d),h=Math.min(obe(n)+8,Math.floor(u/3));this.renderTitle(i.label);const g=O6(n),m=dbe(this.themeService.getColorTheme(),g);this.style({frameColor:m,arrowColor:m});const y=[];let _=e;for(const E of this.model.changes)E.label===this.model.changes[this._index].label&&(y.push(E.change),i===E&&(_=y.length-1));this._actionbarWidget.context=[a.modified.uri,y,_],t&&this.show(c,h),this.editor.focus()}renderTitle(e){const t=this.model.mapChanges.get(e),i=t.indexOf(this._index);let n;this.shouldUseDropdown()?(n=this.model.changes.length>1?p("multiChanges","{0} of {1} changes",i+1,t.length):p("multiChange","{0} of {1} change",i+1,t.length),this.dropdownContainer.style.display="inherit"):(n=this.model.changes.length>1?p("changes","{0} - {1} of {2} changes",e,i+1,t.length):p("change","{0} - {1} of {2} change",e,i+1,t.length),this.dropdownContainer.style.display="none"),this.setTitle(this.title,n)}switchQuickDiff(e){const t=e==null?void 0:e.provider;if(t===this.model.changes[this._index].label)return;let i=this._index<this.model.changes.length-1?this._index+1:0;for(let o=i;o!==this._index;o<this.model.changes.length-1?o++:o=0)if(this.model.changes[o].label===t){i=o;break}let n=this._index>0?this._index-1:this.model.changes.length-1;for(let o=n;o!==this._index;o>=0?o--:o=this.model.changes.length-1)if(this.model.changes[o].label===t){n=o;break}const s=Math.abs(this.model.changes[i].change.modifiedEndLineNumber-this.model.changes[this._index].change.modifiedEndLineNumber)<Math.abs(this.model.changes[n].change.modifiedEndLineNumber-this.model.changes[this._index].change.modifiedEndLineNumber)?i:n;this.showChange(s,!1)}shouldUseDropdown(){let e=0;if(this.model.mapChanges.size>1){const t=Array.from(this.model.mapChanges.keys());for(let i=0;i<t.length&&e<=1;i++)this.model.mapChanges.get(t[i]).length>0&&e++}return e>=2}updateActions(){if(!this._actionbarWidget)return;const e=this.instantiationService.createInstance(Hy,this.editor,new N6(this.editor),Si.asClassName(kJ)),t=this.instantiationService.createInstance(Hy,this.editor,new $6(this.editor),Si.asClassName(TJ));this._disposables.add(e),this._disposables.add(t);const i=[];this.menu&&this.menu.dispose(),this.menu=this.menuService.createMenu(Ee.SCMChangeContext,this.contextKeyService),_k(this.menu,{shouldForwardArgs:!0},i),this._actionbarWidget.clear(),this._actionbarWidget.push(i.reverse(),{label:!1,icon:!0}),this._actionbarWidget.push([t,e],{label:!1,icon:!0}),this._actionbarWidget.push(new Zn("peekview.close",p("label.close","Close"),Si.asClassName(jt.close),!0,()=>this.dispose()),{label:!1,icon:!0})}_fillHead(e){super._fillHead(e,!0),this.dropdownContainer=IJ(this._titleElement,Ve(".dropdown")),this.dropdown=this.instantiationService.createInstance(dN,new Nm(t=>this.switchQuickDiff(t)),this.model.quickDiffs.map(t=>t.label),this.model.changes[this._index].label),this.dropdown.render(this.dropdownContainer),this.updateActions()}_getActionBarOptions(){const e=new sbe;return e.onDidRun(t=>{!(t.action instanceof Hy)&&!t.error&&this.dispose()}),{...super._getActionBarOptions(),actionRunner:e}}_fillBody(e){const t={scrollBeyondLastLine:!0,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1},renderSideBySide:!1,readOnly:!1,renderIndicators:!1,diffAlgorithm:"advanced",stickyScroll:{enabled:!1}};this.diffEditor=this.instantiationService.createInstance(p1,e,t,{},this.editor),this._disposables.add(this.diffEditor)}_onWidth(e){typeof this.height>"u"||this.diffEditor.layout({height:this.height,width:e})}_doLayoutBody(e,t){super._doLayoutBody(e,t),this.diffEditor.layout({height:e,width:t}),typeof this.height>"u"&&this.change&&this.revealChange(this.change),this.height=e}revealChange(e){let t,i;e.modifiedEndLineNumber===0?(t=e.modifiedStartLineNumber,i=e.modifiedStartLineNumber+1):e.originalEndLineNumber>0?(t=e.modifiedStartLineNumber-1,i=e.modifiedEndLineNumber+1):(t=e.modifiedStartLineNumber,i=e.modifiedEndLineNumber),this.diffEditor.revealLinesInCenter(t,i,1)}_applyTheme(e){const t=e.getColor(CG)||Ue.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(OG)||Ue.transparent,primaryHeadingColor:e.getColor(RJ),secondaryHeadingColor:e.getColor(PJ)})}revealRange(e){this.editor.revealLineInCenterIfOutsideViewport(e.endLineNumber,0)}hasFocus(){return this.diffEditor.hasTextFocus()}dispose(){var e;super.dispose(),(e=this.menu)==null||e.dispose()}};lN=T([v(2,Fi),v(3,Te),v(4,ib),v(5,It)],lN);class N6 extends $f{constructor(e){super({id:"editor.action.dirtydiff.previous",label:p("show previous change","Show Previous Change"),alias:"Show Previous Change",precondition:Kl.toNegated(),kbOpts:{kbExpr:vo.editorTextFocus,primary:1597,weight:100}}),this.outerEditor=e}run(e){const t=this.outerEditor??yb(e);if(!t)return;const i=xc.get(t);i&&i.canNavigate()&&i.previous()}}Nf(N6);class $6 extends $f{constructor(e){super({id:"editor.action.dirtydiff.next",label:p("show next change","Show Next Change"),alias:"Show Next Change",precondition:Kl.toNegated(),kbOpts:{kbExpr:vo.editorTextFocus,primary:573,weight:100}}),this.outerEditor=e}run(e){const t=this.outerEditor??yb(e);if(!t)return;const i=xc.get(t);i&&i.canNavigate()&&i.next()}}Nf($6);Un.appendMenuItem(Ee.MenubarGoMenu,{group:"7_change_nav",command:{id:"editor.action.dirtydiff.next",title:p({key:"miGotoNextChange",comment:["&& denotes a mnemonic"]},"Next &&Change")},order:1});Un.appendMenuItem(Ee.MenubarGoMenu,{group:"7_change_nav",command:{id:"editor.action.dirtydiff.previous",title:p({key:"miGotoPreviousChange",comment:["&& denotes a mnemonic"]},"Previous &&Change")},order:2});class lbe extends $f{constructor(){super({id:"workbench.action.editor.previousChange",label:p("move to previous change","Go to Previous Change"),alias:"Go to Previous Change",precondition:Kl.toNegated(),kbOpts:{kbExpr:vo.editorTextFocus,primary:1599,weight:100}})}async run(e){const t=yb(e),i=e.get(g1),n=e.get(Af),s=e.get(En);if(!t||!t.hasModel())return;const o=xc.get(t);if(!o||!o.modelRegistry)return;const a=t.getPosition().lineNumber,c=o.modelRegistry.getModel(t.getModel());if(!c||c.changes.length===0)return;const d=c.findPreviousClosestChange(a,!1),l=c.changes[d];await H6(l.change,i),W6(l.change,t,n,s)}}Nf(lbe);class ube extends $f{constructor(){super({id:"workbench.action.editor.nextChange",label:p("move to next change","Go to Next Change"),alias:"Go to Next Change",precondition:Kl.toNegated(),kbOpts:{kbExpr:vo.editorTextFocus,primary:575,weight:100}})}async run(e){const t=e.get(g1),i=yb(e),n=e.get(Af),s=e.get(En);if(!i||!i.hasModel())return;const o=xc.get(i);if(!o||!o.modelRegistry)return;const a=i.getPosition().lineNumber,c=o.modelRegistry.getModel(i.getModel());if(!c||c.changes.length===0)return;const d=c.findNextClosestChange(a,!1),l=c.changes[d].change;await H6(l,t),W6(l,i,n,s)}}function W6(r,e,t,i){var s;const n=new Us(r.modifiedStartLineNumber,1);e.setPosition(n),e.revealPositionInCenter(n),t.isScreenReaderOptimized()&&(e.setSelection({startLineNumber:r.modifiedStartLineNumber,startColumn:0,endLineNumber:r.modifiedStartLineNumber,endColumn:Number.MAX_VALUE}),(s=i.getActiveCodeEditor())==null||s.writeScreenReaderContent("diff-navigation"))}async function H6(r,e){switch(O6(r)){case Ea.Add:e.playAudioCue(mS.diffLineInserted,!0);break;case Ea.Delete:e.playAudioCue(mS.diffLineDeleted,!0);break;case Ea.Modify:e.playAudioCue(mS.diffLineModified,!0);break}}Nf(ube);Xi.registerCommandAndKeybindingRule({id:"closeDirtyDiff",weight:100+50,primary:9,secondary:[1033],when:nt.and(F6),handler:r=>{const e=yb(r);if(!e)return;const t=xc.get(e);t&&t.close()}});let xc=class j6 extends ne{static get(e){return e.getContribution(j6.ID)}constructor(e,t,i,n){if(super(),this.editor=e,this.configurationService=i,this.instantiationService=n,this.modelRegistry=null,this.model=null,this.widget=null,this.session=ne.None,this.mouseDownInfo=null,this.enabled=!1,this.gutterActionDisposables=new me,this.enabled=!t.getContextKeyValue("isInDiffEditor"),this.stylesheet=Jw(),this._register(ot(()=>this.stylesheet.remove())),this.enabled){this.isDirtyDiffVisible=F6.bindTo(t),this._register(e.onDidChangeModel(()=>this.close()));const s=F.filter(i.onDidChangeConfiguration,o=>o.affectsConfiguration("scm.diffDecorationsGutterAction"));this._register(s(this.onDidChangeGutterAction,this)),this.onDidChangeGutterAction()}}onDidChangeGutterAction(){const e=this.configurationService.getValue("scm.diffDecorationsGutterAction");this.gutterActionDisposables.dispose(),this.gutterActionDisposables=new me,e==="diff"?(this.gutterActionDisposables.add(this.editor.onMouseDown(t=>this.onEditorMouseDown(t))),this.gutterActionDisposables.add(this.editor.onMouseUp(t=>this.onEditorMouseUp(t))),this.stylesheet.textContent=`
				.monaco-editor .dirty-diff-glyph {
					cursor: pointer;
				}

				.monaco-editor .margin-view-overlays .dirty-diff-glyph:hover::before {
					height: 100%;
					width: 6px;
					left: -6px;
				}

				.monaco-editor .margin-view-overlays .dirty-diff-deleted:hover::after {
					bottom: 0;
					border-top-width: 0;
					border-bottom-width: 0;
				}
			`):this.stylesheet.textContent=""}canNavigate(){var e;return!this.widget||((e=this.widget)==null?void 0:e.index)===-1||!!this.model&&this.model.changes.length>1}refresh(){var e;(e=this.widget)==null||e.showChange(this.widget.index,!1)}next(e){if(!this.assertWidget()||!this.widget||!this.model)return;let t;if(this.editor.hasModel()&&(typeof e=="number"||!this.widget.provider))t=this.model.findNextClosestChange(typeof e=="number"?e:this.editor.getPosition().lineNumber,!0,this.widget.provider);else{const i=this.model.mapChanges.get(this.widget.provider)??this.model.mapChanges.values().next().value,n=i.findIndex(s=>s===this.widget.index);t=i[VH(n+1,i.length)]}this.widget.showChange(t)}previous(e){if(!this.assertWidget()||!this.widget||!this.model)return;let t;if(this.editor.hasModel()&&typeof e=="number")t=this.model.findPreviousClosestChange(typeof e=="number"?e:this.editor.getPosition().lineNumber,!0,this.widget.provider);else{const i=this.model.mapChanges.get(this.widget.provider)??this.model.mapChanges.values().next().value,n=i.findIndex(s=>s===this.widget.index);t=i[VH(n-1,i.length)]}this.widget.showChange(t)}close(){this.session.dispose(),this.session=ne.None}assertWidget(){if(!this.enabled)return!1;if(this.widget)return!this.model||this.model.changes.length===0?(this.close(),!1):!0;if(!this.modelRegistry)return!1;const e=this.editor.getModel();if(!e)return!1;const t=this.modelRegistry.getModel(e);if(!t||t.changes.length===0)return!1;this.model=t,this.widget=this.instantiationService.createInstance(lN,this.editor,t),this.isDirtyDiffVisible.set(!0);const i=new me;return i.add(F.once(this.widget.onDidClose)(this.close,this)),F.chain(t.onDidChange).filter(n=>n.diff.length>0).map(n=>n.diff).event(this.onDidModelChange,this,i),i.add(this.widget),i.add(ot(()=>{this.model=null,this.widget=null,this.isDirtyDiffVisible.set(!1),this.editor.focus()})),this.session=i,!0}onDidModelChange(e){if(!(!this.model||!this.widget||this.widget.hasFocus())){for(const t of e)if(t.start<=this.widget.index){this.next();return}this.refresh()}}onEditorMouseDown(e){this.mouseDownInfo=null;const t=e.target.range;if(!t||!e.event.leftButton||e.target.type!==4||!e.target.element||e.target.element.className.indexOf("dirty-diff-glyph")<0)return;const i=e.target.detail,n=e.target.element.offsetLeft,s=i.offsetX-n;s<-3||s>3||(this.mouseDownInfo={lineNumber:t.startLineNumber})}onEditorMouseUp(e){var a;if(!this.mouseDownInfo)return;const{lineNumber:t}=this.mouseDownInfo;this.mouseDownInfo=null;const i=e.target.range;if(!i||i.startLineNumber!==t||e.target.type!==4||!this.modelRegistry)return;const n=this.editor.getModel();if(!n)return;const s=this.modelRegistry.getModel(n);if(!s)return;const o=s.changes.findIndex(c=>cbe(t,c.change));o<0||(o===((a=this.widget)==null?void 0:a.index)?this.close():this.next(t))}getChanges(){if(!this.modelRegistry)return[];if(!this.editor.hasModel())return[];const e=this.modelRegistry.getModel(this.editor.getModel());return e?e.changes.map(t=>t.change):[]}dispose(){this.gutterActionDisposables.dispose(),super.dispose()}};xc.ID="editor.contrib.dirtydiff";xc=T([v(1,It),v(2,We),v(3,Te)],xc);const rd=ee("editorGutter.modifiedBackground",{dark:"#1B81A8",light:"#2090D3",hcDark:"#1B81A8",hcLight:"#2090D3"},p("editorGutterModifiedBackground","Editor gutter background color for lines that are modified.")),sd=ee("editorGutter.addedBackground",{dark:"#487E02",light:"#48985D",hcDark:"#487E02",hcLight:"#48985D"},p("editorGutterAddedBackground","Editor gutter background color for lines that are added.")),od=ee("editorGutter.deletedBackground",{dark:gl,light:gl,hcDark:gl,hcLight:gl},p("editorGutterDeletedBackground","Editor gutter background color for lines that are deleted."));ee("minimapGutter.modifiedBackground",{dark:rd,light:rd,hcDark:rd,hcLight:rd},p("minimapGutterModifiedBackground","Minimap gutter background color for lines that are modified."));ee("minimapGutter.addedBackground",{dark:sd,light:sd,hcDark:sd,hcLight:sd},p("minimapGutterAddedBackground","Minimap gutter background color for lines that are added."));ee("minimapGutter.deletedBackground",{dark:od,light:od,hcDark:od,hcLight:od},p("minimapGutterDeletedBackground","Minimap gutter background color for lines that are deleted."));ee("editorOverviewRuler.modifiedForeground",{dark:Xe(rd,.6),light:Xe(rd,.6),hcDark:Xe(rd,.6),hcLight:Xe(rd,.6)},p("overviewRulerModifiedForeground","Overview ruler marker color for modified content."));ee("editorOverviewRuler.addedForeground",{dark:Xe(sd,.6),light:Xe(sd,.6),hcDark:Xe(sd,.6),hcLight:Xe(sd,.6)},p("overviewRulerAddedForeground","Overview ruler marker color for added content."));ee("editorOverviewRuler.deletedForeground",{dark:Xe(od,.6),light:Xe(od,.6),hcDark:Xe(od,.6),hcLight:Xe(od,.6)},p("overviewRulerDeletedForeground","Overview ruler marker color for deleted content."));async function hbe(r,e,t,i){const n=await r.getQuickDiffs(e,t,i);return n.length>0?n[0].originalResource:null}Rd(xc.ID,xc,1);Nf(class extends $f{constructor(){super({id:"editor.action.formatChanges",label:p("formatChanges","Format Modified Lines"),alias:"Format Modified Lines",precondition:nt.and(vo.writable,vo.hasDocumentSelectionFormattingProvider)})}async run(e,t){const i=e.get(Te);if(!t.hasModel())return;const n=await i.invokeFunction(B6,t.getModel());if(Pr(n))return i.invokeFunction(NG,t,n,1,t1.None,_t.None)}});async function B6(r,e){const t=r.get(VT),i=r.get(Zw),n=r.get(or),s=await hbe(t,e.uri,e.getLanguageId(),Sh(e));if(!s)return null;const o=[],a=await n.createModelReference(s);try{if(!i.canComputeDirtyDiff(s,e.uri))return;const c=await i.computeDirtyDiff(s,e.uri,!1);if(!Pr(c))return;for(const d of c)o.push(e.validateRange(new qe(d.modifiedStartLineNumber,1,d.modifiedEndLineNumber||d.modifiedStartLineNumber,Number.MAX_SAFE_INTEGER)))}finally{a.dispose()}return o}let uN=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){e.textEditorModel&&this.configurationService.getValue("files.trimTrailingWhitespace",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource})&&this.doTrimTrailingWhitespace(e.textEditorModel,t.reason===2)}doTrimTrailingWhitespace(e,t){var a;let i=[],n=[];const s=EI(e,this.codeEditorService);if(s&&(i=s.getSelections(),t)){n=i.map(d=>d.getPosition());const c=(a=nf.get(s))==null?void 0:a.getSessionEnclosingRange();if(c)for(let d=c.startLineNumber;d<=c.endLineNumber;d++)n.push(new Us(d,e.getLineMaxColumn(d)))}const o=AJ(e,n);o.length&&e.pushEditOperations(i,o,c=>i)}};uN=T([v(0,We),v(1,En)],uN);function EI(r,e){let t=null;if(r.isAttachedToEditor()){for(const i of e.listCodeEditors())if(i.hasModel()&&i.getModel()===r){if(i.hasTextFocus())return i;t=i}}return t}let hN=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){e.textEditorModel&&this.configurationService.getValue("files.insertFinalNewline",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource})&&this.doInsertFinalNewLine(e.textEditorModel)}doInsertFinalNewLine(e){const t=e.getLineCount(),i=e.getLineContent(t),n=MJ(i)===-1;if(!t||n)return;const s=[ma.insert(new Us(t,e.getLineMaxColumn(t)),e.getEOL())],o=EI(e,this.codeEditorService);o?o.executeEdits("insertFinalNewLine",s,o.getSelections()):e.pushEditOperations([],s,()=>null)}};hN=T([v(0,We),v(1,En)],hN);let fN=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){e.textEditorModel&&this.configurationService.getValue("files.trimFinalNewlines",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource})&&this.doTrimFinalNewLines(e.textEditorModel,t.reason===2)}findLastNonEmptyLine(e){for(let t=e.getLineCount();t>=1;t--)if(e.getLineContent(t).length>0)return t;return 0}doTrimFinalNewLines(e,t){const i=e.getLineCount();if(i===1)return;let n=[],s=0;const o=EI(e,this.codeEditorService);if(o&&(n=o.getSelections(),t))for(let l=0,u=n.length;l<u;l++){const h=n[l].positionLineNumber;h>s&&(s=h)}const a=this.findLastNonEmptyLine(e),c=Math.max(a+1,s+1),d=e.validateRange(new qe(c,1,i,e.getLineMaxColumn(i)));d.isEmpty()||(e.pushEditOperations(n,[ma.delete(d)],l=>n),o==null||o.setSelections(n))}};fN=T([v(0,We),v(1,En)],fN);let pN=class{constructor(e,t,i){this.configurationService=e,this.codeEditorService=t,this.instantiationService=i}async participate(e,t,i,n){if(!e.textEditorModel||t.reason===2)return;const s=e.textEditorModel,o={overrideIdentifier:s.getLanguageId(),resource:s.uri},a=new t1(u=>{i.report({message:p({key:"formatting2",comment:["[configure]({1}) is a link. Only translate `configure`. Do not change brackets and parentheses or {1}"]},"Running '{0}' Formatter ([configure]({1})).",u.displayName||u.extensionId&&u.extensionId.value||"???","command:workbench.action.openSettings?%5B%22editor.formatOnSave%22%5D")})});if(!this.configurationService.getValue("editor.formatOnSave",o))return;const d=EI(s,this.codeEditorService)||s,l=this.configurationService.getValue("editor.formatOnSaveMode",o);if(l==="file")await this.instantiationService.invokeFunction(qH,d,2,a,n);else{const u=await this.instantiationService.invokeFunction(B6,Ch(d)?d.getModel():d);u===null&&l==="modificationsIfAvailable"?await this.instantiationService.invokeFunction(qH,d,2,a,n):u&&await this.instantiationService.invokeFunction(NG,d,u,2,a,n)}}};pN=T([v(0,We),v(1,En),v(2,Te)],pN);let gN=class{constructor(e,t,i){this.configurationService=e,this.instantiationService=t,this.languageFeaturesService=i}async participate(e,t,i,n){if(!e.textEditorModel||t.reason!==1)return;const s=e.textEditorModel,o={overrideIdentifier:s.getLanguageId(),resource:e.resource},a=this.configurationService.getValue("editor.codeActionsOnSave",o);if(!a)return;const c=Array.isArray(a)?a:Object.keys(a).filter(u=>a[u]),d=this.createCodeActionsOnSave(c);if(Array.isArray(a)||d.sort((u,h)=>ws.SourceFixAll.contains(u)?ws.SourceFixAll.contains(h)?0:-1:ws.SourceFixAll.contains(h)?1:0),!d.length)return;const l=Array.isArray(a)?[]:Object.keys(a).filter(u=>a[u]===!1).map(u=>new ws(u));i.report({message:p("codeaction","Quick Fixes")}),await this.applyOnSaveActions(s,d,l,i,n)}createCodeActionsOnSave(e){const t=e.map(i=>new ws(i));return t.filter(i=>t.every(n=>n.equals(i)||!n.contains(i)))}async applyOnSaveActions(e,t,i,n,s){const o=new class{constructor(){this._names=new Set}_report(){n.report({message:p({key:"codeaction.get2",comment:["[configure]({1}) is a link. Only translate `configure`. Do not change brackets and parentheses or {1}"]},"Getting code actions from '{0}' ([configure]({1})).",[...this._names].map(a=>`'${a}'`).join(", "),"command:workbench.action.openSettings?%5B%22editor.codeActionsOnSave%22%5D")})}report(a){a.displayName&&!this._names.has(a.displayName)&&(this._names.add(a.displayName),this._report())}};for(const a of t){const c=await this.getActionsToRun(e,a,i,o,s);if(s.isCancellationRequested){c.dispose();return}try{for(const d of c.validActions)if(n.report({message:p("codeAction.apply","Applying code action '{0}'.",d.action.title)}),await this.instantiationService.invokeFunction(LJ,d,FJ.OnSave,{},s),s.isCancellationRequested)return}catch{}finally{c.dispose()}}}getActionsToRun(e,t,i,n,s){return OJ(this.languageFeaturesService.codeActionProvider,e,e.getFullModelRange(),{type:2,triggerAction:NJ.OnSave,filter:{include:t,excludes:i,includeSourceActions:!0}},n,s)}};gN=T([v(0,We),v(1,Te),v(2,Lf)],gN);let mN=class extends ne{constructor(e,t){super(),this.instantiationService=e,this.textFileService=t,this.registerSaveParticipants()}registerSaveParticipants(){this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(uN))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(gN))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(pN))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(hN))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(fN)))}};mN=T([v(0,Te),v(1,Dn)],mN);const fbe=st.as(Js.Workbench);fbe.registerWorkbenchContribution(mN,3);class xI extends Le{constructor(){super({id:xI.ID,title:{value:p("toggleMinimap","Toggle Minimap"),original:"Toggle Minimap",mnemonicTitle:p({key:"miMinimap",comment:["&& denotes a mnemonic"]},"&&Minimap")},category:ye.View,f1:!0,toggled:nt.equals("config.editor.minimap.enabled",!0),menu:{id:Ee.MenubarAppearanceMenu,group:"4_editor",order:1}})}async run(e){const t=e.get(We),i=!t.getValue("editor.minimap.enabled");return t.updateValue("editor.minimap.enabled",i)}}xI.ID="editor.action.toggleMinimap";Nt(xI);class mu extends Le{constructor(){super({id:mu.ID,title:{value:p("toggleLocation","Toggle Multi-Cursor Modifier"),original:"Toggle Multi-Cursor Modifier"},f1:!0})}run(e){const t=e.get(We),n=t.getValue("editor").multiCursorModifier==="ctrlCmd"?"alt":"ctrlCmd";return t.updateValue(mu.multiCursorModifierConfigurationKey,n)}}mu.ID="workbench.action.toggleMultiCursorModifier";mu.multiCursorModifierConfigurationKey="editor.multiCursorModifier";const LW=new G("multiCursorModifier","altKey");let vN=class{constructor(e,t){this.configurationService=e,this._multiCursorModifier=LW.bindTo(t),this._update(),e.onDidChangeConfiguration(i=>{i.affectsConfiguration("editor.multiCursorModifier")&&this._update()})}_update(){const t=this.configurationService.getValue("editor").multiCursorModifier==="ctrlCmd"?"ctrlCmd":"altKey";this._multiCursorModifier.set(t)}};vN=T([v(0,We),v(1,It)],vN);st.as(Js.Workbench).registerWorkbenchContribution(vN,3);Nt(mu);Un.appendMenuItem(Ee.MenubarSelectionMenu,{group:"4_config",command:{id:mu.ID,title:p("miMultiCursorAlt","Switch to Alt+Click for Multi-Cursor")},when:LW.isEqualTo("ctrlCmd"),order:1});Un.appendMenuItem(Ee.MenubarSelectionMenu,{group:"4_config",command:{id:mu.ID,title:uc?p("miMultiCursorCmd","Switch to Cmd+Click for Multi-Cursor"):p("miMultiCursorCtrl","Switch to Ctrl+Click for Multi-Cursor")},when:LW.isEqualTo("altKey"),order:1});class DI extends Le{constructor(){super({id:DI.ID,title:{value:p("toggleRenderControlCharacters","Toggle Control Characters"),mnemonicTitle:p({key:"miToggleRenderControlCharacters",comment:["&& denotes a mnemonic"]},"Render &&Control Characters"),original:"Toggle Control Characters"},category:ye.View,f1:!0,toggled:nt.equals("config.editor.renderControlCharacters",!0),menu:{id:Ee.MenubarAppearanceMenu,group:"4_editor",order:4}})}run(e){const t=e.get(We),i=!t.getValue("editor.renderControlCharacters");return t.updateValue("editor.renderControlCharacters",i)}}DI.ID="editor.action.toggleRenderControlCharacter";Nt(DI);const U6="transientWordWrapState",FW="isWordWrapMinified",OW="isDominatedByLongLines",V6=new G("canToggleWordWrap",!1,!0),q6=new G("editorWordWrap",!1,p("editorWordWrap","Whether the editor is currently using word wrapping."));function WD(r,e,t){t.setTransientModelProperty(r,U6,e)}function HD(r,e){return e.getTransientModelProperty(r,U6)}const kI="editor.action.toggleWordWrap";class pbe extends $f{constructor(){super({id:kI,label:p("toggle.wordwrap","View: Toggle Word Wrap"),alias:"View: Toggle Word Wrap",precondition:void 0,kbOpts:{kbExpr:null,primary:568,weight:100}})}run(e,t){const i=e.get(En);if(!$m(i,t))return;const n=t.getModel(),s=HD(n,i);let o;s?o=null:o={wordWrapOverride:t.getOption(142).wrappingColumn===-1?"on":"off"},WD(n,o,i);const a=gbe(t,i);if(a){const c=a.getOriginalEditor(),d=a.getModifiedEditor(),l=c===t?d:c;$m(i,l)&&(WD(l.getModel(),o,i),a.updateOptions({}))}}}function gbe(r,e){if(!r.getOption(59))return null;for(const t of e.listDiffEditors()){const i=t.getOriginalEditor(),n=t.getModifiedEditor();if(i===r||n===r)return t}return null}let Uw=class extends ne{constructor(e,t,i){super(),this._editor=e,this._contextKeyService=t,this._codeEditorService=i;const s=this._editor.getOptions().get(142),o=this._contextKeyService.createKey(FW,s.isWordWrapMinified),a=this._contextKeyService.createKey(OW,s.isDominatedByLongLines);let c=!1;this._register(e.onDidChangeConfiguration(l=>{if(!l.hasChanged(142))return;const h=this._editor.getOptions().get(142);o.set(h.isWordWrapMinified),a.set(h.isDominatedByLongLines),c||d()})),this._register(e.onDidChangeModel(l=>{d()})),this._register(i.onDidChangeTransientModelProperty(()=>{d()}));const d=()=>{if(!$m(this._codeEditorService,this._editor))return;const l=HD(this._editor.getModel(),this._codeEditorService);try{c=!0,this._applyWordWrapState(l)}finally{c=!1}}}_applyWordWrapState(e){const t=e?e.wordWrapOverride:"inherit";this._editor.updateOptions({wordWrapOverride2:t})}};Uw.ID="editor.contrib.toggleWordWrapController";Uw=T([v(1,It),v(2,En)],Uw);let Vw=class extends ne{constructor(e,t){super(),this._diffEditor=e,this._codeEditorService=t,this._register(this._diffEditor.onDidChangeModel(()=>{this._ensureSyncedWordWrapToggle()}))}_ensureSyncedWordWrapToggle(){const e=this._diffEditor.getOriginalEditor(),t=this._diffEditor.getModifiedEditor();if(!e.hasModel()||!t.hasModel())return;const i=HD(e.getModel(),this._codeEditorService),n=HD(t.getModel(),this._codeEditorService);i&&!n&&$m(this._codeEditorService,e)&&(WD(t.getModel(),i,this._codeEditorService),this._diffEditor.updateOptions({})),!i&&n&&$m(this._codeEditorService,t)&&(WD(e.getModel(),n,this._codeEditorService),this._diffEditor.updateOptions({}))}};Vw.ID="diffeditor.contrib.toggleWordWrapController";Vw=T([v(1,En)],Vw);function $m(r,e){if(!e||e.isSimpleWidget)return!1;const t=e.getModel();if(!t||t.uri.scheme==="output")return!1;if(e.getOption(59)){for(const i of r.listDiffEditors())if(i.getOriginalEditor()===e&&!i.renderSideBySide)return!1}return!0}let yN=class{constructor(e,t,i){this._editorService=e,this._codeEditorService=t,this._contextService=i,window.addEventListener("focus",()=>this._update(),!0),window.addEventListener("blur",()=>this._update(),!0),this._editorService.onDidActiveEditorChange(()=>this._update()),this._canToggleWordWrap=V6.bindTo(this._contextService),this._editorWordWrap=q6.bindTo(this._contextService),this._activeEditor=null,this._activeEditorListener=new me,this._update()}_update(){const e=this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor();this._activeEditor!==e&&(this._activeEditorListener.clear(),this._activeEditor=e,e&&(this._activeEditorListener.add(e.onDidChangeModel(()=>this._updateFromCodeEditor())),this._activeEditorListener.add(e.onDidChangeConfiguration(t=>{t.hasChanged(142)&&this._updateFromCodeEditor()})),this._updateFromCodeEditor()))}_updateFromCodeEditor(){if($m(this._codeEditorService,this._activeEditor)){const e=this._activeEditor.getOption(142);this._setValues(!0,e.wrappingColumn!==-1)}else return this._setValues(!1,!1)}_setValues(e,t){this._canToggleWordWrap.set(e),this._editorWordWrap.set(t)}};yN=T([v(0,Ke),v(1,En),v(2,It)],yN);const mbe=st.as(Js.Workbench);mbe.registerWorkbenchContribution(yN,2);Rd(Uw.ID,Uw,0);FG(Vw.ID,Vw);Nf(pbe);Un.appendMenuItem(Ee.EditorTitle,{command:{id:kI,title:p("unwrapMinified","Disable wrapping for this file"),icon:jt.wordWrap},group:"navigation",order:1,when:nt.and(nt.has(OW),nt.has(FW))});Un.appendMenuItem(Ee.EditorTitle,{command:{id:kI,title:p("wrapMinified","Enable wrapping for this file"),icon:jt.wordWrap},group:"navigation",order:1,when:nt.and(vo.inDiffEditor.negate(),nt.has(OW),nt.not(FW))});Un.appendMenuItem(Ee.MenubarViewMenu,{command:{id:kI,title:p({key:"miToggleWordWrap",comment:["&& denotes a mnemonic"]},"&&Word Wrap"),toggled:q6,precondition:V6},order:1,group:"5_editor"});const ek=class ek extends Le{constructor(){super({id:ek.ID,title:{value:p("toggleRenderWhitespace","Toggle Render Whitespace"),mnemonicTitle:p({key:"miToggleRenderWhitespace",comment:["&& denotes a mnemonic"]},"&&Render Whitespace"),original:"Toggle Render Whitespace"},category:ye.View,f1:!0,toggled:nt.notEquals("config.editor.renderWhitespace","none"),menu:{id:Ee.MenubarAppearanceMenu,group:"4_editor",order:3}})}run(e){const t=e.get(We),i=t.getValue("editor.renderWhitespace");let n;return i==="none"?n="all":n="none",t.updateValue("editor.renderWhitespace",n)}};mi(ek,"ID","editor.action.toggleRenderWhitespace");let _N=ek;Nt(_N);class vbe{constructor(){this._registeredGutterActionsGenerators=new Set}registerGutterActionsGenerator(e){return this._registeredGutterActionsGenerators.add(e),{dispose:()=>{this._registeredGutterActionsGenerators.delete(e)}}}getGutterActionsGenerators(){return Array.from(this._registeredGutterActionsGenerators.values())}}st.add("gutterActionsRegistry",new vbe);const ybe=st.as("gutterActionsRegistry");let qw=class extends ne{constructor(e,t,i,n,s){super(),this.editor=e,this.contextMenuService=t,this.menuService=i,this.contextKeyService=n,this.instantiationService=s,this._register(this.editor.onMouseDown(o=>this.doShow(o,!1)))}show(e){this.doShow(e,!0)}doShow(e,t){const i=this.editor.getModel();if(!e.event.rightButton&&!(uc&&e.event.leftButton&&e.event.ctrlKey)&&!t||e.target.type!==3&&e.target.type!==2||!e.target.position||!i)return;const n={x:e.event.posx,y:e.event.posy},s=e.target.position.lineNumber,o=this.contextKeyService.createOverlay([["editorLineNumber",s]]),a=this.menuService.createMenu(Ee.EditorLineNumberContext,o),c=[];this.instantiationService.invokeFunction(d=>{for(const u of ybe.getGutterActionsGenerators()){const h=new Map;u({lineNumber:s,editor:this.editor,accessor:d},{push:(g,m="navigation")=>{const y=h.get(m)??[];y.push(g),h.set(m,y)}});for(const[g,m]of h.entries())c.push([g,m])}c.sort((u,h)=>u[0].localeCompare(h[0]));const l=a.getActions({arg:{lineNumber:s,uri:i.uri},shouldForwardArgs:!0});if(c.push(...l),e.target.type===3){const u=this.editor.getSelections(),h={startLineNumber:s,endLineNumber:s,startColumn:1,endColumn:i.getLineLength(s)+1};(u==null?void 0:u.some(m=>!m.isEmpty()&&m.intersectRanges(h)!==null))||this.editor.setSelection(h,"api")}this.contextMenuService.showContextMenu({getAnchor:()=>n,getActions:()=>bG.join(...c.map(u=>u[1])),onHide:()=>a.dispose()})})}};qw.ID="workbench.contrib.editorLineNumberContextMenu";qw=T([v(1,eo),v(2,ib),v(3,It),v(4,Te)],qw);Rd(qw.ID,qw,1);let _a=class Ls extends ne{constructor(e,t){super(),this._extensionService=e,this._configurationService=t,this._store.add(this._extensionService.onDidChangeExtensions(this._updateConfigValues,this)),this._store.add($J.setFoldingRangeProviderSelector(this._selectFoldingRangeProvider.bind(this))),this._updateConfigValues()}async _updateConfigValues(){var n;await this._extensionService.whenInstalledExtensionsRegistered(),Ls.extensionIds.length=0,Ls.extensionItemLabels.length=0,Ls.extensionDescriptions.length=0,Ls.extensionIds.push(null),Ls.extensionItemLabels.push(p("null","All")),Ls.extensionDescriptions.push(p("nullFormatterDescription","All active folding range providers"));const e=[],t=[];for(const s of this._extensionService.extensions)(s.main||s.browser)&&((n=s.categories)!=null&&n.find(o=>o==="Programming Languages")?e.push(s):t.push(s));const i=(s,o)=>s.name.localeCompare(o.name);for(const s of e.sort(i))Ls.extensionIds.push(s.identifier.value),Ls.extensionItemLabels.push(s.displayName??""),Ls.extensionDescriptions.push(s.description??"");for(const s of t.sort(i))Ls.extensionIds.push(s.identifier.value),Ls.extensionItemLabels.push(s.displayName??""),Ls.extensionDescriptions.push(s.description??"")}_selectFoldingRangeProvider(e,t){const i=this._configurationService.getValue(Ls.configName,{overrideIdentifier:t.getLanguageId()});if(i)return e.filter(n=>n.id===i)}};_a.configName="editor.defaultFoldingRangeProvider";_a.extensionIds=[];_a.extensionItemLabels=[];_a.extensionDescriptions=[];_a=T([v(0,yr),v(1,We)],_a);st.as(ks.Configuration).registerConfiguration({...f1,properties:{[_a.configName]:{description:p("formatter.default","Defines a default folding range provider that takes precedence over all other folding range providers. Must be the identifier of an extension contributing a folding range provider."),type:["string","null"],default:null,enum:_a.extensionIds,enumItemLabels:_a.extensionItemLabels,markdownEnumDescriptions:_a.extensionDescriptions}}});st.as(Js.Workbench).registerWorkbenchContribution(_a,3);let Td=class wN{static get(e){return e.getContribution(wN.ID)??void 0}constructor(e,t,i,n){this._editor=e,this._audioCueService=i,this._instaService=n,this._sessionDispoosables=new me,this._ariaElement=document.createElement("span"),this._ariaElement.style.position="fixed",this._ariaElement.className="inlayhint-accessibility-element",this._ariaElement.tabIndex=0,this._ariaElement.setAttribute("aria-description",p("description","Code with Inlay Hint Information")),this._ctxIsReading=wN.IsReading.bindTo(t)}dispose(){this._sessionDispoosables.dispose(),this._ctxIsReading.reset(),this._ariaElement.remove()}_reset(){Rg(this._ariaElement),this._sessionDispoosables.clear(),this._ctxIsReading.reset()}async _read(e,t){var c;if(this._sessionDispoosables.clear(),this._ariaElement.isConnected||(c=this._editor.getDomNode())==null||c.appendChild(this._ariaElement),!this._editor.hasModel()||!this._ariaElement.isConnected){this._ctxIsReading.set(!1);return}const i=new Xt;this._sessionDispoosables.add(i);for(const d of t)await d.resolve(i.token);if(i.token.isCancellationRequested)return;const n=this._editor.getModel(),s=[];let o=0,a=!1;for(const d of t){const l=n.getValueInRange({startLineNumber:e,startColumn:o+1,endLineNumber:e,endColumn:d.hint.position.column});if(l.length>0&&(s.push(l),o=d.hint.position.column-1),o>750){s.push("…"),a=!0;break}const u=document.createElement("em"),{label:h}=d.hint;if(typeof h=="string")u.innerText=h;else for(const g of h)if(g.command){const m=this._instaService.createInstance(sG,u,{href:WJ(g.command),label:g.label,title:g.command.title},void 0);this._sessionDispoosables.add(m)}else u.innerText+=g.label;s.push(u)}a||s.push(n.getValueInRange({startLineNumber:e,startColumn:o+1,endLineNumber:e,endColumn:Number.MAX_SAFE_INTEGER})),TC(this._ariaElement,...s),this._ariaElement.focus(),this._ctxIsReading.set(!0),this._sessionDispoosables.add(Ci(this._ariaElement,"focusout",()=>{this._reset()}))}startInlayHintsReading(){var i;if(!this._editor.hasModel())return;const e=this._editor.getPosition().lineNumber,t=(i=HJ.get(this._editor))==null?void 0:i.getInlayHintsForLine(e);!t||t.length===0?this._audioCueService.playAudioCue(mS.noInlayHints):this._read(e,t)}stopInlayHintsReading(){this._reset(),this._editor.focus()}};Td.IsReading=new G("isReadingLineWithInlayHints",!1,{type:"boolean",description:p("isReadingLineWithInlayHints","Whether the current line and its inlay hints are currently focused")});Td.ID="editor.contrib.InlayHintsAccessibility";Td=T([v(1,It),v(2,g1),v(3,Te)],Td);Nt(class extends $G{constructor(){super({id:"inlayHints.startReadingLineWithHint",title:{value:p("read.title","Read Line With Inline Hints"),original:"Read Line With Inline Hints"},precondition:vo.hasInlayHintsProvider,f1:!0})}runEditorCommand(e,t){const i=Td.get(t);i==null||i.startInlayHintsReading()}});Nt(class extends $G{constructor(){super({id:"inlayHints.stopReadingLineWithHint",title:{value:p("stop.title","Stop Inlay Hints Reading"),original:"Stop Inlay Hints Reading"},precondition:Td.IsReading,f1:!0,keybinding:{weight:100,primary:9}})}runEditorCommand(e,t){const i=Td.get(t);i==null||i.stopInlayHintsReading()}});Rd(Td.ID,Td,4);var aa;(function(r){r.languages="languages",r.actions="actions",r.kind="kind",r.title="title",r.description="description"})(aa||(aa={}));const _be=Object.freeze({type:"array",markdownDescription:p("contributes.codeActions","Configure which editor to use for a resource."),items:{type:"object",required:[aa.languages,aa.actions],properties:{[aa.languages]:{type:"array",description:p("contributes.codeActions.languages","Language modes that the code actions are enabled for."),items:{type:"string"}},[aa.actions]:{type:"object",required:[aa.kind,aa.title],properties:{[aa.kind]:{type:"string",markdownDescription:p("contributes.codeActions.kind","`CodeActionKind` of the contributed code action.")},[aa.title]:{type:"string",description:p("contributes.codeActions.title","Label for the code action used in the UI.")},[aa.description]:{type:"string",description:p("contributes.codeActions.description","Description of what the code action does.")}}}}}}),wbe={extensionPoint:"codeActions",deps:[dm],jsonSchema:_be};var rl;(function(r){r.when="when",r.title="title",r.command="command"})(rl||(rl={}));const bbe=Object.freeze({type:"object",description:p("contributes.documentation","Contributed documentation."),properties:{refactoring:{type:"array",description:p("contributes.documentation.refactorings","Contributed documentation for refactorings."),items:{type:"object",description:p("contributes.documentation.refactoring","Contributed documentation for refactoring."),required:[rl.title,rl.when,rl.command],properties:{[rl.title]:{type:"string",description:p("contributes.documentation.refactoring.title","Label for the documentation used in the UI.")},[rl.when]:{type:"string",description:p("contributes.documentation.refactoring.when","When clause.")},[rl.command]:{type:"string",description:p("contributes.documentation.refactoring.command","Command executed.")}}}}}}),Sbe={extensionPoint:"documentation",deps:[dm],jsonSchema:bbe},bN=Object.freeze({"source.fixAll":{type:"boolean",description:p("codeActionsOnSave.fixAll","Controls whether auto fix action should be run on file save.")}}),G6={oneOf:[{type:"object",properties:bN,additionalProperties:{type:"boolean"}},{type:"array",items:{type:"string"}}],default:{},description:p("codeActionsOnSave","Code Action kinds to be run on save."),scope:5},z6=Object.freeze({...f1,properties:{"editor.codeActionsOnSave":G6}});let SN=class extends ne{constructor(e,t){super(),this._contributedCodeActions=[],this._onDidChangeContributions=this._register(new A),e.setHandler(i=>{this._contributedCodeActions=i.map(n=>n.value).flat(),this.updateConfigurationSchema(this._contributedCodeActions),this._onDidChangeContributions.fire()}),t.registerSchemaContribution({getSchemaAdditions:()=>this.getSchemaAdditions(),onDidChange:this._onDidChangeContributions.event})}updateConfigurationSchema(e){const t={...bN};for(const[i,n]of this.getSourceActions(e))t[i]={type:"boolean",description:p("codeActionsOnSave.generic","Controls whether '{0}' actions should be run on file save.",n.title)};G6.properties=t,st.as(ks.Configuration).notifyConfigurationSchemaUpdated(z6)}getSourceActions(e){const t=Object.keys(bN).map(n=>new ws(n)),i=new Map;for(const n of e)for(const s of n.actions){const o=new ws(s.kind);ws.Source.contains(o)&&!t.some(a=>a.contains(o))&&i.set(o.value,s)}return i}getSchemaAdditions(){const e=(i,n)=>({if:{required:["command"],properties:{command:{const:i}}},then:{properties:{args:{required:["kind"],properties:{kind:{anyOf:[{enum:n.map(s=>s.kind),enumDescriptions:n.map(s=>s.description??s.title)},{type:"string"}]}}}}}}),t=i=>{const n=this._contributedCodeActions.map(o=>o.actions).flat(),s=new Map;for(const o of n)!s.has(o.kind)&&i.contains(new ws(o.kind))&&s.set(o.kind,o);return Array.from(s.values())};return[e(jJ,t(ws.Empty)),e(BJ,t(ws.Refactor)),e(UJ,t(ws.Source))]}};SN=T([v(1,Ts)],SN);let CN=class extends ne{constructor(e,t,i){super(),this.contextKeyService=t,this.contributions=[],this.emptyCodeActionsList={actions:[],dispose:()=>{}},this._register(i.codeActionProvider.register("*",this)),e.setHandler(n=>{this.contributions=[];for(const s of n)if(s.value.refactoring)for(const o of s.value.refactoring){const a=nt.deserialize(o.when);a&&this.contributions.push({title:o.title,when:a,command:o.command})}})}async provideCodeActions(e,t,i,n){return this.emptyCodeActionsList}_getAdditionalMenuItems(e,t){return e.only!==ws.Refactor.value&&!t.some(i=>i.kind&&ws.Refactor.contains(new ws(i.kind)))?[]:this.contributions.filter(i=>this.contextKeyService.contextMatchesRules(i.when)).map(i=>({id:i.command,title:i.title}))}};CN=T([v(1,It),v(2,Lf)],CN);const Cbe=io.registerExtensionPoint(wbe),Ebe=io.registerExtensionPoint(Sbe);st.as(ks.Configuration).registerConfiguration(z6);let EN=class{constructor(e){e.createInstance(SN,Cbe),e.createInstance(CN,Ebe)}};EN=T([v(0,Te)],EN);st.as(Js.Workbench).registerWorkbenchContribution(EN,4);let xN=class{constructor(e){e.createKey("listSupportsTypeNavigation",!0),e.createKey("listSupportsKeyboardNavigation",!0)}};xN=T([v(0,It)],xN);st.as(Js.Workbench).registerWorkbenchContribution(xN,1);let DN=class{constructor(e){this.instantiationService=e,this.instantiationService.createInstance(Bwe),this.instantiationService.createInstance(wme)}};DN=T([v(0,Te)],DN);st.as(Js.Workbench).registerWorkbenchContribution(DN,1);function N2(r,e,t){const i=bn(r.editor)?Gi(r.editor):Object.create(null);return e&&bn(r.diffEditor)&&Object.assign(i,Gi(r.diffEditor)),Object.assign(i,Gi(t)),i}let kN=class extends Jwe(qJ){constructor(e,t,i={},n,s){var b;const{theme:o,autoDetectHighContrast:a,model:c,value:d,language:l,accessibilityHelpUrl:u,ariaContainerElement:h,overflowWidgetsDomNode:g,dimension:m,...y}=i,_=N2(s.getValue((b=i.model)==null?void 0:b.uri),t,y);super(n,e,{..._,overflowWidgetsDomNode:g,dimension:m,theme:o,autoDetectHighContrast:a,model:c,value:d,language:l,accessibilityHelpUrl:u,ariaContainerElement:h}),this.isDiffEditor=t,this.textResourceConfigurationService=s,this.optionsOverrides={},this.lastAppliedEditorOptions=_,this.optionsOverrides=y,this._register(s.onDidChangeConfiguration(()=>this.updateEditorConfiguration())),this._register(this.onDidChangeModelLanguage(()=>this.updateEditorConfiguration())),this._register(this.onDidChangeModel(()=>this.updateEditorConfiguration())),this.updateEditorConfiguration()}updateEditorConfiguration(){if(!this.hasModel()||this.textResourceConfigurationService==null)return;const e=this.getModel().uri,t=this.textResourceConfigurationService.getValue(e);if(t==null)return;const i=N2(t,this.isDiffEditor,this.optionsOverrides);let n=i;this.lastAppliedEditorOptions!=null&&(n=Kq(this.lastAppliedEditorOptions,n)),Object.keys(n).length>0&&(this.lastAppliedEditorOptions=i,super.updateOptions(n))}updateOptions(e){this.optionsOverrides??(this.optionsOverrides={}),FD.applyUpdate(this.optionsOverrides,e)&&this.updateEditorConfiguration()}};kN=T([v(3,Te),v(4,Do)],kN);async function xbe(r,e){await ka.get(at).writeFile(r,De.fromString(e))}async function Dbe(r,e){return e!=null&&await xbe(r,e),await ka.get(or).createModelReference(r)}let TN=class extends VJ{constructor(e,t,i,n,s,o,a){super(t,i,n,s,o,a),this.delegate=e,this._cachedOverridenResolver=null,this.onDidUpdateKeybindings(()=>{this._cachedOverridenResolver=null}),this.delegate.onDidUpdateKeybindings(()=>{this._cachedOverridenResolver=null})}_getResolver(){if(this._cachedOverridenResolver==null){const e=this._toNormalizedKeybindingItems(this._dynamicKeybindings,!1);this._cachedOverridenResolver=new MG([...this.delegate._getResolver().getKeybindings()],e,t=>this._log(t))}return this._cachedOverridenResolver}};TN=T([v(1,It),v(2,un),v(3,gi),v(4,on),v(5,ze),v(6,En)],TN);let fP=null;function kbe(){if(fP==null){const r=new Of;r.set(ss,new er(GJ,void 0,!0));const e=ka.get(Ts);e instanceof nN&&r.set(Ts,new er(TN,[e],!0)),fP=ka.get(Te).createChild(r)}return fP}const Tbe=(r,e,t)=>(ka.initialize(t??{}),kbe().createInstance(kN,r,!1,e));/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.40.0(83b3cf23ca80c94cccca7c5b3e48351b220f8e35)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var Ibe=Object.defineProperty,Rbe=Object.getOwnPropertyDescriptor,Pbe=Object.getOwnPropertyNames,Abe=Object.prototype.hasOwnProperty,$2=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Pbe(e))!Abe.call(r,n)&&n!==t&&Ibe(r,n,{get:()=>e[n],enumerable:!(i=Rbe(e,n))||i.enumerable});return r},Mbe=(r,e,t)=>($2(r,e,"default"),t&&$2(t,e,"default")),K6={};Mbe(K6,zJ);var Lbe={comments:{lineComment:"#",blockComment:["'''","'''"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:"'",close:"'",notIn:["string","comment"]}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],onEnterRules:[{beforeText:new RegExp("^\\s*(?:def|class|for|if|elif|else|while|try|with|finally|except|async|match|case).*?:\\s*$"),action:{indentAction:K6.languages.IndentAction.Indent}}],folding:{offSide:!0,markers:{start:new RegExp("^\\s*#region\\b"),end:new RegExp("^\\s*#endregion\\b")}}},Fbe={defaultToken:"",tokenPostfix:".python",keywords:["False","None","True","_","and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","exec","finally","for","from","global","if","import","in","is","lambda","match","nonlocal","not","or","pass","print","raise","return","try","while","with","yield","int","float","long","complex","hex","abs","all","any","apply","basestring","bin","bool","buffer","bytearray","callable","chr","classmethod","cmp","coerce","compile","complex","delattr","dict","dir","divmod","enumerate","eval","execfile","file","filter","format","frozenset","getattr","globals","hasattr","hash","help","id","input","intern","isinstance","issubclass","iter","len","locals","list","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","reversed","range","raw_input","reduce","reload","repr","reversed","round","self","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","unichr","unicode","vars","xrange","zip","__dict__","__methods__","__members__","__class__","__bases__","__name__","__mro__","__subclasses__","__init__","__import__"],brackets:[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.bracket"},{open:"(",close:")",token:"delimiter.parenthesis"}],tokenizer:{root:[{include:"@whitespace"},{include:"@numbers"},{include:"@strings"},[/[,:;]/,"delimiter"],[/[{}\[\]()]/,"@brackets"],[/@[a-zA-Z_]\w*/,"tag"],[/[a-zA-Z_]\w*/,{cases:{"@keywords":"keyword","@default":"identifier"}}]],whitespace:[[/\s+/,"white"],[/(^#.*$)/,"comment"],[/'''/,"string","@endDocString"],[/"""/,"string","@endDblDocString"]],endDocString:[[/[^']+/,"string"],[/\\'/,"string"],[/'''/,"string","@popall"],[/'/,"string"]],endDblDocString:[[/[^"]+/,"string"],[/\\"/,"string"],[/"""/,"string","@popall"],[/"/,"string"]],numbers:[[/-?0x([abcdef]|[ABCDEF]|\d)+[lL]?/,"number.hex"],[/-?(\d*\.)?\d+([eE][+\-]?\d+)?[jJ]?[lL]?/,"number"]],strings:[[/'$/,"string.escape","@popall"],[/'/,"string.escape","@stringBody"],[/"$/,"string.escape","@popall"],[/"/,"string.escape","@dblStringBody"]],stringBody:[[/[^\\']+$/,"string","@popall"],[/[^\\']+/,"string"],[/\\./,"string"],[/'/,"string.escape","@popall"],[/\\$/,"string"]],dblStringBody:[[/[^\\"]+$/,"string","@popall"],[/[^\\"]+/,"string"],[/\\./,"string"],[/"/,"string.escape","@popall"],[/\\$/,"string"]]}};function Obe(r,e,t){const i=self,n={basePath:e,workerPath:r,workerOptions:{type:t?"module":"classic"}};i.MonacoEnvironment||(i.MonacoEnvironment={workerOverrideGlobals:n,createTrustedTypesPolicy:a=>{}});const s=i.MonacoEnvironment;s.workerOverrideGlobals=n;const o=(a,c)=>{console.log("getWorker: workerId: "+a+" label: "+c);const d=(l,u,h,g)=>{l.workerOptions.name=u;const m=l.workerOptions.type==="module"?`${h}-es.js`:`${h}-iife.js`,y=`${l.workerPath}/${m}`,_=new URL(y,l.basePath);return console.log(`${g}: url: ${_.href} created from basePath: ${l.basePath} and file: ${y}`),new Worker(_.href,l.workerOptions)};switch(c){case"typescript":case"javascript":return d(n,c,"tsWorker","TS Worker");case"html":case"handlebars":case"razor":return d(n,c,"htmlWorker","HTML Worker");case"css":case"scss":case"less":return d(n,c,"cssWorker","CSS Worker");case"json":return d(n,c,"jsonWorker","JSON Worker");default:return d(n,c,"editorWorker","Editor Worker")}};s.getWorker=o}Obe("../../../../node_modules/monaco-editor-workers/dist/workers/",new URL("",window.location.href).href,!1);const _g="python",Nbe=r=>new sce({name:"Python Language Client",clientOptions:{documentSelector:[_g],errorHandler:{error:()=>({action:eN.ErrorAction.Continue}),closed:()=>({action:eN.CloseAction.DoNotRestart})}},connectionProvider:{get:()=>Promise.resolve(r)}}),$be=r=>{const e=()=>{const t=new WebSocket(r.url);t.onopen=()=>{r.onOpen();const i=Wwe(t),n=new Nwe(i),s=new $we(i),o=Nbe({reader:n,writer:s});o.start(),n.onClose(()=>{e(),o.stop()})},t.onclose=()=>{r.onClose(),setTimeout(e,$ee)}};e()},Wbe=async r=>{await Fwe({enableThemeService:!1,enableTextmateService:!1,enableFilesService:!0,enableModelService:!0,enableLanguagesService:!0,enableKeybindingsService:!0,enableQuickaccessService:!0,debugLogging:!1}),Ws.register({id:_g,extensions:[".py"],aliases:["Python","Python3"],mimetypes:["application/text"]}),Ws.setLanguageConfiguration(_g,Lbe),Ws.setMonarchTokensProvider(_g,Fbe),$be(r)},Hbe=async r=>{const e=PG.parse(r.filepath),t=await Dbe(e,"");return t.object.setLanguageId(_g),Tbe(r.htmlElement,{model:t.object.textEditorModel,glyphMargin:!1,lightbulb:{enabled:!0},overviewRulerBorder:!1,overviewRulerLanes:0,automaticLayout:!0,language:_g,scrollBeyondLastLine:!1,minimap:{enabled:!1},fontFamily:"Fira Code",fontSize:12,scrollbar:{verticalHasArrows:!0,alwaysConsumeMouseWheel:!1,vertical:"auto",horizontal:"auto"}})},jbe=({code:r,filepath:e,onChange:t})=>{const[i,n]=z.useState(!1),s=z.useRef(!1),o=z.useRef(null),a=z.createRef(),c=z.useRef(t);return c.current=t,Rk(KJ),z.useEffect(()=>{const d=async()=>{!o.current&&!s.current&&(s.current=!0,o.current=await Hbe({htmlElement:a.current,filepath:e}),s.current=!1,o.current&&n(!0))};a.current&&d()},[a,e]),z.useEffect(()=>()=>{var d;o.current&&((d=o.current)==null||d.dispose(),o.current=null,n(!1))},[]),z.useEffect(()=>{if(i&&o.current&&c.current){const d=o.current;d.onDidChangeModelContent(()=>{c.current(d.getValue())})}},[c,i,e,o]),z.useEffect(()=>{if(o.current&&i){const d=o.current;d.getValue()!==r&&d.setValue(r||"")}},[r,i,o]),a},Q6=()=>{const[r,e]=z.useState(!1),t=iSe(),i=Ti(Y6);return z.useEffect(()=>{const n=()=>i(!0),s=()=>i(!1);(async()=>{e(!1);try{await Wbe({url:t,onOpen:n,onClose:s})}catch{}finally{e(!0)}})()},[t,i]),r},Gw=r=>{const e=nk();Rk(e);const{onMount:t,options:i,...n}=r,s=z.useCallback((o,...a)=>{t&&t(o,...a)},[t]);return f.jsx(QJ,{...n,options:{folding:!1,lineNumbersMinChars:3,...i||{},glyphMargin:!1,lightbulb:{enabled:!0},overviewRulerBorder:!1,overviewRulerLanes:0,automaticLayout:!0,scrollBeyondLastLine:!1,minimap:{enabled:!1},fontFamily:"Fira Code",fontSize:12,scrollbar:{verticalHasArrows:!0,alwaysConsumeMouseWheel:!1,vertical:"auto",horizontal:"auto"}},onMount:s})},Y6=sr(null),Bbe="allFiles",Ube=async()=>await Ei.get("/health/"),Bd=()=>{const r=[Bbe],{isFetched:e}=WW(),{data:t,...i}=rr(r,()=>Ube(),{refetchInterval:10*1e3,refetchIntervalInBackground:!0,enabled:e});return{...i,isConnected:(t==null?void 0:t.status)===200,queryKey:r}},Vbe=()=>{const{status:r}=Bd(),e=Ze(x1),t=Ze(Y6),i=Ze(gn),{workspace:n,isLoading:s}=E1(),o=(i==null?void 0:i.id)===(n==null?void 0:n.id);return f.jsxs(q,{direction:"row",spacing:"1.5",alignItems:"center",fontWeight:"medium",p:"1",h:"full",bg:"white",borderTopWidth:"1px",children:[f.jsx(sh,{size:"2",bg:r==="success"?"green":"red"}),f.jsx(Ie,{fontSize:"xs",noOfLines:1,children:r==="success"?"Worker connected":"Worker not connected."}),f.jsx(Ol,{orientation:"vertical"}),f.jsx(sh,{size:"2",bg:e?"green":"red"}),f.jsx(Ie,{noOfLines:1,fontSize:"xs",children:e?"WS connected":"WS not connected"}),f.jsx(Ol,{orientation:"vertical"}),typeof t=="boolean"&&f.jsxs(f.Fragment,{children:[f.jsx(sh,{size:"2",bg:t?"green":"red"}),f.jsx(Ie,{noOfLines:1,fontSize:"xs",children:t?"LSP connected":"LSP not connected"})]}),r==="error"?f.jsx(zm,{display:"inline",fontSize:"xs",href:"https://docs.dropbase.io/how-to-guides/troubleshoot-worker",target:"_blank",rel:"noreferrer noopener",isExternal:!0,mx:"1",children:"Troubleshoot Worker Connection"}):null,!o&&!s?f.jsxs(f.Fragment,{children:[f.jsx(Ol,{orientation:"vertical"}),f.jsx(sh,{size:"2",bg:"red"}),f.jsx(Ie,{noOfLines:1,fontSize:"xs",children:"The selected workspace does not match the worker workspace."})]}):null]})},W2=({children:r})=>{const{pathname:e}=yu(),{isSuccess:t}=Ld(),i=Ze(gn),n=e.startsWith("/login")||e.startsWith("/register")||e.startsWith("/reset")||e.startsWith("/email-confirmation")||e.startsWith("/forgot"),s=e.startsWith("/welcome"),o=n||s||{}.VITE_APP_TYPE==="app",a=e.startsWith("/apps/")||n||!t,c=(i==null?void 0:i.in_trial)&&!n,d=new Date((i==null?void 0:i.trial_end_date)||"");return f.jsxs(q,{spacing:"0",w:"100vw",height:"100vh",overflow:"hidden",position:"relative",children:[c?f.jsx(ke,{w:"full",py:"1",display:"flex",justifyContent:"center",alignItems:"center",bgColor:"yellow.400",children:f.jsx(Ie,{fontSize:"md",fontWeight:"medium",children:`Your trial expires on ${d.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}`})}):null,f.jsxs(dn,{maxH:o?"100vh":"calc(100vh - 20px)",flex:"1",children:[a?null:f.jsx(Fee,{}),f.jsx(ke,{overflowY:"auto",flex:"1",p:"0",children:r})]}),o?null:f.jsx(ke,{maxH:"20px",flexShrink:"0",children:f.jsx(Vbe,{})})]})},Id=({children:r,title:e,action:t,pageProps:i})=>f.jsxs(q,{p:"6",h:"full",...i,children:[f.jsxs(q,{mb:"3",alignItems:"center",direction:"row",children:[f.jsx(Ie,{fontWeight:"bold",fontSize:"xl",children:e}),t]}),r]}),qbe=()=>{const{workspaces:r,isLoading:e}=Ld(),{id:t}=Ze(gn),{workspace:i}=E1(),n=Ti(gn),s=c=>(i==null?void 0:i.id)===c,o=c=>{const d=r==null?void 0:r.find(l=>l.id===c);n(d)},a=r==null?void 0:r.find(c=>c.id===(i==null?void 0:i.id));return z.useEffect(()=>{i&&a&&n(a)},[i,a,n]),f.jsx(Id,{title:"Workspaces",children:f.jsx(i_,{columns:4,spacing:4,children:e?f.jsxs(f.Fragment,{children:[f.jsx(hi,{minH:"24"}),f.jsx(hi,{minH:"24"}),f.jsx(hi,{minH:"24"}),f.jsx(hi,{minH:"24"})]}):r==null?void 0:r.map(c=>{var d,l;return f.jsxs(ke,{maxW:"sm",borderWidth:"2px",borderRadius:"lg",overflow:"hidden",borderColor:t===c.id?"blue.500":"gray.200",bgColor:s(c==null?void 0:c.id)?"white":"gray.100",boxShadow:"md",_hover:{cursor:"pointer"},p:3,"data-cy":`workspace-${(d=c==null?void 0:c.oldest_user)==null?void 0:d.email}`,onClick:()=>o(c.id),children:[f.jsxs(Ie,{children:["Name: ",c.name]}),f.jsxs(Ie,{children:["Owner: ",(l=c==null?void 0:c.oldest_user)==null?void 0:l.email]}),f.jsxs(Ie,{children:["Workspace ID: ",c.id]})]})})})})},X6=LN("proxyToken",""),NW=sr(!1),TI=sr(null),Gbe=async({workspaceId:r})=>{const{data:e}=await zt.get(`/url_mapping/${r}`);return e},II=()=>{var n;const r=(n=Ze(gn))==null?void 0:n.id,e=["urlMappings",r],{data:t,...i}=rr(e,()=>Gbe({workspaceId:r||""}),{enabled:!!r,staleTime:1/0,cacheTime:1/0});return{urlMappings:t||[],...i}},zbe=async({client_url:r,worker_url:e,lsp_url:t,workspaceId:i})=>(await zt.post("/url_mapping/",{client_url:r,worker_url:e,lsp_url:t,workspace_id:i})).data,Kbe=()=>{const r=Li();return Jt(zbe,{onSuccess:()=>{r.invalidateQueries("urlMappings")}})},Qbe=async({id:r})=>(await zt.delete(`/url_mapping/${r}`)).data,Ybe=()=>{const r=Li();return Jt(Qbe,{onSuccess:()=>{r.invalidateQueries("urlMappings")}})},Xbe=async({id:r,client_url:e,worker_url:t,lsp_url:i})=>(await zt.put(`/url_mapping/${r}`,{client_url:e,worker_url:t,lsp_url:i})).data,Jbe=()=>{const r=Li();return Jt(Xbe,{onSuccess:()=>{r.invalidateQueries("urlMappings")}})},Zbe=async({email:r,password:e})=>(await zt.post("/user/login",{email:r,password:e})).data,eSe=async({credential:r})=>(await zt.post("/user/loginGoogle",{credential:r})).data,uje=r=>Jt(Zbe,{...r||{}}),hje=r=>Jt(eSe,{...r||{}}),tSe=()=>{const r=Eo(),e=Ze(gn),t=e==null?void 0:e.id,{pathname:i}=yu(),n=i.startsWith("/login")||i.startsWith("/register")||i.startsWith("/reset")||i.startsWith("/email-confirmation")||i.startsWith("/forgot")||i.startsWith("/github_auth");z.useEffect(()=>{(async()=>{if(!n)if(localStorage.getItem("access_token")){const o=localStorage.getItem("access_token");FC(o),LC(o)}else try{const a=(await zt.post("/user/refresh")).data.access_token;localStorage.setItem("access_token",a),FC(a),LC(a)}catch{r("/login")}})(),bee(t||"")},[r,t,n])},$W=r=>!!(r!=null&&r.client_url)&&window.location.href.includes(r.client_url),WW=()=>{const[r,e]=z.useState(!1),{urlMappings:t,isLoading:i,isFetched:n}=II(),s=Ti(TI),o=t.find($W),a=()=>window.location.protocol==="https:"?"https":"http";return z.useEffect(()=>{!i&&n&&(o?(XH(`${a()}://${o.worker_url}`),s(o)):XH(ZG()),e(!0))},[o,i,s,t,n]),{urlSet:r,isLoading:i,isFetched:n}},J6=()=>window.location.protocol==="https:"?"wss":"ws",HW=()=>{const{urlMappings:r}=II(),e=Ti(TI),t=r.find($W);return t?(e(t),`${J6()}://${t.worker_url}/ws`):_ee()},iSe=()=>{const{urlMappings:r}=II(),e=Ti(TI),t=r.find($W);return t?(e(t),`${J6()}://${t.lsp_url}/lsp`):wee()},RI="proxyTokens",nSe=async({workspaceId:r,userId:e})=>(await zt.get(`/token/${r}/${e}`)).data,jW=({workspaceId:r,userId:e})=>{const t=[RI,r,e],{data:i,...n}=rr(t,()=>nSe({workspaceId:r,userId:e}),{enabled:!!(r&&e)}),s=z.useMemo(()=>({tokens:i||[]}),[i]);return{...n,queryKey:t,...s}},rSe=async({workspaceId:r,name:e})=>(await zt.post("/token/",{workspace_id:r,name:e})).data,Z6=(r={})=>{const e=Li();return Jt(rSe,{...r,onSettled:()=>{e.invalidateQueries(RI)}})},e9=()=>{const r=Ze(gn),e=r==null?void 0:r.id,{user:t,isLoading:i}=nb(),[n,s]=Ji(X6),{isLoading:o,isFetched:a,tokens:c}=jW({userId:t.id,workspaceId:e}),d=n&&c.find(u=>u.token===n),l=c.length>0;return z.useEffect(()=>{const u=c.find(h=>h.is_selected);u?s(u.token):a&&c.length<=0&&s(null)},[c,e,a,s]),z.useEffect(()=>{Ei.defaults.headers["dropbase-proxy-token"]=n},[n]),{token:n,isLoading:i||o,isValid:d,hasTokens:l}},sSe=async({tokenId:r,name:e,region:t})=>(await zt.put(`/token/${r}`,{name:e,region:t})).data,oSe=(r={})=>{const e=Li();return Jt(sSe,{...r,onSettled:()=>{e.invalidateQueries(RI)}})},aSe=async({tokenId:r})=>(await zt.delete(`/token/${r}`)).data,cSe=(r={})=>{const e=Li();return Jt(aSe,{...r,onSettled:()=>{e.invalidateQueries(RI)}})};function _b(r,e){return Object.create({[e]:z.lazy(()=>r().then(t=>({default:t[e]})))})}const t9=sr(!1),fje=sr(!1),dSe=async r=>(await zt.get(`/user/github_auth/${r}`)).data,lSe=()=>{const r=Ut(),{search:e}=yu(),i=new URLSearchParams(e).get("code"),n=Ti(t9),s=Eo();return rr(["github_auth",i],()=>dSe(i||""),{enabled:!!i,onSuccess:o=>{o!=null&&o.access_token&&(o!=null&&o.refresh_token)&&(localStorage.setItem("access_token",o.access_token),localStorage.setItem("refresh_token",o.refresh_token),n((o==null?void 0:o.onboarding)||!1),s("/apps"))},onError:o=>{r({title:"Github Auth Failed",status:"error",description:ni(o)}),s("/login")}})},uSe=()=>{const{isLoading:r}=lSe(),e=Eo();return z.useEffect(()=>{r||e("/login")},[r,e]),f.jsxs(dn,{h:"100%",w:"100%",alignItems:"center",justifyContent:"center",direction:"column",children:[f.jsx(Ie,{children:"Authenticating with Github"}),f.jsx(ke,{mt:"2",w:"25%",children:f.jsx(_u,{size:"xs",isIndeterminate:!0})})]})},hSe=r=>Number.isFinite(+r)?+r:r,wb=r=>new Date(new Date(r).getTime()+new Date().getTimezoneOffset()*60*1e3),fSe=r=>new Date(hSe(r)-new Date().getTimezoneOffset()*60*1e3),pSe=r=>Object.prototype.toString.call(r)==="[object Date]"?!!Number.isFinite(+r):!1,Wm=r=>{try{const e=new Date(+r);return pSe(e)?e:new Date(r)}catch{return r}},gSe=r=>{const e=Wm(r);try{return Km(wb(e),"dd-MM-yyyy")}catch{return r}},mSe=r=>{try{const e=WG(r.split(".")[0],"HH:mm:ss",new Date);return Km(e,"hh:mm:ss a")}catch{return r}},vSe=r=>{try{const e=WG(r.split(".")[0],"HH:mm:ss",new Date).getTime(),t=fSe(e).getTime();if(Number.isNaN(t))throw new Error("Invalid date");return t}catch{return new Date().getTime()}},ySe=r=>{try{return Km(wb(r),"HH:mm:ss")}catch{return""}},_Se=r=>{const e=Wm(r);try{return Km(wb(e),"yyyy-MM-dd hh:mm:ss a")}catch{return r}},wSe=r=>{const e=Wm(r);try{return Km(wb(e),"yyyy-MM-dd'T'hh:mm").slice(0,10)}catch{return r.toString()}},bSe=r=>{const e=Wm(r);try{return Km(wb(e),"yyyy-MM-dd'T'hh:mm")}catch{return r.toString()}},H2=r=>{const[e,t]=z.useState(30),i=n=>{n.onDidContentSizeChange(s=>{const o=s.contentHeight;t(o),n.layout()})};return f.jsx(Gw,{...r,options:{lineNumbers:"off",glyphMargin:!1,folding:!1,lineDecorationsWidth:0,lineNumbersMinChars:0},height:e,onMount:i})},os=z.forwardRef((r,e)=>{var h;const{onChange:t,onBlur:i,value:n,type:s,onSelect:o,options:a,keys:c,hideClearOption:d,...l}=r;if(s==="number"||s==="integer"||s==="float")return f.jsxs(YJ,{onChange:(g,m)=>{const y=Number.isNaN(m)?null:m,_=g.endsWith(".")||g.endsWith(".0")||g.endsWith(".00")?g:y;t==null||t(s==="integer"?y:_)},size:"sm",onBlur:()=>{s==="float"&&n!==null&&(t==null||t(parseFloat(n)))},value:n===null?"":n,precision:2,step:s==="integer"?1:.01,...l,children:[f.jsx(XJ,{ref:e,h:"9"}),f.jsxs(JJ,{children:[f.jsx(ZJ,{}),f.jsx(eZ,{})]})]});if(s==="select")return f.jsx(iu,{onBlur:i,onChange:g=>{t==null||t(g.target.value)},ref:e,borderRadius:"sm",size:"sm",...l,value:n,placeholder:(l==null?void 0:l.placeholder)||"Select option",children:(a||[]).map(g=>f.jsx("option",{value:g.value,children:g.name},g.name))});if(s==="textarea")return f.jsx(tZ,{onBlur:i,onChange:g=>t==null?void 0:t(g.target.value),value:n||"",size:"sm",borderRadius:"sm",ref:e,...l});if(s==="custom-select"){const g=a==null?void 0:a.find(E=>E.value===n),m=g==null?void 0:g.name,y=(h=g==null?void 0:g.render)==null?void 0:h.call(g,g),_=f.jsx(Ie,{fontSize:"sm",children:y||m||(l==null?void 0:l.placeholder)||"Select option"}),b=a||[];return f.jsxs(sf,{children:[f.jsxs(q,{spacing:"0.5",children:[f.jsx(of,{as:q,direction:"row",alignItems:"center",borderWidth:"1px",p:"2",borderRadius:"sm",type:"button",onBlur:i,cursor:l!=null&&l.isDisabled?"not-allowed":"pointer",...l,children:f.jsxs(q,{w:"full",spacing:"0",alignItems:"center",direction:"row",children:[f.jsx(ke,{children:_}),f.jsx(ke,{ml:"auto",children:f.jsx(Ag,{size:"15"})})]})}),n&&!d?f.jsx(Qe,{onClick:()=>{t(null)},colorScheme:"gray",alignSelf:"start",size:"sm",variant:"link",children:"Clear"}):null]}),f.jsx(Qm,{children:f.jsx(af,{zIndex:"popover",pointerEvents:l!=null&&l.isDisabled?"none":"initial",borderRadius:"sm",shadow:"sm",p:"0",maxH:"sm",overflowY:"auto",children:b.length===0?f.jsx(mo,{children:f.jsx(Ie,{fontSize:"sm",children:"No options present"})}):f.jsx(ch,{value:n,onChange:E=>{t(E),o==null||o(E)},type:"radio",children:b.map((E,D)=>f.jsx(AC,{icon:E==null?void 0:E.icon,fontSize:"sm",value:E.value,"data-cy":`select-option-${D}`,children:E!=null&&E.render?E==null?void 0:E.render((E==null?void 0:E.value)===n):E.name},E.name))})})})]})}if(s==="array"){const g=n||[],m=c||["name","value"];return f.jsxs(q,{spacing:"2",children:[f.jsxs(q,{fontSize:"xs",fontWeight:"medium",letterSpacing:"wide",direction:"row",children:[m.map(y=>f.jsx(ke,{flex:"1",children:y},y)),f.jsx(ke,{minW:"8"})]}),g.map(y=>f.jsxs(q,{alignItems:"center",direction:"row",children:[m.map(_=>f.jsx(as,{size:"sm",flex:"1",placeholder:_,value:y==null?void 0:y[_],onChange:b=>{t(g.map(E=>E.id===y.id?{...E,[_]:b.target.value}:E))}},_)),f.jsx(St,{"aria-label":"Delete",icon:f.jsx(Fa,{size:"14"}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>{t(g.filter(_=>_.id!==y.id))}})]},y.id)),f.jsx(Qe,{size:"sm",leftIcon:f.jsx(Xs,{size:"14"}),variant:"outline",colorScheme:"gray",onClick:()=>{t([...g,m.reduce((y,_)=>({...y,[_]:`${_}${g.length+1}`}),{id:crypto.randomUUID()})])},children:"Add option"})]})}if(s==="multiselect"){const g=a||[];let m=f.jsx(Ie,{fontSize:"sm",children:(l==null?void 0:l.placeholder)||"Select option"});return Array.isArray(n)&&n.length>0&&(m=f.jsx(q,{spacing:"1",flexWrap:"wrap",direction:"row",children:n.map(y=>{var _;return f.jsx(Mg,{colorScheme:"gray",textTransform:"none",display:"inline-block",size:"sm",children:((_=g.find(b=>b.value===y))==null?void 0:_.name)||y},y)})})),f.jsxs(sf,{children:[f.jsxs(q,{children:[f.jsx(of,{as:q,type:"button",direction:"row",alignItems:"center",borderWidth:"1px",borderRadius:"sm",p:"2",cursor:l!=null&&l.isDisabled?"not-allowed":"pointer",...l,children:f.jsxs(q,{w:"full",spacing:"0",alignItems:"center",direction:"row",children:[f.jsx(ke,{children:m}),f.jsx(ke,{ml:"auto",children:f.jsx(Ag,{size:"14"})})]})}),n?f.jsx(Qe,{onClick:()=>{t(null)},colorScheme:"gray",alignSelf:"start",size:"sm",variant:"link",children:"Clear"}):null]}),f.jsx(af,{pointerEvents:l!=null&&l.isDisabled?"none":"initial",maxH:"sm",overflowY:"auto",minWidth:"240px",children:g.length===0?f.jsx(mo,{p:"2",children:f.jsx(Ie,{fontSize:"sm",color:"gray.700",children:"No options present"})}):f.jsx(ch,{value:n||[],onChange:y=>{l!=null&&l.isDisabled||(t(y),o==null||o(y))},type:"checkbox",children:g.map(y=>f.jsx(AC,{fontSize:"sm",value:y.value,children:y.name},y.value))})})]})}if(s==="sql")return f.jsx(ke,{w:"full",borderWidth:"1px",borderColor:"gray.300",borderRadius:"sm",p:"0.5",children:f.jsx(Gw,{language:"sql",value:n,onChange:t})});if(s==="template")return f.jsx(ke,{w:"full",borderWidth:"1px",p:"1.5",borderRadius:"sm",children:f.jsx(H2,{language:"plaintext",...l,value:n,onChange:t})});if(s==="boolean")return f.jsx(iZ,{size:"sm",mx:"auto",isChecked:!!n,onBlur:i,onChange:g=>{t==null||t(g.target.checked)},ref:e,...l});if(s==="markdown")return f.jsx(ke,{w:"full",borderWidth:"1px",p:"1.5",borderRadius:"sm",children:f.jsx(H2,{language:"markdown",...l,value:n,onChange:t})});let u=n;return s==="datetime"&&typeof n=="number"?u=bSe(n):s==="date"&&typeof n=="number"&&(u=wSe(n)),f.jsx(as,{onBlur:i,onChange:g=>t==null?void 0:t(g.target.value),value:u||"",size:"sm",ref:e,type:s==="datetime"?"datetime-local":s,...l})}),SSe=({id:r,type:e,validation:t,options:i,...n})=>{const{control:s}=Ck();return f.jsx(m1,{control:s,name:r,rules:t,render:({field:{onChange:o,onBlur:a,value:c,ref:d}})=>f.jsx(os,{onChange:o,onBlur:a,value:c,ref:d,type:e,options:i,...n})})},Zi=({name:r,type:e,validation:t,options:i,id:n,...s})=>{const{formState:{errors:o}}=Ck();return f.jsxs(tn,{isInvalid:!!(o!=null&&o[n]),children:[r&&f.jsxs(ir,{children:[s.isLoading?f.jsx(_d,{thickness:"2px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500",size:"xs",ml:"1",mr:"1"}):null,r," ",(s==null?void 0:s.required)&&f.jsx(ke,{as:"span",color:"red.500",children:"*"})]}),f.jsx(SSe,{name:r,id:n,type:e,options:i,validation:t,"data-cy":`property-${r}`,...s}),f.jsx(nZ,{errors:o,name:n,render:({message:a})=>f.jsx(Ek,{children:a})})]},r)},CSe=async({company:r,name:e,last_name:t})=>(await zt.post("/user/onboard",{name:e,last_name:t,company:r})).data,ESe=r=>Jt(CSe,{...r||{}}),xSe=()=>{const r=Ut(),e=Ze(t9),t=typeof e!="boolean"?{name:e.name,last_name:e.last_name}:{},i=Oa({defaultValues:t}),{isOpen:n,onClose:s}=Ki({defaultIsOpen:!!e}),{mutate:o,isLoading:a}=ESe({onSuccess:()=>{r({status:"success",title:"Onboarding complete"}),s()},onError:d=>{r({status:"error",title:"Error while onboarding",description:ni(d)})}}),c=d=>{let{name:l,last_name:u}=d;const{company:h}=d;typeof e!="boolean"&&(l=e.name,u=e.last_name),o({name:l,last_name:u,company:h})};return f.jsxs(_c,{isOpen:n,onClose:()=>null,children:[f.jsx(wc,{}),f.jsx(bc,{children:f.jsx(Pd,{...i,children:f.jsxs("form",{onSubmit:i.handleSubmit(c),children:[f.jsx(Sc,{fontSize:"md",borderBottomWidth:"1px",children:"Welcome to Dropbase!"}),f.jsx(Ad,{py:"6",children:f.jsxs(q,{spacing:"3",children:[typeof e=="boolean"?f.jsx(Zi,{name:"First Name",id:"name",placeholder:"Please enter your first name"}):f.jsx(Zi,{name:"First Name",id:"name",value:e==null?void 0:e.name,readOnly:!0}),typeof e=="boolean"?f.jsx(Zi,{name:"Last Name",id:"last_name",placeholder:"Please enter your last name"}):f.jsx(Zi,{name:"Last Name",id:"last_name",value:e==null?void 0:e.last_name,readOnly:!0}),f.jsx(Zi,{name:"Company",id:"company",placeholder:"Please enter your company"})]})}),f.jsx(Md,{borderTopWidth:"1px",children:f.jsx(Qe,{colorScheme:"blue",isLoading:a,type:"submit",size:"sm",children:"Continue"})})]})})})]})},DSe=()=>{const r=Eo(),{workspaces:e}=Ld(),t=xee(),i=()=>{t.mutate({})};return z.useEffect(()=>{e.length>0&&r("/apps")}),f.jsx(dn,{alignItems:"center",justifyContent:"center",h:"full",w:"full",children:f.jsxs(nu,{spacing:"8",children:[f.jsx(Ie,{fontSize:"4xl",children:"Welcome to Dropbase!"}),f.jsxs(nu,{children:[f.jsx(Ie,{fontSize:"xl",textAlign:"center",children:"To get started you can click the button below to create a workspace."}),f.jsx(Ie,{fontSize:"xl",textAlign:"center",children:"If you created an account to join someone else's workspace, you can skip creating a workspace and wait for them to invite you."})]}),f.jsx(Qe,{colorScheme:"blue",size:"lg",onClick:i,children:"Create Workspace"})]})})},{Login:kSe}=_b(()=>bi(()=>import("./index-33644165.js"),["assets/index-33644165.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/useResetPassword-b2d1b6d0.js"]),"Login"),{Register:TSe}=_b(()=>bi(()=>import("./index-33644165.js"),["assets/index-33644165.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/useResetPassword-b2d1b6d0.js"]),"Register"),{ResetPassword:ISe}=_b(()=>bi(()=>import("./index-33644165.js"),["assets/index-33644165.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/useResetPassword-b2d1b6d0.js"]),"ResetPassword"),{EmailConfirmation:RSe}=_b(()=>bi(()=>import("./index-33644165.js"),["assets/index-33644165.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/useResetPassword-b2d1b6d0.js"]),"EmailConfirmation"),{RequestResetLink:PSe}=_b(()=>bi(()=>import("./RequestResetLink-5423817e.js"),["assets/RequestResetLink-5423817e.js","assets/vendor-332432be.js","assets/vendor-feded0ab.css","assets/useResetPassword-b2d1b6d0.js"]),"RequestResetLink"),ASe=({homeRoute:r,children:e})=>{const{pathname:t}=yu(),i=t.startsWith("/login")||t.startsWith("/register")||t.startsWith("/reset")||t.startsWith("/email-confirmation")||t.startsWith("/forgot")||t.startsWith("/github_auth"),{isLoading:n,workspaces:s}=Ld(),o=Eo();return z.useEffect(()=>{let a=document.querySelector("link[rel*='icon']");a||(a=document.createElement("link"),a.rel="shortcut icon",document.getElementsByTagName("head")[0].appendChild(a)),a.type="image/x-icon",window.matchMedia("(prefers-color-scheme: dark)").matches?a.href="/favicon-dark.ico":a.href="/favicon-light.ico",window.location.hostname==="localhost"&&(a.href="/favicon-dev.ico")},[]),z.useEffect(()=>{!n&&s.length===0&&!i&&!t.includes("/intro")&&o("/intro")}),n?f.jsx(W2,{children:f.jsxs(mo,{as:q,spacing:"6",w:"full",h:"full",children:[f.jsx(q,{alignItems:"center",spacing:"0",children:f.jsx(Ie,{color:"heading",fontSize:"lg",fontWeight:"medium",children:"Checking user..."})}),f.jsx(_u,{minW:"sm",size:"xs",isIndeterminate:!0})]})}):f.jsx(z.Suspense,{fallback:f.jsx(mo,{w:"full",h:"full",children:f.jsx(_d,{thickness:"2px",speed:"0.5s",emptyColor:"gray.200",color:"blue.500",size:"lg"})}),children:f.jsx(xk,{children:f.jsxs(Bi,{path:"/",element:f.jsxs(W2,{children:[f.jsx(v1,{}),f.jsx(xSe,{})]}),children:[f.jsx(Bi,{index:!0,element:f.jsx(dd,{to:r})}),f.jsx(Bi,{path:"intro",element:f.jsx(DSe,{})}),f.jsx(Bi,{path:"login",element:f.jsx(kSe,{})}),f.jsx(Bi,{path:"register",element:f.jsx(TSe,{})}),f.jsx(Bi,{path:"forgot",element:f.jsx(PSe,{})}),f.jsx(Bi,{path:"reset",element:f.jsx(ISe,{})}),f.jsx(Bi,{path:"email-confirmation/:token/:userId",element:f.jsx(RSe,{})}),f.jsx(Bi,{path:"github_auth",element:f.jsx(uSe,{})}),e,f.jsx(Bi,{path:"*",element:f.jsx(dd,{to:r})})]})})})},MSe=HG(mo)`
	position: relative;
	::before {
		content: '';
		position: absolute;
		z-index: 99;
		${r=>r.direction==="horizontal"?{top:"-3px",height:"8px",width:"100%",background:"transparent"}:{right:"-3px",width:"8px",height:"100%",background:"transparent"}};
	}
`,ig=({direction:r,...e})=>{const t=r==="horizontal";return f.jsx(rZ,{children:f.jsx(MSe,{direction:r,role:"group",flexShrink:"0",w:t?"full":"1px",h:t?"1px":"full",transition:"all ease .2s",bg:"gray.200",_hover:{bg:"blue.500"},...e})})},nr=sr({widgetName:null,appName:null,pageName:null,widgets:[],modals:[]}),LSe=async()=>{const{data:r}=await Ei.get("/app/list/");return r},Xf="workspaceApps",Ud=()=>{const{id:r}=Ze(gn),e=[Xf,r],{data:t,...i}=rr(e,()=>LSe(),{enabled:!!r,staleTime:1e3*60*5});return{apps:t||[],...i}},Dc="pageData",FSe=async({appName:r,pageName:e})=>(await Ei.get(`/page/${r}/${e}`)).data,pi=({appName:r,pageName:e,...t})=>{var d,l;const i=[Dc,r,e],n=Eo(),s=Ut(),{data:o,...a}=rr(i,()=>FSe({appName:r,pageName:e}),{enabled:!!(r&&e),staleTime:1/0,...t}),c=z.useMemo(()=>{var h,g,m,y,_,b,E;const u=((g=(h=o==null?void 0:o.state_context)==null?void 0:h.properties)==null?void 0:g.blocks)||[];return{state:((m=o==null?void 0:o.state_context)==null?void 0:m.state)||{},context:((y=o==null?void 0:o.state_context)==null?void 0:y.context)||{},tables:u.filter(D=>D.block_type==="table")||[],widgets:u.filter(D=>D.block_type==="widget")||[],files:((b=(_=o==null?void 0:o.state_context)==null?void 0:_.properties)==null?void 0:b.files)||[],properties:((E=o==null?void 0:o.state_context)==null?void 0:E.properties)||{},permissions:(o==null?void 0:o.permissions)||{}}},[o]);return a!=null&&a.error&&((l=(d=a.error)==null?void 0:d.response)==null?void 0:l.status)===403&&(s.closeAll(),s({title:"Unauthorized",description:"You do not have permission to view this page.",status:"error"}),n("/apps")),{...a,queryKey:i,...c}},i9=()=>{const{appName:r,pageName:e}=Ri(),[t,i]=Ji(nr),n=z.useRef(!1),{widgets:s,isLoading:o,isRefetching:a,...c}=pi({appName:r,pageName:e});return z.useEffect(()=>{n.current=!1},[r,e,a]),z.useEffect(()=>{var d;if(!n.current&&!o&&!a){const u=(s==null?void 0:s.some(h=>h.name===t.widgetName))?t==null?void 0:t.widgetName:(d=s==null?void 0:s[0])==null?void 0:d.name;r&&e&&(i({widgetName:u||null,pageName:e,appName:r,widgets:s,modals:[]}),n.current=!0)}},[o,a,r,s,e,t,i]),z.useEffect(()=>()=>{i({widgetName:null,pageName:null,appName:null,widgets:null,modals:[]})},[i]),{isLoading:o,...c}},OSe=async r=>(await Ei.put("/page/",r)).data,Vr=(r={})=>{const e=Li();return Jt(OSe,{...r,onSettled:()=>{var t;e.invalidateQueries(Dc),(t=r==null?void 0:r.onSettled)==null||t.call(r)},onSuccess:(t,i)=>{var n;e.invalidateQueries(Dc),(n=r==null?void 0:r.onSuccess)==null||n.call(r,t,i)}})},NSe=async({appName:r,pageName:e,pageLabel:t})=>(await Ei.post("/page/",{app_name:r,page_name:e,page_label:t})).data,$Se=()=>{const r=Li();return Jt(NSe,{onSuccess:()=>{r.invalidateQueries(Xf)}})},WSe=async({appName:r,pageName:e,newPageLabel:t})=>(await Ei.put(`/page/${r}/${e}`,{new_page_label:t})).data,HSe=()=>{const r=Li();return Jt(WSe,{onSuccess:()=>{r.invalidateQueries(Xf)}})},jSe=async({appName:r,pageName:e})=>(await Ei.delete(`/page/${r}/${e}`)).data,BSe=()=>{const r=Li();return Jt(jSe,{onSuccess:()=>{r.invalidateQueries(Xf)}})},PI="widget/preview",n9=r=>{const{appName:e,pageName:t}=Ri(),{widgets:i,...n}=pi({appName:e,pageName:t}),s=z.useMemo(()=>i.find(o=>o.name===r)||{components:[],name:""},[i,r]);return{...n,...s}},USe=r=>r===0?0:r<5?1:r<10?3:r<15?5:r<20?10:30,VSe=r=>new Promise(e=>{const t=setTimeout(()=>{e(),clearTimeout(t)},r)}),bb=async r=>{let e=0;for(;;){e&&await VSe(USe(e)*1e3);const t=await Ei.get(`/query/status/${r}`);if(t.status===200)return t==null?void 0:t.data;e+=1}},BW=(r,e)=>{const{context:t,state:i,tables:n,...s}=pi({appName:r,pageName:e}),o=z.useRef(n);o.current=n;const a=Ti(ov),c=Ti(vu);return z.useEffect(()=>{a(d=>{const u=o.current.reduce((h,g)=>g.name in d?{...h,[g.name]:{...(i==null?void 0:i[g.name])||{},...(d==null?void 0:d[g.name])||{}}}:h,{});return{...i,...u}})},[i,a]),z.useEffect(()=>{c(t||{})},[t,c]),z.useEffect(()=>()=>{c({}),a({})},[c,a]),s},qSe=({appName:r,pageName:e})=>{BW(r,e)},UW=()=>{const r=Ti(vu);return z.useCallback(t=>{t!=null&&t.context&&(t==null?void 0:t.type)==="context"&&r(t==null?void 0:t.context)},[r])},j2=({children:r,...e})=>f.jsx(Cc,{cursor:"pointer",fontSize:"sm",_hover:{bg:"gray.100"},colorScheme:"white",...e,children:r}),IN=({obj:r,title:e,path:t,expandedPaths:i,isArray:n})=>{const s=Ut(),{isOpen:o,onToggle:a}=Ki({defaultIsOpen:i==null?void 0:i.includes(t)});return e?f.jsxs(f.Fragment,{children:[f.jsx(ke,{w:"full",_hover:{bg:"gray.50"},cursor:"pointer",onClick:a,px:"0.5",py:"1",children:f.jsxs(q,{spacing:"1",alignItems:"center",direction:"row",children:[f.jsx(j2,{color:"gray.900",as:"span",onClick:c=>{c.stopPropagation(),MC(t),s({status:"info",title:"Path copied"})},children:e}),o?null:f.jsx(ke,{fontSize:"xs",children:"..."})]})}),f.jsx(UP,{in:o,animateOpacity:!0,children:f.jsxs(q,{spacing:"0",ml:"4",borderLeftWidth:"1px",children:[Object.keys(r[e]).length===0?f.jsx(Ie,{fontSize:"xs",color:"gray.500",p:"2",children:"No content present"}):null,Object.keys(r[e]).map(c=>{const d=r[e][c],l=n?`${t?`${t}`:""}[${c}]`:`${t?`${t}.`:""}${c}`;return typeof d=="object"&&d!==null?f.jsx(IN,{path:l,title:c,isArray:Array.isArray(d),expandedPaths:i,obj:r[e]},c):f.jsxs(q,{color:"gray.700",fontWeight:"300",px:"0.5",alignItems:"center",direction:"row",children:[f.jsx(j2,{onClick:()=>{MC(l),s({status:"info",title:"Path copied"})},flex:"1",children:c}),f.jsx(Cc,{flexGrow:"0",fontSize:"xs",overflow:"hidden",bg:"white",p:"0.5",textOverflow:"ellipsis",flex:"1",whiteSpace:"nowrap",color:d==null?"gray.400":"gray.700",children:String(d)})]},c)})]})})]}):f.jsx(q,{spacing:"0",children:Object.keys(r).map(c=>f.jsx(IN,{expandedPaths:i,path:c,isArray:Array.isArray(r),obj:r,title:c},c))})},GSe=["user_input","state","tables"],zSe=()=>{const{pageName:r,appName:e}=Ze(nr),{isLoading:t}=BW(e||"",r||""),i=Ze(Ba);return t?f.jsx(hi,{}):f.jsx(ke,{p:"2",flex:"1",bg:"white",h:"full",overflowX:"hidden",overflowY:"auto",children:f.jsx(IN,{obj:i,expandedPaths:GSe})})},ov=sr({}),vu=sr({}),Ba=sr(r=>({state:r(ov),context:r(vu)})),KSe="table",Co=r=>{const{appName:e,pageName:t}=Ri(),{tables:i,...n}=pi({appName:e,pageName:t}),s=i.find(a=>a.name===r),o=z.useMemo(()=>({...s||{},type:s==null?void 0:s.type,filters:((s==null?void 0:s.filters)||[]).map(a=>({...a,pinned:!0,id:crypto.randomUUID()})),height:s==null?void 0:s.height,name:s==null?void 0:s.name,label:s==null?void 0:s.label,columns:(s==null?void 0:s.columns)||[]}),[s]);return{...n,table:s,...o}},AI="dataFetchers",QSe=async({table:r,state:e,appName:t,pageName:i})=>{var s;const n=await Ei.post("/tables/convert/",{table:r,state:e,app_name:t,page_name:i});if((s=n.data)!=null&&s.job_id)return await bb(n.data.job_id);throw new Error("Cant convert to table")},r9="convertMutation",s9=(r={})=>{const e=Li(),{table:t,...i}=r;return Jt(QSe,{...i,mutationKey:`${r9}-${t}`,onSettled:()=>{e.invalidateQueries(Dc),e.invalidateQueries(VW),e.invalidateQueries(av)}})},YSe=async({appName:r,pageName:e,state:t,source:i,fileContent:n})=>{var o;const s=await Ei.post("/query/sql_string/",{app_name:r,page_name:e,state:t,source:i,file_content:n});if((o=s.data)!=null&&o.job_id)return await bb(s.data.job_id);throw new Error("Failed to run python function")},XSe=(r={})=>{const e=Li();return Jt(YSe,{...r,onSettled:()=>{e.invalidateQueries(PI)}})},JSe=async({pageName:r,appName:e,fileType:t,fileName:i,code:n,source:s,depends:o})=>(await Ei.put(`files/${i}`,{page_name:r,app_name:e,file_name:i,code:n,source:s,type:t,depends_on:o})).data,o9=(r={})=>{const e=Li();return Jt(JSe,{onSettled:(t,i,n)=>{e.invalidateQueries(KSe),e.invalidateQueries([av,n==null?void 0:n.fileName]),e.invalidateQueries(VW),e.invalidateQueries(Sb),e.invalidateQueries(AI),e.invalidateQueries(Dc)},...r})},VW="column/properties",MI=sr({type:null,id:null}),Io=sr({type:null,id:null,meta:null}),zw=sr(r=>{const e=r(Io);return e.type==="table"?e.id:null}),LI=sr({name:null,code:null}),qW=(r={})=>{const e=Li(),t=Ut(),i=Ti(nr),n=Ti(Io);return Vr({...r,onSuccess:o=>{var a;i(c=>{var d;return{...c,widgetName:(d=o==null?void 0:o.widget)==null?void 0:d.id}}),n({type:"widget",id:(a=o==null?void 0:o.widget)==null?void 0:a.id,meta:null}),t({status:"success",title:"Widget created"})},onError:o=>{t({status:"error",title:"Failed to create widget",description:ni(o)})},onSettled:()=>{e.invalidateQueries(Dc)}})},GW="functionNames",ZSe=async({fileCode:r,testCode:e,pageState:t})=>{var n;const i=await Ei.post("query/python_string/",{file_code:r,test_code:e,...t});if((n=i.data)!=null&&n.job_id)return await bb(i.data.job_id);throw new Error("Failed to run python function")},eCe=(r={})=>{const e=Li();return Jt(ZSe,{...r,onSettled:()=>{e.invalidateQueries(PI),e.invalidateQueries(GW)}})},Sb="allFiles",tCe=async({pageName:r,appName:e})=>(await Ei.get(`/files/all/${e}/${r}/`)).data,a9=({pageName:r,appName:e})=>{const t=[Sb,r,e],{data:i,...n}=rr(t,()=>tCe({pageName:r,appName:e}),{enabled:!!e&&!!r}),s=z.useMemo(()=>({files:(i==null?void 0:i.files)||[]}),[i]);return{...n,queryKey:t,...s}},iCe=async({fileName:r,appName:e,pageName:t})=>(await Ei.get(`/workspace/${e}/${t}/scripts/${r}/`)).data,nCe="file",c9=({fileName:r,appName:e,pageName:t})=>{const i=[nCe,r,e,t],{data:n,...s}=rr(i,()=>iCe({fileName:r,appName:e,pageName:t}),{enabled:!!(r&&e&&t),cacheTime:0,staleTime:0}),o=z.useMemo(()=>({code:n||""}),[n]);return{...s,queryKey:i,...o}},rCe=async({pageName:r,fileName:e,appName:t,pageId:i,type:n})=>(await Ei.post("/files/",{name:e,page_id:i,app_name:t,page_name:r,type:n,source:null,depends_on:[]})).data,sCe=(r={})=>{const e=Li();return Jt(rCe,{...r,onSettled:()=>{e.invalidateQueries(Sb),e.invalidateQueries(Dc),e.invalidateQueries(AI),e.invalidateQueries(GW)}})},oCe=async({pageName:r,fileType:e,fileName:t,appName:i})=>(await Ei.delete("/files/",{data:{app_name:i,page_name:r,file_name:t,type:e}})).data,aCe=(r={})=>{const e=Li();return Jt(oCe,{...r,onSettled:()=>{e.invalidateQueries(Sb),e.refetchQueries(Dc),e.invalidateQueries(AI)}})},cCe=async({pageName:r,pageId:e,fileName:t,fileType:i,appName:n,newFileName:s})=>(await Ei.put("/files/rename",{app_name:n,page_name:r,old_name:t,new_name:s,type:i,page_id:e})).data,dCe=(r={})=>{const e=Ut(),t=Li();return Jt(cCe,{...r,onError:i=>{e({status:"error",title:"Failed to update function",description:ni(i)})},onSettled:()=>{t.invalidateQueries(Sb),t.refetchQueries(Dc),t.invalidateQueries(AI),t.invalidateQueries(GW)}})},lCe=async()=>(await Ei.get("/components/properties/all")).data,Cb=()=>{const r=["resource/fields"],{data:e,...t}=rr(r,()=>lCe(),{cacheTime:1/0,staleTime:1/0});return{...t,queryKey:r,fields:e||{}}},uCe="widget/properties",hCe=async({widgetId:r,components:e})=>(await zt.post("/components/reorder",{widget_id:r,components:e})).data,fCe=(r={})=>{const e=Li();return Jt(hCe,{...r,onSettled:()=>{e.invalidateQueries(uCe),e.invalidateQueries(PI)}})},pCe="sources",gCe=async()=>(await Ei.get("/sources/")).data,mCe=()=>{const r=[pCe],{data:e,...t}=rr(r,()=>gCe()),i=z.useMemo(()=>({sources:(e==null?void 0:e.sources)||[]}),[e]);return{...t,queryKey:r,...i}},d9=sr({}),zW=sr({}),l9=sr({}),KW=sr({}),vCe=LN("columnWidth",{}),u9=sr({}),av="tableData",yCe=async({fetcher:r,appName:e,pageName:t,state:i,filter_sort:n=null})=>{var o;const s=await Ei.post("/query/",{fetcher:r,app_name:e,page_name:t,state:i.state,filter_sort:n});if((o=s.data)!=null&&o.job_id)return await bb(s.data.job_id);throw new Error("Failed to retrieve data from fetcher")},_Ce=(r,e)=>z.useMemo(()=>{var t,i;if(r){const n=(t=e==null?void 0:e.columns)==null?void 0:t.filter(a=>a.column_type==="button_column"&&!(a!=null&&a.hidden)),s=[...(r==null?void 0:r.columns)||[],...n||[]];return{rows:((i=r==null?void 0:r.data)==null?void 0:i.map(a=>a.reduce((c,d,l)=>{var u;return{...c,[(u=s==null?void 0:s[l])==null?void 0:u.name]:d}},{})))||[],header:s,tableName:r.table_name,tableError:r==null?void 0:r.error}}return{rows:[],header:[],tableError:null}},[r,e]),wCe=({tableName:r,filters:e=[],sorts:t=[],appName:i,pageName:n,currentPage:s,pageSize:o})=>{var K,H;const{tables:a,files:c,isFetching:d}=pi({appName:i,pageName:n}),[l]=sZ(e,1e3),u=Ti(ov),h=Ze(Ba),g=z.useRef(h);g.current=h;const m=a.find(C=>C.name===r),y=Ze(u9),_=(c||[]).filter(C=>{var B;return(B=C==null?void 0:C.depends_on)==null?void 0:B.includes(r)}).map(C=>C.name),b=(K=a==null?void 0:a.filter(C=>_==null?void 0:_.includes(C==null?void 0:C.fetcher)))==null?void 0:K.map(C=>C==null?void 0:C.name),E=((H=c.find(C=>C.name===(m==null?void 0:m.fetcher)))==null?void 0:H.depends_on)||[],D=E.filter(C=>!y[C]),R=h==null?void 0:h.state,M=E.reduce((C,B)=>({...C,[B]:R[B]}),{}),O=[av,m==null?void 0:m.fetcher,r,i,n,m==null?void 0:m.type,s,o,JSON.stringify({debouncedFilters:l,sorts:t,dependentTableData:M})],{data:L,...W}=rr(O,()=>yCe({appName:i,pageName:n,state:g.current,fetcher:m==null?void 0:m.fetcher,filter_sort:{filters:e,sorts:t,pagination:{page:s||0,page_size:o||0}}}),{enabled:!!(!d&&(m==null?void 0:m.name)in R&&(m!=null&&m.fetcher)&&m&&i&&n&&Object.keys((h==null?void 0:h.state)||{}).length>0&&D.length===0),staleTime:1/0,onError:()=>{(b==null?void 0:b.length)>0&&u(C=>{const B=[...b,r].reduce((te,ue)=>({...te,[ue]:Object.keys((C==null?void 0:C[ue])||{}).reduce((be,de)=>({...be,[de]:null}),{})}),{});return{...C,...B}})}}),Z=_Ce(L,m);return{...W,...Z,sqlId:L==null?void 0:L.sql_id,queryKey:O}},bCe=async({file:r,edits:e})=>(await Ei.post("/edit_cell/edit_sql_table/",{file:r,edits:e})).data,SCe=(r={})=>{const e=Li();return Jt(bCe,{...r,onSettled:()=>{e.invalidateQueries(av)}})},h9=20,f9=z.createContext({tableName:null}),cv=()=>z.useContext(f9).tableName,Jf=r=>{var g,m;const{pageName:e,appName:t}=Ri(),n=(Ze(l9)[r]||[]).filter(y=>y.column_name),s=((g=Ze(KW))==null?void 0:g[r])||{currentPage:0,pageSize:h9},{tables:o,isLoading:a}=pi({appName:t,pageName:e}),c=o==null?void 0:o.find(y=>y.name===r),d=(m=c==null?void 0:c.columns)==null?void 0:m.reduce((y,_)=>({...y,[_.name]:_}),{}),u=(Ze(zW)[r]||[]).filter(y=>y.condition==="is null"||y.condition==="is not null"?y.column_name:y.column_name&&y.value).map(y=>{var _;return{...y,column_type:((_=d[y==null?void 0:y.column_name])==null?void 0:_.display_type)||""}}),h=wCe({tableName:r,filters:u,sorts:n,pageName:e,appName:t,...s});return{...h,isLoading:a||h.isLoading,columns:c==null?void 0:c.columns,columnDict:d}},CCe=r=>{const{header:e,columns:t,isLoading:i,isRefetching:n,columnDict:s}=Jf(r),[o,a]=z.useState(!1);return z.useEffect(()=>{if(!i||!n){const c=e.every(d=>s[d==null?void 0:d.name])&&e.length===(t==null?void 0:t.length);a(!c)}},[e,i,n,t,s,r]),e.length>0?o:!1},ECe=async({pageName:r,appName:e,pageState:t,functionName:i})=>{var s;const n=await Ei.post("/function/",{page_name:r,app_name:e,function_name:i,payload:t});if((s=n.data)!=null&&s.job_id)return await bb(n.data.job_id);throw new Error("Failed to run python function")},p9=(r={})=>{const e=Li();return Jt(ECe,{...r,onSettled:()=>{e.invalidateQueries(PI)}})},g9=r=>{const e=Ut(),t=Li(),[{pageName:i,appName:n,widgets:s,widgetName:o},a]=Ji(nr),{tables:c}=pi({appName:n,pageName:i}),d=Ze(Ba),l=UW(),u=p9({onSuccess:m=>{var y;l(m),(y=r==null?void 0:r.onSuccess)==null||y.call(r,m)},onError:m=>{var y;e({status:"error",title:"Failed to execute action",description:ni(m)}),(y=r==null?void 0:r.onError)==null||y.call(r)}}),h=m=>{u.mutate({pageName:i,appName:n,functionName:m,pageState:d})};return m=>{var y;switch(m.type){case"widget":{const _=s==null?void 0:s.find(b=>b.name===m.value);(_==null?void 0:_.type)==="modal"?a(b=>({...b,widgetName:m.value,modals:[...b.modals.filter(E=>E.name!==m.value),{name:m.value,caller:o}]})):a(b=>({...b,modals:[],widgetName:m.value}));break}case"function":{h(m.value);break}case"table":{t.invalidateQueries([av,(y=c==null?void 0:c.find(_=>_.name===m.value))==null?void 0:y.fetcher]);break}}}},QW=({children:r,isLoading:e,...t})=>e?f.jsx(q,{p:4,h:14,bg:"white",borderBottomWidth:"1px",...t,children:f.jsx(hi,{h:"full"})}):r,xCe=({children:r,isLoading:e})=>e?f.jsx(q,{h:"full",bg:"white",p:4,children:f.jsx(hi,{h:"full",minH:"20",startColor:"gray.100",endColor:"gray.200"})}):r,Al=({children:r,isLoading:e})=>e?f.jsxs(q,{spacing:"0",h:"full",bg:"white",children:[f.jsx(QW,{isLoading:!0}),f.jsx(xCe,{isLoading:!0})]}):r,pP=({children:r,isLoading:e})=>e?f.jsxs(q,{spacing:"1",children:[f.jsx(hi,{h:"6",startColor:"gray.50",endColor:"gray.100",w:"24"}),f.jsx(ke,{w:"full",borderWidth:"1px",borderRadius:"sm",children:f.jsx(hi,{h:"8",startColor:"gray.100",endColor:"gray.200",w:"full"})})]}):r,DCe=r=>{const{appName:e,pageName:t}=Ri(),{isConnected:i}=Bd(),{widgets:n}=Ze(nr),{isPreview:s}=Ze(Zo),{properties:o}=pi({appName:e,pageName:t}),a=qW(),c=Ti(nr),d=u=>{c(h=>({...h,widgetName:u}))},l=async()=>{const{name:u,label:h}=Bf({currentNames:n==null?void 0:n.map(g=>g.name),prefix:"widget"});try{await a.mutateAsync({app_name:e,page_name:t,properties:{...o||{},blocks:[...(o==null?void 0:o.blocks)||[],{name:u,label:h,type:"base",block_type:"widget",menu_item:!0,components:[]}]}}),d(u)}catch{}};return s?null:f.jsx(Bn,{label:"Add Widget",children:f.jsx(St,{"aria-label":"Add Widget",icon:f.jsx(Xs,{size:"14"}),variant:"outline",size:"xs",colorScheme:"gray",isLoading:a.isLoading,onClick:l,isDisabled:!i,...r})})},kCe=()=>{const{widgetName:r,widgets:e}=Ze(nr),{isPreview:t}=Ze(Zo),i=Ti(nr),n=Ti(Io),[s,o]=z.useState(250);z.useEffect(()=>{var l,u;const d=(u=(l=document.getElementById("preview-container"))==null?void 0:l.getBoundingClientRect())==null?void 0:u.width;d&&!Number.isNaN(d)&&o(Math.min(d-20,300))},[t]);const a=d=>{i(l=>({...l,widgetName:d})),n({type:"widget",id:d,meta:null})},c=(e==null?void 0:e.filter(d=>t?d.type==="base"&&d.in_menu:!0))||[];return f.jsxs(sf,{placement:"bottom-end",closeOnSelect:!0,children:[f.jsx(Bn,{label:"Switch widget",children:f.jsx(of,{icon:f.jsx(Ag,{size:"14"}),as:St,colorScheme:"gray",variant:"outline",ml:"auto",size:"xs"})}),f.jsx(af,{minW:s,children:f.jsx(ch,{value:r||"",onChange:a,title:"Select widget",type:"radio",children:(c==null?void 0:c.length)>0?c==null?void 0:c.map(d=>f.jsx(AC,{value:d==null?void 0:d.name,children:f.jsxs(ke,{display:"flex",alignItems:"end",children:[f.jsxs(q,{direction:"row",children:[f.jsx(Ie,{fontSize:"md",children:d.label}),d.type!=="base"?f.jsx(FN,{size:"sm",colorScheme:"yellow",children:f.jsx(Cc,{bg:"transparent",textTransform:"capitalize",children:d.type})}):null]}),!t&&f.jsx(Cc,{fontSize:"sm",bg:"transparent",color:"gray.600",ml:"auto",children:d.name})]})},d==null?void 0:d.name)):f.jsx(Ie,{py:"0.5",px:"4",fontSize:"md",children:"No widgets present"})})})]})},TCe=["number","integer","float"],ICe=["datetime","date","time"],RCe=[{name:"Equal to",value:"equals"},{name:"Not equal to",value:"not_equals"},{name:"Exists",value:"exists"}],B2=["exists"],PCe=[{name:"Less than",value:"lt"},{name:"Less than and equal to",value:"lte"},{name:"Greater than",value:"gt"},{name:"Greater than and equal to",value:"gte"}],RN={letterSpacing:"wide",fontSize:"xs",fontWeight:"semibold",mb:"1"},ACe=({rule:r,onChange:e,displayRules:t,getColType:i,isInvalid:n,getComponentProperty:s,targets:o})=>{const[a,c]=z.useState(r.target),d=()=>r.target?o==null?void 0:o.flat().some(u=>u.value===r.target):!0,l=u=>{const h=s(u);return u?(h==null?void 0:h.component_type)==="select"&&(h!=null&&h.multiple)?"string_array":i(u):"text"};return z.useEffect(()=>{c(r.target)},[r.target]),f.jsxs(oZ,{onSelectOption:({item:u})=>{e(t.map(h=>h.id===r.id?{...h,target:u.value,target_type:l(u.value)}:h)),c(u.value)},children:[f.jsxs(tn,{isInvalid:n,children:[f.jsx(ir,{...RN,children:"Target"}),f.jsx(aZ,{size:"sm",value:a,"data-cy":"display-rule-target",borderWidth:d()?null:"2px",borderColor:d()?null:"orange.300",onChange:u=>{c(u.target.value)},submitKeys:["Enter"]}),!d()&&f.jsx(Ie,{mt:"1",fontSize:"xs",color:"orange.500",children:"Target does not exist. This rule will not work."})]}),f.jsx(cZ,{children:o==null?void 0:o.flat().map(u=>f.jsx(dZ,{value:u==null?void 0:u.value,fontSize:"sm",children:u==null?void 0:u.label},u==null?void 0:u.value))})]})},MCe=({name:r})=>{var _;const{widgetName:e,widgets:t}=Ze(nr),i=Ze(ov),{appName:n,pageName:s}=Ri(),{properties:o}=pi({appName:n,pageName:s}),a=(o==null?void 0:o.blocks)||{},c=((_=t==null?void 0:t.find(b=>b.name===e))==null?void 0:_.components)||[],{control:d}=Ck(),l=c.filter(b=>b.name!==r&&(b.component_type==="select"||b.component_type==="input"||b.component_type==="boolean")).reduce((b,E)=>({...b,[E==null?void 0:E.name]:E}),{}),u=b=>b?l==null?void 0:l[b.split(".")[1]]:null,h=b=>{var L;if(!b)return"text";const E=u(b);if(b.includes("widgets"))return E==null?void 0:E.data_type;const[D,R]=b.split("."),M=a==null?void 0:a.find(W=>W.name===D),O=(L=M==null?void 0:M.columns)==null?void 0:L.find(W=>W.name===R);return O==null?void 0:O.display_type},g=b=>{if(!b)return"text";const E=l==null?void 0:l[b.split(".")[2]];if(b.includes("widgets")&&(E==null?void 0:E.component_type)==="select")return"select";const D=h(b);return D==="boolean"?"select":D},m=b=>{if(!b)return null;const E=l==null?void 0:l[b.split(".")[2]];return h(b)==="boolean"?[{name:"True",value:!0},{name:"False",value:!1}]:b.includes("widgets")&&(E==null?void 0:E.component_type)==="select"?E==null?void 0:E.options:null},y=Object.keys(i).map(b=>{var D;const E=i==null?void 0:i[b];return(D=Object.keys(E||{}))==null?void 0:D.map(R=>({label:`${b}.${R}`,value:`${b}.${R}`}))});return f.jsx(tn,{children:f.jsx(m1,{control:d,name:"display_rules",rules:{validate:b=>(b==null?void 0:b.length)>0&&!b.every(D=>D!=null&&D.operator&&B2.includes(D==null?void 0:D.operator)?!!D.target:D.target&&D.operator&&D.value)?"All rule fields must be complete":!0},render:({field:{onChange:b,value:E},fieldState:{error:D},formState:{isValid:R,isSubmitted:M}})=>{const O=E||[];return f.jsxs(q,{spacing:"2.5",children:[O.map((L,W)=>{let Z=!1;const K=h(L.target);return(TCe.includes(K)||ICe.includes(K))&&(Z=!0),f.jsxs(q,{direction:"column",spacing:"2",children:[W===0?null:f.jsx(ke,{w:"20",alignSelf:"center",children:f.jsx(os,{size:"sm",flex:"1",type:"select",placeholder:"Andor",value:L==null?void 0:L.andor,options:[{name:"And",value:"and"},{name:"Or",value:"or"}],onChange:H=>{b(O.map(C=>C.id===L.id?{...C,andor:H}:C))}})}),f.jsx(ACe,{rule:L,onChange:b,targets:y,displayRules:O,getColType:h,isInvalid:!R&&M&&!L.target,getComponentProperty:u}),f.jsxs(q,{alignItems:"end",direction:"row",children:[f.jsxs(tn,{isInvalid:!R&&M&&!L.operator,children:[W===0?f.jsx(ir,{...RN,children:"Operator"}):null,f.jsx(os,{size:"sm",flex:"1",type:"select",placeholder:"Operator",value:L.operator,options:[...RCe,...Z?PCe:[]],"data-cy":"display-rule-operator",onChange:H=>{b(O.map(C=>C.id===L.id?{...C,operator:H}:C))}})]}),B2.includes(L.operator)?null:f.jsxs(tn,{isInvalid:!R&&M&&!L.value,children:[W===0?f.jsx(ir,{...RN,children:"Value"}):null,f.jsx(os,{size:"sm",flex:"1",disabled:!L.target,placeholder:"select value",type:g(L.target),value:L.value,options:m(L.target),"data-cy":"display-rule-value",onChange:H=>{b(O.map(C=>C.id===L.id?{...C,value:H}:C))}})]}),f.jsx(St,{"aria-label":"Delete",icon:f.jsx(Fa,{size:"14"}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>{b(O.filter(H=>H.id!==L.id))}})]},L.id)]},L.id)}),D&&f.jsx(Ie,{fontSize:"sm",color:"red",children:D==null?void 0:D.message}),f.jsx(Qe,{size:"sm",leftIcon:f.jsx(Xs,{size:"14"}),variant:"outline",colorScheme:"gray","data-cy":"add-display-rule",onClick:()=>{b((O==null?void 0:O.length)>0?[...O,{target:null,value:null,operator:null,andor:"and",id:crypto.randomUUID()}]:[{target:null,value:null,operator:null,id:crypto.randomUUID()}])},children:"Add rule"})]})}})})},YW=({value:r,currentNames:e,onUpdate:t,buttonProps:i,resource:n})=>{const[s,o]=z.useState(r),[a,c]=z.useState(!1),d=()=>{o(r),c(!1)};z.useEffect(()=>{o(r),c(!1)},[r]);const l=h=>{const g=h.target.value;c(kee(r,g,e)),o(g)},u=async h=>{try{t(s),h==null||h()}catch{}};return f.jsx(Ir,{onClose:d,placement:"bottom-end",closeOnBlur:!1,children:({onClose:h})=>f.jsxs(f.Fragment,{children:[f.jsx(Rr,{children:f.jsx(St,{size:"xs",variant:"outline",colorScheme:"gray",icon:f.jsx(n_,{size:"12"}),"aria-label":"Edit app",...i||{}})}),f.jsxs(jr,{children:[f.jsx(xs,{}),f.jsx(Br,{children:f.jsxs(tn,{isInvalid:!!a,children:[f.jsx(ir,{children:"Edit name"}),f.jsx(as,{size:"sm",placeholder:`Enter ${n} name`,value:s,onChange:l,onKeyDown:g=>{g.key==="Enter"&&a===!1&&(u(h),g.preventDefault())}}),f.jsx(Ek,{children:a})]})}),f.jsx(cs,{display:"flex",alignItems:"end",children:f.jsxs(vr,{ml:"auto",size:"xs",children:[f.jsx(Qe,{onClick:h,colorScheme:"gray",variant:"outline",children:"Cancel"}),f.jsx(Qe,{isDisabled:r===s||!s||!!a,colorScheme:"gray",variant:"outline",onClick:()=>u(h),children:"Update"})]})})]})]})})},XW=({id:r})=>{var L,W,Z;const{control:e}=Ck(),{pageName:t,appName:i,widgetName:n}=Ze(nr),[{id:s},o]=Ji(Io),{widgets:a,isLoading:c,files:d,properties:l,tables:u}=pi({appName:i,pageName:t}),h=qW(),g=Ti(nr),m=(L=d.filter(K=>K.type==="ui"))==null?void 0:L.map(K=>({value:K==null?void 0:K.name,type:"function",label:K==null?void 0:K.label})),y=(W=a.filter(K=>K.type==="modal"))==null?void 0:W.map(K=>({value:K==null?void 0:K.name,type:"widget",label:K==null?void 0:K.label})),_=(Z=a.filter(K=>K.type==="base"))==null?void 0:Z.map(K=>({value:K==null?void 0:K.name,type:"widget",label:K==null?void 0:K.label})),b=u==null?void 0:u.map(K=>({value:K==null?void 0:K.name,type:"table",label:K==null?void 0:K.label})),E=[...m,...y,..._,...b],D=({option:K,showBadge:H})=>{var be;const C=(be=E||[])==null?void 0:be.find(de=>K.type===de.type&&de.value===K.value);if(!C)return null;let B=Dk,te={color:"purple",children:"UI Function"};return C.type==="function"?B=y1:C.type==="table"&&(B=r_,te={color:"blue",children:"Table"}),(C==null?void 0:C.type)==="widget"&&(a.find(le=>le.name===C.value)?te={color:"blue",children:"Widget"}:te={color:"yellow",children:"Modal"}),f.jsxs(q,{alignItems:"center",direction:"row",children:[f.jsx(Wf,{boxSize:"5",as:B,flexShrink:"0"}),f.jsxs(q,{direction:"row",flex:"1",spacing:"0",children:[C!=null&&C.label?f.jsx(Ie,{fontWeight:"medium",fontSize:"sm",children:C.label}):null,f.jsx(Cc,{bg:"transparent",ml:C!=null&&C.label?"1.5":"0",children:C==null?void 0:C.value})]}),H?f.jsx(Mg,{size:"xs",textTransform:"capitalize",ml:"1",colorScheme:te.color,variant:"subtle",children:te.children}):null]})},R=K=>{const H=`${K.type}-${K.value}`;return f.jsx(AC,{fontSize:"sm",value:H,children:D({option:K})},H)},M=K=>{g(H=>({...H,widgetName:K}))},O=async K=>{const{name:H,label:C}=Bf({currentNames:a==null?void 0:a.map(B=>B.name),prefix:"widget"});try{await h.mutateAsync({app_name:i,page_name:t,properties:{...l||{},blocks:[...((l==null?void 0:l.blocks)||[]).map(B=>B.type==="widget"&&B.name===n?{...B,components:(B.components||[]).map(te=>te.name===s?{...te,on_click:{type:"widget",value:H}}:te)}:B),{name:H,label:C,type:K,menu_item:!0,components:[]}]}}),M(H),o({type:"widget",id:H,meta:null})}catch{}};return f.jsxs(tn,{children:[f.jsx(ir,{children:r}),f.jsx(m1,{control:e,name:r,render:({field:{onChange:K,onBlur:H,value:C}})=>{const B=ue=>{if(ue==="new_widget")return;const be=E.find(de=>`${de.type}-${de.value}`===ue);K({type:be.type,value:be.value})},te=C?`${C.type}-${C.value}`:"";return f.jsxs(sf,{children:[f.jsxs(q,{spacing:"1",children:[f.jsx(of,{as:q,disabled:c,direction:"row",alignItems:"center",borderWidth:"1px",p:"1.5",borderRadius:"sm",type:"button",onBlur:H,children:f.jsxs(q,{w:"full",spacing:"0",alignItems:"center",direction:"row",children:[f.jsx(ke,{children:C?D({option:C,showBadge:!0}):f.jsx(Ie,{fontSize:"sm",children:"No options present"})}),f.jsx(ke,{ml:"auto",children:f.jsx(Ag,{size:"14"})})]})}),C?f.jsx(Qe,{onClick:()=>{K(null)},colorScheme:"gray",alignSelf:"start",size:"sm",variant:"link",children:"Clear"}):null]}),f.jsx(Qm,{children:f.jsxs(af,{zIndex:"popover",borderRadius:"sm",shadow:"sm",p:"0",maxH:"sm",minW:"sm",overflowY:"auto",children:[f.jsx(ch,{value:te,title:"Trigger Function",type:"radio",onChange:B,children:m.map(ue=>R(ue))}),f.jsx(qI,{}),f.jsx(ch,{value:te,title:"Reload Tables",onChange:B,type:"radio",children:b.map(ue=>R(ue))}),f.jsx(qI,{}),f.jsxs(ch,{value:te,title:"Show Modal",onChange:B,type:"radio",children:[y.map(ue=>R(ue)),f.jsx(Nl,{fontSize:"md",value:"new_widget",icon:f.jsx(Xs,{size:"14"}),onClick:()=>{O("modal")},children:"Create modal Widget"})]}),f.jsx(qI,{}),f.jsxs(ch,{value:te,title:"Navigate to Widget",onChange:B,type:"radio",children:[_.map(ue=>R(ue)),f.jsx(Nl,{fontSize:"md",value:"new_widget",icon:f.jsx(Xs,{size:"14"}),onClick:()=>{O("base")},children:"Create base Widget"})]})]})})]})}})]})},tr=({children:r,...e})=>f.jsx(q,{direction:"row",display:"flex",alignItems:"center",...e,children:r}),LCe=({children:r,...e})=>f.jsx(Ie,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",fontSize:"lg",fontWeight:"semibold",...e,children:r}),FCe=({children:r,...e})=>f.jsx(Cc,{fontSize:"sm",bg:"transparent",color:"gray.600",...e,children:r});tr.Label=LCe;tr.Code=FCe;const m9=({children:r,...e})=>f.jsx(ke,{w:"full",p:"2",bg:"white",borderWidth:"1px",borderStyle:"dashed",borderRadius:"md",...e,children:r}),U2=/\{\{(.+?)\}\}/,OCe=({id:r,meta:e})=>{var de,le,Me,Re,Oe;const t=Ut(),i=Ti(Io),{pageName:n,appName:s}=Ze(nr),{widget:o}=e||{},{widgets:a,isLoading:c,properties:d,files:l}=pi({appName:s,pageName:n}),u=(le=(de=a.find(Ge=>Ge.name===o))==null?void 0:de.components)==null?void 0:le.find(Ge=>Ge.name===r);console.log("component",u);const{fields:h}=Cb(),g=[...new Set(((Me=h==null?void 0:h[u==null?void 0:u.component_type])==null?void 0:Me.map(Ge=>Ge==null?void 0:Ge.category).filter(Boolean))||[])],m=(Re=l.filter(Ge=>Ge.type==="ui"))==null?void 0:Re.map(Ge=>Ge==null?void 0:Ge.name),y=Oa(),{formState:{isDirty:_},reset:b,watch:E,setValue:D,clearErrors:R,setError:M}=y,O=E("data_type"),L=E("component_type"),W=E("multiple"),Z=E("options"),K=E("default"),H=E("multiline"),C=E("stateInDefault");z.useEffect(()=>{W?Array.isArray(K)||D("default",C?K:[K],{shouldDirty:!1}):Array.isArray(K)&&D("default","",{shouldDirty:!1})},[D,C,K,W]);const B=Vr({onSuccess:()=>{t({status:"success",title:"Updated component properties"})},onError:Ge=>{t({status:"error",title:"Failed to update component properties",description:ni(Ge)})}}),te=Vr({onSuccess:()=>{i({id:null,type:null,meta:null})},onError:Ge=>{t({status:"error",title:"Failed to delete component",description:ni(Ge)})}});z.useEffect(()=>{b({...u,stateInDefault:U2.test(u==null?void 0:u.default)},{keepDirty:!1,keepDirtyValues:!1})},[u,b]);const ue=({stateInDefault:Ge,...xe})=>{if(Ge&&!U2.test(xe.default)){M("default",{message:"Invalid state value, please make sure you use template like {{state.table1.id}}"});return}B.mutate({app_name:s,page_name:n,properties:{...d||{},blocks:[...((d==null?void 0:d.blocks)||[]).map(Kt=>Kt.name===o?{...Kt,components:(Kt.components||[]).map(je=>je.name===r?{...je,...xe}:je)}:Kt)]}})},be=async Ge=>{try{await B.mutate({app_name:s,page_name:n,properties:{...d||{},blocks:[...((d==null?void 0:d.blocks)||[]).map(xe=>xe.name===o?{...xe,components:(xe.components||[]).map(Kt=>Kt.name===r?{...Kt,name:Ge}:Kt)}:xe)]}}),i({id:Ge,type:"component",meta:{widget:o}})}catch{}};return c?f.jsxs(q,{bg:"white",h:"full",children:[f.jsx(QW,{isLoading:!0}),f.jsxs(q,{borderBottomWidth:"1px",p:"5",children:[f.jsx(hi,{startColor:"gray.100",endColor:"gray.200",h:8}),f.jsx(hi,{startColor:"gray.100",endColor:"gray.200",h:8}),f.jsx(hi,{startColor:"gray.100",endColor:"gray.200",h:8})]})]}):f.jsx(q,{h:"full",overflowY:"auto",w:"full",bg:"white",children:f.jsx("form",{onSubmit:y.handleSubmit(ue),children:f.jsxs(Pd,{...y,children:[f.jsxs(q,{py:"2",px:"4",borderBottomWidth:"1px",flex:"1",alignItems:"center",direction:"row",children:[f.jsxs(q,{direction:"row",alignItems:"center",children:[f.jsx(tr,{children:f.jsx(tr.Code,{children:r})}),f.jsx(YW,{value:r,currentNames:(((Oe=d==null?void 0:d.blocks.find(Ge=>Ge.name===(o||"")))==null?void 0:Oe.components)||[]).map(Ge=>Ge.name),onUpdate:be,resource:"component"})]}),f.jsxs(vr,{ml:"auto",size:"xs",children:[_?f.jsx(St,{"aria-label":"Update component",isLoading:B.isLoading,type:"submit","data-cy":"update-component",onClick:Ge=>{Ge.stopPropagation()},icon:f.jsx(Hf,{size:"14"})}):null,f.jsx(St,{"aria-label":"Delete component",variant:"ghost",colorScheme:"red",isLoading:te.isLoading,onClick:Ge=>{Ge.stopPropagation(),te.mutate({app_name:s,page_name:n,properties:{...d||{},blocks:(d.blocks||[]).map(xe=>xe.name===o?{...xe,components:xe==null?void 0:xe.components.filter(Kt=>(Kt==null?void 0:Kt.name)!==(u==null?void 0:u.name))}:xe)}})},icon:f.jsx(Fa,{size:"14"})})]})]}),f.jsx(q,{spacing:"0",divider:f.jsx(_1,{}),children:g.map(Ge=>f.jsxs(q,{spacing:"3",p:"3",children:[Ge.toLowerCase()==="default"?null:f.jsx(Ie,{fontSize:"md",fontWeight:"semibold",children:Ge}),f.jsx(q,{children:h[u==null?void 0:u.component_type].filter(xe=>xe.category===Ge).map(xe=>{if((xe==null?void 0:xe.name)==="name")return null;if(xe.name==="default"){let je=O;return L==="select"&&(je="select",W&&(je="multiselect")),O==="text"&&H&&(je="textarea"),f.jsxs(q,{children:[f.jsx(Zi,{...xe,id:xe.name,name:xe.title,type:C?"template":je,options:Z}),f.jsx(Zi,{id:"stateInDefault",name:"Use state in default value",type:"boolean",onChange:et=>{D("stateInDefault",et),D("default",null),R("default")}})]})}if(xe.name==="display_rules"||xe.type==="rules")return f.jsx(MCe,{widgetName:o,name:u.name});if(xe.name==="on_click"||xe.name==="on_change"||xe.name==="on_toggle")return f.jsx(XW,{id:xe.name});if((xe.name==="fetcher"||xe.name==="name_column"||xe.name==="value_column")&&!(u!=null&&u.use_fetcher))return null;const Kt=xe.type==="function";return z.createElement(Zi,{...xe,id:xe.name,name:xe.title,type:Kt?"select":xe.type==="string"&&"markdown"||xe.type,options:((Kt?m:xe.enum||xe.options)||[]).map(je=>({name:je,value:je})),key:xe.name})})})]}))})]})})})},NCe=({widgetName:r,...e})=>{const t=Ut(),{isConnected:i}=Bd(),{appName:n,pageName:s}=Ze(nr),{properties:o}=pi({appName:n,pageName:s}),a=Ti(Io),c=Vr({onSuccess:()=>{t({status:"success",title:"Component added"})},onError:l=>{t({status:"error",title:"Failed to create component",description:ni(l)})}}),d=async({type:l})=>{var y,_;const u=(((_=(y=o==null?void 0:o.blocks)==null?void 0:y.find(b=>b.name===r))==null?void 0:_.components)||[]).filter(b=>b.component_type===l).map(b=>b.name),{name:h,label:g}=Bf({currentNames:u,prefix:l});let m={label:g};l==="input"&&(m={type:"text",label:g}),l==="text"&&(m={text:h}),l==="select"&&(m={data_type:"string",use_fetcher:!1,label:g});try{await c.mutateAsync({app_name:n,page_name:s,properties:{...o||{},blocks:[...((o==null?void 0:o.blocks)||[]).map(b=>b.name===r?{...b,components:[...b.components||[],{name:h,component_type:l,...m}]}:b)]}}),a({id:h,type:"component",meta:{widget:r}})}catch{}};return f.jsx(m9,{children:f.jsxs(sf,{children:[f.jsx(of,{as:Qe,variant:"ghost",size:"sm",flexShrink:"0",mr:"auto","data-cy":"add-component-button",isDisabled:!i,isLoading:c.isLoading,...e,children:f.jsxs(q,{alignItems:"center",justifyContent:"center",direction:"row",children:[f.jsx(Xs,{size:"14"}),f.jsx(ke,{children:"Add Component"})]})}),f.jsx(af,{children:["input","text","select","button","boolean"].map(l=>f.jsx(Nl,{onClick:()=>{d({type:l})},fontSize:"md",children:l},l))})]})})},$Ce=({text:r})=>f.jsx(lZ,{remarkPlugins:[uZ,hZ],components:{h1:e=>f.jsx(np,{as:"h1",size:"2xl",...e}),h2:e=>f.jsx(np,{as:"h2",size:"xl",...e}),h3:e=>f.jsx(np,{as:"h3",size:"lg",...e}),h4:e=>f.jsx(np,{as:"h4",size:"md",...e}),h5:e=>f.jsx(np,{as:"h5",size:"sm",...e}),h6:e=>f.jsx(np,{as:"h6",size:"xs",...e}),a:e=>f.jsx("a",{style:{color:"#007bff",textDecoration:"underline"},...e,children:e.children}),em:e=>f.jsx("i",{style:{fontWeight:"bold"},...e}),table:e=>f.jsx(cf,{variant:"simple",...e}),thead:e=>f.jsx(df,{...e}),tbody:e=>f.jsx(lf,{...e}),tr:e=>f.jsx(_o,{...e}),th:e=>f.jsx(xr,{borderWidth:"1px",...e}),td:e=>f.jsx(Wn,{borderWidth:"1px",...e})},children:r}),WCe=["label","text","placeholder","default"],HCe=r=>{var le,Me,Re;const{sendJsonMessage:e,widgetName:t,inline:i}=r,n=Ut(),[{pageName:s,appName:o}]=Ji(nr),a=g9({}),{component_type:c,data_type:d,name:l,display_rules:u,color:h,on_click:g,...m}=r,y=Ze(Ba),_=Ze(vu),b=z.useMemo(()=>{var Oe;return((Oe=_[t||""])==null?void 0:Oe.components)||{}},[_,t]),E=z.useMemo(()=>(b==null?void 0:b[l])||{},[b,l]),[D,R]=Ji(ov),M=(le=D==null?void 0:D[t||""])==null?void 0:le[l],O=UW(),{isPreview:L}=Ze(Zo),W=!L,Z=((Me=b==null?void 0:b[l])==null?void 0:Me.visible)||((Re=b==null?void 0:b[l])==null?void 0:Re.visible)===null,K=!Z&&W,{label:H,text:C,placeholder:B,default:te}=WCe.reduce((Oe,Ge)=>({...Oe,[Ge]:OC(m==null?void 0:m[Ge],y)}),{}),ue=z.useCallback((Oe,Ge)=>{if(t){let xe={};return R(Kt=>(xe={...Kt,[t]:{...Kt[t]||{},[Oe]:Ge}},xe)),xe}return{}},[t,R]);z.useEffect(()=>{if(te!=null&&l){const Oe=setTimeout(()=>{ue(l,te),clearTimeout(Oe)},100)}},[te,l,ue,R]);const be=p9({onSuccess:Oe=>{O(Oe)},onError:Oe=>{n({status:"error",title:"Failed to execute action",description:ni(Oe)})}});if(!Z&&!W)return null;if(c==="button")return f.jsxs(q,{spacing:"0.5",w:"fit-content",children:[f.jsx(Qe,{my:"1.5",size:"sm",isLoading:be.isLoading,bgColor:K?"gray.100":"",colorScheme:h||"blue",onClick:()=>{g&&a(g),e({type:"display_rule",state_context:y,app_name:o,page_name:s})},children:H}),L?null:f.jsx(tr.Code,{children:l})]});if(c==="text")return f.jsxs(q,{spacing:"0.5",bgColor:K?"gray.100":"",children:[f.jsx($Ce,{text:C}),L?null:f.jsx(tr.Code,{children:l})]});let de=d;return c==="select"&&(de="select",m!=null&&m.multiple&&(de="multiselect")),c==="boolean"&&(de="boolean"),de==="text"&&(m!=null&&m.multiline)&&(de="textarea"),f.jsxs(q,{spacing:"0.5",children:[z.createElement(tn,{...i?{as:q,direction:"row",alignItems:"center",spacing:"0"}:{},key:l,bgColor:K?"gray.100":""},H?f.jsx(ir,{lineHeight:1,children:H}):null,f.jsx(os,{placeholder:B,value:M,name:l,"data-cy":`input-${l}`,type:de,onKeyDown:Oe=>{Oe.key==="Enter"&&(m!=null&&m.on_submit)&&a(m.on_submit)},onChange:Oe=>{const Ge=ue(l,Oe);m.on_change&&a(m.on_change),m.on_toggle&&a(m.on_toggle),e({type:"display_rule",state_context:{...y,state:Ge},app_name:o,page_name:s})},options:(E==null?void 0:E.options)||(m==null?void 0:m.options)}),E!=null&&E.message?f.jsx("div",{children:f.jsxs(jG,{bgColor:"transparent",status:(E==null?void 0:E.message_type)||"info",pl:0,pt:1,children:[f.jsx(BG,{boxSize:4,mr:2}),f.jsx(UG,{fontSize:"sm",children:E==null?void 0:E.message})]})}):null),L||i?null:f.jsx(tr.Code,{children:l})]})},gP={success:Uy,warn:fZ,error:wP},pp={success:"green",warn:"yellow",error:"red"},JW=({message:r,type:e,onClose:t})=>{if(!r)return null;const i=`${(pp==null?void 0:pp[e])||"blue"}.500`;return f.jsxs(q,{p:2.5,flexShrink:"0",pos:"absolute",mt:"auto",borderWidth:"1px",shadow:"sm",bg:"gray.50",zIndex:"popover",bottom:"0",right:"10px",maxW:"sm",mx:"auto",w:"calc(100% - 20px)",mb:"10px",flexGrow:"0",borderRadius:"md",children:[f.jsxs(q,{spacing:1,direction:"row",alignItems:"center",children:[f.jsx(Wf,{boxSize:7,"aria-label":"Delete function",as:(gP==null?void 0:gP[e])||Kw,p:1,color:i}),f.jsx(Ie,{fontSize:"md",children:r})]}),f.jsx(sh,{cursor:"pointer",position:"absolute",size:7,right:2,alignItems:"center",alignSelf:"start",justifySelf:"start","aria-label":"Close alert",_hover:{bg:`${(pp==null?void 0:pp[e])||"blue"}.50`},color:i,onClick:t,children:f.jsx(ik,{size:"14"})})]})},jCe=({widgetName:r,...e})=>{const t=Ut(),{isOpen:i,onToggle:n,onClose:s}=Ki({}),[o,a]=z.useState(null),[c,d]=z.useState(!1),{appName:l,pageName:u}=Ze(nr),{properties:h,tables:g}=pi({appName:l,pageName:u}),m=Vr({onSuccess:()=>{t({status:"success",title:"Component added"}),s(),a(null),d(!1)},onError:_=>{t({status:"error",title:"Failed to create component",description:ni(_)})}}),y=async()=>{var _;try{const b=g.find(D=>D.name===o),E=(_=b==null?void 0:b.columns)==null?void 0:_.map(D=>{var O,L;let R=D.display_type;const M={label:D.name,name:D.name,data_type:"integer",placeholder:null,default:c?`{{state.${b.name}.${D.name}}}`:null,multiline:!1,display_rules:null,component_type:"input"};switch(D.display_type){case"currency":{R="float";break}case"boolean":return{...M,data_type:"boolean",component_type:"boolean"};case"array":return{...M,data_type:"text"};case"select":return{...M,data_type:"string",use_fetcher:!1,options:((O=D==null?void 0:D.configurations)==null?void 0:O.options)||[],multiple:(L=D==null?void 0:D.configurations)==null?void 0:L.multiple,fetcher:"",name_column:"",value_column:"",on_change:null,display_rules:null,component_type:"select"};default:}return{...M,data_type:R}});await m.mutateAsync({app_name:l,page_name:u,properties:{...h||{},blocks:[...((h==null?void 0:h.blocks)||[]).map(D=>D.name===r?{...D,components:[...D.components||[],...E]}:D)]}})}catch{}};return f.jsx(m9,{children:f.jsxs(Ir,{isOpen:i,onClose:s,children:[f.jsx(Rr,{children:f.jsx(Qe,{onClick:n,colorScheme:"gray",w:"full",variant:"secondary",size:"sm",isLoading:m.isLoading,leftIcon:f.jsx(w1,{size:"14"}),...e,children:"Mirror Components from Table Row"})}),f.jsxs(jr,{zIndex:"popover",children:[f.jsx(xo,{pt:4,fontWeight:"bold",fontSize:"md",border:"0",children:"Mirror components for table"}),f.jsx(Br,{children:f.jsxs(q,{children:[f.jsxs(tn,{children:[f.jsx(ir,{children:"Select Table"}),f.jsx(os,{type:"select",options:g.map(_=>({name:_.label,value:_.name})),validation:{required:"Cannot  be empty"},name:"Select Table",id:"table",onChange:a,value:o})]}),f.jsxs(tn,{children:[f.jsx(ir,{children:"Use default value"}),f.jsx(os,{type:"boolean",name:"Use default value",id:"hasDefault",value:c,onChange:d})]})]})}),f.jsx(cs,{display:"flex",children:f.jsxs(vr,{ml:"auto",size:"sm",children:[f.jsx(Qe,{onClick:s,colorScheme:"red",variant:"outline",children:"Cancel"}),f.jsx(Qe,{onClick:y,isDisabled:!o,colorScheme:"blue",type:"submit",isLoading:m.isLoading,children:"Create"})]})})]})]})})},v9=({widgetName:r,inline:e=!1})=>{const{appName:t,pageName:i}=Ri(),n=z.useRef(0),s=z.useRef(null),[{widgets:o,modals:a},c]=Ji(nr),{isPreview:d}=Ze(Zo),l=Ti(x1),u=!d,h=o==null?void 0:o.find(le=>le.name===r),g=(h==null?void 0:h.type)==="modal",{isLoading:m,components:y}=n9(r||""),[_,b]=z.useState(y),E=Vr(),D=Ti(vu),[R,M]=Ji(vu),{properties:O}=pi({appName:t,pageName:i}),L=HW(),{sendJsonMessage:W}=b1(L,{onOpen:()=>{l(!0),W({type:"auth",access_token:localStorage.getItem("worker_access_token")})},onMessage:async le=>{try{const Me=JSON.parse(le==null?void 0:le.data);if((Me==null?void 0:Me.type)==="auth_error"&&n.current<3){const Oe=localStorage.getItem("access_token");W({type:"auth",access_token:Oe}),n.current+=1,s.current=Me==null?void 0:Me.failed_data}(Me==null?void 0:Me.authenticated)===!0&&s.current&&(W(s.current),s.current=null);const Re=Me==null?void 0:Me.context;if(!Re)return;D(Re)}catch{}},onClose:()=>{l(!1)},share:!0}),Z=fCe(),K=R[r||""],H=()=>{M(le=>({...Lg(le,`${r}.message`,null),...Lg(le,`${r}.message_type`,null)}))},C=le=>{var Re;const Me={...O||{},blocks:(Re=O.blocks||[])==null?void 0:Re.map(Oe=>Oe.name!==r?Oe:{...Oe,components:le})};E.mutate({app_name:t,page_name:i,properties:Me})},B=le=>{const{destination:Me,source:Re}=le;if(!Me||Me.droppableId===Re.droppableId&&Me.index===Re.index)return;const Oe=Array.from(_),Ge=Oe.splice(Re.index,1);Oe.splice(Me.index,0,Ge[0]),b(Oe),C(Oe)};z.useEffect(()=>{b(y)},[y]);const te=()=>{c(le=>{const Me=le.modals.find(Re=>Re.name===r);return{...le,widgetName:Me.caller,modals:le.modals.filter(Re=>Re.name!==r)}})},ue=g?a.findIndex(le=>le.name===r):-1,be=g&&a.map(le=>le.name).includes(r),de=be?{width:"calc(100% - 20px)",mx:"auto",height:"calc(100% - 20px)",shadow:"xl",borderRadius:"md",borderWidth:"1px",pt:3,top:"10px",left:"10px",zIndex:3+ue}:{h:"full"};return f.jsxs(Al,{isLoading:m,children:[be?f.jsx(ke,{w:"full",h:"full",position:"fixed",bg:"blackAlpha.100",top:"0",left:"0",zIndex:2,onClick:te}):null,f.jsxs(q,{position:be?"absolute":"initial",...de,bg:"white",children:[be?f.jsx(pZ,{bg:"white",borderWidth:"1px",position:"absolute",top:"-3",right:"-3",size:"xs",onClick:te}):null,f.jsx(gZ,{onDragEnd:B,children:f.jsx(mZ,{droppableId:`widget-${r}-drop-area`,children:le=>f.jsxs(q,{ref:le.innerRef,h:"full",...e?{direction:"row",flexWrap:"wrap",alignItems:"center",spacing:5,w:"full"}:{p:4,pt:2,spacing:3,overflow:"auto"},"data-cy":"components-list",...le.droppableProps,children:[_.map((Me,Re)=>f.jsx(vZ,{draggableId:Me.name,index:Re,children:Oe=>f.jsx(eH,{ref:Oe.innerRef,id:Me.name,type:"component","data-cy":`component-${Me.name}-inspector`,meta:{widget:r},...Oe.draggableProps,...Oe.dragHandleProps,children:f.jsx(HCe,{inline:e,widgetName:r,sendJsonMessage:W,...Me},Me.name)},Me.name)},Me.name)),le.placeholder,u&&!e?f.jsxs(q,{mt:"2",children:[f.jsx(NCe,{widgetName:r,w:"full",variant:"secondary"}),f.jsx(jCe,{widgetName:r})]}):null]})})}),f.jsx(JW,{message:K==null?void 0:K.message,type:K==null?void 0:K.message_type,onClose:H}),Z.isLoading&&f.jsx(_u,{mt:"auto",size:"xs",isIndeterminate:!0})]})]})},y9=()=>{var R;const{appName:r,pageName:e}=Ri(),{isConnected:t}=Bd(),{widgetName:i,widgets:n,modals:s}=Ze(nr),o=Ze(Ba),[a,c]=Ji(vu),d=a==null?void 0:a.page,l=(R=n==null?void 0:n.find(M=>M.name===i))==null?void 0:R.label,{isPreview:u}=Ze(Zo),h=!u,{isLoading:g,description:m}=n9(i||"");qSe({appName:r,pageName:e});const{properties:y}=pi({appName:r,pageName:e}),_=qW(),b=()=>{c(M=>({...Lg(M,"page.message",null),...Lg(M,"page.message_type",null)}))},E=()=>{const{name:M,label:O}=Bf({currentNames:n==null?void 0:n.map(L=>L.name),prefix:"widget"});_.mutate({app_name:r,page_name:e,properties:{...y||{},blocks:[...(y==null?void 0:y.blocks)||[],{name:M,label:O,type:"base",block_type:"widget",menu_item:!0,components:[]}]}})};if(!i)return h?f.jsxs(q,{p:6,bg:"white",h:"full",children:[f.jsxs(q,{borderWidth:"1px",borderRadius:"sm",px:4,pt:4,pb:24,bg:"gray.50",children:[f.jsx(hi,{bg:"gray.100",borderRadius:"sm",h:8,speed:0}),f.jsx(ke,{h:8,bg:"white",borderWidth:"1px"}),f.jsxs(q,{direction:"row",justifyContent:"space-between",h:8,bg:"white",p:"2",alignItems:"center",borderWidth:"1px",children:[f.jsx(hi,{startColor:"gray.100",flex:"1",endColor:"gray.100",h:"full"}),f.jsx(Ag,{size:"14"})]}),f.jsx(ke,{h:8,maxW:"fit-content",p:"2",bg:"blue.500",borderWidth:"1px",children:f.jsx(hi,{w:"24",borderRadius:"sm",h:"full",startColor:"gray.50",flex:"1",endColor:"gray.50"})})]}),f.jsxs(q,{mt:"6",children:[f.jsx(Ie,{fontWeight:"medium",fontSize:"md",children:"Extend your Smart Table with Widgets and Functions"}),f.jsx(Qe,{w:"fit-content",colorScheme:"blue",size:"sm","data-cy":"build-widget",isLoading:_.isLoading,isDisabled:!t,onClick:E,children:"Build Widget"})]})]}):null;const D=[...new Set([i,...s.map(M=>M.name)])].filter(Boolean);return f.jsx(Al,{isLoading:g,children:f.jsxs(q,{id:"preview-container",position:"relative",bg:"white",h:"full",children:[f.jsxs(q,{alignItems:"center",px:"4",pt:"2",pb:"3",borderBottomWidth:"1px",direction:"row",children:[f.jsx(eH,{flex:"1",type:"widget",id:i,children:f.jsxs(q,{overflow:"hidden",spacing:"0",children:[f.jsx(q,{direction:"row",display:"flex",alignItems:"center",children:f.jsxs(tr,{children:[f.jsx(tr.Label,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:OC(l||i,o)}),!u&&f.jsx(tr.Code,{children:i})]})}),m?f.jsx(Ie,{fontSize:"sm",color:"gray.600",children:OC(m,o)}):null]})}),f.jsx(DCe,{}),f.jsx(kCe,{})]}),f.jsxs(q,{overflowX:"hidden",h:"full",children:[D.map(M=>f.jsx(v9,{widgetName:M},M)),f.jsx(JW,{message:d==null?void 0:d.message,type:d==null?void 0:d.message_type,onClose:b})]})]})})};const Ou=20,Wv=6,BCe={...yZ,draw:(r,e)=>{const{ctx:t,theme:i,rect:n}=r,{value:s}=e.data,o=e.data.allowedValues.find(c=>typeof c=="string"||c===null||c===void 0?c===s:c.value===s),a=typeof o=="string"?o:(o==null?void 0:o.label)??"";if(a){const c={x:n.x+i.cellHorizontalPadding,y:n.y+i.cellVerticalPadding,width:n.width-2*i.cellHorizontalPadding,height:n.height-2*i.cellVerticalPadding},d=Math.max(1,Math.floor(c.height/(Ou+Wv)));let{x:l}=c,u=1,h=d===1?c.y+(c.height-Ou)/2:c.y+(c.height-d*Ou-(d-1)*Wv)/2;const g=o,m=(g==null?void 0:g.color)??i.bgBubble,_=_Z(a,t).width+Wv*2,b=Ou/2;l!==c.x&&l+_>c.x+c.width&&u<d&&(u++,h+=Ou+Wv,l=c.x),t.fillStyle=m,t.beginPath(),wZ(t,l,h,_,Ou,i.roundingRadius??Ou/2),t.fill(),t.fillStyle=g!=null&&g.color?bZ(m)>.5?"#000000":"#ffffff":i.textBubble,t.fillText(a,l+Wv,h+b+SZ(t,i))}return!0}},gp=[{name:"Equal",value:"="},{name:"Is not Equal",value:"!="},{name:"Is empty",value:"is null"},{name:"Not empty",value:"is not null"}],UCe=[{name:"Greater than",value:">"},{name:"Less than",value:"<"},{name:"Greater than or equal to",value:">="},{name:"Less than or equal to",value:"<="}],V2=[{name:"Contains",value:"like"}],VCe=r=>{if(r){if(r.startsWith("VARCHAR"))return[...V2,...gp];switch(r){case"float":case"integer":return[...gp,...UCe];case"datetime":case"time":case"date":return[...gp,{name:"After",value:">"},{name:"Before",value:"<"}];case"text":return[...V2,...gp];default:return gp}}return gp},qCe=()=>{const r=Ut(),e=cv(),{isOpen:t,onToggle:i,onClose:n}=Ki(),s=z.useRef(!1),{appName:o,pageName:a}=Ri(),{isPreview:c}=Ze(Zo),{properties:d}=pi({appName:o,pageName:a}),{columnDict:l}=Jf(e),{smart:u}=Co(e),[h,g]=Ji(zW),m=h[e]||[],y=Vr({onSuccess:()=>{r({status:"success",title:"Pinned filters updated"})},onError:()=>{r({status:"error",title:"Failed to update pinned filters"})}}),{filters:_}=Co(e||"");z.useEffect(()=>{s.current||(g(O=>({...O,[e]:_})),s.current=!0)},[e,_,g]);const b=m.length>0&&m.every(O=>O.column_name&&O.value),E=()=>{g(O=>({...O,[e]:[...m,{column_name:"",value:null,condition:"=",id:crypto.randomUUID()}]}))},D=()=>{g(O=>({...O,[e]:[]}))},R=O=>{g(L=>({...L,[e]:O})),c||y.mutate({app_name:o,page_name:a,properties:{...d||{},blocks:[...((d==null?void 0:d.blocks)||[]).map(L=>L.name===e?{...L,filters:O.filter(W=>W.pinned).map(W=>({column_name:W.column_name,condition:W.condition}))}:L)]}})},M=O=>{R(m.filter(L=>L.id!==O))};return f.jsxs(Ir,{isOpen:t,onClose:n,placement:"bottom",closeOnBlur:!0,children:[f.jsx(Rr,{children:f.jsx(Qe,{leftIcon:f.jsx(CZ,{size:12}),size:"xs",isDisabled:!u,variant:"ghost",onClick:i,colorScheme:b?"blue":"gray",children:f.jsx(Ie,{fontWeight:"medium",fontSize:"sm",children:"Filters"})})}),f.jsxs(jr,{boxShadow:"md",minW:"35rem",children:[f.jsx(xo,{pt:4,fontWeight:"bold",border:"0",fontSize:"md",children:"Filter Data"}),f.jsx(xs,{}),f.jsx(Na,{mt:2,onClick:n}),f.jsx(Br,{children:m.length===0?f.jsx(Ie,{color:"gray",fontSize:"md",children:"No filters applied"}):f.jsx(nu,{alignItems:"start",w:"full",children:m.map((O,L)=>{var K;const W=(K=l[O==null?void 0:O.column_name])==null?void 0:K.display_type;let Z="text";return W==="integer"&&(Z="number"),f.jsxs(If,{w:"full",children:[c?null:f.jsx(St,{"aria-label":"Pin filter",icon:f.jsx(EZ,{size:"14"}),size:"sm",colorScheme:"yellow",isDisabled:!O.column_name,variant:O.pinned?"solid":"outline",onClick:()=>{const H=m.map((C,B)=>B===L?{...C,pinned:!C.pinned}:C);R(H)}}),f.jsx(tn,{flexGrow:"1",children:f.jsx(iu,{value:O.column_name,onChange:H=>{const C=m.map((B,te)=>te===L?{...B,column_name:H.target.value}:B);g(B=>({...B,[e]:C})),O!=null&&O.pinned&&R(C)},size:"sm",bg:"bg-canvas",placeholder:"Select column",children:Object.keys(l).map(H=>f.jsx("option",{value:H,children:H},H))})}),f.jsx(tn,{flexGrow:"1",children:f.jsx(iu,{colorScheme:"blue",value:O.condition,onChange:H=>{const C=m.map((B,te)=>te===L?{...B,condition:H.target.value}:B);g(B=>({...B,[e]:C})),O!=null&&O.pinned&&R(C)},bg:"bg-canvas",size:"sm",placeholder:"Select condition",children:VCe(W).map(H=>f.jsx("option",{value:H.value,children:H.name},H.value))})}),f.jsx(tn,{flexGrow:"1",children:f.jsx(as,{type:Z,colorScheme:"blue",value:O.value,onChange:H=>{g(C=>({...C,[e]:m.map((B,te)=>{if(te===L){const ue=H.target.value===""?null:+H.target.value;return{...B,value:Z==="number"?ue:H.target.value}}return B})}))},isDisabled:O.condition==="is null"||O.condition==="is not null",borderRadius:"sm",bg:"bg-canvas",size:"sm",placeholder:"Enter value"})}),f.jsx(St,{"aria-label":"Delete filter",icon:f.jsx(Fa,{size:"14"}),size:"sm",colorScheme:"red",variant:"outline",onClick:()=>{M(O.id)}})]},`filter-${L}`)})})}),f.jsx(cs,{border:"0",display:"flex",alignItems:"center",pb:4,children:f.jsxs(vr,{size:"sm",children:[f.jsx(Qe,{colorScheme:"gray",onClick:D,children:"Reset all"}),f.jsx(Qe,{leftIcon:f.jsx(Xs,{size:12}),colorScheme:"blue",onClick:E,children:"Add Filter"})]})})]})]})},GCe=()=>{const{isOpen:r,onToggle:e,onClose:t}=Ki(),i=cv(),{columns:n}=Jf(i),[s,o]=Ji(l9),a=s[i]||[],{smart:c}=Co(i),d=a.length>0&&a.every(m=>m.column_name),l=m=>{o(y=>({...y,[i]:m}))},u=()=>{l([...a,{column_name:"",value:"asc"}])},h=()=>{l([])},g=m=>{l(a.filter((y,_)=>_!==m))};return f.jsxs(Ir,{isOpen:r,onClose:t,placement:"bottom",closeOnBlur:!0,children:[f.jsx(Rr,{children:f.jsx(Qe,{leftIcon:f.jsx(xZ,{size:12}),size:"xs",onClick:e,variant:"ghost",isDisabled:!c,colorScheme:d?"blue":"gray",children:f.jsx(Ie,{fontWeight:"medium",fontSize:"sm",children:"Sorts"})})}),f.jsxs(jr,{boxShadow:"md",minW:"35rem",children:[f.jsx(xo,{pt:4,fontWeight:"bold",border:"0",fontSize:"md",children:"Sort Data"}),f.jsx(xs,{}),f.jsx(Na,{mt:2,onClick:t}),f.jsx(Br,{children:a.length===0?f.jsx(Ie,{color:"gray",fontSize:"md",children:"No sorts applied"}):f.jsx(nu,{alignItems:"start",w:"full",children:a.map((m,y)=>f.jsxs(If,{w:"full",children:[f.jsx(tn,{flexGrow:"1",children:f.jsx(iu,{value:m.column_name,onChange:_=>{l(a.map((b,E)=>E===y?{...b,column_name:_.target.value}:b))},size:"sm",bg:"bg-canvas",placeholder:"Select column",children:n.map(_=>f.jsx("option",{value:_.name,children:_.name},_.name))})}),f.jsx(tn,{flexGrow:"1",children:f.jsxs(iu,{colorScheme:"blue",value:m.value,onChange:_=>{l(a.map((b,E)=>E===y?{...b,value:_.target.value}:b))},bg:"bg-canvas",size:"sm",placeholder:"Select Sort",children:[f.jsx("option",{value:"asc",children:"Ascending"}),f.jsx("option",{value:"desc",children:"Descending"})]})}),f.jsx(St,{"aria-label":"Delete sort",icon:f.jsx(Fa,{size:"14"}),size:"sm",colorScheme:"red",variant:"outline",onClick:()=>{g(y)}})]},`sort-${y}`))})}),f.jsx(cs,{border:"0",display:"flex",alignItems:"center",pb:4,children:f.jsxs(vr,{size:"sm",children:[f.jsx(Qe,{colorScheme:"gray",onClick:h,children:"Reset all"}),f.jsx(Qe,{leftIcon:f.jsx(Xs,{size:12}),colorScheme:"blue",onClick:u,children:"Add Sort"})]})})]})]})},zCe=()=>{const[r,e]=Ji(zW),t=cv(),i=(r==null?void 0:r[t])||[],{columns:n}=Jf(t),s=i.filter(o=>o.pinned);return s.length===0?null:f.jsx(q,{direction:"row",borderRadius:"sm",px:"2",spacing:"2",flex:"1",overflow:"auto",w:"full",children:s.map(o=>{var d;const a=(d=n==null?void 0:n[o==null?void 0:o.column_name])==null?void 0:d.display_type;let c="text";return a==="integer"&&(c="number"),f.jsxs(dn,{fontSize:"sm",borderRadius:"sm",justify:"center",alignItems:"center",children:[f.jsx(Ie,{ml:"3",mr:"1",fontSize:"sm",fontWeight:"medium",children:o.column_name}),f.jsx(Ie,{mr:"2",fontSize:"sm",fontWeight:"normal",children:o.condition}),f.jsx(as,{type:c,colorScheme:"blue",value:o.value,size:"sm",borderWidth:"1px",onChange:l=>{e(u=>({...u,[t]:i.map(h=>{if(h.id===o.id){const g=l.target.value===""?null:+l.target.value;return{...o,value:c==="number"?g:l.target.value}}return h})}))},borderRadius:"sm",h:"2.2em",placeholder:"Enter value"})]},o.id)})})},_9=r=>{const e=Ut(),{isOpen:t,onOpen:i,onClose:n}=Ki(),{table:s}=Co(r||""),o=z.useRef();o.current=s;const{appName:a,pageName:c}=Ri(),d=Ze(Ba),l=z.useRef(d);l.current=d;const u=s9({onSuccess:()=>{e({status:"success",title:"SmartTable converted"})},onError:m=>{e({status:"error",title:"Failed to convert table",description:ni(m)})},table:s==null?void 0:s.name}),h=z.useCallback(()=>{var m;u.mutate({table:o.current,state:(m=l==null?void 0:l.current)==null?void 0:m.state,appName:a,pageName:c})},[u,a,c]),g=z.useCallback(()=>f.jsxs(jr,{zIndex:"popover",mt:"-2",children:[f.jsx(xo,{fontWeight:"semibold",fontSize:"md",children:"Convert to Smart Table"}),f.jsx(Na,{size:"xs"}),f.jsx(Br,{fontSize:"sm",children:"Convert to smart table to enable filter, sorts and editing cells"}),f.jsx(cs,{display:"flex",justifyContent:"flex-end",children:f.jsx(vr,{size:"sm",children:f.jsx(Qe,{isLoading:u.isLoading,onClick:h,colorScheme:"gray",variant:"outline",leftIcon:f.jsx(VG,{size:"14"}),children:"Convert to Smart Table"})})})]}),[h,u.isLoading]);return z.useMemo(()=>({renderPopoverContent:g,isOpen:t,onOpen:i,onClose:n}),[g,t,i,n])},KCe=()=>{const r=Ut(),e=cv(),{onOpen:t,onClose:i,isOpen:n,renderPopoverContent:s}=_9(e),{isPreview:o}=Ze(Zo),{widget:a,fetcher:c,type:d,smart:l}=Co(e||""),u=DZ({mutationKey:`${r9}-${e}`}),{appName:h,pageName:g}=Ri(),{files:m}=pi({appName:h,pageName:g}),y=m.find(L=>L.name===c),{rows:_,columns:b}=Jf(e),[E,D]=Ji(d9),R=E[e]||[],M=SCe({onSuccess:()=>{r({status:"success",title:"Cell edits saved"}),D(L=>({...L,[e]:[]}))},onError:L=>{r({status:"error",title:"Failed to save edits",description:ni(L)})}}),O=()=>{d==="sql"&&M.mutate({file:y,edits:R.map(L=>({row:_[L.rowIndex],column_name:L.column_name,columns:b.filter(W=>(W==null?void 0:W.column_type)!=="button_column"),data_type:L.data_type,old_value:L.old_value,new_value:L.new_value}))})};return a?f.jsx(q,{bg:"white",borderWidth:"1px",borderBottom:"0",borderTopLeftRadius:"md",borderTopRightRadius:"md",direction:"row",flexWrap:"wrap",alignItems:"center",p:"2",w:"full",justifyContent:"space-between",children:f.jsx(v9,{inline:!0,widgetName:a})}):d==="sql"?f.jsxs(q,{bg:"white",borderWidth:"1px",borderBottom:"0",borderTopLeftRadius:"md",borderTopRightRadius:"md",direction:"row",p:"2",alignItems:"center",justifyContent:"space-between",children:[d==="sql"?f.jsxs(q,{spacing:"0",alignItems:"center",direction:"row",children:[f.jsx(ke,{onMouseLeave:i,children:f.jsxs(Ir,{returnFocusOnClose:!1,isOpen:!o&&!l&&c&&n,onClose:i,placement:"bottom-end",closeOnBlur:!1,children:[f.jsx(Rr,{children:f.jsxs(q,{onMouseOver:t,onMouseEnter:t,direction:"row",mr:"3",children:[f.jsx(qCe,{}),f.jsx(GCe,{})]})}),s()]})}),f.jsx(zCe,{})]}):null,f.jsxs(q,{direction:"row",children:[u?f.jsx(Bn,{label:"Converting to Smart Table",children:f.jsx(_d,{mr:"2",emptyColor:"gray.200",color:"yellow.500",size:"sm"})}):null,R.length>0?f.jsx(Bn,{label:"Update",children:f.jsx(St,{"aria-label":"Save Cell edits",icon:f.jsx(Hf,{size:"14"}),variant:"outline",colorScheme:"blue",size:"sm",onClick:O,isLoading:M.isLoading})}):null]})]}):null},QCe=()=>{const[r,e]=Ji(KW),t=cv(),i=r[t],{rows:n,isLoading:s}=Jf(t),o=c=>{e(d=>({...d,[t]:{...d[t]||{},pageSize:+c}}))},a=c=>{e(d=>({...d,[t]:{...d[t]||{},currentPage:c}}))};return i?f.jsxs(q,{alignItems:"center",borderBottomRightRadius:"md",borderBottomLeftRadius:"md",borderTop:"0",borderWidth:"1px",py:"1",px:"2",direction:"row",children:[f.jsx(tn,{children:f.jsx(os,{size:"xs",flex:"1",maxW:"20",type:"select",placeholder:"select page size",value:i.pageSize,options:[1,10,20,50,100].map(c=>({name:c,value:c})),onChange:o})}),!s&&i.currentPage>0&&n.length===0?f.jsx(q,{direction:"row",ml:"auto",children:f.jsx(Bn,{label:"Seems like the page doesnt have any data. Try changing pages or click to go to first page",children:f.jsx(Qe,{onClick:()=>{a(0)},size:"xs",variant:"outline",colorScheme:"gray",children:"Go to first page"})})}):null,f.jsxs(q,{alignItems:"center",spacing:"0",direction:"row",ml:"auto",children:[f.jsx(St,{icon:f.jsx(kZ,{size:"12"}),variant:"outline",size:"xs",colorScheme:"gray","aria-label":"Prev page",borderTopRightRadius:"none",borderBottomRightRadius:"none",onClick:()=>{a(+i.currentPage-1)},isDisabled:i.currentPage<=0,flexShrink:"0"}),f.jsx(ke,{fontSize:"sm",lineHeight:1,fontWeight:"medium",px:"2.5",children:i.currentPage+1}),f.jsx(St,{icon:f.jsx(qG,{size:"12"}),variant:"outline",size:"xs",colorScheme:"gray","aria-label":"Next page",borderTopLeftRadius:"none",borderBottomLeftRadius:"none",onClick:()=>{a(+i.currentPage+1)},isDisabled:i.pageSize>=n.length,flexShrink:"0"})]})]}):null},YCe=({onAttach:r})=>{const[e,t]=z.useState(null),{appName:i,pageName:n}=Ri(),{isPreview:s}=Ze(Zo),o=Ut(),{properties:a}=pi({appName:i,pageName:n}),c=cv(),{table:d}=Co(c),{widget:l}=Co(c||""),{widgets:u}=pi({appName:i,pageName:n});z.useEffect(()=>{t(l)},[l]);const h=Vr({onSuccess:()=>{o({title:"Attached table widget",status:"success"}),r==null||r()},onError:m=>{o({title:"Failed to attach widget",description:ni(m),status:"error"})}}),g=async m=>{try{await h.mutateAsync({app_name:i,page_name:n,properties:{...a||{},blocks:[...((a==null?void 0:a.blocks)||[]).map(y=>y.name===c?{...y,widget:m||null}:y)]}}),t(m)}catch{}};return s||d.type==="sql"||!d.fetcher?null:f.jsx(tn,{children:f.jsx(q,{direction:"row",children:f.jsx(os,{type:"select",options:u.filter(m=>m.type==="inline").map(m=>({name:m.label,value:m.name})),validation:{required:"Cannot  be empty"},name:"Select Table",placeholder:e?"Clear widget":"Attach inline widget",id:"table",onChange:g,value:e})})})},XCe=[PZ,BCe,AZ,MZ,LZ,FZ,OZ],JCe=({tableName:r,height:e})=>{var Tn,Ao,ra,Pc,no,Ac,qa,Ga;const t=Ut(),i=MN(),{colorMode:n}=tk(),[s,o]=z.useState(null),{appName:a,pageName:c}=Ri(),d=HW(),{sendJsonMessage:l}=b1(d,{share:!0}),u=Ze(Ba),h=Ti(vu),{isPreview:g}=Ze(Zo),m=(Tn=u==null?void 0:u.context)==null?void 0:Tn[r],[y,_]=Ji(vCe),[b,E]=Ji(u9),[D,R]=z.useState({rows:Tu.empty(),columns:Tu.empty(),current:void 0}),M=y==null?void 0:y[r],{properties:O}=pi({appName:a,pageName:c}),{renderPopoverContent:L,onOpen:W,onClose:Z,isOpen:K}=_9(r),{isLoading:H,rows:C,columnDict:B,header:te,refetch:ue,isRefetching:be,tableError:de,error:le,remove:Me}=Jf(r),{depends_on:Re,isLoading:Oe,size:Ge,table:xe}=Co(r||""),[Kt,je]=z.useState(),et=z.useRef(),[Qt,ct]=z.useState(),ai=z.useRef(),dt=CCe(r),xi=xe==null?void 0:xe.fetcher,ci=GH(xi),mt=g9({onSuccess:()=>{o(null)},onError:()=>{o(null)}}),vn=Vr({onSuccess:()=>{t({title:"Commited Columns details",status:"success"})},onError:Pe=>{t({title:"Failed to commit",status:"error",description:ni(Pe)})}}),[zr,Kr]=Ji(d9),qn=(zr==null?void 0:zr[r])||[],[ut,U]=Ji(ov),J=ut==null?void 0:ut[r],Y=GH(J),[_e,Se]=Ji(KW),Ce=_e[r]||{},[Vt,Pt]=z.useState(M||{}),Zt=Pe=>{const Ne={[r]:C[Pe]||{}};let N={};return U(Q=>(N={...Q,[r]:Ne[r]},{...Q,...Ne})),E(Q=>({...Q,[r]:!0})),u.state={...u.state,...Ne},N},cr=(Pe,Ne,N)=>{R(Q=>({...Q,current:{cell:[Ne,N],range:{x:Ne,y:N,width:1,height:1},rangeStack:[]},rows:Tu.fromSingleSelection([N,N+1])})),Zt(N),(Pe==null?void 0:Pe.type)==="function"&&o(JSON.stringify([N,Ne])),mt(Pe)},yn=z.useCallback((Pe,Ne)=>{Pt(N=>({...N,[Pe.id]:Ne})),_(N=>({...N,[r]:{...(N==null?void 0:N[r])||{},[Pe.id]:Ne}}))},[_,r]),Ro=z.useCallback(()=>{var Pe,Ne,N,Q;ai!=null&&ai.current&&ct((Ne=(Pe=ai==null?void 0:ai.current)==null?void 0:Pe.getBoundingClientRect())==null?void 0:Ne.height),et!=null&&et.current&&je((Q=(N=et==null?void 0:et.current)==null?void 0:N.getBoundingClientRect())==null?void 0:Q.height)},[]);z.useEffect(()=>{Ro()},[Ro]),z.useEffect(()=>{m&&(m!=null&&m.reload)&&(ue(),h(Pe=>({...Pe,[r]:{...(Pe==null?void 0:Pe[r])||{},reload:!1}})))},[m,h,r,ue]),z.useEffect(()=>{const Pe=C.findIndex(Ne=>JSON.stringify(Ne)===JSON.stringify(J));Pe!==-1&&Pe!==D.rows.toArray()[0]&&R(Ne=>({...Ne,rows:Tu.fromSingleSelection([Pe,Pe+1])}))},[J,C,D]),z.useEffect(()=>{JSON.stringify(xi)!==JSON.stringify(ci)&&J&&B&&Object.keys(B).find(Ne=>{var N;return!((N=Object.keys(J))!=null&&N.includes(Ne))})&&U(Ne=>({...Ne,[r]:Object.keys(B).reduce((N,Q)=>({...N,[Q]:null}),{})}))},[J,B,r,xi,ci,U]),z.useEffect(()=>{if(JSON.stringify(Y)!==JSON.stringify(J)){const Pe=C.findIndex(N=>JSON.stringify(N)===JSON.stringify(J)),Ne=Object.keys(J||{}).find(N=>J[N]!==null);Pe===-1&&J&&!Ne&&U(N=>({...N,[r]:Object.keys(J).reduce((Q,ve)=>({...Q,[ve]:null}),{})}))}},[J,Y,r,C,U]),z.useEffect(()=>{Pt(Pe=>Object.keys(Pe).length===0&&M?M:Pe)},[M,Pt]),z.useEffect(()=>{Kr(Pe=>({...Pe,[r]:[]}))},[r,Kr]),z.useEffect(()=>{Se(Pe=>({...Pe,[r]:{currentPage:0,pageSize:Ge}}))},[r,Ge,Se]);const Ua=n==="dark"?{accentColor:i.colors.blue[500],accentLight:fv(i.colors.blue[500],.1)(i),textDark:i.colors.gray[300],textLight:i.colors.gray[500],bgIconHeader:i.colors.gray[700],fgIconHeader:i.colors.gray[50],textHeader:i.colors.gray[200],borderColor:i.colors.gray[700],bgHeaderHovered:i.colors.gray[800],bgCell:i.colors.gray[900],bgHeader:i.colors.gray[900],bgHeaderHasFocus:i.colors.gray[800],bgBubble:i.colors.gray[800],bgBubbleSelected:i.colors.blue[500],textBubble:i.colors.gray[600],bgSearchResult:fv(i.colors.yellow[500],.2)(i),baseFontStyle:"12px"}:{accentColor:i.colors.blue[500],accentLight:fv(i.colors.blue[500],.1)(i),textDark:i.colors.gray[700],textLight:i.colors.gray[400],bgIconHeader:i.colors.gray[600],fgIconHeader:i.colors.gray[100],textHeader:i.colors.gray[600],borderColor:i.colors.gray[100],bgCell:i.colors.white,bgHeader:i.colors.white,bgHeaderHovered:i.colors.gray[50],bgHeaderHasFocus:i.colors.gray[100],bgBubble:i.colors.gray[100],bgSearchResult:fv(i.colors.yellow[500],.3)(i),baseFontStyle:"12px"},hs=te.filter(Pe=>{var Ne;return!(B!=null&&B[Pe==null?void 0:Pe.name])||!((Ne=B[Pe==null?void 0:Pe.name])!=null&&Ne.hidden)}),Va=hs.map(Pe=>{var j,$e,S,$;const Ne=B[Pe==null?void 0:Pe.name]||Pe;let N=Ne!=null&&Ne.display_type?Iu.HeaderString:void 0;switch((Ne==null?void 0:Ne.column_type)==="button_column"&&(N=Iu.HeaderCode),Ne==null?void 0:Ne.display_type){case"currency":case"integer":{N=Iu.HeaderNumber;break}case"float":{N=Iu.HeaderMath;break}case"date":{N=Iu.HeaderDate;break}case"time":case"datetime":{N=Iu.HeaderTime;break}case"boolean":{N=Iu.HeaderBoolean;break}}const Q=($=(S=($e=(j=u==null?void 0:u.context)==null?void 0:j[r])==null?void 0:$e.columns)==null?void 0:S[Pe.name])==null?void 0:$.message_type;let ve="";switch(Q){case"error":{ve="#C53030";break}case"warning":{ve="#C05621";break}case"info":{ve="#2B6CB0";break}}const x=ve!==""?{textHeader:ve,bgIconHeader:ve}:{},I={id:Pe.name,title:Pe.name,width:Vt[Pe.name]||String(Pe.name).length*10+35+30,icon:N,themeOverride:x};return Pe.editable?{...I}:B[Pe==null?void 0:Pe.name]?I:{...I,themeOverride:{textDark:fv(i.colors.gray[700],.4)(i),bgHeader:i.colors.gray[50],textHeader:i.colors.gray[400]}}}),Rc=([Pe,Ne])=>{var Ae,Ft,Wt,kt,br,di,ro,Gn,ep,Ps,Eb,lv;const N=C[Ne],Q=B[(Ae=hs[Pe])==null?void 0:Ae.name]||hs[Pe],ve=N==null?void 0:N[Q==null?void 0:Q.name],x=(Ft=qn.find(As=>As.columnIndex===Pe&&As.rowIndex===Ne))==null?void 0:Ft.new_value,j=x===void 0?ve??"":x,S=typeof j=="object"&&j!==null?JSON.stringify(j):String(j),$=Q==null?void 0:Q.editable;if(Q!=null&&Q.primary_key)return{kind:Cr.Text,data:String(S),displayData:String(S),allowOverlay:!1,readonly:!0,themeOverride:{bgCell:i.colors.gray[50]}};const ae=$?{}:{themeOverride:{bgCell:i.colors.gray[50]}};if((Q==null?void 0:Q.column_type)==="button_column"){const As=s===JSON.stringify([Ne,Pe]),fs=(Wt=i.colors)==null?void 0:Wt[(Q==null?void 0:Q.color)||"gray"];return As?{kind:Cr.Custom,allowOverlay:!1,readOnly:!0,data:{kind:"spinner-cell"},...ae}:{kind:Cr.Custom,allowOverlay:!1,readonly:!0,data:{kind:"button-cell",backgroundColor:["transparent",fs==null?void 0:fs[100]],color:fs==null?void 0:fs[500],borderColor:fs==null?void 0:fs[500],borderRadius:2,title:Q.label,onClick:()=>cr(Q==null?void 0:Q.on_click,Pe,Ne)},...ae}}switch(Q==null?void 0:Q.display_type){case"currency":return{kind:Cr.Number,data:S,allowOverlay:$,displayData:j===null?"":`${(kt=Q==null?void 0:Q.configurations)==null?void 0:kt.symbol}${S}`,readonly:!$,...ae};case"array":{if(Array.isArray(ve)){if(((br=Q==null?void 0:Q.configurations)==null?void 0:br.display_as)==="area"||((di=Q==null?void 0:Q.configurations)==null?void 0:di.display_as)==="bar"){if(ve.find(Sr=>typeof Sr!="number"))return{kind:Cr.Text,data:"",allowOverlay:!1,displayData:"Incorrect data",readonly:!0,...ae};const fs=Math.max(...ve),so=Math.min(...ve);return{kind:Cr.Custom,allowOverlay:!1,data:{kind:"sparkline-cell",values:ve,displayValues:ve.map(Sr=>Sr.toString()),color:(ve==null?void 0:ve[0])<(ve==null?void 0:ve[ve.length-1])?i.colors.green[500]:i.colors.red[500],graphKind:(ro=Q==null?void 0:Q.configurations)==null?void 0:ro.display_as,hideAxis:!1,yAxis:[so,fs]},...ae}}return{kind:Cr.Custom,allowOverlay:!0,copyData:"4",readonly:!0,data:{kind:"tags-cell",possibleTags:ve.map(As=>({tag:As,color:"#cdcdcd"})),tags:ve.map(As=>String(As))},...ae}}return{kind:Cr.Text,data:"",allowOverlay:!1,displayData:"Incorrect data",readonly:!0,...ae}}case"select":{if((Gn=Q==null?void 0:Q.configurations)!=null&&Gn.multiple){const so=[...new Set([...((ep=Q==null?void 0:Q.configurations)==null?void 0:ep.options)||[],...S.split(",").filter(Sr=>{var sH;return!(((sH=Q==null?void 0:Q.configurations)==null?void 0:sH.options)||[]).find(OI=>(OI==null?void 0:OI.value)===(Sr==null?void 0:Sr.value))}).map(Sr=>({label:Sr,value:Sr}))])];return{kind:Cr.Custom,allowOverlay:$,data:{kind:"multi-select-cell",values:S==null?void 0:S.split(","),options:so.map(Sr=>({...Sr,label:(Sr==null?void 0:Sr.name)||(Sr==null?void 0:Sr.label),color:"gray"})),allowDuplicates:!1,allowCreation:!1},readonly:!$,...ae}}const As=(Eb=((Ps=Q==null?void 0:Q.configurations)==null?void 0:Ps.options)||[])==null?void 0:Eb.find(so=>so.value===S),fs=[...((lv=Q==null?void 0:Q.configurations)==null?void 0:lv.options)||[],...As?[]:[{label:S,value:S}]];return{kind:Cr.Custom,allowOverlay:$,data:{kind:"dropdown-cell",allowedValues:fs.map(so=>({...so,label:(so==null?void 0:so.name)||(so==null?void 0:so.label),color:"gray"})),value:S},readonly:!$,...ae}}case"float":case"integer":return{kind:Cr.Number,data:S,allowOverlay:$,displayData:j===null?"":S,readonly:!$,...ae};case"boolean":{const As=typeof j=="boolean";return{kind:Cr.Boolean,data:As?j:void 0,allowOverlay:!1,readonly:!$,...ae}}case"datetime":return{kind:Cr.Custom,allowOverlay:!0,readonly:!$,data:{kind:"date-picker-cell",date:Wm(S),displayDate:_Se(S),format:"datetime-local"},...ae};case"date":return{kind:Cr.Custom,allowOverlay:$,readonly:!$,data:{kind:"date-picker-cell",date:Wm(S),displayDate:gSe(S),format:"date"},...ae};case"time":return{kind:Cr.Custom,allowOverlay:$,readonly:!$,data:{kind:"date-picker-cell",date:new Date(vSe(S)),displayDate:mSe(S),format:"time"},...ae};default:return/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/g.test(S)?{kind:Cr.Uri,displayData:S,data:S,hoverEffect:!0,allowOverlay:!0,readonly:!$,onClickUri:fs=>{fs.preventDefault(),window.open(S,"_blank")},...ae}:{kind:Cr.Text,data:S,allowOverlay:!0,displayData:String(S),readonly:!$,...ae}}},Po=(Pe,Ne)=>{var j,$e,S,$,ae,Ae,Ft,Wt,kt,br,di,ro;const[N,Q]=Pe,ve=C[Q];if(Ne.readonly)return;const x=B[(j=hs[N])==null?void 0:j.name];let I=null;if(Ne.kind===Cr.Custom)switch(Ne.data.kind){case"date-picker-cell":{(($e=Ne==null?void 0:Ne.data)==null?void 0:$e.format)==="datetime-local"||((S=Ne==null?void 0:Ne.data)==null?void 0:S.format)==="date"?I=(ae=($=Ne==null?void 0:Ne.data)==null?void 0:$.date)==null?void 0:ae.getTime():((Ae=Ne==null?void 0:Ne.data)==null?void 0:Ae.format)==="time"&&(I=ySe((Wt=(Ft=Ne==null?void 0:Ne.data)==null?void 0:Ft.date)==null?void 0:Wt.getTime()));break}case"dropdown-cell":{I=(kt=Ne==null?void 0:Ne.data)==null?void 0:kt.value;break}case"multi-select-cell":{I=(di=(br=Ne==null?void 0:Ne.data)==null?void 0:br.values)==null?void 0:di.join(",");break}}else I=Ne.data;((ro=x==null?void 0:x.edit_keys)==null?void 0:ro.length)>0&&Kr(Gn=>((Gn==null?void 0:Gn[r])||[]).find(Ps=>Ps.rowIndex===Q&&x.name===Ps.column_name)?{...Gn,[r]:((Gn==null?void 0:Gn[r])||[]).map(Ps=>Ps.rowIndex===Q&&x.name===Ps.column_name?{...Ps,new_value:I===void 0?null:I}:Ps)}:{...Gn,[r]:[...(Gn==null?void 0:Gn[r])||[],{new_value:I===void 0?null:I,value:ve[x.name],column_name:x.name,data_type:B[x.name].data_type,old_value:ve[x.name],rowIndex:Q,columnIndex:N}]})},na=()=>{R({rows:Tu.empty(),columns:Tu.empty(),current:void 0});const Pe={[r]:Object.keys(J).reduce((N,Q)=>({...N,[Q]:null}),{})};let Ne={};U(N=>(Ne={...N,[r]:Pe[r]},{...N,...Pe})),E(N=>({...N,[r]:!1})),u.state={...u.state,...Pe},l({type:"display_rule",state_context:{...u,state:Ne},app_name:a,page_name:c})},X=Pe=>{var ve,x,I,j;const Ne=(x=(ve=Pe==null?void 0:Pe.rows)==null?void 0:ve.toArray())==null?void 0:x[0],N=(j=(I=Pe==null?void 0:Pe.current)==null?void 0:I.cell)==null?void 0:j[1],Q=typeof Ne=="number"?Ne:N;if(typeof Q=="number"){R({rows:Tu.fromSingleSelection([Q,Q+1]).add(Pe.rows),columns:Pe.columns,current:Pe.current});const $e=Zt(Q);l({type:"display_rule",state_context:{...u,state:$e},app_name:a,page_name:c})}else na()},wr=()=>{vn.mutate({app_name:a,page_name:c,properties:{...O||{},blocks:[...((O==null?void 0:O.blocks)||[]).map(Pe=>Pe.name===r?{...Pe,smart:!1,columns:te.map(Ne=>({...(B==null?void 0:B[Ne])||{},...Ne}))}:Pe)]}})},P=qn.map(Pe=>({color:"#e5e5e5",range:{x:Pe.columnIndex,y:Pe.rowIndex,width:1,height:1},style:"solid"})),oe=z.useMemo(()=>({tableName:r}),[r]),tt=de||((Pc=(ra=(Ao=le==null?void 0:le.response)==null?void 0:Ao.data)==null?void 0:ra.result)==null?void 0:Pc.error)||(le==null?void 0:le.message),ei=(Re||[]).filter(Pe=>!b[Pe]),wi=()=>{h(Pe=>({...Lg(Pe,`${r}.message`,null),...Lg(Pe,`${r}.message_type`,null)}))},nn=()=>{setTimeout(()=>{Ro()},500)},kn=e-Kt-40-Qt;return f.jsx(f9.Provider,{value:oe,children:f.jsxs(q,{pos:"relative",h:"full",spacing:"0",children:[f.jsx(QW,{isLoading:Oe,children:f.jsxs(q,{alignItems:"center",ref:et,flexShrink:"0",pb:"3",direction:"row",w:"full",overflow:"hidden",children:[f.jsxs(q,{spacing:"0",flexShrink:"0",children:[f.jsxs(tr,{children:[g?null:f.jsx(ke,{_hover:{color:"gray.800",borderColor:"gray.50"},borderWidth:"1px",borderColor:"transparent",borderRadius:"sm",cursor:"grab",className:"react-grid-drag-handle",children:f.jsx(TZ,{size:"14"})}),f.jsx(tr.Label,{children:OC((xe==null?void 0:xe.label)||r,ut)}),g?null:f.jsx(tr.Code,{children:r}),xe!=null&&xe.smart&&!g?f.jsx(ke,{fontSize:"xs",px:"2",my:"1",py:"1",borderRadius:"sm",borderWidth:"1px",borderColor:"yellow.400",bg:"yellow.50",color:"yellow.700",fontWeight:"medium",h:"fit-content",w:"fit-content",children:"Smart Table"}):null]}),ei.length>0?f.jsxs(q,{direction:"row",spacing:"1",alignItems:"center",children:[f.jsx(ke,{color:"orange.500",children:f.jsx(Kw,{size:"14"})}),f.jsxs(Ie,{fontSize:"xs",children:["This table depends on"," ",f.jsx(ke,{as:"span",px:".5",fontWeight:"semibold",children:(Re||[]).join(", ")}),". No row selection found for"," ",f.jsx(ke,{as:"span",fontWeight:"semibold",color:"orange.500",children:ei.join(", ")})]})]}):null]}),f.jsxs(q,{ml:"auto",alignItems:"center",direction:"row",spacing:"2",flexShrink:"0",children:[f.jsx(Bn,{label:"Use inline widget",children:f.jsx(YCe,{onAttach:nn})}),f.jsx(Bn,{label:"Refresh data",children:f.jsx(St,{"aria-label":"Refresh Data",size:"xs",colorScheme:"gray",icon:f.jsx(kk,{size:"14"}),variant:"outline",isLoading:be,onClick:()=>{H&&Me(),ue({cancelRefetch:!0})}})}),!H&&!g&&dt?f.jsx(Bn,{label:"Save columns",children:f.jsx(Qe,{variant:"outline",colorScheme:"gray",leftIcon:f.jsx(IZ,{size:"14"}),size:"sm",flexShrink:"0",onClick:wr,isLoading:vn.isLoading,children:"Save Columns"})}):null]})]})}),f.jsxs(q,{position:"relative",spacing:"0",children:[f.jsxs(Ir,{returnFocusOnClose:!1,isOpen:!g&&!(xe!=null&&xe.smart)&&(xe==null?void 0:xe.fetcher)&&K,onClose:Z,placement:"top-end",closeOnBlur:!1,children:[f.jsx(Rr,{children:f.jsx(ke,{})}),L()]}),f.jsx(ke,{ref:ai,children:f.jsx(KCe,{})}),f.jsxs(q,{height:`${kn}px`,borderWidth:"1px",onDoubleClick:()=>{!(xe!=null&&xe.smart)&&(xe==null?void 0:xe.type)==="sql"&&W()},children:[H||be?f.jsxs(f.Fragment,{children:[be?f.jsx(hi,{isLoaded:!1,h:"calc(100%-6px)",position:"absolute",left:"0",w:"full",as:q,startColor:"blackAlpha.200",endColor:"blackAlpha.400",zIndex:9}):null,f.jsx(_u,{w:"full",position:"absolute",top:"-2px",left:"0",size:"xs",isIndeterminate:!0,colorScheme:"blue"})]}):null,!g&&tt?f.jsxs(mo,{as:q,spacing:"0",p:"6",h:"full",children:[f.jsx(Ie,{color:"red.500",fontWeight:"medium",fontSize:"lg",children:"Failed to load data"}),f.jsx(Ie,{fontSize:"md",children:ni(tt)})]}):f.jsx(f.Fragment,{children:f.jsx(RZ,{columns:Va,rows:Math.min(C.length,Ce.pageSize||h9),customRenderers:XCe,width:"100%",height:"100%",getCellContent:Rc,rowMarkers:"both",smoothScrollX:!0,smoothScrollY:!0,theme:Ua,onGridSelectionChange:X,onSelectionCleared:na,gridSelection:D,highlightRegions:P,getCellsForSelection:!0,onCellEdited:Po,onPaste:!0,keybindings:{search:!0},onColumnResize:yn,rowHeight:30,fixedShadowX:!1,fixedShadowY:!1})})]}),f.jsx(QCe,{})]}),f.jsx(JW,{message:(Ac=(no=u==null?void 0:u.context)==null?void 0:no[r])==null?void 0:Ac.message,type:(Ga=(qa=u==null?void 0:u.context)==null?void 0:qa[r])==null?void 0:Ga.message_type,onClose:wi})]})})},ZCe=r=>{const{appName:e,pageName:t}=Ri(),{isConnected:i}=Bd(),{tables:n,properties:s}=pi({appName:e,pageName:t}),o=Ut(),a=Ti(Io),c=Vr({onSuccess:()=>{o({status:"success",title:"Table created"})},onError:l=>{o({status:"error",title:"Create table failed",description:ni(l)})}}),d=async()=>{const{name:l,label:u}=Bf({currentNames:n.map(h=>h.name)||[],prefix:"table"});try{await c.mutateAsync({app_name:e,page_name:t,properties:{...s||{},blocks:[...(s==null?void 0:s.blocks)||[],{name:l,label:u,type:"sql",block_type:"table",columns:[],y:Math.max(...n.map(h=>h.y))}]}}),a({id:l,type:"table",meta:null})}catch{}};return f.jsx(Qe,{"aria-label":"Add table",leftIcon:f.jsx(Xs,{size:"14"}),onClick:d,isLoading:c.isLoading,isDisabled:!i,...r,children:"New Table"})},eEe=NZ.WidthProvider($Z),tEe=HG(q)`
	.react-grid-item.react-grid-placeholder {
		background: ${r=>r.theme.colors.blue[100]};
		opacity: 0.25;
	}

	.react-grid-item > .react-resizable-handle {
		background-image: none;

		&::after {
			width: 6px;
			height: 6px;
			border-right: 2px solid ${r=>r.theme.colors.gray[500]};
			border-bottom: 2px solid ${r=>r.theme.colors.gray[500]};
			border-radius: 1px;
			right: 5px;
			bottom: 6px;
		}

		&.react-resizable-handle-se {
			right: -5px;
		}

		&.react-resizable-handle-sw {
			left: -5px;
			bottom: 1px;
		}

		&.react-resizable-handle-nw {
			left: -5px;
			top: -10px;
		}

		&.react-resizable-handle-ne {
			top: -10px;
			right: -5px;
		}
	}
`,mP="new-table",w9=()=>{const{appName:r,pageName:e}=Ri(),{isPreview:t}=Ze(Zo),{tables:i,properties:n}=pi({appName:r,pageName:e}),[s,o]=z.useState(null),a=Vr();z.useEffect(()=>{var g,m;const h=((m=(g=document.getElementById("table-container"))==null?void 0:g.getBoundingClientRect())==null?void 0:m.height)||1e3;o((h<600?600:h)/2)},[t]);const c=()=>{document.body.style.userSelect="none"},d=()=>{document.body.style.userSelect="initial"},l=h=>{var _;const g=h.filter(b=>b.i!==mP),m=g.filter(b=>{const E=i==null?void 0:i.find(D=>D.name===b.i);return E.x!==b.x||E.y!==b.y||E.h!==b.h||E.w!==b.w}),y=g.reduce((b,E)=>({...b,[E.i]:{x:E.x,y:E.y,h:E.h,w:E.w}}),{});m.length>0&&!a.isLoading&&a.mutate({app_name:r,page_name:e,properties:{...n||{},blocks:(_=n==null?void 0:n.blocks)==null?void 0:_.map(b=>b.block_type==="table"?{...b,...(y==null?void 0:y[b.name])||{}}:b)}})},u=Math.max(...i.map(h=>h.y));return f.jsxs(tEe,{bg:"white",spacing:"2",px:"4",py:"2",h:"full",overflowY:"auto",overflowX:"hidden",id:"table-container",position:"relative",children:[a.isLoading?f.jsx(_u,{position:"absolute",top:"0",left:"0",w:"full",size:"xs",isIndeterminate:!0}):null,s?f.jsxs(eEe,{className:"layout",cols:4,rowHeight:s,preventCollision:!1,isDraggable:!t,isResizable:!t,onDragStart:c,onDragStop:d,onLayoutChange:l,draggableHandle:".react-grid-drag-handle",children:[i.map(h=>f.jsx(ke,{"data-grid":{x:(h==null?void 0:h.x)||0,y:(h==null?void 0:h.y)||0,w:(h==null?void 0:h.w)||4,h:(h==null?void 0:h.h)||1,i:h==null?void 0:h.name,resizeHandles:["se","sw","ne","nw"]},children:f.jsx(eH,{flexShrink:"0",h:"full",w:"full",type:"table",id:h.name,children:f.jsx(JCe,{height:s*((h==null?void 0:h.h)||1),tableName:h.name})})},h.name)),t?null:f.jsx(ke,{"data-grid":{x:4,y:(u||0)+1,w:1,h:50/s,i:mP,isResizable:!1,isDraggable:!1},children:f.jsx(ke,{ml:"auto",borderWidth:"1px",borderStyle:"dashed",p:"2",h:"full",borderRadius:"md",children:f.jsx(ZCe,{h:"full",w:"full",variant:"secondary"})})},mP)]}):null]})},iEe=async({appId:r,newLabel:e})=>(await Ei.put("/app/",{app_id:r,new_label:e})).data,nEe=(r={})=>{const e=Li();return Jt(iEe,{...r,onSettled:()=>{e.invalidateQueries(Xf),e.invalidateQueries(Dc)}})},rEe=r=>{const{isPreview:e,index:t,tabIndex:i,page:n,pages:s}=r,{isOpen:o,onOpen:a,onClose:c}=Ki(),{isOpen:d,onOpen:l,onClose:u}=Ki(),{appName:h,pageName:g}=Ri(),[m,y]=z.useState(""),_=Ut(),b=HSe(),E=BSe(),[D]=z.useState(!1),R=Eo(),M=`/apps/${h}/${n==null?void 0:n.name}`,O=()=>{u(),a(),y(n==null?void 0:n.label)},L=()=>{c(),l()},W=()=>{n!=null&&n.label&&y(n==null?void 0:n.label),c()},Z=C=>{const B=C.target.value;y(B)},K=()=>{h&&g&&b.mutate({appName:h,pageName:g,newPageLabel:m},{onSuccess:()=>{_({status:"success",title:"Page renamed"})},onError:C=>{_({status:"error",title:"Failed to rename page",description:ni(C)})}})},H=()=>{h&&g&&E.mutate({appName:h,pageName:g},{onSuccess:()=>{_({status:"success",title:"Page deleted"});const C=s.find(B=>B.name!==g);e?R(`../${C.name}`,{relative:"path"}):R(`../../${C.name}/studio`,{relative:"path"})},onError:C=>{_({status:"error",title:"Failed to delete page",description:ni(C)})}})};return f.jsx(WZ,{display:"flex",alignItems:"center",as:vh,to:e?M:`${M}/studio`,px:"3",py:"1",_selected:{color:"blue.500"},children:f.jsxs(dn,{align:"center",justifyContent:"center",h:"24px",children:[f.jsx(ke,{fontWeight:"semibold",children:n==null?void 0:n.label}),!e&&f.jsx(Cc,{fontSize:"xs",bg:"transparent",ml:"3",children:n==null?void 0:n.name}),e?null:f.jsxs(sf,{closeOnSelect:!1,onClose:()=>{c(),u()},children:[f.jsx(of,{ml:"1",color:"gray.400",_hover:{color:"gray.600"},visibility:i===t?"visible":"hidden",disabled:i!==t,children:f.jsx(ke,{children:f.jsx(GG,{size:"14"})})}),f.jsxs(af,{color:"black",children:[f.jsxs(Ir,{placement:"right",onClose:c,isOpen:o,onOpen:O,closeOnBlur:!1,children:[f.jsx(Rr,{children:f.jsx(Nl,{"data-db-id":"rename-page",children:"Edit"})}),f.jsxs(jr,{textColor:"black",color:"black",onClick:C=>{C.preventDefault(),C.stopPropagation()},onBlur:C=>{var B;(B=C.relatedTarget)!=null&&B.id.includes("menu-list")&&C.preventDefault()},children:[f.jsx(xs,{}),f.jsx(Br,{children:f.jsxs(tn,{isInvalid:!!D,children:[f.jsx(ir,{children:"Edit Page name"}),f.jsx(as,{size:"sm",placeholder:"Page name",value:m,autoFocus:!0,onChange:Z,onKeyDown:C=>{C.stopPropagation(),C.key==="Enter"&&K()}}),f.jsx(Ek,{children:D})]})}),f.jsx(cs,{display:"flex",alignItems:"end",children:f.jsxs(vr,{ml:"auto",size:"sm",children:[f.jsx(Qe,{onClick:W,colorScheme:"gray",textColor:"gray",variant:"outline",children:"Cancel"}),f.jsx(Qe,{isDisabled:m===n.name||!n.name||!!D,colorScheme:"blue",onClick:K,isLoading:b.isLoading,children:"Update"})]})})]})]}),f.jsxs(Ir,{placement:"right",closeOnBlur:!1,onClose:u,isOpen:d,onOpen:L,children:[f.jsx(Rr,{children:f.jsx(Nl,{id:"delete-page",children:"Delete"})}),f.jsxs(jr,{onClick:C=>{C.preventDefault(),C.stopPropagation()},children:[f.jsx(xs,{}),f.jsx(Br,{children:"Are you sure you want to delete this page?"}),f.jsx(cs,{display:"flex",alignItems:"end",children:f.jsxs(vr,{ml:"auto",size:"sm",children:[f.jsx(Qe,{colorScheme:"gray",textColor:"gray",variant:"outline",onClick:u,children:"Cancel"}),f.jsx(Qe,{colorScheme:"red",isLoading:E.isLoading,onClick:H,children:"Delete"})]})})]})]})]})]})]})},n.name)},sEe=async({workspaceId:r})=>{const{data:e}=await zt.get(`/workspace/${r}/groups`);return e},ZW="workspaceGroups",dv=()=>{const{id:r}=Ze(gn),e=[ZW,r],{data:t,...i}=rr(e,()=>sEe({workspaceId:r}),{enabled:!!r,staleTime:1/0});return{groups:t||[],...i}},oEe=async({workspaceId:r})=>{const{data:e}=await zt.get(`/workspace/${r}/users`);return e},jD="workspaceUsers",Zf=()=>{const{id:r}=Ze(gn),e=[jD,r],{data:t,...i}=rr(e,()=>oEe({workspaceId:r}),{enabled:!!r,staleTime:1/0});return{users:t||[],...i}},aEe=async({email:r,workspaceId:e,roleId:t})=>(await zt.post(`/workspace/${e}/add_user`,{user_email:r,role_id:t})).data,cEe=r=>Jt(aEe,{...r||{}}),dEe=async({userId:r,workspaceId:e})=>(await zt.post(`/workspace/${e}/remove_user`,{user_id:r})).data,lEe=r=>Jt(dEe,{...r||{}}),uEe=async({userId:r,roleId:e,workspaceId:t})=>(await zt.put(`/workspace/${t}/user_role`,{user_id:r,role_id:e})).data,hEe=r=>Jt(uEe,{...r||{}}),fEe=async({appId:r,subjects:e,action:t})=>(await zt.post(`/app/${r}/share`,{subjects:e,action:t})).data,pEe=r=>Jt(fEe,{...r||{}}),gEe=async({appId:r})=>(await zt.get(`/app/${r}/has_access`)).data,mEe=()=>{const{appName:r}=Ri(),{apps:e}=Ud(),t=e==null?void 0:e.find(s=>s.name===r),{data:i,...n}=rr(["appAccess"],()=>gEe({appId:(t==null?void 0:t.id)||""}),{enabled:!!(t!=null&&t.id)});return{userAccess:(i==null?void 0:i.users)||[],groupAccess:(i==null?void 0:i.groups)||[],...n}},q2=({identification:r,permission:e})=>f.jsxs(dn,{alignItems:"center",justifyContent:"space-between",w:"full",px:"2",py:"2",children:[f.jsx(Ie,{fontSize:"sm",children:r}),f.jsx(Ie,{fontSize:"xs",color:"gray",textTransform:"capitalize",children:e})]}),vEe=()=>{const{userAccess:r,groupAccess:e,isLoading:t}=mEe(),{users:i}=Zf(),{groups:n}=dv(),s=z.useCallback(a=>i.find(c=>c.id===a),[i]),o=z.useCallback(a=>n.find(c=>c.id===a),[n]);return f.jsxs(nu,{w:"full",children:[f.jsx(Ie,{mr:"auto",fontSize:"md",fontWeight:"medium",children:"People with access"}),t&&f.jsx(_d,{}),f.jsx(ke,{maxHeight:"6rem",overflow:"auto",w:"full",children:r==null?void 0:r.map(a=>{var c;return f.jsx(q2,{identification:((c=s(a.id))==null?void 0:c.email)||"",permission:a.permission},a.id)})}),f.jsx(Ie,{mr:"auto",mt:"2",fontSize:"md",fontWeight:"medium",children:"Groups with access"}),t&&f.jsx(_d,{}),f.jsx(ke,{maxHeight:"6rem",overflow:"auto",w:"full",children:e==null?void 0:e.map(a=>{var c;return f.jsx(q2,{identification:((c=o(a.id))==null?void 0:c.name)||"",permission:a.permission},a.id)})})]})},yEe=({isOpen:r,onClose:e})=>{const{users:t}=Zf(),{groups:i}=dv(),{apps:n}=Ud(),{appName:s}=Ri(),o=Ut(),[a,c]=z.useState([]),[d,l]=z.useState(""),u=n==null?void 0:n.find(b=>b.name===s),h=pEe({onSuccess:()=>{o({title:"App shared",status:"success"}),e()},onError:b=>{o({title:"Failed to share app",status:"error",description:ni(b)})}}),g=z.useMemo(()=>t.filter(b=>b.role_name==="member"||b.role_name==="user").map(b=>({name:b.email,value:b.id})),[t]),m=z.useMemo(()=>i.map(b=>({name:b.name,value:b.id})),[i]),y=[...g,...m],_=async()=>{h.mutate({appId:(u==null?void 0:u.id)||"",subjects:a,action:d})};return f.jsxs(_c,{isOpen:r,onClose:e,children:[f.jsx(wc,{}),f.jsxs(bc,{children:[f.jsx(Sc,{borderBottomWidth:"1px",children:"Share this app"}),f.jsx(jf,{}),f.jsx(Ad,{p:0,children:f.jsxs(q,{spacing:4,divider:f.jsx(Ol,{}),children:[f.jsxs(q,{p:4,children:[f.jsxs(tn,{children:[f.jsx(ir,{children:"Invitees"}),f.jsx(os,{label:"Invitees",type:"multiselect",options:y,value:a,onChange:b=>{c(b)}})]}),f.jsxs(tn,{children:[f.jsx(ir,{children:"Role"}),f.jsx(os,{type:"select",value:d,onChange:b=>{l(b)},options:[{name:"Use",value:"use"},{name:"Edit",value:"edit"},{name:"Own",value:"own"}]})]})]}),f.jsx(ke,{p:4,children:f.jsx(vEe,{})})]})}),f.jsx(Md,{borderTopWidth:"1px",children:f.jsxs(q,{direction:"row",alignItems:"center",children:[f.jsx(Qe,{variant:"ghost",onClick:()=>e(),children:"Cancel"}),f.jsx(Qe,{colorScheme:"blue",onClick:_,isLoading:h.isLoading,children:"Share"})]})})]})]})},b9=({isPreview:r})=>{const e=Ut(),t=Eo(),{appName:i,pageName:n}=Ri(),{apps:s}=Ud(),[o,a]=z.useState(0),{permissions:c}=pi({appName:i,pageName:n}),{isOpen:d,onOpen:l,onClose:u}=Ki(),[h,g]=z.useState(""),[m]=z.useState(!1),y=nEe({onError:Z=>{e({status:"error",title:"Failed to update app",description:ni(Z)})}}),_=$Se(),b=s.find(Z=>Z.name===i),E=b==null?void 0:b.pages.findIndex(Z=>Z.name===n);z.useEffect(()=>{b&&g(b==null?void 0:b.label),E!==void 0&&a(E)},[b,n,E]);const D=Z=>{var K;a(Z),(K=document.activeElement)==null||K.blur()},R=Z=>{const K=Z.target.value;g(K)},M=()=>{b&&g(b==null?void 0:b.label)},O=()=>{b&&y.mutate({appId:b.id,newLabel:h})},L=()=>{if(i){const{name:Z,label:K}=Bf({currentNames:(b==null?void 0:b.pages.map(H=>H.name))||[],prefix:"page"});_.mutate({appName:i,pageName:Z,pageLabel:K},{onSuccess:(H,C)=>{e({status:"success",title:"Page created"}),r?t(`../${C.pageName}`,{relative:"path"}):t(`../../${C.pageName}/studio`,{relative:"path"})},onError:H=>{e({status:"error",title:"Failed to create page",description:ni(H)})}})}},W=Oa();return f.jsxs(q,{alignItems:"center",h:"12",borderBottomWidth:"1px",spacing:"1",direction:"row",bg:"white",children:[f.jsx(If,{spacing:"1",children:f.jsx(Pee,{icon:f.jsx(HZ,{size:"16"}),w:"11",h:"12",colorScheme:"gray",overflow:"hidden",as:vh,to:"/apps",borderRadius:"0",variant:"ghost"})}),f.jsxs(q,{alignItems:"center",direction:"row",children:[f.jsxs(tr,{children:[f.jsxs(tr.Label,{children:[" ",b==null?void 0:b.label]}),r?null:f.jsx(tr.Code,{children:b==null?void 0:b.name})]}),r?null:f.jsx(Ir,{onClose:M,placement:"bottom-end",closeOnBlur:!1,children:({onClose:Z})=>f.jsxs(f.Fragment,{children:[f.jsx(Rr,{children:f.jsx(St,{isLoading:y.isLoading,size:"sm",variant:"ghost",colorScheme:"gray",icon:f.jsx(n_,{size:"14"}),"aria-label":"Edit app"})}),f.jsx(jr,{children:f.jsx("form",{onSubmit:W.handleSubmit(O),children:f.jsxs(tn,{isInvalid:!!m,children:[f.jsx(xs,{}),f.jsxs(Br,{children:[f.jsx(ir,{children:"Edit App Label"}),f.jsx(as,{size:"sm",placeholder:"App Label",value:h,onChange:R}),f.jsx(Ek,{children:m})]}),f.jsx(cs,{display:"flex",alignItems:"end",children:f.jsxs(vr,{ml:"auto",size:"sm",children:[f.jsx(Qe,{onClick:Z,colorScheme:"red",variant:"outline",children:"Cancel"}),f.jsx(Qe,{isDisabled:(b==null?void 0:b.label)===h||!h||!!m,colorScheme:"blue",type:"submit",children:"Update"})]})})]})})})]})})]}),f.jsx(dn,{alignItems:"center",h:"100%",justifyContent:"center",children:f.jsx(jZ,{ml:"6",variant:"unstyled",size:"sm",index:o,onChange:D,children:f.jsxs(BZ,{display:"flex",alignItems:"center",children:[b==null?void 0:b.pages.map((Z,K)=>f.jsx(rEe,{isPreview:r,index:K,tabIndex:o,page:Z,pages:b==null?void 0:b.pages},Z.name)),!r&&f.jsx(St,{size:"sm","aria-label":"Create page",onClick:L,variant:"ghost",icon:f.jsx(Xs,{size:"14"})})]})})}),f.jsxs(q,{direction:"row",spacing:"2",ml:"auto",children:[(c==null?void 0:c.own)&&f.jsx(Qe,{size:"sm",variant:"outline",onClick:l,leftIcon:f.jsx(UZ,{size:"14"}),children:"Share"}),(c==null?void 0:c.edit)&&f.jsx(Bn,{label:r?"App Studio":"App Preview",children:f.jsx(Qe,{size:"sm",variant:"secondary",colorScheme:"blue",leftIcon:r?f.jsx(n_,{size:"14"}):f.jsx(VZ,{size:"14"}),"aria-label":"Preview",ml:"auto",mr:"4",as:vh,"data-cy":"preview-toggle",to:r?"studio":"../",children:r?"Edit":"Preview"})})]}),f.jsx(yEe,{isOpen:d,onClose:u})]})},_Ee=[{title:"Make sure you have the Dropbase Worker set up.",icon:qZ,link:"https://docs.dropbase.io/setup/developer",showDocs:!0,id:"setup"},{title:"If you've set up the Dropbase Worker, see troubleshooting guide.",icon:GZ,link:"https://docs.dropbase.io/how-to-guides/troubleshoot-worker",showDocs:!0,id:"troubleshoot"},{title:f.jsxs(f.Fragment,{children:[f.jsx(ke,{as:"span",children:"Still having issues? Contact Support:"}),f.jsx(zm,{display:"inline",href:"mailto:support@driobase.io",target:"_blank",rel:"noreferrer noopener",isExternal:!0,mx:"2",children:"support@dropbase.io"})]}),icon:zZ,id:"support"}],S9=()=>{const{isConnected:r,isLoading:e,refetch:t,isFetched:i}=Bd();return r?null:e||!i?f.jsxs(_c,{isCentered:!0,size:"xl",isOpen:!0,onClose:()=>{},children:[f.jsx(wc,{}),f.jsx(bc,{children:f.jsxs(Sc,{pos:"relative",children:[f.jsxs(q,{spacing:"0",children:[f.jsx(Ie,{fontSize:"xl",children:"Checking worker connection"}),f.jsx(Ie,{fontSize:"sm",color:"gray.700",fontWeight:"medium",children:"We are trying to make sure the worker is connected with the app."})]}),f.jsx(_u,{pos:"absolute",bottom:"0",left:"0",right:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",size:"xs",width:"full",isIndeterminate:!0})]})})]}):f.jsxs(_c,{isCentered:!0,size:"xl",isOpen:!0,onClose:()=>{},children:[f.jsx(wc,{}),f.jsxs(bc,{children:[f.jsx(Sc,{borderBottomWidth:"1px",children:f.jsxs(q,{spacing:"0",children:[f.jsx(Ie,{fontSize:"xl",children:"Worker is not connected"}),f.jsx(Ie,{fontSize:"sm",color:"gray.700",fontWeight:"medium",children:"We could not make a connection to your Worker server."})]})}),f.jsxs(Ad,{p:"0",children:[f.jsx(q,{p:"5",spacing:4,children:f.jsx(q,{spacing:3,children:_Ee.map(n=>f.jsxs(q,{alignItems:"center",direction:"row",children:[f.jsx(sh,{borderWidth:"1px",size:8,children:f.jsx(Wf,{as:n.icon,size:"6",color:"blue.500"})}),f.jsxs(Ie,{children:[f.jsx(ke,{as:"span",children:n.title}),n.showDocs?f.jsx(zm,{display:"inline",href:n.link,target:"_blank",rel:"noreferrer noopener",isExternal:!0,mx:"1",children:"Docs"}):null]})]},n.id))})}),f.jsx(Md,{p:"2",borderTopWidth:"1px",children:f.jsx(Qe,{size:"sm",variant:"primary",onClick:()=>{t()},children:"Check connection"})})]})]})]})},wEe=({name:r,id:e,type:t,displayName:i,...n})=>{const s=Ut(),{appName:o,pageName:a}=Ze(nr),c=Ti(MI),{isOpen:d,onToggle:l,onClose:u}=Ki({onClose:()=>{c({type:null,id:null})}}),h=aCe({onSuccess:()=>{u(),s({status:"success",title:"Function Deleted"})},onError:m=>{s({status:"error",title:"Failed to delete function",description:ni(m)})}}),g=m=>{m==null||m.preventDefault(),h.mutate({pageName:a,appName:o,fileName:r,fileType:t})};return f.jsxs(Ir,{isOpen:d,onClose:u,placement:"bottom",closeOnBlur:!1,children:[f.jsx(Rr,{children:f.jsx(Wf,{"aria-label":"Delete function",as:Fa,onClick:m=>{m.stopPropagation(),l()},isLoading:h.isLoading,boxSize:5,p:1,color:"red.400",borderRadius:"sm",_hover:{bg:"red.100"},...n})}),f.jsx(Qm,{children:f.jsxs(jr,{children:[f.jsx(xo,{pt:4,fontWeight:"bold",fontSize:"md",border:"0",children:"Delete Function"}),f.jsx(xs,{}),f.jsx(Na,{}),f.jsxs("form",{onSubmit:g,children:[f.jsxs(Br,{fontSize:"md",children:["Are you sure you want to delete ",i,"?"]}),f.jsx(cs,{border:"0",display:"flex",justifyContent:"space-between",pb:4,children:f.jsxs(vr,{ml:"auto",size:"sm",children:[f.jsx(Qe,{onClick:u,colorScheme:"gray",variant:"ghost",children:"Cancel"}),f.jsx(Qe,{colorScheme:"red",type:"submit",isLoading:h.isLoading,children:"Delete"})]})})]})]})})]})},bEe=[{name:"SQL Data Fetcher",value:"sql",icon:r_,description:"Fetch data to tables via SQL",extension:"sql"},{name:"Python (Data Fetcher)",value:"data_fetcher",description:"Fetch data to tables via Python",icon:r_,extension:"py"},{name:"Python (UI)",value:"ui",icon:y1,description:"Modify UI via Python",extension:"py"},{name:"Python (Generic)",value:"python",icon:S1,description:"Generic Python scripts",extension:"py"}],C9=({children:r,...e})=>{const t=Ut(),i=Oa({shouldUnregister:!0}),{appName:n,pageName:s}=Ri(),{isConnected:o}=Bd(),{files:a}=pi({appName:n,pageName:s}),c=Ti(MI),{refetch:d}=a9({pageName:s||"",appName:n||""}),{isOpen:l,onToggle:u,onClose:h}=Ki({onClose:()=>{i.reset(),i.setValue("type",null)}}),g=sCe({onSuccess:(b,E)=>{c({type:(E==null?void 0:E.type)==="sql"?"sql":"function",id:E==null?void 0:E.fileName}),t({title:"File created successfully"}),d(),h()},onError:b=>{t({status:"error",title:"Failed to create file",description:ni(b)})}}),m=i.watch("type"),y=i.watch("name"),_=({type:b,name:E})=>{g.mutate({pageName:s,appName:n,fileName:E,type:b})};return z.useEffect(()=>{var b;i.setValue("name",(b=Bf({currentNames:a.map(E=>E.name),prefix:"function"}))==null?void 0:b.name)},[i,l,a]),f.jsxs(Ir,{isOpen:l,onClose:h,placement:"bottom",closeOnBlur:!1,children:[f.jsx(Rr,{children:r?r==null?void 0:r({onClick:b=>{b.stopPropagation(),u()},isDisabled:!o,isLoading:g.isLoading}):f.jsx(St,{"aria-label":"Add function","data-cy":"create-file-button",icon:f.jsx(Xs,{size:"14"}),onClick:b=>{b.stopPropagation(),u()},isDisabled:!o,isLoading:g.isLoading,...e})}),f.jsx(Qm,{children:f.jsxs(jr,{onClick:b=>{b.stopPropagation()},children:[f.jsx(xo,{pt:4,fontWeight:"bold",fontSize:"md",border:"0",children:"Create a new function"}),f.jsx(xs,{}),f.jsx(Na,{}),f.jsx(Pd,{...i,children:f.jsxs("form",{onSubmit:i.handleSubmit(_),children:[f.jsx(Br,{children:l?f.jsxs(q,{spacing:"2",children:[f.jsx(Zi,{type:"text",validation:{required:"Cannot  be empty",validate:{unique:b=>a.find(E=>E.name===b)?"Name must be unique":!0}},name:"name",id:"name"}),f.jsx(Zi,{type:"custom-select",options:bEe.map(b=>({...b,icon:null,render:E=>f.jsxs(q,{alignItems:"center",direction:"row",children:[f.jsx(Wf,{boxSize:"6",as:b.icon,flexShrink:"0",color:E?"blue.500":""}),f.jsxs(q,{spacing:"0",children:[f.jsx(Ie,{fontWeight:"medium",fontSize:"sm",children:b.name}),f.jsx(Ie,{color:"gray.600",fontSize:"xs",children:b.description})]}),f.jsxs(Mg,{textTransform:"lowercase",size:"xs",ml:"auto",colorScheme:E?"blue":"gray",children:[".",b.extension]})]})})),validation:{required:"Cannot  be empty"},name:"type",id:"type","data-cy":"file-type"}),f.jsxs(tn,{children:[f.jsx(ir,{children:"Autogenerated file"}),f.jsxs(ke,{fontFamily:"monospace",fontStyle:"italic",p:"1",w:"fit-content",bg:"gray.50",fontSize:"sm",lineHeight:1,children:[y,m==="sql"?".sql":".py"]})]})]}):null}),f.jsx(cs,{border:"0",display:"flex",alignItems:"center",justifyContent:"space-between",pb:4,children:f.jsxs(vr,{size:"sm",children:[f.jsx(Qe,{onClick:h,colorScheme:"red",variant:"outline","data-cy":"cancel-create-file",children:"Cancel"}),f.jsx(Qe,{colorScheme:"blue",type:"submit",isLoading:g.isLoading,"data-cy":"confirm-create-file",children:"Create"})]})})]})})]})})]})},SEe=({file:r})=>{const e=Ut(),[t,i]=Ji(MI),{appName:n,pageName:s}=Ri(),{files:o}=pi({appName:n,pageName:s}),{onClose:a,onOpen:c}=Ki(),{isOpen:d,onClose:l,onOpen:u}=Ki(),h=r.type==="sql",g=`${r.name}${h?".sql":".py"}`,m=r.name===t.id,[y,_]=z.useState(r.name),b=h?"teal":"purple";let E=S1;switch(r.type){case"data_fetcher":case"sql":E=r_;break;case"ui":E=y1;break}const D=dCe({onSuccess:()=>{l(),e({status:"success",title:"File Updated"})},onError:L=>{e({status:"error",title:"Failed to delete table",description:ni(L)})}}),R=L=>o.find(W=>W.name===L&&W.name!==r.name),M=()=>{if(R(y)){e({status:"error",title:"File name must be unique"});return}y.trim()?D.mutate({pageName:s,appName:n,fileName:r.name,newFileName:y,fileType:r.type}):e({status:"error",title:"File name is required"})},O=L=>{L.key==="Escape"?l():L.key==="Enter"&&(L==null||L.preventDefault(),M())};return f.jsx(q,{onMouseEnter:c,onMouseLeave:a,onMouseOver:c,onDoubleClick:u,as:"button",bg:m?"gray.50":"white",p:"2",fontSize:"sm",borderWidth:m?"1px":"0",justifyContent:"start",borderRadius:"sm",_hover:{bg:"gray.50",color:"gray.800"},color:m?"gray.900":"gray.700",onClick:()=>{i({type:h?"sql":"function",id:r.name})},children:d?f.jsxs(q,{flex:"1",direction:"row",justify:"flex-end",w:"full",children:[f.jsx(as,{value:y,variant:"outline",autoFocus:!0,placeholder:"Enter new name",_focus:{bg:"white"},defaultValue:r.name,onKeyDown:O,onChange:L=>_(L.target.value),size:"xs"}),f.jsx(St,{"aria-label":"Cancel rename",icon:f.jsx(ik,{size:"sm"}),onClick:l,boxSize:5,p:1,borderRadius:"sm",background:"transparent",color:"black",_hover:{bg:"gray.100"},size:"sm",minWidth:0}),f.jsx(St,{"aria-label":"Rename function",icon:f.jsx(ON,{size:"sm"}),onClick:M,isLoading:D.isLoading,boxSize:5,p:1,borderRadius:"sm",background:"transparent",color:"black",_hover:{bg:"green.100"},size:"sm",minWidth:0})]}):f.jsxs(q,{flex:"1",w:"full",alignItems:"center",direction:"row",children:[f.jsx(Wf,{color:m?`${b}.500`:"",as:E,boxSize:4}),f.jsx(ke,{fontWeight:m?"medium":"normal",overflow:"hidden",whiteSpace:"nowrap",children:r.name}),f.jsx(ke,{fontSize:"2xs",px:"1",borderRadius:"sm",bg:`${b}.200`,children:h?".sql":".py"}),f.jsx(KZ,{}),m?f.jsxs(q,{direction:"row",justify:"flex-end",children:[f.jsx(St,{"aria-label":"Rename function",icon:f.jsx(QZ,{size:"sm"}),onClick:L=>{L.stopPropagation(),u()},isLoading:D.isLoading,boxSize:5,p:1,borderRadius:"sm",background:"transparent",color:"black",_hover:{bg:"gray.100"},size:"sm",minWidth:0}),f.jsx(wEe,{w:"fit-content",ml:"auto",id:r.name,name:r.name,type:r.type,displayName:g})]}):null]})},r.name)},CEe=()=>{const{appName:r,pageName:e}=Ri(),{files:t,isLoading:i}=pi({appName:r,pageName:e});return!Q6()||i?f.jsx(q,{borderBottomWidth:"1px",bg:"white",p:"2",children:f.jsxs(q,{children:[f.jsx(hi,{h:"7",w:"32"}),f.jsx(hi,{h:"7",w:"32"}),f.jsx(hi,{h:"7",w:"32"})]})}):(t==null?void 0:t.length)===0?f.jsxs(mo,{spacing:"0.5",as:q,children:[f.jsx(Ie,{fontSize:"md",fontWeight:"semibold",children:"No files present"}),f.jsx(zm,{fontSize:"sm",href:"https://docs.dropbase.io/concepts/studio/",isExternal:!0,children:"Learn more"}),f.jsx(C9,{children:s=>f.jsx(Qe,{mt:"2",variant:"outline",colorScheme:"gray",size:"sm",flexShrink:"0",...s,children:f.jsxs(q,{alignItems:"center",justifyContent:"center",direction:"row",children:[f.jsx(Xs,{size:"14"}),f.jsx(ke,{children:"New File"})]})})})]}):f.jsx(q,{spacing:"0",h:"full",children:(t||[]).sort((s,o)=>s.name.localeCompare(o.name)).map(s=>f.jsx(SEe,{file:s},s.name))})},G2=({children:r})=>f.jsx(ke,{flexShrink:"0",fontSize:"sm",fontWeight:"semibold",children:r}),EEe=()=>{const{pageName:r,appName:e}=Ze(nr),{isRefetching:t,refetch:i}=BW(e||"",r||"");return f.jsxs(YZ,{h:"full",overflowY:"auto",defaultIndex:[0,1],allowMultiple:!0,children:[f.jsx(zH,{borderTopWidth:"0",children:({isExpanded:n})=>f.jsxs(f.Fragment,{children:[f.jsxs(KH,{borderBottomWidth:n?"1px":"0",px:"2",flex:"1",children:[f.jsx(G2,{children:"Files"}),f.jsx(C9,{variant:"outline",size:"2xs",ml:"auto",colorScheme:"gray"})]}),f.jsx(QH,{p:2,children:f.jsx(CEe,{})})]})}),f.jsxs(zH,{children:[f.jsxs(KH,{px:"2",flex:"1",children:[f.jsx(G2,{children:"State & Context"}),f.jsx(Bn,{label:"Re-sync state & context data",children:f.jsx(St,{flexShrink:"0",ml:"auto","aria-label":"Re-sync state & context data",size:"2xs",colorScheme:"gray",icon:f.jsx(kk,{size:"12"}),variant:"outline",isLoading:t,onClick:n=>{n.stopPropagation(),i()}})})]}),f.jsx(QH,{borderTopWidth:"1px",p:"1",children:f.jsx(zSe,{})})]})]})},E9="executable",x9="main.py",xEe=r=>{let e="";return r!=null&&r.stdout&&r.stdout!==`
`&&(e=r.stdout),r!=null&&r.traceback&&(e&&(e+=`
`),e+=`---------------------------------------------------------------------------------
`,e+=r.traceback),r!=null&&r.result&&typeof(r==null?void 0:r.result)!="object"&&(e&&(e+=`
`),e+=r.result),e},PN=r=>{const e=/^def\s+(?<call>(?<name>\w*)\s*\((?<params>[\S\s]*?)\)(?:\s*->\s*[\S\s]+?|\s*)):/gm;return[...r.matchAll(e)].map(t=>t.groups).map(t=>({...t,call:`${t.name}(${t.params.split(",").map(i=>{const n=`${i.split(":")[0].trim()}`;return n==="user_input"||n==="state"||n==="context"||n==="tables"||!n?n:`${n}=`})})`}))},DEe=(r,e,t)=>{if(r.uri.scheme===E9&&r.uri.path===x9){const i=r.getWordUntilPosition(e),n={startLineNumber:e.lineNumber,endLineNumber:e.lineNumber,startColumn:i.startColumn,endColumn:i.endColumn};return{suggestions:t.map(s=>({label:`${s.name}`,kind:Ws.CompletionItemKind.Function,documentation:`Function call for ${s.name}`,insertText:`${s.call}`,range:n}))}}return{suggestions:[]}},kEe=({code:r,filePath:e,updateCode:t,name:i})=>{const[n,s]=z.useState(r),o=Ti(LI),a=z.useCallback(()=>{o({name:i,code:n,execute:!0})},[n,i,o]),c=jbe({filepath:e,code:n,onChange:d=>{s(d),t(d)}});return f.jsxs(q,{h:"full",spacing:"0",direction:"row",children:[f.jsx(St,{mx:"1","aria-label":"Run function",size:"2xs",mt:"2",flexShrink:"0",colorScheme:"gray",variant:"outline",borderRadius:"md",icon:f.jsx(C1,{size:12}),onClick:a}),f.jsx(ke,{"data-cy":`code-editor-${i}`,ref:c,pt:"2",borderLeftWidth:"1px",flex:"1",h:"full",as:"div",w:"full"})]})},TEe=({name:r})=>{const e=Li(),t=Ut(),{appName:i,pageName:n}=Ri(),{files:s,tables:o}=pi({appName:i,pageName:n}),{files:a,isLoading:c}=a9({pageName:n||"",appName:i||""}),d=s.find(K=>K.name===r),l=d?`${d==null?void 0:d.name}${(d==null?void 0:d.type)==="sql"?".sql":".py"}`:null,u=Ti(LI),h=a.find(K=>K.endsWith(`/${l}`)),{isLoading:g,code:m,refetch:y,isRefetching:_}=c9({pageName:n,appName:i,fileName:l}),[b,E]=z.useState(m||""),[D,R]=z.useState([]),M=o9({onSuccess:()=>{t({status:"success",title:"Updated code"}),y()},onError:K=>{t({status:"error",title:"Failed to update code",description:ni(K)})}}),O=()=>{M.mutate({pageName:n,appName:i,fileName:r,code:b,fileType:d==null?void 0:d.type,depends:D})};z.useEffect(()=>{E(m)},[r,m]),z.useEffect(()=>{R(d==null?void 0:d.depends_on)},[d]),z.useEffect(()=>{u({name:r,code:b,execute:!1})},[b,r,u]),z.useEffect(()=>()=>{u({name:null,code:null,execute:!1})},[r,m,u]);const L=()=>{O(),e.invalidateQueries(av),e.invalidateQueries(VW)};if(g||c)return f.jsxs(q,{p:"3",spacing:"2",children:[f.jsx(hi,{startColor:"gray.200",endColor:"gray.300",h:"32"}),f.jsxs(q,{direction:"row",children:[f.jsx(zG,{h:"10",w:"10"}),f.jsx(hi,{startColor:"gray.200",w:"full",endColor:"gray.300",h:"10"})]})]});const W=PN(b),Z=(d==null?void 0:d.type)==="data_fetcher"||(d==null?void 0:d.type)==="ui"?!W.find(K=>K.name===d.name):!1;return f.jsxs(q,{h:"full",bg:"white",spacing:"0",divider:f.jsx(Ol,{}),w:"full",children:[f.jsxs(q,{p:"2",direction:"row",alignItems:"center",justifyContent:"space-between",children:[f.jsx(Ie,{fontSize:"md",fontWeight:"semibold",children:l}),f.jsxs(q,{alignItems:"center",direction:"row",children:[f.jsx(St,{"aria-label":"Reload file",flexShrink:"0",colorScheme:"gray",size:"sm",variant:"outline",icon:f.jsx(kk,{size:12}),onClick:()=>{y()},isLoading:_}),f.jsx(Qe,{w:"fit-content",onClick:L,variant:"outline",colorScheme:"gray",size:"sm",isDisabled:m===b&&JSON.stringify(D)===JSON.stringify(d==null?void 0:d.depends_on),leftIcon:f.jsx(Hf,{size:"14"}),children:"Update"})]})]}),!c&&b&&Z?f.jsxs(jG,{flexShrink:"0",status:"error",children:[f.jsx(BG,{}),f.jsx(UG,{children:"Please make sure function name matches with the file name"})]}):null,(d==null?void 0:d.type)==="data_fetcher"?f.jsx(q,{p:"3",borderBottomWidth:"1px",alignItems:"start",direction:"row",children:f.jsxs(tn,{children:[f.jsx(ir,{children:f.jsxs(q,{direction:"row",alignItems:"center",children:[f.jsx(Ie,{children:"Refetch on row change in table…"}),f.jsx(Bn,{label:"Select table for which a row change triggers this function to refetch",fontSize:"sm",children:f.jsx(Kw,{size:"10"})})]})}),f.jsx(os,{type:"multiselect",id:"depends",maxW:"lg",name:"Depends on",placeholder:"Select table(s)",options:o.map(K=>({name:K.name,value:K.name})),value:D,onChange:K=>{R(K)}})]})}):null,f.jsx(ke,{overflowY:"auto",h:"full",children:_?f.jsx(hi,{startColor:"gray.100",endColor:"gray.400",h:"full"}):f.jsx(kEe,{code:m,name:r,updateCode:E,filePath:h},r)})]})},IEe=({name:r})=>{const e=Ut(),{appName:t,pageName:i}=Ri(),{files:n,tables:s}=pi({appName:t,pageName:i}),o=n.find(W=>W.name===r),a=o==null?void 0:o.name,[c,d]=z.useState(),l=o?`${a}.${o==null?void 0:o.type}`:null,{isLoading:u,code:h,refetch:g,isRefetching:m}=c9({pageName:i,appName:t,fileName:l}),y=Ti(LI),[_,b]=z.useState(""),{sources:E,isLoading:D}=mCe();z.useEffect(()=>{d(o==null?void 0:o.source)},[d,o]),z.useEffect(()=>{b(h)},[h,r]),z.useEffect(()=>(y({name:r,code:_,source:c,execute:!1}),()=>{y({name:null,code:null,source:null,execute:!1})}),[r,_,c,y]);const R=()=>{y({name:r,code:_,source:c,execute:!0})},M=o9({onSuccess:()=>{e({status:"success",title:"Updated SQL"}),g()},onError:W=>{e({status:"error",title:"Failed to update SQL",description:ni(W)})}}),O=()=>{M.mutate({pageName:i,appName:t,fileName:a,code:_,source:c,fileType:o==null?void 0:o.type})},L=Ze(Ba);return Uee(Nee,L),u||D?f.jsxs(q,{p:"3",spacing:"2",children:[f.jsx(hi,{startColor:"gray.200",endColor:"gray.300",h:"32"}),f.jsxs(q,{direction:"row",children:[f.jsx(zG,{h:"10",w:"10"}),f.jsx(hi,{startColor:"gray.200",w:"full",endColor:"gray.300",h:"10"})]})]}):f.jsxs(q,{bg:"white",h:"full",overflowY:"auto",overflowX:"hidden",spacing:"0",children:[f.jsxs(q,{spacing:"3",children:[f.jsxs(q,{p:"2",borderBottomWidth:"1px",direction:"row",alignItems:"center",justifyContent:"space-between",children:[f.jsx(Ie,{fontSize:"md",fontWeight:"semibold",children:l}),f.jsxs(q,{alignItems:"center",direction:"row",children:[f.jsx(St,{"aria-label":"Reload file",flexShrink:"0",colorScheme:"gray",size:"sm",variant:"outline",icon:f.jsx(kk,{size:12}),onClick:()=>{g()},isLoading:m}),f.jsx(Qe,{w:"fit-content",isLoading:M.isLoading,onClick:O,variant:"outline",colorScheme:"gray",size:"sm",isDisabled:!c||!_||_===h&&(o==null?void 0:o.source)===c,leftIcon:f.jsx(Hf,{size:"14"}),children:"Update"})]})]}),f.jsxs(q,{direction:"row",px:"3",pb:"3",borderBottomWidth:"1px",alignItems:"start",children:[f.jsxs(tn,{children:[f.jsx(ir,{children:f.jsxs(q,{direction:"row",alignItems:"center",children:[f.jsx(Ie,{children:"Source"}),f.jsx(ke,{as:"span",color:"red.500",children:"*"})]})}),f.jsx(os,{size:"sm",maxW:"lg",type:"select",placeholder:"Sources",value:c,options:E==null?void 0:E.map(W=>({name:W,value:W})),onChange:W=>{d(W)}})]}),f.jsxs(tn,{children:[f.jsx(ir,{children:f.jsxs(q,{direction:"row",alignItems:"center",children:[f.jsx(Ie,{children:"Refetch on row change in table…"}),f.jsx(Bn,{label:"Select table for which a row change triggers this function to refetch",fontSize:"sm",children:f.jsx(Kw,{size:"10"})})]})}),f.jsx(os,{type:"multiselect",id:"depends",maxW:"lg",name:"Depends on",placeholder:"Select table(s)",options:s.map(W=>({name:W.name,value:W.name})),value:(o==null?void 0:o.depends_on)||[]})]})]})]}),f.jsxs(q,{h:"full",spacing:"0",direction:"row",children:[f.jsx(St,{mx:"1","aria-label":"Run function",size:"2xs",mt:"2",flexShrink:"0",colorScheme:"gray",variant:"outline",borderRadius:"md",icon:f.jsx(C1,{size:12}),onClick:R}),f.jsx(ke,{h:"full",pt:"2",w:"full",borderLeftWidth:"1px",children:f.jsx(Gw,{value:_,onChange:b,language:"sql"})})]})]})},REe=({columns:r,rows:e,...t})=>f.jsx(XZ,{overflow:"auto",overflowY:"auto",children:f.jsxs(cf,{borderLeftWidth:"1px",borderRightWidth:"1px",w:"full",overflow:"auto",h:"full",...t,children:[f.jsx(df,{children:f.jsx(_o,{children:r.map(i=>f.jsx(xr,{color:"heading",children:i},i))})}),f.jsx(lf,{overflow:"auto",children:e.map(i=>f.jsx(_o,{children:i.map(n=>f.jsx(Wn,{children:typeof n=="object"||typeof n=="boolean"?JSON.stringify(n):n},JSON.stringify({row:i,cell:n})))},JSON.stringify(i)))})]})}),PEe=({panelRef:r})=>{var le,Me;const[{code:e,name:t,source:i,execute:n},s]=Ji(LI),o=Ut(),{appName:a,pageName:c}=Ri(),{files:d,isLoading:l}=pi({appName:a,pageName:c}),u=d.find(Re=>Re.name===t),h=nk(),[g,m]=z.useState(""),[y,_]=z.useState(null),[b,E]=z.useState(null),[D,R]=z.useState(null),[M,O]=z.useState(16),L=Ze(Ba),W=UW(),Z=()=>{_(null),E(null),R(null)};z.useEffect(()=>{Z();const Re=`${a}_${c}_${t}`,Oe=sessionStorage.getItem(Re);m(Oe!==null?Oe:"")},[t,a,c]),z.useEffect(()=>{if(t&&g!==null){const Re=`${a}_${c}_${t}`;sessionStorage.setItem(Re,g)}},[g,t,a,c]);const K={onSuccess:Re=>{var Oe,Ge;W(Re),_(xEe(Re)),R(Re==null?void 0:Re.type),((Oe=r==null?void 0:r.current)==null?void 0:Oe.getSize())<20&&((Ge=r==null?void 0:r.current)==null||Ge.resize(70)),Re!=null&&Re.columns&&E({rows:(Re==null?void 0:Re.data)||[],columns:(Re==null?void 0:Re.columns)||[]})},onMutate:()=>{Z()},onError:Re=>{o({status:"error",title:"Failed to run query",description:ni(Re)})}},H=eCe({...K}),C=XSe({...K});z.useEffect(()=>{if(!h||(u==null?void 0:u.type)==="sql")return()=>{};const{dispose:Re}=h.languages.registerCompletionItemProvider("python",{triggerCharacters:[".",'"'],provideCompletionItems:(Oe,Ge)=>DEe(Oe,Ge,PN(e))});return()=>{Re()}},[h,u,e]);const B=z.useCallback(()=>{var Re;if(g)H.mutate({pageState:L,testCode:g,fileCode:e});else{const Ge=((Re=PN(e).find(xe=>(xe==null?void 0:xe.name)===(u==null?void 0:u.name)))==null?void 0:Re.call)||"";m(Ge),H.mutate({pageState:L,testCode:Ge,fileCode:e})}},[e,u,L,H,g]),te=z.useCallback(()=>{C.mutate({pageName:c,appName:a,state:L.state,fileName:u==null?void 0:u.name,fileContent:e,source:i})},[c,a,L,u,e,i,C]),ue=z.useCallback(()=>{u&&!H.isLoading&&!C.isLoading&&(s(Re=>({...Re,execute:!1})),(u==null?void 0:u.type)==="sql"?te():B())},[u,s,H,C,B,te]);z.useEffect(()=>{n&&ue()},[n,ue]);const be=H.isLoading||C.isLoading,de=Re=>{Re.onDidContentSizeChange(Oe=>{const Ge=Oe.contentHeight;O(Ge),Re.layout()})};return f.jsxs(q,{w:"full",h:"full",spacing:"1",children:[f.jsx(q,{bg:"gray.50",px:"2",py:"1",borderBottomWidth:"1px",children:f.jsx(Ie,{fontWeight:"medium",fontSize:"sm",children:"Test Code"})}),f.jsxs(q,{borderBottomWidth:"1px",bg:"white",pb:"3",spacing:"0",alignItems:"start",direction:"row",mb:0,children:[f.jsx(St,{icon:f.jsx(C1,{size:"12"}),mx:"1","aria-label":"Run function",size:"2xs",mt:"2",flexShrink:"0",colorScheme:"gray",variant:"outline",borderRadius:"md",isLoading:be,onClick:(u==null?void 0:u.type)==="sql"?te:B,isDisabled:(u==null?void 0:u.type)==="sql"?!(e&&i):!g}),(u==null?void 0:u.type)==="sql"?f.jsx(Ie,{py:"1",px:"4",color:"gray.700",fontSize:"sm",mt:"2",children:"Click play to see query results"}):f.jsx(Gw,{value:g,onChange:m,language:"python",path:`${E9}:${x9}`,onMount:de,height:M})]}),f.jsxs(q,{h:"full",overflowY:"auto",children:[y?f.jsx(q,{borderBottomWidth:"1px",bg:"white",p:"2",w:"full",h:"full",borderRadius:"sm",children:f.jsxs(q,{h:"full",direction:"row",alignItems:"start",children:[f.jsx(St,{"aria-label":"Close output",size:"xs",colorScheme:"gray",variant:"outline",borderRadius:"full",icon:f.jsx(ik,{size:14}),onClick:()=>_(null)}),f.jsxs(q,{w:"full",h:"full",children:[f.jsx(Ie,{fontSize:"sm",letterSpacing:"wide",fontWeight:"medium",children:"Output"}),f.jsx(ke,{borderWidth:"1px",borderColor:"blackAlpha.100",borderRadius:"sm",h:"full",children:f.jsx(Gw,{value:y,language:"shell",options:{lineNumbers:"off",readOnly:!0}})})]})]})}):null,D==="table"&&((le=b==null?void 0:b.columns)==null?void 0:le.length)>0?f.jsx(ke,{px:"3",w:"full",mt:"3",pb:"3",borderBottomWidth:"1px",children:f.jsx(REe,{...b,columns:(Me=b==null?void 0:b.columns)==null?void 0:Me.map(Re=>Re.name),maxH:"md",borderRadius:"sm"})}):null]})]})},AEe={function:TEe,sql:IEe},MEe=()=>{const{appName:r,pageName:e}=Ri(),{files:t,isLoading:i}=pi({appName:r,pageName:e}),n=z.useRef(null),s=Q6(),[o,a]=Ji(MI);if(z.useEffect(()=>()=>{a({type:null,id:null})},[a]),!s||i)return f.jsx(q,{borderBottomWidth:"1px",bg:"white",p:"2",children:f.jsxs(q,{direction:"row",children:[f.jsx(hi,{h:"7",w:"32"}),f.jsx(hi,{h:"7",w:"32"}),f.jsx(hi,{h:"7",w:"32"})]})});const c=AEe[o.type];return f.jsxs(Hp,{direction:"vertical",children:[f.jsx(No,{children:f.jsx(ke,{h:"full",overflowX:"hidden",overflowY:"auto",children:c?f.jsx(c,{name:o.id}):f.jsx(mo,{p:"4",h:"full",children:f.jsx(Ie,{fontSize:"md",fontWeight:"medium",children:t.length>0?"Select a file":"Create a File"})})})}),f.jsx(ig,{direction:"horizontal"}),f.jsx(No,{ref:n,defaultSize:11,maxSize:75,minSize:10,children:f.jsx(PEe,{panelRef:n})})]})},LEe=()=>{const{appName:r,pageName:e}=Ri(),t=Eo(),i=Ut(),{isLoading:n}=i9(),s=MN(),o=Ti(Io),{permissions:a,isLoading:c}=pi({appName:r,pageName:e});return z.useEffect(()=>()=>{o({id:null,type:null,meta:null})},[o]),!c&&!(a!=null&&a.edit)&&(i({title:"Unauthorized",description:"You do not have permission to edit this page.",status:"error"}),t(`/apps/${r}/${e}`)),f.jsxs(q,{spacing:"0",h:"full",children:[f.jsx(b9,{}),f.jsx(ke,{h:"full",w:"full",overflowY:"auto",children:f.jsxs(Hp,{direction:"horizontal",children:[f.jsx(No,{children:f.jsxs(Hp,{autoSaveId:"main-panel",direction:"vertical",children:[f.jsx(ke,{as:No,p:4,bg:"gray.50",defaultSize:45,children:f.jsxs(ke,{as:Hp,borderWidth:"1px",borderRadius:"lg",autoSaveId:"data-panel",boxShadow:`0 0px 5px ${s.colors.blackAlpha[300]}`,direction:"horizontal",children:[f.jsx(No,{defaultSize:80,minSize:10,children:f.jsx(Al,{isLoading:n,children:f.jsx(w9,{})})}),f.jsx(ig,{direction:"vertical"}),f.jsx(No,{minSize:10,children:f.jsx(Al,{isLoading:n,children:f.jsx(y9,{})})})]})}),f.jsx(ig,{direction:"horizontal"}),f.jsx(No,{children:f.jsxs(Hp,{autoSaveId:"dev-panel",direction:"horizontal",children:[f.jsx(No,{defaultSize:20,children:f.jsx(Al,{isLoading:n,children:f.jsx(EEe,{})})}),f.jsx(ig,{direction:"vertical"}),f.jsx(No,{children:f.jsx(Al,{isLoading:n,children:f.jsx(MEe,{})})})]})})]})}),f.jsx(ig,{style:{cursor:"auto",pointerEvents:"none"},direction:"vertical"}),f.jsx(No,{defaultSize:15,maxSize:15,minSize:15,children:f.jsx(qEe,{})})]})}),f.jsx(S9,{})]})},eH=z.forwardRef(({children:r,noPadding:e,id:t,meta:i,type:n,...s},o)=>{const{isOpen:a,onOpen:c,onClose:d}=Ki(),[l,u]=Ji(Io),{isPreview:h}=Ze(Zo),g=t===l.id&&l.type===n,m=a||g,y=_=>{_.stopPropagation(),u({id:t,type:n,meta:i})};return!t||!n||h?r:f.jsxs(ke,{ref:o,onMouseEnter:c,onMouseOver:c,onMouseLeave:d,onClick:y,...s,pos:"relative",children:[r,f.jsx(ke,{outline:"2px solid",borderRadius:"sm",borderWidth:"5px",borderColor:"gray.50",outlineColor:g?"blue.500":"gray.500",pos:"absolute",top:"-5px",left:"-5px",w:"calc(100% + 10px)",h:"calc(100% + 10px)",shadow:"md",pointerEvents:"none",transition:"all ease .2s",opacity:m?"1":"0"})]})}),FEe=r=>{const e=Ut(),t=Oa({shouldUnregister:!0}),{pageName:i,appName:n}=Ri(),s=Ze(zw),{isConnected:o}=Bd(),{properties:a}=pi({appName:n,pageName:i}),{columns:c}=Co(s||""),{isOpen:d,onClose:l,onToggle:u}=Ki({onClose:()=>{t.reset()}}),{fields:h}=Cb(),g=h==null?void 0:h.button_column,m=Vr({onSuccess:()=>{e({title:"Created virtual column"}),l()},onError:_=>{e({status:"error",title:"Failed to create virtual column",description:ni(_)})}}),y=_=>{m.mutate({app_name:n,page_name:i,properties:{...a||{},blocks:((a==null?void 0:a.blocks)||[]).map(b=>b.name===s?{...b,columns:[...(b==null?void 0:b.columns)||[],{..._,column_type:"button_column"}]}:b)}})};return f.jsxs(Ir,{isOpen:d,onClose:l,placement:"bottom",closeOnBlur:!1,children:[f.jsx(Rr,{children:f.jsx(Qe,{variant:"ghost",size:"sm",flexShrink:"0",mr:"auto",onClick:u,isDisabled:!o,isLoading:m.isLoading,...r,children:f.jsxs(q,{alignItems:"center",justifyContent:"center",direction:"row",children:[f.jsx(Xs,{size:"14"}),f.jsx(ke,{children:"Add Action Column"})]})})}),f.jsx(Qm,{children:f.jsxs(jr,{onClick:_=>{_.stopPropagation()},children:[f.jsx(xo,{pt:4,fontWeight:"bold",fontSize:"md",border:"0",children:"Create a new action column"}),f.jsx(xs,{}),f.jsx(Na,{}),f.jsx(Pd,{...t,children:f.jsxs("form",{onSubmit:t.handleSubmit(y),children:[f.jsx(Br,{children:d?f.jsx(q,{spacing:"2",children:f.jsx(q,{children:g.filter(_=>_.name==="label"||_.name==="name").map(_=>{if((_==null?void 0:_.name)==="label")return z.createElement(Zi,{..._,id:_.name,name:"Button Label",key:_.name});if((_==null?void 0:_.name)==="name")return f.jsx(Zi,{..._,id:_.name,name:"Column Name",validation:{required:"Cannot  be empty",validate:{unique:E=>c.find(D=>D.name===E)?"Name must be unique":!0}}});if(_.name==="on_click"||_.name==="on_change")return f.jsx(XW,{id:_.name});const b=_.type==="function";return z.createElement(Zi,{..._,id:_.name,name:_.title,type:b?"select":_.type,options:(_.enum||_.options||[]).map(E=>({name:E,value:E})),key:_.name})})})}):null}),f.jsx(cs,{border:"0",display:"flex",alignItems:"center",justifyContent:"space-between",pb:4,children:f.jsxs(vr,{size:"sm",children:[f.jsx(Qe,{onClick:l,colorScheme:"red",variant:"outline",children:"Cancel"}),f.jsx(Qe,{colorScheme:"blue",type:"submit",isLoading:m.isLoading,children:"Create"})]})})]})})]})})]})},z2={text:["text","select"],integer:["integer","currency"],float:["float","currency"],currency:["integer","float","currency"],select:["text","select"]},K2=["table_name","primary_key","foreign_key","default","column_type","nullable","unique"],vP={pgcolumn:["display_type"],snowflakecolumn:["display_type"],mysqlcolumn:["display_type"],sqlitecolumn:["display_type"],button_column:["on_click","label","name","display_type","color"],pycolumn:["display_type"]},OEe=r=>z2[r]?z2[r]:[r],NEe=({tableType:r,edit_keys:e,configurations:t,display_type:i,on_click:n,label:s,name:o,color:a,...c})=>{const d=Ut(),l=Ze(zw),{appName:u,pageName:h}=Ri(),g=Oa(),{watch:m,setValue:y,formState:{isDirty:_},reset:b}=g,{properties:E}=pi({appName:u,pageName:h}),D=Ze(zw),{columns:R}=Co(D||""),{isOpen:M,onToggle:O}=Ki(),{isOpen:L,onToggle:W}=Ki(),{fields:Z}=Cb();let K="";(c==null?void 0:c.column_type)==="button_column"?K="button_column":(c==null?void 0:c.column_type)==="postgres"?K="pgcolumn":(c==null?void 0:c.column_type)==="snowflake"?K="snowflakecolumn":(c==null?void 0:c.column_type)==="mysql"?K="mysqlcolumn":(c==null?void 0:c.column_type)==="sqlite"&&(K="sqlitecolumn");const H=(Z==null?void 0:Z[K])||[],C=m("display_type"),B=(Z==null?void 0:Z.display_type_configurations)||[],te=(B==null?void 0:B.find(je=>je.name===C))||{},ue=(te==null?void 0:te.properties)||{},be=vP==null?void 0:vP[K],de=K==="button_column";z.useEffect(()=>{y("configurations",t,{shouldDirty:!1,shouldTouch:!1}),t!=null&&t.options&&y("configurations.options",t.options,{shouldDirty:!1,shouldTouch:!1}),y("display_type",i,{shouldTouch:!1,shouldDirty:!1}),y("color",a,{shouldDirty:!1,shouldTouch:!1}),y("on_click",n,{shouldTouch:!1,shouldDirty:!1}),y("label",s,{shouldDirty:!1,shouldTouch:!1}),y("name",o,{shouldTouch:!1,shouldDirty:!1})},[i,t,n,s,o,a,y,b]);const le=Vr({onSuccess:()=>{d({status:"success",title:"Updated column properties"})},onError:je=>{d({status:"error",title:"Failed to update properties",description:ni(je)})}}),Me=async je=>{var et,Qt;try{const ct={...E||{},blocks:((E==null?void 0:E.blocks)||[]).map(dt=>dt.name===l?{...dt,columns:((dt==null?void 0:dt.columns)||[]).map(xi=>xi.name===o?{...xi,...c,...je}:xi)}:dt)};await le.mutateAsync({app_name:u,page_name:h,properties:ct});const ai=((Qt=(et=((E==null?void 0:E.blocks)||[]).find(dt=>dt.name===l))==null?void 0:et.columns)==null?void 0:Qt.find(dt=>dt.name===o))||{};b(ai,{keepDirty:!1,keepDirtyValues:!1})}catch{}},Re=async je=>{try{await le.mutateAsync({app_name:u,page_name:h,properties:{...E||{},blocks:((E==null?void 0:E.blocks)||[]).map(et=>et.name===l?{...et,columns:((et==null?void 0:et.columns)||[]).filter(Qt=>Qt.name!==je)}:et)}})}catch{}},Oe=je=>{const et=(B==null?void 0:B.find(ct=>ct.name===je))||{},Qt=(et==null?void 0:et.properties)||{};if(et!=null&&et.properties){const ct=Object.keys(Qt).reduce((ai,dt)=>{var xi;return{...ai,[dt]:(xi=Qt==null?void 0:Qt[dt])==null?void 0:xi.default}},{});y("configurations",ct)}else y("configurations",null)},Ge=je=>{Me(je)},xe=(e==null?void 0:e.length)===0;let Kt;return(c==null?void 0:c.column_type)==="postgres"||(c==null?void 0:c.column_type)==="snowflake"?Kt=H.filter(je=>["schema_name",...K2].includes(je.name))||[]:Kt=H.filter(je=>K2.includes(je.name))||[],f.jsx("form",{onSubmit:g.handleSubmit(Ge),children:f.jsx(Pd,{...g,children:f.jsxs(q,{spacing:"0",borderBottomWidth:M?"1px":"0",borderTopWidth:M?"1px":"0",children:[f.jsxs(q,{py:"2",px:"3",direction:"row",alignItems:"center",_hover:{bg:"gray.50"},cursor:"pointer",gap:3,onClick:O,children:[f.jsx(ke,{alignSelf:"center",overflow:"hidden",width:"50%",children:f.jsx(Bn,{placement:"left-end",label:o,children:f.jsx(Cc,{h:"full",as:Ie,isTruncated:!0,bg:"transparent",whiteSpace:"nowrap",display:"inline",w:"full",overflow:"hidden",lineHeight:1,textOverflow:"ellipsis",children:o})})}),de?f.jsx(ke,{width:"20%"}):f.jsx(Bn,{label:xe?"Not editable":"",children:f.jsx(q,{direction:"row",width:"20%",children:f.jsx(os,{type:"boolean",isDisabled:r!=="sql"||xe||le.isLoading,id:"editable",value:c.editable,onChange:je=>{Me({editable:je})}})})}),f.jsx(q,{align:"center",justify:"space-between",direction:"row",width:"20%",children:f.jsx(os,{type:"boolean",id:"hidden",isDisabled:le.isLoading,value:c.hidden,onChange:je=>{Me({hidden:je})}})}),f.jsx(q,{children:f.jsx(ke,{as:"button",border:"0",cursor:"pointer",p:"1",type:"button",borderRadius:"sm",children:M?f.jsx(Ag,{size:"14"}):f.jsx(qG,{size:"14"})})})]}),f.jsx(UP,{in:M,children:f.jsxs(q,{p:"3",children:[H.filter(je=>be==null?void 0:be.includes(je==null?void 0:je.name)).map(je=>je.name==="display_type"?f.jsx(Zi,{type:"custom-select",id:je.name,name:je.title,w:"50%",hideClearOption:!0,options:OEe(C).map(et=>({name:et,value:et})),onSelect:Oe}):(je==null?void 0:je.category)==="Events"?f.jsx(XW,{id:je.name}):je.name==="name"?f.jsx(Zi,{...je,id:je.name,name:je.title,validation:{required:"Cannot  be empty",validate:{unique:et=>R.filter(Qt=>Qt.name!==o).find(Qt=>Qt.name===et)?"Name must be unique":!0}}}):z.createElement(Zi,{...je,id:je.name,name:je.title,options:(je.enum||je.options||[]).map(et=>({name:et,value:et})),key:je.name})),Object.keys(ue).length>0?f.jsx(i_,{py:"2",gap:4,columns:2,children:Object.keys(ue).filter(je=>{var et;return((et=ue==null?void 0:ue[je])==null?void 0:et.category)!=="Internal"}).map(je=>{var ct;const et=ue==null?void 0:ue[je],Qt=(ct=te==null?void 0:te.required)==null?void 0:ct.includes(je);return f.jsx(ke,{gridColumn:et.type==="array"?"1 / -1":"",children:f.jsx(Zi,{type:et==null?void 0:et.type,id:`configurations.${je}`,name:et==null?void 0:et.title,keys:je==="options"?["name","value"]:null,options:(et.enum||et.options||[]).map(ai=>({name:ai,value:ai})),required:Qt,validation:Qt?{required:`${je} is required`}:{}},je)})})}):null,f.jsxs(q,{direction:"row",alignItems:"center",children:[Kt.length>0?f.jsxs(Qe,{variant:"link",color:"gray.500",size:"xs",w:"fit-content",fontWeight:"normal",onClick:W,children:[L?"Hide":"Show"," metadata"]}):null,f.jsxs(q,{ml:"auto",direction:"row",alignItems:"center",children:[_?f.jsx(St,{"aria-label":"Update column",type:"submit",isLoading:le.isLoading,size:"xs",icon:f.jsx(Hf,{size:"14"})}):null,de?f.jsx(Bn,{label:"Delete Column",children:f.jsx(St,{"aria-label":"Delete component",variant:"outline",size:"xs",ml:"auto",colorScheme:"red",isLoading:le.isLoading,onClick:()=>{Re(o)},icon:f.jsx(Fa,{size:"14"})})}):null]})]}),f.jsx(UP,{in:L,children:f.jsx(i_,{mt:"2",alignItems:"center",gap:2,children:Kt.map(je=>f.jsxs(q,{spacing:"0.5",direction:"row",children:[f.jsx(ir,{width:"50%",children:je.name}),f.jsx(Cc,{background:"transparent",fontSize:"sm",children:je.type==="boolean"?JSON.stringify(c[je.name]):c[je.name]||"-"})]},je.name))})})]})})]})})})},$Ee=()=>{var u,h;const r=Ut(),{appName:e,pageName:t}=Ri(),i=Ze(zw),n=Ze(Ba),{type:s,columns:o,isLoading:a,table:c}=Co(i||""),d=s9({onSuccess:()=>{r({status:"success",title:"SmartTable converted"})},onError:g=>{r({status:"error",title:"Failed to convert table",description:ni(g)})},table:i}),l=()=>{d.mutate({table:c,state:n.state,appName:e,pageName:t})};return a?f.jsxs(q,{p:"3",children:[f.jsx(hi,{w:"36",h:"10",borderRadius:"sm"}),f.jsx(q,{p:"3",bg:"white",children:f.jsxs(q,{spacing:"0",divider:f.jsx(Ol,{}),children:[f.jsx(hi,{h:"10"}),f.jsx(hi,{h:"10"}),f.jsx(hi,{h:"10"})]})})]}):f.jsxs(q,{h:"full",overflowY:"auto",children:[f.jsx(Ie,{fontSize:"md",px:"3",pt:"3",pb:"0",fontWeight:"semibold",children:"Columns"}),s==="sql"&&!(c!=null&&c.smart)?f.jsx(Qe,{leftIcon:f.jsx(VG,{size:"14"}),size:"sm",colorScheme:"yellow",onClick:l,isLoading:d.isLoading&&((h=(u=d.variables)==null?void 0:u.table)==null?void 0:h.name)===i,ml:"2",variant:"ghost",children:"Convert to Smart Table"}):null,f.jsxs(q,{spacing:"0",children:[f.jsxs(q,{px:"3",py:"1",direction:"row",fontWeight:"medium",fontSize:"sm",children:[f.jsx(Ie,{width:"50%",children:"Column"}),f.jsx(Ie,{width:"20%",align:"center",children:"Editable"}),f.jsx(Ie,{width:"20%",children:"Hidden"}),f.jsx(Ie,{width:"10%"})]}),o.map(g=>f.jsx(NEe,{tableType:s,...g},g.name))]}),f.jsx(FEe,{variant:"outline",ml:"3",colorScheme:"gray"})]})},WEe=({tableId:r,tableName:e,...t})=>{const{appName:i,pageName:n}=Ri(),{smart:s=!1}=Co(r||"")||{},o=Ut(),a=Ti(Io),{properties:c}=pi({appName:i,pageName:n}),{isOpen:d,onToggle:l,onClose:u}=Ki({onClose:()=>{a({type:null,id:null,meta:null})}}),h=Vr({onSuccess:()=>{u(),o({status:"success",title:"Table Deleted"}),a({type:null,id:null,meta:null})},onError:m=>{o({status:"error",title:"Failed to delete table",description:ni(m)})}}),g=()=>{var m;if(((m=c.blocks)==null?void 0:m.filter(y=>y.block_type==="table").length)===1){o({status:"error",title:"Failed to delete table",description:"Your app must have atleast one table"});return}h.mutate({app_name:i,page_name:n,properties:{...c||{},blocks:[...((c==null?void 0:c.blocks)||[]).filter(y=>y.name!==r)]}})};return f.jsxs(Ir,{isOpen:d,onClose:u,placement:"bottom",closeOnBlur:!1,children:[f.jsx(Rr,{children:f.jsx(St,{variant:"ghost",colorScheme:"red","aria-label":"Delete table",onClick:s?l:g,type:"button",isLoading:h.isLoading,size:"sm",...t,icon:f.jsx(Fa,{size:"14"})})}),f.jsx(Qm,{children:f.jsxs(jr,{children:[f.jsx(xo,{pt:4,fontWeight:"bold",border:"0",fontSize:"md",children:"Delete table"}),f.jsx(xs,{}),f.jsx(Na,{}),f.jsxs(Br,{children:["Are you sure you want to delete ",e," table?"]}),f.jsx(cs,{border:"0",display:"flex",justifyContent:"space-between",pb:4,children:f.jsxs(vr,{ml:"auto",size:"sm",children:[f.jsx(Qe,{onClick:u,colorScheme:"gray",variant:"ghost",children:"Cancel"}),f.jsx(Qe,{colorScheme:"red",type:"button",onClick:g,isLoading:h.isLoading,children:"Delete"})]})})]})})]})},HEe=({fetchers:r,...e})=>f.jsx(Zi,{type:"custom-select",id:"fetcher",placeholder:"Select data fetcher",...e,options:r.map(t=>({name:t.name,value:t.name,icon:null,render:i=>f.jsxs(q,{alignItems:"center",direction:"row",children:[f.jsx(Wf,{boxSize:"5",as:r_,flexShrink:"0",color:i?"blue.500":""}),f.jsx(q,{spacing:"0",children:f.jsx(Ie,{fontWeight:"medium",fontSize:"sm",children:t.name})}),f.jsxs(Mg,{textTransform:"lowercase",size:"xs",ml:"auto",colorScheme:i?"blue":"gray",children:[".",t.type==="sql"?"sql":"py"]})]})}))}),jEe=()=>{var ue;const r=Ze(zw),{appName:e,pageName:t}=Ri(),i=Ut(),n=Ti(Io),{isLoading:s,depends_on:o,name:a,fetcher:c,height:d,label:l,table:u}=Co(r||""),{fields:h}=Cb(),g=["Default"],{tables:m,files:y,properties:_,widgets:b}=pi({appName:e,pageName:t}),E=Vr({onSuccess:()=>{i({title:"Updated table properties",status:"success"})},onError:be=>{i({title:"Failed to update properties",description:ni(be),status:"error"})}}),D=Oa(),{reset:R,formState:{isDirty:M},watch:O,setValue:L}=D,W=y.filter(be=>be.type==="sql"||be.type==="data_fetcher"),Z=(ue=y.filter(be=>be.type==="ui"))==null?void 0:ue.map(be=>be==null?void 0:be.name),K=O("fetcher"),H=y.find(be=>be.name===K);z.useEffect(()=>{R({...u,name:a,label:l,fetcher:c||"",height:d||"",depends:o||null},{keepDirty:!1,keepDirtyValues:!1})},[o,c,a,l,d,u,R]);const C=({fetcher:be,height:de,depends:le,...Me})=>{E.mutate({app_name:e,page_name:t,properties:{..._||{},blocks:[...((_==null?void 0:_.blocks)||[]).map(Re=>{var Oe;return Re.name===r?{...Re,...Me,fetcher:be,depends_on:le,height:de,type:((Oe=W==null?void 0:W.find(Ge=>Ge.name===be))==null?void 0:Oe.type)==="sql"?"sql":"python"}:Re})]}})},B=async be=>{try{await E.mutateAsync({app_name:e,page_name:t,properties:{..._||{},blocks:[...((_==null?void 0:_.blocks)||[]).map(de=>de.name===r?{...de,name:be}:de)]}}),n({id:be,type:"table",meta:null})}catch{}},te=be=>{const de=y.find(le=>le.name===be);(de==null?void 0:de.type)==="data_fetcher"&&L("depends",null)};return s?f.jsxs(q,{p:"6",borderRadius:"sm",spacing:"3",borderWidth:"1px",bg:"white",children:[f.jsx(pP,{isLoading:!0}),f.jsx(pP,{isLoading:!0}),f.jsx(pP,{isLoading:!0})]}):f.jsx("form",{onSubmit:D.handleSubmit(C),children:f.jsx(Pd,{...D,children:f.jsxs(q,{children:[f.jsxs(q,{py:"1.5",px:"4",borderBottomWidth:"1px",flex:"1",alignItems:"center",direction:"row",children:[f.jsxs(q,{direction:"row",alignItems:"center",children:[f.jsx(tr,{children:f.jsx(tr.Code,{children:r})}),f.jsx(YW,{value:r,currentNames:((_==null?void 0:_.tables)||[]).map(be=>be.name),onUpdate:B,resource:"table"})]}),f.jsxs(vr,{ml:"auto",size:"xs",children:[M?f.jsx(St,{"aria-label":"Update component",isLoading:E.isLoading,type:"submit",icon:f.jsx(Hf,{size:"14"})}):null,f.jsx(WEe,{tableId:r,tableName:a})]})]}),f.jsx(q,{spacing:"0",h:"full",overflowY:"auto",divider:f.jsx(_1,{}),children:g.map(be=>{var de;return f.jsxs(q,{spacing:"3",p:"3",children:[be.toLowerCase()==="default"?null:f.jsx(Ie,{fontSize:"md",fontWeight:"semibold",children:be}),f.jsx(q,{spacing:"3",children:(de=h==null?void 0:h.table)==null?void 0:de.filter(le=>le.category===be).map(le=>{var Re;if(le.name==="filters"||le.name==="type"||le.name==="name")return null;if(le.name==="fetcher")return f.jsx(HEe,{name:le.title,onSelect:te,fetchers:W});if(le.name==="widget")return z.createElement(Zi,{...le,id:le.name,name:le.title,type:"select",options:(Re=b==null?void 0:b.filter(Oe=>Oe.type==="inline"))==null?void 0:Re.map(Oe=>({name:Oe.label,value:Oe.name})),key:le.name});if(le.name==="height")return f.jsx(Zi,{type:"select",id:"height",name:le.title,placeholder:"Select table height",options:["1/3","1/2","full"].map(Oe=>({name:Oe,value:Oe}))});if(le.name==="size")return f.jsx(Zi,{type:"select",id:"size",name:le.title,placeholder:"Select table size",options:[1,10,20,50,100].map(Oe=>({name:Oe,value:Oe}))});if(le.name==="depends_on")return f.jsx(Zi,{type:"multiselect",id:"depends",isDisabled:(H==null?void 0:H.type)==="sql",name:le.title,placeholder:"Select the table which it depends on",options:m.filter(Oe=>Oe.name!==r).map(Oe=>({name:Oe.name,value:Oe.name}))});const Me=le.type==="on_row_change"||le.name==="on_row_select";return z.createElement(Zi,{...le,id:le.name,name:le.title,type:Me?"select":le.type,options:((Me?Z:le.enum||le.options)||[]).map(Oe=>({name:Oe,value:Oe})),key:le.name})})})]})})})]},r)})})},BEe=()=>f.jsxs(q,{bg:"white",h:"full",overflowY:"auto",divider:f.jsx(Ol,{}),children:[f.jsx(jEe,{}),f.jsx(ke,{children:f.jsx($Ee,{})})]}),UEe=({widgetId:r})=>{var E;const e=Ut(),t=Ti(Io),{fields:i}=Cb(),{pageName:n,appName:s}=Ze(nr),{widgets:o,properties:a,refetch:c}=pi({appName:s,pageName:n}),d=o.find(D=>D.name===r),l=Vr({onSuccess:()=>{c()},onError:D=>{e({status:"error",title:"Failed to update properties",description:ni(D)})}}),u=Vr({onSuccess:()=>{t({id:null,type:null,meta:null})},onError:D=>{e({status:"error",title:"Failed to delete widget",description:ni(D)})}}),h=Oa(),{formState:{isDirty:g},reset:m}=h;z.useEffect(()=>{m(d,{keepDirty:!1,keepDirtyValues:!1})},[d,m]);const y=D=>{r&&l.mutate({app_name:s,page_name:n,properties:{...a||{},blocks:a==null?void 0:a.blocks.map(R=>R.name===r?{...R,...D}:R)}})},_=async D=>{try{await l.mutateAsync({app_name:s,page_name:n,properties:{...a||{},blocks:(a.blocks||[]).map(R=>R.name===r?{...R,name:D}:R)}}),t({id:D,type:"widget",meta:null})}catch{}},b=()=>{r&&u.mutate({app_name:s,page_name:n,properties:{...a||{},blocks:a==null?void 0:a.blocks.filter(D=>D.name!==r)}})};return f.jsx(q,{h:"full",overflowY:"auto",w:"full",bg:"white",children:f.jsx("form",{onSubmit:h.handleSubmit(y),children:f.jsxs(Pd,{...h,children:[f.jsxs(q,{py:"2",px:"4",borderBottomWidth:"1px",flex:"1",alignItems:"center",direction:"row",children:[f.jsxs(q,{direction:"row",alignItems:"center",children:[f.jsx(tr,{"data-cy":"widget-pane-name",children:f.jsx(tr.Code,{children:r})}),f.jsx(YW,{value:r,currentNames:(o||[]).map(D=>D.name),onUpdate:_,resource:"widget"})]}),f.jsxs(vr,{ml:"auto",size:"xs",children:[g?f.jsx(St,{"aria-label":"Update widget",isLoading:l.isLoading,type:"submit","data-cy":"update-widget",onClick:D=>{D.stopPropagation()},icon:f.jsx(Hf,{size:"14"})}):null,f.jsx(St,{"aria-label":"Delete widget",variant:"ghost",colorScheme:"red",isLoading:u.isLoading,onClick:b,icon:f.jsx(Fa,{size:"14"})})]})]}),f.jsx(q,{spacing:"0",divider:f.jsx(_1,{}),children:f.jsx(q,{spacing:"3",p:"3",children:f.jsx(q,{children:(E=i==null?void 0:i.widget)==null?void 0:E.map(D=>(D==null?void 0:D.name)==="name"||D.name==="block_type"?null:z.createElement(Zi,{...D,id:D.name,type:D.type,key:D.name,options:(D.enum||D.options||[]).map(R=>({name:R,value:R}))}))})})})]})})})};const VEe=r=>{const e=nk();Rk(e),z.useEffect(()=>{if(!e)return()=>{};e.languages.register({id:"plaintext"}),e.languages.setMonarchTokensProvider("plaintext",tz);const{dispose:t}=e.languages.registerCompletionItemProvider("plaintext",{triggerCharacters:[".",'"'],provideCompletionItems:(i,n)=>Wee(i,n,r)});return t},[e,r])},Q2=()=>f.jsxs(q,{as:q,p:6,bg:"white",w:"full",h:"full",children:[f.jsx(Ie,{lineHeight:1.4,fontSize:"md",children:"Select table or component to inspect properties"}),f.jsxs(q,{w:"full",borderWidth:"1px",borderRadius:"sm",p:"4",bg:"gray.50",position:"relative",children:[f.jsx(ke,{outline:"2px solid",p:"2",borderRadius:"sm",outlineColor:"blue.500",children:f.jsx(ke,{h:8,bg:"white",borderWidth:"1px",p:"1",px:"2",color:"gray.500",fontSize:"sm",children:"Enter your input....."})}),f.jsx(JZ,{size:"15",style:{position:"absolute",bottom:"18px",right:"18px",fill:"black"}})]})]}),qEe=()=>{const{id:r,type:e,meta:t}=Ze(Io),i=Ze(Ba);if(VEe(i),!r||!e)return f.jsx(Q2,{});let n=f.jsx(Q2,{});return e==="component"&&(n=f.jsx(OCe,{id:r,meta:t})),e==="table"&&(n=f.jsx(BEe,{})),e==="widget"&&(n=f.jsx(UEe,{widgetId:r})),n},GEe=()=>{const r=Ti(Zo),{isLoading:e}=i9();return z.useEffect(()=>(r({isPreview:!0}),()=>{r({isPreview:!1})}),[r]),f.jsxs(q,{spacing:"0",h:"full",children:[f.jsx(b9,{isPreview:!0}),f.jsxs(Hp,{direction:"horizontal",children:[f.jsx(No,{defaultSize:80,minSize:10,children:f.jsx(Al,{isLoading:e,children:f.jsx(w9,{})})}),f.jsx(ig,{direction:"vertical"}),f.jsx(No,{minSize:10,children:f.jsx(Al,{isLoading:e,children:f.jsx(y9,{})})})]})]})},zEe=()=>{const{appName:r}=Ri(),{apps:e,isFetching:t}=Ud();return t?f.jsxs(mo,{as:q,spacing:"6",w:"full",h:"full",children:[f.jsx(Ie,{color:"heading",fontSize:"lg",fontWeight:"medium",children:"Fetching apps..."}),f.jsx(_u,{minW:"sm",size:"xs",isIndeterminate:!0})]}):e.find(n=>n.name===r)?f.jsxs(xk,{children:[f.jsx(Bi,{index:!0,element:f.jsx(GEe,{})}),f.jsx(Bi,{path:"studio",element:f.jsx(LEe,{})}),f.jsx(Bi,{path:"preview",element:f.jsx(dd,{to:".."})}),f.jsx(Bi,{path:"editor",element:f.jsx(dd,{to:"../studio"})})]}):f.jsx(dd,{to:"/"})},KEe=async({appLabel:r,appName:e,workspaceId:t})=>(await Ei.post("/app/",{app_label:r,app_name:e,workspace_id:t})).data,QEe=r=>{const e=Jt(KEe,{...r||{}});return{handleCreateApp:async({name:i,label:n,workspaceId:s})=>{const{data:o}=await e.mutateAsync({appName:i,appLabel:n,workspaceId:s});return o},isLoading:e.isLoading}},YEe=async r=>(await Ei.delete(`/app/${r}`)).data,XEe=(r={})=>{const e=Li();return Jt(YEe,{...r,onSettled:()=>{e.invalidateQueries(Xf)}})},JEe=async({workspaceId:r,userNum:e,workerURL:t})=>{const{data:i}=await zt.post(`/workspace/${r}/request_cloud`,{user_number:e,worker_url:t});return i},ZEe=()=>Jt(JEe),exe=({isOpen:r,setIsOpen:e})=>{const t=Oa(),{id:i}=Ze(gn),n=ZEe(),s=o=>{n.mutate({workspaceId:i,userNum:o.userNum,workerURL:o.workerURL})};return f.jsxs(_c,{isOpen:r,onClose:()=>{e(!1)},size:"xl",children:[f.jsx(wc,{}),f.jsxs(bc,{children:[f.jsx(Sc,{children:"Upgrade to access the Dropbase hosted client"}),f.jsx(jf,{}),f.jsxs(Ad,{children:[f.jsxs("p",{children:["Fill out this form and we","'","ll get back to you with a quote for your team size. Or contact us at"," ",f.jsx(zm,{href:"mailto:support@dropbase.io",target:"_blank",children:"support@dropbase.io."})," "]}),f.jsx("br",{}),f.jsxs(q,{children:["To access the Dropbase hosted client, please fill out this form",f.jsxs(tn,{children:[f.jsx(ir,{children:"Number of users"}),f.jsx(as,{...t.register("userNum"),borderRadius:"md"})]}),f.jsxs(tn,{children:[f.jsx(ir,{children:"Worker URL"}),f.jsxs(KG,{children:[f.jsx(ZZ,{children:"http://"}),f.jsx(as,{...t.register("workerURL"),borderRadius:"md"})]})]})]})]}),f.jsx(Md,{borderTopWidth:"1px",children:n.isSuccess?f.jsx(Qe,{colorScheme:"green",size:"sm",isDisabled:!0,children:"Sent!"}):f.jsx(Qe,{onClick:t.handleSubmit(s),isLoading:n.isLoading,colorScheme:"blue",type:"submit",size:"sm",children:"Send Request"})})]})]})},txe=async({appName:r,generateNew:e})=>(await Ei.post("/app/sync_app",{app_name:r,generate_new:e})).data,ixe=(r={})=>{const e=Li();return Jt(txe,{...r,onSettled:()=>{e.invalidateQueries(Xf)}})},nxe=({app:r})=>{const e=Ut(),{isOpen:t,onOpen:i,onClose:n}=Ki(),s=Oa(),o=Eo(),a=ixe({onSuccess:()=>{e({status:"success",title:"App synced"})},onError:h=>{e({status:"error",title:"Failed to sync app",description:ni(h)})}}),c=XEe({onSuccess:()=>{n(),e({status:"success",title:"App deleted"})},onError:h=>{e({status:"error",title:"Failed to delete app",description:ni(h)})}}),d=()=>{var h,g;o(`/apps/${r.name}/${(g=(h=r==null?void 0:r.pages)==null?void 0:h[0])==null?void 0:g.name}`)},l=h=>{a.mutate({appName:r.name,generateNew:h})},u=()=>{r.name&&c.mutate(r.name)};return f.jsxs(q,{borderWidth:"1px",borderColor:"gray.200",bg:"white",borderRadius:"md",alignItems:"center",direction:"row",cursor:"pointer",p:"4",spacing:"4",transition:"all ease .2s",_hover:{shadow:"xs",borderColor:"gray.300"},onClick:d,"data-cy":`app-card-${r.name}`,children:[f.jsx(Dk,{strokeWidth:"1.5px",size:"40px"}),f.jsx(Ie,{fontSize:"lg",fontWeight:"semibold",isTruncated:!0,flex:"1",children:r==null?void 0:r.label}),(r==null?void 0:r.status)==="ID_NOT_FOUND_AND_NAME_NOT_FOUND"&&f.jsx(Bn,{placement:"top",label:"This app has no ID. This means that this app will not work because Dropbase will not be able to identify it. This may have happened if you changed the workspace folder manually.",children:f.jsx(Mg,{colorScheme:"red",variant:"subtle",size:"xs",children:"No ID Found"})}),(r==null?void 0:r.status)==="ID_NOT_FOUND_BUT_NAME_FOUND"&&f.jsx(Bn,{placement:"top",label:"This app has no ID. However, we found an app with a matching name in our Database that belongs to your workspace. You have the option of syncing your app with the one that we found. Do note that we cannot guarantee that the app we found is the same as the one in your workspace. This may have happened if you changed the workspace folder manually.",children:f.jsx(Mg,{colorScheme:"orange",variant:"subtle",size:"xs",children:"No ID Found But Name Found"})}),f.jsxs(sf,{children:[f.jsx(of,{flexShrink:"0",as:St,minW:"none",p:"1",h:8,variant:"ghost",colorScheme:"gray",minH:"none",icon:f.jsx(GG,{size:"14"}),ml:"auto","data-cy":`app-menu-${r.name}`,onClick:h=>{h.stopPropagation()}}),f.jsxs(af,{children:[f.jsx(Nl,{"data-cy":`delete-app-${r.name}`,color:"red",onClick:h=>{h.stopPropagation(),i()},children:f.jsxs(q,{alignItems:"center",direction:"row",fontSize:"md",children:[f.jsx(Fa,{size:"14"}),f.jsx(ke,{children:"Delete App"})]})}),(r==null?void 0:r.status)!=="SYNCED"&&f.jsx(Nl,{onClick:h=>{h.stopPropagation(),l(!0)},children:f.jsxs(q,{alignItems:"center",direction:"row",fontSize:"md",children:[f.jsx(Xs,{size:"14"}),f.jsx(ke,{children:"Sync a New App"})]})}),(r==null?void 0:r.status)==="ID_NOT_FOUND_BUT_NAME_FOUND"&&f.jsx(Nl,{onClick:h=>{h.stopPropagation(),l(!1)},children:f.jsxs(q,{alignItems:"center",direction:"row",fontSize:"md",children:[f.jsx(eee,{size:"14"}),f.jsx(ke,{children:"Sync an Existing App"})]})})]})]}),f.jsxs(_c,{isOpen:t,onClose:n,children:[f.jsx(wc,{}),f.jsx(bc,{children:f.jsx(Pd,{...s,children:f.jsxs("form",{onSubmit:s.handleSubmit(u),children:[f.jsxs(Sc,{fontSize:"md",borderBottomWidth:"1px",children:["Confirm deletion of ",r.label]}),f.jsx(jf,{}),f.jsxs(Ad,{py:"6",children:[f.jsxs(Ie,{fontSize:"sm",mb:"2",children:["Write",f.jsx(Cc,{bg:"transparent",color:"gray.600",children:r.name}),"to delete the app"]}),f.jsx(Zi,{autoFocus:!0,id:"name","data-cy":`confirm-delete-app-input-${r.name}`,placeholder:r.name,validation:{validate:h=>h===r.name||"App name did not match"}})]}),f.jsxs(Md,{borderTopWidth:"1px",children:[f.jsx(Qe,{size:"sm",colorScheme:"gray",mr:3,variant:"ghost",disabled:c.isLoading,onClick:n,children:"Close"}),f.jsx(Qe,{isLoading:c.isLoading,type:"submit",size:"sm",colorScheme:"red","data-cy":`confirm-delete-app-${r.name}`,children:"Delete"})]})]})})})]})]})},rxe=()=>{const r=Eo(),e=Ut(),{id:t}=Ze(gn),{workspaces:i}=Ld(),{status:n,isLoading:s}=Bd(),o=Oa(),a=i.find(W=>W.id===t),{apps:c,refetch:d,isLoading:l}=Ud(),{isOpen:u,onOpen:h,onClose:g}=Ki({onClose:()=>{o.reset()}}),{handleCreateApp:m,isLoading:y}=QEe({onSuccess:(W,Z)=>{d(),g(),r(`/apps/${Z==null?void 0:Z.appName}/page1/studio`)},onError:W=>{e({status:"error",title:"Failed to create app",description:ni(W)})}}),_=W=>c.find(Z=>Z.name===W),b=W=>{let Z=W==null?void 0:W.toLowerCase().replace(/[^a-z0-9]/g,"_").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"");return Z!=null&&Z.match(/^\d/)&&(Z=`_${Z}`),Z},E=async({name:W,label:Z})=>{await m({name:W,label:Z,workspaceId:t})},D=o.watch("label");z.useEffect(()=>{o.formState.dirtyFields.name||o.setValue("name",b(D))},[o,D]);const R=n==="success",M=!!(a!=null&&a.workspaceUrl),L=window.location.hostname.endsWith("dropbase.io")?!M&&!R:!1;return s||l?f.jsx(Id,{title:"Your apps",children:f.jsxs(i_,{spacing:6,pb:"4",columns:4,children:[f.jsx(hi,{w:"full",h:24}),f.jsx(hi,{w:"full",h:24}),f.jsx(hi,{w:"full",h:24}),f.jsx(hi,{w:"full",h:24})]})}):f.jsxs(Id,{title:"Your apps",action:f.jsx(Qe,{size:"sm",ml:"auto",onClick:h,isDisabled:!R,"data-cy":"create-app-button",children:"Create app"}),children:[R?f.jsx(i_,{spacing:6,pb:"4",columns:4,children:c.sort((W,Z)=>W.name.localeCompare(Z.name)).map(W=>f.jsx(nxe,{app:W},W.name))}):f.jsx(Ie,{fontSize:"lg",fontWeight:"bold",children:"Please connect to a worker to view and create apps."}),L&&f.jsx(exe,{}),f.jsxs(_c,{isOpen:u,onClose:g,children:[f.jsx(wc,{}),f.jsx(bc,{children:f.jsx(Pd,{...o,children:f.jsxs("form",{onSubmit:o.handleSubmit(E),children:[f.jsx(Sc,{fontSize:"md",borderBottomWidth:"1px",children:"Create a new app"}),f.jsx(jf,{}),f.jsx(Ad,{py:"6",children:f.jsxs(q,{spacing:"2",children:[f.jsx(Zi,{name:"App label",id:"label",placeholder:"Enter app label","data-cy":"app-name"}),f.jsx(Zi,{name:"App name",id:"name",validation:{validate:W=>W.includes(" ")?"Name cannot have spaces":W?_(W)?"Name already exists":W.match(/^[A-Za-z0-9_.]+$/g)?!0:"Name contains invalid characters":"Name required"}})]})}),f.jsxs(Md,{borderTopWidth:"1px",children:[f.jsx(Qe,{size:"sm",colorScheme:"gray",mr:3,variant:"ghost",disabled:y,onClick:g,children:"Cancel"}),f.jsx(Qe,{colorScheme:"blue",isLoading:y,type:"submit",size:"sm","data-cy":"confirm-create-app",children:"Create"})]})]})})})]})]})},sxe=()=>{const{hasTokens:r,isLoading:e}=e9();return!r&&!e?f.jsx(dd,{to:"/settings/developer"}):f.jsxs(xk,{children:[f.jsx(Bi,{index:!0,element:f.jsx(rxe,{})}),f.jsx(Bi,{path:":appName/:pageName/*",element:f.jsx(zEe,{})}),f.jsx(Bi,{path:"*",element:f.jsx(dd,{to:"."})})]})},oxe=()=>{const r=Eo(),{isLoading:e,isSuccess:t}=Ld(),i=t;return e?f.jsxs(mo,{as:q,spacing:"6",w:"full",h:"full",children:[f.jsx(q,{alignItems:"center",spacing:"0",children:f.jsx(Ie,{color:"heading",fontSize:"lg",fontWeight:"medium",children:"Checking user..."})}),f.jsx(_u,{minW:"sm",size:"xs",isIndeterminate:!0})]}):(!e&&!i&&r("/login"),f.jsx(v1,{}))},tH=({name:r,id:e,isSelected:t,Icon:i,onClick:n})=>{const s=()=>{n(e)};return f.jsxs(ke,{w:"full",borderRadius:"sm",bgColor:t?"gray.100":"",px:"5",py:"2",_hover:{bgColor:"gray.100",cursor:"pointer"},display:"flex",alignItems:"center",onClick:s,children:[f.jsx(ke,{mr:"2",children:f.jsx(i,{size:"13",color:"gray"})}),f.jsx(Ie,{fontSize:"md",children:r})]})},iH=({list:r,table:e,selectedName:t})=>f.jsxs(dn,{w:"full",h:"100%",children:[f.jsx(ke,{w:"15vw",borderRight:"1px",borderColor:"gray.100",overflow:"auto",h:"100%",children:f.jsx(nu,{py:"4",spacing:"0",maxH:"82vh",children:r})}),f.jsx(dn,{flexGrow:"6",p:"6",direction:"column",children:t?f.jsxs(f.Fragment,{children:[f.jsxs(Ie,{fontSize:"lg",fontWeight:"semibold",mb:"2",children:[t," Permissions"]}),e]}):null})]}),FI=({name:r,initialValue:e,handleSelect:t,Icon:i})=>{const{getRootProps:n,getRadioProps:s,setValue:o}=iee({onChange:t});return z.useEffect(()=>{o(e||"none")},[e,o]),f.jsxs(_o,{...n(),_hover:{bg:"gray.100"},children:[f.jsx(Wn,{borderColor:"gray.200",children:f.jsxs(dn,{alignItems:"center",children:[i?f.jsx(i,{size:"13",color:"gray"}):null,f.jsx(Ie,{ml:i!==void 0?1:0,children:r})]})}),f.jsx(Wn,{borderColor:"gray.200",children:f.jsx(Nb,{...s({value:"none"}),position:"relative"})}),f.jsx(Wn,{borderColor:"gray.200",children:f.jsx(Nb,{...s({value:"use"}),position:"relative"})}),f.jsx(Wn,{borderColor:"gray.200",children:f.jsx(Nb,{...s({value:"edit"}),position:"relative"})}),f.jsx(Wn,{borderColor:"gray.200",children:f.jsx(Nb,{...s({value:"own"}),position:"relative"})})]})},Jh=({name:r,operator:e,value:t,onChange:i})=>f.jsxs(dn,{fontSize:"sm",borderWidth:"1px",borderRadius:"sm",justifyContent:"center",children:[f.jsx(ke,{h:"full",py:"1",px:"3",display:"flex",alignItems:"center",borderRightWidth:"1px",children:r}),f.jsx(ke,{h:"full",py:"1",px:"3",display:"flex",alignItems:"center",borderRightWidth:"1px",children:e}),f.jsx(as,{value:t,onChange:n=>i(n.target.value),placeholder:"Search",size:"sm",colorScheme:"blue",borderWidth:"0"})]}),nH=({children:r})=>f.jsx(q,{bg:"white",borderWidth:"1px",borderRadius:"sm",direction:"row",p:"1.5",alignItems:"center",w:"25vw",children:f.jsx(q,{direction:"row",borderRadius:"sm",spacing:"6",flex:"1",overflow:"auto",w:"full",children:r})}),uS=({name:r,label:e})=>f.jsx(xr,{children:f.jsxs(ke,{display:"flex",alignItems:"center",children:[r,f.jsx(ke,{ml:"1",children:f.jsx(Bn,{label:e||"",placement:"top-start",children:f.jsx(tee,{size:"12"})})})]})}),rH=({subjectName:r,tableRows:e})=>f.jsx(ke,{mt:"2",border:"1px",overflowY:"auto",w:"25vw",minW:"470px",borderColor:"gray.200",maxHeight:"65vh",children:f.jsxs(cf,{variant:"unstyled",children:[f.jsx(df,{position:"sticky",bgColor:"white",top:"-1",zIndex:"1000",children:f.jsxs(_o,{children:[f.jsx(xr,{children:r}),f.jsx(uS,{name:"None",label:"A user with no permissions. Is just a member of the workspace."}),f.jsx(uS,{name:"Use",label:"Use access allows a user or group to view and use an app. They can't edit or delete the app."}),f.jsx(uS,{name:"Edit",label:"Edit access allows a user or group to view, use, and edit an app. They can't change the app's permissions, manage users, or delete the app."}),f.jsx(uS,{name:"Own",label:"Own access allows a user or group to view, use, edit, and delete an app. They can also manage the app's permissions and users."})]})}),f.jsx(lf,{w:"full",overflowY:"auto",insetBlockEnd:0,children:e})]})}),D9="00000000-0000-0000-0000-000000000001",k9="00000000-0000-0000-0000-000000000002",T9="00000000-0000-0000-0000-000000000003",AN="00000000-0000-0000-0000-000000000004",axe=r=>{var m;const e=Ut(),{user:t}=r,{id:i}=Ze(gn),n=Li(),[s,o]=z.useState(t.role_id),{isOpen:a,onOpen:c,onClose:d}=Ki(),l=lEe({onSuccess:()=>{n.invalidateQueries(jD),e({title:"Member removed",status:"success"}),d()},onError:y=>{e({title:"Error removing member",description:y.message,status:"error"})}}),u=hEe({onSuccess:()=>{n.invalidateQueries(jD),e({title:"Role updated",status:"success"})},onError:y=>{e({title:"Error updating role",description:y.message,status:"error"})}}),h=()=>{l.mutate({userId:t.id,workspaceId:i})},g=y=>{o(y),u.mutate({userId:t.id,workspaceId:i,roleId:y})};return f.jsxs(_o,{_hover:{bg:"gray.100"},children:[f.jsx(Wn,{border:"1px 0px",borderColor:"gray.200",w:"min-content",children:t.email}),f.jsx(Wn,{border:"1px 0px",borderColor:"gray.200",children:f.jsx(If,{spacing:"6",children:f.jsxs(iu,{size:"sm",value:s,onChange:y=>g(y.target.value),children:[f.jsx("option",{value:D9,children:"Admin"}),f.jsx("option",{value:k9,children:"Dev"}),f.jsx("option",{value:T9,children:"User"}),f.jsx("option",{value:AN,children:"Member"})]})})}),f.jsx(Wn,{border:"1px 0px",borderColor:"gray.200",children:f.jsx(dn,{wrap:"wrap",overflow:"auto",maxHeight:"2rem",children:(m=t==null?void 0:t.groups)==null?void 0:m.map(y=>f.jsx(FN,{m:"1",size:"sm",colorScheme:"teal",children:y.name},y==null?void 0:y.id))})}),f.jsx(Wn,{border:"1px 0px",borderColor:"gray.200",children:f.jsx(dn,{justifyContent:"space-between",children:f.jsxs(Ir,{isOpen:a,onClose:d,onOpen:c,placement:"left",children:[f.jsx(Rr,{children:f.jsx(St,{"aria-label":"Remove Member",size:"xs",colorScheme:"red","data-cy":`remove-member-${t.email}`,icon:f.jsx(QG,{size:"18"})})}),f.jsxs(jr,{children:[f.jsx(xs,{}),f.jsx(Na,{}),f.jsx(xo,{fontSize:"md",children:"Confirm member removal"}),f.jsx(Br,{children:f.jsx(Ie,{fontSize:"md",children:`Are you sure you want to
remove ${t.email}?`})}),f.jsx(cs,{display:"flex",justifyContent:"flex-end",children:f.jsxs(vr,{size:"sm",children:[f.jsx(Qe,{colorScheme:"blue",onClick:h,isLoading:l.isLoading,children:"Remove"}),f.jsx(Qe,{variant:"outline",onClick:d,children:"Cancel"})]})})]})]})})})]},t.id)},cxe=()=>{const{id:r}=Ze(gn),e=Ze(NW),[t,i]=z.useState(""),[n,s]=z.useState(AN),[o,a]=z.useState(""),[c,d]=z.useState(""),[l,u]=z.useState(""),h=Li(),{users:g}=Zf(),{isOpen:m,onOpen:y,onClose:_}=Ki(),b=cEe({onSuccess:()=>{h.invalidateQueries(jD),_()}}),E=()=>{b.mutate({workspaceId:r||"",email:t,roleId:n})},D=g.filter(R=>{var W;const M=o?R.email.toLowerCase().includes(o.toLowerCase()):!0,O=c?R.role_name.toLowerCase().includes(c.toLowerCase()):!0,L=l?(W=R.groups)==null?void 0:W.some(Z=>Z.name.toLowerCase().includes(l.toLowerCase())):!0;return M&&O&&L});return e?f.jsx(ke,{w:"60vw",children:f.jsxs(Id,{title:"Workspace Members",action:f.jsx(Qe,{colorScheme:"blue",size:"sm",ml:"auto","data-cy":"add-member",onClick:y,children:"Add Member"}),children:[f.jsx(q,{bg:"white",borderWidth:"1px",borderRadius:"sm",direction:"row",p:"1.5",alignItems:"center",children:f.jsxs(q,{direction:"row",borderRadius:"sm",spacing:"6",flex:"1",overflow:"auto",w:"full",children:[f.jsx(Jh,{name:"Email",operator:"=",value:o,onChange:a}),f.jsx(Jh,{name:"Role",operator:"=",value:c,onChange:d}),f.jsx(Jh,{name:"Group",operator:"=",value:l,onChange:u})]})}),f.jsxs(cf,{variant:"unstyled",layout:"fixed",children:[f.jsx(df,{border:"1px",borderColor:"gray.200",children:f.jsxs(_o,{children:[f.jsx(xr,{border:"1px 0px",borderColor:"gray.200",w:"15rem",children:"Email"}),f.jsx(xr,{border:"1px 0px",borderColor:"gray.200",children:"Workspace Role"}),f.jsx(xr,{children:"Groups"}),f.jsx(xr,{border:"1px 0px",borderColor:"gray.200",children:"Actions"})]})}),f.jsx(lf,{border:"1px",borderColor:"gray.200",children:D.map(R=>f.jsx(axe,{user:R},R.id))})]}),f.jsxs(_c,{isOpen:m,onClose:_,children:[f.jsx(wc,{}),f.jsxs(bc,{children:[f.jsx(Sc,{children:"Invite a member"}),f.jsx(jf,{}),f.jsx(Ad,{children:f.jsxs(nu,{spacing:"3",children:[f.jsx(as,{placeholder:"Member Email",value:t,"data-cy":"new-member-email",onChange:R=>{i(R.target.value)}}),f.jsxs(iu,{placeholder:"Select role",value:n,"data-cy":"new-member-role",onChange:R=>{s(R.target.value)},children:[f.jsx("option",{value:D9,children:"Admin"}),f.jsx("option",{value:k9,children:"Dev"}),f.jsx("option",{value:T9,children:"User"}),f.jsx("option",{value:AN,children:"Member"})]})]})}),f.jsxs(Md,{children:[f.jsx(Qe,{colorScheme:"blue",mr:3,"data-cy":"invite-member",onClick:E,isLoading:b.isLoading,children:"Invite"}),f.jsx(Qe,{variant:"ghost",onClick:_,children:"Cancel"})]})]})]})]})}):f.jsx(Id,{title:"Workspace Members",children:f.jsx(Ie,{children:" Granular permissions are not available for your current plan."})})},dxe=async({groupId:r})=>{const{data:e}=await zt.get(`/group/${r}`);return e},I9=({groupId:r})=>{const e=["group",r],{data:t,...i}=rr(e,()=>dxe({groupId:r}),{enabled:!!r});return{group:(t==null?void 0:t.group)||{},permissions:(t==null?void 0:t.permissions)||[],...i}},lxe=async({groupId:r})=>{const{data:e}=await zt.get(`/group/${r}/users`);return e},uxe=({groupId:r})=>{const e=["groupUsers",r],{data:t,...i}=rr(e,()=>lxe({groupId:r}),{enabled:!!r,staleTime:1/0});return{users:t||[],...i}},hxe=async({name:r,workspaceId:e})=>(await zt.post("/group/",{name:r,workspace_id:e})).data,fxe=r=>Jt(hxe,{...r||{}}),pxe=async({groupId:r})=>(await zt.delete(`/group/${r}`)).data,gxe=r=>Jt(pxe,{...r||{}}),mxe=async({groupId:r,userId:e})=>(await zt.post(`/group/add_user/${r}`,{user_id:e})).data,vxe=r=>Jt(mxe,{...r||{}}),yxe=async({groupId:r,resource:e,action:t})=>(await zt.post(`/group/update_policy/${r}`,{resource:e,action:t})).data,R9=r=>{const e=Ut();return Jt(yxe,{...r||{},onSuccess:()=>{var t;(t=r==null?void 0:r.onSuccess)==null||t.call(r),e({title:"Group permission updated",status:"success"})},onError:()=>{var t;(t=r==null?void 0:r.onError)==null||t.call(r),e({title:"Error updating group permission",status:"error"})}})},_xe=({name:r,groupId:e,appId:t})=>{const{permissions:i}=I9({groupId:e}),n=i==null?void 0:i.find(a=>a.resource===t),s=R9(),o=z.useCallback(a=>{s.mutate({groupId:e,resource:t,action:a})},[s,e,t]);return f.jsx(FI,{name:r,initialValue:n==null?void 0:n.action,handleSelect:o},t)},wxe=({selectedGroup:r,setSelectedGroup:e})=>{const{isLoading:t,groups:i}=dv();return t?f.jsx(_d,{}):i==null?void 0:i.map(n=>f.jsx(tH,{Icon:Tk,name:n.name,id:n==null?void 0:n.id,isSelected:r===n.id,onClick:e},n.id))},bxe=({selectedGroup:r,appFilter:e})=>{const{apps:t}=Ud(),i=t==null?void 0:t.filter(n=>{var s;return(s=n.name)==null?void 0:s.toLowerCase().includes(e==null?void 0:e.toLowerCase())});return i==null?void 0:i.map(n=>f.jsx(_xe,{name:n.name,groupId:r,appId:n.id},n.name))},Sxe=({selectedGroup:r})=>{const[e,t]=z.useState("");return f.jsxs(f.Fragment,{children:[f.jsx(nH,{children:f.jsx(Jh,{name:"App",operator:"=",value:e,onChange:t})}),f.jsx(rH,{subjectName:"Apps",tableRows:f.jsx(bxe,{selectedGroup:r,appFilter:e})})]})},Cxe=()=>{const{groups:r}=dv(),[e,t]=z.useState(""),i=r==null?void 0:r.find(n=>n.id===e);return f.jsx(iH,{list:f.jsx(wxe,{selectedGroup:e,setSelectedGroup:t}),table:e?f.jsx(Sxe,{selectedGroup:e}):null,selectedName:i==null?void 0:i.name})},Exe=async({userId:r,workspaceId:e})=>{const{data:t}=await zt.get(`/user/${r}/details/${e}`);return t},P9=({userId:r})=>{const{id:e}=Ze(gn),t=["user",r,e],{data:i,...n}=rr(t,()=>Exe({userId:r,workspaceId:e}),{enabled:!!r&&!!e});return{user:(i==null?void 0:i.user)||{},permissions:(i==null?void 0:i.permissions)||[],workspaceRole:i==null?void 0:i.workspace_role,...n}},xxe=async({userId:r,resource:e,action:t,workspaceId:i})=>(await zt.post(`/user/update_policy/${r}`,{resource:e,action:t,workspace_id:i})).data,A9=r=>{const e=Ut();return Jt(xxe,{...r||{},onSuccess:()=>{e({title:"User permissions updated",status:"success"})},onError:()=>{e({title:"Error updating user permissions",status:"error"})}})},Dxe=({name:r,userId:e,appId:t})=>{const{permissions:i}=P9({userId:e}),{id:n}=Ze(gn),s=i==null?void 0:i.find(c=>c.resource===t),o=A9(),a=z.useCallback(c=>{o.mutate({userId:e,resource:t,action:c,workspaceId:n||""})},[o,e,t,n]);return f.jsx(FI,{name:r,initialValue:s==null?void 0:s.action,handleSelect:a},t)},kxe=({selectedUser:r,setSelectedUser:e})=>{const{isLoading:t,users:i}=Zf();return t?f.jsx(_d,{}):i==null?void 0:i.map(n=>f.jsx(tH,{name:n.name,Icon:Ik,id:n.id,isSelected:r===n.id,onClick:e},n.id))},Txe=({selectedUser:r,appFilter:e})=>{const{apps:t}=Ud(),i=t==null?void 0:t.filter(n=>{var s;return(s=n.name)==null?void 0:s.toLowerCase().includes(e==null?void 0:e.toLowerCase())});return i==null?void 0:i.map(n=>f.jsx(Dxe,{name:n.name,userId:r,appId:n.id},n.name))},Ixe=({selectedUser:r})=>{const[e,t]=z.useState("");return f.jsxs(f.Fragment,{children:[f.jsx(nH,{children:f.jsx(Jh,{name:"App",operator:"=",value:e,onChange:t})}),f.jsx(rH,{subjectName:"Users",tableRows:f.jsx(Txe,{selectedUser:r,appFilter:e})})]})},Rxe=()=>{const{users:r}=Zf(),[e,t]=z.useState(""),i=r==null?void 0:r.find(n=>n.id===e);return f.jsx(iH,{list:f.jsx(kxe,{selectedUser:e,setSelectedUser:t}),table:f.jsx(Ixe,{selectedUser:e}),selectedName:i==null?void 0:i.name})},Pxe=({name:r,subjectId:e,appId:t})=>{const{permissions:i}=P9({userId:e}),{id:n}=Ze(gn),s=i==null?void 0:i.find(c=>c.resource===t),o=A9(),a=z.useCallback(c=>{o.mutate({userId:e,resource:t,action:c,workspaceId:n||""})},[o,e,t,n]);return f.jsx(FI,{name:r,initialValue:s==null?void 0:s.action,handleSelect:a,Icon:Ik},t)},Axe=({name:r,subjectId:e,appId:t})=>{const{permissions:i}=I9({groupId:e}),n=i==null?void 0:i.find(a=>a.resource===t),s=R9(),o=z.useCallback(a=>{s.mutate({groupId:e,resource:t,action:a})},[s,e,t]);return f.jsx(FI,{name:r,initialValue:n==null?void 0:n.action,handleSelect:o,Icon:Tk},t)},Mxe=({selectedApp:r,setSelectedApp:e})=>{const{isLoading:t,apps:i}=Ud();return t?f.jsx(_d,{}):i==null?void 0:i.map(n=>f.jsx(tH,{name:n.name,Icon:Dk,id:n.id,isSelected:r===n.id,onClick:e},n.id))},Lxe=({selectedApp:r,subjectFilter:e})=>{const{users:t}=Zf(),{groups:i}=dv(),n=i.map(c=>({name:c.name,id:c.id,type:"group"})),s=t.map(c=>({name:c.name,id:c.id,type:"user"}));return n.concat(s).filter(c=>c.name.toLowerCase().includes(e.toLowerCase())).map(c=>c.type==="user"?f.jsx(Pxe,{name:c.name,subjectId:c.id,appId:r},c.id):c.type==="group"?f.jsx(Axe,{name:c.name,subjectId:c.id,appId:r},c.id):null)},Fxe=({selectedApp:r})=>{const[e,t]=z.useState("");return f.jsxs(f.Fragment,{children:[f.jsx(nH,{children:f.jsx(Jh,{name:"Subject",operator:"=",value:e,onChange:t})}),f.jsx(rH,{subjectName:"Subject",tableRows:f.jsx(Lxe,{selectedApp:r,subjectFilter:e})})]})},Oxe=()=>{const{apps:r}=Ud(),[e,t]=z.useState(""),i=r==null?void 0:r.find(n=>n.id===e);return f.jsx(iH,{list:f.jsx(Mxe,{selectedApp:e,setSelectedApp:t}),table:f.jsx(Fxe,{selectedApp:e}),selectedName:i==null?void 0:i.name})},yP=({name:r,value:e,onClick:t,isSelected:i,Icon:n})=>f.jsxs(ke,{_hover:{bgColor:"gray.100",cursor:"pointer"},bgColor:i?"gray.100":"",p:"3",display:"flex",alignItems:"center",onClick:()=>t(e),children:[f.jsx(ke,{mr:"3",children:n?f.jsx(n,{size:"13",color:"gray"}):null}),f.jsx(Ie,{fontSize:"md",children:r})]}),Nxe=()=>{const[r,e]=z.useState("groups"),t=()=>r==="groups"?f.jsx(Cxe,{}):r==="members"?f.jsx(Rxe,{}):r==="apps"?f.jsx(Oxe,{}):null;return f.jsxs(dn,{direction:"column",h:"100%",w:"full",border:"1px",borderColor:"gray.100",children:[f.jsx(Ie,{pt:"6",pl:"6",fontWeight:"bold",fontSize:"xl",children:"Permissions"}),f.jsx(dn,{pl:"2",mt:"4",w:"full",border:"1px",borderColor:"gray.100",children:f.jsxs(If,{spacing:"10",children:[f.jsx(yP,{name:"Groups",value:"groups",Icon:Tk,onClick:e,isSelected:r==="groups"}),f.jsx(yP,{name:"Members",value:"members",Icon:Ik,onClick:e,isSelected:r==="members"}),f.jsx(yP,{name:"Apps",value:"apps",Icon:Dk,onClick:e,isSelected:r==="apps"})]})}),t()]})},$xe=()=>{const{id:r}=Ze(gn),{user:e}=nb(),t=Ut(),{hasCopied:i,onCopy:n}=YG("test"),{isOpen:s,onOpen:o,onClose:a}=Ki(),{tokens:c}=jW({userId:e.id,workspaceId:r}),d=Z6(),l=c.length>0,u=c[0],h=async()=>{d.mutate({workspaceId:r||""})};return z.useEffect(()=>{l||o()},[l,o]),f.jsxs(_c,{isOpen:s,onClose:a,size:"2xl",isCentered:!0,children:[f.jsx(wc,{}),f.jsxs(bc,{children:[f.jsx(Sc,{children:l?"Token Generated":"Generate Dropbase Token"}),l&&f.jsx(jf,{}),f.jsx(Ad,{children:l?f.jsxs(q,{justifyContent:"center",direction:"column",w:"max-content",p:"2",children:[f.jsxs(dn,{alignItems:"center",children:[f.jsx(Ie,{as:"b",mr:"1",children:"Token:"}),f.jsx(Ie,{noOfLines:1,children:u.token}),f.jsx(St,{flexShrink:"0",variant:"ghost",icon:i?f.jsx(Uy,{size:"14"}):f.jsx(w1,{size:"14"}),size:"xs",height:"24px",onClick:()=>{n(),MC(u.token),t({title:"Token copied",status:"success"})},"aria-label":"Copy token"})]}),f.jsxs(dn,{mt:"4",alignItems:"center",children:[f.jsx(Ie,{children:"Continue setting up Dropbase by following steps in"}),f.jsx(zm,{ml:"1",href:"https://docs.dropbase.io/category/setup/",target:"_blank",children:"our docs."})]})]}):f.jsx(dn,{children:f.jsx(Qe,{onClick:h,isLoading:d.isLoading,w:"full",children:"Generate"})})}),f.jsx(Md,{})]})]})},Wxe=r=>r.length<8?r:"*".repeat(r.length-4)+r.slice(-4),Hxe=({token:r})=>{const{id:e}=Ze(gn),[t]=Ji(X6),[i,n]=z.useState(!1),{isOpen:s,onOpen:o,onClose:a}=Ki(),{hasCopied:c,onCopy:d}=YG("test"),l=Ut(),[u,h]=z.useState(!1),[g,m]=z.useState(r.name),y=z.useRef(null),_=t===r.token,b=()=>{n(!0)},E=()=>{n(!1)},D=cSe({onSuccess:()=>{l({title:"Token deleted",status:"info"}),a()}}),R=oSe({onSuccess:()=>{l({title:"Token info updated",status:"info"})}}),M=()=>{D.mutate({workspaceId:e,tokenId:r.id})},O=L=>{L.key==="Enter"&&(R.mutate({workspaceId:e,tokenId:r.id,name:L.currentTarget.value}),h(!1))};return z.useEffect(()=>{u&&setTimeout(()=>{var L;(L=y.current)==null||L.focus()},0)},[u]),f.jsxs(_o,{bg:i?"gray.50":"",onMouseOver:b,onMouseOut:E,children:[f.jsx(Wn,{w:"25%",children:f.jsxs(q,{direction:"row",alignItems:"center",children:[_?f.jsx(ke,{color:"green.500",children:f.jsx(Uy,{})}):null,u?f.jsx(as,{ref:y,size:"sm",value:g,onChange:L=>{m(L.currentTarget.value)},onKeyDown:O,onBlur:()=>h(!1),onClick:L=>{L.stopPropagation()}}):f.jsx(Ie,{children:r.name}),i&&!u&&f.jsx(St,{"aria-label":"Edit name",size:"xs",height:"24px",width:"24px",variant:"ghost",onClick:L=>{L.stopPropagation(),h(!0)},icon:f.jsx(n_,{size:"12"})})]})}),f.jsx(Wn,{w:"60%",children:f.jsxs(KG,{maxW:"container.sm",children:[f.jsx(as,{value:Wxe(r.token)}),f.jsx(nee,{children:f.jsx(St,{flexShrink:"0",variant:"ghost",icon:c?f.jsx(Uy,{size:"14"}):f.jsx(w1,{size:"14"}),size:"xs",height:"24px",onClick:()=>{d(),MC(r.token),l({title:"Token copied",status:"success"})},"aria-label":"Copy token"})})]})}),f.jsx(Wn,{isNumeric:!0,children:f.jsxs(Ir,{returnFocusOnClose:!1,isOpen:s,onOpen:o,onClose:a,placement:"right",children:[f.jsx(Rr,{children:f.jsx(St,{"aria-label":"Delete token",size:"xs",colorScheme:"red",variant:"outline",icon:f.jsx(XG,{size:"14"}),onClick:L=>{L.stopPropagation(),o()}})}),f.jsxs(jr,{onClick:L=>{L.stopPropagation()},children:[f.jsx(xs,{}),f.jsx(Na,{}),f.jsx(xo,{textAlign:"left",fontSize:"md",children:"Confirm delete token!"}),f.jsx(Br,{textAlign:"left",children:"Are you sure you want to delete this token?"}),f.jsx(cs,{display:"flex",justifyContent:"flex-end",children:f.jsxs(vr,{size:"sm",children:[f.jsx(Qe,{onClick:a,variant:"outline",children:"Cancel"}),f.jsx(Qe,{isLoading:D.isLoading,onClick:M,colorScheme:"red",children:"Delete"})]})})]})]})})]})},_P=({inputProps:r,text:e,handleUpdate:t,isEditable:i=!0})=>{const[n,s]=z.useState(!1),o=z.useRef(null);return z.useEffect(()=>{n&&setTimeout(()=>{var a;(a=o.current)==null||a.focus()},0)},[n]),i&&n?f.jsx(as,{ref:o,variant:"outline",size:"sm",onBlur:()=>s(!1),onClick:a=>a.stopPropagation(),onKeyDown:a=>{a.key==="Enter"&&(t(),s(!1))},...r}):f.jsxs(If,{children:[f.jsx(Ie,{children:e}),i&&f.jsx(St,{"aria-label":"Edit name",size:"xs",height:"24px",width:"24px",variant:"ghost",onClick:a=>{a.stopPropagation(),s(!0)},icon:f.jsx(n_,{size:"12"})})]})},Y2=({urlMapping:r,isEditable:e=!0,isDefault:t=!1})=>{const i=Ze(TI),n=Ybe(),s=Jbe(),[o,a]=z.useState(r==null?void 0:r.client_url),[c,d]=z.useState(r==null?void 0:r.worker_url),[l,u]=z.useState(r==null?void 0:r.lsp_url),h=async()=>{n.mutate({id:r.id})},g=async()=>{s.mutate({id:r.id,client_url:o,worker_url:c,lsp_url:l})},m=()=>!i&&t?!0:((i==null?void 0:i.id)||"")===(r==null?void 0:r.id);return f.jsxs(_o,{children:[f.jsx(Wn,{children:f.jsx(_P,{inputProps:{value:o,onChange:y=>a(y.target.value)},handleUpdate:g,text:r==null?void 0:r.client_url,isEditable:e})}),f.jsx(Wn,{children:f.jsx(_P,{inputProps:{value:c,onChange:y=>d(y.target.value)},handleUpdate:g,text:r==null?void 0:r.worker_url,isEditable:e})}),f.jsx(Wn,{children:f.jsx(_P,{inputProps:{value:l,onChange:y=>u(y.target.value)},handleUpdate:g,text:r==null?void 0:r.lsp_url,isEditable:e})}),f.jsx(Wn,{children:f.jsx(ON,{size:"18",color:m()?"green":""})}),f.jsx(Wn,{children:e&&f.jsx(St,{"aria-label":"Delete token",size:"xs",colorScheme:"red",variant:"outline",icon:f.jsx(XG,{size:"14"}),onClick:y=>{y.stopPropagation(),h()}})})]})},jxe=()=>{const{id:r}=Ze(gn),{user:e}=nb(),[,t]=z.useState(""),{isLoading:i,tokens:n}=jW({userId:e.id,workspaceId:r}),{urlMappings:s}=II(),{workspaces:o}=Ld(),a=Z6(),c=Kbe(),d=o.find(h=>h.id===r),l=async()=>{a.mutate({workspaceId:r||""})},u=async()=>{const h=window.location.hostname;c.mutate({workspaceId:r||"",client_url:`${h}:3030`,worker_url:`${h}:9090`,lsp_url:`${h}:9095`})};return z.useEffect(()=>{d&&t(d==null?void 0:d.worker_url)},[d]),i?f.jsx(hi,{}):f.jsxs(Id,{pageProps:{overflow:"auto"},title:"Developer Settings",children:[f.jsx($xe,{}),f.jsxs(q,{children:[f.jsx(q,{direction:"row",justifyContent:"space-between",alignItems:"center",children:f.jsxs(q,{spacing:"0.5",children:[f.jsx(Ie,{fontSize:"lg",fontWeight:"bold",children:"Worker Tokens"}),f.jsx(Ie,{fontSize:"md",fontWeight:"medium",children:"Generate workspace token for your worker"})]})}),f.jsxs(cf,{w:"container.lg",borderLeftWidth:"1px",borderRightWidth:"1px",variant:"simple",children:[f.jsx(df,{children:f.jsxs(_o,{children:[f.jsx(xr,{children:"Name"}),f.jsx(xr,{children:"Key"}),f.jsx(xr,{isNumeric:!0,children:"Actions"})]})}),f.jsx(lf,{children:n.map(h=>f.jsx(Hxe,{token:h}))})]}),f.jsx(Qe,{w:"fit-content",variant:"outline",isLoading:a.isLoading,onClick:l,children:"Generate Token"}),f.jsx(dn,{mt:"8",direction:"row",justifyContent:"space-between",alignItems:"center",children:f.jsxs(q,{spacing:"0.5",children:[f.jsx(Ie,{fontSize:"lg",fontWeight:"bold",children:"URL Mappings"}),f.jsx(Ie,{fontSize:"md",fontWeight:"medium",children:"Choose worker URLs to map to your chosen client URLs"})]})}),f.jsxs(cf,{w:"container.lg",borderLeftWidth:"1px",borderRightWidth:"1px",variant:"simple",children:[f.jsx(df,{children:f.jsxs(_o,{children:[f.jsx(xr,{children:"Client"}),f.jsx(xr,{children:"Worker"}),f.jsx(xr,{children:"LSP"}),f.jsx(xr,{children:"Active"}),f.jsx(xr,{children:"Actions"})]})}),f.jsxs(lf,{children:[f.jsx(Y2,{urlMapping:{client_url:"localhost:3030",worker_url:"localhost:9090",lsp_url:"localhost:9095"},isEditable:!1,isDefault:!0}),s.map(h=>f.jsx(Y2,{urlMapping:h}))]})]}),f.jsx(Qe,{w:"fit-content",variant:"outline",isLoading:a.isLoading,onClick:u,children:"Add URL Mapping"})]})]})},Bxe=({children:r,link:e,Icon:t,available:i})=>{const n=window.location.pathname.includes(e);return f.jsxs(ke,{w:"full",_hover:i?{bg:"gray.100",cursor:"pointer"}:{cursor:"not-allowed"},color:n?"blue.500":"body",p:"1",as:vh,to:`/settings/${e}`,display:"flex",alignItems:"center",pointerEvents:i?"auto":"none",children:[t?f.jsx(ke,{mr:"3",children:f.jsx(t,{size:"12"})}):null,r,i?null:f.jsx(ke,{ml:"2",children:f.jsx(JG,{size:"10",color:"gray"})})]})},Uxe=[{name:"Members",link:"members",icon:Ik,isGranular:!1},{name:"Groups",link:"groups",icon:Tk,isGranular:!0},{name:"Permissions",link:"permissions",icon:JG,isGranular:!0},{name:"Developer",link:"developer",icon:S1,isGranular:!1}],Vxe=({children:r})=>{const{user:e}=nb(),{in_trial:t}=Ze(gn),[i,n]=Ji(NW);return z.useEffect(()=>{var s;n(t||((s=e==null?void 0:e.email)==null?void 0:s.endsWith("dropbase.io")))},[t,e==null?void 0:e.email,n]),f.jsxs(q,{direction:"row",spacing:"0",h:"full",children:[f.jsx(ke,{h:"full",overflow:"auto",flex:"1",children:f.jsx(Id,{title:"Settings",children:f.jsx(q,{children:Uxe.map(s=>f.jsx(Bxe,{link:s.link,Icon:s.icon,available:s.isGranular?i:!0,children:f.jsx(Ie,{fontSize:"md",children:s.name})},s.name))})})}),f.jsx(ke,{flex:"6",w:"full",h:"full",borderLeft:"1px",borderColor:"gray.100",children:r})]})},qxe=({selectedGroup:r,setSelectedGroup:e,group:t})=>{const[i,n]=z.useState(!1),s=Li(),o=gxe({onSuccess:()=>{s.invalidateQueries(ZW)}}),a=()=>{n(!0)},c=()=>{n(!1)},d=()=>{o.mutate({groupId:t.id})};return f.jsxs(ke,{px:"2",py:"1",bgColor:r===t.id?"gray.100":"",_hover:{cursor:"pointer",bg:"gray.100"},borderColor:r===t.id?"blue.500":"gray.200",onClick:()=>e(t.id),display:"flex",alignItems:"center",w:"full",justifyContent:"space-between",children:[f.jsx(Ie,{fontSize:"md",children:t.name}),f.jsxs(Ir,{returnFocusOnClose:!1,isOpen:i,onClose:c,placement:"right",closeOnBlur:!1,children:[f.jsx(Rr,{children:f.jsx(St,{"aria-label":"Delete Group",size:"xs",icon:f.jsx(Fa,{size:"14"}),variant:"ghost",color:"red",onClick:a})}),f.jsxs(jr,{children:[f.jsx(xs,{}),f.jsx(Na,{}),f.jsx(xo,{fontSize:"md",children:"Confirm Delete"}),f.jsx(Br,{fontSize:"md",children:"Are you sure you want to delete this group?"}),f.jsx(cs,{display:"flex",justifyContent:"flex-end",children:f.jsxs(vr,{children:[f.jsx(Qe,{colorScheme:"red",size:"sm",onClick:d,isLoading:o.isLoading,children:"Delete"}),f.jsx(Qe,{variant:"ghost",size:"sm",onClick:c,children:"Cancel"})]})})]})]})]},t.id)},Gxe=r=>{const{user:e}=r;return f.jsxs(_o,{_hover:{bg:"gray.100"},children:[f.jsx(Wn,{border:"1px 0px",borderColor:"gray.200",children:e.email}),f.jsx(Wn,{border:"1px 0px",borderColor:"gray.200",children:f.jsx(St,{"aria-label":"Remove member",size:"xs",colorScheme:"red",icon:f.jsx(QG,{size:"14"})})})]})},zxe=()=>{const{groups:r}=dv(),{users:e}=Zf(),t=Ze(NW),{id:i}=Ze(gn),[n,s]=z.useState(""),[o,a]=z.useState(""),[c,d]=z.useState(""),[l,u]=z.useState(""),{users:h,refetch:g}=uxe({groupId:n}),m=vxe({onSuccess:()=>{g()}}),{isOpen:y,onOpen:_,onClose:b}=Ki(),{isOpen:E,onOpen:D,onClose:R}=Ki(),M=r.find(H=>H.id===n),O=Li(),L=fxe({onSuccess:()=>{O.invalidateQueries(ZW)}}),W=()=>{L.mutate({workspaceId:i||"",name:o}),b()},Z=()=>{m.mutate({userId:l,groupId:n}),R()},K=h.filter(H=>!(c&&!H.email.includes(c)));return t?f.jsxs(Id,{title:"Workspace Groups",pageProps:{pb:"0"},children:[f.jsxs(dn,{w:"full",h:"full",children:[f.jsxs(ke,{w:"15vw",h:"100%",pr:"2",children:[f.jsxs(dn,{alignItems:"center",children:[f.jsx(Ie,{fontWeight:"bold",children:"Groups"}),f.jsx(Qe,{size:"sm",ml:"auto",onClick:()=>_(),children:"Create"})]}),f.jsx(nu,{mt:"4",spacing:"0",children:r.map(H=>f.jsx(qxe,{group:H,selectedGroup:n,setSelectedGroup:s},H.id))})]}),f.jsx(Ol,{mx:"4",orientation:"vertical",h:"100%"}),n?f.jsxs(dn,{h:"100%",w:"40vw",flexDir:"column",children:[f.jsxs(dn,{alignItems:"center",justifyContent:"space-between",children:[f.jsx(Ie,{fontWeight:"bold",children:M==null?void 0:M.name}),f.jsxs(Ir,{onOpen:D,isOpen:E,onClose:R,placement:"bottom-end",children:[f.jsx(Rr,{children:f.jsxs(Qe,{size:"sm",variant:"outline",children:[" ","Add Member"]})}),f.jsxs(jr,{children:[f.jsx(xs,{}),f.jsx(Na,{}),f.jsx(xo,{fontSize:"md",children:"Add a member to this group!"}),f.jsx(Br,{fontSize:"md",children:f.jsx(iu,{placeholder:"Select a member to invite",value:l,onChange:H=>u(H.target.value),children:e==null?void 0:e.filter(H=>!h.some(C=>C.id===H.id)).map(H=>f.jsx("option",{value:H.id,children:H.email}))})}),f.jsx(cs,{display:"flex",justifyContent:"flex-end",children:f.jsxs(vr,{size:"sm",children:[f.jsx(Qe,{colorScheme:"blue",onClick:Z,isLoading:m.isLoading,children:"Add"}),f.jsx(Qe,{variant:"outline",onClick:R,children:"Cancel"})]})})]})]})]}),f.jsx(q,{bg:"white",borderWidth:"1px",borderRadius:"sm",direction:"row",p:"1.5",alignItems:"center",w:"40vw",mt:"2",children:f.jsx(q,{direction:"row",borderRadius:"sm",spacing:"6",flex:"1",overflow:"auto",children:f.jsx(Jh,{name:"Email",operator:"=",value:c,onChange:d})})}),f.jsxs(cf,{variant:"unstyled",mt:"2",w:"40vw",children:[f.jsx(df,{border:"1px",borderColor:"gray.200",children:f.jsxs(_o,{children:[f.jsx(xr,{border:"1px 0px",borderColor:"gray.200",w:"15rem",children:"Email"}),f.jsx(xr,{border:"1px 0px",borderColor:"gray.200",children:"Actions"})]})}),f.jsx(lf,{border:"1px",borderColor:"gray.200",children:K.map(H=>f.jsx(Gxe,{user:H},H.id))})]})]}):f.jsx(dn,{children:" Select a group to view members"})]}),f.jsxs(_c,{isOpen:y,onClose:b,children:[f.jsx(wc,{}),f.jsxs(bc,{children:[f.jsx(Sc,{children:"Create a new group"}),f.jsx(jf,{}),f.jsx(Ad,{children:f.jsx(as,{placeholder:"Group name",value:o,onChange:H=>{a(H.target.value)}})}),f.jsxs(Md,{children:[f.jsx(Qe,{colorScheme:"blue",mr:3,onClick:W,isLoading:L.isLoading,children:"Create"}),f.jsx(Qe,{variant:"ghost",onClick:b,children:"Cancel"})]})]})]})]}):f.jsx(Id,{title:"Permissions Manager",children:f.jsx(Ie,{fontSize:"lg",color:"gray.500",children:"Granular permissions are not available for your current plan."})})},Kxe=()=>f.jsx(xk,{children:f.jsxs(Bi,{path:"/",element:f.jsx(Vxe,{children:f.jsx(v1,{})}),children:[f.jsx(Bi,{index:!0,element:f.jsx(dd,{to:"/settings"})}),f.jsx(Bi,{path:"members",element:f.jsx(cxe,{})}),f.jsx(Bi,{path:"permissions",element:f.jsx(Nxe,{})}),f.jsx(Bi,{path:"groups",element:f.jsx(zxe,{})}),f.jsx(Bi,{path:"developer",element:f.jsx(jxe,{})}),f.jsx(Bi,{path:"*",element:f.jsx(dd,{to:"/settings"})})]})}),Qxe=()=>{const r=Ti(x1);e9(),tSe();const{urlSet:e,isLoading:t}=WW(),i=HW();b1(i,{share:!0,shouldReconnect:()=>!0,reconnectAttempts:3,reconnectInterval:s=>Math.min(2**s*1e3,1e4),onOpen:()=>{r(!0)},onClose:()=>{r(!1)}});let n=null;return t?n=f.jsx(Bi,{path:"*",element:f.jsxs(mo,{as:q,children:[f.jsx(_d,{}),f.jsx(Ie,{children:"Loading User Config..."})]})}):e?n=f.jsxs(f.Fragment,{children:[f.jsx(Bi,{path:"workspaces",element:f.jsx(qbe,{})}),f.jsx(Bi,{path:"apps/*",element:f.jsx(sxe,{})}),f.jsx(Bi,{path:"settings/*",element:f.jsx(Kxe,{})})]}):n=f.jsx(Bi,{path:"*",element:f.jsx(mo,{children:f.jsx(Ie,{children:"URL Mapping not set"})})}),f.jsxs(f.Fragment,{children:[f.jsx(ASe,{homeRoute:"/apps",children:f.jsx(Bi,{element:f.jsx(oxe,{}),children:n})}),f.jsx(S9,{})]})};ree.createRoot(document.getElementById("root")).render(f.jsx(yee,{children:f.jsx(Qxe,{})}));export{bu as $,nme as A,Ar as B,k4 as C,Ree as D,Xo as E,Hce as F,vw as G,j_ as H,Dn as I,pOe as J,pme as K,b3 as L,Jm as M,Z3 as N,q4 as O,Rs as P,T$ as Q,NT as R,ime as S,QM as T,yFe as U,AM as V,_Fe as W,wFe as X,L1e as Y,OU as Z,T as _,zt as a,RLe as a$,c$ as a0,ar as a1,Ode as a2,qIe as a3,wle as a4,Q1 as a5,Wce as a6,rOe as a7,gFe as a8,vFe as a9,it as aA,Vn as aB,Ui as aC,Vl as aD,Zs as aE,NFe as aF,$Fe as aG,WFe as aH,MU as aI,nP as aJ,ph as aK,FU as aL,Wh as aM,ns as aN,cOe as aO,Y$ as aP,ta as aQ,OLe as aR,xU as aS,LLe as aT,DU as aU,FLe as aV,TU as aW,HLe as aX,ILe as aY,qLe as aZ,tS as a_,Tm as aa,mFe as ab,Tl as ac,Il as ad,bFe as ae,Ke as af,qr as ag,mRe as ah,RE as ai,hn as aj,Gge as ak,JFe as al,ZFe as am,nd as an,ZLe as ao,kl as ap,JLe as aq,eFe as ar,zx as as,Vo as at,yle as au,ds as av,Am as aw,Fve as ax,Ed as ay,vle as az,hje as b,fle as b$,iS as b0,PLe as b1,RD as b2,Xh as b3,fd as b4,aOe as b5,Wge as b6,GLe as b7,Qp as b8,$Le as b9,HFe as bA,tAe as bB,oNe as bC,sNe as bD,jk as bE,by as bF,VLe as bG,KLe as bH,zLe as bI,YLe as bJ,QLe as bK,XLe as bL,yce as bM,Vf as bN,gr as bO,eAe as bP,ZPe as bQ,Dl as bR,ULe as bS,uRe as bT,Z1e as bU,mn as bV,vRe as bW,lRe as bX,tle as bY,r$e as bZ,dB as b_,kU as ba,WLe as bb,Vx as bc,ALe as bd,EU as be,MLe as bf,qx as bg,IU as bh,jLe as bi,BLe as bj,NLe as bk,c_e as bl,dOe as bm,Kx as bn,qp as bo,CB as bp,au as bq,JTe as br,WV as bs,a6 as bt,ea as bu,ia as bv,Gme as bw,AF as bx,kFe as by,OFe as bz,uje as c,qye as c$,t$e as c0,g$e as c1,i$e as c2,n$e as c3,s$e as c4,o$e as c5,Uye as c6,ko as c7,Qs as c8,vc as c9,pRe as cA,hRe as cB,CS as cC,d3 as cD,Ss as cE,c$e as cF,nle as cG,t4 as cH,$$e as cI,sle as cJ,W$e as cK,H$e as cL,B$e as cM,j$e as cN,U$e as cO,rle as cP,V$e as cQ,l$e as cR,h$e as cS,cme as cT,k$e as cU,hW as cV,T$e as cW,f6 as cX,l_e as cY,v8 as cZ,Gye as c_,e$e as ca,d$e as cb,u$e as cc,a$e as cd,f$e as ce,Vye as cf,H_e as cg,p$e as ch,J1e as ci,yRe as cj,m$e as ck,Zm as cl,PW as cm,ale as cn,cle as co,y$e as cp,z_ as cq,dle as cr,_$e as cs,w$e as ct,b$e as cu,Kye as cv,S$e as cw,C$e as cx,cc as cy,fRe as cz,LC as d,uFe as d$,zye as d0,rde as d1,AFe as d2,n_e as d3,Jye as d4,Zye as d5,ile as d6,P$e as d7,A$e as d8,B_e as d9,R4 as dA,qE as dB,Rn as dC,oue as dD,io as dE,ts as dF,mAe as dG,Fke as dH,qs as dI,ub as dJ,Gh as dK,Qle as dL,n$ as dM,x$ as dN,IS as dO,z$ as dP,g0 as dQ,zPe as dR,qPe as dS,GPe as dT,due as dU,p3 as dV,o4 as dW,SRe as dX,pFe as dY,fFe as dZ,hFe as d_,U_e as da,M$e as db,FFe as dc,V_e as dd,L$e as de,gwe as df,mwe as dg,m8 as dh,gw as di,v$e as dj,I$e as dk,R$e as dl,aD as dm,F8 as dn,dD as dp,N8 as dq,Js as dr,pu as ds,uP as dt,mle as du,Qj as dv,_2 as dw,w2 as dx,PR as dy,UT as dz,Ei as e,i5 as e$,ab as e0,Uj as e1,lu as e2,lb as e3,gRe as e4,hve as e5,Od as e6,Kde as e7,HT as e8,Bge as e9,oFe as eA,nS as eB,sFe as eC,rFe as eD,Yce as eE,SIe as eF,Aj as eG,mce as eH,dm as eI,UPe as eJ,jPe as eK,BPe as eL,VPe as eM,ibe as eN,FIe as eO,wu as eP,Z1 as eQ,The as eR,eLe as eS,xpe as eT,KPe as eU,NL as eV,$a as eW,yg as eX,BU as eY,vme as eZ,S8 as e_,LT as ea,Bx as eb,Sce as ec,vce as ed,x2 as ee,eIe as ef,_ce as eg,hc as eh,va as ei,ZTe as ej,Cf as ek,td as el,zde as em,tRe as en,id as eo,FE as ep,fce as eq,zFe as er,ble as es,bRe as et,aFe as eu,cFe as ev,iFe as ew,nFe as ex,ho as ey,tFe as ez,bee as f,vWe as f$,sB as f0,T4 as f1,wRe as f2,tv as f3,OM as f4,r4 as f5,o0 as f6,_r as f7,oAe as f8,EB as f9,du as fA,Zl as fB,aN as fC,kf as fD,vW as fE,DD as fF,yW as fG,Fm as fH,_W as fI,_I as fJ,wI as fK,RWe as fL,PWe as fM,AWe as fN,MWe as fO,LWe as fP,FWe as fQ,QWe as fR,YWe as fS,XWe as fT,JWe as fU,gW as fV,mW as fW,Hw as fX,gWe as fY,pWe as fZ,mWe as f_,iAe as fa,Kj as fb,tB as fc,w as fd,gIe as fe,mIe as ff,vIe as fg,XFe as fh,iOe as fi,eOe as fj,tOe as fk,jFe as fl,VFe as fm,LFe as fn,BFe as fo,db as fp,hce as fq,Ca as fr,NRe as fs,ide as ft,lFe as fu,dFe as fv,sIe as fw,Dv as fx,d$ as fy,pF as fz,ni as g,wW as g$,fWe as g0,pW as g1,Q$e as g2,Y$e as g3,X$e as g4,lwe as g5,uwe as g6,J$e as g7,Z$e as g8,eWe as g9,x6 as gA,pHe as gB,hHe as gC,fHe as gD,tWe as gE,iWe as gF,nWe as gG,sWe as gH,rWe as gI,oWe as gJ,aWe as gK,cWe as gL,dWe as gM,vHe as gN,yHe as gO,_He as gP,wHe as gQ,OWe as gR,NWe as gS,$We as gT,WWe as gU,HWe as gV,jWe as gW,BWe as gX,UWe as gY,VWe as gZ,ZWe as g_,kWe as ga,TWe as gb,IWe as gc,DWe as gd,eHe as ge,tHe as gf,yWe as gg,_We as gh,wWe as gi,bWe as gj,SWe as gk,CWe as gl,EWe as gm,xWe as gn,iHe as go,nHe as gp,cHe as gq,dHe as gr,oHe as gs,aHe as gt,rHe as gu,sHe as gv,lHe as gw,uHe as gx,gHe as gy,mHe as gz,v as h,EFe as h$,bW as h0,SW as h1,CW as h2,EW as h3,xW as h4,kW as h5,DW as h6,bHe as h7,SHe as h8,qWe as h9,g_e as hA,t_e as hB,o6 as hC,w_e as hD,b_e as hE,qc as hF,Zle as hG,Nde as hH,zIe as hI,$de as hJ,Rde as hK,Wa as hL,QIe as hM,GIe as hN,YIe as hO,KIe as hP,yAe as hQ,Iwe as hR,Q1e as hS,WIe as hT,f$ as hU,ql as hV,QFe as hW,KFe as hX,YFe as hY,rS as hZ,xFe as h_,GWe as ha,zWe as hb,KWe as hc,PD as hd,x$e as he,i_e as hf,LO as hg,FO as hh,OO as hi,NO as hj,o_e as hk,eC as hl,e_e as hm,UFe as hn,r_e as ho,u_e as hp,c6 as hq,m_e as hr,y_e as hs,v2 as ht,d_e as hu,s_e as hv,__e as hw,f_e as hx,h_e as hy,Kl as hz,V_ as i,DTe as i$,DFe as i0,sS as i1,Y1e as i2,Jp as i3,kme as i4,FHe as i5,OHe as i6,NHe as i7,$He as i8,xF as i9,DB as iA,wz as iB,E3 as iC,Npe as iD,vte as iE,jTe as iF,STe as iG,CTe as iH,vye as iI,qTe as iJ,qke as iK,R_ as iL,cLe as iM,zTe as iN,S3 as iO,Hpe as iP,sLe as iQ,oLe as iR,C3 as iS,nTe as iT,fTe as iU,mTe as iV,gTe as iW,vTe as iX,wTe as iY,_Te as iZ,xTe as i_,F2 as ia,LHe as ib,MHe as ic,PHe as id,Ime as ie,SOe as ig,D8 as ih,AHe as ii,L2 as ij,M2 as ik,Cu as il,g$ as im,Oce as io,OT as ip,HHe as iq,WHe as ir,rP as is,w3 as it,aIe as iu,$ce as iv,nN as iw,y3 as ix,eRe as iy,HU as iz,CFe as j,dIe as j$,OTe as j0,RTe as j1,PTe as j2,NTe as j3,HTe as j4,Z5 as j5,$ke as j6,Vke as j7,Gke as j8,Kke as j9,BTe as jA,LTe as jB,Oke as jC,iTe as jD,kTe as jE,TTe as jF,ITe as jG,ETe as jH,ATe as jI,lTe as jJ,MTe as jK,hte as jL,Hke as jM,jke as jN,pTe as jO,Vme as jP,FTe as jQ,vF as jR,Yke as jS,tTe as jT,dTe as jU,eTe as jV,Bke as jW,Wke as jX,qwe as jY,zj as jZ,uIe as j_,Qke as ja,zke as jb,bTe as jc,$Te as jd,GTe as je,dLe as jf,Uke as jg,e8 as jh,Vh as ji,uAe as jj,Jke as jk,VTe as jl,yue as jm,Xke as jn,UTe as jo,ybe as jp,ej as jq,Yf as jr,sTe as js,cTe as jt,aTe as ju,oTe as jv,yTe as jw,WTe as jx,aLe as jy,Nke as jz,SFe as k,$T as k$,fIe as k0,hIe as k1,L3 as k2,ev as k3,XRe as k4,cm as k5,A4 as k6,$le as k7,M3 as k8,zRe as k9,_Pe as kA,wPe as kB,CPe as kC,xPe as kD,bPe as kE,Mle as kF,Lle as kG,IPe as kH,BRe as kI,VRe as kJ,qRe as kK,GRe as kL,WRe as kM,jRe as kN,ywe as kO,URe as kP,gPe as kQ,vPe as kR,mPe as kS,ePe as kT,JRe as kU,pPe as kV,aPe as kW,oPe as kX,lIe as kY,pB as kZ,RU as k_,KRe as ka,QRe as kb,tPe as kc,iPe as kd,ZRe as ke,nPe as kf,rPe as kg,sPe as kh,cPe as ki,dPe as kj,fPe as kk,lPe as kl,uPe as km,hPe as kn,YRe as ko,OD as kp,kPe as kq,Ole as kr,Nle as ks,EPe as kt,yPe as ku,DPe as kv,Gj as kw,TPe as kx,HRe as ky,SPe as kz,qFe as l,Zx as l$,M4 as l0,kB as l1,BT as l2,c4 as l3,a4 as l4,om as l5,rNe as l6,Z$ as l7,qme as l8,RF as l9,PRe as lA,iNe as lB,QOe as lC,KOe as lD,zOe as lE,GOe as lF,xle as lG,HOe as lH,YOe as lI,XOe as lJ,JOe as lK,ZOe as lL,eNe as lM,jOe as lN,BOe as lO,UOe as lP,aS as lQ,VOe as lR,qOe as lS,p4 as lT,j0e as lU,fB as lV,CRe as lW,ERe as lX,B0e as lY,ORe as lZ,A8 as l_,d4 as la,l4 as lb,w$ as lc,$h as ld,LIe as le,hb as lf,TIe as lg,eB as lh,RIe as li,Mce as lj,g3 as lk,AIe as ll,PIe as lm,IIe as ln,K1 as lo,_Re as lp,MIe as lq,rIe as lr,Ace as ls,DRe as lt,ARe as lu,MRe as lv,TRe as lw,kRe as lx,IRe as ly,RRe as lz,GFe as m,Q_ as m$,A3 as m0,Cle as m1,qh as m2,MFe as m3,nNe as m4,Ple as m5,k5 as m6,T5 as m7,$$ as m8,D5 as m9,Gf as mA,Kle as mB,MT as mC,C$ as mD,$C as mE,Ra as mF,Vp as mG,Vs as mH,wNe as mI,My as mJ,zh as mK,Ay as mL,cb as mM,rx as mN,SNe as mO,bNe as mP,bIe as mQ,LPe as mR,ya as mS,pE as mT,jE as mU,BE as mV,Gle as mW,Wle as mX,qf as mY,CNe as mZ,$F as m_,Su as ma,yIe as mb,LRe as mc,xRe as md,FRe as me,hB as mf,tue as mg,tNe as mh,_ue as mi,$Re as mj,f4 as mk,g4 as ml,rue as mm,PU as mn,JPe as mo,XPe as mp,nv as mq,nOe as mr,kIe as ms,TE as mt,qle as mu,b4 as mv,Jj as mw,CIe as mx,EIe as my,xIe as mz,Ic as n,NU as n0,K_ as n1,Om as n2,CI as n3,R0e as n4,bB as n5,wIe as n6,l0 as n7,hme as n8,_B as n9,c0 as na,uTe as nb,hTe as nc,rTe as nd,Zke as ne,D4 as nf,lI as ng,wue as nh,TB as ni,Mue as nj,oIe as nk,t9 as o,Pl as p,Gx as q,Rl as r,fje as s,f8 as t,Ut as u,Kf as v,gn as w,to as x,yr as y,da as z};
